/************************************************************************/
/* OCS MEDICOM VER 1.6                                                  */
/************************************************************************/
/* PROGRAM NAME          : RLRRSENQ                                     */
/* DESCRIPTION		     : Test Results report 					        */
/* AUTHOR                : S. Sheelvant                                 */
/* DATE WRITTEN          : 11-SEP-1998                                  */
/* MODIFIED BY           : S.SHEELVANT 						            */
/* MODIFIED ON		     : 12-DEC-1998                                  */
/* Last Modified by      : HAMEED - For eHIS upgrade					*/
/* Last Modified by      : Srinivas - For enhancements                  */
/* modified date	modified by			reason			         		*/
/* 13/02/2012       Srinivasarao V      against AMS-SCF-0045            */
/* 12/03/2012       Srinivasarao V      against KDAH-CRF-0174           */
/* 04/08/2012       Srinivasarao V      against AMS-CRF-0      legend change for Reference range */
/* 07/10/2016       Ravi Shankar	against GHL-SCF-1120 */
/* 01-03-2018 		Krishnamoorthy			For GHL-CRF-0452-DD-01*/
/* 21-03-2018 		Krishnamoorthy			For GHL-SCF-1130.1*/
/* 28-05-2018 		Krishnamoorthy			For GHL-CRF-0489*/
/* 10-08-2018 		Krishnamoorthy			For GHL-CRF-0433.1(added param18) */
/*23-11-2018		Krishnamoorthy			ADDED if CLUSE for KDAH-SCF-0536
											where ever code is there for GHL-SCF-1130.1*/
/*04-01-2019		Krishnamoorthy			for KDAH-SCF-0546
/************************************************************************/

#include <stdio.h>             
#include <string.h>   
#include <process.h>   
# include <malloc.h>     
#include <stdlib.h>   
#include <windows.h>

#include "rl.h"
#define NODATAFOUND				(sqlca.sqlcode == 1403)
#define OERROR 					(sqlca.sqlcode < 0)
#define LAST_ROW                (sqlca.sqlcode == 1403)
#define NOT_FOUND 				(sqlca.sqlerrd[2] == 0)
#define TABLE_ALREADY_EXISTS	(sqlca.sqlcode == -955)
#define RESOURCE_BUSY			(sqlca.sqlcode == -54)     

#define VIEW_LOG_FILE 1
#define ONLINE_PRINTING 1
#define RESTART_INTERVAL 2 
#define RESTART_TIME 500
#define INIT_MESG ""

#define SPOOL_DIR			""	
#define ESC 0x1B
#define SEP 0xFA   

#define MAX_ORGANISMS	500

EXEC SQL BEGIN DECLARE SECTION;

#define MAX_ANTIBIOTICS	1000


   VARCHAR nd_operating_facility_id         [5],
		   nd_facility_id					[5],
   		   nd_priority						[5],
           uid_pwd                          [132],
           d_curr_pgm_name                  [15],
           nd_file_name                     [151],
		   nd_file_name_fax                 [2520],
		   nd_get_fax_dir					[2],
		   today			                [20], 
           nd_file_no                       [15];

   VARCHAR s_org							[MAX_ANTIBIOTICS][5],
           s_ant							[MAX_ANTIBIOTICS][5],
           s_ind							[MAX_ANTIBIOTICS][2],
		   s_mic							[MAX_ANTIBIOTICS][10],
		   s_zone							[MAX_ANTIBIOTICS][10],
		   s_mic_print_yn					[MAX_ANTIBIOTICS][2],
		   s_mic_sign						[MAX_ANTIBIOTICS][2];

   VARCHAR nd_hosp_no                       [21],	 /* Patient ID */
           nd_spec_no                       [21],
           nd_cntrl_rowid                   [31], 

		   nd_rowid							[31],

		   nd_result_printed_date			[21],
	       er_msg                           [1071],
		   er_msg_num						[1000],
   
             c_req_dtl_test_code              [11],/* Used in */ 
             c_group_test_yn                  [2],/* Update_rl_request_detail*/
             c_count                          [3],/*-----*/
             c_count_profile                  [3],/*-----*/
             c_spec_no                        [21],

             p_print_name_yn                  [2],
             p_test_desc                      [41],
             p_function_yn                    [2], 

             rl_lab_title                     [101],
			 rl_lab_title_2					  [201],
			 rl_lab_title_3					  [201],
			 rl_lab_title_4					  [201],
			 rl_lab_title_5					  [201],
			 rl_lab_title_6					  [201],
			 rl_actual_dob_yn				  [2], 
			 rl_race_code					  [11],
			 rl_report_format				  [3],
			 rl_age_years					  [3], 
			 rl_national_id_num               [21],
			 rl_alternate_id_num              [21],
			 rl_location					  [21], 
			 d_race_desc					  [31], 
			 d_clinical_text_code			  [5],
			 d_clinical_text				  [4001],
			 d_clinical_spec_no				  [21], 
			 rl_test_requested_yn			  [2],
			 d_inhibit_yn					  [2],
			 inhibit_test_code				  [11], 
			 rl_message_line				  [500],
			 rl_name_on_report_yn			  [2],
			 rl_print_prv_result_yn           [2],
			 rl_print_build_clin_hist_yn      [2],
			 rl_print_pend_profile_yn         [2],
			 rl_legend_for_pending			  [40], 
			 rl_footer_line_1				  [500],
			 rl_footer_line_2				  [500],
			 rl_category_code				  [5],
			 rl_category_year				  [5],
			 rl_category_number				  [21], 
			 rl_ordered_facility_id			  [3],
			 rl_ordering_doctor_name		  [41],
			 rl_order_id					  [21],
			 rl_perform_site_code			  [5],
			 v_test_code					  [11],
			 rl_high_low_ind			      [10],
			 rl_cancelled_yn				  [2],
			 can_spec_no					  [21],
			 can_group_test					  [11],
			 can_test_name					  [41], 
			 can_test_code				      [11],
			 cancel_reason					  [41],
			 print_name_yn					  [2],
			 first_user						  [31],
			 rl_released_by_id				  [31],
			 p_user_id						  [31],
			 rl_released_date				  [17],
			 rl_released_date1				  [17], //added for globalisation
			 v_numeric_result				  [21],
			 sy_user						  [31],
			 sy_user_name					  [60],
             sy_func_role_id                  [21],

			rl_print_result_sect_yn			[2],
			rl_section_tel_num				[16],

           rl_hdr_source_code               [11],
           rl_hdr_consultant_code           [16],
           rl_hdr_spec_recd_date_time       [17],
           rl_hdr_spec_recd_date_time1       [17],//added for globalisation
           rl_hdr_spec_regd_date_time       [17],
           rl_hdr_spec_regd_date_time1       [17],//added for globalisation
  	       rl_hdr_spec_colltd_date_time     [17],
  	       rl_hdr_spec_colltd_date_time1     [17],//added for globalisation
           rl_hdr_current_date_time         [17],
           rl_hdr_current_date_time1         [17],//added for globalisation,
           rl_hdr_section_code              [2],
		   rl_report_entire_spec_yn			[2],
           rl_hdr_request_comment_code1     [5],
           rl_hdr_request_comment_code2     [5],
           rl_hdr_request_comment_code3     [5],
           rl_hdr_request_comment_desc1     [41],
           rl_hdr_request_comment_desc2     [41],  
           rl_hdr_request_comment_desc3     [41],
           rl_hdr_extra_copies_to           [16],
           rl_hdr_specimen_type_code        [5],
           rl_hdr_added_by_id               [31],
           rl_hdr_added_date                [16], 
           rl_hdr_added_date1                [16], //added for globalisation
           rl_hdr_modified_by_id            [31],
           rl_hdr_modified_date             [16],
           rl_hdr_modified_date1             [16],//added for globalisation
 	       rl_hdr_episode_type		    [2],
 	       rl_hdr_urgent_indicator	    [2],
		   rl_hdr_source_type		    [2],
		   rl_hdr_released_by_id		[31],
		   rl_hdr_released_date			[21],
		   rl_hdr_released_date1			[21], //added for globalisation
		   rl_num_result_hide_yn		[2],
		   rl_hdr_result_printed_date   [31],
		   rl_hdr_result_printed_date1   [31], //added for globalisation

		   rl_hdr_status                [2],

           rl_dtl_test_code_reqd	    [11],
           rl_dtl_test_code                 [100][11],
           rl_dtl_result_status             [100][2],
           rl_dtl_group_test_flag           [100][2],

           rl_tst_group_test_code           [11],
           rl_tst_test_code                 [11],
           rl_tst_numeric_prefix            [2],
           rl_tst_numeric_result            [16],
           rl_tst_result_comment_desc1      [41],
           rl_tst_result_comment_desc2      [41],
           rl_tst_result_comment_desc3      [41],
           rl_tst_result_comment_desc4      [41],
           rl_tst_rowid                     [31],
		   rl_tst_hide_rslt_comm_yn			[2],
		   rl_tst_status					[2], 
		   rl_tst_rslt_max_rev_date			[31],
		   rl_tst_rslt_max_rev_date1			[31], //added for globalisation
		   rl_tst_interval_test_yn			[2], 
		   rl_tst_preliminary_release_yn	[2],

           rl_loc_test_code                 [11],
           rl_loc_grp_test_code             [11],
           rl_loc_long_desc                 [41],

	       rl_pat_title                     [9],
           rl_pat_long_name                 [61],
           rl_pat_short_name                [300],
           rl_pat_sex                       [2],
           rl_pat_nationality               [6],
           rl_pat_dob_no_of_days            [10], //sunil
           rl_pat_date_of_birth             [16], //sunil
	       rl_pat_actual_id                 [31],
           rl_pat_blood_group               [3],
           rl_pat_g6pd                      [11],
           rl_pat_sicc                      [11],
           rl_pat_hbl4_1                    [11],
           rl_pat_hbl4_2                    [11],

           rl_spc_specimen_desc             [41],

           rl_source_short_name             [100],   /*Modified By Manoj S for ML-MMOH-CRF-0752.6*/	 /* long name */
           rl_consultant_short_name         [41], 	 /* long name */
           rl_section_short_name            [41],  
		   rl_section_ind					[5],
		   rl_use_sample_anatomy_ind		[3],

           rl_tst_cd_short_desc             [41],
           rl_tst_cd_numeric_result_yn      [2],
           rl_tst_cd_age_sex_range_yn       [2],
           rl_tst_cd_function_yn            [2],
           rl_tst_cd_print_report_yn        [2],
           rl_tst_cd_low_value_normal       [16],
           rl_tst_cd_high_value_normal      [16],
           rl_tst_cd_result_name_text       [11],
           rl_tst_cd_group_test_yn          [2],
           rl_tst_cd_text_block_yn          [2],
           rl_tst_cd_culture_test_yn        [2],
           rl_tst_cd_snomed_yn              [2],
           rl_tst_cd_test_units             [11],
		   rl_tst_cd_oth_units              [11],
		   rl_tst_cd_test_units_desc        [16],
		   rl_tst_cd_test_units_2           [11],
           rl_tst_cd_range_cmt              [41],
		   rl_tst_cd_range_cmt_2            [41],
		   rl_tst_cd_inh_rep_yn				[2],
		   rl_tst_cd_conf_yn				[2],
		   rl_tst_cd_profile_yn				[2],

		   rl_tst_ran_low_val_nor    [16],
           rl_tst_ran_high_val_nor   [16],
		
		   l_low_val				 [16],
		   l_high_val				 [16],
           rl_tst_rng_lvn            [16],
           rl_tst_rng_hvn            [16],

           rl_comm_tst_comm_txt      [41],

		   rl_res_modify_reason		 [41],
		   rl_res_modify_reason_code [5],
		   rl_modify_reason_rel_by   [31],
		   rl_modify_reason_rel_dt   [31],
		   rl_modify_numeric_prefix  [2],
		   rl_modify_numeric_result  [16],
		   rl_modify_components_ind  [21],

           rl_res_result_text				[2000],

           rl_func_operand_1                [11],
           rl_func_operand_1_type           [2],
           rl_func_operator_1               [2],
           rl_func_operand_2                [11],
           rl_func_operand_2_type           [2],
           rl_func_operator_2               [2],
  
           rl_func_value                    [16],

           rl_calc_str                      [400],
           rl_func_str                      [400],

           rl_res_organism_code             [5],
           rl_res_comment_desc              [41],

           rl_res_organism_code1             [5],
           rl_res_organism_code2             [5],

           rl_res_organism_code_desc        [41],
           rl_res_organism_code_s_desc      [16],

		   d_user_id_pwd					[91],

		   rl_res_dtl_organism_code			[5],
           rl_res_dtl_antibiotic_code       [5],
           rl_res_dtl_antibiotic_desc       [41],
           rl_res_dtl_sensitivity_ind       [2],
	   
	       //sy_acc_entity_name 		        [81],
			sy_acc_entity_name 		        [300],
		   sy_tel_num						[21],
		   sy_fax_num						[21],
		   sy_ord_acc_entity_name		    [61],
           rl_res_snomed_code               [21],
		   rl_res_snomed_code2				[21],
           
		   rl_res_snomed_mrkr_code1         [2],
		   rl_res_snomed_mrkr_code2         [2],		    

		   rl_prn_ctrl_hdr_pat_no	        [16],
		   rl_prn_ctrl_hdr_sp_no	        [21],
	       rl_prn_ctrl_hdr_source_code	    [11],  

	       rl_prn_ctrl_hdr_user		        [31],
	       rl_prn_ctrl_hdr_section_code	    [2],
           rl_prn_ctrl_hdr_rp_yn            [2],

	       rl_snomed_desc1                  [301],
           rl_snomed_desc2                  [41],
           rl_snomed_desc3                  [41],
           rl_snomed_desc4                  [41],
           rl_snomed_desc5                  [41],
           rl_snomed_print_yn               [2],
           rl_snomed2_desc1                  [301],
           rl_snomed2_desc2                  [41],
           rl_snomed2_desc3                  [41],
           rl_snomed2_desc4                  [41],
           rl_snomed2_desc5                  [41],
           rl_snomed2_print_yn               [2],
		   r_rslt							 [20], 
		
		   nd_snomed_mrkr_desc2				 [41],
		   nd_snomed_mrkr2_print_yn          [2],
		   nd_snomed_mrkr_desc1				 [41],
		   nd_snomed_mrkr1_print_yn          [2],
		   nd_res_modify_reason_print_yn     [2],
		   nd_order_date_time                [17],
		   nd_order_date_time1                [17], //added for globalisation
		   nd_position_desc                  [31], 
   		   nd_user_conf_access_yn			 [2], 	
		   nd_perform_site_desc				 [41],
		   nd_anatomy_site					 [5],
		   nd_anatomy_site_desc				 [41],

  	       d_loc_str 			    [20], 
  	       d_l_str 					[20], 
  	       d_dec_part			    [20],
  	       d_int_part			    [20],
  	       d_sig_part			    [20],

		   a_antibiotic_code		[5],
		   b_antibiotic_code		[5],
		   b_sensitivity_ind		[2],
		   b_mic_value              [10],
		   b_zone_value				[10],
		   b_mic_print_yn			[2],
		   b_mic_sign			    [2],

		   d_sleep_secs		[10],
		   d_machine_name   [40],
		   d_started_by_id  [31],
		   d_eqvl_test_units [11],
		   d_mail_subject    [2001],
		   d_mail_salutation [4001],
		   d_mail_body       [4001], 
		   d_mail_footer     [2001],
		   
		   sy_user_id			[31],
           sy_session_id		[30],
           sy_req_date			[30],
           l_sy_req_date		[30], 
           l_sy_req_date1		[30], 
		   l_report_legend      [20],
		   l_report_legend1      [100],
		   l_report_legend2      [100],
		   sy_machine_name      [31],
           sy_ws_no             [31],
		   sy_rowid				[31],
           
		   p_uid_pwd            [151], 
		   p_print_name         [100], 
		   p_loc_type           [10],
		   p_fax_loc_type       [10],
           p_loc_code           [100],
		   p_fax_loc_code       [100],
		   p_mail_loc_type       [10],
		   p_mail_loc_code       [100],
		   p_rep_file           [151],
		   p_rep_file_fax       [151],
		   p_rep_file_fax_ext   [151],
		   p_print_mode         [10],
		   
		   p_param7				        [2],
		   prg_start_date		        [30],
		   d_next_start_date            [30],
		   d_cmd_line                   [200],

		   l_print_disch_pat_result     [2],
		   rl_printer_for_urgent_yn		[2],
		   rl_print_inpatient_yn		[2],
		   rl_print_outpatient_yn		[2],
		   rl_print_referral_yn			[2],
		   rl_print_external_yn			[2],
		   rl_sectn_report_entire_spec_yn	[2],
		   rl_print_prev_modified_result_yn [2],
		   rl_print_num_result_title_yn [2],
		   rl_title_for_test            [50],
		   rl_title_for_num_result      [50],
		   rl_title_for_test_units		[50],
		   rl_title_for_range_ind		[50],
		   rl_title_for_result_range	[50],
		   rl_title1_for_result_range	[50],
		   rl_title2_for_result_range	[50],
		   rl_title3_for_result_range	[50],
		   rl_title4_for_result_range	[50],
		   rl_legend_for_pre_result		[100],

		   l_rep_disch_pat_result		[2],
		   rl_rep_inpatient_yn			[2],
		   rl_rep_outpatient_yn			[2],
		   rl_rep_referral_yn			[2],
		   rl_rep_external_yn			[2],

		   l_fax_disch_pat_result		[2],
		   rl_fax_inpatient_yn			[2],
		   rl_fax_outpatient_yn			[2],
		   rl_fax_referral_yn			[2],
		   rl_fax_external_yn			[2],

		   l_mail_disch_pat_result		[2],
		   rl_mail_inpatient_yn			[2],
		   rl_mail_outpatient_yn		[2],
		   rl_mail_referral_yn			[2],
		   rl_mail_external_yn			[2],
		   rl_mic_to_print_yn			[2],
		   rl_print_mic_sign_yn		    [2],  // added on 01.04.2015

		   rl_print_test_name_in_contd_page	[2],
  		   rl_hmc_yn			        [2],

		   l_command_line				[225],

		   nd_status					[2],
		   d_specimen_no				[21],
		   d_group_test_code			[11],
		   d_test_code					[11],
		   d_no							[21],
		   p_param8						[2],
		   p_param9						[10],   /// added param9,10,11 on 09.12.2004
		   p_param10					[2],
		   p_param11					[2],

		   p_param12					[2],   /// added on 07.08.2005
		   p_param13					[2],   /// added on 16.01.2006
		   p_param18					[30],  // added for GHL-CRF-0433.1
		   p_fax_id						[30],
		   p_mail_id					[30],
		   p_print_id					[30],  /// added on 07.08.2005

		   p_printer_name               [100], /// added on 21.08.2005
		   p_dest_queue_name            [100],
		   l_error_text1			    [500],

		   p_fax_to_rcpt_name			[500],
		   p_fax_to_comp_name           [500],
		   p_fax_to_phone_no            [100],
		   p_fax_address                [100],
		   p_mail_address               [100],

		   actual_specimen				[21],
		   interval_description			[41],
		   first_specimen_no			[21],
		   l_file_no                    [30],
		   l_loc_dir                    [200],
		   l_debug_yn                   [5],
		   l_text                       [500], 
		   l_file_exists                [1],
		   l_dir_exists                 [1],
		   sql_stmt						[2000],
		   
		   l_pat_curr_source_type		[2],
		   l_pat_curr_source_code		[11],
		   l_pat_admit_pract_id			[16],
		   
		   rl_tst_test_sub_sec			 [4], //added for GHL-CRF-0452-DD-01
		   rl_tst_test_sub_sec_t		 [4],//added for GHL-CRF-0452-DD-01
		   
		   rl_grp_tst_test_sub_sec			 [4], //GHL-CRF-0489
		   rl_grp_tst_test_sub_sec_t		 [4],//GHL-CRF-0489
		   
		   
		   rl_sub_sec_desc				 [61]; //ADDED FOR GHL-CRF-0452-DD-01

  	varchar	 BVNewVersionYN[2];   	// TO check the MEDICOM version

	varchar  VCbdoperationalYN			[2],
			 VCbtoperationalYN			[2],
			 VCoperational_modules		[2000];

       int l_count = 0; /* To get count */
	   int i_count = 0, u_count = 0, l_seq_no = 0;

       int no_of_dtl_recs = 0, 
		   d_time_interval =0,
		   d_starting_time =0,
           rl_tst_cd_no_of_decimals = 0,
	       sy_ref_no_of_copies = 0,
           rl_tst_cd_significant_digit = 0, 
   	       p_significant_digit,
   	       p_no_of_decimals,  
           er_msg_type = 0,
  	       d_dec_pos = 0,
           d_after_sig_digit = 0;

   int     page_length = 0;

   int l_low = 0, l_high = 0;

   long l_episode = 0;

   int l_restart_time = 0;

   int d_seq_no = 0, rl_seq_no = 0;
   int l_exist_decimals = 0;
   int l_inst_decimals = 0;

   int signif;
   long double d_numeric_eqvl_value;
   long double d_numeric_eqvl_value2;
   long double d_low_val_nor_eqvl_value;
   long double d_high_val_nor_eqvl_value;

   int d_numeric_length = 0;
   int d_decimal_pos = 0;

   int l_flag = 0;


		/*  For Patient Age SYSDATE, MTHS */
   VARCHAR  tday				[30],
			t_days				[30],
			mths				[30],
			mths1				[30],
			t_age				[30],
			rl_regd_date		[11];

/*********** NEWLY ADDED FOR KNDV LAB ENHANCEMENTS OF SNOMED CODE TO PRINT Y/N**********/
VARCHAR		 rl_print_snomed_code_yn		  [2],
			 rl_print_snomed2_code_yn		  [2],
			 d_found						  [2];

	float mt;

/*********** NEWLY ADDED (23/12/2002) FOR KNDV LAB ENHANCEMENTS of PRINT PENDING BY SOURCE**********/
	VARCHAR	c_session_id					[50],
		    c_pgm_date						[21],
			nd_trx_ind						[2],
			c_pgm_type						[2],
			c_user_id						[50],
			c_next_start_date				[21];

	int		v_count = 0;

/***** FOR QATAR **********/
   VARCHAR 		   nd_new_medicom_no			[21],
				   nd_nationality_desc          [21];
	
/***** FOR MAFRAQ **********/
    VARCHAR		  rl_health_card_num            [15],
				  rl_health_num				    [15],
				  l_print_health_card_yn         [2],
				  rl_health_exp_date		    [20];


	VARCHAR		rl_alt_id_for_pat_id		    [51],
	            test_desc_fill_for_report        [2],
				rl_hmc_no						[31];

/***** added on 19/07/2004 **********/

	VARCHAR		draft_printing_yn				[2],
				rl_race_accepted_yn		        [2];

	  int other_than_comments = 0;
	  int t_antib_head_first_time = 0;


/*** added on 29.07.2004 to print the Previous results ***/

	VARCHAR		d_prv_specimen_no				[21],
				d_tst_prv_test_code				[11],
				d_tst_prv_numeric_result    	[16],
				d_num_prv_prefix				[2],
				d_status_prv					[2],
				d_tst_prv_units					[11],
				d_tst_prv_age_range_low			[16],
				d_tst_prv_age_range_high		[16],
				d_tst_prv_high_low_ind			[10],
				d_prv_spec_regd_date_time		[31],
				d_prv_spec_facility_id			[3],
				nd_prv_result_dt				[31],
				d_past_result_unit      		[6],
				d_num_result_hide_yn			[2];

		int		d_past_result_period = 0;
		int		d_past_result_no     = 0;
	    int     p_count			     = 0;
		int     past_results_head_printed = 0;
		int     rl_num_component_modified = 0; /// 07.03.2006

    VARCHAR     d_mother_specimen_yn    [2];   /////// 19.10.2005
	VARCHAR     d_episode_type			[2];   /////// 19.10.2005
	VARCHAR     d_screen_patient_id     [30],
				d_screen_donor_id		[30];

/*************** added for globalisation *************************/
	VARCHAR		l_translated_value		 [600],
				language_id			[5];
				/*l_language_id		[5];*/

	int			i;
	int		mic_count=0;
	/***************added for globalisation*************************/


/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
	VARCHAR l_customer_id	[10], l_payer  [50], rl_footer_line_3 [500],
			rl_encounter_id  [50], rl_bed_num [50], rl_bill_yn [5];

/***** ADDED FOR KDAH requirement to print the long desc of result text ********/
	VARCHAR rl_print_text_desc_yn [2],
			rl_print_text_bold_yn[2],
			rl_print_text_underline_yn[2],
			rl_res_result_text_code[10],
			rl_res_text_code_desc[50];
			
			
/***** ADDED by madhu for showing notify details FD-ML-MMOH-CRF-0332 *******/
	VARCHAR  RL_NOTIFY_CODE [5],
	RL_NOTIFY_BY [30],
	RL_NOTIFY_TO[30],
	RL_NOTIFY_DATE_TIME [30],
	RL_NOTIFY_DATE_TIME1 [30],
	RL_NOTIFY_TEXT [2000],
	rl_print_notify_yn[5];
	int c_count_notify = 0;
	 
/***** added against CA Note Type Enhancement ************/

	VARCHAR rl_char_val[4000],
			rl_note_type_test[50],
				l_directory_name[1500],
				l_printer_name[3000],
				l_draft_print_yn[5],
				l_print_status[5],
				l_confidential_yn[5],
				l_header[32000],
				l_footer[32000];

	VARCHAR l_html_file_name[1000];
	VARCHAR l_comm_line[300];

/**************** KDAH-CRF-260 The result comment code selection is added ************/
int bold_print_for_comm1 = 0, bold_print_for_comm2 = 0, bold_print_for_comm3 = 0, bold_print_for_comm4 = 0;	
int bold_print_for_org = 0;

VARCHAR rl_tst_result_comment_code1[5],
			rl_tst_result_comment_code2[5],
			rl_tst_result_comment_code3[5],
			rl_tst_result_comment_code4[5],
			BVServicedRequestID	[32]; //Ravi Shankar, 07/10/2016, IN-62208

EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE SQLCA.H;
EXEC SQL INCLUDE SQLDA.H; 

#include<winproc.h>  

FILE *fp,*fp1,*fp2,*fp3, *fh;
int  status_prn   = 0, pgm_flg  = 0,tst_cd_ind = 1,  err_flag = 0;
int copy = 0;
int numeric_value_flag = FALSE;
int  MAX_LINES = 27;
int	 fax_i = 0;
char	*wordir;

char local_legend[125][600];//added for globalisation
char l_kb_mic_legend[500];

char temp[160],temp1[5];
char nd_repo_file_name[151], extra_file_name[151],l_file_name[151], lab_file_name[151];

char prev_group_test [11],
     rl_curr_status  [4];

int i = 0, rec_ctr = 0, lctr = 0, pctr = 0, 
    spc_first = 0,    ind_test_prn   = 0,
    group_printed = 0, group = 0,print_c_hist = 0,
    test_printed = 0, test_result_found = 0,
    source_copies = 0, local_copies = 0, bold_print_check = 1, test_contd = 1;

DWORD sleep_sec = 0;

char text_line[1000],text_line1[1000], test_description[410], nd_e_name[551], nd_f_name[551];

char *to_day();

int no_of_sensitivities = 0;
int something_to_print = 0, something_to_print_for_test = 0;
int qq = 0, cntr = 0, z = 0, hell = 0, clt = 0, cmp = 0, t_rue = 0;

int last_page = 0;

int org_yn = 0; 
int a_flag = 0; 
int antb_yn = 0; 
int b_flag = 0;
int oflag = 1; 
int org1 = 1; 
char word1[2];
char err_num[10];
/****** ADDED FOR GTT SPECIMENS ************/
char l_should_print_yn = 'N';
char nd_test_code[11];
char d_interval_specimen_yn = 'N';

char l_numeric_result[30];

char footer_released_date[22];
char footer_released_date1[22];//added for globalisation

int request_count = 0;
int l_snomed_head_printed = 0;
char l_destn_rep_yn;
char l_destn_fax_yn;
char l_destn_mail_yn;
char string_var[2000];


char* getvalue(char *bufline,char *value)
{

int i =0,cou=0,flag=0;
char retvalue[100];

 for(i=0; *(value+i)!='\0';i++)
 {

 if(*(bufline+i) != *(value+i))
 {
	    flag=1;
 }

 }


 if(flag==0)
 {

    for(;*(bufline+i)!='\0';i++)
		if(*(bufline+i) == '=') break;



	for(cou=0,i=i+1;*(bufline+i)!='\0';i++)
	{
		 retvalue[cou]=*(bufline+i);
		 cou++;
	}


 }	

  retvalue[cou]='\0';
 // printf(" 1 %s \n",retvalue);
  return retvalue;
}


void getValueInFile(char *find,char *res)
{
	char dat[100];
	
int ch1,cou=0;
FILE *f1;

   if ((f1 = fopen("RLRSENQ1.INI","r")) ==NULL)
    {
	  if (strcmp(find,"DEBUG")==0)
	   strcpy(res,"N");
    }
    else
   {	 
   f1=fopen("RLRSENQ1.INI","r");

   strcpy(res," ");

   while(!feof(f1))
   {

	ch1=fgetc(f1);    

	dat[cou++]=(char)ch1;

	if(ch1 == 10 ) 
	{
		dat[cou-1]='\0';					
		strcpy(res,getvalue(dat,find));
		cou=0;		
	}		

  }
 }
if(strlen(res)==0) 
{
dat[cou]='\0';
  strcpy(res,getvalue(dat,find));
}
fclose(f1);
}


void proc_main(argc,argv)
char *argv[];
int argc;
{
   int rec_found = 0;     
    
   if (argc < 6) 
   {
      disp_message(ERR_MESG,"Usage : rlrsenq1 uid/password ");
      proc_exit();
   }

   strcpy(d_user_id_pwd.arr,argv[1]);
   d_user_id_pwd.len = strlen(d_user_id_pwd.arr);

   strcpy(c_session_id.arr, argv[2]);
   c_session_id.len = strlen(c_session_id.arr);

   strcpy(c_session_id.arr, argv[3]);
   c_session_id.len = strlen(c_session_id.arr);

   strcpy(nd_facility_id.arr, argv[4]);
   nd_facility_id.len = strlen(nd_facility_id.arr);

   strcpy(nd_priority.arr, argv[5]);
   nd_priority.len = strlen(nd_priority.arr);

   if (argc == 8)
   { 


/****************** commented and moved to above  23.06.2003	
		strcpy(c_session_id.arr, argv[3]);
		c_session_id.len = strlen(c_session_id.arr);
********************************/

		strcpy(c_user_id.arr, argv[6]);
		c_user_id.len = strlen(c_user_id.arr);

		strcpy(c_pgm_type.arr, argv[7]);
		c_pgm_type.len = strlen(c_pgm_type.arr);

		//Ravi Shankar, 07/10/2016, IN-62208
		strcpy(BVServicedRequestID.arr,"*A");
		BVServicedRequestID.len = strlen(BVServicedRequestID.arr);
		///////////
	}
  //Ravi Shankar, 07/10/2016, IN-62208
  else
  {
	strcpy(BVServicedRequestID.arr,argv[6]);
	BVServicedRequestID.len = strlen(BVServicedRequestID.arr);
  }
  /////////
	strcpy(g_pgm_id,"RLRRSENQ");
	strcpy(d_curr_pgm_name.arr,g_pgm_id); 
	
   if(sql_connect(argv[1]) == -1) 
   {
      disp_message(ERR_MESG,"Database Connection Problem rlrsenq1.......");
	  //ins_message1(ORA_MESG,"Error in connecting to Oracle");
	  proc_exit();
   }

   set_meduser_role(); 

/**------------***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ----------------------******/
  get_site_customer_id();

/********* This part added for globalisation ***************************/
    strcpy(language_id.arr,l_language_id.arr);
	language_id.len =l_language_id.len;
	language_id.arr[l_language_id.len]='\0';
/********* This part added for globalisation ***************************/

get_legend_value(95); //added for globalisation


   strcpy(draft_printing_yn.arr, "N");
   draft_printing_yn.len = strlen(draft_printing_yn.arr);

 
/*--------------from here---------*/
   l_loc_dir.arr[0]		    = '\0';
   l_loc_dir.len            = 0;
   l_debug_yn.arr[0]		    = '\0';
   l_debug_yn.len            = 0;

   fp2 = fopen("RLRSENQ1.INI", "r");
   if (fp2 ==NULL) 
   {
	   strcpy(l_loc_dir.arr," ");
	   strcpy(l_file_exists.arr,"N");
   }
   else
   {
	   strcpy(l_file_exists.arr,"Y");
	   getValueInFile("DIR",temp);
       strcpy(l_loc_dir.arr,temp);
       sprintf(l_file_name,"%sTRACE_RLRSENQ1.lis",l_loc_dir.arr);
    
     if ((fp3 = fopen(l_file_name,"w")) == NULL)
        strcpy(l_dir_exists.arr,"N");
     else
        strcpy(l_dir_exists.arr,"Y");
    }
  
  if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
   {
   getValueInFile("DEBUG",temp1);
   strcpy(l_debug_yn.arr,temp1);

   l_loc_dir.arr[strlen(temp)] = '\0';
   l_debug_yn.arr[1] = '\0';

   if (strcmp(l_debug_yn.arr,"Y")==0)
    {
	  fp1=fopen(l_file_name,"w");
      fprintf(fp1,"STARTING........");
	  fprintf(fp1,"\n");
	  fclose(fp1);
    }
	}

/*----upto here----------------*/

   if (strcmp(c_pgm_type.arr, "R") == 0)    
   {
	  process_rec1();
	  delete_error_record();  

   }
   else if (strcmp(c_pgm_type.arr, "F") == 0)
   {

      patch_sy_table();  
   }
   else
   {
		if (strcmp(c_pgm_type.arr, "D") == 0)
		{
			strcpy(draft_printing_yn.arr, "Y");
			draft_printing_yn.len = strlen(draft_printing_yn.arr);
		}

	  process_rec();
   }



   EXEC SQL COMMIT WORK RELEASE;


   if (OERROR)
     ins_message(ORA_MESG,"ROLLBACK WORK RELEASE failed");
   return;
}
/*----------------------------------------------------*/
/*************************** this is not required
get_restart_time()
{
    
	 l_restart_time = 0;

     EXEC SQL SELECT NVL(TO_NUMBER(TO_CHAR(restart_time, 'HH24MI')), 500)
     INTO :l_restart_time
	 FROM RL_PARAM;
  
     if (OERROR)
        ins_message(ORA_MESG,"Error Found in RL_PARAM 2");

	  if(NOT_FOUND) 
         ins_message(ORA_MESG,"Select failed on RL_PARAM 2 --> No Data Found");  


 }
 **************************/
/*------------------------------------------------------*/


 /*------------------------------------------------------*/
 
 get_len_from_param()
 {

     page_length = 0;

     l_print_disch_pat_result.arr[0]                = '\0';
	 rl_print_inpatient_yn.arr[0]					= '\0';
	 rl_print_outpatient_yn.arr[0]					= '\0';
	 rl_print_referral_yn.arr[0]					= '\0';
	 rl_print_external_yn.arr[0]					= '\0';

     l_rep_disch_pat_result.arr[0]					= '\0';
	 rl_rep_inpatient_yn.arr[0]						= '\0';
	 rl_rep_outpatient_yn.arr[0]					= '\0';
	 rl_rep_referral_yn.arr[0]						= '\0';
	 rl_rep_external_yn.arr[0]						= '\0';

     l_fax_disch_pat_result.arr[0]					= '\0';
	 rl_fax_inpatient_yn.arr[0]						= '\0';
	 rl_fax_outpatient_yn.arr[0]					= '\0';
	 rl_fax_referral_yn.arr[0]						= '\0';
	 rl_fax_external_yn.arr[0]						= '\0';

     l_mail_disch_pat_result.arr[0]					= '\0';
	 rl_mail_inpatient_yn.arr[0]					= '\0';
	 rl_mail_outpatient_yn.arr[0]					= '\0';
	 rl_mail_referral_yn.arr[0]						= '\0';
	 rl_mail_external_yn.arr[0]						= '\0';

	 rl_print_test_name_in_contd_page.arr[0]		= '\0';

	 rl_report_format.arr[0]						= '\0';
	 rl_alt_id_for_pat_id.arr[0]					= '\0';
	 rl_print_mic_sign_yn.arr[0]					= '\0';

	 rl_print_mic_sign_yn.len						= 0;

     l_print_disch_pat_result.len                   = 0;
	 rl_print_inpatient_yn.len						= 0;
	 rl_print_outpatient_yn.len						= 0;
	 rl_print_referral_yn.len						= 0;
	 rl_print_external_yn.len						= 0;

     l_rep_disch_pat_result.len						= 0;
	 rl_rep_inpatient_yn.len						= 0;
	 rl_rep_outpatient_yn.len						= 0;
	 rl_rep_referral_yn.len							= 0;
	 rl_rep_external_yn.len							= 0;

     l_fax_disch_pat_result.len						= 0;
	 rl_fax_inpatient_yn.len						= 0;
	 rl_fax_outpatient_yn.len						= 0;
	 rl_fax_referral_yn.len							= 0;
	 rl_fax_external_yn.len							= 0;

     l_mail_disch_pat_result.len					= 0;
	 rl_mail_inpatient_yn.len						= 0;
	 rl_mail_outpatient_yn.len						= 0;
	 rl_mail_referral_yn.len						= 0;
	 rl_mail_external_yn.len						= 0;

	 rl_print_test_name_in_contd_page.len			= 0;

	 rl_report_format.len							= 0;
	 rl_alt_id_for_pat_id.len						= 0;

     l_print_health_card_yn.arr[0]					= '\0';
     l_print_health_card_yn.len						= 0;

     test_desc_fill_for_report.arr[0]				= '\0';
	 test_desc_fill_for_report.len					= 0;
	 rl_hmc_yn.arr[0]								='\0';   /// 30.05.2005
	 rl_hmc_yn.len                                  = 0;


/********************* 22.06.2003 
     EXEC SQL SELECT result_rep_pg_len, NVL(print_disch_pat_result_yn, 'N'),
					NVL(print_inpatient_yn, 'N'), NVL(print_outpatient_yn, 'N'), 
					NVL(print_referral_yn, 'N'), NVL(print_external_yn, 'N'),
					NVL(report_format, '1'), NVL(print_health_card_yn, 'N')
			  INTO :page_length, :l_print_disch_pat_result,
				   :rl_print_inpatient_yn, :rl_print_outpatient_yn,
				   :rl_print_referral_yn, :rl_print_external_yn,
				   :rl_report_format, :l_print_health_card_yn 
			  FROM RL_PARAM;
********************/

     EXEC SQL SELECT NVL(report_format, '1'), NVL(print_health_card_yn, 'N'), 
					 test_desc_fill_for_report, NVL(hmc_yn,'N')
			  INTO  :rl_report_format, :l_print_health_card_yn , 
				    :test_desc_fill_for_report, :rl_hmc_yn
			  FROM   RL_PARAM;

     if (OERROR)
        ins_message(ORA_MESG,"Error Found in RL_PARAM");

	  if(NOT_FOUND) 
         ins_message(ORA_MESG,"Select failed on RL_PARAM --> No Data Found");

     {
		 EXEC SQL SELECT nvl(a.result_rep_pg_len,b.result_rep_pg_len),
	 					 nvl(a.print_disch_pat_result_yn,b.print_disch_pat_result_yn), 
						 nvl(a.print_inpatient_yn,b.print_inpatient_yn),
						 nvl(a.print_outpatient_yn,b.print_outpatient_yn),
						 nvl(a.print_referral_yn,b.print_referral_yn),
						 nvl(a.print_external_yn,b.print_external_yn),
						 NVL(B.mapped_alt_id_for_pat_id, '!'),

	 					 nvl(a.REP_PRINT_FOR_DISCH_YN,b.REP_PRINT_FOR_DISCH_YN), 
						 nvl(a.rep_inpatient_yn,b.rep_inpatient_yn),
						 nvl(a.rep_outpatient_yn,b.rep_outpatient_yn),
						 nvl(a.rep_referral_yn,b.rep_referral_yn),
						 nvl(a.rep_external_yn,b.rep_external_yn),

	 					 nvl(a.FAX_FOR_DISCH_YN,b.FAX_FOR_DISCH_YN), 
						 nvl(a.fax_inpatient_yn,b.fax_inpatient_yn),
						 nvl(a.fax_outpatient_yn,b.fax_outpatient_yn),
						 nvl(a.fax_referral_yn,b.fax_referral_yn),
						 nvl(a.fax_external_yn,b.fax_external_yn),

						 nvl(a.print_test_name_in_contd_page,b.print_test_name_in_contd_page),

	 					 nvl(a.email_FOR_DISCH_YN,b.email_FOR_DISCH_YN), 
						 nvl(a.email_inpatient_yn,b.email_inpatient_yn),
						 nvl(a.email_outpatient_yn,b.email_outpatient_yn),
						 nvl(a.email_referral_yn,b.email_referral_yn),
						 nvl(a.email_external_yn,b.email_external_yn),
						 nvl(a.rep_mic_yn,b.rep_mic_yn),
						 nvl(a.print_mic_sign_yn,'N')
				  INTO  :page_length, :l_print_disch_pat_result,
					    :rl_print_inpatient_yn, :rl_print_outpatient_yn,
					    :rl_print_referral_yn, :rl_print_external_yn,
						:rl_alt_id_for_pat_id,

						:l_rep_disch_pat_result,
					    :rl_rep_inpatient_yn, :rl_rep_outpatient_yn, 
					    :rl_rep_referral_yn, :rl_rep_external_yn,

						:l_fax_disch_pat_result,
					    :rl_fax_inpatient_yn, :rl_fax_outpatient_yn, 
					    :rl_fax_referral_yn, :rl_fax_external_yn,

						:rl_print_test_name_in_contd_page,

						:l_mail_disch_pat_result,
					    :rl_mail_inpatient_yn, :rl_mail_outpatient_yn,
					    :rl_mail_referral_yn, :rl_mail_external_yn,
						:rl_mic_to_print_yn,
						:rl_print_mic_sign_yn
				  FROM   RL_PARAM_FOR_FACILITY A , RL_PARAM B
				  WHERE  OPERATING_FACILITY_ID = :nd_operating_facility_id;

 		 if(NODATAFOUND)
		 {
		 EXEC SQL SELECT result_rep_pg_len, NVL(print_disch_pat_result_yn, 'N'),
						NVL(print_inpatient_yn, 'N'), NVL(print_outpatient_yn, 'N'), 
						NVL(print_referral_yn, 'N'), NVL(print_external_yn, 'N'),
						NVL(mapped_alt_id_for_pat_id, '!'),

	 					 nvl(REP_PRINT_FOR_DISCH_YN,'N'), 
						 nvl(rep_inpatient_yn,'N'),
						 nvl(rep_outpatient_yn,'N'),
						 nvl(rep_referral_yn,'N'),
						 nvl(rep_external_yn,'N'),

	 					 nvl(FAX_FOR_DISCH_YN,'N'), 
						 nvl(fax_inpatient_yn,'N'),
						 nvl(fax_outpatient_yn,'N'),
						 nvl(fax_referral_yn,'N'),
						 nvl(fax_external_yn,'N'),

						 nvl(print_test_name_in_contd_page,'N'),

	 					 nvl(email_FOR_DISCH_YN,'N'), 
						 nvl(email_inpatient_yn,'N'),
						 nvl(email_outpatient_yn,'N'),
						 nvl(email_referral_yn,'N'),
						 nvl(email_external_yn,'N'),
						 nvl(rep_mic_yn,'N')
				  INTO :page_length, :l_print_disch_pat_result,
					   :rl_print_inpatient_yn, :rl_print_outpatient_yn,
					   :rl_print_referral_yn, :rl_print_external_yn,
					   :rl_alt_id_for_pat_id,

						:l_rep_disch_pat_result,
					    :rl_rep_inpatient_yn, :rl_rep_outpatient_yn,
					    :rl_rep_referral_yn, :rl_rep_external_yn,

						:l_fax_disch_pat_result,
					    :rl_fax_inpatient_yn, :rl_fax_outpatient_yn,
					    :rl_fax_referral_yn, :rl_fax_external_yn,

						:rl_print_test_name_in_contd_page,

						:l_mail_disch_pat_result,
					    :rl_mail_inpatient_yn, :rl_mail_outpatient_yn,
					    :rl_mail_referral_yn, :rl_mail_external_yn,
						:rl_mic_to_print_yn
				  FROM RL_PARAM;
		 }

     }

     if (OERROR)
        ins_message(ORA_MESG,"Error Found in RL_PARAM"); 

	  if(NOT_FOUND) 
         ins_message(ORA_MESG,"Select failed on RL_PARAM --> No Data Found");

	 l_print_disch_pat_result.arr[l_print_disch_pat_result.len]      = '\0';
	 rl_print_inpatient_yn.arr[rl_print_inpatient_yn.len]			 = '\0';
	 rl_print_outpatient_yn.arr[rl_print_outpatient_yn.len]			 = '\0';
	 rl_print_referral_yn.arr[rl_print_referral_yn.len]				 = '\0';
	 rl_print_external_yn.arr[rl_print_external_yn.len]				 = '\0';

	 l_rep_disch_pat_result.arr[l_rep_disch_pat_result.len]      = '\0';
	 rl_rep_inpatient_yn.arr[rl_rep_inpatient_yn.len]			 = '\0';
	 rl_rep_outpatient_yn.arr[rl_rep_outpatient_yn.len]			 = '\0';
	 rl_rep_referral_yn.arr[rl_rep_referral_yn.len]				 = '\0';
	 rl_mic_to_print_yn.arr[rl_mic_to_print_yn.len]				 = '\0';

	 l_fax_disch_pat_result.arr[l_fax_disch_pat_result.len]      = '\0';
	 rl_fax_inpatient_yn.arr[rl_fax_inpatient_yn.len]			 = '\0';
	 rl_fax_outpatient_yn.arr[rl_fax_outpatient_yn.len]			 = '\0';
	 rl_fax_referral_yn.arr[rl_fax_referral_yn.len]				 = '\0';
	 rl_fax_external_yn.arr[rl_fax_external_yn.len]				 = '\0';

	 rl_print_test_name_in_contd_page.arr[rl_print_test_name_in_contd_page.len]	 = '\0';

	 l_mail_disch_pat_result.arr[l_mail_disch_pat_result.len]	     = '\0';
	 rl_mail_inpatient_yn.arr[rl_mail_inpatient_yn.len]				 = '\0';
	 rl_mail_outpatient_yn.arr[rl_mail_outpatient_yn.len]			 = '\0';
	 rl_mail_referral_yn.arr[rl_mail_referral_yn.len]				 = '\0';
	 rl_mail_external_yn.arr[rl_mail_external_yn.len]				 = '\0';
	 rl_mail_external_yn.arr[rl_mail_external_yn.len]				 = '\0';

	 rl_print_mic_sign_yn.arr[rl_print_mic_sign_yn.len]				 = '\0';

	 rl_report_format.arr[rl_report_format.len]						 = '\0';
	 l_print_health_card_yn.arr[l_print_health_card_yn.len]			 = '\0';
	 rl_alt_id_for_pat_id.arr[rl_alt_id_for_pat_id.len]				 = '\0';
	 test_desc_fill_for_report.arr[test_desc_fill_for_report.len]	 = '\0';
	 rl_hmc_yn.arr[rl_hmc_yn.len]									 = '\0';


 }

/*----------------------------------------------------------*/
/******************************* 22.06.2003 this is not required
get_sleep_secs()
{
    d_sleep_secs.arr[0] = '\0';
	d_machine_name.arr[0] = '\0';
	d_started_by_id.arr[0] = '\0';
	d_next_start_date.arr[0]='\0';

	d_sleep_secs.len		= 0;
	d_machine_name.len		= 0;
	d_started_by_id.len		= 0;
	d_next_start_date.len	= 0;

	_flushall();

	get_restart_time(); 	

    EXEC SQL  SELECT	processing_interval ,
						floor((sysdate-started_date)*24*60),
						machine_name,
						started_by_id,
						to_char(sysdate,'ddmmyyyyhh24miss'),
						to_number(to_char(sysdate,'hh24mi'))
				INTO	:d_sleep_secs,
						:d_time_interval,
						:d_machine_name,
						:d_started_by_id,
						:d_next_start_date,
						:d_starting_time
				FROM	SY_BG_PROCESS_CONTROL
				WHERE	PGM_ID = 'RLRRSENQ'
				AND		STARTED_DATE IS NOT NULL
				AND		STARTED_DATE = TO_DATE(:prg_start_date,	'DDMMYYHH24MISS');

    d_sleep_secs.arr[d_sleep_secs.len] = '\0';
	d_machine_name.arr[d_machine_name.len] = '\0';
	d_started_by_id.arr[d_started_by_id.len] = '\0';
	d_next_start_date.arr[d_next_start_date.len]='\0';

    
//     if((d_time_interval > RESTART_INTERVAL) && (d_starting_time == RESTART_TIME))

//	if (((d_time_interval > RESTART_INTERVAL) && (d_starting_time == l_restart_time)) || request_count > 25)

	if ((d_time_interval > RESTART_INTERVAL) && (d_starting_time == l_restart_time))
	{
		
		request_count = 1;
	    
		{
////////////////// the below sql commented old
	     EXEC SQL
			INSERT INTO SY_BG_PROCESS_CONTROL
			VALUES(	
			        :nd_operating_facility_id,
					'RL',
					'RLRRSENQ',
					'Lab Print Server',
					:d_machine_name,
					:d_started_by_id,
					TO_DATE(:d_next_start_date, 'ddmmyyyyhh24miss'),
					3000,
					'Y');
////////////////// upto here
	     EXEC SQL
			INSERT INTO SY_BG_PROCESS_CONTROL
			VALUES(	
			        :nd_operating_facility_id,
					'RLRRSENQ',
					:d_machine_name,
					:d_started_by_id,
					TO_DATE(:d_next_start_date, 'ddmmyyyyhh24miss'),
					'Y',
					 '~~');

		  if (OERROR) 
		  {
					disp_message(ORA_MESG,"insert failed");  
		  }
 
		}

		EXEC SQL
			DELETE FROM SY_BG_PROCESS_CONTROL 
				WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND PGM_ID='RLRRSENQ'
				AND STARTED_DATE IS NOT NULL
				AND STARTED_DATE=TO_DATE(:prg_start_date,
		                           'DDMMYYHH24MISS');

    	EXEC SQL COMMIT;


		d_cmd_line.arr[0] = '\0';

        strcat(d_cmd_line.arr,"RLRRSENQ");
		strcat(d_cmd_line.arr," ");
		strcat(d_cmd_line.arr,d_user_id_pwd.arr);
		strcat(d_cmd_line.arr," ");
		strcat(d_cmd_line.arr,d_next_start_date.arr);


		d_cmd_line.arr[strlen(d_cmd_line.arr)] = '\0';		
/////// IN WINDOWS 2000 SYSTEM COMMAND WILL NOT GIVE BACK THE CONTROL ////////	
//		system(d_cmd_line.arr);

		WinExec(d_cmd_line.arr, SW_SHOWNORMAL);	        
        exit(0);

		
	}

	if(NOT_FOUND) 
	{
		  return FALSE;
	}
	else 
	{
		d_sleep_secs.arr[d_sleep_secs.len] = '\0';
        sleep_sec = (DWORD) atol(d_sleep_secs.arr);  
	    return TRUE;
	}    
}
**********************************/

/*----------------------------------------------------------*/
char *to_day()
{

today.arr[0]	= '\0';
today.len	= 0;

EXEC SQL SELECT 	to_char(SYSDATE,'DD/MM/YYYY HH24:MI')
	   INTO		:today
	   FROM		DUAL;

   if (OERROR)
     ins_message(ORA_MESG,"Select failed on DUAL in to_day() ");

today.arr[today.len]	= '\0';
return (today.arr);
}
/*----------------------------------------------------------*/
process_rec1()
{  
   int i = 0;
   int j = 0,corr_stat = 0;
   int sy_prg_param_found =0;
   int record_exist = 0;
   char test[11],group_test[11];
   _flushall();
//disp_message(ERR_MESG,"in process rec1 begin");
   request_count = 1;

		/*********************************************************/
		   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN PROCESS_REC1......");
			write_to_file();
		   }
		/*********************************************************/

	declare_curs();
    
	declare_param_curs();
 
		/*********************************************************/
		   //if (strcmp(l_file_exists.arr,"Y")==0)
		if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN PROCESS_REC1...1...");
			write_to_file();
		   }
		/************************************************************/
	while(fetch_param_curs()) 
	{
		  get_company_name();  //// 16.01.2006
	      get_len_from_param();

		  get_operational_flags();  /// 10.04.2006
		  get_screen_donor_id();    /// 10.04.2006
		  get_screen_patient_id();  /// 10.04.2006



		  if (strcmp(rl_report_format.arr, "1") == 0)
			  MAX_LINES = (page_length - 5) ; 
		  else
		  {
   		    if ((strcmp(rl_report_format.arr, "2") == 0 ||strcmp(rl_report_format.arr, "4") == 0 
			    )    && (p_param8.arr[0] == 'P') )

			    MAX_LINES = (page_length - 8) ; 
			else if ( (strcmp(rl_report_format.arr, "6") == 0 || strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0) 
						&& (p_param8.arr[0] == 'P') )
			    MAX_LINES = (page_length - 11) ; 
			else if (strcmp(rl_report_format.arr, "6") == 0 || strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0)
			    MAX_LINES = (page_length - 10) ; 
			else
				MAX_LINES = (page_length - 7) ; 
		  }

		  l_should_print_yn = 'N';
		  d_interval_specimen_yn = 'N';

//		  if(fetch_sy_prog_param())
		  if(fetch_sy_requests())
		  {
			 err_flag = 0;
             lctr = 0;
             pctr = 0;
             rec_ctr = 0;
	         copy = 0;

			strcpy(actual_specimen.arr, nd_spec_no.arr);
		 	actual_specimen.len = strlen(actual_specimen.arr);

			 if (p_param8.arr[0] == 'P')
			 {
				strcpy(nd_status.arr, "P");
				nd_status.len = strlen(nd_status.arr);
			 }
			 else
			 {
				strcpy(nd_status.arr, "R");
				nd_status.len = strlen(nd_status.arr);
			 }
			 
/******---------------- added the below on 21.05.2005 ---------- */
			 get_result_printed_date(); 
			 get_departmental_parameters();
			 get_user_conf_access_yn();  /// 28.09.2006 
///			 if (strcmp(draft_printing_yn.arr, "N") == 0)
//			 {  // 1
				 if (strcmp(rl_sectn_report_entire_spec_yn.arr,"Y") == 0)
				 {  // 2
				   if (rl_hdr_result_printed_date.len && (strcmp(rl_hdr_status.arr,"R") == 0 ||
			  											  strcmp(rl_hdr_status.arr,"P") == 0
														 ) )
				   {
					  strcpy(nd_status.arr, "P"); 
					  nd_status.len = strlen(nd_status.arr);				   
					}

					get_tst_rslt_max_reviewed_date(); 

					strcpy(l_report_legend.arr, "");   ///// 27.07.2005
					l_report_legend.arr[0] = '\0';  
					l_report_legend.len    = 0;

					if(!rl_hdr_result_printed_date.len)
					{
					  if(strcmp(rl_hdr_status.arr,"R") != 0 &&
  												strcmp(rl_hdr_status.arr,"P") != 0)
						//strcpy(l_report_legend.arr,"Interim         ");
						strcpy(l_report_legend.arr,local_legend[33]);//added for globalisation
					}
					else if(rl_hdr_result_printed_date.len) 
					{ // 3
					  if(strcmp(rl_hdr_status.arr,"R") == 0 ||
  												strcmp(rl_hdr_status.arr,"P") == 0)
					  {  
						strcpy(l_report_legend1.arr, local_legend[34]);//added for globalisation
						strcpy(l_report_legend2.arr, local_legend[35]);//added for globalisation
						EXEC SQL EXECUTE
							begin
								if to_date(:rl_tst_rslt_max_rev_date,'dd/mm/yyyy hh24:mi:ss') <= to_date(:rl_hdr_result_printed_date,'dd/mm/yyyy hh24:mi:ss') then
								   //:l_report_legend := 'Final           ';
								   :l_report_legend := :l_report_legend1;//added for globalisation
								elsif to_date(:rl_tst_rslt_max_rev_date,'dd/mm/yyyy hh24:mi:ss') > to_date(:rl_hdr_result_printed_date,'dd/mm/yyyy hh24:mi:ss') then
								   //:l_report_legend := 'Amended Final ';
								   :l_report_legend := :l_report_legend2;//added for globalisation
								end if;

							end;
						END-EXEC;
					   }					  
					   else if(strcmp(rl_hdr_status.arr,"R") != 0 &&
  												strcmp(rl_hdr_status.arr,"P") != 0)
						   strcpy(l_report_legend.arr,"Amended         ");
						   strcpy(l_report_legend.arr, local_legend[36]);//added for globalisation

					 } //3

/// 18.08.2005					 l_report_legend.len = strlen(l_report_legend.arr);

					 l_report_legend.arr[l_report_legend.len] = '\0';  // 18.08.2005


				 }  //2
/// 			 }  // 1
/******---------------- upto here added  on 21.05.2005 ------------- */

			/*********************************************************/
			if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN PROCESS_REC1...2...");
				write_to_file();
			   }
			/************************************************************/

			 build_table();

			 if(strcmp(d_episode_type.arr,"R") == 0 || strcmp(d_episode_type.arr,"H") == 0)
				check_neonate_mother_spec_yn(); ///////// 19.10.2005

			 build_cancelled_tests();

			 declare_tst_result_curs();
			 strcpy(nd_test_code, "");

  		     something_to_print = 0;  
			 other_than_comments = 0;
 
				/*********************************************************/
				if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
				   {

					l_text.arr[0]		    = '\0';
					l_text.len            = 0;
					strcpy(l_text.arr,"IN PROCESS_REC1...3...");
					write_to_file();
				   }
				/************************************************************/


		if (l_should_print_yn == 'Y')
		{

             open_hdr();
			 _flushall();

             while (fetch_hdr() && err_flag == 0)
             {   
				 _flushall();

				 convert_dates_to_local_lang();

				 gen_file_name1();

				  if (err_flag)
					break;

				 print_c_hist = 0;
/// 21.05.2005   get_departmental_parameters();
                 source_copies = 0;
                 local_copies = 0;
	             strcpy(c_spec_no.arr,nd_spec_no.arr);
                 c_spec_no.len = strlen(nd_spec_no.arr);
                 fetch_other_dtls();
                 fetch_dtl();
  
					/*********************************************************/
					if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
					   {
    
						l_text.arr[0]		    = '\0';
						l_text.len            = 0;
						strcpy(l_text.arr,"IN PROCESS_REC1...4...");
						write_to_file();
					   }
					/************************************************************/


				 while(TRUE)
                 {
                     copy++;
					 open_tst_result_curs();
					 strcpy(prev_group_test,"");
                     rec_ctr = 0;
                     fflush(fp);

					if (err_flag != 0) 
					{
					
						break; 
					}

	                 i = fetch_tst_result();

	                 if(i)
					 {
                       
					   last_page = 0;
					   strcpy(first_user.arr, rl_released_by_id.arr);
					   first_user.len = strlen(first_user.arr);

					EXEC SQL EXECUTE
						DECLARE
							t_date   date;
						BEGIN
							//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_released_date,'DD/MM/YYYY hh24:mi'), :language_id , t_date);
							//:rl_released_date1 := to_char(t_date,'DD/MM/YYYY hh24:mi');
							:rl_released_date1 :=sm_convert_datetime_2t(to_date(:rl_released_date,'DD/MM/YYYY HH24:MI'),:language_id);
						END;
					END-EXEC;
					   //strcpy(footer_released_date, rl_released_date.arr);
					   strcpy(footer_released_date, rl_released_date1.arr);
					 }

					   if (strcmp(rl_report_format.arr, "1") == 0)
					   {
//qatar
							print_header();
						}
					   else if (strcmp(rl_report_format.arr, "2") == 0)
					   {
//kn
							print_header2();
					   }
					   else if (strcmp(rl_report_format.arr, "4") == 0 || strcmp(rl_report_format.arr, "5") == 0 )
					   {
//ml 
							print_header4();
					   }
					   else if (strcmp(rl_report_format.arr, "7") == 0 )
					   {
//MAFRAQ 
							print_header7();
					   }

					   else if (strcmp(rl_report_format.arr, "6") == 0 )
					   {
//ARTEMIS 
							print_header6();
					   }
					   else
					   {
//mf & su
							print_header3();
					   }

						
					   _flushall();

					 set_printed_date_time();
                  
				  

                     while (i && err_flag == 0)
                     {

	                     group_printed = 0;
	                     group = 0;
                         strcpy(group_test, rl_tst_group_test_code.arr);
                         strcpy(test,rl_tst_test_code.arr);
	                     if(strcmp(group_test,test) !=0)
  		                    group = 1;

/******** added the below on 21.05.2005 *****************************/
						  
						  check_profile_yn(rl_tst_group_test_code.arr);

						  c_count_profile.arr[0]	='\0';
						  c_count_profile.len		= 0;   

						  if(rl_tst_cd_profile_yn.arr[0] == 'Y' && strcmp(draft_printing_yn.arr, "N") == 0)
						  {
							if(p_param8.arr[0] != 'P')  
							{
							  
								EXEC SQL SELECT NVL(COUNT(*),0)  
										 INTO	c_count_profile
										 FROM   RL_TEST_RESULT
										 WHERE  SPECIMEN_NO = TO_NUMBER(:nd_spec_no)
										 AND    OPERATING_FACILITY_ID = :nd_operating_facility_id
										 AND    GROUP_TEST_CODE = :rl_tst_group_test_code
////27.07.2005										 AND    NVL(STATUS,'O') = 'R';
										 AND    ( NVL(STATUS,'O') IN ('R',:nd_status)
													OR NVL(PRELIMINARY_RELEASE_YN,'N') = 'Y');  // 22.08.2006


								if(NODATAFOUND);
								if (OERROR)
									  ins_message(ORA_MESG,"Failed at Select RL_TEST_RESULT in print_dtls()");

								c_count_profile.arr[c_count_profile.len] ='\0';
							}
							else 
							{
							   strcpy(c_count_profile.arr,"1");
							   c_count_profile.len =  strlen(c_count_profile.arr);
							}
						  }
						  else
						  {
							   strcpy(c_count_profile.arr,"1");
							   c_count_profile.len =  strlen(c_count_profile.arr);
						  }

/*************************** upto here added on 21.05.2005 ******************/


                         while(i && strcmp(group_test,rl_tst_group_test_code.arr)==0 && err_flag == 0)
	                     {  

			 	             strcpy(c_spec_no.arr,nd_spec_no.arr);
			                 c_spec_no.len = strlen(c_spec_no.arr);

		                     test_printed = 0;
                             rec_ctr ++;

							 test_contd = 0;	// 19.03.2005

                             print_dtls();

							 test_contd = 1;	// 19.03.2005

                             update_tst_result();
 							 update_interval_specimen();
						     update_rl_request_detail();
							 update_rl_request_header();

                             i = fetch_tst_result();

							 other_than_comments = 0;
                         }
                      }
                      
                      if (rec_ctr && err_flag == 0)
                      {
						   print_cancelled_tests();

                          last_page = 1;

/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
			if (strcmp(l_customer_id.arr, "AMRI") == 0)
			{
			  print_end_of_report();
			 }

                          for (i=lctr;i<=MAX_LINES;i++)
                               fprintf(fp,"\n");


						  if (strcmp(rl_report_format.arr, "1") == 0)
								print_footer(0);
						  else if (strcmp(rl_report_format.arr, "2") == 0)
								print_footer2(0);
						  else if (strcmp(rl_report_format.arr, "4") == 0)
								print_footer4(0);
						  else if (strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0)
								print_footer5(0);
						  else if (strcmp(rl_report_format.arr, "6") == 0 )
								print_footer6(0);
						  else 
								print_footer3(0);

                      }
                      if (rl_hdr_extra_copies_to.len && copy == 1 && err_flag == 0)
	                  {   
					      fclose(fp);  /* Close the Main file */
						  _flushall();
						  strcpy(nd_test_code, "");
   	                      gen_extra_file_name1();

		  				  if (err_flag)
								break;


	                      pctr = 0;
	                  }
                      else 
	                      break; 
                   }
   	               fclose(fp); /* Close the Main File if no Extra File,
								   else the Extra File */
			       _flushall();



				   if (err_flag == 0)
				   {
						create_lab_file_name();

						print_job1();
					}
				   _flushall();

				   if(err_flag)
				   {
				      update_sy_bg_rep_gen_req();
					}
				   else
				   {

					  delete_sy_bg_rep_gen_req();
					  delete_sy_prog_param(); 
                   }
				break;  //// 11.04.2005 
                }
			 }
			 else
			 {
  			    delete_sy_bg_rep_gen_req();
			    delete_sy_prog_param();

			 }
                close_all_cur(); 
			
				if(err_flag)
					update_sy_bg_rep_gen_req();

				delete_build_table();

                EXEC SQL COMMIT WORK;

		     }
			 else
			 {
//				delete_sy_bg_rep_gen_req();
				delete_sy_prog_param();
				EXEC SQL COMMIT WORK;
			 }

			 record_exist = 0;

 	

			 request_count++;

		 _flushall();
		 fflush(NULL);	 
		fflush(stdin);
	}
	close_param_curs();

}
/*------------------------------------------------------------*/
process_rec()
{  
   int i = 0;
   int j = 0,corr_stat = 0;
   int sy_prg_param_found =0;
   int record_exist = 0;
   char test[11],group_test[11];  
   _flushall();
//disp_message(ERR_MESG,"in process rec begin");
   request_count = 1;

  //sprintf(string_var,"DEBUG IN REC %s",l_debug_yn.arr);
   //disp_message(ERR_MESG,string_var);
/*-----------------------------------*/
		/*********************************************************/
		if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN PROCESS_REC......");
			write_to_file();
		   }
		/************************************************************/
	declare_curs();


	while(request_count < 20)
	{

	   strcpy(draft_printing_yn.arr, "N");
	   draft_printing_yn.len = strlen(draft_printing_yn.arr);

      if(strcmp(nd_priority.arr, "1") == 0)
      {
       record_exist = fetch_sy_urgent();
	   close_urgent_curs();

       if (!record_exist)
	   {
	   	  record_exist = fetch_sy_stat();
		  close_stat_curs();
        }
	  }
	  else if (strcmp(nd_priority.arr, "2") == 0 || strcmp(nd_priority.arr, "3") == 0 )
	   {	   
     	  record_exist = fetch_sy_routine();
          close_routine_curs();
	   }
	   else
	   {
        record_exist = fetch_sy_urgent();
	    close_urgent_curs();

        if (!record_exist)
	    {
	   	  record_exist = fetch_sy_stat();
		  close_stat_curs();
		}

	    if (!record_exist)
	    {
	   	   record_exist = fetch_sy_routine();
	       close_routine_curs();
	    }
       }
	  
			/*********************************************************/
			if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN PROCESS_REC...1...");
				write_to_file();
			   }
			/************************************************************/
	   if (record_exist == 0)
			break;

	   get_company_name();  //// 16.01.2006

       while (record_exist)
       {

          get_len_from_param();


		  if (strcmp(rl_report_format.arr, "1") == 0)
			  MAX_LINES = (page_length - 5) ; 
		  else
		  {
   		    if ((strcmp(rl_report_format.arr, "2") == 0 || strcmp(rl_report_format.arr, "4") == 0 
							) && (p_param8.arr[0] == 'P') )
			    MAX_LINES = (page_length - 8) ; 
			else if ((strcmp(rl_report_format.arr, "6") == 0 || strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0) 
							&& (p_param8.arr[0] == 'P') )
			    MAX_LINES = (page_length - 11) ; 
			else if (strcmp(rl_report_format.arr, "6") == 0 || strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0) 
			    MAX_LINES = (page_length - 10) ; 
			else
				MAX_LINES = (page_length - 7) ; 
		  }



		  l_should_print_yn = 'N';
		  d_interval_specimen_yn = 'N';

			/*********************************************************/
			if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;

				strcpy(l_text.arr,"IN PROCESS_REC...2...");
				write_to_file();
			   } 
			/************************************************************/
		  if(fetch_sy_prog_param())
		  {

			 err_flag = 0;
             lctr = 0;
             pctr = 0;
             rec_ctr = 0;
	         copy = 0;

			get_operational_flags(); /// 10.04.2006
			get_screen_donor_id();    /// 10.04.2006
			get_screen_patient_id();  /// 10.04.2006

 /********** decide whether the entry is an DRAFT COPY ********/
 	 		if (strcmp(p_param7.arr, "D") == 0)
			{
				strcpy(draft_printing_yn.arr, "Y");
				draft_printing_yn.len = strlen(draft_printing_yn.arr);
			}

 			strcpy(actual_specimen.arr, nd_spec_no.arr);
		 	actual_specimen.len = strlen(actual_specimen.arr);

			 if (p_param8.arr[0] == 'P')
			 {
				strcpy(nd_status.arr, "P");
				nd_status.len = strlen(nd_status.arr); 
			 }
			 else
			 {
				strcpy(nd_status.arr, "R");
				nd_status.len = strlen(nd_status.arr);
			 }

/******---------------- added the below on 21.05.2005 ---------- */
			 get_result_printed_date(); 
			 get_departmental_parameters();
			 get_user_conf_access_yn(); /// 28.09.2006

			 if (strcmp(draft_printing_yn.arr, "N") == 0)
			 {  // 1
				 if (strcmp(rl_sectn_report_entire_spec_yn.arr,"Y") == 0)
				 {  // 2
				   if (rl_hdr_result_printed_date.len && (strcmp(rl_hdr_status.arr,"R") == 0 ||
			  											  strcmp(rl_hdr_status.arr,"P") == 0
														 ) )
				   {
					  strcpy(nd_status.arr, "P"); 
					  nd_status.len = strlen(nd_status.arr);				   
					}

					get_tst_rslt_max_reviewed_date(); 

					strcpy(l_report_legend.arr, "");   //////// 27.07.2005
					l_report_legend.arr[0] = '\0';  
					l_report_legend.len    = 0;

					if(!rl_hdr_result_printed_date.len)
					{
					  if(strcmp(rl_hdr_status.arr,"R") != 0 &&
  												strcmp(rl_hdr_status.arr,"P") != 0)
						strcpy(l_report_legend.arr,"Interim         ");
					}
					else if(rl_hdr_result_printed_date.len) 
					{ // 3
					  if(strcmp(rl_hdr_status.arr,"R") == 0 ||
  												strcmp(rl_hdr_status.arr,"P") == 0)
					  {  
						strcpy(l_report_legend1.arr, local_legend[34]);//added for globalisation
						strcpy(l_report_legend2.arr, local_legend[35]);//added for globalisation

						EXEC SQL EXECUTE
							begin
								if to_date(:rl_tst_rslt_max_rev_date,'dd/mm/yyyy hh24:mi:ss') <= to_date(:rl_hdr_result_printed_date,'dd/mm/yyyy hh24:mi:ss') then
								   //:l_report_legend := 'Final           ';
									:l_report_legend := :l_report_legend1; //added for globalisation
								elsif to_date(:rl_tst_rslt_max_rev_date,'dd/mm/yyyy hh24:mi:ss') > to_date(:rl_hdr_result_printed_date,'dd/mm/yyyy hh24:mi:ss') then
								   //:l_report_legend := 'Amended Final ';
								   :l_report_legend := :l_report_legend2; //added for globalisation
								end if;

							end;
						END-EXEC;  
					   }					  
					   else if(strcmp(rl_hdr_status.arr,"R") != 0 &&
  												strcmp(rl_hdr_status.arr,"P") != 0)
						   //strcpy(l_report_legend.arr,"Amended         ");
						   strcpy(l_report_legend.arr,local_legend[36]);//added for globalisation

					 } //3

/// 18.08.2005			 l_report_legend.len = strlen(l_report_legend.arr);

					 l_report_legend.arr[l_report_legend.len] = '\0';  // 18.08.2005


				 }  //2
			 }  // 1
/******---------------- upto here added  on 21.05.2005 ------------- */

			/*********************************************************/
			if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN PROCESS_REC...3...");
				write_to_file();
			   }
			/************************************************************/
			 build_table();


			 if(strcmp(d_episode_type.arr,"R") == 0 || strcmp(d_episode_type.arr,"H") == 0)
				check_neonate_mother_spec_yn(); ///////// 19.10.2005

			 build_cancelled_tests();

			 declare_tst_result_curs();
			 strcpy(nd_test_code, "");



  		     something_to_print = 0;  
			 other_than_comments = 0;

		if (l_should_print_yn == 'Y')
		{

             open_hdr();
			 _flushall();

             while (fetch_hdr() && err_flag == 0)
             {   
				 _flushall();  

				convert_dates_to_local_lang();

				 gen_file_name();

				 if (err_flag)
					break;

				 print_c_hist = 0;
// 21.05.2005    get_departmental_parameters();
                 source_copies = 0;
                 local_copies = 0;
	             strcpy(c_spec_no.arr,nd_spec_no.arr);
                 c_spec_no.len = strlen(nd_spec_no.arr);
                 fetch_other_dtls();
                 fetch_dtl();

                 while(TRUE)
                 {

                     copy++;
					 open_tst_result_curs();
					 strcpy(prev_group_test,"");
					 strcpy(rl_tst_test_sub_sec_t.arr,"!!!!"); //added for GHL-CRF-0452-DD-01
					 strcpy(rl_grp_tst_test_sub_sec_t.arr,"!!!!");//GHL-CRF-0489
                     rec_ctr = 0;
                     fflush(fp);

	                 i = fetch_tst_result();

	                 if(i)
					 {
                       
					   last_page = 0;
					   strcpy(first_user.arr, rl_released_by_id.arr);
					   first_user.len = strlen(first_user.arr);

					EXEC SQL EXECUTE
						DECLARE
							t_date   date; 
						BEGIN
							//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_released_date,'DD/MM/YYYY hh24:mi'), :language_id , t_date);
							//:rl_released_date1 := to_char(t_date,'DD/MM/YYYY hh24:mi');
							:rl_released_date1 :=sm_convert_datetime_2t(to_date(:rl_released_date,'DD/MM/YYYY HH24:MI'),:language_id);
						END;
					END-EXEC;
					   //strcpy(footer_released_date, rl_released_date.arr);
					   strcpy(footer_released_date, rl_released_date1.arr);

					 }

					   if (strcmp(rl_report_format.arr, "1") == 0)
					   {
//qatar
							print_header();
						}
					   else if (strcmp(rl_report_format.arr, "2") == 0)
					   {
//kn
							print_header2();   

					   }
					   else if (strcmp(rl_report_format.arr, "4") == 0 || strcmp(rl_report_format.arr, "5") == 0)
					   {
//ml
							print_header4();

					   }
					   else if (strcmp(rl_report_format.arr, "7") == 0 )
					   {
//MAFRAQ
							print_header7();

					   }

					   else if (strcmp(rl_report_format.arr, "6") == 0 )
					   {
//ARTEMIS
							print_header6();

					   }
					   else
					   {
//mf & su
							print_header3();
					   }

						
					   _flushall();

					 set_printed_date_time();

                     while (i && err_flag == 0)
                     {

	                     group_printed = 0;
	                     group = 0;

                         strcpy(group_test, rl_tst_group_test_code.arr);
                         strcpy(test,rl_tst_test_code.arr);
	                     if(strcmp(group_test,test) !=0)
  		                    group = 1;
 
/******** added the below on 21.05.2005 *****************************/
						  
						  check_profile_yn(rl_tst_group_test_code.arr);

						  c_count_profile.arr[0]	='\0';
						  c_count_profile.len		= 0; 

						  if(rl_tst_cd_profile_yn.arr[0] == 'Y' && strcmp(draft_printing_yn.arr, "N") == 0)
						  {
							if(p_param8.arr[0] != 'P')  
							{
							  
								EXEC SQL SELECT NVL(COUNT(*),0)  
										 INTO	c_count_profile
										 FROM   RL_TEST_RESULT
										 WHERE  SPECIMEN_NO = TO_NUMBER(:nd_spec_no)
										 AND    OPERATING_FACILITY_ID = :nd_operating_facility_id
										 AND    GROUP_TEST_CODE = :rl_tst_group_test_code
///// 27.07.2005						 AND    NVL(STATUS,'O') = 'R';
										 AND    ( NVL(STATUS,'O') IN ('R',:nd_status)
													OR NVL(PRELIMINARY_RELEASE_YN,'N') = 'Y');  /// 22.08.2006

								if(NODATAFOUND);
								if (OERROR)
									  ins_message(ORA_MESG,"Failed at Select RL_TEST_RESULT in print_dtls()");

								c_count_profile.arr[c_count_profile.len] ='\0';
							}
							else  
							{
							   strcpy(c_count_profile.arr,"1");
							   c_count_profile.len =  strlen(c_count_profile.arr);
							}
						  }
						  else
						  {
							   strcpy(c_count_profile.arr,"1");
							   c_count_profile.len =  strlen(c_count_profile.arr);
						  }

/*************************** upto here added on 21.05.2005 ******************/


                         while(i && strcmp(group_test,rl_tst_group_test_code.arr)==0 && err_flag == 0)
	                     {  
 
			 	             strcpy(c_spec_no.arr,nd_spec_no.arr);
			                 c_spec_no.len = strlen(c_spec_no.arr);

		                     test_printed = 0;
                             rec_ctr ++;
							 test_contd = 0;	// 19.03.2005

								print_dtls();	
						
							 
							 test_contd = 1;  // 19.03.2005
							 

							 if (strcmp(draft_printing_yn.arr, "N") == 0)
							 {
								update_tst_result();
 								update_interval_specimen();
								update_rl_request_detail();
								update_rl_request_header();
							  }

                             i = fetch_tst_result();

							 other_than_comments = 0;
                         }
						 
		             }
                      
					  // REMOVED CODE FROM HERE BY MADHU 
					  
                      if (rec_ctr && err_flag == 0)
                      {
						   print_cancelled_tests();
						  /*added by madhusudhan for ml-mmoh-CRF-0332 */
								open_notify_type();
								print_notify_details();
							
						  /*added by madhusudhan for ml-mmoh-CRF-0332 */

                          last_page = 1;

			/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
				if (strcmp(l_customer_id.arr, "AMRI") == 0)
				{
					print_end_of_report();
				}


                          for (i=lctr;i<=MAX_LINES;i++)
                               fprintf(fp,"\n");

						  if (strcmp(rl_report_format.arr, "1") == 0)
								print_footer(0);
						  else if (strcmp(rl_report_format.arr, "2") == 0)
								print_footer2(0);
						  else if (strcmp(rl_report_format.arr, "4") == 0 )
								print_footer4(0);
						  else if (strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0	)
								print_footer5(0);
						  else  if (strcmp(rl_report_format.arr, "6") == 0 )
								print_footer6(0);
						  else
								print_footer3(0); 


                      }

					  if (strcmp(draft_printing_yn.arr, "N") == 0)
					  {
							if (rl_hdr_extra_copies_to.len && copy == 1 && err_flag == 0)
							{   
								fclose(fp);  /* Close the Main file */
								_flushall();
								strcpy(nd_test_code, "");
   								gen_extra_file_name();

			  				    if (err_flag)
									break;

								pctr = 0;
							}
							else 
								break; 
					  }
					  else
						break;
                   }
   	               fclose(fp); /* Close the Main File if no Extra File,
								   else the Extra File */

			       _flushall();

				   if (err_flag == 0)
				   {
						create_lab_file_name();
						print_job();
					}
				   _flushall(); 
				   if(err_flag)
				      update_sy_bg_rep_gen_req();
				   else
				   {
					  delete_sy_bg_rep_gen_req();
					  delete_sy_prog_param();
                   }
			    break;  //// 11.04.2005 
                }
			 }
			 else
			 {

  			    delete_sy_bg_rep_gen_req(); 
			    delete_sy_prog_param();

			 }
                close_all_cur(); 

				if(err_flag)
					update_sy_bg_rep_gen_req();

				delete_build_table();

                EXEC SQL COMMIT WORK;

		     }
			 else
			 {
				delete_sy_bg_rep_gen_req();
				EXEC SQL COMMIT WORK;
			 }

			 record_exist = 0;

         } 
		 request_count++;

		 _flushall();
		 fflush(NULL);	 
		fflush(stdin);
	}
			/*********************************************************/
			if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		  = '\0';
				l_text.len            = 0;

				strcpy(l_text.arr,"IN PROCESS_REC...LAST...");
				write_to_file();
			   }
			/************************************************************/

}
/*------------------------------------------------------------*/
update_sy_bg_rep_gen_req()
{
   EXEC SQL UPDATE SY_REPORT_GENERATE_REQUEST
               SET REQUEST_STATUS = 'E'
			 WHERE ROWID = :sy_rowid;
   if(OERROR) 
      ins_message(ERR_MESG,"Failed in upd_sy_bg_rep_gen_req()");       
}
/*------------------------------------------------------------*/
delete_sy_bg_rep_gen_req()
{
   char test[100];
   EXEC SQL DELETE FROM SY_REPORT_GENERATE_REQUEST
             WHERE ROWID = :sy_rowid;
   if(OERROR) 
      ins_message(ERR_MESG,"Failed in delete_sy_bg_rep_gen_req");
}
/*------------------------------------------------------------*/
delete_sy_prog_param()
{

  EXEC SQL DELETE FROM SY_PROG_PARAM
 	         WHERE rowid = :nd_rowid;

   if(OERROR) 
      ins_message(ERR_MESG,"Failed in delete_sy_prog_param");
}

/*------------------------------------------------------------*/

fetch_sy_bg_rep_gen_req_u()
{
sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';

sy_session_id.len	    = 0;
sy_user_id.len	        = 0;
sy_req_date.len         = 0;
sy_machine_name.len     = 0;
sy_ws_no.len            = 0;
sy_rowid.len            = 0;

EXEC SQL SELECT
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID
	       INTO	
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'U'
	        AND ROWNUM < 2;
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      if(NOT_FOUND) 
      	  return FALSE;
      else 
	  {
          sy_user_id.arr[sy_user_id.len] = '\0';
          sy_session_id.arr[sy_session_id.len] = '\0';
          sy_rowid.arr[sy_rowid.len] = '\0';
          sy_req_date.arr[sy_req_date.len] = '\0';
		  sy_machine_name.arr[sy_machine_name.len] = '\0';
		  sy_ws_no.arr[sy_ws_no.len] = '\0';
		  sy_rowid.arr[sy_rowid.len] = '\0';

   	      return TRUE;
	  }
}

fetch_sy_bg_rep_gen_req_s()
{
sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';

sy_session_id.len	    = 0;
sy_user_id.len	        = 0;
sy_req_date.len         = 0;
sy_machine_name.len     = 0;
sy_ws_no.len            = 0;
sy_rowid.len            = 0;

EXEC SQL SELECT
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID
	       INTO	
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'S'
	        AND ROWNUM < 2;
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      if(NOT_FOUND) 
      	  return FALSE;
      else 
	  {
          sy_user_id.arr[sy_user_id.len] = '\0';
          sy_session_id.arr[sy_session_id.len] = '\0';
          sy_rowid.arr[sy_rowid.len] = '\0';
          sy_req_date.arr[sy_req_date.len] = '\0';
		  sy_machine_name.arr[sy_machine_name.len] = '\0';
		  sy_ws_no.arr[sy_ws_no.len] = '\0';
		  sy_rowid.arr[sy_rowid.len] = '\0';

   	      return TRUE;
	  }
}

fetch_sy_bg_rep_gen_req()
{
sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';

sy_session_id.len	    = 0;
sy_user_id.len	        = 0;
sy_req_date.len         = 0;
sy_machine_name.len     = 0;
sy_ws_no.len            = 0;
sy_rowid.len            = 0;

EXEC SQL SELECT
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID
	       INTO	
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'R'
	        AND ROWNUM < 2;
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      if(NOT_FOUND) 
      	  return FALSE;
      else 
	  {
          sy_user_id.arr[sy_user_id.len] = '\0';
          sy_session_id.arr[sy_session_id.len] = '\0';
          sy_rowid.arr[sy_rowid.len] = '\0';
          sy_req_date.arr[sy_req_date.len] = '\0';
		  sy_machine_name.arr[sy_machine_name.len] = '\0';
		  sy_ws_no.arr[sy_ws_no.len] = '\0';
		  sy_rowid.arr[sy_rowid.len] = '\0';

   	      return TRUE;
	  }
}
/*------------------------------------------------------------*/

print_group_test_desc()
{
   int l_len = 0;
   int nctr;
   char group_result[16];
   p_print_name_yn.arr[0] = '\0';
   p_test_desc.arr[0]     = '\0';
   p_function_yn.arr[0]   = '\0';
   p_print_name_yn.len    = 0;
   p_test_desc.len        = 0;
   p_function_yn.len      = 0;

   p_significant_digit    = 0;  
   p_no_of_decimals       = 0;
if (strcmp(l_customer_id.arr, "MC") == 0) //added for KDAH-SCF-0546
{
   // substr added  by madhusudhan for GHL-SCF-1104
   EXEC SQL SELECT substr(b.LONG_DESC,1,38),NVL(a.PRINT_NAME_YN,'N'),NVL(a.FUNCTION_YN,'N'), 
		   a.SIGNIFICANT_DIGIT,a.NO_OF_DECIMALS
	    INTO   :p_test_desc,:p_print_name_yn,:p_function_yn,
		   :p_significant_digit,:p_no_of_decimals
	    FROM   rl_test_code a, RL_TEST_CODE_lang_vw b
	    WHERE  a.test_code = b.test_code
		and a.TEST_CODE = :rl_tst_group_test_code
		and b.language_id = :language_id;
}

else//added for KDAH-SCF-0546
{
EXEC SQL SELECT b.LONG_DESC,NVL(a.PRINT_NAME_YN,'N'),NVL(a.FUNCTION_YN,'N'), 
		   a.SIGNIFICANT_DIGIT,a.NO_OF_DECIMALS
	    INTO   :p_test_desc,:p_print_name_yn,:p_function_yn,
		   :p_significant_digit,:p_no_of_decimals
	    FROM   rl_test_code a, RL_TEST_CODE_lang_vw b
	    WHERE  a.test_code = b.test_code
		and a.TEST_CODE = :rl_tst_group_test_code
		and b.language_id = :language_id;

}
   if (OERROR)
      ins_message(ORA_MESG,"Select failed on table RL_TEST_CODE in print_group_test_desc");

   p_test_desc.arr[p_test_desc.len]    ='\0';
   p_print_name_yn.arr[p_print_name_yn.len]='\0';
   p_function_yn.arr[p_function_yn.len] = '\0';

   if(p_function_yn.arr[0] == 'Y')
   {
      group_result[0] = '\0';
      calc_func_and_prn(rl_tst_group_test_code.arr,group_result);
   }
      
   l_len = strlen(p_test_desc.arr);

   if(p_print_name_yn.arr[0] == 'Y')
   {
	  fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
      //fprintf(fp,"%-40s",p_test_desc.arr);
	  fprintf(fp, "%s", p_test_desc.arr);
      fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

	  fprintf(fp, "%-*s", 41 - l_len, " ");
   }

   if(p_function_yn.arr[0] == 'Y')
      if(strlen(group_result))
	  {
		/********* Numeric result is increased to 10 chrs length **/
//		 fprintf(fp,"%-5s",group_result);

		  strcpy(r_rslt.arr, group_result);
		  r_rslt.len = strlen(r_rslt.arr);
		  add_zero_after_result();
		  strcpy(group_result, r_rslt.arr);

         fprintf(fp,"%-10.10s",group_result);
	  }

   if(p_print_name_yn.arr[0] == 'Y' || strlen(group_result))
   {
      fprintf(fp,"\n");
      page_break(1);
   }

/*********** underline is added with printing of group test description ******
   if(p_print_name_yn.arr[0] == 'Y')
   {
      for(nctr = 0; nctr < p_test_desc.len; nctr++)
          fprintf(fp,"_");
	  fprintf(fp,"\n");

      page_break(1);
   } 
**************************** upto here ************/
}
/* Calculate result for the Group Test if a function is set on it.  */
float calculate_function_result(sd,dc)
int sd; int dc;
{
return 0;
}

/*------------------------------------------------------------*/
create_lab_file_name()
{
  source_copies = 1;

  /* Referral Patients and External Patients*/
  if (rl_hdr_episode_type.arr[0] == 'R' || rl_hdr_episode_type.arr[0] == 'H')  
  {
       source_copies = sy_ref_no_of_copies + 1;
/// 11.07.2004  strcpy(rl_prn_ctrl_hdr_source_code.arr,rl_prn_ctrl_hdr_section_code.arr);

	   strcpy(rl_prn_ctrl_hdr_source_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(rl_prn_ctrl_hdr_source_code.arr,rl_prn_ctrl_hdr_section_code.arr);  /// 11.07.2004

       rl_prn_ctrl_hdr_source_code.len = strlen(rl_prn_ctrl_hdr_source_code.arr);
  }

}
/*----------------------------------------------------------*/
print_job1()
{
char er_cd[10];
char print_yn = 'Y';
int i;

if(something_to_print == 1)
{

p_uid_pwd.arr[0] = '\0';
p_print_name.arr[0] = '\0';
p_loc_code.arr[0] = '\0';
p_loc_type.arr[0] = '\0';
p_rep_file.arr[0] = '\0';
p_print_mode.arr[0] = '\0';

p_uid_pwd.len = 0;
p_print_name.len = 0;
p_loc_code.len = 0;
p_loc_type.len = 0;
p_rep_file.len = 0;
p_print_mode.len = 0;


strcpy(p_uid_pwd.arr,uid_pwd.arr);
p_uid_pwd.len = strlen(uid_pwd.arr);

strcpy(p_print_name.arr,"RLRRSENQ");
p_print_name.len = strlen(p_print_name.arr);


if(rl_print_result_sect_yn.arr[0] == 'Y')
{
   strcpy(p_loc_type.arr,"O");
   p_loc_type.len = strlen(p_loc_type.arr);

/// 11.07.2004   strcpy(p_loc_code.arr,rl_hdr_section_code.arr); 

   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
   strcat(p_loc_code.arr,rl_hdr_section_code.arr);        /// 11.07.2004

   strcat(p_loc_code.arr,rl_hdr_episode_type.arr);

/***** Newly added for Urgent samples   *******/
   if (rl_printer_for_urgent_yn.arr[0] == 'Y')
   {
		if (rl_hdr_urgent_indicator.arr[0] != 'R')
			strcat(p_loc_code.arr, "U");
   }

   p_loc_code.len = strlen(p_loc_code.arr);

}
else
{

   strcpy(p_loc_code.arr,rl_prn_ctrl_hdr_source_code.arr);
/***** Newly added for Urgent samples   *******/
   if (rl_printer_for_urgent_yn.arr[0] == 'Y')
   {
		if (rl_hdr_urgent_indicator.arr[0] != 'R')
			strcat(p_loc_code.arr, "U");
   }

   p_loc_code.len = strlen(p_loc_code.arr);
	
   l_episode = 0;

   if ( (rl_hdr_episode_type.arr[0] == 'I') ||
		(rl_hdr_episode_type.arr[0] == 'O') )
   {

		EXEC SQL SELECT open_episode_id
		INTO :l_episode
		FROM IP_OPEN_EPISODE
		WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
		  AND patient_id = :nd_hosp_no;

		if(NODATAFOUND) 
		{

             if (rl_hdr_episode_type.arr[0] == 'I')
			 {
				if (strcmp(l_print_disch_pat_result.arr, "Y") == 0)
				{

			  	    print_yn = 'Y';
					strcpy(p_loc_type.arr, "W");
					p_loc_type.len = strlen(p_loc_type.arr);
					strcpy(p_loc_code.arr, rl_hdr_source_code.arr);
					p_loc_code.len = strlen(rl_hdr_source_code.arr);
				}
                else
                  print_yn = 'N';
			 }
			 else
			 {
				strcpy(p_loc_type.arr, "C");
				p_loc_type.len = strlen(p_loc_type.arr);
				print_yn = 'Y';

			 }

		}
		else
		{

			EXEC SQL SELECT  'W'
			INTO :p_loc_type
			FROM IP_EPISODE
			WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND episode_id = :l_episode
			AND patient_id = :nd_hosp_no;


			if(NODATAFOUND)
			{
			  strcpy(p_loc_type.arr, "C");
			  p_loc_type.len = strlen(p_loc_type.arr);
			  print_yn = 'Y';

			}

		}
		
		
   }
   else
   {
	  strcpy(p_loc_type.arr,"O");
	  print_yn = 'Y';

   }

/*****
   switch(rl_hdr_source_type.arr[0])
   {
      case 'W': strcpy(p_loc_type.arr,"W");
                break;
      case 'C': strcpy(p_loc_type.arr,"C");
                break;
      case 'E': strcpy(p_loc_type.arr,"O");
                break;
   }
**********/


   p_loc_type.len = strlen(p_loc_type.arr);

}

strcpy(p_rep_file.arr,nd_f_name);
p_rep_file.len = strlen(nd_f_name);

strcpy(p_print_mode.arr,"S");
p_print_mode.len = strlen(p_print_mode.arr);


/***** ADDED ON 12/07/2004   **************/
	if (p_param8.arr[0] == 'P')
		source_copies = 1;


switch(p_param7.arr[0])
{
   case 'L' :  /*-------To cater to pulling list---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr,"L");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'X':  /*-----To cater to confidential reports----*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr,"X");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'Z':  /*-----To cater to reprinting by Patient----*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr,"Z");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'Y' :  /*-------To cater to reprint of results while registration---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr, p_param7.arr);
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'D' :  /*-------To cater for Draft Copy ---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr, p_param7.arr);
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'A' :  /*-------To print Result Report of any facility from any facility ---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004		
       strcat(p_loc_code.arr,"A");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

}

if (strcmp(rl_hdr_urgent_indicator.arr, "U") == 0)
	print_yn = 'Y';


if (print_yn == 'Y')
{

/*******************/

	get_trans_ind();

	for( i = 0; i < source_copies; i++)
	{

      if (strcmp(nd_trx_ind.arr,"Y") == 0)


					 PrintDocument
						   (
							uid_pwd.arr,					//char	*PUidPwd;
							c_session_id.arr,				//char	*PSessionID;
							nd_operating_facility_id.arr,	//char	*PFacilityID;
							"RL",							//char	*PModuleID;
							"RLRRSENQ",						//char	*PDocumentID;
							nd_file_name.arr,				//char	*POnlinePrintFileNames;
							p_loc_type.arr,					//char	*PLocationTypes;
							p_loc_code.arr,					//char	*PLocationCodes;
							1,								//int 	 PNumOfCopies;
							1,								//int 	 PPageFrom;
							9999							//int	 PPageTo;
						   );
						   

	  else



					 PrintDocument
						   (
							uid_pwd.arr,					//char	*PUidPwd;
							c_session_id.arr,				//char	*PSessionID;
							nd_operating_facility_id.arr,	//char	*PFacilityID;
							"RL",							//char	*PModuleID;
							"RLRRSENQ",						//char	*PDocumentID;
							nd_file_name.arr,				//char	*POnlinePrintFileNames;
							p_loc_type.arr,					//char	*PLocationTypes;
							"",								//char	*PLocationCodes;
							1,								//int	 PNumOfCopies;
							1,								//int	 PPageFrom;
							9999							//int	 PPageTo;
						   );
						   


	}


/*-------------	EXTRA COPY ----------------*/

	if (rl_hdr_extra_copies_to.len)
	{

		strcpy(p_print_name.arr,"RLRSENQE");
		p_print_name.len = strlen(p_print_name.arr);

		strcpy(p_loc_type.arr,"O");
		p_loc_type.len = strlen(p_loc_type.arr);

		if(rl_print_result_sect_yn.arr[0] == 'Y') 
		{
/// 11.07.2004	strcpy(p_loc_code.arr,rl_hdr_section_code.arr); 

		    strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
		    strcat(p_loc_code.arr,rl_hdr_section_code.arr);        /// 11.07.2004

			strcat(p_loc_code.arr,rl_hdr_episode_type.arr);
			p_loc_code.len = strlen(p_loc_code.arr);
		}
		else
		{
/// 11.07.2004	strcpy(p_loc_code.arr,rl_prn_ctrl_hdr_section_code.arr);

		    strcpy(p_loc_code.arr,nd_operating_facility_id.arr);			/// 11.07.2004
		    strcat(p_loc_code.arr,rl_prn_ctrl_hdr_section_code.arr);        /// 11.07.2004

			p_loc_code.len = strlen(p_loc_code.arr);

		}

		strcpy(p_rep_file.arr,nd_e_name);

//// 12.10.2003		p_rep_file.len = strlen(nd_f_name);

		p_rep_file.len = strlen(p_rep_file.arr);  //// 12.10.2003


      if (strcmp(nd_trx_ind.arr,"Y") == 0) 

					 PrintDocument
						   (
							uid_pwd.arr,					//char	*PUidPwd;
							c_session_id.arr,				//char	*PSessionID;
							nd_operating_facility_id.arr,	//char	*PFacilityID;
							"RL",							//char	*PModuleID;
							"RLRSENQE",						//char	*PDocumentID;
							nd_file_name.arr,				//char	*POnlinePrintFileNames;
							p_loc_type.arr,					//char	*PLocationTypes;
							p_loc_code.arr,					//char	*PLocationCodes;
							1,								//int	 PNumOfCopies;
							1,								//int	 PPageFrom;
							9999							//int	 PPageTo;
						   );
						   
	  else

					 PrintDocument
						   (
							uid_pwd.arr,					//char	*PUidPwd;
							c_session_id.arr,				//char	*PSessionID;
							nd_operating_facility_id.arr,	//char	*PFacilityID;
							"RL",							//char	*PModuleID;
							"RLRSENQE",						//char	*PDocumentID;
							nd_file_name.arr,				//char	*POnlinePrintFileNames;
							p_loc_type.arr,					//char	*PLocationTypes;
							"",								//char	*PLocationCodes;
							1,								//int	 PNumOfCopies;
							1,								//int	 PPageFrom;
							9999							//int	 PPageTo;
						   );
						   

		_flushall();

		if(OERROR)
			ins_message(ERR_MESG,"1.Insert Failed on SY_REPORT_PRINT_REQUEST");
	} 

  }

}

 if(OERROR)
      ins_message(ERR_MESG,"Select failed on DUAL in print_job1()");
 
}
/*----------------------------------------------------------*/
print_job()
{
char er_cd[10];
char print_yn = 'Y';
int i;

//sprintf(string_var, "To be printed   %d", something_to_print);
//disp_message(ERR_MESG, string_var);


//sprintf(string_var, "in print job..something to print   %d ", something_to_print);
//disp_message(ERR_MESG, string_var);

if(something_to_print == 1)
{
p_uid_pwd.arr[0] = '\0';
p_print_name.arr[0] = '\0';
p_loc_code.arr[0] = '\0';
p_loc_type.arr[0] = '\0';
p_rep_file.arr[0] = '\0';
p_print_mode.arr[0] = '\0';

p_uid_pwd.len = 0;
p_print_name.len = 0;
p_loc_code.len = 0;
p_loc_type.len = 0;
p_rep_file.len = 0;
p_print_mode.len = 0;


strcpy(p_uid_pwd.arr,uid_pwd.arr);
p_uid_pwd.len = strlen(uid_pwd.arr);

strcpy(p_print_name.arr,"RLRRSENQ");
p_print_name.len = strlen(p_print_name.arr);

if(rl_print_result_sect_yn.arr[0] == 'Y')
{
   strcpy(p_loc_type.arr,"O");
   p_loc_type.len = strlen(p_loc_type.arr);

/// 11.07.2004   strcpy(p_loc_code.arr,rl_hdr_section_code.arr); 

   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
   strcat(p_loc_code.arr,rl_hdr_section_code.arr);        /// 11.07.2004

   strcat(p_loc_code.arr,rl_hdr_episode_type.arr);

/***** Newly added for Urgent samples   *******/
   if (rl_printer_for_urgent_yn.arr[0] == 'Y')
   {
		if (rl_hdr_urgent_indicator.arr[0] != 'R')
			strcat(p_loc_code.arr, "U");
   }

   p_loc_code.len = strlen(p_loc_code.arr); 

}
else
{
   strcpy(p_loc_code.arr,rl_prn_ctrl_hdr_source_code.arr);
/***** Newly added for Urgent samples   *******/
/************* commented on 01.09.2004
   if (rl_printer_for_urgent_yn.arr[0] == 'Y')
   {
		if (rl_hdr_urgent_indicator.arr[0] != 'R')
			strcat(p_loc_code.arr, "U");
   }
************************/

   p_loc_code.len = strlen(p_loc_code.arr);
	
   l_episode = 0;

/********** commented on 22.07.2003 to handle the ordered facility id properly

   if ( (rl_hdr_episode_type.arr[0] == 'I') ||
		(rl_hdr_episode_type.arr[0] == 'O') )
******************/

   if (( (rl_hdr_episode_type.arr[0] == 'I') ||
		(rl_hdr_episode_type.arr[0] == 'O') ) && 
		(strcmp(nd_operating_facility_id.arr, rl_ordered_facility_id.arr) == 0) ) 
		
   {
		EXEC SQL SELECT open_episode_id
		INTO :l_episode
		FROM IP_OPEN_EPISODE
		WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
		  AND patient_id = :nd_hosp_no;

		if(NODATAFOUND)
		{

             if (rl_hdr_episode_type.arr[0] == 'I')
			 {
				if (strcmp(l_print_disch_pat_result.arr, "Y") == 0)
				{

			  	    print_yn = 'Y';
					strcpy(p_loc_type.arr, "W");
					p_loc_type.len = strlen(p_loc_type.arr);
					strcpy(p_loc_code.arr, rl_hdr_source_code.arr);
					p_loc_code.len = strlen(rl_hdr_source_code.arr);
				}
                else
                  print_yn = 'N';
			 }
			 else
			 {
				strcpy(p_loc_type.arr, "C");
				p_loc_type.len = strlen(p_loc_type.arr);
				print_yn = 'Y';

			 }

		}
		else
		{

			EXEC SQL SELECT  'W'
			INTO :p_loc_type
			FROM IP_EPISODE
			WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND episode_id = :l_episode
			AND patient_id = :nd_hosp_no;


			if(NODATAFOUND)
			{
			  strcpy(p_loc_type.arr, "C");
			  p_loc_type.len = strlen(p_loc_type.arr);
			  print_yn = 'Y';

			}

		}
		
   }
   else
   {
	  strcpy(p_loc_type.arr,"O");
	  print_yn = 'Y';

   }

/*****
   switch(rl_hdr_source_type.arr[0])
   {
      case 'W': strcpy(p_loc_type.arr,"W");
                break;
      case 'C': strcpy(p_loc_type.arr,"C");
                break;
      case 'E': strcpy(p_loc_type.arr,"O");
                break;
   }
**********/


   p_loc_type.len = strlen(p_loc_type.arr);

}

strcpy(p_rep_file.arr,nd_f_name);
p_rep_file.len = strlen(nd_f_name);

strcpy(p_print_mode.arr,"S");
p_print_mode.len = strlen(p_print_mode.arr);

/***** ADDED ON 12/07/2004   **************/
	if (p_param8.arr[0] == 'P')
		source_copies = 1;

switch(p_param7.arr[0])
{
   case 'L' :  /*-------To cater to pulling list---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004		
       strcat(p_loc_code.arr,"L");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'X':  /*-----To cater to confidential reports----*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr,"X");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'Z':  /*-----To cater to reprinting by Patient----*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr,"Z");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'Y' :  /*-------To cater to reprint of results while registration---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr, p_param7.arr);
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

	case 'D' :  /*-------To cater for Draft Copy ---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
       strcat(p_loc_code.arr, p_param7.arr);
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

   case 'A' :  /*-------To print Result Report of any facility from any facility ---------*/

       source_copies = 1;
       rl_hdr_extra_copies_to.arr[0] = '\0';
       rl_hdr_extra_copies_to.len = 0;

       strcpy(p_loc_type.arr,"O");
       p_loc_type.len = strlen(p_loc_type.arr);

	   strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004		
       strcat(p_loc_code.arr,"A");
       p_loc_code.len = strlen(p_loc_code.arr);

	   break;

}

if (strcmp(rl_hdr_urgent_indicator.arr, "U") == 0)
	print_yn = 'Y';

  if(strcmp(p_param7.arr,"D") == 0 || strcmp(p_param8.arr,"P") != 0)	
	if (strcmp(nd_hosp_no.arr,d_screen_donor_id.arr) == 0 || 
								strcmp(nd_hosp_no.arr,d_screen_patient_id.arr) == 0)
    {
		print_yn = 'N';     ///// 10.04.2006

	}


if (print_yn == 'Y')
{

//    check_for_print_destn_type();

	for( i = 0; i < source_copies; i++)
	{
	 if (l_destn_rep_yn == 'Y')		
	 {
			 EXEC SQL
				  INSERT INTO SY_REPORT_PRINT_REQUEST
				  (OPERATING_FACILITY_ID,USER_ID,MACHINE_NAME,WS_NO,MODULE_ID,
				   ONLINE_PRINT_NAME,
				   DEST_LOCN_TYPE,DEST_LOCN_CODE,ONLINE_PRINT_FILE_NAME,
				   PRINT_MODE,REQUEST_DATE,PROCESS_TYPE,PRINT_IMMEDIATE_YN,
				   PRINT_PRIORITY,SELECTION_CRITERIA,PRINT_SERVER_ID,
				   PRINTER_NAME,DEST_QUEUE_NAME   //////// added on 21.08.2005
				  )
				  VALUES
				  (NVL(:rl_ordered_facility_id, :nd_operating_facility_id),:sy_user_id,:sy_machine_name,:sy_ws_no,'RL','RLRRSENQ',
				   :p_loc_type,:p_loc_code,:p_rep_file,'S',SYSDATE,'S',
				   'Y',DECODE(:rl_hdr_urgent_indicator,'U','1','S','1','3'),
				   substr('Specimen No:'||:rl_prn_ctrl_hdr_sp_no||' Source:'||:rl_prn_ctrl_hdr_source_code,1,250),
				   :p_print_id,:p_printer_name,:p_dest_queue_name
				  );

		if(OERROR)
			ins_message(ERR_MESG,"2.Insert Failed on SY_REPORT_PRINT_REQUEST");

/******** added of CA NOTE TYPE ENHANCEMENT ***************/
////			rl_print_ca_note(source_copies);  // commented on 23.12.12 and moved to end of this procedure


	 }

/************************************* added on 16.05.2004 ************************/
	if (strcmp(draft_printing_yn.arr, "N") == 0)
	{
		 if (l_destn_fax_yn == 'Y' || l_destn_mail_yn == 'Y')		
		{

			//// insert to fax table SM_REPORT_FAX_MAIL_REQUEST
					
				 if (l_destn_rep_yn == 'Y')	 
				 {

					/// copy the .LIS file from WORKING_DIR to FAX directory 

					 l_command_line.arr[0]   = '\0';   
					 l_command_line.len      = 0;

					strcpy(l_command_line.arr, "COPY ");
					strcat(l_command_line.arr, nd_file_name.arr);
					strcat(l_command_line.arr, " ");
					strcat(l_command_line.arr, p_rep_file_fax.arr);

				    l_command_line.len = strlen(l_command_line.arr);

					_flushall;

				//	_spawnlp(_P_WAIT, "CMD", l_command_line.arr, NULL);
					
				//  WinExec(l_command_line, SW_SHOWNORMAL);	        

					system(l_command_line.arr);
					
				 }   

				 get_dest_type_n_locn();  /// 02.09.2004

				 strcpy(p_rep_file.arr,p_rep_file_fax.arr);	
				 p_rep_file.len = strlen(p_rep_file.arr);


				 if (l_destn_fax_yn == 'Y')		
		        {	
				     if(p_fax_address.len)
					 {
					    strcpy(p_fax_loc_type.arr,"@");
						strcpy(p_fax_loc_code.arr,"@");
						p_fax_loc_type.len = strlen(p_fax_loc_type.arr);
						p_fax_loc_code.len = strlen(p_fax_loc_code.arr);
					 }
					 EXEC SQL EXECUTE 
						  begin
							declare
							   l_error_text			VARCHAR2(200); 
							   l_report_priority    VARCHAR2(10);
							begin
							    SELECT DECODE(:rl_hdr_urgent_indicator,'R','N','H')
								INTO   l_report_priority
								FROM   DUAL; 
/************16.01.2006 ***************
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRRSENQ',				
															:p_fax_loc_type,		
															:p_fax_loc_code,  		
															 NULL,																 
															 NULL,														 
															 NULL,																 
															 NULL,																	 
															 NULL,																	 
															 l_report_priority,											           
															'F',             		
															:p_rep_file,			
															:sy_user_id,  			
															:sy_ws_no,    			
															:p_fax_id,		  			
															l_error_text 			
														  );
***********************************************************************/
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRRSENQ',				
															:p_fax_loc_type,		
															:p_fax_loc_code,  		
															:p_fax_address,																 
															 NULL,     // p_fax_mail_cc_address
															 NULL,     // p_fax_mail_bcc_address
															 NULL,	   // p_subject	
															 NULL,	   // p_salutation
															 NULL,	   // p_body
															 NULL,	   // p_footer
															 l_report_priority,	
															:p_fax_to_rcpt_name,										           
															:p_fax_to_comp_name,
															:p_fax_to_phone_no,
															:sy_acc_entity_name,  // p_from_user_name
															:sy_tel_num,          // p_from_phone_number
															:sy_fax_num,           // p_from_fax_number
															'F',             		
															:p_rep_file,			
															:sy_user_id,  			
															:sy_ws_no,    			
															:p_fax_id,		  			
															l_error_text 			
														  );

							end;
						  end;
					 END-EXEC;
					 
				 }

				if(OERROR)
					ins_message(ERR_MESG,"1.Insert Failed on SM_REPORT_FAX_MAIL_REQUEST for Fax");


				 if (l_destn_mail_yn == 'Y')		
		         {	

				     get_mail_body_oth_dtls();
					 if(p_mail_address.len)
					 {
					    strcpy(p_mail_loc_type.arr,"@");
						strcpy(p_mail_loc_code.arr,"@");
						p_mail_loc_type.len = strlen(p_mail_loc_type.arr);
						p_mail_loc_code.len = strlen(p_mail_loc_code.arr);
					 }

					 EXEC SQL EXECUTE 
						  begin
							declare
							   l_error_text			VARCHAR2(200);
							   l_report_priority    VARCHAR2(10);
							begin

							    SELECT DECODE(:rl_hdr_urgent_indicator,'R','N','H')
								INTO   l_report_priority
								FROM   DUAL;
/************16.01.2006 ********
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRRSENQ',				
															:p_mail_loc_type,		
															:p_mail_loc_code,  		
															 NULL,																	 
															 NULL,															 
															 NULL,																	 
															 NULL,																		 
															 NULL,																		 
															 l_report_priority,												           
															'M',             		
															:p_rep_file,			
															:sy_user_id,  			
															:sy_ws_no,    			
															:p_mail_id,		  			
															l_error_text 			
														  );
************************************************************************/
//insert into rl_error values('RLRRSENQ',:p_mail_address,'b4 call appfaxmail..specno='||:rl_prn_ctrl_hdr_sp_no);
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRRSENQ',				
															:p_mail_loc_type,		
															:p_mail_loc_code,  		
															:p_mail_address,																	 
															 NULL,			/// p_fax_mail_cc_address
															 NULL,		   ///  p_mail_bcc_address
															substr(:d_mail_subject,1,200),
															substr(:d_mail_salutation,1,100),
															substr(:d_mail_body,1,4000),
															substr(:d_mail_footer,1,1000),
															 l_report_priority,	
															 NULL,        /// p_to_reciepient_name
															 NULL,        /// p_to_company_name
															 NULL,        /// p_to_phone_number
															 NULL,        /// p_from_user_name
															 NULL,        /// p_from_phone_number
															 NULL,        /// p_from_fax_number
															'M', 
															:p_rep_file,
															:sy_user_id,
															:sy_ws_no,
															:p_mail_id,
															l_error_text 
														  );
//insert into rl_error values('RLRRSENQ',:p_mail_address,'after call appfaxmail..specno='||:rl_prn_ctrl_hdr_sp_no||',errortext='||substr(l_error_text,1,20));
							end;
						  end;
					 END-EXEC;

				  }


				if(OERROR)
					ins_message(ERR_MESG,"1.Insert Failed on SM_REPORT_FAX_MAIL_REQUEST for Mail");

	 }
    }
/************************ upto here added on 16.05.2004 ***********************/

		_flushall();


	}

/*-------------	EXTRA COPY ----------------*/
  if (strcmp(draft_printing_yn.arr, "N") == 0)
  {
	if (rl_hdr_extra_copies_to.len)
	{

		strcpy(p_print_name.arr,"RLRSENQE");
		p_print_name.len = strlen(p_print_name.arr);

		strcpy(p_loc_type.arr,"O");
		p_loc_type.len = strlen(p_loc_type.arr);

		if(rl_print_result_sect_yn.arr[0] == 'Y')
		{
/// 11.07.2004 strcpy(p_loc_code.arr,rl_hdr_section_code.arr); 

			strcpy(p_loc_code.arr,nd_operating_facility_id.arr);   /// 11.07.2004
			strcat(p_loc_code.arr,rl_hdr_section_code.arr);        /// 11.07.2004


			strcat(p_loc_code.arr,rl_hdr_episode_type.arr); 
			p_loc_code.len = strlen(p_loc_code.arr);
		}
		else
		{
/// 11.07.2004 strcpy(p_loc_code.arr,rl_prn_ctrl_hdr_section_code.arr);

			strcpy(p_loc_code.arr,nd_operating_facility_id.arr);			 /// 11.07.2004
			strcat(p_loc_code.arr,rl_prn_ctrl_hdr_section_code.arr);        /// 11.07.2004


			p_loc_code.len = strlen(p_loc_code.arr);
		}

		strcpy(p_rep_file.arr,nd_e_name);

/// 12.10.2003		p_rep_file.len = strlen(nd_f_name); 

		p_rep_file.len = strlen(p_rep_file.arr);  /// 12.10.2003

	
	   if (l_destn_rep_yn == 'Y')		
	   {	
		EXEC SQL
			  INSERT INTO SY_REPORT_PRINT_REQUEST
				  (OPERATING_FACILITY_ID,USER_ID,MACHINE_NAME,WS_NO,MODULE_ID,
				   ONLINE_PRINT_NAME,DEST_LOCN_TYPE,DEST_LOCN_CODE,ONLINE_PRINT_FILE_NAME,
					PRINT_MODE,REQUEST_DATE,PROCESS_TYPE,PRINT_IMMEDIATE_YN,
					PRINT_PRIORITY,SELECTION_CRITERIA,
					PRINT_SERVER_ID,PRINTER_NAME,DEST_QUEUE_NAME    //// 21.08.2005
					)
				VALUES
					(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),:sy_user_id,:sy_machine_name,:sy_ws_no,'RL','RLRSENQE',
					:p_loc_type,:p_loc_code,:p_rep_file,'S',SYSDATE,'S',
					'Y',DECODE(:rl_hdr_urgent_indicator,'U','1','S','1','3'),
					substr('Specimen No:'||:rl_prn_ctrl_hdr_sp_no||' Source:'||:rl_prn_ctrl_hdr_source_code,1,250),
					:p_print_id,:p_printer_name,:p_dest_queue_name
					);

			if(OERROR)
				ins_message(ERR_MESG,"3.Insert Failed on SY_REPORT_PRINT_REQUEST");

/******** added of CA NOTE TYPE ENHANCEMENT ***************/
//			rl_print_ca_note();

		 }

		 if (l_destn_fax_yn == 'Y' || l_destn_mail_yn == 'Y')		
		 {

				//// insert to fax table SM_REPORT_FAX_MAIL_REQUEST 


					 if (l_destn_rep_yn == 'Y')	 
					 {
						/// copy the .LIS file from WORKING_DIR to FAX directory 

						 l_command_line.arr[0]   = '\0';   
						 l_command_line.len      = 0;

						strcpy(l_command_line.arr, "COPY ");
						strcat(l_command_line.arr, nd_file_name.arr);
						strcat(l_command_line.arr, " ");
						strcat(l_command_line.arr, p_rep_file_fax_ext.arr);

						l_command_line.len = strlen(l_command_line.arr);

						_flushall;

					//	_spawnlp(_P_WAIT, "CMD", l_command_line.arr, NULL);
						
					//  WinExec(l_command_line, SW_SHOWNORMAL);	        

						system(l_command_line.arr);

					 }   


					 get_dest_type_n_locn();   /// 02.09.2004

					 strcpy(p_rep_file.arr,p_rep_file_fax_ext.arr);	
					 p_rep_file.len = strlen(p_rep_file.arr);

					 if (l_destn_fax_yn == 'Y') 
					 {	
						 if(p_fax_address.len)
						 {
							strcpy(p_fax_loc_type.arr,"@");
							strcpy(p_fax_loc_code.arr,"@");
							p_fax_loc_type.len = strlen(p_fax_loc_type.arr);
							p_fax_loc_code.len = strlen(p_fax_loc_code.arr);
						 }
						 EXEC SQL EXECUTE  
							  begin
								declare
								   l_error_text			VARCHAR2(200);
							       l_report_priority    VARCHAR2(10);
								begin
									SELECT DECODE(:rl_hdr_urgent_indicator,'R','N','H')
									INTO   l_report_priority
									FROM   DUAL;  
/***************16.01.2006 *****************								 			
									appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
																'RL',					
																'RLRSENQE',				
																:p_fax_loc_type,		
																:p_fax_loc_code,  		
																 NULL,																 
																 NULL,														 
																 NULL,																 
																 NULL,																	 
																 NULL,																	 
																 l_report_priority,											           
																'F',             		
																:p_rep_file,			
																:sy_user_id,  			
																:sy_ws_no,    			
																:p_fax_id,		  			
																l_error_text 			
															  );
************************************************************************/
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRSENQE',				
															:p_fax_loc_type,		
															:p_fax_loc_code,  		
															:p_fax_address,																 
															 NULL,     // p_fax_mail_cc_address
															 NULL,     // p_fax_mail_bcc_address
															 NULL,	   // p_subject	
															 NULL,	   // p_salutation
															 NULL,	   // p_body
															 NULL,	   // p_footer
															 l_report_priority,	
															:p_fax_to_rcpt_name,										           
															:p_fax_to_comp_name,
															:p_fax_to_phone_no,
															:sy_acc_entity_name,  // p_from_user_name
															:sy_tel_num,          // p_from_phone_number
															:sy_fax_num,           // p_from_fax_number
															'F',             		
															:p_rep_file,			
															:sy_user_id,  			
															:sy_ws_no,    			
															:p_fax_id,		  			
															l_error_text 			
														  );
								end;
							  end;
						 END-EXEC;
					  }

					if(OERROR)
						ins_message(ERR_MESG,"2.Insert Failed on SM_REPORT_FAX_MAIL_REQUEST for Fax");

					 if (l_destn_mail_yn == 'Y')  
					 {	
					     get_mail_body_oth_dtls();
						 if(p_mail_address.len)
						 {
							strcpy(p_mail_loc_type.arr,"@");
							strcpy(p_mail_loc_code.arr,"@");
							p_mail_loc_type.len = strlen(p_mail_loc_type.arr);
							p_mail_loc_code.len = strlen(p_mail_loc_code.arr);
						 }
						 EXEC SQL EXECUTE  
							  begin
								declare
								   l_error_text			VARCHAR2(200);
							       l_report_priority    VARCHAR2(10);
								begin

									SELECT DECODE(:rl_hdr_urgent_indicator,'R','N','H')
									INTO   l_report_priority
									FROM   DUAL;
/*******************16.01.2006 ***************								 			
									appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
																'RL',					
																'RLRSENQE',				
																:p_mail_loc_type,		
																:p_mail_loc_code,  		
																 NULL,																 
																 NULL,														 
																 NULL,																 
																 NULL,																	 
																 NULL,																	 
																 l_report_priority,											           
																'M',             		
																:p_rep_file,			
																:sy_user_id,  			
																:sy_ws_no,    			
																:p_mail_id,		  			
																l_error_text 			
															  );
******************************************************************/
								appfaxmail.fax_mail_report(NVL(:rl_ordered_facility_id, :nd_operating_facility_id),          
															'RL',					
															'RLRSENQE',				
															:p_mail_loc_type,		
															:p_mail_loc_code,  		
															:p_mail_address,																	 
															 NULL,			/// p_fax_mail_cc_address
															 NULL,		   ///  p_mail_bcc_address
															:d_mail_subject,
															:d_mail_salutation,
															:d_mail_body,
															:d_mail_footer,
															 l_report_priority,	
															 NULL,        /// p_to_reciepient_name
															 NULL,        /// p_to_company_name
															 NULL,        /// p_to_phone_number
															 NULL,        /// p_from_user_name
															 NULL,        /// p_from_phone_number
															 NULL,        /// p_from_fax_number
															'M', 
															:p_rep_file,
															:sy_user_id,
															:sy_ws_no,
															:p_mail_id,
															l_error_text 
														  );
								end;
							  end;
						 END-EXEC;
					  }


					if(OERROR)
						ins_message(ERR_MESG,"2.Insert Failed on SM_REPORT_FAX_MAIL_REQUEST for Mail");

		 }


		_flushall();  

	} 
   }
  }

}
//disp_message(ERR_MESG, "in print job b4 call rlprintcanote");
/******** added of CA NOTE TYPE ENHANCEMENT ***************/
			rl_print_ca_note(source_copies);  ////added here on 23.12.12 by Srinivasarao to handle when only ole result available.

 if(OERROR)
       ins_message(ERR_MESG,"Select failed on DUAL in print_job()");
 
}
/*----------------------------------------------------------*/
fetch_sy_prog_param()
{
rl_prn_ctrl_hdr_pat_no.arr[0] 		= '\0';  
rl_prn_ctrl_hdr_sp_no.arr[0] 		= '\0';
rl_prn_ctrl_hdr_source_code.arr[0] 	= '\0';
rl_prn_ctrl_hdr_user.arr[0] 		= '\0';
rl_prn_ctrl_hdr_section_code.arr[0]     = '\0';
rl_prn_ctrl_hdr_rp_yn.arr[0] = '\0';
p_param7.arr[0] = '\0';
p_param8.arr[0]	= '\0';
p_param9.arr[0]	= '\0';      ///  added param9,10,11 on 09.12.2004
p_param10.arr[0]	= '\0';
p_param11.arr[0]	= '\0';
p_param12.arr[0]	= '\0';  
p_param13.arr[0]	= '\0';  
p_param18.arr[0]	= '\0';  // added for GHL-CRF-0433.1
p_fax_id.arr[0]		= '\0';  
p_mail_id.arr[0]	= '\0';  
//p_print_id.arr[0]   = '\0';
//p_printer_name.arr[0] = '\0';
//p_dest_queue_name.arr[0] = '\0';

p_fax_to_rcpt_name.arr[0] = '\0';
p_fax_to_comp_name.arr[0] = '\0';
p_fax_to_phone_no.arr[0]  = '\0'; 
//p_fax_address.arr[0]      = '\0';     
//p_mail_address.arr[0]     = '\0';    

nd_rowid.arr[0]						= '\0';

rl_prn_ctrl_hdr_pat_no.len 	        = 0;
rl_prn_ctrl_hdr_source_code.len         = 0;
rl_prn_ctrl_hdr_sp_no.len 	        = 0;
rl_prn_ctrl_hdr_section_code.len        = 0;
rl_prn_ctrl_hdr_user.len	        = 0;
rl_prn_ctrl_hdr_rp_yn.len = 0;
p_param7.len = 0;
p_param8.len = 0;
p_param9.len = 0;
p_param10.len = 0;
p_param11.len = 0;
p_param12.len = 0;
p_param13.len = 0;
p_param18.len = 0;// added for GHL-CRF-0433.1
p_fax_id.len = 0;
p_mail_id.len = 0;
//p_print_id.len = 0;

//p_printer_name.len = 0;    /// 21.08.2005
//p_dest_queue_name.len = 0;

p_fax_to_rcpt_name.len = 0;
p_fax_to_comp_name.len = 0;
p_fax_to_phone_no.len  = 0;
//p_fax_address.len      = 0;
//p_mail_address.len     = 0;

nd_rowid.len  = 0;


EXEC SQL SELECT	PARAM1,
			    PARAM2,
			    PARAM3,
			    PARAM4,
			    PARAM5,
				NVL(PARAM6,'N'),
				PARAM7,
				PARAM8,
				NVL(PARAM9,'PRINT'),
				NVL(PARAM10, 'N'),
				NVL(PARAM11, 'N'),
				NVL(PARAM12, 'N'),
				NVL(PARAM13, 'N'),
	///			PARAM14,
				PARAM15,
				PARAM16,												
	///			PARAM17,
	///			PARAM18,
				PARAM19,  
				PARAM20,
				PARAM21,
	///			PARAM22,
	///			PARAM23,
				rowid,
				param18
	       INTO	
			    :rl_prn_ctrl_hdr_pat_no,
	   	   	    :rl_prn_ctrl_hdr_sp_no,
			    :rl_prn_ctrl_hdr_source_code,
			    :rl_prn_ctrl_hdr_user,
			    :rl_prn_ctrl_hdr_section_code,
				:rl_prn_ctrl_hdr_rp_yn,
				:p_param7, 
				:p_param8,
				:p_param9,    ////added param9,10,11 on 09.12.2004
				:p_param10,
				:p_param11,
				:p_param12,  /// added on 07.08.2005
				:p_param13,  /// added on 16.01.2006
	///			:p_print_id,
				:p_fax_id,
				:p_mail_id,
	///			:p_printer_name,
	///			:p_dest_queue_name,
				:p_fax_to_rcpt_name,  /// added on 16.01.2006
				:p_fax_to_comp_name,  /// added on 16.01.2006
				:p_fax_to_phone_no,   /// added on 16.01.2006
	///			:p_fax_address,       /// added on 16.01.2006
	///			:p_mail_address,      /// added on 16.01.2006
				:nd_rowid,
				:p_param18 // added for GHL-CRF-0433.1
	       FROM	SY_PROG_PARAM
	      WHERE	OPERATING_FACILITY_ID = :nd_operating_facility_id
		    AND PGM_ID = 'RLRRSENQ'
	        AND	SESSION_ID = :sy_session_id
			AND PGM_DATE = :sy_req_date
            AND PARAM4 = :sy_user_id
			AND ROWNUM < 2;
	
      if (OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_PROG_PARAM");

      if (NOT_FOUND) 
	      return FALSE;
      else 
	  {
	      rl_prn_ctrl_hdr_pat_no.arr[rl_prn_ctrl_hdr_pat_no.len]           = '\0';
	      rl_prn_ctrl_hdr_sp_no.arr[rl_prn_ctrl_hdr_sp_no.len]             = '\0';
	      rl_prn_ctrl_hdr_source_code.arr[rl_prn_ctrl_hdr_source_code.len] = '\0';
 	      rl_prn_ctrl_hdr_user.arr[rl_prn_ctrl_hdr_user.len]               = '\0';
	      rl_prn_ctrl_hdr_section_code.arr[rl_prn_ctrl_hdr_section_code.len]  = '\0';
          rl_prn_ctrl_hdr_rp_yn.arr[rl_prn_ctrl_hdr_rp_yn.len] = '\0';
		  p_param7.arr[p_param7.len] = '\0';
		  nd_rowid.arr[nd_rowid.len]						   = '\0';
		  p_param8.arr[p_param8.len] = '\0';
		  p_param9.arr[p_param9.len] = '\0';
		  p_param10.arr[p_param10.len] = '\0';
		  p_param11.arr[p_param11.len] = '\0';

		  p_param12.arr[p_param12.len] = '\0';
		  p_param13.arr[p_param13.len] = '\0';
		  p_param18.arr[p_param18.len] = '\0';// added for GHL-CRF-0433.1
	///	  p_print_id.arr[p_print_id.len] = '\0';
		  p_fax_id.arr[p_fax_id.len] = '\0';
		  p_mail_id.arr[p_mail_id.len] = '\0';
	///	  p_printer_name.arr[p_printer_name.len] = '\0';
	///	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';

		  p_fax_to_rcpt_name.arr[p_fax_to_rcpt_name.len] = '\0';
		  p_fax_to_comp_name.arr[p_fax_to_comp_name.len] = '\0';
		  p_fax_to_phone_no.arr[p_fax_to_phone_no.len]   = '\0'; 
	///	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	///	  p_mail_address.arr[p_mail_address.len]         = '\0';    
		  		  		  		  
	      strcpy(nd_hosp_no.arr,rl_prn_ctrl_hdr_pat_no.arr);
	      strcpy(nd_spec_no.arr,rl_prn_ctrl_hdr_sp_no.arr);
	      nd_hosp_no.arr[rl_prn_ctrl_hdr_pat_no.len] 	= '\0';
	      nd_spec_no.arr[rl_prn_ctrl_hdr_sp_no.len] 	= '\0';
	      nd_hosp_no.len	= rl_prn_ctrl_hdr_pat_no.len;
	      nd_spec_no.len	= rl_prn_ctrl_hdr_sp_no.len; 

  	      return TRUE;
	}

}
/*----------------------------------------------------------*/
sql_connect(l_nd_ap_uid_pwd)
char l_nd_ap_uid_pwd[];
{
  strcpy(uid_pwd.arr,l_nd_ap_uid_pwd);
  uid_pwd.len = strlen(uid_pwd.arr);

  EXEC SQL CONNECT :uid_pwd;
  if (sqlca.sqlcode < 0)
      return(-1);
  return(0);
}
get_company_name()
{

    sy_acc_entity_name.arr[0] = '\0'; 
	sy_acc_entity_name.len    = 0; 
    sy_tel_num.arr[0] = '\0'; 
	sy_tel_num.len    = 0; 
    sy_fax_num.arr[0] = '\0'; 
	sy_fax_num.len    = 0; 

    EXEC SQL  SELECT ACC_ENTITY_NAME,TEL_NUM,FAX_NUM	  
		        INTO :sy_acc_entity_name,:sy_tel_num,:sy_fax_num
	            FROM SY_ACC_ENTITY_LANG_VW
			WHERE ACC_ENTITY_ID = :nd_operating_facility_id
			and language_id = :language_id;	/* Company Name Master */

      if (OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_ACC_ENTITY");

    sy_acc_entity_name.arr[sy_acc_entity_name.len] = '\0'; 
	sy_tel_num.arr[sy_tel_num.len] = '\0';
	sy_fax_num.arr[sy_fax_num.len] = '\0';
}
get_ordered_company_name()
{
    EXEC SQL  SELECT ACC_ENTITY_NAME  
		        INTO :sy_ord_acc_entity_name
	            FROM SY_ACC_ENTITY_LANG_VW
			WHERE ACC_ENTITY_ID = :rl_ordered_facility_id
			and language_id = :language_id;	/* Company Name Master */

      if (OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_ACC_ENTITY");

    sy_ord_acc_entity_name.arr[sy_ord_acc_entity_name.len] = '\0'; 
}


/*-----------------------------------------------------*/

get_departmental_parameters()
{
   rl_print_result_sect_yn.arr[0] = '\0';
   rl_print_result_sect_yn.len = 0;
   rl_section_tel_num.arr[0] = '\0';
   rl_section_tel_num.len = 0;
   rl_printer_for_urgent_yn.arr[0]	= '\0';
   rl_printer_for_urgent_yn.len		= 0;
   rl_test_requested_yn.arr[0]		= '\0';
   rl_test_requested_yn.len			= 0;
   rl_message_line.arr[0]			= '\0';
   rl_message_line.len				= 0;
   rl_name_on_report_yn.arr[0]		= '\0';
   rl_name_on_report_yn.len			= 0;
   rl_print_prv_result_yn.arr[0]	= '\0';
   rl_print_prv_result_yn.len		= 0;
   rl_footer_line_1.arr[0]			= '\0';
   rl_footer_line_2.arr[0]			= '\0';
   rl_footer_line_1.len				= 0;
   rl_footer_line_2.len				= 0;
   rl_print_build_clin_hist_yn.arr[0]	= '\0';
   rl_print_build_clin_hist_yn.len		= 0;
   rl_print_pend_profile_yn.arr[0]      = '\0';   /////// 21.05.2005
   rl_print_pend_profile_yn.len         = 0;
   rl_legend_for_pending.arr[0]         = '\0';   /////// 21.05.2005
   rl_legend_for_pending.len            = 0;
   rl_sectn_report_entire_spec_yn.arr[0] = '\0';  // 21.05.2005
   rl_sectn_report_entire_spec_yn.len    = 0;
   rl_print_prev_modified_result_yn.arr[0] = '\0';  // 07.03.2006
   rl_print_prev_modified_result_yn.len    = 0;

   rl_print_num_result_title_yn.arr[0] = '\0';   /// 17.07.2006
   rl_print_num_result_title_yn.len	   = 0;
   rl_title_for_test.arr[0]            = '\0';
   rl_title_for_test.len               = 0;
   rl_title_for_num_result.arr[0]      ='\0';
   rl_title_for_num_result.len         = 0;
   rl_title_for_test_units.arr[0]      = '\0';
   rl_title_for_test_units.len         = 0;
   rl_title_for_range_ind.arr[0]       = '\0';
   rl_title_for_range_ind.len          = 0;
   rl_title_for_result_range.arr[0]    = '\0'; 
   rl_title_for_result_range.len       = 0;
   rl_legend_for_pre_result.arr[0]    = '\0';
   rl_legend_for_pre_result.len       = 0;   /// 29.08.2006

/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
   rl_footer_line_3.arr[0]			= '\0';
   rl_footer_line_3.len				= 0;
/***** ADDED BY MADHUUDHAN ON 1/2/2017  AGAINST ML-MMOH-CRF-0332 REQUIRMENT ******/ 
   rl_print_notify_yn.arr[0]			= '\0';
   rl_print_notify_yn.len				= 0;

   EXEC SQL SELECT NVL(PRINT_RESULT_AT_SECTION_YN,'N'),TEL_NUM,
					NVL(printer_for_urgent_yn, 'N'), NVL(test_requested_yn,'N'),
					message_line, NVL(use_name_on_rep_feature_yn, 'N'),
					footer_line_1, footer_line_2,NVL(print_prev_results_yn,'N'),
					NVL(print_build_clin_hist_yn,'N'),   /// 06.12.2004
					NVL(print_pending_for_profile_yn,'N'),
					legend_for_pending,NVL(report_entire_spec_yn,'N'),
					NVL(print_modified_results_yn,'N'),
					NVL(PRINT_NUM_RESULT_TITLE_YN,'N'),
					TITLE_FOR_TEST,         
					TITLE_FOR_NUM_RESULT,   
					TITLE_FOR_TEST_UNITS,   
					TITLE_FOR_RANGE_IND,    
					TITLE_FOR_RESULT_RANGE,
					NVL(LEGEND_FOR_PRE_RESULT,'This is Preliminary Result'),
					footer_line_3,
					NVL(PRINT_NOTIFY_TEXT_YN,'N')
              INTO :rl_print_result_sect_yn,:rl_section_tel_num,
					:rl_printer_for_urgent_yn, :rl_test_requested_yn,
					:rl_message_line, :rl_name_on_report_yn,
					:rl_footer_line_1, :rl_footer_line_2, :rl_print_prv_result_yn,
					:rl_print_build_clin_hist_yn,
					:rl_print_pend_profile_yn,:rl_legend_for_pending,
					:rl_sectn_report_entire_spec_yn,
					:rl_print_prev_modified_result_yn,
					:rl_print_num_result_title_yn,
					:rl_title_for_test,
					:rl_title_for_num_result,
					:rl_title_for_test_units, 
					:rl_title_for_range_ind,
					:rl_title_for_result_range,
					:rl_legend_for_pre_result,
					:rl_footer_line_3,
					:rl_print_notify_yn /*added by Madhusudhan FOR ml-mmoh-crf-0332*/
		      FROM RL_SECTION_CTL 
		     WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
			 AND SECTION_CODE = :rl_hdr_section_code;

      if (OERROR)
         ins_message(ORA_MESG,"Select failed on table RL_SECTION_CTL");

      rl_print_result_sect_yn.arr[rl_print_result_sect_yn.len] = '\0';
      rl_section_tel_num.arr[rl_section_tel_num.len] = '\0';
	  rl_printer_for_urgent_yn.arr[rl_printer_for_urgent_yn.len]= '\0';
	  rl_test_requested_yn.arr[rl_test_requested_yn.len]		= '\0';
	  rl_message_line.arr[rl_message_line.len]					= '\0';
	  rl_name_on_report_yn.arr[rl_name_on_report_yn.len]		= '\0';
	  rl_print_prv_result_yn.arr[rl_print_prv_result_yn.len]	= '\0';
	  rl_footer_line_1.arr[rl_footer_line_1.len]				= '\0';
	  rl_footer_line_2.arr[rl_footer_line_2.len]				= '\0';
	  rl_print_build_clin_hist_yn.arr[rl_print_build_clin_hist_yn.len]	= '\0';
	  rl_print_pend_profile_yn.arr[rl_print_pend_profile_yn.len]	    = '\0';
	  rl_legend_for_pending.arr[rl_legend_for_pending.len]				= '\0';
	  rl_sectn_report_entire_spec_yn.arr[rl_sectn_report_entire_spec_yn.len] = '\0';
	  rl_print_prev_modified_result_yn.arr[rl_print_prev_modified_result_yn.len] = '\0';
	  rl_print_num_result_title_yn.arr[rl_print_num_result_title_yn.len] = '\0';
	  rl_title_for_test.arr[rl_title_for_test.len] = '\0';
	  rl_title_for_num_result.arr[rl_title_for_num_result.len] = '\0';
	  rl_title_for_test_units.arr[rl_title_for_num_result.len] = '\0';
	  rl_title_for_range_ind.arr[rl_title_for_range_ind.len]   = '\0';
	  rl_title_for_result_range.arr[rl_title_for_result_range.len] = '\0';
	  rl_legend_for_pre_result.arr[rl_legend_for_pre_result.len] = '\0';
 
 /***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
 	  rl_footer_line_3.arr[rl_footer_line_3.len]				= '\0';
	  rl_print_notify_yn.arr[rl_print_notify_yn.len]				= '\0';
}
/*-----------------------------------------------------*/

get_parameters()
{
    rl_lab_title.arr[0] = '\0';
    rl_lab_title.len = 0;
    rl_lab_title_2.arr[0] = '\0';
    rl_lab_title_2.len = 0;
    rl_lab_title_3.arr[0] = '\0';
    rl_lab_title_3.len = 0;
    rl_lab_title_4.arr[0] = '\0';
    rl_lab_title_4.len = 0;
    rl_lab_title_5.arr[0] = '\0';
    rl_lab_title_5.len = 0;
    rl_race_accepted_yn.arr[0] = '\0';   /// 27.07.2004
    rl_race_accepted_yn.len = 0;

/*********************** 23.06.2003 commented and replaced as per new standard

    EXEC SQL  SELECT LAB_TITLE, lab_title_2, lab_title_3, lab_title_4
		    INTO :rl_lab_title, :rl_lab_title_2, :rl_lab_title_3, :rl_lab_title_4
	            FROM RL_PARAM;	////// Departmental Parameters 

*********************************/

///////////////////////////////////////////////
     {
		 EXEC SQL SELECT nvl(a.lab_title,b.lab_title),
	 					 nvl(a.lab_title_2,b.lab_title_2), 
						 nvl(a.lab_title_3,b.lab_title_3),
						 nvl(a.lab_title_4,b.lab_title_4),
						 nvl(a.lab_title_5,b.lab_title_5), 
						 nvl(b.race_accepted_yn,'N')
				  INTO :rl_lab_title, :rl_lab_title_2, :rl_lab_title_3, :rl_lab_title_4,
				       :rl_lab_title_5,:rl_race_accepted_yn
				  FROM   RL_PARAM_FOR_FACILITY A , RL_PARAM B
				  WHERE  OPERATING_FACILITY_ID = :nd_operating_facility_id;

 		 if(NODATAFOUND)
		 {
			    EXEC SQL  SELECT LAB_TITLE, lab_title_2, lab_title_3,lab_title_4, lab_title_5, nvl(race_accepted_yn,'N')
						  INTO :rl_lab_title, :rl_lab_title_2, :rl_lab_title_3, :rl_lab_title_4,
							   :rl_lab_title_5,:rl_race_accepted_yn
						  FROM RL_PARAM;

				  if (OERROR)
					 ins_message(ORA_MESG,"Select failed on table RL_PARAM");

		 }
	 }

///////////////////////////////////////////////

      if (OERROR)
         ins_message(ORA_MESG,"Select failed on table RL_PARAM");

	rl_race_accepted_yn.arr[rl_race_accepted_yn.len] = '\0';
    rl_lab_title.arr[rl_lab_title.len] = '\0';
	rl_lab_title_2.arr[rl_lab_title_2.len] = '\0';
	rl_lab_title_3.arr[rl_lab_title_3.len] = '\0';
	rl_lab_title_4.arr[rl_lab_title_4.len] = '\0';  
	rl_lab_title_5.arr[rl_lab_title_5.len] = '\0';  

	// The last  title has to be concatenated with the department name

/******** title 4 has to be printed as it is. Dept name to be printed seperately 27.07.2004
	strcat(rl_lab_title_4.arr, " ");
	strcat(rl_lab_title_4.arr, rl_section_short_name.arr);
	rl_lab_title_4.len = strlen(rl_lab_title_4.arr);
**************/

}
/*-----------------------------------------------------*/
declare_curs()
{
    get_company_name();

    EXEC SQL DECLARE RL_REQ_HDR_CUR CURSOR FOR
              SELECT SOURCE_CODE,
                     CONSULTANT_CODE,
                     TO_CHAR(SPEC_RECD_DATE_TIME,'DD/MM/YYYY HH24:MI'),
                     TO_CHAR(SPEC_REGD_DATE_TIME,'DD/MM/YYYY HH24:MI'),
                     TO_CHAR(SPEC_COLLTD_DATE_TIME,'DD/MM/YYYY HH24:MI'),
                     TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI'),
                     SECTION_CODE,
                     REQUEST_COMMENT_CODE1,
                     REQUEST_COMMENT_CODE2,
                     REQUEST_COMMENT_CODE3,
                     REQUEST_COMMENT_DESC1,
                     REQUEST_COMMENT_DESC2,
                     REQUEST_COMMENT_DESC3,
                     EXTRA_COPIES_TO,
                     SPECIMEN_TYPE_CODE,
                     ADDED_BY_ID,
                     TO_CHAR(ADDED_DATE,'DD/MM/YYYY HH24:MI'),
                     MODIFIED_BY_ID,
                     TO_CHAR(MODIFIED_DATE,'DD/MM/YYYY HH24:MI'),
				     URGENT_INDICATOR,
				     EPISODE_TYPE, 
					 SOURCE_TYPE,
					 RELEASED_BY_ID,
					 TO_CHAR(RELEASED_DATE,'DD/MM/YYYY HH24:MI'),
					 category_code,
					 category_year, 
					 category_number,
					 TO_CHAR(SPEC_REGD_DATE_TIME,'DD/MM/YYYY'),
					 ordered_facility_id,
					 ordering_doctor_name,   // 06.12.2004
					 patient_id,   /// 12.12.2004
					 order_id,      /// 11.04.2005
					 perform_site_code,   /// 31.10.2006
					 encounter_id, 
					 bed_num,
					 bill_yn
                FROM RL_REQUEST_HEADER
               WHERE SPECIMEN_NO = :nd_spec_no
/// 12.12.2004           WHERE PATIENT_ID = :nd_hosp_no
/// 12.12.2004             AND SPECIMEN_NO = :nd_spec_no
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
		 FOR UPDATE OF STATUS NOWAIT;  

    EXEC SQL DECLARE RL_REQ_DTL_CUR CURSOR FOR
              SELECT TEST_CODE,
                     NVL(RESULT_STATUS,'O'),
                     DECODE(GROUP_TEST_YN,'Y','G','I')
                FROM RL_REQUEST_DETAIL
               WHERE PATIENT_ID = :nd_hosp_no
                 AND SPECIMEN_NO = :first_specimen_no
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id;
/****************
    EXEC SQL DECLARE RL_TEST_RESULT_CUR CURSOR FOR
              SELECT GROUP_TEST_CODE,
                     TEST_CODE,
                     NVL(NUMERIC_PREFIX,'+'),
                     NUMERIC_RESULT,
                     RESULT_COMMENT_DESC1,
                     RESULT_COMMENT_DESC2,
                     RESULT_COMMENT_DESC3,
                     RESULT_COMMENT_DESC4,
					 TEST_UNITS,
					 TEST_REF_RANGE_COMMENT,
					 AGE_RANGE_LOW,
					 AGE_RANGE_HIGH,
                     ROWID,
					 NVL(HIDE_RESULT_COMMENTS_YN,'N')
                FROM RL_TEST_RESULT
               WHERE PATIENT_ID = :nd_hosp_no
                 AND SPECIMEN_NO = :nd_spec_no
		         AND OPERATING_FACILITY_ID = :nd_operating_facility_id
		 AND GROUP_TEST_CODE IN
		 (
              SELECT TEST_CODE
                FROM RL_REQUEST_DETAIL
               WHERE PATIENT_ID = :nd_hosp_no
                 AND SPECIMEN_NO = :nd_spec_no
		         AND OPERATING_FACILITY_ID = :nd_operating_facility_id
		 AND NVL(RESULT_STATUS,' ') = 'R'
		 )
         ORDER BY GROUP_SEQ_NO,TEST_SEQ_NO
		 FOR UPDATE OF STATUS;
****************/
/******** INCLUDE AS DYNAMIC SQL ************************
    EXEC SQL DECLARE RL_TEST_RESULT_CUR CURSOR FOR
              SELECT B.specimen_no,
					 B.GROUP_TEST_CODE,
                     B.TEST_CODE,
                     NVL(NUMERIC_PREFIX,'+'),
                     NUMERIC_RESULT,
                     RESULT_COMMENT_DESC1,
                     RESULT_COMMENT_DESC2,
                     RESULT_COMMENT_DESC3,
                     RESULT_COMMENT_DESC4,
					 TEST_UNITS,
					 TEST_REF_RANGE_COMMENT,
					 AGE_RANGE_LOW,
					 AGE_RANGE_HIGH,
                     B.ROWID AS row_id,
					 NVL(HIDE_RESULT_COMMENTS_YN,'N')
                FROM RL_INTERVAL_TEST_TEMP A, RL_TEST_RESULT B
               WHERE B.PATIENT_ID = :nd_hosp_no
                 AND A.specimen_no = B.specimen_no
				 AND A.OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND B.OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND B.test_code = DECODE(A.test_code, NULL, B.test_code, A.test_code)
				 AND B.group_test_code = A.group_test_code
				 AND A.user_id = 'RLRRSENQ'
				 AND A.session_id = 1
         ORDER BY B.test_code, B.specimen_no, B.GROUP_SEQ_NO,B.TEST_SEQ_NO
		 FOR UPDATE OF STATUS;
****************/

/*   changed on 28/01/2002 and made as a implicit select statement

     EXEC SQL DECLARE RL_SPECIMEN_TYPE_CODE_CUR CURSOR FOR
              SELECT SPECIMEN_DESC
                FROM RL_SPECIMEN_TYPE_CODE
               WHERE SPECIMEN_TYPE_CODE = :rl_hdr_specimen_type_code;
*/


/*   changed on 28/01/2002 and made as a implicit select statement

    EXEC SQL DECLARE RL_SECTION_CUR CURSOR FOR
              SELECT SUBSTR(LONG_NAME,1,30)
                FROM RL_SECTION_CODE
               WHERE SECTION_CODE = :rl_hdr_section_code;

*/

/*   changed on 28/01/2002 and made as a implicit select statement
    EXEC SQL DECLARE RL_TEST_CODE_CUR CURSOR FOR
              SELECT LONG_DESC,
                     NUMERIC_RESULT_YN,
                     AGE_SEX_RANGE_YN,
                     FUNCTION_YN,
                     PRINT_NAME_YN,
                     LOW_VALUE_NORMAL,
                     HIGH_VALUE_NORMAL,
                     GROUP_TEST_YN,
                     TEXT_BLOCK_YN,
                     CULTURE_TEST_YN,
                     SNOMED_YN,
                     TEST_UNITS,
                     NVL(NO_OF_DECIMALS,0),
                     NVL(SIGNIFICANT_DIGIT,0),
					 REF_RANGE_COMMENT,
					 NVL(INHIBIT_REPORT_YN,'N'),
					 NVL(CONFIDENTIAL_YN,'N')    
                FROM RL_TEST_CODE
               WHERE TEST_CODE = :rl_loc_test_code
                 AND INHIBIT_REPORT_YN = 'N';

*/

/*   changed on 28/01/2002 and made as a implicit select statement

    EXEC SQL DECLARE RL_AGE_SEX_RANGE_CUR CURSOR FOR
              SELECT LOW_VALUE_NORMAL,
                     HIGH_VALUE_NORMAL
                FROM RL_AGE_SEX_RANGE
               WHERE TEST_CODE = :rl_tst_test_code
                 AND SEX       = :rl_pat_sex
                 AND :rl_pat_dob_no_of_days
                       BETWEEN CALC_MIN_AGE_IN_DAYS  AND 
                          CALC_MAX_AGE_IN_DAYS;
*/

    EXEC SQL DECLARE RL_COMM_FOR_TEST_CUR CURSOR FOR
              SELECT COMMENT_TEXT
                FROM RL_COMMENTS_FOR_TEST
               WHERE TEST_CODE = :rl_tst_test_code
	    ORDER BY SEQ_NO;

    EXEC SQL DECLARE RL_RESULT_TEXT_CUR CURSOR FOR
              SELECT RESULT_TEXT, RESULT_TEXT_CODE, NVL(print_desc_in_report_yn, 'N'),
			NVL(print_desc_in_bold_yn, 'N'), NVL(print_desc_underlined_yn, 'N')
                FROM RL_RESULT_TEXT
               WHERE PATIENT_ID     = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND NVL(hide_text_yn, 'N') <> 'Y'
            ORDER BY SERIAL_NO;

/// added the below cursor on 16.05.2004 
 
    EXEC SQL DECLARE RL_RESULT_MODIFY_REASON_CUR CURSOR FOR
              SELECT REMARK_CODE,REMARK_TEXT,RELEASED_BY,
					 TO_CHAR(RELEASED_DATE,'DD/MM/YY HH24:MI'),
					 NUMERIC_PREFIX,NUMERIC_RESULT,  ////06.03.2006
					 NVL(MODIFY_COMPONENTS_IND,'!!!!'),
					 INSTR(NVL(MODIFY_COMPONENTS_IND,'!!!!'),'NM')
                FROM RL_RESULT_MODIFY_REASON
               WHERE SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND PATIENT_ID     = :nd_hosp_no
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
            ORDER BY MODIFY_LOG_SEQ_NO desc;


    EXEC SQL DECLARE RL_FUNCTION_CUR CURSOR FOR
              SELECT OPERAND_1,
                     OPERAND_1_TYPE,
                     OPERATOR_1,
                     OPERAND_2,
                     OPERAND_2_TYPE,
                     OPERATOR_2
                FROM RL_FUNCTION
               WHERE TEST_CODE       = :rl_loc_test_code
               ORDER BY SEQ_NUMBER;

/******** Observed this cursor is not using in the program *********
    EXEC SQL DECLARE RL_TEST_RESULT_CUR2 CURSOR FOR
              SELECT NUMERIC_RESULT
                FROM RL_TEST_RESULT
               WHERE PATIENT_ID     = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND TEST_CODE       = :rl_loc_test_code;
**********************/

    EXEC SQL DECLARE RL_RESULT_SNOMED_CUR CURSOR FOR
              SELECT SNOMED_CODE, snomed_code_2,SNOMED_MARKER_CODE_1,SNOMED_MARKER_CODE_2
                FROM RL_RESULT_SNOMED
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
	       ORDER BY SNOMED_CODE;

/*   changed on 28/01/2002 and made as a implicit select statement

    EXEC SQL DECLARE RL_SNOMED_CODE_CUR CURSOR FOR
              SELECT DESCRIPTION_1,
                     DESCRIPTION_2,
                     DESCRIPTION_3,
                     DESCRIPTION_4,
                     DESCRIPTION_5,
		     PRINT_YN
                FROM RL_SNOMED_CODE
               WHERE SNOMED_CODE = :rl_res_snomed_code
			   and language_id = :language_id;

*/

    EXEC SQL DECLARE RL_RESULT_ORGANISM_CUR CURSOR FOR
              SELECT ORGANISM_CODE,
                     RESULT_COMMENT_DESC
                FROM RL_RESULT_ORGANISM
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND NVL(hide_organism_yn, 'N') <> 'Y'
			   ORDER BY ORGANISM_CODE;

    EXEC SQL DECLARE RL_ANTIBIOTIC_CUR CURSOR FOR
              SELECT DISTINCT ANTIBIOTIC_CODE
                FROM RL_RESULT_ORGANISM_DTL
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
                 AND REPORT_YN       = 'Y'
				 AND SENSITIVITY_IND IN('S','R','I')
			   ORDER BY ANTIBIOTIC_CODE;

    EXEC SQL DECLARE RL_SENSITIVITY_CUR CURSOR FOR
              SELECT ORGANISM_CODE,
					 ANTIBIOTIC_CODE,
                     SENSITIVITY_IND,
					 MIC_RESULT,
					 zone_size,
					 NVL(PRINT_MIC_VALUE_YN,'N') PRINT_MIC_VALUE_YN,  //////added on 03.12.2012 against BRU-HIMS-CRF-0050
					 MIC_SIGN     //// added on .01.04.2015 
                FROM RL_RESULT_ORGANISM_DTL
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
                 AND REPORT_YN       = 'Y'
				 AND SENSITIVITY_IND IN('S','R','I')
               ORDER BY ANTIBIOTIC_CODE, ORGANISM_CODE;  

    EXEC SQL DECLARE RL_SENSITIVITY_CUR_FORMAT4 CURSOR FOR
              SELECT ANTIBIOTIC_CODE,
                     SENSITIVITY_IND,
					 MIC_RESULT,
					 zone_size,
					 NVL(PRINT_MIC_VALUE_YN,'N') PRINT_MIC_VALUE_YN,  ///////added on 03.12.2012 against BRU-HIMS-CRF-0050
					 MIC_SIGN     //// added on .01.04.2015 
                FROM RL_RESULT_ORGANISM_DTL
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND ORGANISM_CODE   = :rl_res_organism_code 
                 AND REPORT_YN       = 'Y'
				 AND SENSITIVITY_IND IN('S','R','I')
               ORDER BY SEQ_NO;  

/*   changed on 28/01/2002 and made as a implicit select statement

    EXEC SQL DECLARE RL_ORGANISM_CODE_CUR CURSOR FOR
              SELECT LONG_DESC
                FROM RL_ORGANISM_CODE
               WHERE ORGANISM_CODE = :rl_res_organism_code;
*/

/*   changed on 28/01/2002 and made as a implicit select statement

    EXEC SQL DECLARE RL_ANTIBIOTIC_CODE_CUR CURSOR FOR
              SELECT SUBSTR(LONG_DESC,1,39)
                FROM RL_ANTIBIOTIC_CODE
               WHERE ANTIBIOTIC_CODE = :rl_res_dtl_antibiotic_code;
*/
}

/*-----------------------------------------------------*/
gen_extra_file_name()
{

     p_rep_file_fax_ext.arr[0]   = '\0';   
     p_rep_file_fax_ext.len      = 0;



	 if (l_destn_rep_yn == 'Y')	
			sprintf(extra_file_name,"%srslt_%s.ext",WORKING_DIR,nd_file_no.arr);

	 if (l_destn_fax_yn == 'Y' || l_destn_mail_yn == 'Y')	// mail condn added on 07.08.2005
	 {
		 gen_file_name_fax();
		 sprintf(p_rep_file_fax_ext.arr,"%srslt_%s.ext", nd_file_name_fax.arr,nd_file_no.arr);

		 p_rep_file_fax_ext.len  = strlen(p_rep_file_fax_ext.arr);

		 if (l_destn_rep_yn != 'Y') 
			strcpy(extra_file_name, p_rep_file_fax_ext.arr);

	 }



				/************************************************/ 
				   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
				   {

					l_text.arr[0]		    = '\0';
					l_text.len            = 0;
					strcpy(l_text.arr,"IN GENERATE EXTRA FILE NAME......");
					write_to_file();
				   }

				/************************************************/

   strcpy(nd_e_name,extra_file_name);
   if ((fp = fopen(extra_file_name,"w")) == NULL)
   {
				/************************************************/ 
				   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
				   {

					l_text.arr[0]		    = '\0';
					l_text.len            = 0;
					strcpy(l_text.arr,"IN GENERATE EXTRA FILE NAME......ERROR");
					write_to_file();
				   }

				/************************************************/

				strcpy(string_var, "");
				sprintf(string_var, "E-[%c]<->%s::Mail-[%c]<->[%c]", l_destn_rep_yn, extra_file_name, l_destn_mail_yn, l_destn_fax_yn);

				ins_message(ERR_MESG, string_var);



   }
		/************************************************/ 
		   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN GENERATE EXTRA FILE NAME......LAST");
			write_to_file();
		   }

		/************************************************/


}
/*-----------------------------------------------------*/
gen_file_name()
{


     nd_file_name.arr[0]   = '\0';   
     nd_file_name.len      = 0;

     p_rep_file_fax.arr[0]   = '\0';   
	 p_rep_file_fax.len      = 0;


     EXEC SQL 
	          SELECT LTRIM(RTRIM(TO_CHAR(RL_PRINT_CTL_SEQ.NEXTVAL,'00000009')))
	            INTO :nd_file_no
	            FROM DUAL;


     if (OERROR)
         ins_message(ORA_MESG,"Fetch failed on while getting file number1");


     nd_file_no.arr[nd_file_no.len] = '\0';

	 check_for_print_destn_type();   // 17.05.2004


	 if (l_destn_rep_yn == 'Y')	
	     sprintf(nd_file_name.arr,"%srslt_%s.lis", WORKING_DIR,nd_file_no.arr);



	 if (l_destn_fax_yn == 'Y' || l_destn_mail_yn == 'Y')  /// added mail condn on 07.08.2005
	 {


		 gen_file_name_fax();



		 sprintf(p_rep_file_fax.arr,"%srslt_%s.lis", nd_file_name_fax.arr,nd_file_no.arr);

		 p_rep_file_fax.len  = strlen(p_rep_file_fax.arr);

		 if (l_destn_rep_yn != 'Y') 
			strcpy(nd_file_name.arr, p_rep_file_fax.arr);

     }
	 strcpy(nd_f_name,nd_file_name.arr);

	 nd_file_name.len = strlen(nd_file_name.arr);

			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN GENERATE FILE NAME......");
				write_to_file();
			   }

			/************************************************/
//sprintf(string_var, "Dir --->    %s   %s", nd_file_name.arr,  p_rep_file_fax.arr);

//disp_message(ERR_MESG, string_var);


     if ((fp = fopen(nd_file_name.arr,"w")) == NULL)
     {
			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN GENERATE FILE NAME......ERROR");
				write_to_file();
			   }

			/************************************************/

				strcpy(string_var, "");
				sprintf(string_var, "F-[%c]<->%s::Mail-[%c]<->[%c]", l_destn_rep_yn, nd_file_name.arr, l_destn_mail_yn, l_destn_fax_yn);
				ins_message(ERR_MESG, string_var);



     }
			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN GENERATE FILE NAME......LAST");
				write_to_file();
			   }

			/************************************************/


}
/*-----------------------------------------------------*/
close_hdr()
{
    EXEC SQL CLOSE RL_REQ_HDR_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"CLOSE failed on cursor RL_REQ_HDR_CUR");
}

/*-----------------------------------------------------*/
open_hdr()
{
    EXEC SQL OPEN RL_REQ_HDR_CUR;


	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy RL_REQ_HDR_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"OPEN failed on cursor RL_REQ_HDR_CUR");
	}


}
/*-----------------------------------------------------*/

fetch_hdr()
{
  rl_hdr_source_code.arr[0]            = '\0';
  rl_hdr_consultant_code.arr[0]        = '\0';
  rl_hdr_spec_regd_date_time.arr[0]    = '\0';
  rl_hdr_spec_recd_date_time.arr[0]    = '\0';
  rl_hdr_spec_colltd_date_time.arr[0]  = '\0';
  rl_hdr_current_date_time.arr[0]      = '\0';
  rl_hdr_section_code.arr[0]           = '\0';
  rl_hdr_request_comment_code1.arr[0]  = '\0';
  rl_hdr_request_comment_code2.arr[0]  = '\0';
  rl_hdr_request_comment_code3.arr[0]  = '\0';
  rl_hdr_request_comment_desc1.arr[0]  = '\0';
  rl_hdr_request_comment_desc2.arr[0]  = '\0';
  rl_hdr_request_comment_desc3.arr[0]  = '\0';
  rl_hdr_extra_copies_to.arr[0]        = '\0';
  rl_hdr_specimen_type_code.arr[0]     = '\0';
  rl_hdr_added_by_id.arr[0]            = '\0';
  rl_hdr_added_date.arr[0]             = '\0';
  rl_hdr_modified_by_id.arr[0]         = '\0';
  rl_hdr_modified_date.arr[0]          = '\0';
  rl_hdr_episode_type.arr[0]           = '\0';
  rl_hdr_urgent_indicator.arr[0]       = '\0';
  rl_hdr_source_type.arr[0]		       = '\0';
  rl_hdr_released_by_id.arr[0]		   = '\0';
  rl_hdr_released_date.arr[0]		   = '\0';
  rl_category_code.arr[0]			   = '\0';
  rl_category_year.arr[0]			   = '\0';
  rl_category_number.arr[0]			   = '\0';
  rl_regd_date.arr[0]				   = '\0';
  rl_ordered_facility_id.arr[0]		   = '\0';
  rl_ordering_doctor_name.arr[0]	   = '\0';
  nd_hosp_no.arr[0]              	   = '\0';
  rl_order_id.arr[0]				   = '\0';
  rl_perform_site_code.arr[0]		   = '\0';
  rl_encounter_id.arr[0]			   = '\0';
  rl_bed_num.arr[0]					   = '\0';
  rl_bill_yn.arr[0]			  = '\0';

  rl_hdr_source_code.len               = 0;
  rl_hdr_consultant_code.len           = 0;
  rl_hdr_spec_regd_date_time.len       = 0;
  rl_hdr_spec_recd_date_time.len       = 0;
  rl_hdr_spec_colltd_date_time.len     = 0;
  rl_hdr_current_date_time.len         = 0;
  rl_hdr_section_code.len              = 0;
  rl_hdr_request_comment_code1.len     = 0;
  rl_hdr_request_comment_code2.len     = 0;
  rl_hdr_request_comment_code3.len     = 0;
  rl_hdr_request_comment_desc1.len     = 0;
  rl_hdr_request_comment_desc2.len     = 0;
  rl_hdr_request_comment_desc3.len     = 0;
  rl_hdr_extra_copies_to.len           = 0;
  rl_hdr_specimen_type_code.len        = 0;
  rl_hdr_added_by_id.len               = 0;
  rl_hdr_added_date.len                = 0;
  rl_hdr_modified_by_id.len            = 0;
  rl_hdr_modified_date.len             = 0;
  rl_hdr_episode_type.len	           = 0;
  rl_hdr_urgent_indicator.len	       = 0;
  rl_hdr_source_type.len	           = 0;
  rl_hdr_released_by_id.len            = 0;
  rl_hdr_released_date.len             = 0;
  rl_category_code.len					= 0;
  rl_category_year.len					= 0;
  rl_category_number.len				= 0;
  rl_regd_date.len						= 0;
  rl_ordered_facility_id.len			= 0;
  rl_ordering_doctor_name.len  			= 0;
  nd_hosp_no.len                        = 0;
  rl_order_id.len			 			= 0; 
  rl_perform_site_code.len				= 0; 
  rl_encounter_id.len					= 0;
  rl_bed_num.len						= 0;
  rl_bill_yn.len					= 0;
  

    EXEC SQL FETCH RL_REQ_HDR_CUR
              INTO :rl_hdr_source_code,
                   :rl_hdr_consultant_code,
                   :rl_hdr_spec_recd_date_time,
                   :rl_hdr_spec_regd_date_time,
			       :rl_hdr_spec_colltd_date_time,
                   :rl_hdr_current_date_time,
                   :rl_hdr_section_code,
                   :rl_hdr_request_comment_code1,
                   :rl_hdr_request_comment_code2,
                   :rl_hdr_request_comment_code3,
                   :rl_hdr_request_comment_desc1,
                   :rl_hdr_request_comment_desc2,
                   :rl_hdr_request_comment_desc3,
                   :rl_hdr_extra_copies_to,
                   :rl_hdr_specimen_type_code,
                   :rl_hdr_added_by_id,
                   :rl_hdr_added_date,
                   :rl_hdr_modified_by_id,
                   :rl_hdr_modified_date,
  				   :rl_hdr_urgent_indicator,
  				   :rl_hdr_episode_type,
				   :rl_hdr_source_type,
				   :rl_hdr_released_by_id,
				   :rl_hdr_released_date,
				   :rl_category_code,
				   :rl_category_year,
				   :rl_category_number,
				   :rl_regd_date,
				   :rl_ordered_facility_id,
				   :rl_ordering_doctor_name,
				   :nd_hosp_no,   //// 12.12.2004
				   :rl_order_id,  //// 11.04.2005
				   :rl_perform_site_code, /// 31.10.2006
				   :rl_encounter_id,
				   :rl_bed_num,
				   :rl_bill_yn;
/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT the columns encounter id and bed num******/

    if (OERROR)
        ins_message(ORA_MESG,"FETCH failed on cursor RL_REQ_HDR_CUR");

    rl_hdr_source_code.arr[rl_hdr_source_code.len]		 	= '\0';
    rl_hdr_consultant_code.arr[rl_hdr_consultant_code.len]		= '\0';
    rl_hdr_spec_recd_date_time.arr[rl_hdr_spec_recd_date_time.len] 	= '\0';
    rl_hdr_spec_regd_date_time.arr[rl_hdr_spec_regd_date_time.len] 	= '\0';
    rl_hdr_spec_colltd_date_time.arr[rl_hdr_spec_colltd_date_time.len] = '\0';
    rl_hdr_current_date_time.arr[rl_hdr_current_date_time.len] 		= '\0';
    rl_hdr_section_code.arr[rl_hdr_section_code.len] 			= '\0';
    rl_hdr_request_comment_code1.arr[rl_hdr_request_comment_code1.len] = '\0';
    rl_hdr_request_comment_code2.arr[rl_hdr_request_comment_code2.len] = '\0';
    rl_hdr_request_comment_code3.arr[rl_hdr_request_comment_code3.len] = '\0';
    rl_hdr_request_comment_desc1.arr[rl_hdr_request_comment_desc1.len] = '\0';
    rl_hdr_request_comment_desc2.arr[rl_hdr_request_comment_desc2.len] = '\0';
    rl_hdr_request_comment_desc3.arr[rl_hdr_request_comment_desc3.len] = '\0';
    rl_hdr_extra_copies_to.arr[rl_hdr_extra_copies_to.len]             = '\0';
    rl_hdr_specimen_type_code.arr[rl_hdr_specimen_type_code.len]       = '\0';
    rl_hdr_added_by_id.arr[rl_hdr_added_by_id.len]                     = '\0';
    rl_hdr_added_date.arr[rl_hdr_added_date.len]                       = '\0';
    rl_hdr_modified_by_id.arr[rl_hdr_modified_by_id.len]               = '\0';
    rl_hdr_modified_date.arr[rl_hdr_modified_date.len]                 = '\0';
    rl_hdr_episode_type.arr[rl_hdr_episode_type.len]					= '\0';
    rl_hdr_urgent_indicator.arr[rl_hdr_urgent_indicator.len]			= '\0';
    rl_hdr_source_type.arr[rl_hdr_source_type.len]						= '\0';
    rl_hdr_released_by_id.arr[rl_hdr_released_by_id.len]				= '\0';
    rl_hdr_released_date.arr[rl_hdr_released_date.len]					= '\0';
	rl_category_code.arr[rl_category_code.len]							= '\0';
	rl_category_year.arr[rl_category_year.len]							= '\0';
	rl_category_number.arr[rl_category_number.len]						= '\0';
	rl_regd_date.arr[rl_regd_date.len]									= '\0';
	rl_ordered_facility_id.arr[rl_ordered_facility_id.len]				= '\0';
	rl_ordering_doctor_name.arr[rl_ordering_doctor_name.len]			= '\0';
	nd_hosp_no.arr[nd_hosp_no.len]										= '\0';
	rl_order_id.arr[rl_order_id.len]									= '\0';	 
	rl_perform_site_code.arr[rl_perform_site_code.len]					= '\0';	 
	rl_encounter_id.arr[rl_encounter_id.len]							= '\0';
	rl_bed_num.arr[rl_bed_num.len]										= '\0';
	rl_bill_yn.arr[rl_bill_yn.len]							= '\0';
	

	/* To Override the Source Code which is sending through SY_PROG_PARAM *****/
/********** This portion is commented on 03/06/2001
		The result report should print in the current location of patient
	 strcpy(rl_prn_ctrl_hdr_source_code.arr, rl_hdr_source_code.arr);
	 rl_prn_ctrl_hdr_source_code.len = strlen(rl_prn_ctrl_hdr_source_code.arr);
********************************************/

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/

fetch_dtl()
{
    EXEC SQL OPEN RL_REQ_DTL_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_REQ_DTL_CUR");

    for (i=0;i<99;i++)
    {
        rl_dtl_test_code[i].arr[0]         = '\0';
        rl_dtl_result_status[i].arr[0]     = '\0';
        rl_dtl_group_test_flag[i].arr[0]   = '\0';

        rl_dtl_test_code[i].len            = 0;
        rl_dtl_result_status[i].len        = 0;
        rl_dtl_group_test_flag[i].len      = 0;
    }

    EXEC SQL FETCH RL_REQ_DTL_CUR
              INTO :rl_dtl_test_code,
                   :rl_dtl_result_status,
                   :rl_dtl_group_test_flag;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_REQ_DTL_CUR");

    no_of_dtl_recs = sqlca.sqlerrd[2];

    for (i=0;i<sqlca.sqlerrd[2];i++)
    {
        rl_dtl_test_code[i].arr[rl_dtl_test_code[i].len]         = '\0';
        rl_dtl_result_status[i].arr[rl_dtl_result_status[i].len] = '\0';
        rl_dtl_group_test_flag[i].arr[rl_dtl_group_test_flag[i].len]  = '\0';
    }
}
/*-----------------------------------------------------*/
/******* modified order by on 29.09.2003 *******/
declare_tst_result_curs()
{
    sql_stmt.arr[0]		= '\0';  
	sql_stmt.len		= 0;


/**************** KDAH-CRF-260 The result comment code selection is added ************/
	
	strcpy(sql_stmt.arr, "SELECT B.specimen_no, \
					 B.GROUP_TEST_CODE, \
                     B.TEST_CODE, \
                     NVL(NUMERIC_PREFIX,'+'), \
                     NUMERIC_RESULT, \
					 RESULT_COMMENT_DESC1, \
                     RESULT_COMMENT_DESC2, \
                     RESULT_COMMENT_DESC3, \
                     RESULT_COMMENT_DESC4, \
					 RESULT_COMMENT_CODE1, RESULT_COMMENT_CODE2, RESULT_COMMENT_CODE3, RESULT_COMMENT_CODE4, \
					 B.TEST_UNITS, \
					 TEST_REF_RANGE_COMMENT, \
					 AGE_RANGE_LOW, \
					 AGE_RANGE_HIGH, \
                     B.ROWID AS row_id, \
					 NVL(HIDE_RESULT_COMMENTS_YN,'N'), \
					 B.high_low_ind, \
					 A.seq_no, \
					 NVL(B.cancelled_yn, 'N'), \
					 B.released_by_id, \
					 TO_CHAR(B.released_date, 'DD/MM/YYYY HH24:MI'), \
					 NVL(B.numeric_result_hide_yn, 'N') numeric_result_hide_yn, \
					 NVL(B.status, 'O') status,  \
					 NVL(C.interval_test_yn,'N'), \
					 NVL(B.preliminary_release_yn,'N') preliminary_release_yn, \
					 B.SUB_SECTION_CODE,  \
					 B.SUB_SECTION_CODE_IND\
                FROM RL_INTERVAL_TEST_TEMP A, RL_TEST_RESULT B, RL_TEST_CODE C \
               WHERE B.PATIENT_ID = :nd_hosp_no \
                 AND A.specimen_no = B.specimen_no \
				 AND A.OPERATING_FACILITY_ID = :nd_operating_facility_id \
				 AND B.OPERATING_FACILITY_ID = :nd_operating_facility_id \
				 AND B.test_code = DECODE(A.test_code, NULL, B.test_code, A.test_code) \
				 AND B.group_test_code = A.group_test_code \
				 AND NVL(B.cancelled_yn, 'N') <> 'Y' \
				 AND A.user_id = 'RLRRSENQ' \
				 AND B.test_code = C.test_code \
				 AND (b.test_code IN (SELECT test_code FROM RL_GROUP_TEST_DETAIL WHERE GROUP_TEST_CODE =:p_param18 ) or b.test_code =nvl(:p_param18,b.test_code))\
				 AND A.session_id = 1 ");
	
	if (d_interval_specimen_yn == 'Y')
		strcat(sql_stmt.arr, " ORDER BY B.SUB_SECTION_CODE,B.SUB_SECTION_CODE_IND,B.test_code, B.specimen_no, B.GROUP_SEQ_NO,B.GROUP_TEST_CODE,B.TEST_SEQ_NO,B.TEST_CODE FOR UPDATE OF B.STATUS NOWAIT"); //B.SUB_SECTION_CODE ADDED FOR GHL-CRF-0452
	else
		strcat(sql_stmt.arr, " ORDER BY B.SUB_SECTION_CODE,B.SUB_SECTION_CODE_IND,B.GROUP_SEQ_NO,B.GROUP_TEST_CODE,B.TEST_SEQ_NO,B.TEST_CODE FOR UPDATE OF B.STATUS NOWAIT"); //B.SUB_SECTION_CODE ADDED FOR GHL-CRF-0452
		 
	sql_stmt.len = strlen(sql_stmt.arr);
	EXEC SQL PREPARE sr1 FROM :sql_stmt;

	if (OERROR)
		 ins_message(ORA_MESG,"PREPARE failed on table RL_TEST_RESULT");

    EXEC SQL DECLARE rl_test_result_cur CURSOR FOR sr1;		

}
/*-----------------------------------------------------*/
open_tst_result_curs()
{
/////////////// 22.06.2003 modified added facility id also 

	EXEC SQL OPEN rl_test_result_cur USING :nd_hosp_no,:nd_operating_facility_id,:nd_operating_facility_id,:p_param18;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy rl_test_result_cur");
	}


}
/*-----------------------------------------------------*/

/********** INCLUDED AS DYNAMIC SQL ***************
open_tst_result()
{
    EXEC SQL OPEN RL_TEST_RESULT_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_TEST_RESULT_CUR");
}
**********************/
/*-----------------------------------------------------*/
fetch_tst_result() 
{

  rl_tst_group_test_code.arr[0]      = '\0';
  rl_tst_test_code.arr[0]      = '\0';
  rl_tst_numeric_prefix.arr[0]      = '\0';
  rl_tst_numeric_result.arr[0]      = '\0';
  rl_tst_result_comment_desc1.arr[0]      = '\0';
  rl_tst_result_comment_desc2.arr[0]      = '\0';
  rl_tst_result_comment_desc3.arr[0]      = '\0';
  rl_tst_result_comment_desc4.arr[0]      = '\0';
/**************** KDAH-CRF-260 The result comment code selection is added ************/  
  rl_tst_result_comment_code1.arr[0]      = '\0';
  rl_tst_result_comment_code2.arr[0]      = '\0';
  rl_tst_result_comment_code3.arr[0]      = '\0';
  rl_tst_result_comment_code4.arr[0]      = '\0';   
  rl_tst_rowid.arr[0]                     = '\0';
  rl_tst_cd_test_units.arr[0]			= '\0';
  rl_tst_cd_range_cmt.arr[0]		  = '\0';
  rl_tst_ran_low_val_nor.arr[0]	  = '\0';
  rl_tst_ran_high_val_nor.arr[0]	  = '\0';
  rl_tst_hide_rslt_comm_yn.arr[0] = '\0';
  d_specimen_no.arr[0]			  = '\0';
  rl_high_low_ind.arr[0]		  = '\0';
  rl_cancelled_yn.arr[0]			  = '\0';
  rl_released_by_id.arr[0]			  = '\0';
  rl_released_date.arr[0]			  = '\0';
  rl_num_result_hide_yn.arr[0]		  = '\0';
  rl_tst_status.arr[0]				  = '\0';
  rl_tst_interval_test_yn.arr[0]      = '\0';
  rl_tst_preliminary_release_yn.arr[0]      = '\0';
  rl_tst_group_test_code.len         = 0;
  rl_tst_test_code.len         = 0;
  rl_tst_numeric_prefix.len         = 0;
  rl_tst_numeric_result.len         = 0;
  rl_tst_result_comment_desc1.len         = 0;
  rl_tst_result_comment_desc2.len         = 0;
  rl_tst_result_comment_desc3.len         = 0;
  rl_tst_result_comment_desc4.len         = 0;
  rl_tst_rowid.len                        = 0;
  rl_tst_cd_test_units.len		  = 0;
  rl_tst_cd_range_cmt.len		  = 0;
  rl_tst_ran_low_val_nor.len	  = 0;
  rl_tst_ran_high_val_nor.len	  = 0;
  rl_tst_hide_rslt_comm_yn.len	  = 0;
  d_specimen_no.len				  = 0;
  rl_high_low_ind.len			  = 0;
  rl_cancelled_yn.len			  = 0;
  rl_released_by_id.len			  = 0;
  rl_released_date.len			  = 0;
  rl_num_result_hide_yn.len		  = 0;
  rl_tst_status.len				  = 0;   /// 21.05.2005
  rl_tst_interval_test_yn.len     = 0;
  rl_tst_preliminary_release_yn.len = 0; /// 22.08.2006
  
  rl_tst_test_sub_sec.len = 0; //added for GHL-CRF-0452-DD-01
  rl_grp_tst_test_sub_sec.len = 0; //GHL-CRF-0489

    EXEC SQL FETCH RL_TEST_RESULT_CUR
              INTO :d_specimen_no,
				   :rl_tst_group_test_code,
                   :rl_tst_test_code,
                   :rl_tst_numeric_prefix,
                   :rl_tst_numeric_result,
                   :rl_tst_result_comment_desc1,
                   :rl_tst_result_comment_desc2,
                   :rl_tst_result_comment_desc3,
                   :rl_tst_result_comment_desc4,
                   :rl_tst_result_comment_code1,
                   :rl_tst_result_comment_code2,
                   :rl_tst_result_comment_code3,
                   :rl_tst_result_comment_code4,				   
				   :rl_tst_cd_test_units,
				   :rl_tst_cd_range_cmt,
				   :rl_tst_ran_low_val_nor,
				   :rl_tst_ran_high_val_nor,
                   :rl_tst_rowid,
				   :rl_tst_hide_rslt_comm_yn,
				   :rl_high_low_ind, 
				   :rl_seq_no,
				   :rl_cancelled_yn,
				   :rl_released_by_id,
				   :rl_released_date,
				   :rl_num_result_hide_yn,
				   :rl_tst_status,
				   :rl_tst_interval_test_yn,
				   :rl_tst_preliminary_release_yn,
				   :rl_tst_test_sub_sec, //added for GHL-CRF-0452-DD-01
				   :rl_grp_tst_test_sub_sec;//GHL-CRF-0489

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_TEST_RESULT_CUR");

    rl_tst_group_test_code.arr[rl_tst_group_test_code.len] = '\0';
    rl_tst_test_code.arr[rl_tst_test_code.len] = '\0';
    rl_tst_numeric_prefix.arr[rl_tst_numeric_prefix.len] = '\0';
    rl_tst_numeric_result.arr[rl_tst_numeric_result.len] = '\0';
    rl_tst_result_comment_desc1.arr[rl_tst_result_comment_desc1.len] = '\0';
    rl_tst_result_comment_desc2.arr[rl_tst_result_comment_desc2.len] = '\0';
    rl_tst_result_comment_desc3.arr[rl_tst_result_comment_desc3.len] = '\0';
    rl_tst_result_comment_desc4.arr[rl_tst_result_comment_desc4.len] = '\0';
    rl_tst_result_comment_code1.arr[rl_tst_result_comment_code1.len] = '\0';
    rl_tst_result_comment_code2.arr[rl_tst_result_comment_code2.len] = '\0';
    rl_tst_result_comment_code3.arr[rl_tst_result_comment_code3.len] = '\0';
    rl_tst_result_comment_code4.arr[rl_tst_result_comment_code4.len] = '\0';	
    rl_tst_rowid.arr[rl_tst_rowid.len] = '\0';
    rl_tst_cd_test_units.arr[rl_tst_cd_test_units.len]  	      = '\0';
    rl_tst_cd_range_cmt.arr[rl_tst_cd_range_cmt.len]		      = '\0';
    rl_tst_ran_low_val_nor.arr[rl_tst_ran_low_val_nor.len]	  = '\0';
    rl_tst_ran_high_val_nor.arr[rl_tst_ran_high_val_nor.len]	  = '\0';
    rl_tst_hide_rslt_comm_yn.arr[rl_tst_hide_rslt_comm_yn.len] = '\0';
	d_specimen_no.arr[d_specimen_no.len]					   = '\0';
	rl_high_low_ind.arr[rl_high_low_ind.len]				   = '\0';
	rl_cancelled_yn.arr[rl_cancelled_yn.len]				   = '\0';
	rl_released_by_id.arr[rl_released_by_id.len]			   = '\0';
	rl_released_date.arr[rl_released_date.len]				   = '\0';
	rl_num_result_hide_yn.arr[rl_num_result_hide_yn.len]	   = '\0';
	rl_tst_status.arr[rl_tst_status.len]					   = '\0';
    rl_tst_interval_test_yn.arr[rl_tst_interval_test_yn.len]   = '\0';
	rl_tst_preliminary_release_yn.arr[rl_tst_preliminary_release_yn.len] = '\0';
	rl_tst_test_sub_sec.arr[rl_tst_test_sub_sec.len] = '\0'; //added for GHL-CRF-0452-DD-01
	rl_grp_tst_test_sub_sec.arr[rl_grp_tst_test_sub_sec.len] = '\0';//GHL-CRF-0489

	strcpy(nd_spec_no.arr, d_specimen_no.arr);
	nd_spec_no.len = strlen(nd_spec_no.arr);

#ifdef DEBUG
    printf("Group is <%s> tst is <%s>\n",rl_tst_group_test_code.arr,
                       rl_tst_test_code.arr);
	printf("In fetch_tst_result, last_row = %d \n",
	LAST_ROW);
#endif
    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
fetch_tst_result1()
{

  rl_tst_group_test_code.arr[0]      = '\0';
  rl_tst_test_code.arr[0]      = '\0';
  rl_tst_numeric_prefix.arr[0]      = '\0';
  rl_tst_numeric_result.arr[0]      = '\0';
  rl_tst_result_comment_desc1.arr[0]      = '\0';
  rl_tst_result_comment_desc2.arr[0]      = '\0';
  rl_tst_result_comment_desc3.arr[0]      = '\0';
  rl_tst_result_comment_desc4.arr[0]      = '\0';
  rl_tst_rowid.arr[0]                     = '\0';
  rl_tst_cd_test_units.arr[0]			= '\0';
  rl_tst_cd_range_cmt.arr[0]		  = '\0';
  rl_tst_ran_low_val_nor.arr[0]	  = '\0';
  rl_tst_ran_high_val_nor.arr[0]	  = '\0';
  rl_tst_hide_rslt_comm_yn.arr[0] = '\0';

  rl_tst_group_test_code.len         = 0;
  rl_tst_test_code.len         = 0;
  rl_tst_numeric_prefix.len         = 0;
  rl_tst_numeric_result.len         = 0;
  rl_tst_result_comment_desc1.len         = 0;
  rl_tst_result_comment_desc2.len         = 0;
  rl_tst_result_comment_desc3.len         = 0;
  rl_tst_result_comment_desc4.len         = 0;
  rl_tst_rowid.len                        = 0;
  rl_tst_cd_test_units.len		  = 0;
  rl_tst_cd_range_cmt.len		  = 0;
  rl_tst_ran_low_val_nor.len	  = 0;
  rl_tst_ran_high_val_nor.len	  = 0;
  rl_tst_hide_rslt_comm_yn.len = 0;

    EXEC SQL FETCH RL_TEST_RESULT_CUR
              INTO :rl_tst_group_test_code,
                   :rl_tst_test_code,
                   :rl_tst_numeric_prefix,
                   :rl_tst_numeric_result,
                   :rl_tst_result_comment_desc1,
                   :rl_tst_result_comment_desc2,
                   :rl_tst_result_comment_desc3,
                   :rl_tst_result_comment_desc4,
				   :rl_tst_cd_test_units,
				   :rl_tst_cd_range_cmt,
				   :rl_tst_ran_low_val_nor,
				   :rl_tst_ran_high_val_nor,
                   :rl_tst_rowid,
				   :rl_tst_hide_rslt_comm_yn;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_TEST_RESULT_CUR");

    rl_tst_group_test_code.arr[rl_tst_group_test_code.len] = '\0';
    rl_tst_test_code.arr[rl_tst_test_code.len] = '\0';
    rl_tst_numeric_prefix.arr[rl_tst_numeric_prefix.len] = '\0';
    rl_tst_numeric_result.arr[rl_tst_numeric_result.len] = '\0';
    rl_tst_result_comment_desc1.arr[rl_tst_result_comment_desc1.len] = '\0';
    rl_tst_result_comment_desc2.arr[rl_tst_result_comment_desc2.len] = '\0';
    rl_tst_result_comment_desc3.arr[rl_tst_result_comment_desc3.len] = '\0';
    rl_tst_result_comment_desc4.arr[rl_tst_result_comment_desc4.len] = '\0';
    rl_tst_rowid.arr[rl_tst_rowid.len] = '\0';
    rl_tst_cd_test_units.arr[rl_tst_cd_test_units.len]  	      = '\0';
    rl_tst_cd_range_cmt.arr[rl_tst_cd_range_cmt.len]		      = '\0';
    rl_tst_ran_low_val_nor.arr[rl_tst_ran_low_val_nor.len]	  = '\0';
    rl_tst_ran_high_val_nor.arr[rl_tst_ran_high_val_nor.len]	  = '\0';
    rl_tst_hide_rslt_comm_yn.arr[rl_tst_hide_rslt_comm_yn.len] = '\0';

#ifdef DEBUG
    printf("Group is <%s> tst is <%s>\n",rl_tst_group_test_code.arr,
                       rl_tst_test_code.arr);
	printf("In fetch_tst_result, last_row = %d \n",
	LAST_ROW);
#endif
    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/

update_tst_result()  
{

     EXEC SQL UPDATE RL_TEST_RESULT
              SET    STATUS = 'P',
		             MODIFIED_BY_ID = :sy_user_id, ///ah scf USER,
		             MODIFIED_DATE = SYSDATE
              WHERE  ROWID       = :rl_tst_rowid
			  AND    NVL(STATUS,'O')  IN ('R','P'); /// 21.05.2005

     if (OERROR)
         ins_message(ORA_MESG,"UPDATE failed on table RL_TEST_RESULT");
}
/*-----------------------------------------------------*/
print_header()
{   char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i,l_tests;

    pctr++;

	if (l_print_health_card_yn.arr[0]=='Y') 
		lctr = 20;
	else
	    lctr = 19;

    get_parameters();

/*---------*/
    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/

    fprintf(fp,"\n%-*s%-.40s\n\n",(int)(((80 - sy_acc_entity_name.len)/2) - 6)," ",sy_acc_entity_name.arr);
    fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
/*----------------------------------------*/


    if(rl_hdr_episode_type.arr[0] == 'R')
       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	  strcpy(t_patient_id,nd_hosp_no.arr);
       else
	  strcpy(t_patient_id,rl_pat_actual_id.arr);
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//  fprintf(fp,"Patient ID : ");
	//fprintf(fp,"HMC No.    : ");
	fprintf(fp,"%-11.11s: ",local_legend[1]); // added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-15.15s",t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Section : ");
	fprintf(fp, "%-8.8s: ", local_legend[2]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	fprintf(fp, "%-s - %-s\n",rl_section_short_name.arr,
							  rl_section_tel_num.arr);


/********* added on 27/11/2002 for printing NEW MEDICOM NO FOR HMC ******/
/*----------------------------------------*/
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		get_new_medicom_no();
		if (strlen(nd_new_medicom_no.arr) > 0)
		{
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp,"MEDICOM No.: ");
			fprintf(fp,"%-11.11s: ", local_legend[3]);//added for globalisation
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s-3B",ESC);   

			fprintf(fp,"%c&k12S",ESC);	
			fprintf(fp,"%c&l6D",ESC);
   			fprintf(fp,"%c(s4B",ESC);

			fprintf(fp,"%-15.15s\n",nd_new_medicom_no.arr);
	
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s-3B",ESC);
		}
	}
/*----------------------------------------*/
/********* upto here added on 27/11/2002 for printing NEW MEDICOM NO FOR HMC ******/

/* added by c dinesh to print health card info 21/06/2002 */

if ((l_print_health_card_yn.arr[0]=='Y') && 
			 ( (rl_health_card_num.arr[0]!='\0') ||
			   (rl_health_num.arr[0] != '\0')
			  ))
	{

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Health Card No : ");
    fprintf(fp,"%-15.15s: ", local_legend[4]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-15.15s",rl_health_card_num.arr);


/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"    Health No  : ");
    fprintf(fp,"%-15.15s: ", local_legend[5]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-14.14s\n", rl_health_num.arr);

}
/*--------------till here ----------------------*/
    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"\n\n");

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
	if(rl_pat_sex.arr[0] == 'F')
	   //strcpy(sex_desc,"FEMALE");
		strcpy(sex_desc,local_legend[38]);//added for globalisation
	else
       strcpy(sex_desc,"");
    
	strcpy(pat_name,rl_pat_title.arr);
	if(strlen(rl_pat_title.arr) > 0)
	   strcat(pat_name," ");
	strcat(pat_name,rl_pat_short_name.arr);
    
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp,"Patient Name         : ");
	fprintf(fp,"%-21.21s: ", local_legend[6]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-42.42s",pat_name);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Sex : ");
    fprintf(fp,"%-4.4s: ", local_legend[7]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-8.8s\n",sex_desc);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Location             : ");
    fprintf(fp,"%-21.21s: ", local_legend[8]); //added for globaliation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-42.42s",rl_source_short_name.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"DOB : ");
    fprintf(fp,"%-4.4s: ",local_legend[9]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%-16.16s\n",rl_pat_date_of_birth.arr); 

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Clinical Information : ");
    fprintf(fp,"%-21.21s: ", local_legend[10]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    if (rl_hdr_request_comment_desc2.len)
    {
       /*----------------------------------------*/
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s4B",ESC);
       fprintf(fp,"%-23.23s"," ");
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }

    if (rl_hdr_request_comment_desc3.len)
    {
       /*----------------------------------------*/
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s4B",ESC);
       fprintf(fp,"%-23.23s"," ");
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Requesting Doctor    : ");
    fprintf(fp,"%-21.21s: ",local_legend[11]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

    fprintf(fp,"%-33.33s",rl_consultant_short_name.arr);
				
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Request Date : ");
    fprintf(fp,"%-13.13s: ", local_legend[12]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    //fprintf(fp,"%-s\n",rl_hdr_spec_recd_date_time.arr);
    fprintf(fp,"%-s\n",rl_hdr_spec_recd_date_time1.arr);//added for globalisation

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Specimen Type        : ");
    fprintf(fp,"%-21.21s: ", local_legend[13]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-33.33s",rl_spc_specimen_desc.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Regn Date    : ");
    fprintf(fp,"%-13.13s: ", local_legend[14]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

    //fprintf(fp,"%s\n",rl_hdr_spec_regd_date_time.arr);
    fprintf(fp,"%s\n",rl_hdr_spec_regd_date_time1.arr);//added for globalisation

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Tests Requested      : ");
    fprintf(fp,"%-21.21s: ",local_legend[15]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-33.33s"," ");

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    fprintf(fp,"Specimen No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[16]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	if (d_interval_specimen_yn == 'Y')
		fprintf(fp,"%-9.9s (I)\n",first_specimen_no.arr);
	else
		fprintf(fp,"%-s\n",nd_spec_no.arr);

	sprintf(l_str,"%-6.6s"," ");

    l_tests = no_of_dtl_recs;
	if (no_of_dtl_recs > 7)
	   l_tests = 7;

//    for (i=0;i < no_of_dtl_recs;i++)
    for (i=0;i < l_tests;i++)
    {
       sprintf(l_str,"%s%-5s  ",l_str, rl_dtl_test_code[i].arr);
    }
    fprintf(fp,"%s\n",l_str);

    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"\n\n");
}
/*---------------------------------------------------------*/
print_dtls()
{
  int next_line = 0;
  int c_count2 = 0;
  char range_cmnt_print_flag = 'N';
  char l_str[100],l_str1[100];
  int agesex_range_flag = FALSE;
  int path_review_flag = FALSE;
  numeric_value_flag = FALSE;
  strcpy(l_str,"");
  page_break(0); 

  something_to_print_for_test = 0; //// 21.05.2005


  /// 03.10.2005 if((atoi(c_count_profile.arr) > 0) && (rl_tst_status.arr[0] != 'A'))   ///// 21.05.2005

  if( ((atoi(c_count_profile.arr) > 0) && (rl_tst_status.arr[0] != 'A')) ||  ///// 21.05.2005
    	((atoi(c_count_profile.arr) > 0) && strcmp(draft_printing_yn.arr, "Y") == 0) || // 03.10.2005
		((atoi(c_count_profile.arr) > 0) && strcmp(rl_tst_preliminary_release_yn.arr, "Y") == 0)  // 22.08.2006
	)

  {
  fetch_test_code(rl_tst_test_code.arr);
  
  /* Check to see if test result should be printed (Confidential Result) */

/// 28.09.2006  if (rl_tst_cd_conf_yn.arr[0]	== 'N' || p_param7.arr[0] == 'X' )
  if (rl_tst_cd_conf_yn.arr[0]	== 'N' || p_param7.arr[0] == 'X' 
                                       || (nd_user_conf_access_yn.arr[0] == 'Y' && strcmp(draft_printing_yn.arr, "Y") == 0)) /// added 28.09.2006  
  {
  
  if(rl_tst_cd_inh_rep_yn.arr[0] == 'N')
  {
	spc_first = 1;
    fflush(fp);
    ind_test_prn = 0;

/********* Newly added to print only those reports 
	which is having some component or should print 
	  *********/

/***** changed on 13/04/2002 against scf - 42 of QATAR *********/
//		something_to_print = 1;	

/******** Newly added to print the specimen nos for the GTT Tests ****/
		if (d_interval_specimen_yn == 'Y' && rl_tst_interval_test_yn.arr[0] == 'Y')
		 {

			if (strcmp(rl_tst_test_code.arr, nd_test_code) != 0)
			{
				strcpy(nd_test_code, rl_tst_test_code.arr);
				l_seq_no = 1;
			}
			else
				l_seq_no++;
			if (strcmp(rl_report_format.arr, "4") != 0 && strcmp(rl_report_format.arr, "5") != 0
								&& strcmp(rl_report_format.arr, "6") != 0 && strcmp(rl_report_format.arr, "7") != 0
			   )    /// added on 05.04.2005
			{
				//sprintf(l_str,"Specimen No: %-15.15s", nd_spec_no.arr);
				sprintf(l_str,"%-11.11s: %-15.15s", local_legend[16], nd_spec_no.arr); //added for globalisation
				print_line(l_str);
				strcpy(l_str,"");
			}	

			page_break(0);
		 }
/******* Upto here *******/ 


    if(rl_tst_cd_print_report_yn.arr[0] == 'Y')
	{
		if (d_interval_specimen_yn == 'Y' && rl_tst_interval_test_yn.arr[0] == 'Y')
		{
			get_interval_description();
			sprintf(l_str,"%-40.40s",interval_description.arr);
		}
		else
		{
		    if(test_desc_fill_for_report.len)   
			{
				if ((rl_tst_numeric_result.len) ||
					((rl_tst_result_comment_desc1.len || rl_tst_result_comment_desc2.len ||
						rl_tst_result_comment_desc3.len || rl_tst_result_comment_desc4.len)) &&
						(rl_tst_hide_rslt_comm_yn.arr[0] == 'N'))
				{
	
			          EXEC SQL SELECT RPAD(:rl_tst_cd_short_desc,40,:test_desc_fill_for_report) 
					   INTO :rl_tst_cd_short_desc
					   FROM DUAL;
					   rl_tst_cd_short_desc.arr[rl_tst_cd_short_desc.len] = '\0'; 
					   sprintf(l_str,"%-40.40s",rl_tst_cd_short_desc.arr);
				}
				else
     		           sprintf(l_str,"%-40.40s",rl_tst_cd_short_desc.arr);
			}
            else
     		  sprintf(l_str,"%-40.40s",rl_tst_cd_short_desc.arr);
		}
	}
    else
        sprintf(l_str,"%-40s"," ");
		print_sub_sec(); //added for GHL-CRF-0452-DD-01
    strcpy(text_line,l_str);
    strcpy(test_description,l_str);

/********  added on 21.07.2003 ***/

    if (print_c_hist == 0)  
	{    

//sprintf(string_var,"b4 cl.histy. %s",rl_tst_group_test_code.arr);
//disp_message(ERR_MESG,string_var);
       if(rl_print_build_clin_hist_yn.arr[0] == 'Y')  /// if condn added on 06.12.2004
	   {
	     print_clinical_history();      
		 print_c_hist = 1;
	   }
	}
/********  upto here *******/


    if ((rl_tst_cd_numeric_result_yn.arr[0] == 'Y') &&
			(rl_num_result_hide_yn.arr[0]	== 'N'))
    {
	if (rl_tst_numeric_result.len)
	{

/****** ADDED ON 14/04/2002 AGAINST SCF - 42 *******/		
		something_to_print = 1;
		something_to_print_for_test = 1;

		if (strcmp(p_param13.arr,"Y") == 0)
		  get_si_units_equv_val();  /// 16.01.2006

        if ( (atof(rl_tst_numeric_result.arr) < 1) && 
			(atof(rl_tst_numeric_result.arr) > 0) )
             put_zero_before_decimal(	);

	  numeric_value_flag = TRUE;

/*********** for adding zero after result if no fraction part **********/


	  strcpy(r_rslt.arr, rl_tst_numeric_result.arr);
	  r_rslt.len = strlen(r_rslt.arr);
	  add_zero_after_result();
	  strcpy(rl_tst_numeric_result.arr, r_rslt.arr);
	  rl_tst_numeric_result.len = strlen(rl_tst_numeric_result.arr);

	if(rl_tst_numeric_prefix.arr[0] == '+')
	{
			 sprintf(l_str,"%s %-10s",l_str,rl_tst_numeric_result.arr);
	}
	else
	{
		    sprintf(l_str,"%s%c%-10s",l_str,rl_tst_numeric_prefix.arr[0],
				     rl_tst_numeric_result.arr);
	}

          strcpy(l_str1,l_str);
          ltrim(l_str1);
          rtrim(l_str1);

/************************************************************************************
			THE BELOW PORTION IS COMMENTED ON 13/10/2003 BECAUSE
		  IF THE TEST_UNITS IS NOT MENIOTED AT THE TIME OF RELEASE OF RESULTS
			THEN THE TRANSACTION TABLE WILL NOT GET UPDATED WITH  TEST UNITS.
			LATER IF THEY DEFINED IN TEST CODE MASTER IT SHOULD NOT SHOW IN 
			QUERY SINCE IT MAY AFFECT THE CR REPOSITORY**************

	  if (strlen(rl_tst_cd_test_units.arr) == 0)   
	  {
			strcpy(rl_tst_cd_test_units.arr,rl_tst_cd_test_units_2.arr);
			rl_tst_cd_test_units.len = strlen(rl_tst_cd_test_units.arr);
	  }
**************** upto here is commented **** the abv if commented on 27.10.2003 ***********/

///16.01.2006          sprintf(l_str,"%s%-10s",l_str,rl_tst_cd_test_units.arr);

		  get_test_units_desc_from_sy_uom(); //// 16.01.2006
          sprintf(l_str,"%s%-10s",l_str,rl_tst_cd_test_units_desc.arr); /// 16.01.2006

/******** CORRECTED ON 17/02/2004 AGAINST HMC RL-11 *********************
   	  if ((rl_tst_ran_low_val_nor.len  || rl_tst_ran_high_val_nor.len ) &&
		  (rl_pat_sex.arr[0] == 'M'    || rl_pat_sex.arr[0] == 'F'))
******** UPTO HERE CORRECTED ON 17/02/2004 AGAINST HMC RL-11 **************/

	      if ( rl_tst_ran_low_val_nor.len  ||
            rl_tst_ran_high_val_nor.len )
          {
		    get_zero_prefix_for_range();

			  strcpy(r_rslt.arr, rl_tst_ran_low_val_nor.arr);
			  r_rslt.len = strlen(r_rslt.arr);
 			  add_zero_after_result();
			  strcpy(rl_tst_ran_low_val_nor.arr, r_rslt.arr);
			  rl_tst_ran_low_val_nor.len = strlen(rl_tst_ran_low_val_nor.arr);

			  strcpy(r_rslt.arr, rl_tst_ran_high_val_nor.arr);
			  r_rslt.len = strlen(r_rslt.arr);
 			  add_zero_after_result();
			  strcpy(rl_tst_ran_high_val_nor.arr, r_rslt.arr);
			  rl_tst_ran_high_val_nor.len = strlen(rl_tst_ran_high_val_nor.arr);
			

			      sprintf(l_str,"%s %-1s (%s - %s)",l_str,
						rl_high_low_ind.arr,
                     rl_tst_ran_low_val_nor.arr,
                     rl_tst_ran_high_val_nor.arr);

		   				   agesex_range_flag = TRUE;
          }
          else
          {
              if(rl_tst_cd_range_cmt.len)
			  {
				   range_cmnt_print_flag = 'Y';
               }
/**************************** commented on 27.03.2005 as per Mr.Dinesh instructions.
becaz it should not take the age sex range from master setup.              
               else
               {
				 if ((!(rl_tst_ran_low_val_nor.len)  &&	!(rl_tst_ran_high_val_nor.len) && 
					(rl_tst_cd_age_sex_range_yn.arr[0] == 'Y')) &&
					(rl_pat_sex.arr[0] == 'M' || rl_pat_sex.arr[0] == 'F'))
				 {

					fetch_age_sex_range();
					if ( rl_tst_ran_low_val_nor.len && rl_tst_ran_high_val_nor.len )
					{
					   get_zero_prefix_for_range();

						  strcpy(r_rslt.arr, rl_tst_ran_low_val_nor.arr);
						  r_rslt.len = strlen(r_rslt.arr);
						  add_zero_after_result();
						  strcpy(rl_tst_ran_low_val_nor.arr, r_rslt.arr);
						  rl_tst_ran_low_val_nor.len = strlen(rl_tst_ran_low_val_nor.arr);

						  strcpy(r_rslt.arr, rl_tst_ran_high_val_nor.arr);
					   	  r_rslt.len = strlen(r_rslt.arr);
 						  add_zero_after_result();
 						  strcpy(rl_tst_ran_high_val_nor.arr, r_rslt.arr);
						  rl_tst_ran_high_val_nor.len = strlen(rl_tst_ran_high_val_nor.arr);

				      sprintf(l_str,"%s %-1s (%-s - %s)",l_str,
							rl_high_low_ind.arr,
			             rl_tst_ran_low_val_nor.arr,
				         rl_tst_ran_high_val_nor.arr);
					}
					agesex_range_flag = TRUE;
				 }				
				 else if(rl_tst_cd_range_cmt_2.len)
				 {
					strcpy(rl_tst_cd_range_cmt.arr,rl_tst_cd_range_cmt_2.arr);
					rl_tst_cd_range_cmt.len = strlen(rl_tst_cd_range_cmt.arr);
					range_cmnt_print_flag = 'Y';
				 } 
                    }
*********************************/

          }

		strcpy(l_str1,l_str);
		ltrim(l_str1);
		rtrim(l_str1);
	    
          if(group && !group_printed)
          {
	       print_group_test_desc(); 
	       group_printed = 1;
          }
	    if (strcmp(rl_tst_group_test_code.arr,rl_tst_test_code.arr)!=0)//GHL-CRF-0489
		print_grp_sub_sec();//GHL-CRF-0489
          next_line = 0;

          if(range_cmnt_print_flag == 'Y')
          {
			if(strlen(rl_tst_cd_range_cmt.arr) <= (80 - strlen(l_str)))
			{
				sprintf(l_str,"%s%s",l_str,rl_tst_cd_range_cmt.arr);
			}
			else
				next_line = 1;            
          }
		
/// commented on 21.07.2003 since it should print even if numeric_result_print_yn = N also
//////	  print_clinical_history();
          
		  bold_print_check = 1;   // 27.07.2004
           
////      print_line(l_str);   /// commented this line against KDAH-CRF-0174 on 12/03/2012

		  if (strcmp(l_customer_id.arr, "KDAH") == 0) /// added this condition against KDAH-CRF-0174 on 12/03/2012
             print_line_num_rslt_kdah();
		  else
             print_line(l_str);

          test_printed  = 1; 

		  bold_print_check = 0;  // 27.07.2004

          if(next_line == 1)
          {
	       sprintf(l_str,"%40.40s%40.40s"," ",rl_tst_cd_range_cmt.arr);
	       print_line(l_str);
          } 

	}   /*Endif of rl_tst_numeric_result.len */

    } /* Endif of rl_tst_cd_numeric_result_yn.arr */

    if (rl_num_result_hide_yn.arr[0] == 'N')
			print_past_results();   /////// 29.07.2004 added to print past results based on setup

	if (strcmp(rl_tst_preliminary_release_yn.arr, "Y") == 0 && strcmp(rl_tst_status.arr,"A") == 0 ) 
	    print_prel_release_desc();	

	if(rl_tst_hide_rslt_comm_yn.arr[0] == 'N')
        print_comment_desc1234(); 

     print_test_comments(); 

     if(rl_tst_cd_culture_test_yn.arr[0] == 'Y')
	 {
///////		if (strcmp(rl_mic_to_print_yn.arr,"Y") == 0)   ///commented against bru-hims-crf-0050
			check_mic_value_present_for_test();

	    if (strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "6") == 0)
			print_culture_format4();
		else 
			print_culture();

	 }


     if (rl_tst_cd_text_block_yn.arr[0] == 'Y')
     {
        open_result_text();
	    splitting();
     }

     if (rl_tst_cd_snomed_yn.arr[0] == 'Y')         

          print_snomed();

/***************** added the below on 21.05.2005	  *******************/

	 if ((rl_tst_status.arr[0] == 'O') && (rl_tst_cd_profile_yn.arr[0] == 'Y'))
	 {
	   if(rl_print_pend_profile_yn.arr[0] == 'Y')  
	   {
		if(!something_to_print_for_test) 
		{
		    strcpy(l_str,"");
			sprintf(l_str,"%-40.40s",test_description);

		    if(rl_tst_cd_print_report_yn.arr[0] == 'Y') 
			{
				if(group && !group_printed)  
				{
				  print_group_test_desc();
				  group_printed = 1;
				}
				if(rl_legend_for_pending.len)
				   sprintf(l_str,"%s %-35.35s",l_str,rl_legend_for_pending.arr);
				else
				   sprintf(l_str,"%s %-35.35s",l_str,"Pending.."); 
				   sprintf(l_str,"%s %-35.35s",l_str,"%-9.9s",local_legend[28]); //added for globalisation

				something_to_print_for_test = 1;
				print_line(l_str); 
				test_printed = 1;
			 }

		}		
	   }		   	
	 }
/*************** upto here added on 21.05.2005 ***********************/

	 print_result_modify_reason(); // to print modify reason if any and something_to_print_for_test = 1
     

     fflush(fp); 

  } /* end if of inh_rep_yn */

  } /* end if of confidential report*/
 } /* end if of if(atoi(c_count.arr) > 0) */
}
/*-----------------------------------------------------*/
//ADDED FOR GHL-CRF-0452-DD-01
print_sub_sec()
{
   
   if (rl_tst_test_sub_sec.len)
   {
	if(strcmp(rl_tst_test_sub_sec_t.arr,rl_tst_test_sub_sec.arr) !=0)
	{
	 
	  get_sub_sec_description();



       /*if(group && !group_printed)
       {
		  print_group_test_desc();
		  group_printed = 1;
       }*/
       if(test_printed)
       {  
		  numeric_value_flag = TRUE;

		 // sprintf(text_line,"(Test Method:%s)",rl_tst_test_sub_sec.arr);
		//sprintf(text_line,"Sub Section:%s",rl_sub_sec_desc.arr);
		sprintf(text_line,"%s",rl_sub_sec_desc.arr);
    	strcpy(rl_tst_test_sub_sec_t.arr,rl_tst_test_sub_sec.arr);

    ///      print_line_check(text_line);
		  bold_print_check=0;
	      print_line(text_line);

       }
       else
       {
		  numeric_value_flag = FALSE;

		 // sprintf(text_line,"%-37.37s",test_description);
		  //print_line_check(text_line);

		  //sprintf(text_line,"(Test Method:%s)",rl_tst_test_sub_sec.arr);
		  

		//fprintf(fp,"%c&k4S",ESC); 
		//fprintf(fp,"%c(s4B",ESC);
		//fprintf(fp,"%Sub Section:%s ", rl_sub_sec_desc.arr); //added for globalisation
		 // sprintf(text_line,"Sub Section:%s",rl_sub_sec_desc.arr);
		 sprintf(text_line,"%s",rl_sub_sec_desc.arr);

		  strcpy(rl_tst_test_sub_sec_t.arr,rl_tst_test_sub_sec.arr);
		  bold_print_check=0;
		  print_line(text_line);

		 // test_printed = 1; //commented out for IN-67057
       }




///////////////////


///	  sprintf(text_line,"(Test Method:%s)",rl_tst_test_sub_sec.arr);
///	  print_line(text_line);
	  
///	  strcpy(rl_tst_test_sub_sec_t.arr,rl_tst_test_sub_sec.arr);
    }
   }
  
}

/*-----------------------------------------------------*/

print_grp_sub_sec()
{
  
   //sprintf(string_var,"sub %s %s ",rl_grp_tst_test_sub_sec.arr, rl_grp_tst_test_sub_sec.arr);
  // disp_message(ERR_MESG, string_var);
   if (rl_grp_tst_test_sub_sec.len)
   {
	if(strcmp(rl_grp_tst_test_sub_sec_t.arr,rl_grp_tst_test_sub_sec.arr) !=0)
	{
	 	  get_grp_tst_sub_sec_description();
       /*if(group && !group_printed)
       {
		  print_group_test_desc();
		  group_printed = 1;
       }*/
       if(test_printed)
       {  
		  numeric_value_flag = TRUE;

		 
		//  sprintf(text_line,"Sub Section:%s",rl_sub_sec_desc.arr);
		sprintf(text_line,"%s",rl_sub_sec_desc.arr);
		  strcpy(rl_grp_tst_test_sub_sec_t.arr,rl_grp_tst_test_sub_sec.arr);

    ///      print_line_check(text_line);
	      bold_print_check=0;
	      print_line(text_line);

       }
       else
       {
		  numeric_value_flag = FALSE;

		 // sprintf(text_line,"%-37.37s",test_description);
		  //print_line_check(text_line);

		  
		  //sprintf(text_line,"Sub Section:%s",rl_sub_sec_desc.arr);
		  sprintf(text_line,"%s",rl_sub_sec_desc.arr);
		  strcpy(rl_grp_tst_test_sub_sec_t.arr,rl_grp_tst_test_sub_sec.arr);
		  bold_print_check=0;
		  print_line(text_line);

		  //test_printed = 1; //commented out for IN-67057
       }




///////////////////



///	  print_line(text_line);
	  
///	  strcpy(rl_tst_test_sub_sec_t.arr,rl_tst_test_sub_sec.arr);
    }
   }
  
}



/*-----------------------------------------------------*/
//added for GHL-CRF-0452-DD-01
get_sub_sec_description()
{
	rl_sub_sec_desc.arr[0]		= '\0';
	rl_sub_sec_desc.len		= 0;

	EXEC SQL SELECT LONG_NAME  
			 INTO :rl_sub_sec_desc
			 FROM RL_SUB_SECTION_CODE
			 WHERE SECTION_CODE=:rl_hdr_section_code
			 AND SUB_SECTION_CODE = :rl_tst_test_sub_sec;


	if (NODATAFOUND)
	{
	  strcpy(rl_sub_sec_desc.arr,rl_tst_test_sub_sec.arr);
	  rl_sub_sec_desc.len = strlen(rl_sub_sec_desc.arr);
	}

	if (OERROR)
	{
 
	 strcpy(rl_sub_sec_desc.arr,rl_tst_test_sub_sec.arr);
	 }

	
//    rl_sub_sec_desc.len = strlen(rl_sub_sec_desc.arr);
    rl_sub_sec_desc.arr[rl_sub_sec_desc.len]		= '\0';
         
}

/*-----------------------------------------------------*/

get_grp_tst_sub_sec_description()
{
	rl_sub_sec_desc.arr[0]		= '\0';
	rl_sub_sec_desc.len		= 0;

	EXEC SQL SELECT LONG_NAME//SUB_SECTION_CODE //LONG_NAME
			 INTO :rl_sub_sec_desc
			 FROM RL_SUB_SECTION_CODE
			 WHERE SECTION_CODE=:rl_hdr_section_code
			 AND SUB_SECTION_CODE = :rl_grp_tst_test_sub_sec;


	if (NODATAFOUND)
	{
	  strcpy(rl_sub_sec_desc.arr,rl_grp_tst_test_sub_sec.arr);
	  rl_sub_sec_desc.len = strlen(rl_sub_sec_desc.arr);
	}

	if (OERROR)
	  strcpy(rl_sub_sec_desc.arr,rl_grp_tst_test_sub_sec.arr);


//    rl_sub_sec_desc.len = strlen(rl_sub_sec_desc.arr);
    rl_sub_sec_desc.arr[rl_sub_sec_desc.len]		= '\0';
         
}
/*-----------------------------------------------------*/
print_test_comments()
{

  if (something_to_print ==  0 )
  {
	check_any_res_comp();

  }
  else
    other_than_comments = 1;


  if (other_than_comments > 0)
  {

	open_comments();
	_flushall();
	while(fetch_comments())
  {
    if (rl_comm_tst_comm_txt.len)
    {
	   //something_to_print = 1; 
       if(group && !group_printed)
       {
	      print_group_test_desc();
	      group_printed = 1;
       }
       if(test_printed)
       {  numeric_value_flag = TRUE;
          print_line_check(rl_comm_tst_comm_txt.arr);
       }
       else
       {
	      numeric_value_flag = FALSE;
	      sprintf(text_line,"%-40.40s%-40s",test_description,
			    rl_comm_tst_comm_txt.arr);
	      print_line_check(text_line);
	      test_printed = 1;
       }
     }
   }

   	close_comments_curs();

   _flushall();
 }

}
/*-----------------------------------------------------*/
print_line(char *t_str)
{
	if (bold_print_check && rl_high_low_ind.len)
	{
	  fprintf(fp,"%c&k4S",ESC); 
   	  fprintf(fp,"%c(s4B",ESC);
      fprintf(fp,"%s\n",t_str);
	  fprintf(fp,"%c&k4S",ESC); 
   	  fprintf(fp,"%c(s-3B",ESC);   
	}
    else
	  fprintf(fp,"%s\n",t_str);

      page_break(1);

/******COMMENTED AGAINST SCF 42 OF QATAR - ******/
//		 something_to_print = 1;
}
/*---------added the below procedure against KDAH-CRF-0174 on 12/03/2012------------------*/
print_line_num_rslt_kdah()
{

    fprintf(fp,"%-40.40s ",test_description);

	if (bold_print_check && rl_high_low_ind.len)
	{
	    fprintf(fp,"%c&k4S",ESC); 
   	    fprintf(fp,"%c(s4B",ESC);

		if(rl_tst_numeric_prefix.arr[0] == '+')
 		   fprintf(fp,"%-10s",rl_tst_numeric_result.arr);
		else
		   fprintf(fp,"%c%-10s",rl_tst_numeric_prefix.arr[0],rl_tst_numeric_result.arr);

	
		fprintf(fp,"%-1s  ",rl_high_low_ind.arr);
		   
	    fprintf(fp,"%c&k4S",ESC); 
   	    fprintf(fp,"%c(s-3B",ESC); 		   		    

     }
	 else
	 {
		if(rl_tst_numeric_prefix.arr[0] == '+')
 		   fprintf(fp,"%-10s   ",rl_tst_numeric_result.arr);
		else
		   fprintf(fp,"%c%-10s   ",rl_tst_numeric_prefix.arr[0],rl_tst_numeric_result.arr);
	 }

     fprintf(fp,"%-10s",rl_tst_cd_test_units_desc.arr);

     if ( rl_tst_ran_low_val_nor.len  || rl_tst_ran_high_val_nor.len )
     {
        fprintf(fp,"%s - %s",rl_tst_ran_low_val_nor.arr,rl_tst_ran_high_val_nor.arr);
     }

	 fprintf(fp,"\n");

     page_break(1);
}
/*-----------------------------------------------------*/

/***** newly added on 07/07/2003 against AL-JAZIRA SCF 85 ***********/
print_line_org_ant(char *t_str)
{
         fprintf(fp,"%s\n",t_str);

		 fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

         page_break(1);

}
/*-----------------------------------------------------*/
print_line_check(char *t_str)
{
      if (numeric_value_flag == TRUE)
	  {
		fprint_repeat(fp,' ',40);
		print_line(t_str);
		numeric_value_flag = TRUE;
	  }
      else  
      {
		print_line(t_str);
		numeric_value_flag = TRUE;
	  }

/******COMMENTED AGAINST SCF 42 OF QATAR - ******/
//	  something_to_print = 1;
}
/*-----------------------------------------------------*/
print_test_desc(l_str)
char l_str[];
{
   if ((!ind_test_prn) &&
      (rl_tst_cd_group_test_yn.arr[0]  == 'N'))
   {
       if (rl_tst_cd_print_report_yn.arr[0] == 'Y')
           fprintf(fp,"%-40s%-36s%s",rl_tst_cd_short_desc.arr,l_str,
                           rl_curr_status);
       else
           fprintf(fp,"%-40s%-36s%s","",l_str,(tst_cd_ind)?rl_curr_status:"");
       ind_test_prn = 1;
       spc_first = 1;
    }
    else if (strlen(l_str))
           fprintf(fp,"%-40s%-40s","",l_str);

    if (tst_cd_ind) tst_cd_ind = 0;
}
/*-----------------------------------------------------*/

print_snomed()
{
	int ctr = 0;
	char prev_snomed_print_yn = 'N';

    open_result_snomed();
	
    l_snomed_head_printed = 0;

	_flushall();
    while (fetch_rl_result_snomed())
    {

        if (fetch_snomed_desc12345())
        {

	/***** NEWLY ADDED   *************/
		get_desc_snomed2();

	        if (rl_snomed_print_yn.arr[0] == 'Y' || rl_snomed2_print_yn.arr[0] == 'Y')
           	    print_snomed_desc12345();
			else
			{
//			    something_to_print = 0;
//				something_to_print_for_test = 0;

				if(group && !group_printed)
				{
				   print_group_test_desc();
				  group_printed = 1;
				}
				if(!test_printed)
				{
					fprintf(fp,"%-40.40s\n",test_description);
					test_printed = 1;
				}
				print_str('Y');
				if (l_snomed_head_printed) 
				{
					fprintf(fp, "\n");
					page_break(1); 
				}

/************ added on 20.07.2004 **************/

			    if (rl_res_snomed_mrkr_code1.len != 0) 
				{
				    get_snomed_marker_desc1();
					print_snomed_marker1();
				}
				if (rl_res_snomed_mrkr_code2.len != 0) 
				{
				    get_snomed_marker_desc2();
					print_snomed_marker2();
				}


/****************************** commented since new procedure print_str is added on 
		//     02/11/2002 for snomed code to be print y/n


					print_snomed_codes('Y');

					fprintf(fp, "\n");
					page_break(1);
******************************/				  


			}

	        ctr++;
        }
    }

	close_snomed_cur();

	_flushall();
}
/*-----------------------------------------------------*/

open_result_snomed()
{
    EXEC SQL OPEN RL_RESULT_SNOMED_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_RESULT_SNOMED_CUR");
}
/*-----------------------------------------------------*/

fetch_rl_result_snomed()
{
#ifdef DEBUG
       printf("In fetch_rl_result_snomed() \n");
#endif
    rl_res_snomed_code.arr[0]     = '\0';
	rl_res_snomed_code2.arr[0]	  = '\0';

	rl_res_snomed_mrkr_code1.arr[0]	  = '\0';
	rl_res_snomed_mrkr_code2.arr[0]	  = '\0';

    rl_res_snomed_code.len        = 0;
	rl_res_snomed_code2.len		  = 0;

	rl_res_snomed_mrkr_code1.len		  = 0;
	rl_res_snomed_mrkr_code2.len		  = 0;

    EXEC SQL FETCH RL_RESULT_SNOMED_CUR
              INTO :rl_res_snomed_code,
				   :rl_res_snomed_code2,
				   :rl_res_snomed_mrkr_code1,
				   :rl_res_snomed_mrkr_code2;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_RESULT_SNOMED_CUR");

    rl_res_snomed_code.arr[rl_res_snomed_code.len] = '\0';
	rl_res_snomed_code2.arr[rl_res_snomed_code2.len]	= '\0';

	rl_res_snomed_mrkr_code1.arr[rl_res_snomed_mrkr_code1.len]	= '\0';
	rl_res_snomed_mrkr_code2.arr[rl_res_snomed_mrkr_code2.len]	= '\0';

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
print_culture()
{

    char temp_sens_ind;
    char temp_line[81];
	char org[MAX_ORGANISMS][5];
    int still_org_dtl_left;
    int print_anti_flag = 0;
    int change_flag = 0;
	int e = 0;
    int anti_flag = 0;
    int c = 0, s = 0;
	int no_of_organisms = 0;
    int oflag = 1;
	int match_found = 0;


    open_result_organism();
	_flushall();
    while(fetch_result_org())
    {
        something_to_print = 1;
		something_to_print_for_test = 1;

		strcpy(org[no_of_organisms],rl_res_organism_code.arr);
	    no_of_organisms++;

		if(group && !group_printed) 
		{
			print_group_test_desc();
			group_printed = 1;
		}
		if(!test_printed)
		{
			sprintf(text_line,"%-40.40s",test_description);
			print_line(text_line);
			test_printed = 1;
		}

		if(oflag)
		{
		   	fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/

                        //sprintf(text_line,"%-46.46s%-41.41s","ORGANISM","COMMENT");
                        sprintf(text_line,"%-46.46s%-41.41s", local_legend[29], local_legend[30]);// added for globalisation
			print_line_org_ant(text_line);

		   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

			oflag = 0;
		}

		fetch_org_desc();

//		sprintf(text_line,"%2d.   %-40.40s%-40.40s",no_of_organisms,
//							rl_res_organism_code_desc.arr,
//							rl_res_comment_desc.arr);

		sprintf(text_line,"%-6.6s%-40.40s%-34.34s",rl_res_organism_code.arr,
							rl_res_organism_code_desc.arr,rl_res_comment_desc.arr);

/**************** KDAH-CRF-260 The result comment code selection is added ************/
		 if (bold_print_for_org == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }
		
		print_line_org_ant(text_line);

/**************** KDAH-CRF-260 The result comment code selection is added ************/
		if (bold_print_for_org == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    
		 }		 

	} 

	close_organism_cur();

	_flushall();

	if(no_of_organisms)
	{
		something_to_print = 1;
		something_to_print_for_test = 1;
   	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
		sprintf(text_line,"");
		for(c=0;c<87;c++)
			sprintf(text_line,"%s%s",text_line," ");
		print_line_org_ant(text_line);
   	    fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

/* 12.07.2004 */
//		sprintf(text_line,"%-46.46s","ANTIBIOTIC ");
//		for(c=0;c<no_of_organisms;c++)	/* Print organism codes as column headings*/
//			sprintf(text_line,"%s%2d     ",text_line,c+1);  /* c is printed in place of org[c]*/
//		print_line_org_ant(text_line);
//
//   	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
//		sprintf(text_line,"");
//		for(c=0;c<87;c++)
//			sprintf(text_line,"%s%s",text_line," ");
//		print_line_org_ant(text_line);
//	   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
/* ******/

		open_sensitivity();
		fetch_sensitivity();

//// 12.07.2004   	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
		open_antibiotic();
		_flushall();
		t_antib_head_first_time = 0;
		while(fetch_antibiotic())
		{

////////////////////
		if (t_antib_head_first_time == 0) 
		{
		//sprintf(text_line,"%-46.46s","ANTIBIOTIC ");
		sprintf(text_line,"%-46.46s",local_legend[31]);//added for globalisation
		for(c=0;c<no_of_organisms;c++)	/* Print organism codes as column headings*/
			sprintf(text_line,"%s%-8.8s",text_line,org[c]);
// commented on 13/09/2004 to make the lab/ward query and result printout the same
//			sprintf(text_line,"%s%2d     ",text_line,c+1);  /* c is printed in place of org[c]*/


		print_line_org_ant(text_line);


   	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
		sprintf(text_line,"");
		for(c=0;c<87;c++)
			sprintf(text_line,"%s%s",text_line," ");
		print_line_org_ant(text_line);
	   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

		t_antib_head_first_time = 1;
		}  
////////////////////
			something_to_print = 1;
			something_to_print_for_test = 1;
			strcpy(rl_res_dtl_antibiotic_code.arr,a_antibiotic_code.arr);
			rl_res_dtl_antibiotic_code.len = strlen(a_antibiotic_code.arr);
			fetch_antibiotic_desc();
		    sprintf(text_line,"%-46.46s",rl_res_dtl_antibiotic_desc.arr);
// to be corrected

			get_kb_mic_legend(no_of_organisms, 'L');
			sprintf(text_line1,"%-46.46s", l_kb_mic_legend);


			for(e=0;e<no_of_organisms;e++)
			{
				match_found = 0;
				for(s=0; s<no_of_sensitivities; s++)
				{
					if( (strcmp(s_ant[s].arr, a_antibiotic_code.arr) == 0) &&
						(strcmp(s_org[s].arr, org[e]) == 0) )
					{
					     sprintf(text_line,"%s%-8.8s",text_line,s_ind[s].arr);

			////			 if (strlen(s_mic[s].arr) > 0)

						 if (strlen(s_mic[s].arr) > 0 && (strcmp(s_mic_print_yn[s].arr, "Y") == 0)) /// modified against bru-hims-crf-0050
						 {
							 sprintf(text_line1,"%s%-9.9s",text_line1,s_mic[s].arr);
							 
						 }
				/************************************************* commented against bru-hims-crf-0050
						 else if (strlen(s_zone[s].arr) > 0)
						 {
							sprintf(text_line1,"%s%-8.8s",text_line1,s_zone[s].arr);
						 }
				**********************************************************/
						 else
						 {
							sprintf(text_line1,"%s%-8.8s",text_line1," ");
						 }

// commented on 13/09/2004 to make the lab/ward query and result printout the same
			       //     sprintf(text_line,"%s%-7.7s",text_line,s_ind[s].arr);
						match_found = 1;
						break;
					}
				}

				if(match_found == 0)
				{
					sprintf(text_line, "%s        ",text_line);
					sprintf(text_line1,"%s        ",text_line1);
// commented on 13/09/2004 to make the lab/ward query and result printout the same
	            // sprintf(text_line,"%s       ",text_line);
				}

			}
			
			sprintf(text_line,"%-87.87s",text_line);
			sprintf(text_line1,"%-87.87s",text_line1);	 

			print_line_org_ant(text_line);    ////added against bru-hims-crf-0050

			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/   ////added against bru-hims-crf-0050					
			print_line_org_ant(text_line1);
			fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */  ////added against bru-hims-crf-0050

/// ********************************************************************************commented against bru-hims-crf-0050
//			if ( (strcmp(rl_mic_to_print_yn.arr,"Y")==0) && mic_count > 0)
//			{
//				//fprintf(fp,"%c&d0D",ESC);   // Set  UnderLine ON					
//				print_line_org_ant(text_line);
//
//				fprintf(fp,"%c&d0D",ESC);   // Set  UnderLine ON
//				print_line_org_ant(text_line1);
//				fprintf(fp,"%c&d@",ESC);   // Set UnderLine OFF 
//            } 
//			else
//			{ 
//				fprintf(fp,"%c&d0D",ESC);   // Set  UnderLine ON					
//				print_line_org_ant(text_line);
//				fprintf(fp,"%c&d@",ESC);   // Set UnderLine OFF 
//          }
/// *************************************************************************************** /

/*********if a separate line and underline is required the below mentioned 
		//comment lines can be used

			fprintf(fp,"%c&d0D",ESC);   // Set  UnderLine ON					
			sprintf(text_line,"");
			for(c=0;c<87;c++)
				sprintf(text_line,"%s%s",text_line," ");

			print_line_org_ant(text_line);
			fprintf(fp,"%c&d@",ESC);   // Set UnderLine OFF 
*******************/

		}

		close_antibiotic_cur();

/*********** DONE ON 13/09/2004 TO BE COMMENTED TO MAKE 
	THE LAB/WARD QUERY AND
	RESULT REPORT LOOKS THE SAME
****************************************/
		if (t_antib_head_first_time == 1)	
		{
			//sprintf(text_line,"%-35.35s%-52.52s"," ","S - Sensitive     R - Resistant   I - Intermediate");
		    //disp_message(ERR_MESG,local_legend[17]);
			//disp_message(ERR_MESG,local_legend[18]);
			//disp_message(ERR_MESG,local_legend[19]);

			strcpy(string_var, " ");
			sprintf(string_var, "%s     %s     %s", local_legend[17],local_legend[18],local_legend[19]);

			sprintf(text_line,"%-33.33s%-52.52s"," ", string_var); //added for globalisation
           
			print_line_org_ant(text_line);

			for(i=0; i < 87; i++)
					fprintf(fp,"%c",'_');

			fprintf(fp,"\n");
			page_break(1);
		}


	   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		

	}
	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
}
/*-----------------------------------------------------*/
scan_and_prnt(l_str)
char *l_str;
{
   for(;*l_str != '\0';l_str++)
   {
     fprintf(fp,"%c",*l_str);
     if (*l_str == '\n')
        page_break(1);
   }
   fprintf(fp,"\n");
   page_break(1);
}
/*-----------------------------------------------------*/

open_result_organism()
{
    EXEC SQL OPEN RL_RESULT_ORGANISM_CUR;
    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_RESULT_ORGANISM_CUR");
}
/*-----------------------------------------------------*/

open_antibiotic()
{
    EXEC SQL OPEN RL_ANTIBIOTIC_CUR;
    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_ANTIBIOTIC_CUR");
}

/*-----------------------------------------------------*/
fetch_antibiotic()
{ 
    a_antibiotic_code.arr[0]   = '\0';
    a_antibiotic_code.len	   = 0;

    EXEC SQL FETCH RL_ANTIBIOTIC_CUR
              INTO a_antibiotic_code;
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_RESULT_ORGANISM_CUR");

    a_antibiotic_code.arr[a_antibiotic_code.len]   = '\0';
    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
open_antibiotic_format5()
{
    sql_stmt.arr[0]		= '\0';  
	sql_stmt.len		= 0;

	strcpy(sql_stmt.arr, " SELECT DISTINCT ANTIBIOTIC_CODE \
							 FROM RL_RESULT_ORGANISM_DTL \
							WHERE PATIENT_ID      = :nd_hosp_no \
							  AND SPECIMEN_NO     = :nd_spec_no \
							  AND OPERATING_FACILITY_ID = :nd_operating_facility_id \
							  AND GROUP_TEST_CODE = :rl_tst_group_test_code \
							  AND TEST_CODE       = :rl_tst_test_code \
							  AND ( ORGANISM_CODE = :rl_res_organism_code1 OR \
							        ORGANISM_CODE = :rl_res_organism_code2 \
								  )  \
							  AND REPORT_YN       = 'Y' \
							  AND SENSITIVITY_IND IN('S','R','I') \
						 ORDER BY ANTIBIOTIC_CODE ");

	sql_stmt.len = strlen(sql_stmt.arr);

	EXEC SQL PREPARE sr2 FROM :sql_stmt;

	if (OERROR)
		 ins_message(ORA_MESG,"PREPARE failed on table RL_RESULT_ORGANISM_DTL");

    EXEC SQL DECLARE RL_ANTIBIOTIC_CUR_FMT5 CURSOR FOR sr2;		

	EXEC SQL OPEN RL_ANTIBIOTIC_CUR_FMT5  USING :nd_hosp_no,:nd_spec_no,:nd_operating_facility_id,:rl_tst_group_test_code,:rl_tst_test_code,:rl_res_organism_code1,:rl_res_organism_code2;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy RL_RESULT_ORGANISM_DTL");
	}


}

/*-----------------------------------------------------*/
fetch_antibiotic_fmt5()
{
    a_antibiotic_code.arr[0]   = '\0';
    a_antibiotic_code.len	   = 0;

    EXEC SQL FETCH RL_ANTIBIOTIC_CUR_FMT5
              INTO a_antibiotic_code;
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_ANTIBIOTIC_CUR_FMT5");

    a_antibiotic_code.arr[a_antibiotic_code.len]   = '\0';
    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
close_antibiotic_cur_fmt5()
{
	EXEC SQL CLOSE RL_ANTIBIOTIC_CUR_FMT5;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_ANTIBIOTIC_CUR_FMT5");

}
/*-----------------------------------------------------*/

fetch_result_org()
{
    rl_res_organism_code.arr[0]   = '\0';
    rl_res_comment_desc.arr[0]    = '\0';

    rl_res_organism_code.len      = 0;
    rl_res_comment_desc.len       = 0;

    EXEC SQL FETCH RL_RESULT_ORGANISM_CUR
              INTO :rl_res_organism_code,
                   :rl_res_comment_desc;
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_RESULT_ORGANISM_CUR");

    rl_res_organism_code.arr[rl_res_organism_code.len] = '\0';
    rl_res_comment_desc.arr[rl_res_comment_desc.len] = '\0';
    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/

fetch_org_desc()
{
    
//	EXEC SQL OPEN RL_ORGANISM_CODE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_ORGANISM_CODE_CUR");

    rl_res_organism_code_desc.arr[0] = '\0';
    rl_res_organism_code_desc.len    = 0;

    rl_res_organism_code_s_desc.arr[0] = '\0';
    rl_res_organism_code_s_desc.len    = 0;

	/**************** KDAH-CRF-260 The result comment code selection is added ************/
	bold_print_for_org = 0;

	
    EXEC SQL SELECT LONG_DESC, SHORT_DESC, DECODE(NVL(notify_yn, 'N'), 'N', 0, 1) 
			 INTO :rl_res_organism_code_desc, :rl_res_organism_code_s_desc, :bold_print_for_org
             FROM RL_ORGANISM_CODE_lang_vw
             WHERE ORGANISM_CODE = :rl_res_organism_code
			 and language_id = :language_id;

/*
    EXEC SQL FETCH RL_ORGANISM_CODE_CUR
              INTO :rl_res_organism_code_desc;

*/

    rl_res_organism_code_desc.arr[rl_res_organism_code_desc.len] = '\0';
    rl_res_organism_code_s_desc.arr[rl_res_organism_code_s_desc.len] = '\0';

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_ORGANISM_CODE_CUR");
}
/*-----------------------------------------------------*/

fetch_antibiotic_desc()
{
    
//	EXEC SQL OPEN RL_ANTIBIOTIC_CODE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_ANTIBIOTIC_CODE_CUR");

    rl_res_dtl_antibiotic_desc.arr[0] = '\0';
    rl_res_dtl_antibiotic_desc.len    = 0;

    EXEC SQL SELECT SUBSTR(LONG_DESC,1,39)
			 INTO :rl_res_dtl_antibiotic_desc
             FROM RL_ANTIBIOTIC_CODE_lang_vw
             WHERE ANTIBIOTIC_CODE = :rl_res_dtl_antibiotic_code
			 and language_id = :language_id;

/*
    EXEC SQL FETCH RL_ANTIBIOTIC_CODE_CUR
              INTO :rl_res_dtl_antibiotic_desc;

*/
    rl_res_dtl_antibiotic_desc.arr[rl_res_dtl_antibiotic_desc.len] = '\0';

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_ANTIBIOTIC_CODE_CUR");
}
/*-----------------------------------------------------*/
open_sensitivity()
{

    EXEC SQL OPEN RL_SENSITIVITY_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_SENSITIVITY_CUR");
}
/*-----------------------------------------------------*/
open_sensitivity_format4()
{

    EXEC SQL OPEN RL_SENSITIVITY_CUR_FORMAT4;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_SENSITIVITY_CUR_FORMAT4");
}
/*-----------------------------------------------------*/

fetch_sensitivity()
{
   int i;
   char str[100];   

   no_of_sensitivities = 0;

   for(i=0;i<MAX_ANTIBIOTICS;i++)
   {
		s_ant[i].arr[0] = '\0';
		s_org[i].arr[0] = '\0';
		s_ind[i].arr[0] = '\0';
		s_mic[i].arr[0] = '\0';
		s_zone[i].arr[0] = '\0';
		s_mic_print_yn[i].arr[0] = '\0';
		s_mic_sign[i].arr[0] = '\0';

		s_ant[i].len = 0;
		s_org[i].len = 0;
		s_ind[i].len = 0;
		s_mic[i].len = 0;
		s_zone[i].len = 0;
		s_mic_print_yn[i].len = 0;
		s_mic_sign[i].len = 0;
   }

   EXEC SQL FETCH RL_SENSITIVITY_CUR
	         INTO :s_org,
			      :s_ant,
			      :s_ind,
				  :s_mic,
				  :s_zone,
				  :s_mic_print_yn,
				  :s_mic_sign;

   if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_SENSITIVITY_CUR");

   for(i=0;i<MAX_ANTIBIOTICS;i++)
   {
		s_org[i].arr[s_org[i].len] = '\0';
		if(strlen(s_org[i].arr) == 0)
		   break;
		s_ant[i].arr[s_ant[i].len] = '\0';
		s_ind[i].arr[s_ind[i].len] = '\0';
		s_mic[i].arr[s_mic[i].len] = '\0';
		s_zone[i].arr[s_zone[i].len] = '\0';
  		s_mic_print_yn[i].arr[s_mic_print_yn[i].len] = '\0';
		s_mic_sign[i].arr[s_mic_sign[i].len] = '\0';
   }
   no_of_sensitivities = i;
}
/*-----------------------------------------------------*/
fetch_sensitivity_format4() 
{
    b_antibiotic_code.arr[0]   = '\0';
    b_antibiotic_code.len	   = 0;
	b_sensitivity_ind.arr[0]   = '\0';
	b_sensitivity_ind.len      = 0;
	b_mic_value.arr[0]   = '\0';
	b_mic_value.len      = 0;
	b_zone_value.arr[0]   = '\0';
	b_zone_value.len      = 0;
	b_mic_print_yn.arr[0] = '\0';
	b_mic_print_yn.len    = 0;
	b_mic_sign.arr[0] = '\0';
	b_mic_sign.len    = 0;


    EXEC SQL FETCH RL_SENSITIVITY_CUR_FORMAT4
              INTO :b_antibiotic_code,:b_sensitivity_ind,:b_mic_value,
					:b_zone_value,
					b_mic_print_yn,b_mic_sign;
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_SENSITIVITY_CUR_FORMAT4");

    b_antibiotic_code.arr[b_antibiotic_code.len]   = '\0';
	b_sensitivity_ind.arr[b_sensitivity_ind.len]   = '\0';
	b_mic_value.arr[b_mic_value.len]   = '\0';
	b_zone_value.arr[b_zone_value.len]   = '\0';
	b_mic_print_yn.arr[b_mic_print_yn.len]   = '\0';
	b_mic_sign.arr[b_mic_sign.len]   = '\0';

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
fetch_other_dtls()
{
	if(strcmp(rl_hdr_episode_type.arr,"I")==0 || 
       strcmp(rl_hdr_episode_type.arr,"O")==0 ||
	   strcmp(rl_hdr_episode_type.arr,"H")==0 )
    { 
		get_sm_installation();
		if (strcmp(BVNewVersionYN.arr,"Y") == 0)
           declare_inpat_curs();
		else
		   declare_inpat_curs_ah();
	
    }
	else 
		declare_refpat_curs();

   fetch_pat_name();
   fetch_spec_desc();
   fetch_source();
   fetch_consultant();
   fetch_section(); 
}

/*-----------------------------------------------------*/
declare_inpat_curs()
{
	EXEC SQL DECLARE RL_PAT_MAST_CUR CURSOR FOR
              SELECT TITLE_CODE,
	 	      DECODE(:language_id, 'en', SHORT_NAME, 'th', SHORT_NAME_LOC_LANG) SHORT_NAME,
                     SEX, 
                     NATIONALITY_CODE,
                     ROUND(TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				   'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH),
                     TO_CHAR(DATE_OF_BIRTH,'DD/MM/YYYY') ,
					 NVL(actual_dob_yn, 'N'),
					 race_code,
                     ROUND((TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				   'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH)/365),
				     NATIONAL_ID_NUM,
					 //ALTERNATE_ID_NUM   /// 13.02.2005
					 nvl(ALTERNATE_ID_NUM,nvl(ALTERNATE_ID2_NUM,
													nvl(ALTERNATE_ID3_NUM,nvl(ALTERNATE_ID4_NUM,' ')))) //18.06.2008 against ML-SD-CRF-20224
                FROM MP_PATIENT_MAST 
               WHERE PATIENT_ID = :nd_hosp_no;
}
/*-----------------------------------------------------*/
declare_inpat_curs_ah()
{
	EXEC SQL DECLARE RL_PAT_MAST_CUR_ah CURSOR FOR
              SELECT TITLE_CODE,
	 	      DECODE(:language_id, 'en', SHORT_NAME, 'th', SHORT_NAME_LOC_LANG) SHORT_NAME,
                     SEX,
                     NATIONALITY_CODE,
                     ROUND(TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				   'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH),
                     TO_CHAR(DATE_OF_BIRTH,'DD/MM/YYYY') ,
					 NVL(actual_dob_yn, 'N'),
					 race_code,
                     ROUND((TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				   'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH)/365),
				     NATIONAL_ID_NUM
                FROM MP_PATIENT_MAST
               WHERE PATIENT_ID = :nd_hosp_no;
}
/*-----------------------------------------------------*/
declare_refpat_curs()
{
    EXEC SQL DECLARE RL_PAT_MAST3_CUR CURSOR FOR
              SELECT TITLE_CODE,
	 	      DECODE(:language_id, 'en', SHORT_NAME, 'th', SHORT_NAME_LOC_LANG) SHORT_NAME,
                     SEX,
                     NATIONALITY_CODE,
                     ROUND(TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				    'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH),
                     TO_CHAR(DATE_OF_BIRTH,'DD/MM/YYYY'),
		     SUBSTR(NVL(ACTUAL_PATIENT_ID,'NULL'),1,10),
					NVL(actual_dob_yn, 'N'), 
					race_code,
                     ROUND((TRUNC(TO_DATE(:rl_hdr_spec_regd_date_time,
				   'DD/MM/YYYY HH24:MI')) - DATE_OF_BIRTH)/365),
				   location
                FROM RL_PATIENT_MAST
               WHERE PATIENT_ID = :nd_hosp_no;
			   /* AND OPERATING_FACILITY_ID = :nd_operating_facility_id; */
}
/*-----------------------------------------------------*/
////////////////// 03.07.2005

fetch_mp_ext_per_nric() 
{
	rl_national_id_num.arr[0]				  = '\0';
	rl_alternate_id_num.arr[0]				  = '\0';
	rl_national_id_num.len					  = 0;
	rl_alternate_id_num.len                   = 0;

    EXEC SQL SELECT NATIONAL_ID_NO,
	        //ALT_ID1_NO
			NVL(ALT_ID1_NO,NVL(ALT_ID2_NO,NVL(ALT_ID3_NO,NVL(ALT_ID4_NO,' ')))) //18.06.2008 against ML-SD-CRF-20224

	           INTO :rl_national_id_num,:rl_alternate_id_num
               FROM MP_EXT_PERSON
              WHERE PERSON_ID = :nd_hosp_no;

	if (NODATAFOUND);    

    if (OERROR);

	rl_national_id_num.arr[rl_national_id_num.len]		 = '\0';
	rl_alternate_id_num.arr[rl_alternate_id_num.len]	 = '\0';

}

/*-----------------------------------------------------*/
fetch_pat_name()
{
    rl_pat_title.arr[0]     = '\0';
    rl_pat_long_name.arr[0]     = '\0';
    rl_pat_short_name.arr[0]     = '\0';
    rl_pat_sex.arr[0]           = '\0';
    rl_pat_nationality.arr[0]           = '\0';
    rl_pat_dob_no_of_days.arr[0]           = '\0';
    rl_pat_date_of_birth.arr[0]            = '\0';
    rl_pat_blood_group.arr[0]              = '\0';
    rl_pat_g6pd.arr[0]              = '\0';
    rl_pat_sicc.arr[0]              = '\0';
    rl_pat_hbl4_1.arr[0]              = '\0';
    rl_pat_hbl4_2.arr[0]              = '\0';
	rl_actual_dob_yn.arr[0]			  = '\0';
	rl_race_code.arr[0]				  = '\0';
	rl_age_years.arr[0]				  = '\0';
	rl_location.arr[0]				  = '\0';
	rl_national_id_num.arr[0]				  = '\0';
	rl_alternate_id_num.arr[0]				  = '\0';

    rl_pat_title.len     = 0;
    rl_pat_long_name.len         = 0;
    rl_pat_short_name.len         = 0;
    rl_pat_sex.len         = 0;
    rl_pat_nationality.len         = 0;
    rl_pat_dob_no_of_days.len         = 0;
    rl_pat_date_of_birth.len          = 0;
    rl_pat_g6pd.len                   = 0;
    rl_pat_sicc.len                   = 0;
    rl_pat_hbl4_1.len                   = 0;
    rl_pat_hbl4_2.len                   = 0;
	rl_actual_dob_yn.len				= 0;
	rl_race_code.len					= 0;
	rl_age_years.len					= 0;
	rl_location.len						= 0;
	rl_national_id_num.len				= 0;
	rl_alternate_id_num.len                = 0;

	if(strcmp(rl_hdr_episode_type.arr,"I")==0 || 
       strcmp(rl_hdr_episode_type.arr,"O")==0 ||
	   strcmp(rl_hdr_episode_type.arr,"H")==0 )
    { 

		rl_pat_actual_id.arr[0]   = '\0';
		rl_pat_actual_id.len      = 0;

	if (strcmp(BVNewVersionYN.arr,"Y") == 0)
		EXEC SQL OPEN RL_PAT_MAST_CUR;
    else
		EXEC SQL OPEN RL_PAT_MAST_CUR_ah;

    if (OERROR)
        ins_message(ORA_MESG,"OPEN failed on cursor RL_PAT_MAST_CUR");

	if (strcmp(BVNewVersionYN.arr,"Y") == 0)
    {
			EXEC SQL FETCH RL_PAT_MAST_CUR
					  INTO :rl_pat_title,
				   :rl_pat_short_name,
						   :rl_pat_sex,
						   :rl_pat_nationality,
						   :rl_pat_dob_no_of_days,
						   :rl_pat_date_of_birth, 
						   :rl_actual_dob_yn,
						   :rl_race_code,
						   :rl_age_years,
						   :rl_national_id_num,
						   :rl_alternate_id_num;
	}
	else
	{
			EXEC SQL FETCH RL_PAT_MAST_CUR_ah
					  INTO :rl_pat_title,
				   :rl_pat_short_name,
						   :rl_pat_sex,
						   :rl_pat_nationality,
						   :rl_pat_dob_no_of_days,
						   :rl_pat_date_of_birth, 
						   :rl_actual_dob_yn,
						   :rl_race_code,
						   :rl_age_years,
						   :rl_national_id_num;
	}

	close_mast_cur();

	if (l_print_health_card_yn.arr[0]=='Y') 
	{
		get_health_card_num();
	}

    if (OERROR)
       ins_message(ORA_MESG,"Error with MP_PATIENT_MAST fetch");
    else
	   if(NODATAFOUND) 
	   {    
			rl_pat_actual_id.arr[0]   = '\0';
			rl_pat_actual_id.len      = 0;

                EXEC SQL OPEN RL_PAT_MAST3_CUR;
    		EXEC SQL FETCH RL_PAT_MAST3_CUR
              	         INTO   :rl_pat_title,
			        :rl_pat_short_name,
                   		:rl_pat_sex,
                   		:rl_pat_nationality,
                   		:rl_pat_dob_no_of_days,
                   		:rl_pat_date_of_birth,
						:rl_pat_actual_id,
						:rl_actual_dob_yn,
						:rl_race_code,
						:rl_age_years, 
						:rl_location;
               if (OERROR)
                  ins_message(ORA_MESG,"Error with RL_PATIENT_MAST fetch");	
               else
					if(NODATAFOUND);

			close_mast3_cur();

       }
	}
	else
	{
	    rl_pat_actual_id.arr[0]   = '\0';
		rl_pat_actual_id.len      = 0;
             EXEC SQL OPEN RL_PAT_MAST3_CUR;
    		EXEC SQL FETCH RL_PAT_MAST3_CUR
              	         INTO   :rl_pat_title,
			        :rl_pat_short_name,
                   		:rl_pat_sex,
                   		:rl_pat_nationality,
                   		:rl_pat_dob_no_of_days,
                   		:rl_pat_date_of_birth,
						:rl_pat_actual_id,
						:rl_actual_dob_yn,
						:rl_race_code, 
						:rl_age_years,
						:rl_location;
               if (OERROR)
                  ins_message(ORA_MESG,"Error with RL_PATIENT_MAST fetch");	
               else
	          if(NODATAFOUND);

			close_mast3_cur();


	}
    rl_pat_title.arr[rl_pat_title.len]                   = '\0';
    rl_pat_long_name.arr[rl_pat_long_name.len]           = '\0';
    rl_pat_short_name.arr[rl_pat_short_name.len]         = '\0';
    rl_pat_long_name.arr[rl_pat_long_name.len]           = '\0';
    rl_pat_short_name.arr[rl_pat_short_name.len]         = '\0';
    rl_pat_sex.arr[rl_pat_sex.len]                       = '\0';
    rl_pat_nationality.arr[rl_pat_nationality.len]       = '\0';
    rl_pat_dob_no_of_days.arr[rl_pat_dob_no_of_days.len] = '\0';
    rl_pat_date_of_birth.arr[rl_pat_date_of_birth.len]   = '\0';
    rl_pat_actual_id.arr[rl_pat_actual_id.len]           = '\0';
	rl_actual_dob_yn.arr[rl_actual_dob_yn.len]			 = '\0';
	rl_race_code.arr[rl_race_code.len]					 = '\0';
	rl_age_years.arr[rl_age_years.len]					 = '\0';
	rl_location.arr[rl_location.len]					 = '\0';
	rl_national_id_num.arr[rl_national_id_num.len]		 = '\0';
	rl_alternate_id_num.arr[rl_alternate_id_num.len]	 = '\0';

}

/*-----------------------------------------------------*/
fetch_spec_desc()   
{

//    EXEC SQL OPEN RL_SPECIMEN_TYPE_CODE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_SPECIMEN_TYPE_CODE_CUR");

    rl_spc_specimen_desc.arr[0] = '\0';
    rl_spc_specimen_desc.len    = 0;

		EXEC SQL SELECT SPECIMEN_DESC
				 INTO :rl_spc_specimen_desc
				 FROM RL_SPECIMEN_TYPE_CODE_lang_vw
				 WHERE SPECIMEN_TYPE_CODE = :rl_hdr_specimen_type_code
				 and language_id = :language_id;

/*
    EXEC SQL FETCH RL_SPECIMEN_TYPE_CODE_CUR
              INTO :rl_spc_specimen_desc;

*/
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_SPECIMEN_TYPE_CODE_CUR");

    rl_spc_specimen_desc.arr[rl_spc_specimen_desc.len] = '\0';

}
/*-----------------------------------------------------*/

fetch_test_code(loc_tst_code)
char loc_tst_code[];
{
    strcpy(rl_loc_test_code.arr,loc_tst_code);
    rl_loc_test_code.len  =  strlen(rl_loc_test_code.arr);

//    EXEC SQL OPEN RL_TEST_CODE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_TEST_CODE_CUR");

    rl_tst_cd_short_desc.arr[0]         = '\0';
    rl_tst_cd_numeric_result_yn.arr[0]  = '\0';
    rl_tst_cd_age_sex_range_yn.arr[0]   = '\0';
    rl_tst_cd_function_yn.arr[0]        = '\0';
    rl_tst_cd_print_report_yn.arr[0]    = '\0';
    rl_tst_cd_low_value_normal.arr[0]   = '\0';
    rl_tst_cd_high_value_normal.arr[0]  = '\0';
    rl_tst_cd_test_units_2.arr[0]   = '\0';
    rl_tst_cd_group_test_yn.arr[0]      = '\0';
    rl_tst_cd_text_block_yn.arr[0]      = '\0';
    rl_tst_cd_culture_test_yn.arr[0]    = '\0';
    rl_tst_cd_snomed_yn.arr[0]          = '\0';
    rl_tst_cd_range_cmt_2.arr[0]        = '\0';
	rl_tst_cd_inh_rep_yn.arr[0]		    = '\0';
	rl_tst_cd_conf_yn.arr[0]		    = '\0';
	rl_tst_cd_oth_units.arr[0]			= '\0';

    rl_tst_cd_short_desc.len            = 0;
    rl_tst_cd_numeric_result_yn.len     = 0;
    rl_tst_cd_age_sex_range_yn.len      = 0;
    rl_tst_cd_function_yn.len           = 0;
    rl_tst_cd_print_report_yn.len       = 0;
    rl_tst_cd_low_value_normal.len      = 0;
    rl_tst_cd_high_value_normal.len     = 0;
    rl_tst_cd_test_units_2.len      = 0;
    rl_tst_cd_group_test_yn.len         = 0;
    rl_tst_cd_text_block_yn.len         = 0;
    rl_tst_cd_culture_test_yn.len       = 0;
    rl_tst_cd_snomed_yn.len             = 0;
    rl_tst_cd_range_cmt_2.len           = 0;
	rl_tst_cd_inh_rep_yn.len		    = 0;
	rl_tst_cd_conf_yn.len				= 0;
	rl_tst_cd_oth_units.len             = 0;  /// 26.01.2006
	

    rl_tst_cd_no_of_decimals = 0;
    rl_tst_cd_significant_digit = 0;

    if (strcmp(l_customer_id.arr, "MC") == 0) //added for KDAH-SCF-0546
	{
	EXEC SQL SELECT SUBSTR(b.LONG_DESC,1,38), //added by madhusudhan for GHL-SCF-1104
                    a.NUMERIC_RESULT_YN,
                    a.AGE_SEX_RANGE_YN,
                    a.FUNCTION_YN,
                    a.PRINT_NAME_YN,
                    a.LOW_VALUE_NORMAL,
                    a.HIGH_VALUE_NORMAL,
                     a.GROUP_TEST_YN,
                     a.TEXT_BLOCK_YN,
                     a.CULTURE_TEST_YN,
                     a.SNOMED_YN,
                     a.TEST_UNITS,
                     NVL(a.NO_OF_DECIMALS,0),
                     NVL(a.SIGNIFICANT_DIGIT,0),
					 a.REF_RANGE_COMMENT,
					 NVL(a.INHIBIT_REPORT_YN,'N'),
					 NVL(a.CONFIDENTIAL_YN,'N'),
					 a.OTHER_TEST_UNITS
              INTO :rl_tst_cd_short_desc,
                   :rl_tst_cd_numeric_result_yn,
                   :rl_tst_cd_age_sex_range_yn,
                   :rl_tst_cd_function_yn,
                   :rl_tst_cd_print_report_yn,
                   :rl_tst_cd_low_value_normal,
                   :rl_tst_cd_high_value_normal,
                   :rl_tst_cd_group_test_yn,
                   :rl_tst_cd_text_block_yn,
                   :rl_tst_cd_culture_test_yn,
                   :rl_tst_cd_snomed_yn,
                   :rl_tst_cd_test_units_2,
                   :rl_tst_cd_no_of_decimals,
                   :rl_tst_cd_significant_digit,
                   :rl_tst_cd_range_cmt_2,
				   :rl_tst_cd_inh_rep_yn,
				   :rl_tst_cd_conf_yn,
				   :rl_tst_cd_oth_units
                FROM rl_test_code a, RL_TEST_CODE_lang_vw b
               WHERE a.test_code = b.test_code
			   and a.TEST_CODE = :rl_loc_test_code
                 AND NVL(a.INHIBIT_REPORT_YN,'N') = 'N'
				 and b.language_id = :language_id;
     }
	 
	 else//added for KDAH-SCF-0546
	 
	 {
	 EXEC SQL SELECT b.LONG_DESC, 
                    a.NUMERIC_RESULT_YN,
                    a.AGE_SEX_RANGE_YN,
                    a.FUNCTION_YN,
                    a.PRINT_NAME_YN,
                    a.LOW_VALUE_NORMAL,
                    a.HIGH_VALUE_NORMAL,
                     a.GROUP_TEST_YN,
                     a.TEXT_BLOCK_YN,
                     a.CULTURE_TEST_YN,
                     a.SNOMED_YN,
                     a.TEST_UNITS,
                     NVL(a.NO_OF_DECIMALS,0),
                     NVL(a.SIGNIFICANT_DIGIT,0),
					 a.REF_RANGE_COMMENT,
					 NVL(a.INHIBIT_REPORT_YN,'N'),
					 NVL(a.CONFIDENTIAL_YN,'N'),
					 a.OTHER_TEST_UNITS
              INTO :rl_tst_cd_short_desc,
                   :rl_tst_cd_numeric_result_yn,
                   :rl_tst_cd_age_sex_range_yn,
                   :rl_tst_cd_function_yn,
                   :rl_tst_cd_print_report_yn,
                   :rl_tst_cd_low_value_normal,
                   :rl_tst_cd_high_value_normal,
                   :rl_tst_cd_group_test_yn,
                   :rl_tst_cd_text_block_yn,
                   :rl_tst_cd_culture_test_yn,
                   :rl_tst_cd_snomed_yn,
                   :rl_tst_cd_test_units_2,
                   :rl_tst_cd_no_of_decimals,
                   :rl_tst_cd_significant_digit,
                   :rl_tst_cd_range_cmt_2,
				   :rl_tst_cd_inh_rep_yn,
				   :rl_tst_cd_conf_yn,
				   :rl_tst_cd_oth_units
                FROM rl_test_code a, RL_TEST_CODE_lang_vw b
               WHERE a.test_code = b.test_code
			   and a.TEST_CODE = :rl_loc_test_code
                 AND NVL(a.INHIBIT_REPORT_YN,'N') = 'N'
				 and b.language_id = :language_id;
	 
	 }
/*
    EXEC SQL FETCH RL_TEST_CODE_CUR
              INTO :rl_tst_cd_short_desc,
                   :rl_tst_cd_numeric_result_yn,
                   :rl_tst_cd_age_sex_range_yn,
                   :rl_tst_cd_function_yn,
                   :rl_tst_cd_print_report_yn,
                   :rl_tst_cd_low_value_normal,
                   :rl_tst_cd_high_value_normal,
                   :rl_tst_cd_group_test_yn,
                   :rl_tst_cd_text_block_yn,
                   :rl_tst_cd_culture_test_yn,
                   :rl_tst_cd_snomed_yn,
                   :rl_tst_cd_test_units_2,
                   :rl_tst_cd_no_of_decimals,
                   :rl_tst_cd_significant_digit,
                   :rl_tst_cd_range_cmt_2,
				   :rl_tst_cd_inh_rep_yn,
				   :rl_tst_cd_conf_yn;

*/

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_TEST_CODE_CUR");

    rl_tst_cd_short_desc.arr[rl_tst_cd_short_desc.len] = '\0';
    rl_tst_cd_numeric_result_yn.arr[rl_tst_cd_numeric_result_yn.len] = '\0';
    rl_tst_cd_age_sex_range_yn.arr[rl_tst_cd_age_sex_range_yn.len] = '\0';
    rl_tst_cd_function_yn.arr[rl_tst_cd_function_yn.len] = '\0';
    rl_tst_cd_print_report_yn.arr[rl_tst_cd_print_report_yn.len] = '\0';
    rl_tst_cd_low_value_normal.arr[rl_tst_cd_low_value_normal.len] = '\0';
    rl_tst_cd_high_value_normal.arr[rl_tst_cd_high_value_normal.len] = '\0';
    rl_tst_cd_test_units_2.arr[rl_tst_cd_test_units_2.len] = '\0';
    rl_tst_cd_group_test_yn.arr[rl_tst_cd_group_test_yn.len] = '\0';
    rl_tst_cd_text_block_yn.arr[rl_tst_cd_text_block_yn.len] = '\0';
    rl_tst_cd_culture_test_yn.arr[rl_tst_cd_culture_test_yn.len] = '\0';
    rl_tst_cd_snomed_yn.arr[rl_tst_cd_snomed_yn.len] = '\0';
    rl_tst_cd_range_cmt_2.arr[rl_tst_cd_range_cmt_2.len] = '\0';
    rl_tst_cd_inh_rep_yn.arr[rl_tst_cd_inh_rep_yn.len] = '\0';
	rl_tst_cd_conf_yn.arr[rl_tst_cd_conf_yn.len]	   = '\0';		
	rl_tst_cd_oth_units.arr[rl_tst_cd_oth_units.len]   = '\0';

    rl_tst_cd_no_of_decimals = rl_tst_cd_no_of_decimals>9?9:
                         rl_tst_cd_no_of_decimals;
    rl_tst_cd_significant_digit = rl_tst_cd_no_of_decimals>9?9:
                         rl_tst_cd_significant_digit;

    if (sqlca.sqlerrd[2]) tst_cd_ind = 1;
    return (sqlca.sqlerrd[2]);
}
/*-----------------------------------------------------*/
check_profile_yn(loc_tst_code)
char loc_tst_code[];
{
    strcpy(rl_loc_grp_test_code.arr,loc_tst_code);
    rl_loc_grp_test_code.len  =  strlen(rl_loc_grp_test_code.arr);

	rl_tst_cd_profile_yn.arr[0]		    = '\0';
	rl_tst_cd_profile_yn.len			= 0;

    EXEC SQL SELECT  NVL(PROFILE_YN,'N')    /// 21.05.2005    
               INTO :rl_tst_cd_profile_yn
               FROM  RL_TEST_CODE
              WHERE  TEST_CODE = :rl_loc_grp_test_code
                AND  NVL(GROUP_TEST_YN,'N') = 'Y';

	if (NODATAFOUND);
	   
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_TEST_CODE_CUR..2");

	rl_tst_cd_profile_yn.arr[rl_tst_cd_profile_yn.len]	   = '\0';		

}
/*-----------------------------------------------------*/


fetch_source()
{

    get_patient_admn_doc_n_curr_locn();

/*************************************************** commented on 03.09.2012 against KDAH-CRF-0210 and modified as below.
    if (rl_hdr_source_type.arr[0] == 'W') 
      {
      EXEC SQL  
		//	SELECT LONG_DESC
		//	INTO :rl_source_short_name
        //    FROM IP_WARD
        //    WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
		//	AND WARD_CODE = :rl_hdr_source_code;
		
			SELECT long_desc INTO :rl_source_short_name
			FROM   ip_nursing_unit_lang_vw 
			WHERE  facility_id = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND NURSING_UNIT_CODE = :rl_hdr_source_code
			and language_id = :language_id;
      }
    else if (rl_hdr_source_type.arr[0] == 'E') 
      {
      EXEC SQL  SELECT LONG_DESC,
		       NO_OF_COPIES
		  INTO :rl_source_short_name,
		       :sy_ref_no_of_copies
                  FROM RL_REFERRAL_lang_vw
                 WHERE REFERRAL_CODE = :rl_hdr_source_code
				 and language_id = :language_id;
      }
    else if (rl_hdr_source_type.arr[0] == 'C') 
      {
      EXEC SQL  SELECT LONG_DESC
		  INTO :rl_source_short_name
                  FROM OP_CLINIC_lang_vw
                 WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
				   AND CLINIC_CODE = :rl_hdr_source_code
				   and language_id = :language_id;
      }
    else
       ins_message(ORA_MESG,"Invalid Source type in Request Header");
*******************************************************************************/

    if (l_pat_curr_source_type.arr[0] == 'W') 
      {
      EXEC SQL  
			SELECT long_desc INTO :rl_source_short_name
			FROM   ip_nursing_unit_lang_vw 
			WHERE  facility_id = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND NURSING_UNIT_CODE = :l_pat_curr_source_code
			and language_id = :language_id;
      }
    else if (l_pat_curr_source_type.arr[0] == 'E') 
      {
      EXEC SQL  
	       SELECT LONG_DESC,NO_OF_COPIES INTO :rl_source_short_name,:sy_ref_no_of_copies
           FROM RL_REFERRAL_lang_vw
           WHERE REFERRAL_CODE = :l_pat_curr_source_code
		   AND   language_id = :language_id;
      }
    else if (l_pat_curr_source_type.arr[0] == 'C') 
      {
      EXEC SQL  
	       SELECT LONG_DESC INTO :rl_source_short_name
           FROM OP_CLINIC_lang_vw
           WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
		   AND CLINIC_CODE = :l_pat_curr_source_code
		   AND language_id = :language_id;
      }
    else
       ins_message(ORA_MESG,"Invalid Source type in Request Header");


	      
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on SOURCE master ");

    rl_source_short_name.arr[rl_source_short_name.len] = '\0';
}
/*-----------------------------------------------------*/

fetch_consultant()
{

/****************************************************
    if (rl_hdr_episode_type.arr[0] == 'I') 
      {
      EXEC SQL  SELECT FULL_NAME
		  INTO :rl_consultant_short_name
                  FROM SY_PHYSICIAN_MAST_lang_vw
                 WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
				   AND PHYSICIAN_ID = :rl_hdr_consultant_code
				   and language_id = :language_id;
      }
    else if (rl_hdr_episode_type.arr[0] == 'R' || rl_hdr_episode_type.arr[0] == 'H')
      {
      EXEC SQL  SELECT LONG_NAME
		  INTO :rl_consultant_short_name
                  FROM RL_CONSULTANTS_lang_vw
                 WHERE REF_CONSULTANT_ID = :rl_hdr_consultant_code
				 and language_id = :language_id;
      }
    else if (rl_hdr_episode_type.arr[0] == 'O') 
      {
      EXEC SQL  SELECT FULL_NAME
		  INTO :rl_consultant_short_name
                  FROM SY_PHYSICIAN_MAST_lang_vw
                 WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
				   AND PHYSICIAN_ID = :rl_hdr_consultant_code
				   and language_id = :language_id;
      }
    else
       ins_message(ORA_MESG,"Invalid Episode type in Request Header");

**********************************************/

    if (rl_hdr_episode_type.arr[0] == 'I') 
      {
      EXEC SQL  SELECT FULL_NAME
		  INTO :rl_consultant_short_name
                  FROM SY_PHYSICIAN_MAST_lang_vw
                 WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
				   AND PHYSICIAN_ID = :l_pat_admit_pract_id
				   and language_id = :language_id;
      }
    else if (rl_hdr_episode_type.arr[0] == 'R' || rl_hdr_episode_type.arr[0] == 'H')
      {
      EXEC SQL  SELECT LONG_NAME
		  INTO :rl_consultant_short_name
                  FROM RL_CONSULTANTS_lang_vw
                 WHERE REF_CONSULTANT_ID = :l_pat_admit_pract_id
				 and language_id = :language_id;
      }
    else if (rl_hdr_episode_type.arr[0] == 'O') 
      {
      EXEC SQL  SELECT FULL_NAME
		  INTO :rl_consultant_short_name
                  FROM SY_PHYSICIAN_MAST_lang_vw
                 WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
				   AND PHYSICIAN_ID = :l_pat_admit_pract_id
				   and language_id = :language_id;
      }
    else
       ins_message(ORA_MESG,"Invalid Episode type in Request Header");

	      
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on CONSULTANT Master ");

    rl_consultant_short_name.arr[rl_consultant_short_name.len] = '\0';
}
/*-----------------------------------------------------*/
fetch_section()
{

//    EXEC SQL OPEN RL_SECTION_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_SECTION_CUR");

    rl_section_short_name.arr[0] 	= '\0';
    rl_section_short_name.len		= 0;

    rl_section_ind.arr[0] 	= '\0';
    rl_section_ind.len		= 0;

    rl_use_sample_anatomy_ind.arr[0] 	= '\0';
    rl_use_sample_anatomy_ind.len		= 0;
	  
    EXEC SQL SELECT SUBSTR(LONG_NAME,1,30),NVL(SECTION_IND,'!!'),NVL(USE_SAMPLE_ANATOMY_IND,'!!')
			 INTO :rl_section_short_name,:rl_section_ind, :rl_use_sample_anatomy_ind
             FROM RL_SECTION_CODE_lang_vw
             WHERE SECTION_CODE = :rl_hdr_section_code
			 and language_id = :language_id;

/*   
    EXEC SQL FETCH RL_SECTION_CUR
              INTO :rl_section_short_name;

*/
    rl_section_short_name.arr[rl_section_short_name.len] = '\0';

    rl_section_ind.arr[rl_section_ind.len] = '\0';

    rl_use_sample_anatomy_ind.arr[rl_use_sample_anatomy_ind.len] = '\0';

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_SECTION_CUR");

}
/*-----------------------------------------------------*/

fetch_age_sex_range()
{

//    EXEC SQL OPEN RL_AGE_SEX_RANGE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_AGE_SEX_RANGE_CUR",0,"");

    rl_tst_ran_low_val_nor.arr[0]      = '\0';
    rl_tst_ran_high_val_nor.arr[0]      = '\0';

    rl_tst_ran_low_val_nor.len         = 0;
    rl_tst_ran_high_val_nor.len         = 0;

  EXEC SQL SELECT NVL(physician_age_low_value, LOW_VALUE_NORMAL),
                     NVL(physician_age_high_value, HIGH_VALUE_NORMAL)
		   INTO :rl_tst_ran_low_val_nor,
                   :rl_tst_ran_high_val_nor
           FROM RL_AGE_SEX_RANGE
           WHERE TEST_CODE = :rl_tst_test_code
           AND SEX       = :rl_pat_sex
           AND :rl_pat_dob_no_of_days
	          BETWEEN CALC_MIN_AGE_IN_DAYS  AND 
           CALC_MAX_AGE_IN_DAYS;

/*
    EXEC SQL FETCH RL_AGE_SEX_RANGE_CUR
              INTO :rl_tst_ran_low_val_nor,
                   :rl_tst_ran_high_val_nor;
*/
 
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_AGE_SEX_RANGE_CUR",0,"");

    rl_tst_ran_low_val_nor.arr[rl_tst_ran_low_val_nor.len] = '\0';
    rl_tst_ran_high_val_nor.arr[rl_tst_ran_high_val_nor.len] = '\0';
}
/*-----------------------------------------------------*/

open_comments()
{
    EXEC SQL OPEN RL_COMM_FOR_TEST_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_COMM_FOR_TEST_CUR");
}
/*-----------------------------------------------------*/
fetch_comments()
{
#ifdef DEBUG
       printf("In fetch_comments() \n");
#endif

    rl_comm_tst_comm_txt.arr[0]     = '\0';
    rl_comm_tst_comm_txt.len        = 0;

    EXEC SQL FETCH RL_COMM_FOR_TEST_CUR
              INTO :rl_comm_tst_comm_txt;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_COMM_FOR_TEST_CUR");

    rl_comm_tst_comm_txt.arr[rl_comm_tst_comm_txt.len] = '\0';

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
print_comment_desc1234()
{
  if (rl_tst_result_comment_desc1.len || rl_tst_result_comment_desc2.len ||
     rl_tst_result_comment_desc3.len || rl_tst_result_comment_desc4.len)
  {  
     something_to_print = 1;
	 something_to_print_for_test = 1;
     if(group && !group_printed)
     {   print_group_test_desc();
	     group_printed = 1;
     }
     if(test_printed)
	    numeric_value_flag = TRUE;
     else
	 {
	    numeric_value_flag = FALSE;
        fprintf(fp,"%-40.40s",test_description);
	    test_printed = 1;
     }

/**************** KDAH-CRF-260 The result comment code selection is added ************/
	 
     if (rl_tst_result_comment_desc1.len != 0)
	 {
		 get_print_bold_comments(1);	 
		 
		 if (bold_print_for_comm1 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }
         print_line_check(rl_tst_result_comment_desc1.arr);

		if (bold_print_for_comm1 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    
		 }		 
	}
     
	 if (rl_tst_result_comment_desc2.len != 0)
	 {
		 get_print_bold_comments(2);	 
		 
		 if (bold_print_for_comm2 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }
         print_line_check(rl_tst_result_comment_desc2.arr);

		if (bold_print_for_comm2 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    
		 }		 

	}
     
	 if (rl_tst_result_comment_desc3.len != 0)
	 {
		 get_print_bold_comments(3);	 
		 
		 if (bold_print_for_comm3 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }
         print_line_check(rl_tst_result_comment_desc3.arr);

		if (bold_print_for_comm3 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    
		 }		 

	 }
	 
     if (rl_tst_result_comment_desc4.len != 0)
	 {
		 get_print_bold_comments(4);	 
		 
		 if (bold_print_for_comm4 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }
         print_line_check(rl_tst_result_comment_desc4.arr);

		if (bold_print_for_comm4 == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    
		 }		 
	 
      }

  }
}
/*-----------------------------------------------------*/
print_prel_release_desc()
{
  if (rl_legend_for_pre_result.len)
  {  

     if(group && !group_printed)
     {   print_group_test_desc();
	     group_printed = 1;
     }
     if(test_printed)
	    numeric_value_flag = TRUE;
     else
	 {
	    numeric_value_flag = FALSE;
        fprintf(fp,"%-40.40s",test_description);
	    test_printed = 1;
     }
     print_line_check(rl_legend_for_pre_result.arr);

  }
}
/*-----------------------------------------------------*/

fetch_snomed_desc12345()
{
    
//	EXEC SQL OPEN RL_SNOMED_CODE_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_SNOMED_CODE_CUR");

#ifdef DEBUG
       printf("In fetch_snomed_desc1234() \n");
#endif
    rl_snomed_desc1.arr[0]          = '\0';
    rl_snomed_desc2.arr[0]          = '\0';
    rl_snomed_desc3.arr[0]          = '\0';
    rl_snomed_desc4.arr[0]          = '\0';
    rl_snomed_desc5.arr[0]          = '\0';
    rl_snomed_print_yn.arr[0]       = '\0';
	rl_print_snomed_code_yn.arr[0]  = '\0';

    rl_snomed_desc1.len             = 0;
    rl_snomed_desc2.len             = 0;
    rl_snomed_desc3.len             = 0;
    rl_snomed_desc4.len             = 0;
    rl_snomed_desc5.len             = 0;
    rl_snomed_print_yn.len			= 0;
	rl_print_snomed_code_yn.len		= 0;

/**************** changed on 01/09/2002 
                   :rl_snomed_desc2,
                   :rl_snomed_desc3,
                   :rl_snomed_desc4,
                   :rl_snomed_desc5,

                     DESCRIPTION_2,
                     DESCRIPTION_3,
                     DESCRIPTION_4,
                     DESCRIPTION_5,
**********************************************/

	EXEC SQL SELECT SUBSTR(DESCRIPTION_1, 1, 12),
					 NVL(PRINT_YN, 'N'),
					 NVL(print_code_yn, 'N')
              INTO :rl_snomed_desc1,
    			   :rl_snomed_print_yn,
				   :rl_print_snomed_code_yn
             FROM RL_SNOMED_CODE_lang_vw
             WHERE SNOMED_CODE = :rl_res_snomed_code
			 and language_id = :language_id;

/*
    EXEC SQL FETCH RL_SNOMED_CODE_CUR
              INTO :rl_snomed_desc1,
                   :rl_snomed_desc2,
                   :rl_snomed_desc3,
                   :rl_snomed_desc4,
                   :rl_snomed_desc5,
    		   :rl_snomed_print_yn;

*/

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_SNOMED_CODE_CUR");

    rl_snomed_desc1.arr[rl_snomed_desc1.len] = '\0';
    rl_snomed_desc2.arr[rl_snomed_desc2.len] = '\0';
    rl_snomed_desc3.arr[rl_snomed_desc3.len] = '\0';
    rl_snomed_desc4.arr[rl_snomed_desc4.len] = '\0';
    rl_snomed_desc5.arr[rl_snomed_desc5.len] = '\0';
    rl_snomed_print_yn.arr[rl_snomed_print_yn.len] = '\0';
	rl_print_snomed_code_yn.arr[rl_print_snomed_code_yn.len]	= '\0';

   return (sqlca.sqlerrd[2]);
}
/*-----------------------------------------------------*/
print_snomed_desc12345()
{
  if(rl_snomed_desc1.len  || rl_snomed_desc2.len  ||
     rl_snomed_desc3.len  || rl_snomed_desc4.len  || 
     rl_snomed_desc5.len  || rl_snomed2_desc1.len || 
	 rl_snomed2_desc2.len || rl_snomed2_desc3.len || 
	 rl_snomed2_desc4.len || rl_snomed2_desc5.len ) 
  {
  
    something_to_print = 1;
	something_to_print_for_test = 1;

    if(group && !group_printed)
    {   print_group_test_desc();
	group_printed = 1;
    }
    if(!test_printed)
    {
       fprintf(fp,"%-40.40s\n",test_description);
       test_printed = 1;
    }

/****************************/

//	print_snomed_codes('Y');
	print_str('N');
	fprintf(fp, " - ");
/**************************/

	if (rl_snomed_desc1.len != 0 && rl_snomed_print_yn.arr[0] == 'Y')
    {
		 fprintf(fp,"%-20s",rl_snomed_desc1.arr);
		 fprintf(fp, " | ");
		 if (rl_snomed2_desc1.len == 0 || rl_snomed2_print_yn.arr[0] == 'N')
		 {
			fprintf(fp, "\n");
			page_break(1);
		 }
	}
	else
	{
		if (rl_snomed2_desc1.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
		{
			fprint_repeat(fp,' ',20);	
			fprintf(fp, " | ");
		}
	}

	if (rl_snomed2_desc1.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
	{
			fprintf(fp,"%s\n",rl_snomed2_desc1.arr);
			page_break(1);
	}
	    
/*-----------------------*/    
    if (rl_snomed_desc2.len != 0 && rl_snomed_print_yn.arr[0] == 'Y')
    {
		 print_snomed_codes('N');	
		 fprintf(fp, " - ");
		 fprintf(fp,"%-20s",rl_snomed_desc2.arr);
		 fprintf(fp, " | ");
		 if (rl_snomed2_desc2.len == 0 || rl_snomed2_print_yn.arr[0] == 'N')
		 {
			fprintf(fp, "\n");
			page_break(1);

		 }
	}
	else
	{
		if (rl_snomed2_desc2.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
		{
			print_snomed_codes('N');		
			fprintf(fp, " - ");
			fprint_repeat(fp,' ',20);
			fprintf(fp, " | ");
		}
	}

	if (rl_snomed2_desc2.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
	{
			fprintf(fp,"%s\n",rl_snomed2_desc2.arr);
			page_break(1);
	}
    
/*-----------------------*/    

    if (rl_snomed_desc3.len != 0 && rl_snomed_print_yn.arr[0] == 'Y')
    {

		print_snomed_codes('N');	
		fprintf(fp, " - ");
		fprintf(fp,"%-20s",rl_snomed_desc3.arr);
		fprintf(fp, " | ");
		if (rl_snomed2_desc3.len == 0 || rl_snomed2_print_yn.arr[0] == 'N')
		{
			fprintf(fp, "\n");
			page_break(1);

		}
	}
	else
	{
		if (rl_snomed2_desc3.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
		{
			print_snomed_codes('N');	
			fprintf(fp, " - ");
			fprint_repeat(fp,' ',20);
			fprintf(fp, " | ");
		}
	}

	if (rl_snomed2_desc3.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
	{
	        fprintf(fp,"%s\n",rl_snomed2_desc3.arr);
			page_break(1);
	}

/*-----------------------*/        

    if (rl_snomed_desc4.len != 0 && rl_snomed_print_yn.arr[0] == 'Y')
    {
		 print_snomed_codes('N');	
		 fprintf(fp, " - ");
		 fprintf(fp,"%-20s",rl_snomed_desc4.arr);
		 fprintf(fp, " | ");
		 if (rl_snomed2_desc4.len == 0 || rl_snomed2_print_yn.arr[0] == 'N')
		 {
			fprintf(fp, "\n");
			page_break(1);

		 }
	}
	else
	{
		if (rl_snomed2_desc4.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
		{
			print_snomed_codes('N');	
			fprintf(fp, " - ");
			fprint_repeat(fp,' ',20);
			fprintf(fp, " | ");
		}
	}

	if (rl_snomed2_desc4.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
	{
			fprintf(fp,"%s\n",rl_snomed2_desc4.arr);
			page_break(1);
	}

/*-----------------------*/            

	if (rl_snomed_desc5.len != 0 && rl_snomed_print_yn.arr[0] == 'Y')	
	{
			print_snomed_codes('N');	
			fprintf(fp, " - ");
			fprintf(fp,"%-20s",rl_snomed_desc5.arr);
			fprintf(fp, " | ");
			if (rl_snomed2_desc5.len == 0 || rl_snomed2_print_yn.arr[0] == 'N')
			{
				fprintf(fp, "\n");
				page_break(1);

			}
	}
	else
	{
		if (rl_snomed2_desc5.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
		{
			print_snomed_codes('N');	
			fprintf(fp, " - ");
			fprint_repeat(fp,' ',20);
			fprintf(fp, " | ");
		}
	}

	if (rl_snomed2_desc5.len != 0 && rl_snomed2_print_yn.arr[0] == 'Y')
	{

			fprintf(fp,"%s\n",rl_snomed2_desc5.arr);
			page_break(1);
	}

  
/************* old snomed logic *****************
    if (rl_snomed_desc1.len != 0)
    {
         fprint_repeat(fp,' ',40);
         fprintf(fp,"%s\n",rl_snomed_desc1.arr);
         page_break(1);
    }
    if (rl_snomed_desc2.len != 0)
    {
         fprint_repeat(fp,' ',40);
         fprintf(fp,"%s\n",rl_snomed_desc2.arr);
         page_break(1);
    }
    if (rl_snomed_desc3.len != 0)
    {
         fprint_repeat(fp,' ',40);
         fprintf(fp,"%s\n",rl_snomed_desc3.arr);
         page_break(1);
    }
    if (rl_snomed_desc4.len != 0)
    {
         fprint_repeat(fp,' ',40);
         fprintf(fp,"%s\n",rl_snomed_desc4.arr);
         page_break(1);
    }
    if (rl_snomed_desc5.len != 0)
    {
         fprint_repeat(fp,' ',40);
         fprintf(fp,"%s\n",rl_snomed_desc5.arr);
         page_break(1);
    }
************* UPTO HERE old snomed logic *****************/


  }


  if (rl_res_snomed_mrkr_code1.len != 0) 
  {
     get_snomed_marker_desc1();
	 print_snomed_marker1();
  }
  if (rl_res_snomed_mrkr_code2.len != 0) 
  {
     get_snomed_marker_desc2();
	 print_snomed_marker2();
  }	

}
/*-----------------------------------------------------*/

fprint_repeat(l_fp,l_prn_chr,l_no)
FILE *l_fp;
char l_prn_chr;
int  l_no;
{
   int l_i = 0;

   for (l_i = 0;l_i < l_no;l_i++)
        fputc(l_prn_chr,l_fp);
}
/*-----------------------------------------------------*/

page_break(l_skip)
int l_skip;
{
    //lctr+= l_skip; //commented out for GHL-SCF-1130.1
	
	//added for KDAH tf
	if (strcmp(l_customer_id.arr, "KDAH") == 0)
	{
		lctr+= l_skip;
	}
	//
    if (lctr == 0 || lctr > MAX_LINES)
    {
       if (lctr != 0)
	   {
		   if (strcmp(rl_report_format.arr, "1") == 0)
               print_footer(1);
		  else if (strcmp(rl_report_format.arr, "2") == 0)
				print_footer2(1);
		  else if (strcmp(rl_report_format.arr, "4") == 0 )
				print_footer4(1);
		  else if (strcmp(rl_report_format.arr, "5") == 0 || strcmp(rl_report_format.arr, "7") == 0)
				print_footer5(1);
		  else  if (strcmp(rl_report_format.arr, "6") == 0 )
				print_footer6(1);
		  else
				print_footer3(2);

		}


					  if (org_yn)   ////  to print Organism Heading 
					    oflag = 1;   

					  if (antb_yn)  ///  to print Antibiotic Heading
						a_flag = 1;

					   if (strcmp(rl_report_format.arr, "1") == 0)
					   {
//qatar
							print_header();
						}
					   else if (strcmp(rl_report_format.arr, "2") == 0)
					   {
//kn
							print_header2();  

							/****** added the below on 19.03.2005  ******/

							if ((test_contd == 0) && (rl_print_test_name_in_contd_page.arr[0] == 'Y') )
							{
								 if(p_print_name_yn.arr[0] == 'Y' && group)
								 {
									sprintf(text_line,"%s%s",p_test_desc.arr,"(Contd..)");
									print_line(text_line);
								 }
								 if(rl_tst_cd_print_report_yn.arr[0] == 'Y')
								 {
								    sprintf(text_line,"%s%s",rl_tst_cd_short_desc.arr,"(Contd..)");
								    print_line(text_line);
								 }
							}
							/****** upto here added on 19.03.2005  ******/

					   }
					   else if (strcmp(rl_report_format.arr, "4") == 0 || strcmp(rl_report_format.arr, "5") == 0)
					   {
//ml
							print_header4();
					   }
					   else  if (strcmp(rl_report_format.arr, "7") == 0)
					   {
//MAFRAQ
							print_header7();
					   }
					   else  if (strcmp(rl_report_format.arr, "6") == 0)
					   {
//ARTEMIS
							print_header6();
					   }
					   else
					   {
//mf & su
							print_header3();
					   }

    }
	if (strcmp(l_customer_id.arr, "MC") == 0)
	{
	lctr+= l_skip; //added for GHL-SCF-1130.1
	}
}
/*-----------------------------------------------------*/
open_result_text()
{
    EXEC SQL OPEN RL_RESULT_TEXT_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_RESULT_TEXT_CUR");
}
/*-----------------------------------------------------*/

fetch_result_text()
{
#ifdef DEBUG
       printf("In fetch_result_text() \n");
#endif

    rl_res_result_text.arr[0]  = '\0';
    rl_res_result_text.len     = 0;
    rl_print_text_desc_yn.arr[0] = '\0';
    rl_print_text_desc_yn.len = 0;
    rl_print_text_bold_yn.arr[0] = '\0';
    rl_print_text_bold_yn.len = 0;
    rl_print_text_underline_yn.arr[0] = '\0';
    rl_print_text_underline_yn.len = 0;
    rl_res_result_text_code.arr[0] = '\0';
    rl_res_result_text_code.len = 0;

    EXEC SQL FETCH RL_RESULT_TEXT_CUR
              INTO :rl_res_result_text, :rl_res_result_text_code, :rl_print_text_desc_yn,
		:rl_print_text_bold_yn, :rl_print_text_underline_yn;
			  
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_RESULT_TEXT_CUR",0,"");

    rl_res_result_text.arr[rl_res_result_text.len] = '\0';
    rl_print_text_desc_yn.arr[rl_print_text_desc_yn.len] = '\0';
    rl_print_text_bold_yn.arr[rl_print_text_bold_yn.len] = '\0';
    rl_print_text_underline_yn.arr[rl_print_text_underline_yn.len] = '\0';
    rl_res_result_text_code.arr[rl_res_result_text_code.len]	= '\0';

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
calc_func_and_prn(l_str,l_str2)
char l_str[],l_str2[];
{
   int func_ctr = 0;

   strcpy(rl_loc_test_code.arr,l_str);
   rl_loc_test_code.len = strlen(rl_loc_test_code.arr);
   open_function_cur();
   strcpy(rl_func_str.arr,"");
   _flushall();
   while (fetch_function_cur())
   {
        func_ctr ++;
        strcpy(rl_func_value.arr,rl_func_operand_1.arr);

        if (rl_func_operand_1_type.arr[0] == 'T')
             get_rl_test_result(rl_func_operand_1.arr);

	if(test_result_found == 0)
	{
	   l_str2[0] = '\0'; 
	   break;
        }
        strcat(rl_func_str.arr,rl_func_value.arr);
        strcat(rl_func_str.arr," ");

        if (func_ctr != 1)
             calculate_value();

        if (rl_func_operator_1.len == 0)
             break;

        strcat(rl_func_str.arr,rl_func_operator_1.arr);
        strcat(rl_func_str.arr," ");
        strcpy(rl_func_value.arr,rl_func_operand_2.arr);

        if (rl_func_operand_2_type.arr[0] == 'T')
             get_rl_test_result(rl_func_operand_2.arr);

	if(test_result_found == 0)
	{
	   l_str2[0] = '\0'; 
	   break;
        }

        strcat(rl_func_str.arr,rl_func_value.arr);
        strcat(rl_func_str.arr," ");
        calculate_value();

        if (rl_func_operator_2.len == 0)
             break;

        strcat(rl_func_str.arr,rl_func_operator_2.arr);
        strcat(rl_func_str.arr," ");
   }
   ltrim(rl_func_str.arr); 
   rtrim(rl_func_str.arr); 
   
	close_function_cur();

   rl_func_str.arr[9] = '\0';
   if (rl_tst_cd_no_of_decimals != 0 ||
             rl_tst_cd_significant_digit != 0)
      get_deci_sig_dig(rl_func_str.arr, p_no_of_decimals, p_significant_digit);
   rl_func_str.arr[5] = '\0';
   sprintf(l_str2,"%-10s",rl_func_str.arr);
#ifdef DEBUG
    printf("func str is <%s> str is <%s>\n",rl_func_str.arr,l_str2);
#endif
}
/*-----------------------------------------------------*/

open_function_cur()
{
    EXEC SQL OPEN RL_FUNCTION_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_FUNCTION_CUR");
}
/*-----------------------------------------------------*/

fetch_function_cur()
{
    rl_func_operand_1.arr[0]          = '\0';
    rl_func_operand_1_type.arr[0]     = '\0';
    rl_func_operator_1.arr[0]         = '\0';
    rl_func_operand_2.arr[0]          = '\0';
    rl_func_operand_2_type.arr[0]     = '\0';
    rl_func_operator_2.arr[0]         = '\0';

    rl_func_operand_1.len             = 0;
    rl_func_operand_1_type.len        = 0;
    rl_func_operator_1.len            = 0;
    rl_func_operand_2.len             = 0;
    rl_func_operand_2_type.len        = 0;
    rl_func_operator_2.len            = 0;

    EXEC SQL FETCH RL_FUNCTION_CUR
              INTO :rl_func_operand_1,
                   :rl_func_operand_1_type,
                   :rl_func_operator_1,
                   :rl_func_operand_2,
                   :rl_func_operand_2_type,
                   :rl_func_operator_2;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_FUNCTION_CUR");

    rl_func_operand_1.arr[rl_func_operand_1.len]           = '\0';
    rl_func_operand_1_type.arr[rl_func_operand_1_type.len] = '\0';
    rl_func_operator_1.arr[rl_func_operator_1.len]         = '\0';
    rl_func_operand_2.arr[rl_func_operand_2.len]           = '\0';
    rl_func_operand_2_type.arr[rl_func_operand_2_type.len] = '\0';
    rl_func_operator_2.arr[rl_func_operator_2.len]         = '\0';

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/

calculate_value()
{
    sprintf(rl_calc_str.arr,"SELECT %s FROM DUAL",rl_func_str.arr);
    rl_calc_str.len = strlen(rl_calc_str.arr);
    EXEC SQL PREPARE STR1 FROM :rl_calc_str;
    if (OERROR)
         ins_message(ORA_MESG,"PREPARE failed on table DUAL");

    EXEC SQL DECLARE CUR1 CURSOR FOR STR1;

    EXEC SQL OPEN CUR1;
    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor CUR1");

    rl_func_str.arr[0] = '\0';
    rl_func_str.len    = 0;

    EXEC SQL FETCH CUR1
              INTO :rl_func_str;

    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor CUR1");

    rl_func_str.arr[rl_func_str.len] = '\0';
    strcat(rl_func_str.arr," ");

	close_cur1_cur();

}
/*-----------------------------------------------------*/
get_rl_test_result(l_test_code)
char l_test_code[];
{
    test_result_found = 1;
    strcpy(rl_loc_test_code.arr,l_test_code);
    rl_loc_test_code.len = strlen(rl_loc_test_code.arr);

    EXEC SQL WHENEVER SQLERROR GOTO err_exit;

    rl_func_value.arr[0] = '\0';
    rl_func_value.len    = 0;

    EXEC SQL SELECT NUMERIC_RESULT INTO :rl_func_value
               FROM RL_TEST_RESULT
              WHERE PATIENT_ID      = :nd_hosp_no
                AND SPECIMEN_NO     = :nd_spec_no
                AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND TEST_CODE       = :rl_loc_test_code;

    if(NODATAFOUND);
/*
    {
	       ins_message(ORA_MESG,"Error occurred at get_rl_test_result() Test not found.");
    }
*/
    rl_func_value.arr[rl_func_value.len] = '\0';

    if(strlen(rl_func_value.arr) == 0)
       test_result_found = 0;

    return;
err_exit:
   EXEC SQL WHENEVER SQLERROR CONTINUE;
   ins_message(ORA_MESG,"Error occurred at get_rl_test_result()");
   return;

}
/*-----------------------------------------------------*/
print_footer(foot_ind)
int foot_ind;
{
   int fi = 0;
   char l_str[100];
   l_str[0] = '\0'; 

   for(fi=0; fi < 87; fi++)
       fprintf(fp,"%c",'_');

   fprintf(fp,"\n");

   fflush(fp);

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   //fprintf(fp,"Release Date : ");
   fprintf(fp,"%-13.13s: ", local_legend[20]);//added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   //sprintf(l_str,"%s",rl_hdr_released_date.arr);
   sprintf(l_str,"%s",rl_hdr_released_date1.arr);//added for globalisation
   fprintf(fp,"%-25.25s",l_str);
   /*----------------------------------------*/

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   fprintf(fp,"Released/Reviewed By : ");
   fprintf(fp,"%-21.21s: ", local_legend[21]);//added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   fprintf(fp,"%-s\n",rl_hdr_released_by_id.arr);
   /*----------------------------------------*/

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   //fprintf(fp,"Reprint Date : ");
   fprintf(fp,"%-13.13s: ", local_legend[22]);//added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   /*----------------------------------------*/
   
   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
       sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
   else
       sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
   fprintf(fp,"%s",nd_result_printed_date.arr);

   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2 ) 
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);
      //fprintf(fp,"Copy To : ");
      fprintf(fp,"%-8.8s: ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

   if(last_page == 0)
      //sprintf(l_str,"%-73.73s--CONTINUED--"," ");
      sprintf(l_str,"%-73.73s--%-9.9s--"," ",local_legend[24]); //added for globalisation
   else
      //sprintf(l_str,"%-73.73s      --END--"," ");
      sprintf(l_str,"%-73.73s --%-3.3s--"," ",local_legend[25]);// added for globalisation

   fprintf(fp,"%s\f",l_str);

   lctr = 0;
  
}
/*-----------------------------------------------------*/

ltrim(l_str)
char *l_str;
{
   char *ptr;
   ptr = l_str;
   while (*ptr== ' ') ptr++;
   for(;*ptr!='\0';ptr++,l_str++)
    *l_str = *ptr;
   *l_str = '\0';
}
/*-----------------------------------------------------*/

rtrim(l_str)
char *l_str;
{
  while (*l_str != '\0') *l_str++;
  l_str--;
  while (*l_str == ' ') *l_str--;
  *(l_str+1) = '\0';
}

/*-----------------------------------------------------*/
get_deci_sig_dig(loc_str,no_of_dec,signif)

 char *loc_str;
 EXEC SQL BEGIN DECLARE SECTION;
 int no_of_dec;
 EXEC SQL END DECLARE SECTION;
/// int signif;
{
  char significant_digits_applied_yn = 'N';
  signif    = 0;
  d_dec_pos = 0;
  d_after_sig_digit = 0;  

  d_loc_str.arr[0] = '\0';
  d_dec_part.arr[0] = '\0';
  d_int_part.arr[0] = '\0';
  d_sig_part.arr[0] = '\0';

  d_loc_str.len     = 0;
  d_dec_part.len    = 0;
  d_int_part.len    = 0;
  d_sig_part.len    = 0;

  strcpy(d_loc_str.arr,loc_str);
  d_loc_str.len = strlen(d_loc_str.arr);
/*--- The following IF splits the result into two parts : INTEGER & DECIMAL --*/
  EXEC SQL SELECT INSTR(:d_loc_str,'.') INTO :d_dec_pos FROM DUAL;
  if(d_dec_pos > 0)
  {
      EXEC SQL SELECT SUBSTR(:d_loc_str,1,:d_dec_pos - 1) INTO :d_int_part FROM DUAL;
      d_int_part.arr[d_int_part.len] = '\0';
      if(strlen(d_loc_str.arr) > d_dec_pos )
      {
         EXEC SQL SELECT SUBSTR(:d_loc_str,:d_dec_pos + 1,LENGTH(:d_loc_str)) 
			  	    INTO :d_dec_part FROM DUAL;

         d_dec_part.arr[d_dec_part.len] = '\0';
      }
  }
  else
  {
     strcpy(d_int_part.arr,d_loc_str.arr);
     d_int_part.len = strlen(d_int_part.arr);
  }
/*-- This IF is to take care of the INTEGER part of the Result ---------------*/
  if(strlen(d_int_part.arr))
  {
    if(signif > 0)
    {
       if(strlen(d_int_part.arr) <= signif)
       {
          strcpy(d_l_str.arr,d_int_part.arr);
       }
       else
       {
		  significant_digits_applied_yn = 'Y';

		  EXEC SQL SELECT SUBSTR(:d_int_part,1,:signif) INTO :d_sig_part FROM DUAL;


		  d_sig_part.arr[d_sig_part.len] = '\0';

		  EXEC SQL SELECT TO_NUMBER(SUBSTR(:d_int_part,:signif + 1,1)) INTO :d_after_sig_digit FROM DUAL;

		  if(d_after_sig_digit >= 5)
		  {
			 EXEC SQL SELECT TO_CHAR(TO_NUMBER(:d_sig_part) + 1)
								INTO :d_sig_part FROM DUAL;
				 d_sig_part.arr[d_sig_part.len] = '\0'; 
		  }
			  EXEC SQL SELECT RPAD(:d_sig_part,LENGTH(:d_int_part),'0')
				 INTO :d_l_str FROM DUAL;
			  d_l_str.arr[d_l_str.len] = '\0'; 
       }
    }
    else
    {
       strcpy(d_l_str.arr,d_int_part.arr);
    }
  }         
/*-- This IF is to take care of the INTEGER part of the Result ---------------*/
if(strlen(d_dec_part.arr))
{
  if(no_of_dec > 0)
  {
     strcpy(d_l_str.arr,strcat(d_l_str.arr,"."));
     d_l_str.len = strlen(d_l_str.arr);
     if(strlen(d_dec_part.arr) <= no_of_dec) 
     {
        strcpy(d_l_str.arr,strcat(d_l_str.arr,d_dec_part.arr));
	d_l_str.len = strlen(d_l_str.arr);
     }
     else
     {
        EXEC SQL SELECT :d_l_str || SUBSTR(:d_dec_part,1,:no_of_dec)
                   INTO :d_l_str FROM DUAL;
        d_l_str.arr[d_l_str.len] = '\0';
     }
  }
}
  strcpy(loc_str,d_l_str.arr);
}
/*-----------------------------------------------------*/

split_num(l_str,l_var1,l_var2)
char l_str[];
char *l_var1, *l_var2;
{
  int i=0,j=0;
  for (i=0;(l_str[i]!='\0' && l_str[i] != '.');i++,l_var1++)
     *l_var1 = l_str[i];
  *l_var1 = '\0';
  for (i++,j=0;(l_str[i]!='\0');i++,j++,l_var2++)
     *l_var2 = l_str[i];
  *l_var2 = '\0';
}
/*----------------------------------------------------------*/
update_rl_request_header()
{
     EXEC SQL SELECT  COUNT(*) 
			    INTO :c_count
                FROM  RL_REQUEST_DETAIL
               WHERE  SPECIMEN_NO = TO_NUMBER(:c_spec_no)
	             AND  OPERATING_FACILITY_ID = :nd_operating_facility_id
		         AND  NVL(RESULT_STATUS,' ') != 'P';
     if (NODATAFOUND)
	 ;
         if (OERROR)
              ins_message(ORA_MESG,"Failed in function update_rl_request_header()");
         c_count.arr[c_count.len] ='\0';

         if(atoi(c_count.arr) == 0)
		 {
	
			d_found.arr[0]	= '\0';
			d_found.len		= 0;

			EXEC SQL SELECT 'x' 
					   INTO :d_found
			           FROM  RL_REQUEST_HEADER 
			          WHERE  SPECIMEN_NO = TO_NUMBER(:c_spec_no)
			            AND	 OPERATING_FACILITY_ID = :nd_operating_facility_id
						FOR  UPDATE OF STATUS NOWAIT; 

			d_found.arr[d_found.len]		= '\0';

	         if (OERROR)
		          ins_message(ORA_MESG,"Failed in function update_rl_request_header()");
			
	 		if (RESOURCE_BUSY)
			{
				ins_message(ORA_MESG,"OPEN failed resource busy update_rl_request_header()");
			}
			else   
			{

					EXEC SQL UPDATE RL_REQUEST_HEADER 
								SET STATUS = 'P',
// 21.05.2005		RESULT_PRINTED_DATE = to_date(:nd_result_printed_date,'DD/MM/YYYY HH24:MI:SS'),
									MODIFIED_BY_ID = :sy_user_id, // against ah scfUSER,
									MODIFIED_DATE = SYSDATE
							  WHERE SPECIMEN_NO = TO_NUMBER(:c_spec_no)
								AND OPERATING_FACILITY_ID = :nd_operating_facility_id;
			}
		 }

         if (OERROR)
              ins_message(ORA_MESG,"Failed in function update_rl_request_header()");
}
/*----------------------------------------------------------*/
update_rl_request_detail()
{   
    int fetch_c_rl_request_detail();

/***** changed on 06/04/2003 because of windows shut down problem in oracle 9.2 **/
	/************
    strcpy(sql_stmt.arr,"SELECT TEST_CODE, GROUP_TEST_YN FROM RL_REQUEST_DETAIL WHERE SPECIMEN_NO = TO_NUMBER(:v1) AND OPERATING_FACILITY_ID = :nd_operating_facility_id for update of result_status NOWAIT");
    sql_stmt.len = strlen(sql_stmt.arr);
    EXEC SQL WHENEVER SQLERROR GOTO err_exit;
    EXEC SQL PREPARE S FROM :sql_stmt;
    EXEC SQL DECLARE C CURSOR FOR S;
    EXEC SQL OPEN C USING :c_spec_no;
	****************/

	EXEC SQL DECLARE c CURSOR FOR 
				SELECT TEST_CODE, GROUP_TEST_YN 
				FROM RL_REQUEST_DETAIL
				WHERE SPECIMEN_NO = TO_NUMBER(:c_spec_no)
				AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				for update of result_status NOWAIT;


	EXEC SQL OPEN c;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy rl_request_detail");
	}
	else    /// 22.09.2003
	{
		while(1)
		{
			EXEC SQL FETCH C INTO :c_req_dtl_test_code,:c_group_test_yn;
			if(NODATAFOUND)
				return;
		        c_req_dtl_test_code.arr[c_req_dtl_test_code.len] = '\0';
				c_group_test_yn.arr[c_group_test_yn.len] = '\0';
				EXEC SQL SELECT NVL(COUNT(*),0) INTO :c_count
				FROM   RL_TEST_RESULT
				WHERE  SPECIMEN_NO = TO_NUMBER(:c_spec_no)
				AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND GROUP_TEST_CODE = :c_req_dtl_test_code
				AND NVL(STATUS,' ') != 'P';
				if(NODATAFOUND)
					;
				if (OERROR)
					  ins_message(ORA_MESG,"Failed at Select RL_TEST_RESULT in c_request_detail_cur");
				c_count.arr[c_count.len] ='\0';
				if(atoi(c_count.arr) == 0)
				EXEC SQL UPDATE RL_REQUEST_DETAIL 
					     SET RESULT_STATUS = 'P',
						 RESULT_PRINTED_DATE = to_date(:nd_result_printed_date,'DD/MM/YYYY HH24:MI:SS'),
						 MODIFIED_BY_ID = :sy_user_id, ///against ah scf USER,
						 MODIFIED_DATE = SYSDATE
						 WHERE SPECIMEN_NO = TO_NUMBER(:c_spec_no)
						 AND TEST_CODE = :c_req_dtl_test_code;
					if (OERROR)
						ins_message(ORA_MESG,"Failed at update rl_request_detail");
		}

		close_c_cur();
     }    /// 22.09.2003
    return;
err_exit:
   EXEC SQL WHENEVER SQLERROR CONTINUE;
   ins_message(ORA_MESG,"Error occurred at update_rl_request_detail()");
   return;
}
/*----------------------------------------------------------*/
close_all_cur()
{
    EXEC SQL CLOSE RL_REQ_HDR_CUR;
    EXEC SQL CLOSE RL_REQ_DTL_CUR;
    EXEC SQL CLOSE RL_TEST_RESULT_CUR;
//    EXEC SQL CLOSE RL_PAT_MAST_CUR;
//    EXEC SQL CLOSE RL_SPECIMEN_TYPE_CODE_CUR;
//    EXEC SQL CLOSE RL_SECTION_CUR;
//    EXEC SQL CLOSE RL_TEST_CODE_CUR;
//    EXEC SQL CLOSE RL_AGE_SEX_RANGE_CUR;
//    EXEC SQL CLOSE RL_COMM_FOR_TEST_CUR;
//    EXEC SQL CLOSE RL_RESULT_TEXT_CUR;
//    EXEC SQL CLOSE RL_FUNCTION_CUR;
//    EXEC SQL CLOSE RL_TEST_RESULT_CUR2;
//    EXEC SQL CLOSE RL_RESULT_SNOMED_CUR;
//    EXEC SQL CLOSE RL_SNOMED_CODE_CUR;
//    EXEC SQL CLOSE RL_RESULT_ORGANISM_CUR;
//	  EXEC SQL CLOSE RL_ANTIBIOTIC_CUR;
	EXEC SQL CLOSE RL_SENSITIVITY_CUR;
//    EXEC SQL CLOSE RL_ORGANISM_CODE_CUR;
//    EXEC SQL CLOSE RL_ANTIBIOTIC_CODE_CUR;
//    EXEC SQL CLOSE RL_PAT_MAST3_CUR;
//    EXEC SQL CLOSE CUR1;

}

ins_message(int msg_type,char msg[])
{

   
   
   EXEC SQL ROLLBACK;
   er_msg.arr[0] = '\0';
   er_msg.len = 0;
   
   er_msg_type = 0;

   strcpy(er_msg.arr,msg);
   er_msg.len = strlen(msg);
 
   er_msg_type = msg_type;

   sprintf(err_num,"%d",sqlca.sqlcode);

   strcpy(er_msg_num.arr, err_num);
 	er_msg_num.len = strlen(er_msg_num.arr);


   EXEC SQL
   INSERT INTO SY_PROG_MSG
          (OPERATING_FACILITY_ID,PGM_ID,MSG_TYPE,MSG_NUM,MSG_DESC,MSG_DATE_TIME,SESSION_ID,PGM_DATE)
   VALUES 
          (:nd_operating_facility_id,'RLRRSENQ',:er_msg_type, SUBSTR(:er_msg_num,1,6),SUBSTR(:er_msg, 1, 70),SYSDATE,:sy_session_id,
		   :sy_req_date);
   err_flag = 1;
  
  EXEC SQL COMMIT ;
  
}
ins_message1(int msg_type,char msg[])
{

   EXEC SQL ROLLBACK ;

   er_msg.arr[0] = '\0';
   er_msg.len = 0;
   
   er_msg_type = 0;

   strcpy(er_msg.arr,msg);
   er_msg.len = strlen(msg);
 
   er_msg_type = msg_type;

   sprintf(err_num,"%d",sqlca.sqlcode);

   strcpy(er_msg_num.arr, err_num);
 	er_msg_num.len = strlen(er_msg_num.arr);

   EXEC SQL
   INSERT INTO SY_PROG_MSG
          (OPERATING_FACILITY_ID,PGM_ID,MSG_TYPE,MSG_NUM,MSG_DESC,MSG_DATE_TIME,SESSION_ID,PGM_DATE)
   VALUES 
          (:nd_operating_facility_id,'RLRRSENQ',:er_msg_type, SUBSTR(:er_msg_num,1,6),SUBSTR(:er_msg, 1, 70),SYSDATE,:sy_session_id,
		   :sy_req_date);
   
   err_flag = 1;

   EXEC SQL COMMIT;
}

/* SPLITTING THE VARCHAR 2000 INTO 70 CHARACTERS   */
/************************************************/
splitting()
{
  
    int fetch_result_text();
	char word[2];

    strcpy(word1,"F");
	_flushall();
    while(fetch_result_text())
    {
		  something_to_print = 1;
		  something_to_print_for_test = 1;
          hell = strlen(rl_res_result_text.arr);
		  
			if(group && !group_printed)
			{   print_group_test_desc();
				group_printed = 1;
			}
			if(!test_printed  && strlen(test_description))
			{     numeric_value_flag = FALSE;  
				sprintf(text_line,"%37.37s%-40s",test_description," ");
					print_line_check(text_line);
			    test_printed = 1;
			}


/***** added for KDAH requirement to print the long desc of the result text **********/
//sprintf(string_var, "String  -> [%s]  [%s]", rl_print_text_desc_yn.arr, rl_res_result_text_code.arr);
//disp_message(ERR_MESG, string_var);

	if ((strcmp(rl_print_text_desc_yn.arr, "Y") == 0) && (strlen(rl_res_result_text_code.arr) > 0))
	{
		
		get_text_code_desc();

		if (strlen(rl_res_text_code_desc.arr) > 0)
			print_text_code_desc();

	}

         z = 0;
	     clt = 0;
	     strcpy(word1,"F");
	     cntr = 1;
	     qq = 0;

         while(z<hell)
         {
		 		  	
		 
             word[0] = rl_res_result_text.arr[z];
 		     word[1] = '\0';

		     if (strcmp(word,"\n") == 0)
		     {
   
		       cntr = 0;
		       strcpy(word1,"N");
		       qq = z ;
		      }


  		      if(cntr >= 71)
		      {
		   	
			     cmp = cntr;
			     while((rl_res_result_text.arr[z] != 32) && (cmp > 1))
			     {

			         z--;
				     cmp--;
				  
			      }

				  qq = z;
				  			   
			      word[0] = rl_res_result_text.arr[z];
   			      word[1] = '\0';
		
		  	      if (cmp == 1)
				     strcpy(word1,"W");
			      else
			         strcpy(word1,"T");
			   
		
		       }


				if (((z == hell) || (z == hell - 1)) && (strcmp(word1,"F") == 0))
				{
	
				   fprint_repeat(fp,' ',8);		   
				   for(i=clt;i < z + 1;i++)
		           {
		              fprintf(fp,"%c",rl_res_result_text.arr[i]);
				
			       }
			       fprintf	(fp,"\n");
				   
					if (strcmp(l_customer_id.arr, "MC") != 0)
					{
						//page_break(1);//commented out for  GHL-SCF-1130.1
					page_break(1);
					}
					
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");


				}

			
		       if (strcmp(word1,"N") == 0) 
		       {
				
		          fprint_repeat(fp,' ',8);		   
				  for(i=clt;i<=qq;i++)
		          {
			         fprintf(fp,"%c",rl_res_result_text.arr[i]);
					
			      }
                              page_break(1);                                 
			      strcpy(word1,"F");
			      cntr = 0 ;
			      clt = qq + 1;
		          qq = 0;
	   	       }

		       if (strcmp(word1,"T") == 0)
		       {
		 										 
			      fprint_repeat(fp,' ',8);		   
				  for(i=clt;i<= qq;i++)
		          {
		             fprintf(fp,"%c",rl_res_result_text.arr[i]);
				
			      }

			       fprintf	(fp,"\n");
				   page_break(1);
			       cntr = 0 ;
				   clt = qq + 1 ;
			       qq = 0;
				   strcpy(word1,"F");

				
		        }


		        if (strcmp(word1,"W") == 0)
		        {
		 										 
			       fprint_repeat(fp,' ',8);		   
				   for(i=clt;i < clt + 70;i++)
		           {
		              fprintf(fp,"%c",rl_res_result_text.arr[i]);
				
			       }

			       fprintf(fp,"\n");
				   page_break(1);
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");

				
		        }
				

		  
            cntr += 1;
	        z++ ;
          }

		
      }

	  close_text_cur();
  
       fflush(fp);

#ifdef DEBUG
   printf("rl_res_result_text = %s\n", rl_res_result_text.arr);
#endif

if (OERROR)
   ins_message(ORA_MESG,"Error occurred at splitting()");

  return;

err_exit:
   EXEC SQL WHENEVER SQLERROR CONTINUE;
   ins_message(ORA_MESG,"Error occurred at splitting()");
   return;

}
set_printed_date_time()
{
 /* Trapping the result printed date/time into a variable */
 nd_result_printed_date.arr[0] = '\0';
 nd_result_printed_date.len = 0;
 EXEC SQL SELECT TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI:SS') 
            INTO :nd_result_printed_date
			FROM DUAL;  
 nd_result_printed_date.arr[nd_result_printed_date.len] = '\0';

 return;

err_exit:
   EXEC SQL WHENEVER SQLERROR CONTINUE;
   ins_message(ORA_MESG,"Error occurred at set_printed_date_time()");
   return;
}
/*------------------------------------------------------------*/
get_zero_prefix_for_range()
{
	l_low_val.arr[0]	= '\0';
	l_low_val.len		= 0;
	l_high_val.arr[0]	= '\0';
	l_high_val.len		= 0;
		
	l_low = 0;
	l_high = 0;


	EXEC SQL SELECT FLOOR(TO_NUMBER(:rl_tst_ran_high_val_nor)),
				FLOOR(TO_NUMBER(:rl_tst_ran_low_val_nor))
		     INTO :l_high, :l_low
			 FROM DUAL;

	strcpy(l_low_val.arr, rl_tst_ran_low_val_nor.arr);
	l_low_val.len = strlen(l_low_val.arr);

	strcpy(l_high_val.arr, rl_tst_ran_high_val_nor.arr);
	l_high_val.len = strlen(l_high_val.arr);

	if (l_low == 0)
	{
		strcpy(rl_tst_ran_low_val_nor.arr, "0");

		if (strcmp(l_low_val.arr, "0") != 0)
			strcat(rl_tst_ran_low_val_nor.arr, l_low_val.arr);

		rl_tst_ran_low_val_nor.len = strlen(rl_tst_ran_low_val_nor.arr);
	}

	if (l_high == 0)
	{
		strcpy(rl_tst_ran_high_val_nor.arr, "0");

		if (strcmp(l_high_val.arr, "0") != 0)
			strcat(rl_tst_ran_high_val_nor.arr, l_high_val.arr);

		rl_tst_ran_high_val_nor.len = strlen(rl_tst_ran_high_val_nor.arr);
	}


    l_low_val.arr[0]		= '\0';
	l_low_val.len			= 0;

	l_high_val.arr[0]		= '\0';
	l_high_val.len			= 0;

	l_low = 0;
	l_high = 0;


}
/*------------------------------------------------------------*/
build_table()
{
	int i;

	l_should_print_yn = 'N';
	d_interval_specimen_yn = 'N';

	i = 1;

	EXEC SQL DECLARE int_curs CURSOR FOR 
				SELECT DISTINCT TO_CHAR(A.interval_test_specimen_no)
				FROM RL_INTERVAL_TEST_SPECIMENS A 
				WHERE A.specimen_no = TO_NUMBER(:nd_spec_no) 
				AND A.OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND NVL(A.cancelled_yn, 'N') <> 'Y'
				AND ( NVL(A.status, 'O') IN ('R', :nd_status)
					 OR :draft_printing_yn = 'Y');

	EXEC SQL OPEN int_curs;

	while(fetch_int_curs())  
	{
	
		if (strcmp(draft_printing_yn.arr, "N") == 0)
		{
			EXEC SQL SELECT COUNT(1)
				 INTO :i_count
				 FROM RL_INTERVAL_TEST_SPECIMENS
				 WHERE interval_test_specimen_no = TO_NUMBER(:d_no) 
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND NVL(cancelled_yn, 'N') <> 'Y'
				 AND NVL(status, 'O') NOT IN ('R', 'P');
//////				OR (AND :draft_printing_yn = 'N') );
		}
		else
			i_count = 0;



		if (i_count == 0)
		{

			declare_spec_curs();
			while(fetch_spec_curs())
			{

				if (i == 1)
				{
				   strcpy(first_specimen_no.arr, d_specimen_no.arr);
				   first_specimen_no.len = strlen(first_specimen_no.arr);
				   i++;
				}

				EXEC SQL INSERT INTO RL_INTERVAL_TEST_TEMP
							(operating_facility_id,user_id, session_id, specimen_no, 
							 group_test_code, test_code, seq_no)
						 VALUES
						 	(:nd_operating_facility_id,'RLRRSENQ', 1, 
							 TO_NUMBER(:d_specimen_no), :d_group_test_code, 
							 :d_test_code, :d_seq_no);

				l_should_print_yn = 'Y';
				d_interval_specimen_yn = 'Y';
			}
			close_spec_curs();
		}
	}

	close_int_curs(); 

	EXEC SQL DECLARE req_curs CURSOR FOR 
				SELECT test_code 
				FROM RL_REQUEST_DETAIL
				WHERE specimen_no = TO_NUMBER(:nd_spec_no) 
				AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND NVL(cancelled_yn, 'N') <> 'Y'
				AND (NVL(result_status, 'O') IN ('R', :nd_status)
						OR :draft_printing_yn = 'Y' 
						OR (test_code in (SELECT test_code FROM RL_TEST_CODE
										 WHERE  NVL(PROFILE_YN,'N') = 'Y'
										 AND    NVL(GROUP_TEST_YN,'N') = 'Y')  /// 21.05.2005
							AND ( NVL(result_status,'O') = 'O' 
									OR (NVL(result_status,'O') IN ('A') AND released_date IS NOT NULL))
							)
						OR (NVL(preliminary_release_yn,'N') = 'Y' AND NVL(result_status,'O') IN ('A'))  /// 22.08.2006
					);
		   	    

	EXEC SQL OPEN req_curs;

	while(fetch_req_curs())
	{
		EXEC SQL SELECT COUNT(1)
		INTO :i_count
		FROM RL_INTERVAL_TEST_SPECIMENS
		WHERE specimen_no = TO_NUMBER(:nd_spec_no)
		AND OPERATING_FACILITY_ID = :nd_operating_facility_id
		AND NVL(cancelled_yn, 'N') <> 'Y'
		AND group_test_code = :d_group_test_code;

		if (i_count == 0)  
		{
			l_should_print_yn = 'Y';

			EXEC SQL INSERT INTO RL_INTERVAL_TEST_TEMP
							(OPERATING_FACILITY_ID,user_id, session_id, 
							 specimen_no, group_test_code)
					 VALUES
							(:nd_operating_facility_id,'RLRRSENQ', 1, 
							 TO_NUMBER(:nd_spec_no), :d_group_test_code);

		}


	}
	close_req_curs();

	if (d_interval_specimen_yn == 'N')
	{
	   strcpy(first_specimen_no.arr, nd_spec_no.arr);
	   first_specimen_no.len = strlen(first_specimen_no.arr);

	}

}
/*------------------------------------------------------------*/
declare_spec_curs()
{
		EXEC SQL DECLARE spec_curs CURSOR FOR 
				SELECT TO_CHAR(A.specimen_no), A.group_test_code, A.test_code, A.seq_no
				FROM RL_INTERVAL_TEST_SPECIMENS A 
				WHERE A.interval_test_specimen_no= TO_NUMBER(:d_no) 
				AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND NVL(A.cancelled_yn, 'N') <> 'Y'
		   	    ORDER BY A.specimen_no;

		EXEC SQL OPEN spec_curs;

		
}

/*------------------------------------------------------------*/
fetch_spec_curs()
{
	 d_specimen_no.arr[0]		= '\0';
	 d_specimen_no.len			= 0;
	 d_group_test_code.arr[0]	= '\0';
	 d_group_test_code.len		= 0;
	 d_test_code.arr[0]			= '\0';
	 d_test_code.len			= 0;

	EXEC SQL FETCH spec_curs 
				 INTO :d_specimen_no, :d_group_test_code, :d_test_code,
				 :d_seq_no;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor specimen_curs");

	
		d_specimen_no.arr[d_specimen_no.len]			= '\0';
		d_group_test_code.arr[d_group_test_code.len]	= '\0';
		d_test_code.arr[d_test_code.len]				= '\0';

	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
fetch_int_curs()
{
	 d_no.arr[0]		= '\0';
	 d_no.len			= 0;
	 
	EXEC SQL FETCH int_curs 
				 INTO :d_no;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor int_curs");

	
		d_no.arr[d_no.len]			= '\0';

	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
fetch_req_curs()
{
	 d_group_test_code.arr[0]		= '\0';
	 d_group_test_code.len			= 0;
	 
	EXEC SQL FETCH req_curs 
				 INTO :d_group_test_code;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor req_curs");

	
		d_group_test_code.arr[d_group_test_code.len]			= '\0';

	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
close_int_curs()
{
	EXEC SQL CLOSE int_curs;
}
/*------------------------------------------------------------*/

close_spec_curs()
{
	EXEC SQL CLOSE spec_curs;
}
/*------------------------------------------------------------*/
close_req_curs()
{
	EXEC SQL CLOSE req_curs;
}
/*------------------------------------------------------------*/
update_interval_specimen()
{
	EXEC SQL SELECT COUNT(1)
			 INTO :u_count
			 FROM RL_INTERVAL_TEST_SPECIMENS
			 WHERE specimen_no = TO_NUMBER(:nd_spec_no)
			 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
			 AND test_code = :rl_tst_test_code
			 AND NVL(cancelled_yn, 'N') <> 'Y';
	
	if (u_count > 0)
	{
			
			d_found.arr[0]		= '\0';
			d_found.len			= 0;
			
		EXEC SQL SELECT 'x'
				 INTO :d_found
				 FROM RL_INTERVAL_TEST_SPECIMENS
				 WHERE specimen_no = TO_NUMBER(:nd_spec_no)
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND test_code = :rl_tst_test_code
				 AND NVL(cancelled_yn, 'N') <> 'Y'
				 FOR UPDATE OF status NOWAIT;

			d_found.arr[d_found.len]	= '\0';

			 if (OERROR)
		 	 {
		 		ins_message(ORA_MESG,"SELECT failed on RL_INTERVAL_TEST_SPECIMENS");
			 }

			 if (RESOURCE_BUSY)
			 {
				ins_message(ORA_MESG,"OPEN failed resource busy RL_INTERVAL_TEST_SPECIMENS");
			 }
			 else
			 {
				 
				EXEC SQL UPDATE RL_INTERVAL_TEST_SPECIMENS
					 SET status = 'P'
					 WHERE specimen_no = TO_NUMBER(:nd_spec_no)
					 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
					 AND test_code = :rl_tst_test_code
					 AND NVL(cancelled_yn, 'N') <> 'Y';
			 }
	}

}
/*------------------------------------------------------------*/
delete_build_table()
{
	EXEC SQL DELETE FROM RL_INTERVAL_TEST_TEMP
			 WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
			 AND user_id = 'RLRRSENQ'
			 AND session_id = 1;

	EXEC SQL DELETE FROM RL_INTERVAL_TEST_TEMP
			 WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
			 AND user_id = 'RLRRSENQ'
			 AND session_id = 2;

}
/*------------------------------------------------------------*/

get_interval_description()
{
	interval_description.arr[0]		= '\0';
	interval_description.len		= 0;

	EXEC SQL SELECT description
			 INTO :interval_description
			 FROM RL_INTERVAL_TEST_DESC_lang_vw
			 WHERE test_code = :rl_tst_test_code
			 AND seq_no = :rl_seq_no
			 and language_id = :language_id;

	interval_description.arr[interval_description.len]		= '\0';
}
/*-----------------------------------------------------*/
get_first_specimen_no()
{
	int i;

	EXEC SQL DECLARE first_spec_curs CURSOR FOR 
				SELECT TO_CHAR(A.interval_test_specimen_no)
				FROM RL_INTERVAL_TEST_SPECIMENS A 
				WHERE A.specimen_no = TO_NUMBER(:nd_spec_no) 
				AND A.OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND NVL(A.cancelled_yn, 'N') <> 'Y'
				AND (NVL(A.status, 'O') IN ('R', :nd_status) 
						OR :draft_printing_yn = 'Y')
		   	    ORDER BY A.specimen_no;

	EXEC SQL OPEN first_spec_curs;

	i = fetch_first_spec_curs();

	EXEC SQL CLOSE first_spec_curs;

}

/*------------------------------------------------------------*/
fetch_first_spec_curs()
{
	 first_specimen_no.arr[0]	= '\0';
	 first_specimen_no.len		= 0;

	EXEC SQL FETCH first_spec_curs 
				 INTO :first_specimen_no;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor first_specimen_curs");

	
		first_specimen_no.arr[first_specimen_no.len]		= '\0';

	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/

close_comments_curs()
{

	EXEC SQL CLOSE RL_COMM_FOR_TEST_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_COMM_FOR_TEST_CUR");

}

close_text_cur()
{
	EXEC SQL CLOSE RL_RESULT_TEXT_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_RESULT_TEXT_CUR");

}

close_function_cur()
{
	EXEC SQL CLOSE RL_FUNCTION_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_FUNCTION_CUR");

}

close_snomed_cur()
{

	EXEC SQL CLOSE RL_RESULT_SNOMED_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_RESULT_SNOMED_CUR");

}

close_organism_cur()
{

	EXEC SQL CLOSE RL_RESULT_ORGANISM_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_RESULT_ORGANISM_CUR");

}

close_antibiotic_cur()
{
	EXEC SQL CLOSE RL_ANTIBIOTIC_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_ANTIBIOTIC_CUR");

}

close_sensitivity_cur_format4()
{
	EXEC SQL CLOSE RL_SENSITIVITY_CUR_FORMAT4;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_SENSITIVITY_CUR_FORMAT4");

}



close_cur1_cur()
{
	EXEC SQL CLOSE CUR1;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor CUR1");

}

close_mast_cur()
{
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)
		EXEC SQL CLOSE RL_PAT_MAST_CUR;
	else
		EXEC SQL CLOSE RL_PAT_MAST_CUR_ah;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_PAT_MAST_CUR");

}


close_mast3_cur()
{
	
	EXEC SQL CLOSE RL_PAT_MAST3_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_PAT_MAST3_CUR");

}

close_c_cur()
{
	
	EXEC SQL CLOSE C;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor C");

}

put_zero_before_decimal()
{

	if (rl_tst_numeric_result.arr[0] != '0')
	{
		strcpy(l_numeric_result, "0");
		strcat(l_numeric_result, rl_tst_numeric_result.arr);

		strcpy(rl_tst_numeric_result.arr, l_numeric_result);
		rl_tst_numeric_result.len = strlen(rl_tst_numeric_result.arr);
	}
	

}

/******************************************************************************************/
get_race_desc()
{
	
	d_race_desc.arr[0]		= '\0';
	d_race_desc.len			= 0;

	EXEC SQL SELECT short_desc
		     INTO :d_race_desc
			 FROM MP_RACE_lang_vw
			 WHERE race_code = :rl_race_code
			 and language_id = :language_id;

	if (NODATAFOUND);

	d_race_desc.arr[d_race_desc.len]			= '\0';
	
}


/******************************************************************************************/
print_clinical_history()
{

	int ctr = 0;
	int len = 0;
	int r_ctr = 0;

	char l_string[100];     

		EXEC SQL DECLARE rl_clinical_cur CURSOR FOR
				 SELECT specimen_no, clinical_text_code, SUBSTR(clinical_text, 1, 4000) 
				 FROM RL_PATIENT_CLINICAL_TEXT
				 WHERE specimen_no IN (SELECT distinct specimen_no
							FROM RL_INTERVAL_TEST_TEMP
							WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
							AND user_id = 'RLRRSENQ' 
							AND session_id = 1 )
			       AND OPERATING_FACILITY_ID = :nd_operating_facility_id
			       AND NVL(order_questionnaire_yn, 'N') <> 'Y'
				 ORDER BY specimen_no;

		EXEC SQL OPEN rl_clinical_cur;   

		ctr = 0;

/* commented on 14.08.2003 and added another version of splittext in local itself

		while(fetch_clinical_text())
		{

			len = strlen(d_clinical_text.arr);

			if (strlen(d_clinical_text.arr) > 0)
			{

			   split_text(d_clinical_text.arr, 79, l_string, &r_ctr);

  			   if (d_interval_specimen_yn == 'Y')
			   {
			  	  fprintf(fp, "Specimen No : %-15s", d_clinical_spec_no.arr);
			   }

				if (ctr == 0)
				{

					if (strlen(l_string) > 0 )
					{

						page_break(1);
						fprintf(fp,"%c&k4S",ESC); 
						fprintf(fp,"%c(s4B",ESC);
						//fprintf(fp, "Clinical History\n");
						fprintf(fp, "%s\n", local_legend[39]); //added for globalisation
						fprintf(fp,"%c&k4S",ESC); 
						fprintf(fp,"%c(s-3B",ESC);
						
					}
				}

				fprintf(fp,"       %s\n",l_string);  
				page_break(1);

				while(r_ctr <= len)
				{	
					page_break(1);
					split_text(d_clinical_text.arr, 79, l_string, &r_ctr);
					fprintf(fp,"       %s\n",l_string);  
					page_break(1);

					strcpy(l_string, "");

				}
			
				ctr++;
			}
		}

********************/

		split_hist();   ///////// added on 14.08.2003

		EXEC SQL CLOSE rl_clinical_cur;

}

/******************************************************************************************/
fetch_clinical_text()
{

	d_clinical_text_code.arr[0]		= '\0';
	d_clinical_text_code.len		= 0;
	d_clinical_spec_no.arr[0]		= '\0';
	d_clinical_spec_no.len			= 0;

	d_clinical_text.arr[0]			= '\0';
	d_clinical_text.len				= 0;

    EXEC SQL FETCH rl_clinical_cur
              INTO :d_clinical_spec_no,
				   :d_clinical_text_code, 
				   :d_clinical_text;
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_PATIENT_CLINICAL_TEXT");


	d_clinical_spec_no.arr[d_clinical_spec_no.len]			= '\0';
	d_clinical_text_code.arr[d_clinical_text_code.len]		= '\0';
	d_clinical_text.arr[d_clinical_text.len]				= '\0';

    return (LAST_ROW?0:1);
}
/*******************************************************************************************/
chk_inhibit_yn()
{

	EXEC SQL SELECT NVL(inhibit_report_yn, 'N') 
			INTO :d_inhibit_yn
			FROM RL_TEST_CODE 
			WHERE test_code = :inhibit_test_code;


	d_inhibit_yn.arr[d_inhibit_yn.len]		= '\0';
}

/*******************************************************************************************/
print_header3()
{   char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i,l_tests;

    pctr++;

	if (l_print_health_card_yn.arr[0]=='Y') 
		lctr = 20;
	else
	    lctr = 19;

    get_parameters();

/*---------*/
    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/

    fprintf(fp,"\n%-*s%-.40s\n\n",(int)(((80 - sy_acc_entity_name.len)/2) - 6)," ",sy_acc_entity_name.arr);
    fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
/*----------------------------------------*/


    if(rl_hdr_episode_type.arr[0] == 'R')
       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	  strcpy(t_patient_id,nd_hosp_no.arr);
       else
	  strcpy(t_patient_id,rl_pat_actual_id.arr);
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Patient ID : ");
    fprintf(fp,"%-11.11s: ", local_legend[26]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-15.15s",t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Section : ");
	fprintf(fp, "%-8.8s: ", local_legend[27]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	fprintf(fp, "%-s - %-s\n",rl_section_short_name.arr,
							  rl_section_tel_num.arr);

/* added by c shekhar to print health card info 21/06/2002 */

if ((l_print_health_card_yn.arr[0]=='Y') && 
			 ( (rl_health_card_num.arr[0]!='\0') ||
			   (rl_health_num.arr[0] != '\0')
			  ))
	{

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Health Card No : ");
    fprintf(fp,"%-15.15s: ", local_legend[4]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-15.15s",rl_health_card_num.arr);


/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"     Health No : ");
    fprintf(fp,"%-15.15s: ", local_legend[5]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	fprintf(fp,"%c&k12S",ESC);	
	fprintf(fp,"%c&l6D",ESC);
   	fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%-14.14s\n", rl_health_num.arr);

//	fprintf(fp, "   Exp. Date : ");
//	fprintf(fp, "%-10.10s\n", rl_health_exp_date.arr);
}

/*--------------till here ----------------------*/

    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"\n\n");

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
	   strcpy(sex_desc,local_legend[37]); //added for globalisation
	else
	if(rl_pat_sex.arr[0] == 'F')
	   //strcpy(sex_desc,"FEMALE");
	   strcpy(sex_desc,local_legend[38]); //added for globalisation
	else
       strcpy(sex_desc,"");
    
	strcpy(pat_name,rl_pat_title.arr);
	if(strlen(rl_pat_title.arr) > 0)
	   strcat(pat_name," ");
	strcat(pat_name,rl_pat_short_name.arr);
    
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp,"Patient Name         : ");
	fprintf(fp,"%-21.21s: ", local_legend[6]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-42.42s",pat_name);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Sex : ");
    fprintf(fp,"%-4.4s: ", local_legend[7]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-8.8s\n",sex_desc);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Location             : ");
    fprintf(fp,"%-21.21s: ", local_legend[8]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-42.42s",rl_source_short_name.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"DOB : ");
    fprintf(fp,"%-4.4s: ", local_legend[9]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
	
	fprintf(fp,"%-16.16s\n",rl_pat_date_of_birth.arr); 

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Clinical Information : ");
    fprintf(fp,"%-21.21s: ", local_legend[10]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    if (rl_hdr_request_comment_desc2.len)
    {
       /*----------------------------------------*/
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s4B",ESC);
       fprintf(fp,"%-23.23s"," ");
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }

    if (rl_hdr_request_comment_desc3.len)
    {
       /*----------------------------------------*/
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s4B",ESC);
       fprintf(fp,"%-23.23s"," ");
       fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/
      fprintf(fp,"%-40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Requesting Doctor    : ");
    fprintf(fp,"%-21.21s: ",local_legend[11]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

    fprintf(fp,"%-33.33s",rl_consultant_short_name.arr);
				
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Request Date : ");
    fprintf(fp,"%-13.13s: ", local_legend[12]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    //fprintf(fp,"%-s\n",rl_hdr_spec_recd_date_time.arr);
    fprintf(fp,"%-s\n",rl_hdr_spec_recd_date_time1.arr);//added for globalisation

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Specimen Type        : ");
    fprintf(fp,"%-21.21s: ", local_legend[13]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-33.33s",rl_spc_specimen_desc.arr);

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Regn Date    : ");
    fprintf(fp,"%-13.13s: ", local_legend[14]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/
            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

    //fprintf(fp,"%s\n",rl_hdr_spec_regd_date_time.arr);
    fprintf(fp,"%s\n",rl_hdr_spec_regd_date_time1.arr);//added for globalisation

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Tests Requested      : ");
    fprintf(fp,"%-21.21s: ",local_legend[15]); //added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

    fprintf(fp,"%-33.33s"," ");

/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
    //fprintf(fp,"Specimen No  : ");
    fprintf(fp,"-13.13s: ",local_legend[16]);//added for globalisation
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
/*----------------------------------------*/

	if (d_interval_specimen_yn == 'Y')
		fprintf(fp,"%-9.9s (I)\n",first_specimen_no.arr);
	else
		fprintf(fp,"%-s\n",nd_spec_no.arr);

	sprintf(l_str,"%-6.6s"," ");

    l_tests = no_of_dtl_recs;
	if (no_of_dtl_recs > 7)
	   l_tests = 7;

//    for (i=0;i < no_of_dtl_recs;i++)
    for (i=0;i < l_tests;i++)
    {
       sprintf(l_str,"%s%-5s  ",l_str, rl_dtl_test_code[i].arr);
    }
    fprintf(fp,"%s\n",l_str);

    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"\n\n");
}
/*---------------------------------------------------------*/
print_header2()
{

    char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
	char l_age_legend[5];

    pctr++;
    
    get_parameters();
	lctr = 0;
/*---------*/

/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/
	get_sm_installation();
	if (strcmp(BVNewVersionYN.arr,"N") == 0)
	{
	 fprintf(fp,"\n\n");
	 lctr+=2;
	}    
	else
	{
	 fprintf(fp,"\n");
	 lctr+=1;
	}    


/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 

/*-------- upto here on 21.10.2004 -----*/

    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/
    if (rl_lab_title.len) 
	{
       fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);
	   lctr+=2;
	}
    if (rl_lab_title_2.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_2.len)/2) - 6)," ",rl_lab_title_2.arr);
	   lctr+=2;
	}
    if (rl_lab_title_3.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_3.len)/2) - 6)," ",rl_lab_title_3.arr);
	   lctr+=2;
	}
    if (rl_lab_title_4.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_4.len)/2) - 6)," ",rl_lab_title_4.arr);
	   lctr+=2;
	}
    if (rl_lab_title_5.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_5.len)/2) - 6)," ",rl_lab_title_5.arr);
	   lctr+=2;
	}

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

    rl_lab_title_6.arr[0] = '\0';
    rl_lab_title_6.len = 0;
	/// 12.02.2006 if (strcmp(rl_hmc_yn.arr,"Y") == 0)  // because HMC doesnt want hardcoded legend 
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)  // 12.02.2006 becaz ML,HMC doesnt want hardcoded legend
	{
		strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	}
	else
	{
		//strcpy(rl_lab_title_6.arr, "Department of ");
		strcpy(rl_lab_title_6.arr, local_legend[40]);//added for globalisation
		strcat(rl_lab_title_6.arr, " ");//added for globalisation
		strcat(rl_lab_title_6.arr, rl_section_short_name.arr);
	}

	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);
    if (rl_lab_title_6.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);
	   lctr+=2;
	}


/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;
		//fprintf(fp, "Draft Copy\n");
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}


	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);  
	}



/*----------------------------------------*/ 
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
/*----------------------------------------*/

	

	/*** NEWLY ADDED ON 28/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO 
			BEFORE the detail portion of heading******/
	if(rl_hdr_episode_type.arr[0] != 'R')
		print_hmc_no();


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

   for(i=0;i<87;i++)
        fprintf(fp,"_");

	fprintf(fp, "\n");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;

	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp, "%-13.13s:", local_legend[6]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s                ", rl_pat_short_name.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-3.3s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s ", l_age_legend);

	patient_age();

	fprintf(fp, "%s\n", t_age.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient  ID  : ");
	fprintf(fp, "%-13.13s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-15.15s                          ", t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	   //fprintf(fp, "Sex/Race: ");
	   fprintf(fp, "%-8.8s: ",local_legend[42] );//added for globalisation
    else
       //fprintf(fp, "     Sex: ");
	   fprintf(fp, "%8.8s: ",local_legend[7] );//added for globalisation
		
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
	   strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
			//strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			//strcpy(sex_desc,"Unknown");
		   strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp,"%s", sex_desc);

    if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	{
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		get_race_desc();
		fprintf(fp, "%-15.15s", d_race_desc.arr);
	}

    fprintf(fp, "\n");
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
	fprintf(fp, "%-13.13s: ",local_legend[8]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s", rl_source_short_name.arr);

	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	    fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		fprintf(fp, "%-20.20s\n", rl_location.arr);
		page_break(1);
	}
	else
	{
		fprintf(fp, "\n");
		page_break(1);
		
	}


	/*** NEWLY ADDED ON 26/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO ******/
//	if(rl_hdr_episode_type.arr[0] != 'R')
//		print_hmc_no();


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);
	
/////////////////  12.07.2004
	fprintf(fp,"%-8.8s"," ");
    get_nationality_desc();	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
/////////////////

	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
	fprintf(fp, "%-13.13s: ",local_legend[16]);//added for globalisation
// 12.07.2004	fprintf(fp,"%c&k4S",ESC); 
// 12.07.2004  	fprintf(fp,"%c(s-3B",ESC);   

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "    ");
	}

	fprintf(fp, "%-19.19s                    ", l_str);

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Regd  Date: ");
	fprintf(fp, "%-10.10s: ",local_legend[46]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr);//added for globalisation
	page_break(1);
	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
    fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Recd  Date: ");
    fprintf(fp,"%-10.10s: ", local_legend[47]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
    fprintf(fp, "%-16.16s\n",rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Category No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[48]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-4.4s/%-4.4s/%-15.15s              ", rl_category_code.arr, rl_category_year.arr,
								rl_category_number.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Collt Date: ");
    fprintf(fp,"%-10.10s: ", local_legend[49]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Clinical     : ");
    fprintf(fp,"%-13.13s: ", local_legend[50]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	   
	if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s4B",ESC);
	 //fprintf(fp, "Comment        ");
     fprintf(fp,"%-15.15s", local_legend[51]); //added for globalisation
	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s-3B",ESC);

	if (rl_hdr_request_comment_desc2.len)
    {

      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    
	if (rl_hdr_request_comment_desc3.len)
    {
	  fprintf(fp, "               ");
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }

/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///

	if (strcmp(rl_test_requested_yn.arr, "Y") == 0)
	{

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordered Tests: ");
		 fprintf(fp,"%-13.13s: ", local_legend[53]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		strcpy(l_str, "");

		for (i=0;i < no_of_dtl_recs;i++)
		{
			d_inhibit_yn.arr[0]		= '\0';
			d_inhibit_yn.len		= 0;

			strcpy(inhibit_test_code.arr, rl_dtl_test_code[i].arr);
			inhibit_test_code.len = strlen(inhibit_test_code.arr);

			chk_inhibit_yn();

			if (d_inhibit_yn.arr[0]	== 'N') 
			{
				if (i == 0)
					sprintf(l_str,"%s", rl_dtl_test_code[i].arr);
				else
					sprintf(l_str,"%s,%s",l_str, rl_dtl_test_code[i].arr);
			}

//11.04.2005  if (i > 15) 

			if (i > 5) 
				break;
		}

		if(no_of_dtl_recs > 7)
		  sprintf(l_str,"%s...",l_str);

		fprintf(fp,"%s\n",l_str);
		page_break(1);
	}


	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		if (strlen(rl_message_line.arr) > 0)
		{
			fprintf(fp, "%70.70s ", rl_message_line.arr);
			fprintf(fp, "%-15.15s\n", nd_hosp_no.arr);
			page_break(1);

		}
	}

    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s4B",ESC);
    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);

	page_break(1);
	fprintf(fp, "\n");
    
}
/********************************************************************************************/
print_footer3(foot_ind)
int foot_ind;
{
   int fi = 0;
   char l_str[100];
   l_str[0] = '\0'; 

   for(fi=0; fi < 87; fi++)
       fprintf(fp,"%c",'_');

   fprintf(fp,"\n");

   fflush(fp);

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   //fprintf(fp,"Release Date : ");
   fprintf(fp,"%-13.13s : ", local_legend[20]); //added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   //sprintf(l_str,"%s",rl_hdr_released_date.arr);
   sprintf(l_str,"%s",rl_hdr_released_date1.arr);//added for globalisation
   fprintf(fp,"%-25.25s",l_str);
   /*----------------------------------------*/

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   //fprintf(fp,"Released/Reviewed By : ");
   fprintf(fp,"%-21.21s : ", local_legend[21]); //added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   fprintf(fp,"%-s\n",rl_hdr_released_by_id.arr);
   /*----------------------------------------*/

   /*----------------------------------------*/
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s4B",ESC);
   //fprintf(fp,"Reprint Date : ");
   fprintf(fp,"%-13.13s : ", local_legend[22]); //added for globalisation
   fprintf(fp,"%c&k4S",ESC); 
   fprintf(fp,"%c(s-3B",ESC);   
   /*----------------------------------------*/
   
   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
       sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
   else
       sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
   fprintf(fp,"%s",nd_result_printed_date.arr);

   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2 ) 
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);
      //fprintf(fp,"Copy To : ");
	  fprintf(fp,"%-7.7s : ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

   if(last_page == 0)
      //sprintf(l_str,"%-73.73s--CONTINUED--"," ");
      sprintf(l_str,"%-73.73s--%-9.9s--"," ",local_legend[24]); //added for globalisation
   else
      //sprintf(l_str,"%-73.73s      --END--"," ");
      sprintf(l_str,"%-73.73s --%-3.3s--"," ",local_legend[25]);// added for globalisation

   fprintf(fp,"%s\f",l_str);

   lctr = 0;
  
}
/*-----------------------------------------------------*/
print_footer2(foot_ind)
int foot_ind; 
{
   int fi = 0;
   char l_str[100];
   l_str[0] = '\0'; 

   for(fi=0; fi < 87; fi++)
       fprintf(fp,"%c",'_');

   fprintf(fp,"\n");
   
   fflush(fp);


      if (rl_name_on_report_yn.arr[0] == 'Y')
	  {

		get_print_name(first_user.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(first_user.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Released/Reviewed By : ");
		//fprintf(fp,"Released By : ");
		fprintf(fp,"%-13.13s : ", local_legend[61]); //added for globalisation 
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);
	    fprintf(fp,"%-30.30s",l_str);
		fprintf(fp, "        ");
		/*----------------------------------------*/

	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
	   //fprintf(fp,"Released Date : ");
		fprintf(fp,"%-15.15s : ", local_legend[62]); //added for globalisation 
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   fprintf(fp,"%-s\n",footer_released_date);
	   /*----------------------------------------*/

	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;

	 }

	  get_print_name(rl_hdr_released_by_id.arr);

	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(rl_hdr_released_by_id.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
		//fprintf(fp,"Reviewed By : ");
		fprintf(fp,"%-13.13s : ", local_legend[63]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);
	    fprintf(fp,"%-30.30s",l_str);
		fprintf(fp, "        ");
	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
	   //fprintf(fp,"Reviewed Date : ");
	   fprintf(fp,"%-13.13s : ", local_legend[65]); //added for globalisation 
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   //fprintf(fp,"%-s\n",rl_hdr_released_date.arr);
	   fprintf(fp,"%-s\n",rl_hdr_released_date1.arr); //added for globalisation
	   /*----------------------------------------*/

   	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;


	  }


		/*----------------------------------------*/
		/***********************
	    fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp,"Reprint Date : ");
        fprintf(fp,"%c&k4S",ESC); 
        fprintf(fp,"%c(s-3B",ESC);   
		***********************/
		/*----------------------------------------*/
	/***********************
	   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
	   else
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);

	   fprintf(fp,"%s",nd_result_printed_date.arr);
	***********************/

///////////////// 12.07.2004 'ss'
		if (p_param8.arr[0] == 'P')
		{
		  get_print_name(sy_user_id.arr);
		  if (print_name_yn.arr[0]	== 'Y')
		  {

			get_user_name(sy_user_id.arr);

		   /*----------------------------------------*/
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp,"Reprinted By: ");
			fprintf(fp,"%-12.12s: ", local_legend[67]); //added for globalisation 
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC);   
  			sprintf(l_str,"%s", sy_user_name.arr);
			fprintf(fp,"%-30.30s",l_str);
			fprintf(fp, "        ");
		   /*----------------------------------------*/	   
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s4B",ESC);
		   //fprintf(fp,"Reprinted Date: ");
			fprintf(fp,"%-14.14s: ", local_legend[68]); //added for globalisation 
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s-3B",ESC);   

			l_sy_req_date.arr[0]	= '\0';
			l_sy_req_date.len	= 0;

			EXEC SQL SELECT  to_char(to_date(:sy_req_date,'DDMMYYHH24MISS'),'DD/MM/YYYY HH24:MI')
				   INTO		:l_sy_req_date
				   FROM		DUAL;

			   if (OERROR);
			l_sy_req_date.arr[l_sy_req_date.len] = '\0';
	 /**** date conversion start for globalisation ************/
        EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:l_sy_req_date1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:l_sy_req_date1 :=sm_convert_datetime_2t(to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;
	 /**** date conversion end for globalisation ************/


		   fprintf(fp,"%-s\n",l_sy_req_date1.arr);
		   /*----------------------------------------*/

   	   		sy_user_name.arr[0]		= '\0';
			sy_user_name.len			= 0;

		  }

		}
////////////////
	  
	}

/****** FOOTER PRINTING FROM RL_SECTION_CTL  ****************/
   if ( (strlen(rl_footer_line_1.arr) > 0) ||
			(strlen(rl_footer_line_2.arr) > 0) )
   {
		if (strlen(rl_footer_line_1.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_1.arr);

		if (strlen(rl_footer_line_2.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_2.arr);
   }


   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2  && 
		strcmp(draft_printing_yn.arr, "N") == 0)
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);						   
      //fprintf(fp,"Copy To : ");
      fprintf(fp,"%-8.8s: ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

   if(last_page == 0)
      //sprintf(l_str,"%-73.73s--CONTINUED--"," ");
      sprintf(l_str,"%-73.73s--%-9.9s--"," ",local_legend[24]); //added for globalisation
   else
      //sprintf(l_str,"%-73.73s      --END--"," ");   
      sprintf(l_str,"%-73.73s --%-3.3s--"," ",local_legend[25]);// added for globalisation

   fprintf(fp,"%s\f",l_str);   

   fprintf(fp,"%cE",ESC); // added on 21.10.2004 to reset the printer settings.
 
   lctr = 0; 
  
}

/*-----------------------------------------------------*/
build_cancelled_tests()
{

	EXEC SQL DECLARE cancelled_curs CURSOR FOR 
				SELECT DISTINCT specimen_no
				FROM RL_INTERVAL_TEST_TEMP
				WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND user_id = 'RLRRSENQ'
				AND session_id = 1;
	   	    
	EXEC SQL OPEN cancelled_curs;

	while(fetch_cancelled_curs())
	{
		
		declare_can_req_curs();
		while(fetch_can_req_curs())
		{

/************ In Rl_interval_test_temp table in column test code 
			  the system will put the cancel code				   *************/

			EXEC SQL INSERT INTO RL_INTERVAL_TEST_TEMP
							(OPERATING_FACILITY_ID,user_id, session_id, specimen_no, group_test_code, test_code)
					 VALUES
							(:nd_operating_facility_id,'RLRRSENQ', 2, 
							 TO_NUMBER(:can_spec_no), :can_group_test, 
							 :can_test_code);

		}

		close_can_req_curs();
	}
	close_cancelled_curs();

}

/*------------------------------------------------------------*/
fetch_cancelled_curs()
{
	 can_spec_no.arr[0]		= '\0';
	 can_spec_no.len			= 0;

	EXEC SQL FETCH cancelled_curs 
				 INTO :can_spec_no;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor specimen_curs");

	 can_spec_no.arr[can_spec_no.len]		= '\0';
	
	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
close_cancelled_curs()
{
	EXEC SQL CLOSE cancelled_curs;
}
/*------------------------------------------------------------*/
declare_can_req_curs()
{

	EXEC SQL DECLARE can_req_curs CURSOR FOR 
				SELECT test_code, cancel_code
				FROM RL_REQUEST_DETAIL
				WHERE specimen_no = TO_NUMBER(:can_spec_no)
				AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND NVL(cancelled_yn, 'N') = 'Y';
	   	    
	EXEC SQL OPEN can_req_curs;

}
/*------------------------------------------------------------*/
close_can_req_curs()
{
	EXEC SQL CLOSE can_req_curs;
}
/*------------------------------------------------------------*/
fetch_can_req_curs()
{
	
	can_test_code.arr[0]		= '\0';
	can_test_code.len			= 0;
    can_group_test.arr[0]		= '\0';
    can_group_test.len			= 0;

	EXEC SQL FETCH can_req_curs 
				 INTO	:can_group_test,
						:can_test_code;


		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor specimen_curs");

	 can_test_code.arr[can_test_code.len]		= '\0';
	 can_group_test.arr[can_group_test.len]		= '\0';
	
	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
print_cancelled_tests()
{

   int ctr = 0;

/************ in test code the system will put the cancel code *************/
	EXEC SQL DECLARE prn_can_curs CURSOR FOR 
				SELECT TO_CHAR(specimen_no), group_test_code, test_code
				FROM RL_INTERVAL_TEST_TEMP
				WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
				AND user_id = 'RLRRSENQ'
				AND session_id = 2;

	EXEC SQL OPEN prn_can_curs;

	while(fetch_prn_can_curs())
	{

		if (ctr == 0)
		{

			fprintf(fp, "\n");
			page_break(1);

		    fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s4B",ESC);
			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
			//fprintf(fp, "Cancelled Tests\n");  
		   	fprintf(fp, "%-15.15s\n", local_legend[69]); //added for globalisation
			fprintf(fp,"%c&d@",ESC);
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s-3B",ESC);   
			page_break(1);
		}


		if (d_interval_specimen_yn == 'Y')
		{
			//fprintf(fp, "Specimen No : %-15.15s\n", can_spec_no.arr);
			fprintf(fp, "%-11.11s : %-15.15s\n", local_legend[16], can_spec_no.arr);
			page_break(1);
		}

		if (strlen(can_test_code.arr) > 0)
		{
			get_cancel_reason();
			get_test_desc();

		    if(test_desc_fill_for_report.len)   
			{
              EXEC SQL SELECT RPAD(:can_test_name,40,:test_desc_fill_for_report) 
					   INTO :can_test_name
					   FROM DUAL;

	          can_test_name.arr[can_test_name.len] = '\0'; 
			  fprintf(fp, "%-40.40s %s\n", can_test_name.arr, cancel_reason.arr);
			}
			else
     		  fprintf(fp, "%-40.40s %s\n", can_test_name.arr, cancel_reason.arr);

//			fprintf(fp, "%-10.10s  %-40s\n", can_group_test.arr, cancel_reason.arr);
			page_break(1);
		}

		ctr++;

	}

	close_prn_can_curs();

}

/*------------------------------------------------------------*/
fetch_prn_can_curs()
{
	 can_spec_no.arr[0]			= '\0';
	 can_spec_no.len			= 0;
	 can_group_test.arr[0]		= '\0';
	 can_group_test.len			= 0;
 	 can_test_code.arr[0]		= '\0';
	 can_test_code.len			= 0;

	EXEC SQL FETCH prn_can_curs
				 INTO :can_spec_no,
					  :can_group_test,
					  :can_test_code;

		if (OERROR)
			ins_message(ORA_MESG,"FETCH failed on cursor specimen_curs");

	 can_spec_no.arr[can_spec_no.len]			= '\0';
	 can_test_code.arr[can_test_code.len]		= '\0';
	 can_group_test.arr[can_group_test.len]		= '\0';
	 	
	return (LAST_ROW?0:1);
	 
}
/*------------------------------------------------------------*/
get_cancel_reason()
{
	cancel_reason.arr[0]		= '\0';
	cancel_reason.len			= 0;

	EXEC SQL SELECT long_desc
			 INTO :cancel_reason
		     FROM RL_CANCELLATION_CODE_LANG_VW
			 WHERE cancel_code = :can_test_code
			 AND LANGUAGE_ID = :language_id;


	if (NODATAFOUND);

	cancel_reason.arr[cancel_reason.len]	= '\0';

}
/*------------------------------------------------------------*/
close_prn_can_curs()
{
	EXEC SQL CLOSE prn_can_curs;
}
/*------------------------------------------------------------*/
get_print_name(prn_user_id)
char prn_user_id[];
{
	
	strcpy(p_user_id.arr, prn_user_id);
	p_user_id.len = strlen(p_user_id.arr);

	print_name_yn.arr[0]		= '\0';
	print_name_yn.len			= 0;

	EXEC SQL SELECT NVL(name_on_report_yn, 'Y')
			 INTO :print_name_yn
			 FROM RL_USER_DEPT
			 WHERE OPERATING_FACILITY_ID = :nd_operating_facility_id
			 AND user_id = :p_user_id
			 AND section_code = :rl_hdr_section_code;

	print_name_yn.arr[print_name_yn.len]	= '\0';

}
/*------------------------------------------------------------*/
get_desc_snomed2()
{
    rl_snomed2_desc1.arr[0]          = '\0';
    rl_snomed2_desc2.arr[0]          = '\0';
    rl_snomed2_desc3.arr[0]          = '\0';
    rl_snomed2_desc4.arr[0]          = '\0';
    rl_snomed2_desc5.arr[0]          = '\0';
    rl_snomed2_print_yn.arr[0]       = '\0';
	rl_print_snomed2_code_yn.arr[0]	 = '\0';

    rl_snomed2_desc1.len             = 0;
    rl_snomed2_desc2.len             = 0;
    rl_snomed2_desc3.len             = 0;
    rl_snomed2_desc4.len             = 0;
    rl_snomed2_desc5.len             = 0;
    rl_snomed2_print_yn.len			 = 0;
	rl_print_snomed2_code_yn.arr[0]	 = '\0';

/************************** changed on 01/09/2002   
                     DESCRIPTION_2,
                     DESCRIPTION_3,
                     DESCRIPTION_4,
                     DESCRIPTION_5,

                   :rl_snomed2_desc2,
                   :rl_snomed2_desc3,
                   :rl_snomed2_desc4,
                   :rl_snomed2_desc5,

******************************************/

     EXEC SQL SELECT SUBSTR(DESCRIPTION_1, 1, 12),
					 NVL(PRINT_YN, 'N'),
					 NVL(print_code_yn, 'N')
	           INTO :rl_snomed2_desc1,
    			    :rl_snomed2_print_yn,
					:rl_print_snomed2_code_yn
             FROM RL_SNOMED_CODE_lang_vw
             WHERE SNOMED_CODE = :rl_res_snomed_code2
			 and language_id = :language_id;

    rl_snomed2_desc1.arr[rl_snomed2_desc1.len] = '\0';
    rl_snomed2_desc2.arr[rl_snomed2_desc2.len] = '\0';
    rl_snomed2_desc3.arr[rl_snomed2_desc3.len] = '\0';
    rl_snomed2_desc4.arr[rl_snomed2_desc4.len] = '\0';
    rl_snomed2_desc5.arr[rl_snomed2_desc5.len] = '\0';
    rl_snomed2_print_yn.arr[rl_snomed2_print_yn.len] = '\0';
	rl_print_snomed2_code_yn.arr[rl_print_snomed2_code_yn.len]	= '\0';

}
/*------------------------------------------------------------*/
print_line_snomed1(char *t_str)
{
         fprintf(fp,"%-18.18s",t_str);

}
/*------------------------------------------------------------*/
print_line_snomed2(char *t_str)
{
         fprintf(fp,"%-18.18s",t_str);
}
/*------------------------------------------------------------*/
add_zero_after_result()
{
	int i = 0;
	char rslt[21];
	int l_decimal_position = 0;

	strcpy(rslt, r_rslt.arr);

//	if (atoi(r_rslt.arr) > 1 || atoi(r_rslt.arr) == 1)
//	{

		v_numeric_result.arr[0]		= '\0';
		v_numeric_result.len		= 0;

		l_exist_decimals = 0;
		l_inst_decimals = 0;
		
		EXEC SQL SELECT TO_NUMBER(:r_rslt) - FLOOR(TO_NUMBER(:r_rslt)),
						LENGTH(SUBSTR(:r_rslt, INSTR(:r_rslt, '.') + 1)), INSTR(:r_rslt, '.')
				 INTO :v_numeric_result, :l_exist_decimals, :l_inst_decimals
				 FROM DUAL;

	
		v_numeric_result.arr[v_numeric_result.len]	= '\0';

		if (l_inst_decimals == 0)
			l_exist_decimals = 0;

		l_decimal_position = l_exist_decimals;


//		if (strcmp(v_numeric_result.arr, "0") == 0)
//		{

			for (i = l_exist_decimals;i < rl_tst_cd_no_of_decimals; i++)
			{

/**************  
			if (strcmp(rslt, "4.65") == 0)  
			{
				sprintf(string_var, "RESULT  %d  %d  %s", l_exist_decimals, rl_tst_cd_no_of_decimals,
											r_rslt.arr);
				disp_message(ERR_MESG, string_var);
			}
****************/ 

				 
				if (l_decimal_position == 0)
					strcat(r_rslt.arr, ".");				
	
				strcat(r_rslt.arr, "0");

				l_decimal_position++;

			}
	
			r_rslt.len = strlen(r_rslt.arr);
//		}
/*		else
		{

			strcpy(r_rslt.arr, rslt);
			r_rslt.len = strlen(r_rslt.arr);

		}
*/



//	}

	
	for (i = 0; i < 10; i++)
	{
		rslt[i] = r_rslt.arr[i];
	}

	rslt[i] = '\0';

	strcpy(r_rslt.arr, rslt);
	r_rslt.len = strlen(r_rslt.arr);

}
/*------------------------------------------------------------*/
print_str(char l_mode)
{

	if ( rl_snomed_print_yn.arr[0]	== 'Y' || rl_snomed2_print_yn.arr[0]	== 'Y' ||
		rl_print_snomed_code_yn.arr[0] == 'Y' || rl_print_snomed2_code_yn.arr[0] == 'Y' )
	{

		something_to_print = 1;
		something_to_print_for_test = 1;

		//fprintf(fp, "SNOMED : ");
		fprintf(fp, "%-6.6s : ", local_legend[70]);  //added for globalisation
        l_snomed_head_printed = 1;

		if (rl_print_snomed_code_yn.arr[0] == 'Y' )
		{
			print_line_snomed2(rl_res_snomed_code.arr);
		}
		else
			print_line_snomed2(" ");
	
		fprintf(fp, " | ");

		if (rl_print_snomed2_code_yn.arr[0] == 'Y' && 
				strlen(rl_res_snomed_code2.arr) > 0 )
		{
			print_line_snomed2(rl_res_snomed_code2.arr);
		}
		else
		{
			print_line_snomed2(" ");
		}


	}
	
}
/*------------------------------------------------------------*/
print_snomed_codes(char l_mode)
{
	if (l_mode == 'Y')
		//fprintf(fp, "SNOMED : ");
		fprintf(fp, "%-6.6s : ", local_legend[70]);  //added for globalisation
	else
	{
		fprint_repeat(fp, ' ', 9);
	}

	if (strlen(rl_res_snomed_code2.arr) > 0 )
	{
		print_line_snomed2(rl_res_snomed_code.arr);
	}
	else
	{
		print_line_snomed1(rl_res_snomed_code.arr);
	}

	fprintf(fp, " | ");
	print_line_snomed2(rl_res_snomed_code2.arr);
    
}
/*------------------------------------------------------------*/
 patient_age()
 {

		 float  lone = 0;
		 float  num1 = 0, yrs = 0, 
				tmp_mths = 0, 
				tmp_days = 0;

		 char st_r[50];

	tday.arr[0] = '\0';
	tday.len = 0;

	mths.arr[0]  = '\0';
	mths.len  = 0;

	
	EXEC SQL SELECT TO_CHAR(SYSDATE,'DD/MM/YYYY') INTO :tday
            FROM DUAL;                                        

    EXEC SQL SELECT ABS(MONTHS_BETWEEN(
		TO_DATE(:rl_regd_date,'DD/MM/YYYY'), 
		TO_DATE(:rl_pat_date_of_birth, 'DD/MM/YYYY')))
			INTO :mt FROM DUAL;

			sprintf(mths.arr,"%f",mt);
			strcpy(mths1.arr, mths.arr);

        	tday.arr[tday.len] = '\0';
							
			lone = atoi(strtok(mths1.arr, ".")) ;

		   if (lone > 0) 
		   {
			  num1 = lone/12 ;
			  sprintf(t_age.arr, "%f", num1);
			  yrs = atoi(strtok(t_age.arr, ".")) ;
		   }
		   else
			  yrs = 0;
            
			tmp_mths   = atoi(mths1.arr) - (yrs * 12) ;
			sprintf(t_age.arr, "%f", tmp_mths);
			tmp_mths   = atoi(strtok(t_age.arr, "."));

			if ((tmp_mths == 0)  && (yrs ==0))
			{

				EXEC SQL SELECT TO_CHAR(ROUND((TO_DATE(:rl_regd_date,'DD/MM/YYYY') -
					TO_DATE(:rl_pat_date_of_birth, 'DD/MM/YYYY')),3))
					INTO :t_days FROM DUAL;

					tmp_days = atoi(strtok(t_days.arr,"."));
			}
			else
				tmp_days = (atof(mths.arr) - atoi(mths1.arr)) * 31 ;


			sprintf(st_r, "%f", yrs);
			strcpy(t_age.arr, strtok(st_r, "."));
			//strcat(t_age.arr, "Y");
			strncat(t_age.arr, local_legend[72],1);

			if (strcmp(rl_report_format.arr, "6") != 0  
			    && strcmp(l_customer_id.arr, "AMRI") != 0) 
					
			{
				sprintf(st_r, " %f", tmp_mths);
				strcat(t_age.arr, strtok(st_r, "."));
				//strcat(t_age.arr, "M");
				strncat(t_age.arr, local_legend[73],1);
				sprintf(st_r, " %f", tmp_days);
				strcat(t_age.arr, strtok(st_r, "."));
				//strcat(t_age.arr, "D ");
				strncat(t_age.arr, local_legend[74],1);
			}
			

			if (strcmp(l_customer_id.arr, "AMRI") == 0)
			{
				if (yrs == 0) 
				{
					if ( tmp_mths == 0)
					{
						sprintf(st_r, " %f", tmp_days);
						strcpy(t_age.arr, strtok(st_r, "."));
						strncat(t_age.arr, local_legend[74],1);
					}
					else
					{
						sprintf(st_r, " %f", tmp_mths);
						strcpy(t_age.arr, strtok(st_r, "."));
						strncat(t_age.arr, local_legend[73],1);
					}
				}
			}
 }
/*------------------------------------------------------------*/
get_test_desc()
{
	can_test_name.arr[0]	= '\0';
	can_test_name.len		= 0;
	
	if (strcmp(l_customer_id.arr, "MC") == 0) //ADDED FOR KDAH-SCF-0546
	{
	EXEC SQL SELECT SUBSTR(long_desc,1,38) //added by madhusudhan for GHL-SCF-1104
			 INTO :can_test_name
			 FROM RL_TEST_CODE_LANG_VW
			 WHERE test_code = :can_group_test
			 AND LANGUAGE_ID = :language_id;
    }
	
	else//ADDED FOR KDAH-SCF-0546
	{
	EXEC SQL SELECT long_desc
			 INTO :can_test_name
			 FROM RL_TEST_CODE_LANG_VW
			 WHERE test_code = :can_group_test
			 AND LANGUAGE_ID = :language_id;
	}

	
	can_test_name.arr[can_test_name.len]	= '\0';

	if (NODATAFOUND);


}
/*------------------------------------------------------------*/
get_user_name(char *y_user)
{
	
	strcpy(sy_user.arr, y_user);
	sy_user.len = strlen(sy_user.arr); 
	
	sy_user_name.arr[0]		= '\0';
	sy_user_name.len			= 0;

	sy_func_role_id.arr[0]  = '\0';
	sy_func_role_id.len     = 0;
	
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)
	{
		EXEC SQL SELECT username,func_role_id 
				 INTO :sy_user_name,:sy_func_role_id
				 FROM SY_USER
				 WHERE FACILITY_ID = :nd_operating_facility_id
				   AND user_id = :sy_user;
     }
	 else
	 {
		EXEC SQL SELECT username
				 INTO :sy_user_name
				 FROM SY_USER
				 WHERE FACILITY_ID = :nd_operating_facility_id
				   AND user_id = :sy_user;
	 }

	sy_user_name.arr[sy_user_name.len]		= '\0';
	sy_func_role_id.arr[sy_func_role_id.len] = '\0';

	if (NODATAFOUND);
	if (OERROR);

}
/*------------------------------------------------------------*/
fetch_sy_urgent()
{

	EXEC SQL DECLARE urgent_curs CURSOR FOR
		 SELECT OPERATING_FACILITY_ID,
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID,
				PRINT_SERVER_ID,
				PRINTER_NAME,
				DEST_QUEUE_NAME,
				FAX_ID,
				MAIL_ID
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
		    AND PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'U'
		//Ravi Shankar, 07/10/2016, IN-62208
		AND     (:BVServicedRequestID = '*A'
	        OR (:BVServicedRequestID = 'O' 
		AND WS_NO IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		OR (:BVServicedRequestID = 'N' 
		AND WS_NO NOT IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		   ); 
		//////////////;

	EXEC SQL OPEN urgent_curs;

sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';
nd_operating_facility_id.arr[0]		    = '\0';

p_print_id.arr[0]   = '\0';
p_printer_name.arr[0] = '\0';
p_dest_queue_name.arr[0] = '\0';
p_fax_address.arr[0]      = '\0';     
p_mail_address.arr[0]     = '\0';    


sy_session_id.len	     = 0;
sy_user_id.len	         = 0;
sy_req_date.len          = 0;
sy_machine_name.len      = 0;
sy_ws_no.len             = 0;
sy_rowid.len             = 0;
nd_operating_facility_id.len = 0;

p_print_id.len = 0;
p_printer_name.len = 0;   
p_dest_queue_name.len = 0;
p_fax_address.len      = 0;
p_mail_address.len     = 0;

	EXEC SQL FETCH urgent_curs 
	       INTO	:nd_operating_facility_id,
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid,
				:p_print_id,
				:p_printer_name,
				:p_dest_queue_name,
				:p_fax_address,       
				:p_mail_address;
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_user_id.arr[sy_user_id.len] = '\0';
      sy_session_id.arr[sy_session_id.len] = '\0';
      sy_rowid.arr[sy_rowid.len] = '\0';
      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_machine_name.arr[sy_machine_name.len] = '\0';
	  sy_ws_no.arr[sy_ws_no.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';
	  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';

	  p_print_id.arr[p_print_id.len] = '\0';
	  p_printer_name.arr[p_printer_name.len] = '\0';
	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	  p_mail_address.arr[p_mail_address.len]         = '\0';    

    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
fetch_sy_stat()
{

	EXEC SQL DECLARE stat_curs CURSOR FOR
		 SELECT OPERATING_FACILITY_ID,
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID,
				PRINT_SERVER_ID,
				PRINTER_NAME,
				DEST_QUEUE_NAME,
				FAX_ID,
				MAIL_ID
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
		    AND PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'S'
		//Ravi Shankar, 07/10/2016, IN-62208
		AND     (:BVServicedRequestID = '*A'
	        OR (:BVServicedRequestID = 'O' 
		AND WS_NO IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		OR (:BVServicedRequestID = 'N' 
		AND WS_NO NOT IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		   ); 
		//////////////;

	EXEC SQL OPEN stat_curs;

sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';
nd_operating_facility_id.arr[0]		    = '\0';

p_print_id.arr[0]   = '\0';
p_printer_name.arr[0] = '\0';
p_dest_queue_name.arr[0] = '\0';
p_fax_address.arr[0]      = '\0';     
p_mail_address.arr[0]     = '\0';    

sy_session_id.len	    = 0;
sy_user_id.len	        = 0;
sy_req_date.len         = 0;
sy_machine_name.len     = 0;
sy_ws_no.len            = 0;
sy_rowid.len            = 0;
nd_operating_facility_id.len = 0;

p_print_id.len = 0;
p_printer_name.len = 0;   
p_dest_queue_name.len = 0;
p_fax_address.len      = 0;
p_mail_address.len     = 0;

	EXEC SQL FETCH stat_curs 
	       INTO	:nd_operating_facility_id,
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid,
				:p_print_id,
				:p_printer_name,
				:p_dest_queue_name,
				:p_fax_address,       
				:p_mail_address;
		
			
      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_user_id.arr[sy_user_id.len] = '\0';
      sy_session_id.arr[sy_session_id.len] = '\0';
      sy_rowid.arr[sy_rowid.len] = '\0';
      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_machine_name.arr[sy_machine_name.len] = '\0';
	  sy_ws_no.arr[sy_ws_no.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';
	  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';

	  p_print_id.arr[p_print_id.len] = '\0';
	  p_printer_name.arr[p_printer_name.len] = '\0';
	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	  p_mail_address.arr[p_mail_address.len]         = '\0';    

    return (LAST_ROW?0:1); 

}
/*------------------------------------------------------------*/
fetch_sy_routine()
{
	EXEC SQL DECLARE routine_curs CURSOR FOR
		 SELECT OPERATING_FACILITY_ID,
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID,
				PRINT_SERVER_ID,
				PRINTER_NAME,
				DEST_QUEUE_NAME,
				FAX_ID,
				MAIL_ID
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
		    AND PGM_ID = 'RLRRSENQ'
			AND REQUEST_STATUS IS NULL
			AND NVL(URGENT_INDICATOR,' ') = 'R'
		//Ravi Shankar, 07/10/2016, IN-62208
		AND     (:BVServicedRequestID = '*A'
	        OR (:BVServicedRequestID = 'O' 
		AND WS_NO IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		OR (:BVServicedRequestID = 'N' 
		AND WS_NO NOT IN (SELECT WS_NO FROM RL_RESULT_PRINT_OP_WSNO WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,:nd_facility_id)) )
		   ); 
		//////////////;

	EXEC SQL OPEN routine_curs;

sy_user_id.arr[0] 		= '\0';
sy_session_id.arr[0] 	= '\0';
sy_req_date.arr[0]      = '\0';
sy_machine_name.arr[0]  = '\0';
sy_ws_no.arr[0]		    = '\0';
sy_rowid.arr[0]		    = '\0';
nd_operating_facility_id.arr[0]		    = '\0';

p_print_id.arr[0]   = '\0';
p_printer_name.arr[0] = '\0';
p_dest_queue_name.arr[0] = '\0';
p_fax_address.arr[0]      = '\0';     
p_mail_address.arr[0]     = '\0';    

sy_session_id.len	    = 0;
sy_user_id.len	        = 0;
sy_req_date.len         = 0;
sy_machine_name.len     = 0;
sy_ws_no.len            = 0;
sy_rowid.len            = 0;
nd_operating_facility_id.len = 0;

p_print_id.len = 0;
p_printer_name.len = 0;   
p_dest_queue_name.len = 0;
p_fax_address.len      = 0;
p_mail_address.len     = 0;

	EXEC SQL FETCH routine_curs 
	       INTO	:nd_operating_facility_id,
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid,
				:p_print_id,
				:p_printer_name,
				:p_dest_queue_name,
				:p_fax_address,       
				:p_mail_address;
							
			
      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_user_id.arr[sy_user_id.len] = '\0';
      sy_session_id.arr[sy_session_id.len] = '\0';
      sy_rowid.arr[sy_rowid.len] = '\0';
      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_machine_name.arr[sy_machine_name.len] = '\0';
	  sy_ws_no.arr[sy_ws_no.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';
	  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';

	  p_print_id.arr[p_print_id.len] = '\0';
	  p_printer_name.arr[p_printer_name.len] = '\0';
	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	  p_mail_address.arr[p_mail_address.len]         = '\0';    

    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
close_urgent_curs()
{
	EXEC SQL CLOSE urgent_curs;

}
/*------------------------------------------------------------*/
close_stat_curs()
{
	EXEC SQL CLOSE stat_curs;

}
/*------------------------------------------------------------*/
close_routine_curs()
{
	EXEC SQL CLOSE routine_curs;


}
/**************************select transaction based or not ***************/
get_trans_ind()
{
	
	nd_trx_ind.arr[0]		= '\0';
	nd_trx_ind.len		= 0;

	EXEC SQL  SELECT NVL(TRANSACTION_BASED_YN, 'N')
	          INTO   :nd_trx_ind
	          FROM   sy_online_print_id
              WHERE  ONLINE_PRINT_NAME = 'RLRRSENQ';

	if(OERROR)
	{
	    ins_message(ORA_MESG,"SELECT failed on  SY_ON_LINE_PRINT_ID");
	}

	nd_trx_ind.arr[nd_trx_ind.len]			= '\0';


    if(NODATAFOUND)
		return 0;

		
	return 1;

}
/*------------------------------------------------------------*/
declare_param_curs()
{

	EXEC SQL DECLARE param_curs CURSOR FOR
			 SELECT	OPERATING_FACILITY_ID,
			    PARAM1,
			    PARAM2,
			    PARAM3,
			    PARAM4,
			    PARAM5,
				NVL(PARAM6,'N'),
				PARAM7,
				PARAM8,
				NVL(PARAM9,'PRINT'),
				NVL(PARAM10, 'N'),
				NVL(PARAM11, 'N'),
				NVL(PARAM12, 'N'),
				NVL(PARAM13, 'N'),
		///		PARAM14,
				PARAM15,
				PARAM16,
		///		PARAM17, 
		///		PARAM18,
				PARAM19,  
				PARAM20,
				PARAM21,
		///		PARAM22,
		///		PARAM23,
				rowid,
				pgm_date,
				param18
			FROM SY_PROG_PARAM
			WHERE OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
			AND pgm_id = 'RLRSENQ1'
			AND session_id = TO_NUMBER(:c_session_id)
            AND param4 = :c_user_id
			ORDER BY param9, TO_DATE(param10, 'DD/MM/YYYY HH24:MI:SS');


	EXEC SQL OPEN param_curs;


      if(OERROR)
         ins_message(ORA_MESG,"Error in opening cursor param_curs");

}

/*------------------------------------------------------------*/
fetch_param_curs()
{

	rl_prn_ctrl_hdr_pat_no.arr[0] 		= '\0';
	rl_prn_ctrl_hdr_sp_no.arr[0] 		= '\0';
	rl_prn_ctrl_hdr_source_code.arr[0] 	= '\0';
	rl_prn_ctrl_hdr_user.arr[0] 		= '\0';
	rl_prn_ctrl_hdr_section_code.arr[0] = '\0';
	rl_prn_ctrl_hdr_rp_yn.arr[0]		= '\0';
	p_param7.arr[0]						= '\0';
	p_param8.arr[0]						= '\0';
	p_param9.arr[0]						= '\0';   //// 09.12.2004
	p_param10.arr[0]					= '\0';
	p_param11.arr[0]					= '\0';

	p_param12.arr[0]					= '\0';  
	p_param13.arr[0]					= '\0';  
	p_param18.arr[0]					= '\0'; // added for GHL-CRF-0433.1
	p_fax_id.arr[0]						= '\0';  
	p_mail_id.arr[0]					= '\0';  
///	p_print_id.arr[0]					= '\0';

///	p_printer_name.arr[0]				= '\0';
///	p_dest_queue_name.arr[0]			= '\0';  //// 21.08.2005

	p_fax_to_rcpt_name.arr[0] = '\0';
	p_fax_to_comp_name.arr[0] = '\0';
	p_fax_to_phone_no.arr[0]  = '\0'; 
///	p_fax_address.arr[0]      = '\0';     
///	p_mail_address.arr[0]     = '\0';    

	nd_rowid.arr[0]						= '\0';
	c_pgm_date.arr[0]					= '\0';
	nd_operating_facility_id.arr[0]		= '\0';

	rl_prn_ctrl_hdr_pat_no.len 	        = 0;
	rl_prn_ctrl_hdr_source_code.len     = 0;
	rl_prn_ctrl_hdr_sp_no.len 	        = 0;
	rl_prn_ctrl_hdr_section_code.len    = 0;
	rl_prn_ctrl_hdr_user.len	        = 0;
	rl_prn_ctrl_hdr_rp_yn.len			= 0;
	p_param7.len						= 0;
	p_param8.len						= 0;
	p_param9.len						= 0;  //// 09.12.2004
	p_param10.len						= 0;
	p_param11.len						= 0;

	p_param12.len						= 0;  /// 07.08.2005
	p_param13.len						= 0;  /// 16.01.2006
	p_param18.len						= 0;// added for GHL-CRF-0433.1
	p_fax_id.len						= 0;
	p_mail_id.len						= 0;
///	p_print_id.len						= 0;

///	p_printer_name.len					= 0;
///	p_dest_queue_name.len				= 0;

	p_fax_to_rcpt_name.len = 0;
	p_fax_to_comp_name.len = 0;
	p_fax_to_phone_no.len  = 0;
///	p_fax_address.len      = 0;
///	p_mail_address.len     = 0;

	nd_rowid.len						= 0;
	c_pgm_date.len						= 0;
	nd_operating_facility_id.len		= 0;


	EXEC SQL FETCH param_curs 
	       INTO	:nd_operating_facility_id,
			    :rl_prn_ctrl_hdr_pat_no,
	   	   	    :rl_prn_ctrl_hdr_sp_no,
			    :rl_prn_ctrl_hdr_source_code,
			    :rl_prn_ctrl_hdr_user,
			    :rl_prn_ctrl_hdr_section_code,
				:rl_prn_ctrl_hdr_rp_yn,
				:p_param7,
				:p_param8,
				:p_param9,    /// 09.12.2004
				:p_param10,
				:p_param11,
				:p_param12,  /// added on 07.08.2005
				:p_param13,  /// added on 16.01.2006
		///		:p_print_id,
				:p_fax_id,
				:p_mail_id,
		///		:p_printer_name,    //// added on 21.08.2005
		///		:p_dest_queue_name,
				:p_fax_to_rcpt_name,  /// added on 16.01.2006
				:p_fax_to_comp_name,  /// added on 16.01.2006
				:p_fax_to_phone_no,   /// added on 16.01.2006
		///		:p_fax_address,       /// added on 16.01.2006
		///		:p_mail_address,      /// added on 16.01.2006
				:nd_rowid,
				:c_pgm_date,
				:p_param18; // added for GHL-CRF-0433.1
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_PROG_PARAM");

	      rl_prn_ctrl_hdr_pat_no.arr[rl_prn_ctrl_hdr_pat_no.len]           = '\0';
	      rl_prn_ctrl_hdr_sp_no.arr[rl_prn_ctrl_hdr_sp_no.len]             = '\0';
	      rl_prn_ctrl_hdr_source_code.arr[rl_prn_ctrl_hdr_source_code.len] = '\0';
 	      rl_prn_ctrl_hdr_user.arr[rl_prn_ctrl_hdr_user.len]               = '\0';
	      rl_prn_ctrl_hdr_section_code.arr[rl_prn_ctrl_hdr_section_code.len]  = '\0';
          rl_prn_ctrl_hdr_rp_yn.arr[rl_prn_ctrl_hdr_rp_yn.len]		 = '\0';
		  p_param7.arr[p_param7.len]								 = '\0';
		  nd_rowid.arr[nd_rowid.len]								 = '\0';
		  p_param8.arr[p_param8.len]								 = '\0';
		  p_param9.arr[p_param9.len]								 = '\0';
		  p_param10.arr[p_param10.len]								 = '\0';
		  p_param11.arr[p_param11.len]								 = '\0';

		  p_param12.arr[p_param12.len]								 = '\0';
		  p_param13.arr[p_param13.len]								 = '\0';
		  p_param18.arr[p_param18.len]								 = '\0';// added for GHL-CRF-0433.1
///		  p_print_id.arr[p_print_id.len]							 = '\0';
		  p_fax_id.arr[p_fax_id.len]								 = '\0';
		  p_mail_id.arr[p_mail_id.len]								 = '\0';

///		  p_printer_name.arr[p_printer_name.len]					 = '\0';
///		  p_dest_queue_name.arr[p_dest_queue_name.len]			     = '\0'; 

		  p_fax_to_rcpt_name.arr[p_fax_to_rcpt_name.len] = '\0';
		  p_fax_to_comp_name.arr[p_fax_to_comp_name.len] = '\0';
		  p_fax_to_phone_no.arr[p_fax_to_phone_no.len]   = '\0'; 
///		  p_fax_address.arr[p_fax_address.len]           = '\0';     
///		  p_mail_address.arr[p_mail_address.len]         = '\0';    

		  c_pgm_date.arr[c_pgm_date.len]							 = '\0';
		  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';
		  
	      strcpy(nd_hosp_no.arr,rl_prn_ctrl_hdr_pat_no.arr);
	      strcpy(nd_spec_no.arr,rl_prn_ctrl_hdr_sp_no.arr);
	      nd_hosp_no.arr[rl_prn_ctrl_hdr_pat_no.len] 	= '\0';
	      nd_spec_no.arr[rl_prn_ctrl_hdr_sp_no.len] 	= '\0';
	      nd_hosp_no.len	= rl_prn_ctrl_hdr_pat_no.len;
	      nd_spec_no.len	= rl_prn_ctrl_hdr_sp_no.len;


	    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
close_param_curs()
{
	EXEC SQL CLOSE param_curs;
}
/*------------------------------------------------------------*/
fetch_sy_requests()
{


	sy_user_id.arr[0] 		= '\0';
	sy_session_id.arr[0] 	= '\0';
	sy_req_date.arr[0]      = '\0';
	sy_machine_name.arr[0]  = '\0';
	sy_ws_no.arr[0]		    = '\0';
	sy_rowid.arr[0]		    = '\0';

	p_print_id.arr[0]   = '\0';
	p_printer_name.arr[0] = '\0';
	p_dest_queue_name.arr[0] = '\0';
	p_fax_address.arr[0]      = '\0';     
	p_mail_address.arr[0]     = '\0';    

	sy_session_id.len	    = 0;
	sy_user_id.len	        = 0;
	sy_req_date.len         = 0;
	sy_machine_name.len     = 0;
	sy_ws_no.len            = 0;
	sy_rowid.len            = 0;

	p_print_id.len = 0;
	p_printer_name.len = 0;    
	p_dest_queue_name.len = 0;
	p_fax_address.len      = 0;
	p_mail_address.len     = 0;

		EXEC SQL SELECT
			    SESSION_ID,
				USER_ID,
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'),
				MACHINE_NAME,
				WS_NO,
				ROWID,
				PRINT_SERVER_ID,
				PRINTER_NAME,   
				DEST_QUEUE_NAME,
				FAX_ID,         
				MAIL_ID        
		   INTO 
                :sy_session_id,
                :sy_user_id,
                :sy_req_date,
				:sy_machine_name,
				:sy_ws_no,
				:sy_rowid,
				:p_print_id,
				:p_printer_name,
				:p_dest_queue_name,
				:p_fax_address,       /// added on 16.01.2006
				:p_mail_address      /// added on 16.01.2006
	       FROM	SY_REPORT_GENERATE_REQUEST
	      WHERE	operating_facility_id = :nd_operating_facility_id
		    AND pgm_id = 'RLRSENQ1'
	        AND	session_id = TO_NUMBER(:c_session_id)
			AND request_date = TO_DATE(:c_pgm_date, 'DDMMYYHH24MISS')
            AND user_id = :c_user_id
			AND request_status IS NULL;

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      if (NOT_FOUND) 
	      return FALSE;
	  else
	  {
		sy_user_id.arr[sy_user_id.len] = '\0';
		sy_session_id.arr[sy_session_id.len] = '\0';
		sy_rowid.arr[sy_rowid.len] = '\0';
		sy_req_date.arr[sy_req_date.len] = '\0';
		sy_machine_name.arr[sy_machine_name.len] = '\0';
		sy_ws_no.arr[sy_ws_no.len] = '\0';
		sy_rowid.arr[sy_rowid.len] = '\0';

		  p_print_id.arr[p_print_id.len] = '\0';
		  p_printer_name.arr[p_printer_name.len] = '\0';
		  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
		  p_fax_address.arr[p_fax_address.len]           = '\0';     
		  p_mail_address.arr[p_mail_address.len]         = '\0';    

		return TRUE;
	  }



    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
gen_file_name1()
{
     nd_file_name.arr[0]   = '\0';
     nd_file_name.len      = 0;

     if (OERROR)
         ins_message(ORA_MESG,"Fetch failed on table RL_PARAM");
      
     nd_file_no.arr[nd_file_no.len] = '\0';

     sprintf(nd_file_name.arr,"%srlrsenq1.lis", WORKING_DIR);

	 strcpy(nd_f_name,nd_file_name.arr);
		/************************************************/ 
		   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN GENERATE FILE NAME1......");
			write_to_file();
		   }

		/************************************************/
     if ((fp = fopen(nd_file_name.arr,"w")) == NULL)
     {
		/************************************************/ 
		   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN GENERATE FILE NAME1......ERROR");
			write_to_file();
		   }

		/************************************************/

		strcpy(string_var, "");
		sprintf(string_var, "F1-[%c]<->%s::Mail-[%c]<->[%c]", l_destn_rep_yn, nd_file_name.arr, l_destn_mail_yn, l_destn_fax_yn);

        ins_message1(ERR_MESG, string_var);

     }
		/************************************************/ 
		   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
		   {

			l_text.arr[0]		    = '\0';
			l_text.len            = 0;
			strcpy(l_text.arr,"IN GENERATE FILE NAME1......LAST");
			write_to_file();
		   }

		/************************************************/

}
/*-----------------------------------------------------*/
gen_extra_file_name1()
{
   sprintf(extra_file_name,"%srlrsenqe.lis",WORKING_DIR);

   strcpy(nd_e_name,extra_file_name);
			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN gen_extra_file_name1......");
				write_to_file();
			   }

			/************************************************/

   if ((fp = fopen(extra_file_name,"w")) == NULL)
   {
			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN gen_extra_file_name1......ERROR");
				write_to_file();
			   }

			/************************************************/

		strcpy(string_var, "");
		sprintf(string_var, "E1-[%c]<->%s::Mail-[%c]<->[%c]", l_destn_rep_yn, extra_file_name, l_destn_mail_yn, l_destn_fax_yn);
        ins_message1(ERR_MESG, string_var);

   }
			/************************************************/ 
			   if ( strcmp(l_file_exists.arr,"Y")==0 && strcmp(l_dir_exists.arr,"Y")==0)
			   {

				l_text.arr[0]		    = '\0';
				l_text.len            = 0;
				strcpy(l_text.arr,"IN gen_extra_file_name1......LAST");
				write_to_file();
			   }

			/************************************************/

}
/*-----------------------------------------------------*/
patch_sy_table()
{


		   EXEC SQL SELECT COUNT(1)
				    INTO  :v_count
				    FROM   SY_REPORT_GENERATE_REQUEST
				    WHERE  OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
				    AND    pgm_id IN ('RLRRSENQ')
				    AND    request_status = 'E';
		
		   if (v_count > 0)
		   {
		   /***** commented against MZ issue on 02.06.2008
				declare_sy_curs();
				while(fetch_sy_curs())
				{
					update_sy_curs();
				}	
				close_sy_curs();

			*********/

				declare_sy_curs_e();
				while(fetch_sy_curs_e())
				{
					delete_sy_curs();
					del_sy_prog_param();
				}	
				close_sy_curs_e();

				EXEC SQL COMMIT WORK;
		   }

}
/*------------------------------------------------------------*/
declare_sy_curs()
{
	EXEC SQL DECLARE sy_curs CURSOR FOR
		SELECT  OPERATING_FACILITY_ID,
				SESSION_ID, USER_ID, 
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'), 
				MACHINE_NAME, WS_NO, ROWID,
				PRINT_SERVER_ID,PRINTER_NAME,DEST_QUEUE_NAME,        
				FAX_ID,MAIL_ID                 
	       FROM	SY_REPORT_GENERATE_REQUEST 
	      WHERE	OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
		    AND pgm_id IN ('RLRRSENQ') 
		    AND request_date > (SYSDATE - 2) 
			AND NVL(request_status, 'O') = 'E';


	EXEC SQL OPEN sy_curs;
}
/*------------------------------------------------------------*/
fetch_sy_curs()
{
		sy_user_id.arr[0] 				= '\0';
		sy_session_id.arr[0] 			= '\0';
		sy_req_date.arr[0]				= '\0';
		sy_machine_name.arr[0]			= '\0';
		sy_ws_no.arr[0]					= '\0';
		sy_rowid.arr[0]					= '\0';
		nd_operating_facility_id.arr[0]	= '\0';

		p_print_id.arr[0]   = '\0';
		p_printer_name.arr[0] = '\0';
		p_dest_queue_name.arr[0] = '\0';
		p_fax_address.arr[0]      = '\0';     
		p_mail_address.arr[0]     = '\0';    

		sy_session_id.len	    = 0;
		sy_user_id.len	        = 0;
		sy_req_date.len         = 0;
		sy_machine_name.len     = 0;
		sy_ws_no.len            = 0;
		sy_rowid.len            = 0;
		nd_operating_facility_id.len = 0;

		p_print_id.len = 0;
		p_printer_name.len = 0;    
		p_dest_queue_name.len = 0;
		p_fax_address.len      = 0;
		p_mail_address.len     = 0;

			EXEC SQL FETCH sy_curs
					 INTO :nd_operating_facility_id,	
						  :sy_session_id,
						  :sy_user_id,
						  :sy_req_date,
						  :sy_machine_name,
						  :sy_ws_no,
						  :sy_rowid,
						  :p_print_id,
						  :p_printer_name,
						  :p_dest_queue_name,
						  :p_fax_address,       /// added on 16.01.2006
						  :p_mail_address;      /// added on 16.01.2006
						  
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_user_id.arr[sy_user_id.len] = '\0';
      sy_session_id.arr[sy_session_id.len] = '\0';
      sy_rowid.arr[sy_rowid.len] = '\0';
      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_machine_name.arr[sy_machine_name.len] = '\0';
	  sy_ws_no.arr[sy_ws_no.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';
	  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';

	  p_print_id.arr[p_print_id.len] = '\0';
	  p_printer_name.arr[p_printer_name.len] = '\0';
	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	  p_mail_address.arr[p_mail_address.len]         = '\0';    


    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
close_sy_curs()
{
	EXEC SQL CLOSE sy_curs;

}
/*------------------------------------------------------------*/
update_sy_curs()
{
   EXEC SQL UPDATE SY_REPORT_GENERATE_REQUEST
               SET request_status = NULL
			 WHERE ROWID = :sy_rowid;

   if(OERROR) 
      ins_message(ERR_MESG,"Failed in update_sy_curs()");       

}
/*------------------------------------------------------------*/
declare_sy_curs_e()
{

	EXEC SQL DECLARE sy_curs_e CURSOR FOR 
  		 SELECT OPERATING_FACILITY_ID,SESSION_ID, USER_ID, 
			    TO_CHAR(REQUEST_DATE,'DDMMYYHH24MISS'), 
				MACHINE_NAME, WS_NO, ROWID, 
				PRINT_SERVER_ID,PRINTER_NAME,DEST_QUEUE_NAME,
				FAX_ID, MAIL_ID        
	       FROM	SY_REPORT_GENERATE_REQUEST 
	      WHERE	OPERATING_FACILITY_ID = DECODE(:nd_facility_id,'*A',OPERATING_FACILITY_ID,
         										                   :nd_facility_id)
		    AND pgm_id IN ('RLRRSENQ') 
		    AND request_date < (SYSDATE - 2)
			AND NVL(request_status, 'O') = 'E';


	EXEC SQL OPEN sy_curs_e;
}
/*------------------------------------------------------------*/
fetch_sy_curs_e()
{
		sy_user_id.arr[0] 		= '\0';
		sy_session_id.arr[0] 	= '\0';
		sy_req_date.arr[0]      = '\0';
		sy_machine_name.arr[0]  = '\0';
		sy_ws_no.arr[0]		    = '\0';
		sy_rowid.arr[0]		    = '\0';
		nd_operating_facility_id.arr[0]		    = '\0';

		p_print_id.arr[0]   = '\0';
		p_printer_name.arr[0] = '\0';
		p_dest_queue_name.arr[0] = '\0';
		p_fax_address.arr[0]      = '\0';     
		p_mail_address.arr[0]     = '\0';    

		sy_session_id.len	    = 0;
		sy_user_id.len	        = 0;
		sy_req_date.len         = 0;
		sy_machine_name.len     = 0;
		sy_ws_no.len            = 0;
		sy_rowid.len            = 0;
		nd_operating_facility_id.len = 0;


		p_print_id.len = 0;
		p_printer_name.len = 0;    
		p_dest_queue_name.len = 0;
		p_fax_address.len      = 0;
		p_mail_address.len     = 0;

			EXEC SQL FETCH sy_curs_e
					 INTO :nd_operating_facility_id,	
					 	  :sy_session_id,
						  :sy_user_id,
						  :sy_req_date,
						  :sy_machine_name,
						  :sy_ws_no,
						  :sy_rowid,
						  :p_print_id,
						  :p_printer_name,
						  :p_dest_queue_name,
						  :p_fax_address,       /// added on 16.01.2006
						  :p_mail_address;      /// added on 16.01.2006
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_user_id.arr[sy_user_id.len] = '\0';
      sy_session_id.arr[sy_session_id.len] = '\0';
      sy_rowid.arr[sy_rowid.len] = '\0';
      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_machine_name.arr[sy_machine_name.len] = '\0';
	  sy_ws_no.arr[sy_ws_no.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';
	  nd_operating_facility_id.arr[nd_operating_facility_id.len] = '\0';

	  p_print_id.arr[p_print_id.len] = '\0';
	  p_printer_name.arr[p_printer_name.len] = '\0';
	  p_dest_queue_name.arr[p_dest_queue_name.len] = '\0';
	  p_fax_address.arr[p_fax_address.len]           = '\0';     
	  p_mail_address.arr[p_mail_address.len]         = '\0';    

    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
close_sy_curs_e()
{
	EXEC SQL CLOSE sy_curs_e;

}
/*------------------------------------------------------------*/
delete_sy_curs()
{
   EXEC SQL DELETE FROM SY_REPORT_GENERATE_REQUEST
			 WHERE ROWID = :sy_rowid;

   if(OERROR) 
      ins_message(ERR_MESG,"Failed in delete_sy_curs()");       

}
/*------------------------------------------------------------*/
del_sy_prog_param()
{

	EXEC SQL DELETE FROM SY_PROG_PARAM 
				WHERE operating_facility_id = :nd_operating_facility_id
				AND pgm_id IN ('RLRRSENQ')
				AND session_id = :sy_session_id
				AND pgm_date = :sy_req_date
				AND param4 = :sy_user_id;

	
      if (OERROR)
         ins_message(ORA_MESG,"Delete failed on table SY_PROG_PARAM");

}
/*------------------------------------------------------------*/
delete_error_record()
{

	declare_sy_curs_2();
	while(fetch_sy_curs_2())
	{
		delete_sy_curs2();
		delete_sy_param();

	}
	close_sy_curs_2();

}
/*------------------------------------------------------------*/
declare_sy_curs_2()
{

	EXEC SQL DECLARE sy_curs_2 CURSOR FOR 
			SELECT   TO_CHAR(request_date,'DDMMYYHH24MISS'), ROWID 
	        FROM	SY_REPORT_GENERATE_REQUEST 
		    WHERE	pgm_id IN ('RLRSENQ1') 
		    AND session_id = TO_NUMBER(:c_session_id)
		    AND user_id = :c_user_id
		    AND NVL(request_status, 'O') = 'E';

	EXEC SQL OPEN sy_curs_2;

}
/*------------------------------------------------------------*/
fetch_sy_curs_2()
{
		sy_req_date.arr[0]      = '\0';
		sy_rowid.arr[0]		    = '\0';

		sy_req_date.len         = 0;
		sy_rowid.len            = 0;


			EXEC SQL FETCH sy_curs_2
				INTO	
					:sy_req_date,
					:sy_rowid;
			

      if(OERROR)
         ins_message(ORA_MESG,"Select failed on table SY_REPORT_GENERATE_REQUEST");

      sy_req_date.arr[sy_req_date.len] = '\0';
	  sy_rowid.arr[sy_rowid.len] = '\0';



    return (LAST_ROW?0:1);

}
/*------------------------------------------------------------*/
close_sy_curs_2()
{
	EXEC SQL CLOSE sy_curs_2;

      if(OERROR)
         ins_message(ORA_MESG,"Close failed on cursor sy_curs_2");

}
/*------------------------------------------------------------*/
delete_sy_param()
{

	EXEC SQL DELETE FROM SY_PROG_PARAM
			 WHERE pgm_id = 'RLRSENQ1'
			 AND session_id = TO_NUMBER(:c_session_id)
			 AND pgm_date = :sy_req_date
			 AND param4 = :c_user_id;

      if(OERROR)
         ins_message(ORA_MESG,"Delete failed on table SY_PROG_PARAM");


}
/*------------------------------------------------------------*/
delete_sy_curs2()
{

   EXEC SQL DELETE FROM SY_REPORT_GENERATE_REQUEST
			 WHERE ROWID = :sy_rowid;

   if(OERROR) 
      ins_message(ERR_MESG,"Failed in delete_sy_curs2()");       

}
/*------------------------------------------------------------*/
/*** only for qatar ***/
get_new_medicom_no()
{
	nd_new_medicom_no.arr[0]		= '\0';
	nd_new_medicom_no.len			= 0;


   EXEC SQL SELECT medicom_no
			INTO :nd_new_medicom_no
			FROM RL_PATIENT_TEMP_LINK
			WHERE hmc_no = :nd_hosp_no;

      if(OERROR);

	if (NODATAFOUND);

	nd_new_medicom_no.arr[nd_new_medicom_no.len]	= '\0';

}
/*------------------------------------------------------------*/
get_health_card_num()
{
    rl_health_card_num.arr[0]      = '\0';
	rl_health_num.arr[0]		   = '\0';
	rl_health_exp_date.arr[0]	   = '\0';

    rl_health_card_num.len         = 0;
	rl_health_num.len			   = 0;
	rl_health_exp_date.len		   = 0;
/*
		EXEC SQL 
              SELECT health_card_num, health_num, 
					TO_CHAR(health_card_exp_date, 'DD/MM/YYYY')
			  INTO :rl_health_card_num, :rl_health_num,
				   :rl_health_exp_date
              FROM MP_PATIENT_MAST
             WHERE PATIENT_ID = :nd_hosp_no;
*/

      if(OERROR);

	if (NODATAFOUND);

    rl_health_card_num.arr[rl_health_card_num.len]       = '\0';
	rl_health_num.arr[rl_health_num.len]				 = '\0';
	rl_health_exp_date.arr[rl_health_exp_date.len]		 = '\0';


}
/*------------------------------------------------------------*/

/*------------------------------------------------------------*/
check_any_res_comp()
{

	EXEC SQL SELECT COUNT(1)
				INTO :other_than_comments
                FROM RL_RESULT_TEXT
               WHERE PATIENT_ID     = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
                 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND NVL(hide_text_yn, 'N') <> 'Y';
	
	if (other_than_comments == 0)
	{
		EXEC SQL SELECT  COUNT(1)
			 INTO :other_than_comments
                FROM RL_RESULT_SNOMED A
               WHERE A.PATIENT_ID     = :nd_hosp_no
                 AND A.SPECIMEN_NO     = :nd_spec_no
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
                 AND A.GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND A.TEST_CODE       = :rl_tst_test_code
				AND (A.SNOMED_CODE
							IN (SELECT SNOMED_CODE
								FROM RL_SNOMED_CODE
								WHERE snomed_code = A.snomed_code
								AND (NVL(print_yn, 'N') = 'Y' 
									OR NVL(print_code_yn, 'N') = 'Y' ))
					 OR A.SNOMED_CODE_2
							IN (SELECT SNOMED_CODE
								FROM RL_SNOMED_CODE
								WHERE snomed_code = A.snomed_code_2
								AND (NVL(print_yn, 'N') = 'Y' 
								OR NVL(print_code_yn, 'N') = 'Y' )));

	
		if (other_than_comments == 0)
		{
			EXEC SQL  SELECT COUNT(1)
               INTO :other_than_comments 
                FROM RL_RESULT_ORGANISM
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
				 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
                 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND NVL(hide_organism_yn, 'N') <> 'Y';

/************
			 if (other_than_comments == 0)
			{

			} 
****************/
		}
	}

}


/*------------------------------------------------------------*/
/* SPLITTING THE VARCHAR 2000 INTO 70 CHARACTERS   */
/************************************************/
split_hist()
{
  
	char word[2];
	char w_flag ;

    strcpy(word1,"F");

	w_flag = 'T';

    while(fetch_clinical_text())
    {
          
		  	/***** ADDED FOR SCF42 OF QATAR *****/		
			something_to_print = 1;
			something_to_print_for_test = 1;

		  hell = strlen(d_clinical_text.arr);


         z = 0;
	     clt = 0;
	     strcpy(word1,"F"); 
	     cntr = 1;
	     qq = 0;

         while(z<hell)
         {
		 		  	
		 
             word[0] = d_clinical_text.arr[z];
 		     word[1] = '\0';

		     if (strcmp(word,"\n") == 0)
		     {
   
		       cntr = 0;
		       strcpy(word1,"N");
		       qq = z ;
		      }


  		      if(cntr >= 71)
		      {
		   	
			     cmp = cntr;
			     while((d_clinical_text.arr[z] != 32) && (cmp > 1))
			     {

			         z--;
				     cmp--;
				  
			      }

				  qq = z;
				  			   
			      word[0] = d_clinical_text.arr[z];
   			      word[1] = '\0';
		
		  	      if (cmp == 1)
				     strcpy(word1,"W");
			      else
			         strcpy(word1,"T");
			   
		
		       }


				if (((z == hell) || (z == hell - 1)) && (strcmp(word1,"F") == 0))
				{
	
				   fprint_repeat(fp,' ',8);		   
				   for(i=clt;i < z + 1;i++)
		           {
			       		
						if(d_clinical_text.arr[i] == '\n')
						{


							    w_flag = 'F';
 						 }

						fprintf(fp,"%c",d_clinical_text.arr[i]);
			
			       }

				   if (w_flag == 'T')
				   {
				   };

			       fprintf	(fp,"\n");
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");


				}

			
		       if (strcmp(word1,"N") == 0) 
		       {
				
		          fprint_repeat(fp,' ',8);		   
				  for(i=clt;i<=qq;i++)
		          {
			         if(d_clinical_text.arr[i] == '\n')
					{
						  
								w_flag = 'F';

				    }

				    fprintf(fp,"%c",d_clinical_text.arr[i]);
					
			      }

				  if (w_flag == 'T')
				  {
				  };
					
			      strcpy(word1,"F");
			      cntr = 0 ;
			      clt = qq + 1;
		          qq = 0;
	   	       }

		       if (strcmp(word1,"T") == 0)
		       {
		 										 
			      fprint_repeat(fp,' ',8);		   
				  for(i=clt;i<= qq;i++)
		          {
		             if(d_clinical_text.arr[i] == '\n')
					 {
						 
								w_flag = 'F';

					  }

					  fprintf(fp,"%c",d_clinical_text.arr[i]);
				
			      }

				  if (w_flag == 'T')
				  {
				  };


			       fprintf	(fp,"\n");
			       cntr = 0 ;
				   clt = qq + 1 ;
			       qq = 0;
				   strcpy(word1,"F");

				
		        }


		        if (strcmp(word1,"W") == 0)
		        {
		 										 
			       fprint_repeat(fp,' ',8);		   
				   for(i=clt;i < clt + 70;i++)
		           {
		              if(d_clinical_text.arr[i] == '\n')
						{

								w_flag = 'F';
						}

						fprintf(fp,"%c",d_clinical_text.arr[i]);
				
			       }

				   if (w_flag = 'T')
				   {
				   };

			       fprintf(fp,"\n");
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");

				
		        }

			w_flag = 'T';	  
	        cntr += 1;
	        z++ ;
          }

		
      }
  
       fflush(fp);

#ifdef DEBUG
   printf("rl_res_result_text = %s\n", d_clinical_text.arr);
#endif

if (OERROR)
      ins_message(ERR_MESG, "SPLITTING failed on table RL_PATIENT_CLINICAL_TEXT");

}
/*------------------------------------------------------------*/
print_hmc_no()
{
	char v_patient_id [100];

	get_hmc_no();

	if (strlen(rl_hmc_no.arr) > 0)
	{
		
		fprintf(fp,"%c&k4S",ESC); 
	   	fprintf(fp,"%c(s4B",ESC);
		//fprintf(fp, "Patient  ID  : ");
		fprintf(fp,"%-13.13s: ", local_legend[26]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   
	
		if(rl_hdr_episode_type.arr[0] == 'R')
		{
			if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 			strcpy(v_patient_id,nd_hosp_no.arr);
			else
				strcpy(v_patient_id,rl_pat_actual_id.arr);
		}
		else
			strcpy(v_patient_id,nd_hosp_no.arr);

		fprintf(fp, "%-15.15s                          ", v_patient_id);
		
			page_break(1);

			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp, "HMC No. : ");
			fprintf(fp,"%-11.11s: ",local_legend[1]); // added for globalisation
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s-3B",ESC);   

			fprintf(fp,"%c&k12S",ESC);	
			fprintf(fp,"%c&l6D",ESC);
   			fprintf(fp,"%c(s4B",ESC);

			fprintf(fp,"%-20.20s\n",rl_hmc_no.arr);
	
			fprintf(fp,"%c&k4S",ESC); 
   			fprintf(fp,"%c(s-3B",ESC);

	}

}
/*------------------------------------------------------------*/
get_hmc_no()
{
	rl_hmc_no.arr[0]		= '\0';
	rl_hmc_no.len			= 0;

	if (strcmp(rl_alt_id_for_pat_id.arr, "!") != 0)
	{
		if (strcmp(rl_alt_id_for_pat_id.arr, "ALT_ID1_NO") == 0 ||
			strcmp(rl_alt_id_for_pat_id.arr, "ALTERNATE_ID_NUM") == 0)
		{
			EXEC SQL SELECT alternate_id_num
					 INTO :rl_hmc_no
					 FROM MP_PATIENT_MAST
					 WHERE patient_id = :nd_hosp_no;
		}
		else if (strcmp(rl_alt_id_for_pat_id.arr, "ALT_ID2_NO") == 0 || 
			strcmp(rl_alt_id_for_pat_id.arr, "ALTERNATE_ID2_NUM") == 0)
		{

			EXEC SQL SELECT alternate_id2_num
					 INTO :rl_hmc_no
					 FROM MP_PATIENT_MAST
					 WHERE patient_id = :nd_hosp_no;

		}
		else if (strcmp(rl_alt_id_for_pat_id.arr, "ALT_ID3_NO") == 0 ||
			strcmp(rl_alt_id_for_pat_id.arr, "ALTERNATE_ID3_NUM") == 0)
		{
			EXEC SQL SELECT alternate_id3_num
					 INTO :rl_hmc_no
					 FROM MP_PATIENT_MAST
					 WHERE patient_id = :nd_hosp_no;

		}
		else if (strcmp(rl_alt_id_for_pat_id.arr, "ALT_ID4_NO") == 0 ||
			strcmp(rl_alt_id_for_pat_id.arr, "ALTERNATE_ID4_NUM") == 0)
		{
			EXEC SQL SELECT alternate_id4_num
					 INTO :rl_hmc_no
					 FROM MP_PATIENT_MAST
					 WHERE patient_id = :nd_hosp_no;

		}


		if (NODATAFOUND);

		if (OERROR);

	}

	rl_hmc_no.arr[rl_hmc_no.len]			= '\0';

}
/*------------------------------------------------------------*/



/* *******				16.05.2004 ADDED				******* */

/*-----------------------------------------------------*/
open_result_modify_reason()
{
    EXEC SQL OPEN RL_RESULT_MODIFY_REASON_CUR;

    if (OERROR)
         ins_message(ORA_MESG,"OPEN failed on cursor RL_RESULT_MODIFY_REASON_CUR");
}
/*-----------------------------------------------------*/

fetch_result_modify_reason()
{
#ifdef DEBUG
       printf("In fetch_result_modify_reason() \n");
#endif

    rl_res_modify_reason.arr[0]		= '\0';
    rl_res_modify_reason_code.arr[0]		= '\0';
    rl_modify_reason_rel_by.arr[0]  = '\0';
    rl_modify_reason_rel_dt.arr[0]  = '\0';

	rl_modify_numeric_prefix.arr[0] = '\0';
	rl_modify_numeric_prefix.len = 0;
	rl_modify_numeric_result.arr[0] = '\0';
	rl_modify_numeric_result.len = 0;
	rl_modify_components_ind.arr[0] = '\0';
	rl_modify_components_ind.len = 0;
	rl_num_component_modified = 0;

    EXEC SQL FETCH RL_RESULT_MODIFY_REASON_CUR
              INTO rl_res_modify_reason_code,rl_res_modify_reason,
				   rl_modify_reason_rel_by,rl_modify_reason_rel_dt,
				   rl_modify_numeric_prefix,rl_modify_numeric_result,
				   rl_modify_components_ind,rl_num_component_modified;
			  
    if (OERROR)
         ins_message(ORA_MESG,"FETCH failed on cursor RL_RESULT_MODIFY_REASON_CUR",0,"");

    rl_res_modify_reason.arr[rl_res_modify_reason.len] = '\0';
    rl_res_modify_reason_code.arr[rl_res_modify_reason_code.len] = '\0';
    rl_modify_reason_rel_by.arr[rl_modify_reason_rel_by.len] = '\0';
    rl_modify_reason_rel_dt.arr[rl_modify_reason_rel_dt.len] = '\0';
	rl_modify_numeric_prefix.arr[rl_modify_numeric_prefix.len] = '\0';
	rl_modify_numeric_result.arr[rl_modify_numeric_result.len] = '\0';
	rl_modify_components_ind.arr[rl_modify_components_ind.len] = '\0';

    return (LAST_ROW?0:1);
}


/*-----------------------------------------------------*/

get_modify_reason_print_yn_for_code()
{



    nd_res_modify_reason_print_yn.arr[0] = '\0';
    nd_res_modify_reason_print_yn.len    = 0;

   EXEC SQL SELECT nvl(print_yn,'N')
			INTO :nd_res_modify_reason_print_yn
			FROM RL_REASON_CODE
			WHERE reason_code = :rl_res_modify_reason_code;

    if(OERROR)
   	    strcpy(nd_res_modify_reason_print_yn.arr,"N");;

	if (NODATAFOUND)
	    strcpy(nd_res_modify_reason_print_yn.arr,"N");

	nd_res_modify_reason_print_yn.arr[nd_res_modify_reason_print_yn.len]	= '\0';

}

/*-----------------------------------------------------*/

print_result_modify_reason()
{
 
  if (something_to_print_for_test > 0)
  {

	open_result_modify_reason();

	_flushall();
  
	test_printed = 0;	

	while(fetch_result_modify_reason())
	{
     strcpy(nd_res_modify_reason_print_yn.arr,"N");

	 if (rl_res_modify_reason_code.len)
	    get_modify_reason_print_yn_for_code();
     else
	    strcpy(nd_res_modify_reason_print_yn.arr,"Y");;

	 if((strcmp(rl_print_prev_modified_result_yn.arr,"Y") == 0 && rl_num_component_modified > 0) ||
		(rl_res_modify_reason.len && strcmp(nd_res_modify_reason_print_yn.arr,"Y")== 0))			

//07.03.2006 if (rl_res_modify_reason.len && strcmp(nd_res_modify_reason_print_yn.arr,"Y")== 0)

     {

       if(test_printed)
       {  

//07.03.2006	      sprintf(text_line,"%-17.17s%-31.31s%s",rl_modify_reason_rel_dt.arr,
//07.03.2006							rl_modify_reason_rel_by.arr,rl_res_modify_reason.arr);
		  
		  fprintf(fp,"\n");
		  page_break(1);

		  sprintf(text_line,"%-17.17s%-31.31s ",rl_modify_reason_rel_dt.arr,
														rl_modify_reason_rel_by.arr);
		  fprintf(fp,"%s",text_line);

		  if (rl_res_modify_reason.len && strcmp(nd_res_modify_reason_print_yn.arr,"Y")== 0)
		  {
			 sprintf(text_line,"%s",rl_res_modify_reason.arr);
	 		 fprintf(fp,"%s",text_line);
		  }

		  if((strcmp(rl_print_prev_modified_result_yn.arr,"Y") == 0 && rl_num_component_modified > 0) && 
					((rl_tst_cd_numeric_result_yn.arr[0] == 'Y') &&
											(rl_num_result_hide_yn.arr[0]	== 'N')
					)
			 )
		  {
		   fprintf(fp,"\n");
		   page_break(1);
//		   sprintf(text_line,"Numeric Result: %s%s",rl_modify_numeric_prefix.arr,rl_modify_numeric_result.arr);
		   sprintf(text_line,"%41s%s%-10s%-10s"," ",rl_modify_numeric_prefix.arr,rl_modify_numeric_result.arr,rl_tst_cd_test_units_desc.arr);
	 	   fprintf(fp,"%s",text_line);
		  }

///07.03.2006 fprintf(fp,"%s",text_line);
       }
       else
       {
	      
//07.03.2006  sprintf(text_line,"(%s","Reason for Modification: ");

		  fprintf(fp,"%c&k4S",ESC); 
   		  fprintf(fp,"%c(s4B",ESC);
		  fprintf(fp, "[");
		  fprintf(fp,"%c&k4S",ESC); 
   		  fprintf(fp,"%c(s-3B",ESC);   		  

		  sprintf(text_line,"%s","Above result has been modified: ");   ///07.03.2006

		  fprintf(fp,"%s",text_line);
		  fprintf(fp,"\n");
		  page_break(1); 

//07.03.2006 sprintf(text_line,"%-17.17s%-31.31s%s",rl_modify_reason_rel_dt.arr,
//07.03.2006			rl_modify_reason_rel_by.arr,rl_res_modify_reason.arr);

		  sprintf(text_line,"%-17.17s%-31.31s ",rl_modify_reason_rel_dt.arr,
														rl_modify_reason_rel_by.arr);
		  fprintf(fp,"%s",text_line);

		  if (rl_res_modify_reason.len && strcmp(nd_res_modify_reason_print_yn.arr,"Y")== 0)
		  {
			 sprintf(text_line,"%s",rl_res_modify_reason.arr);
	 		 fprintf(fp,"%s",text_line);
		  }
		 
		  if((strcmp(rl_print_prev_modified_result_yn.arr,"Y") == 0 && rl_num_component_modified > 0) && 
					((rl_tst_cd_numeric_result_yn.arr[0] == 'Y') &&
											(rl_num_result_hide_yn.arr[0]	== 'N')
					)
			 )
		  {
		   fprintf(fp,"\n");
		   page_break(1);

		   sprintf(text_line,"%41s%s%-10s%-10s"," ",rl_modify_numeric_prefix.arr,rl_modify_numeric_result.arr,rl_tst_cd_test_units_desc.arr);
	 	   fprintf(fp,"%s",text_line);
		  }

//07.03.2006  fprintf(fp,"%s",text_line);
	      test_printed = 1;
       }

     }
   }
   if (test_printed) 
   {
	   fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s4B",ESC);
	   fprintf(fp, "]");
	   fprintf(fp,"%c&k4S",ESC); 
   	   fprintf(fp,"%c(s-3B",ESC);   		  

	   fprintf(fp,"\n");
	   if (strcmp(l_customer_id.arr, "MC") != 0)
	   {
	   //page_break(1);//commented out for GHL-SCF-1130.1
	   					page_break(1);
		}
   }

   	close_result_modify_reason_cur(); 

   _flushall();
 }

}


/*-----------------------------------------------------*/

close_result_modify_reason_cur()
{
	EXEC SQL CLOSE RL_RESULT_MODIFY_REASON_CUR;

	if (OERROR)
		ins_message(ORA_MESG,"CLOSE failed on cursor RL_RESULT_MODIFY_REASON_CUR");

}

/*-----------------------------------------------------*/

check_for_print_destn_type()
{

 if (((rl_hdr_episode_type.arr[0] == 'I') &&  (strcmp(rl_rep_inpatient_yn.arr, "Y") == 0 )) ||
    ((rl_hdr_episode_type.arr[0] == 'O') &&  (strcmp(rl_rep_outpatient_yn.arr, "Y") == 0 )) ||
    ((rl_hdr_episode_type.arr[0] == 'H') &&  (strcmp(rl_rep_referral_yn.arr, "Y") == 0 ))   ||
	((rl_hdr_episode_type.arr[0] == 'I') && (strcmp(l_rep_disch_pat_result.arr, "Y") == 0)) ||
    ((rl_hdr_episode_type.arr[0] == 'R') &&  (strcmp(rl_rep_external_yn.arr, "Y") == 0 )))   
	{
		l_destn_rep_yn = 'Y';
	}
 else
    l_destn_rep_yn = 'N'; 
   
 if (((rl_hdr_episode_type.arr[0] == 'I') &&  (strcmp(rl_fax_inpatient_yn.arr, "Y") == 0 )) ||
    ((rl_hdr_episode_type.arr[0] == 'O') &&  (strcmp(rl_fax_outpatient_yn.arr, "Y") == 0 )) ||
	((rl_hdr_episode_type.arr[0] == 'H') &&  (strcmp(rl_fax_referral_yn.arr, "Y") == 0 ))   ||
    ((rl_hdr_episode_type.arr[0] == 'I') && (strcmp(l_fax_disch_pat_result.arr, "Y") == 0)) ||	 
	((rl_hdr_episode_type.arr[0] == 'R') &&  (strcmp(rl_fax_external_yn.arr, "Y") == 0 )) )
	{
		l_destn_fax_yn = 'Y';
	}
 else
    l_destn_fax_yn = 'N';  


 if (((rl_hdr_episode_type.arr[0] == 'I') &&  (strcmp(rl_mail_inpatient_yn.arr, "Y") == 0 )) ||
    ((rl_hdr_episode_type.arr[0] == 'O') &&  (strcmp(rl_mail_outpatient_yn.arr, "Y") == 0 )) ||
	((rl_hdr_episode_type.arr[0] == 'H') &&  (strcmp(rl_mail_referral_yn.arr, "Y") == 0 ))   ||
    ((rl_hdr_episode_type.arr[0] == 'I') && (strcmp(l_mail_disch_pat_result.arr, "Y") == 0)) ||	 
	((rl_hdr_episode_type.arr[0] == 'R') &&  (strcmp(rl_mail_external_yn.arr, "Y") == 0 )) )
	{
		l_destn_mail_yn = 'Y';
	}
 else
    l_destn_mail_yn = 'N';  


///////////// added the below on 20.03.2005 

  if (p_param8.arr[0] == 'P' || (strcmp(p_param7.arr, "L") == 0) 
								|| (strcmp(p_param7.arr, "X") == 0))
  {
	l_destn_rep_yn = 'Y';
	if (strcmp(p_param9.arr,"REPRINT") == 0) 
	{
	  if(strcmp(p_param10.arr, "Y") == 0 ) 
		l_destn_rep_yn = 'Y';
	  else
		l_destn_rep_yn = 'N';
	}
    
	l_destn_fax_yn = 'N';

	if (strcmp(p_param9.arr,"REPRINT") == 0) 
	{
	  if (strcmp(p_param11.arr, "Y") == 0 ) 	
		l_destn_fax_yn = 'Y';
	  else	
		l_destn_fax_yn = 'N';  
	}

	l_destn_mail_yn = 'N';
	if (strcmp(p_param9.arr,"REPRINT") == 0) 
	{
	  if (strcmp(p_param12.arr, "Y") == 0 ) 	
		l_destn_mail_yn = 'Y';
	  else	
		l_destn_mail_yn = 'N';  
	}

  }
///////////////// upto here added on 20.03.2005
   

}


/*-----------------------------------------------------*/
gen_file_name_fax()
{



	nd_get_fax_dir.arr[0]		= '\0';
	nd_get_fax_dir.len			= 0;
    strcpy(nd_get_fax_dir.arr,"Y");
	nd_get_fax_dir.len = strlen(nd_get_fax_dir.arr);



	get_sm_installation();



	if (strcmp(BVNewVersionYN.arr,"Y") == 0)
	{



	 EXEC SQL EXECUTE 
		  begin
			declare
				v_file_name VARCHAR2(2500);
				v_err_txt   VARCHAR2(2500);
			begin
			   :nd_get_fax_dir := 'N';

//insert into rl_error values('RLRRSENQ',:sy_ws_no,'gen_file_name_fax()..specno='||:rl_prn_ctrl_hdr_sp_no);

				workstation.get_ws_param(:sy_ws_no,           
								 'FAX_MAIL_FILE_LOCN',
								  v_file_name,  
								  v_err_txt     
										 );
//insert into rl_error values('RLRRSENQ',SUBSTR(v_file_name,1,50),'gen_file_name_fax()..specno='||:rl_prn_ctrl_hdr_sp_no||',errortext='||substr(v_err_txt,1,20));

				if v_err_txt is null then
					if v_file_name is not null then
						:nd_file_name_fax := v_file_name;
					end if;
				else
					:nd_file_name_fax := null;   
				end if;			    
			end;
			
		end;  
	 END-EXEC;
	}
	 nd_get_fax_dir.arr[nd_get_fax_dir.len]	= '\0';



	 if (strcmp(nd_get_fax_dir.arr,"Y") == 0)     /// 29.07.2004
	 {



      ///    GetPrivateProfileStringA("Reports","Fax_Dir","",nd_file_name_fax.arr,sizeof(nd_file_name_fax.arr),"medicom.ini");

				wordir=(char*) malloc(200* sizeof(char));

				fax_i=GetPrivateProfileString("Reports","Fax_Dir","",wordir,200,"medicom.ini");

				wordir[fax_i]='\0';

				strcpy(nd_file_name_fax.arr,wordir);
				nd_file_name_fax.len = strlen(nd_file_name_fax.arr);

	  }

     if (OERROR)
         ins_message(ORA_MESG,"Fetch failed on while getting file number2");
      

     nd_file_name_fax.arr[nd_file_name_fax.len] = '\0';
/*
     p_rep_file_fax.arr[0]   = '\0';   
     p_rep_file_fax.len      = 0;

     p_rep_file_fax_ext.arr[0]   = '\0';   
     p_rep_file_fax_ext.len      = 0;

     sprintf(p_rep_file_fax.arr,"%srslt_%s.lis", nd_file_name_fax.arr,nd_file_no.arr);


	 sprintf(p_rep_file_fax_ext.arr,"%srslt_%s.ext",nd_file_name_fax.arr,nd_file_no.arr);

*/

}
/*-----------------------------------------------------*/

/*** only for qatar ***/
get_nationality_desc()
{
	nd_nationality_desc.arr[0]		= '\0';
	nd_nationality_desc.len			= 0;

 /*
   EXEC SQL SELECT nationality
			INTO :nd_nationality_desc
			FROM MP_COUNTRY_HIS_VW
			WHERE country_code = :rl_pat_nationality;*/
   EXEC SQL SELECT short_name
			INTO :nd_nationality_desc
			FROM MP_COUNTRY_LANG_VW
			WHERE country_code = :rl_pat_nationality
			AND   language_id =:language_id ;
      if(OERROR);

	if (NODATAFOUND);

	nd_nationality_desc.arr[nd_nationality_desc.len]	= '\0';

}
/*------------------------------------------------------------*/

get_snomed_marker_desc1()
{
	nd_snomed_mrkr_desc1.arr[0]		= '\0';
	nd_snomed_mrkr_desc1.len		= 0;

    nd_snomed_mrkr1_print_yn.arr[0] = '\0';
    nd_snomed_mrkr1_print_yn.len    = 0;

   EXEC SQL SELECT long_desc,print_yn
			INTO :nd_snomed_mrkr_desc1,:nd_snomed_mrkr1_print_yn
			FROM RL_SNOMED_MARKER_lang_vw
			WHERE snomed_marker_code = :rl_res_snomed_mrkr_code1
			and language_id = :language_id;

      if(OERROR);

	if (NODATAFOUND);

	nd_snomed_mrkr_desc1.arr[nd_snomed_mrkr_desc1.len]	= '\0';
	nd_snomed_mrkr1_print_yn.arr[nd_snomed_mrkr1_print_yn.len]	= '\0';

}
/*------------------------------------------------------------*/

get_snomed_marker_desc2()
{
	nd_snomed_mrkr_desc2.arr[0]		= '\0';
	nd_snomed_mrkr_desc2.len		= 0;

    nd_snomed_mrkr2_print_yn.arr[0] = '\0';
    nd_snomed_mrkr2_print_yn.len    = 0;

   EXEC SQL SELECT long_desc,print_yn
			INTO :nd_snomed_mrkr_desc2,:nd_snomed_mrkr2_print_yn
			FROM RL_SNOMED_MARKER_lang_vw
			WHERE snomed_marker_code = :rl_res_snomed_mrkr_code2
			and language_id = :language_id;

      if(OERROR);

	if (NODATAFOUND);

	nd_snomed_mrkr_desc2.arr[nd_snomed_mrkr_desc2.len]	= '\0';
	nd_snomed_mrkr2_print_yn.arr[nd_snomed_mrkr2_print_yn.len]	= '\0';

}
/*------------------------------------------------------------*/

print_snomed_marker1()
{
	if (strcmp(nd_snomed_mrkr1_print_yn.arr,"Y") == 0 && nd_snomed_mrkr_desc1.len != 0)
	{
         something_to_print = 1;
		 something_to_print_for_test = 1;

/********** no heading, no margin is needed
         if (l_snomed_head_printed == 0)
		 {
	 		fprintf(fp, "SNOMED : \n");
			l_snomed_head_printed = 1;
		    page_break(1);
		 }
         else
	 		fprintf(fp, "         ");
**********/

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 fprintf(fp,"%s\n",nd_snomed_mrkr_desc1.arr);
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

	     page_break(1);
	} 

}

/*------------------------------------------------------------*/

print_snomed_marker2()
{

	if (strcmp(nd_snomed_mrkr2_print_yn.arr,"Y") == 0 && nd_snomed_mrkr_desc2.len != 0)
	{
         something_to_print = 1;
		 something_to_print_for_test = 1;

/****** no heading, no margin is needed
         if (l_snomed_head_printed == 0)
		 {
	 		fprintf(fp, "SNOMED : \n");
			l_snomed_head_printed = 1;
		    page_break(1);
		 }
         else
	 		fprintf(fp, "         ");
**************/ 

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 fprintf(fp,"%s\n",nd_snomed_mrkr_desc2.arr);
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		if (strcmp(l_customer_id.arr, "MC") != 0)
		{
	     //page_break(1);//commented out for GHL-SCF-1130.1
		 page_break(1);
		 }
	}

}

/*------------------------------------------------------------*/

/**************** added on 29.07.2004 *****************************************/

	/*** Code added to check and Print the Past results based on setup ***/

print_past_results()
{
	if (strcmp(rl_print_prv_result_yn.arr, "Y") == 0 )
	{
		EXEC SQL SELECT NVL(PERIOD_FOR_PAST_RESULTS,0),NVL(NO_OF_PAST_RESULTS,0),
		                PAST_RESULT_UNITS
				 INTO :d_past_result_period, :d_past_result_no, :d_past_result_unit
				 FROM RL_TEST_PAST_RESULT
				 WHERE test_code = :rl_tst_test_code
				 AND   result_type_ind = 'REP';
		if (d_past_result_period)
		{
			if (strcmp(d_past_result_unit.arr, "YRS") == 0) 
			{
				EXEC SQL SELECT TO_CHAR(ADD_MONTHS(TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), -12*:d_past_result_period),
					                    'DD/MM/YYYY HH24:MI')
						 INTO :nd_prv_result_dt
						FROM DUAL;
			}
			if (strcmp(d_past_result_unit.arr, "MTHS") == 0)
			{
				EXEC SQL SELECT TO_CHAR(ADD_MONTHS(TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), -1*:d_past_result_period),
										'DD/MM/YYYY HH24:MI')
						 INTO :nd_prv_result_dt
						 FROM DUAL;
			}
			if (strcmp(d_past_result_unit.arr, "WKS") == 0)
			{
				EXEC SQL SELECT TO_CHAR(TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI') - 7*:d_past_result_period, 'DD/MM/YYYY HH24:MI')
						 INTO :nd_prv_result_dt
						 FROM DUAL;
			}
			if (strcmp(d_past_result_unit.arr, "DAY") == 0)
			{
				EXEC SQL SELECT TO_CHAR(TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI') - 1*:d_past_result_period, 'DD/MM/YYYY HH24:MI')
						 INTO :nd_prv_result_dt
						 FROM DUAL;
			}
			if (strcmp(d_past_result_unit.arr, "HRS") == 0)
			{
				EXEC SQL SELECT TO_CHAR(TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI') - (1/24)*:d_past_result_period, 'DD/MM/YYYY HH24:MI')
						 INTO :nd_prv_result_dt
						 FROM DUAL;
			}



			dclr_test_result_prv_cur();

	        p_count = 0;
			past_results_head_printed = 0;
			while(fetch_test_result_prv_cur())
			{
				if (d_num_result_hide_yn.arr[0] == 'N')
					ge_prev_result_line(); 

				p_count++;

				if (p_count == d_past_result_no)
				{
					break;
				}
				

			}


		}
	}
}

/*-------------------------------------------------------------------------------*/

/*** Cursor declared to get the previous results of the Test Code  from the RL_TEST_RESULT ***/

dclr_test_result_prv_cur() 
{

    EXEC SQL DECLARE test_result_prv_cur CURSOR FOR
         SELECT TO_CHAR(A.specimen_no), A.test_code, A.numeric_result, NVL(A.numeric_prefix,'+'), 
				A.status, A.test_units, A.age_range_low, A.age_range_high, A.high_low_ind,
				TO_CHAR(B.spec_regd_date_time,'DD/MM/YYYY HH24:MI'),B.operating_facility_id,
				NVL(A.numeric_result_hide_yn, 'N') numeric_result_hide_yn
           FROM RL_TEST_RESULT A, RL_REQUEST_HEADER B
           WHERE B.patient_id = :nd_hosp_no
		   AND B.patient_id = A.patient_id
		   AND B.specimen_no = A.specimen_no
		   AND B.operating_facility_id = A.operating_facility_id
		   AND A.test_code = :rl_tst_test_code
		   AND A.specimen_no != TO_NUMBER(:nd_spec_no)
           AND B.spec_regd_date_time BETWEEN
		       TO_DATE(:nd_prv_result_dt,'DD/MM/YYYY HH24:MI') AND
		       TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI')
           AND NVL(A.cancelled_yn, 'N') <> 'Y'
		   AND NVL(A.status,'O') IN ('R','P')
		   ORDER BY B.spec_regd_date_time desc;

//AND NVL(B.spec_regd_date_time,TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI')) >= 
//		       TO_DATE(:nd_prv_result_dt,'DD/MM/YYYY HH24:MI')
//           AND NVL(B.spec_regd_date_time,TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI')) <= 
//		       TO_DATE(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI')
//		   ORDER BY A.reviewed_date desc;


	EXEC SQL OPEN test_result_prv_cur;

}

/*-----------------------------------------------------------------------------------------*/

/*** Added to fetch the Previous results for the Test ***/

fetch_test_result_prv_cur()
{
  d_prv_specimen_no.arr[0]          = '\0';
  d_prv_specimen_no.len				= 0;

  d_tst_prv_test_code.arr[0]		= '\0';
  d_tst_prv_test_code.len			= 0;
  
  d_tst_prv_numeric_result.arr[0]	= '\0';
  d_tst_prv_numeric_result.len		= 0;

  d_num_prv_prefix.arr[0]			= '\0';
  d_num_prv_prefix.len				= 0;

  d_status_prv.arr[0]				= '\0';
  d_status_prv.len					= 0;

  d_tst_prv_units.arr[0]			= '\0';
  d_tst_prv_units.len				= 0;

  d_tst_prv_age_range_low.arr[0]	= '\0';
  d_tst_prv_age_range_low.len		= 0;

  d_tst_prv_age_range_high.arr[0]	= '\0';
  d_tst_prv_age_range_high.len		= 0;

  d_tst_prv_high_low_ind.arr[0]		= '\0';
  d_tst_prv_high_low_ind.len		= 0;

  d_prv_spec_regd_date_time.arr[0]	= '\0';
  d_prv_spec_regd_date_time.len		= 0;

  d_prv_spec_facility_id.arr[0]		= '\0';
  d_prv_spec_facility_id.len		= 0;

  d_num_result_hide_yn.arr[0]		= '\0';
  d_num_result_hide_yn.len			= 0;

  EXEC SQL FETCH test_result_prv_cur
		   INTO :d_prv_specimen_no,	
				:d_tst_prv_test_code,
				:d_tst_prv_numeric_result,
				:d_num_prv_prefix,
				:d_status_prv,
				:d_tst_prv_units,
				:d_tst_prv_age_range_low,
				:d_tst_prv_age_range_high,
				:d_tst_prv_high_low_ind,
				:d_prv_spec_regd_date_time,
				:d_prv_spec_facility_id,
				:d_num_result_hide_yn;


  d_prv_specimen_no.arr[d_prv_specimen_no.len]					= '\0';
  d_tst_prv_numeric_result.arr[d_tst_prv_numeric_result.len]	= '\0';
  d_tst_prv_test_code.arr[d_tst_prv_test_code.len]				= '\0';
  d_num_prv_prefix.arr[d_num_prv_prefix.len]					= '\0';
  d_status_prv.arr[d_status_prv.len]							= '\0';
  d_tst_prv_units.arr[d_tst_prv_units.len]						= '\0';
  d_tst_prv_age_range_low.arr[d_tst_prv_age_range_low.len]		= '\0';
  d_tst_prv_age_range_high.arr[d_tst_prv_age_range_high.len]	= '\0';
  d_tst_prv_high_low_ind.arr[d_tst_prv_high_low_ind.len]		= '\0';
  d_prv_spec_regd_date_time.arr[d_prv_spec_regd_date_time.len]	= '\0';
  d_prv_spec_facility_id.arr[d_prv_spec_facility_id.len]		= '\0';
  d_num_result_hide_yn.arr[d_num_result_hide_yn.len]			= '\0';

   return (LAST_ROW?0:1);   

}
/*-----------------------------------------------------------------*/
put_zero_before_decimal_past_result()
{

	if (d_tst_prv_numeric_result.arr[0] != '0')
	{
		strcpy(l_numeric_result, "0");
		strcat(l_numeric_result, d_tst_prv_numeric_result.arr);

		strcpy(d_tst_prv_numeric_result.arr, l_numeric_result);
		d_tst_prv_numeric_result.len = strlen(d_tst_prv_numeric_result.arr);
	}
	

}

/*--------------------------------------------------------------------------------------*/
ge_prev_result_line()
{
char l_str [100];

	if(past_results_head_printed==0)
	{
//		fprintf(fp,"    ");
		fprintf(fp,"[Previous Results]\n");
		past_results_head_printed = 1;
		page_break(1);
	}

    strcpy(l_str,"");
	sprintf(l_str,"%-15.15s  %s   %s   ",d_prv_specimen_no.arr,d_prv_spec_regd_date_time.arr,
																	d_prv_spec_facility_id.arr);

	something_to_print = 1;
	something_to_print_for_test = 1;
	if (d_tst_prv_numeric_result.len)
	{

	  if ( (atof(d_tst_prv_numeric_result.arr) < 1) && 
												(atof(d_tst_prv_numeric_result.arr) > 0) )
			 put_zero_before_decimal_past_result();

	  numeric_value_flag = TRUE;

	  strcpy(r_rslt.arr, d_tst_prv_numeric_result.arr);
	  r_rslt.len = strlen(r_rslt.arr);
	  add_zero_after_result();
	  strcpy(d_tst_prv_numeric_result.arr, r_rslt.arr);
	  d_tst_prv_numeric_result.len = strlen(d_tst_prv_numeric_result.arr);

	  if(d_num_prv_prefix.arr[0] == '+')
	  {
		 sprintf(l_str,"%s%-10s",l_str,d_tst_prv_numeric_result.arr);  
      }
	  else
	  {
         sprintf(l_str,"%s%c%-10s",l_str,d_num_prv_prefix.arr[0],
													     d_tst_prv_numeric_result.arr);
      }

      sprintf(l_str,"%s%-10s",l_str,d_tst_prv_units.arr);

	  if ( d_tst_prv_age_range_low.len  || d_tst_prv_age_range_high.len )
      {

		  get_zero_prefix_for_range();

		  strcpy(r_rslt.arr, d_tst_prv_age_range_low.arr);
		  r_rslt.len = strlen(r_rslt.arr);
 		  add_zero_after_result();
		  strcpy(d_tst_prv_age_range_low.arr, r_rslt.arr);
		  d_tst_prv_age_range_low.len = strlen(d_tst_prv_age_range_low.arr);

		  strcpy(r_rslt.arr, d_tst_prv_age_range_high.arr);
		  r_rslt.len = strlen(r_rslt.arr);
 		  add_zero_after_result();
		  strcpy(d_tst_prv_age_range_high.arr, r_rslt.arr);
		  d_tst_prv_age_range_high.len = strlen(d_tst_prv_age_range_high.arr);
		

			  sprintf(l_str,"%s %-1s (%s - %s)",l_str,
													  d_tst_prv_high_low_ind.arr,
													  d_tst_prv_age_range_low.arr,
													  d_tst_prv_age_range_high.arr);
      }
 
	}   /*Endif of rl_tst_numeric_result.len */

	//bold_print_check = 1;   

	print_line(l_str);

	//bold_print_check = 0;   


}

/************************** added on 02.09.2004 ************************************/
get_dest_type_n_locn()
{

   if ((rl_hdr_episode_type.arr[0] == 'R') || (rl_hdr_episode_type.arr[0] == 'H'))  
	   strcpy(p_fax_loc_code.arr,rl_hdr_source_code.arr);
   else
	   strcpy(p_fax_loc_code.arr,rl_prn_ctrl_hdr_source_code.arr);

   p_fax_loc_code.len = strlen(p_fax_loc_code.arr);

   if ((rl_hdr_episode_type.arr[0] == 'I'))  
      strcpy(p_fax_loc_type.arr, "W");  

   if ((rl_hdr_episode_type.arr[0] == 'O'))  
      strcpy(p_fax_loc_type.arr, "C");  

   if ((rl_hdr_episode_type.arr[0] == 'R') || (rl_hdr_episode_type.arr[0] == 'H'))  
      strcpy(p_fax_loc_type.arr, "R");  
	  	
   p_fax_loc_type.len = strlen(p_fax_loc_type.arr);

   strcpy(p_mail_loc_code.arr, p_fax_loc_code.arr); // 07.08.2005
   strcpy(p_mail_loc_type.arr,p_fax_loc_type.arr); //

   p_mail_loc_code.len = strlen(p_mail_loc_code.arr); // 07.08.2005
   p_mail_loc_type.len = strlen(p_mail_loc_type.arr); //

   l_episode = 0;


   if (( (rl_hdr_episode_type.arr[0] == 'I') ||
		(rl_hdr_episode_type.arr[0] == 'O') ) && 
		(strcmp(nd_operating_facility_id.arr, rl_ordered_facility_id.arr) == 0) ) 
		
   {

		EXEC SQL SELECT open_episode_id
		INTO :l_episode
		FROM IP_OPEN_EPISODE
		WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
		AND   patient_id = :nd_hosp_no;

		if(NODATAFOUND)
		{

             if (rl_hdr_episode_type.arr[0] == 'I')
			 {
				if (strcmp(l_fax_disch_pat_result.arr, "Y") == 0)
				{
					strcpy(p_fax_loc_type.arr, "W");
					p_fax_loc_type.len = strlen(p_fax_loc_type.arr);
					strcpy(p_fax_loc_code.arr, rl_hdr_source_code.arr);
					p_fax_loc_code.len = strlen(rl_hdr_source_code.arr);

				}
				if (strcmp(l_mail_disch_pat_result.arr, "Y") == 0) // 07.08.2005
				{
					strcpy(p_mail_loc_type.arr, "W");
					p_mail_loc_type.len = strlen(p_mail_loc_type.arr);
					strcpy(p_mail_loc_code.arr, rl_hdr_source_code.arr);
					p_mail_loc_code.len = strlen(rl_hdr_source_code.arr);

				}
			 }
			 else
			 {
				strcpy(p_fax_loc_type.arr, "C");
				p_fax_loc_type.len = strlen(p_fax_loc_type.arr);

				strcpy(p_mail_loc_type.arr, "C");  /// 07.08.2005
				p_mail_loc_type.len = strlen(p_mail_loc_type.arr);  //
			 }

		}
		else
		{

			EXEC SQL SELECT  'W'
			INTO :p_fax_loc_type
			FROM IP_EPISODE
			WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND episode_id = :l_episode
			AND patient_id = :nd_hosp_no;


			if(NODATAFOUND)
			{
			  strcpy(p_fax_loc_type.arr, "C");
			  p_fax_loc_type.len = strlen(p_fax_loc_type.arr);
			}

		   strcpy(p_mail_loc_type.arr,p_fax_loc_type.arr); // 07.08.2005


		}
		
   }

	  p_fax_loc_type.len = strlen(p_fax_loc_type.arr);
	  p_mail_loc_type.len = strlen(p_mail_loc_type.arr); // 07.08.2005

}


/***************** upto here added 02.09.2004 ***************************************/

/**************************************************************/
get_sm_installation()
{
 
	BVNewVersionYN.arr[0] = '\0';
	BVNewVersionYN.len = 0;
	strcpy(BVNewVersionYN.arr,"N");

	EXEC SQL EXECUTE 
	BEGIN 
		IF sm_installation_tab_check THEN
			:BVNewVersionYN := 'Y';
		ELSE
			:BVNewVersionYN := 'N';
		END IF;
	END ;
	END-EXEC ;
	BVNewVersionYN.len = strlen(BVNewVersionYN.arr);

			
}
/*--------------added on 13.02.2005-------------------------------------------*/
print_header4()
{

    char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
	char l_age_legend[5];

/**------------***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ----------------------******/
// if condition is added for this enhancement

    if (strcmp(l_customer_id.arr, "AMRI") == 0) 
    {
		print_header_amri();
    }
    else
    {
		pctr++;
       get_parameters();
		lctr = 0;



/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/
	get_sm_installation();
	if (strcmp(BVNewVersionYN.arr,"N") == 0
					|| strcmp(rl_report_format.arr, "6") == 0    /// added on 09.07.2007 against ARTEMIS request
	   )
	{
	 fprintf(fp,"\n\n");
	 lctr+=2;
	}    
	else
	{
			fprintf(fp,"\n");
			lctr+=1;
	}

/*---------*/
/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 

/*-------- upto here on 21.10.2004 -----*/

    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/

	if (strcmp(l_customer_id.arr, "KDAH") == 0) 
	{
		fprintf(fp,"\n\n\n\n\n");
		lctr+=5;
	}


    if (rl_lab_title.len) 
	{
       fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);
	   lctr+=2;
	}
    if (rl_lab_title_2.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_2.len)/2) - 6)," ",rl_lab_title_2.arr);
	   lctr+=2;
	}
    if (rl_lab_title_3.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_3.len)/2) - 6)," ",rl_lab_title_3.arr);
	   lctr+=2;
	}
    if (rl_lab_title_4.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_4.len)/2) - 6)," ",rl_lab_title_4.arr);
	   lctr+=2;
	}
    if (rl_lab_title_5.len)  
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_5.len)/2) - 6)," ",rl_lab_title_5.arr);
	   lctr+=2;
	}

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

    rl_lab_title_6.arr[0] = '\0';
    rl_lab_title_6.len = 0;
	/// 12.02.2006 if (strcmp(rl_hmc_yn.arr,"Y") == 0)  // because HMC doesnt want hardcoded legend 
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)  // 12.02.2006 becaz ML,HMC doesnt want hardcoded legend
	{
		strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	}
	else
	{
		strcpy(rl_lab_title_6.arr, "Department of ");
		strcat(rl_lab_title_6.arr, rl_section_short_name.arr);
	}

	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);
    if (rl_lab_title_6.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);
	   lctr+=2;
	}


/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;    
		//fprintf(fp, "Draft Copy\n"); 
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}

	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);
	}
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
/*----------------------------------------*/

	

	/*** NEWLY ADDED ON 28/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO 
			BEFORE the detail portion of heading******/
	if(rl_hdr_episode_type.arr[0] != 'R')
		print_hmc_no();


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

   for(i=0;i<87;i++)
        fprintf(fp,"_");

	fprintf(fp, "\n");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;
	
	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp,"%-13.13s: ", local_legend[6]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s                ", rl_pat_short_name.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-3.3s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s ", l_age_legend);

	patient_age();

	fprintf(fp, "%s\n", t_age.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient  ID  : ");
    fprintf(fp,"%-13.13s: ", local_legend[26]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	   fetch_mp_ext_per_nric();  ///// 03.07.2005 

       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-15.15s                          ", t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	   //fprintf(fp, "Sex/Race: ");
	   fprintf(fp, "%-8.8s: ",local_legend[42] );//added for globalisation
    else
       //fprintf(fp, "     Sex: ");
	   fprintf(fp, "%8.8s: ",local_legend[7] );//added for globalisation

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
			//strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			//strcpy(sex_desc,"Unknown");
			strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp,"%s", sex_desc);

    if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	{
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		get_race_desc();
		fprintf(fp, "%-15.15s", d_race_desc.arr);
	}

    fprintf(fp, "\n");
	page_break(1);

/********** added on 13.02.2005 *************/

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "NRIC/Alt.IdNo: ");
    fprintf(fp,"%-13.13s: ", local_legend[55]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if (rl_national_id_num.len)
	   //fprintf(fp, "%s", rl_national_id_num.arr);  against scf ML-SD-SCF-1749
         fprintf(fp, "%-30.30s", rl_national_id_num.arr); 
	else
       fprintf(fp, "%-30.30s", rl_alternate_id_num.arr);

//11.04.2005    fprintf(fp, "\n");
//11.04.2005	page_break(1);

/************* upto here added on 13.02.2005 ******/

/////////////////  11.04.2005
    get_nationality_desc();	
	fprintf(fp,"%-8.8s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
	page_break(1);
/////////////////


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
    fprintf(fp,"%-13.13s: ", local_legend[8]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s", rl_source_short_name.arr);

	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	    fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		fprintf(fp, "%-20.20s\n", rl_location.arr);
		page_break(1);
	}
	else
	{
		fprintf(fp, "\n");
		page_break(1);
	}


	/*** NEWLY ADDED ON 26/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO ******/
//	if(rl_hdr_episode_type.arr[0] != 'R')
//		print_hmc_no();


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);

/************** 11.04.2005
/////////////////  12.07.2004
	fprintf(fp,"%-8.8s"," ");
    get_nationality_desc();	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
/////////////////
**************************/

//////// 11.04.2005

	fprintf(fp,"%-9.9s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Ordered   : ");
	fprintf(fp,"%-10.10s: ", local_legend[56]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_order_id.len)
	{
	  fprintf(fp, "%-16.16s\n", nd_order_date_time1.arr);//added for globalisation
    }
	else
	  fprintf(fp, "\n");

//////////// 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[16]); //added for globalisation
// 12.07.2004	fprintf(fp,"%c&k4S",ESC); 
// 12.07.2004  	fprintf(fp,"%c(s-3B",ESC);   

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		//strcpy(l_str, actual_specimen.arr); //added by madhu for IN063676
		if (strlen(nd_spec_no.arr) > 0)
		{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "  ");
		}
		else
		strcpy(l_str, actual_specimen.arr);
		strcat(l_str, "  ");
	}

	fprintf(fp, "%-19.19s                    ", l_str);

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

/*******11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
************/

//// added the below on  11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
////////  upto here added on 11.04.2005

	page_break(1);
	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
      fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Recd  Date: ");
	//fprintf(fp, "Received  : ");
    fprintf(fp,"%-10.10s: ", local_legend[59]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Category No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[48]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-4.4s/%-4.4s/%-15.15s              ", rl_category_code.arr, rl_category_year.arr,
								rl_category_number.arr);

/************** 11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
***********************/

//////// added the below on 11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr); //added for globalisation

//////////// upto here added on 11.04.2005

	page_break(1);


/// 31.10.2006 added the below 

		if (strcmp(rl_use_sample_anatomy_ind.arr, "SA") == 0 ||
				strcmp(rl_use_sample_anatomy_ind.arr, "AT") == 0)
		{
	  	 get_anatomy_site();
		 get_anatomy_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Anatomy Site : ");
	     fprintf(fp,"%-13.13s: ", local_legend[60]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_anatomy_site_desc.arr);
  		 page_break(1);
		}

///



    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Clinical     : ");
    fprintf(fp,"%-13.13s: ", local_legend[50]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	   
	if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s4B",ESC);
	 //fprintf(fp, "Comment        ");
     fprintf(fp,"%-15.15s ", local_legend[51]); //added for globalisation
	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s-3B",ESC);

	if (rl_hdr_request_comment_desc2.len)
    {

      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    
	if (rl_hdr_request_comment_desc3.len)
    {
	  fprintf(fp, "               ");
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }

/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///

/// 31.10.2006 added the below 
/*********commented on 31.10.2006
		if (rl_perform_site_code.len)
		{
		 get_perform_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 fprintf(fp, "Performing Location: ");
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_perform_site_desc.arr);
  		 page_break(1);
		}
**************/
///


	if (strcmp(rl_test_requested_yn.arr, "Y") == 0)
	{

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordered Tests: ");
		 fprintf(fp,"%-13.13s: ", local_legend[53]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		strcpy(l_str, "");

		for (i=0;i < no_of_dtl_recs;i++)
		{
			d_inhibit_yn.arr[0]		= '\0';
			d_inhibit_yn.len		= 0;

			strcpy(inhibit_test_code.arr, rl_dtl_test_code[i].arr);
			inhibit_test_code.len = strlen(inhibit_test_code.arr);

			chk_inhibit_yn();

			if (d_inhibit_yn.arr[0]	== 'N') 
			{
				if (i == 0)
					sprintf(l_str,"%s", rl_dtl_test_code[i].arr);
				else
					sprintf(l_str,"%s,%s",l_str, rl_dtl_test_code[i].arr);
			}

//11.04.2005   if (i > 15) 

			if (i > 5) 
				break;
		}

		if(no_of_dtl_recs > 7)
		  sprintf(l_str,"%s...",l_str);

		fprintf(fp,"%s\n",l_str);
		page_break(1);
	}


	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		if (strlen(rl_message_line.arr) > 0)
		{
			fprintf(fp, "%70.70s ", rl_message_line.arr);
			fprintf(fp, "%-15.15s\n", nd_hosp_no.arr);
			page_break(1);

		}
	}

    fprintf(fp,"%c&k4S",ESC);  
    fprintf(fp,"%c(s4B",ESC);
    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);

	page_break(1);
	fprintf(fp, "\n"); 
    
	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {

	 print_result_titles(); /// created this procedure to maintain the below common code

/***********************************************************************************
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
//		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
		fprintf(fp, "%s", rl_title_for_test.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		fprintf(fp, "%s", " ");
		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
//		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
		fprintf(fp, "%s", rl_title_for_num_result.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		fprintf(fp, "%s", " ");
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if (strcmp(l_customer_id.arr, "KDAH") == 0)  ///added this condition against KDAH-CRF-0174 on 12/03/2012
     {
		 if(rl_title_for_range_ind.len)
		 {
			fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
			fprintf(fp, "%s", rl_title_for_range_ind.arr);
			fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
			for(i=0;i<(5-rl_title_for_range_ind.len);i++)
			   fprintf(fp, "%s", " ");
		 }
		 else
			fprintf(fp, "%-4.4s", " ");
	 }
	 

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
//		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
		fprintf(fp, "%s", rl_title_for_test_units.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		fprintf(fp, "%s", " ");
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if (strcmp(l_customer_id.arr, "KDAH") != 0)  ///added this condition against KDAH-CRF-0174 on 12/03/2012
     {
		 if(rl_title_for_range_ind.len)
		 {
			fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
			fprintf(fp, "%s", rl_title_for_range_ind.arr);
			fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
			for(i=0;i<(5-rl_title_for_range_ind.len);i++)
			   fprintf(fp, "%s", " ");
		 }
		 else
			fprintf(fp, "%-4.4s", " ");
	 }
	 
     if(rl_title_for_result_range.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
///		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
		fprintf(fp, "%s", rl_title_for_result_range.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(14-rl_title_for_result_range.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-15.15s", " ");


	page_break(1);
	fprintf(fp, "\n");

*************************************************************************************/

	}

    }
}
/*-----------------------------*/
print_header7()
{

    char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
	char l_age_legend[5];

    pctr++;
    
    get_parameters();
	lctr = 0;



/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/
	get_sm_installation();
	if (strcmp(BVNewVersionYN.arr,"N") == 0
					|| strcmp(rl_report_format.arr, "6") == 0    /// added on 09.07.2007 against ARTEMIS request
	   )
	{
	 fprintf(fp,"\n\n");
	 lctr+=2;
	}    
	else
	{
		fprintf(fp,"\n");
		lctr+=1;
	}

/*---------*/
/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 

/*-------- upto here on 21.10.2004 -----*/

    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/
    if (rl_lab_title.len) 
	{
       fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);
	   lctr+=2;
	}
    if (rl_lab_title_2.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_2.len)/2) - 6)," ",rl_lab_title_2.arr);
	   lctr+=2;
	}
    if (rl_lab_title_3.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_3.len)/2) - 6)," ",rl_lab_title_3.arr);
	   lctr+=2;
	}
    if (rl_lab_title_4.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_4.len)/2) - 6)," ",rl_lab_title_4.arr);
	   lctr+=2;
	}
    if (rl_lab_title_5.len)  
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_5.len)/2) - 6)," ",rl_lab_title_5.arr);
	   lctr+=2;
	}

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

    rl_lab_title_6.arr[0] = '\0';
    rl_lab_title_6.len = 0;
	/// 12.02.2006 if (strcmp(rl_hmc_yn.arr,"Y") == 0)  // because HMC doesnt want hardcoded legend 
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)  // 12.02.2006 becaz ML,HMC doesnt want hardcoded legend
	{
		strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	}
	else
	{
		strcpy(rl_lab_title_6.arr, "Department of ");
		strcat(rl_lab_title_6.arr, rl_section_short_name.arr);
	}

	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);
    if (rl_lab_title_6.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);
	   lctr+=2;
	}


/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;    
		//fprintf(fp, "Draft Copy\n"); 
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}

	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);
	}
/*----------------------------------------*/
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
  //  fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);09.09.2008
   if(rl_hdr_episode_type.arr[0] == 'I' || rl_hdr_episode_type.arr[0] == 'O' || rl_hdr_episode_type.arr[0] == 'H')//from here added 09.09.2008
    {
	  	
	  l_file_no.arr[0]	= '\0';
	  l_file_no.len	= 0;
		
	  EXEC SQL EXECUTE
     	BEGIN 
           SELECT MR_GET_FILE_NO(:nd_hosp_no,NVL(:rl_ordered_facility_id, :nd_operating_facility_id))
		   INTO :l_file_no from dual;
	    END;
		END-EXEC ;
		l_file_no.arr[l_file_no.len] ='\0';
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "File No : ");
	fprintf(fp,"%-13.13s: ", local_legend[75]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s", l_file_no.arr);
	 
	fprintf(fp,"%-29.29sPage(s) : %3d\n"," ",pctr);
	}
   else
     fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);//upto here added 09.09.2008
/*----------------------------------------*/

	

	/*** NEWLY ADDED ON 28/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO 
			BEFORE the detail portion of heading******/
	if(rl_hdr_episode_type.arr[0] != 'R')
		print_hmc_no();


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

   for(i=0;i<87;i++)
        fprintf(fp,"_");

	fprintf(fp, "\n");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;
	
	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp,"%-13.13s: ", local_legend[6]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s                ", rl_pat_short_name.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-3.3s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s ", l_age_legend);

	patient_age();

	fprintf(fp, "%s\n", t_age.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient  ID  : ");
    fprintf(fp,"%-13.13s: ", local_legend[26]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	   fetch_mp_ext_per_nric();  ///// 03.07.2005 

       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-15.15s                          ", t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	   //fprintf(fp, "Sex/Race: ");
	   fprintf(fp, "%-8.8s: ",local_legend[42] );//added for globalisation
    else
       //fprintf(fp, "     Sex: ");
	   fprintf(fp, "%8.8s: ",local_legend[7] );//added for globalisation

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
			//strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			//strcpy(sex_desc,"Unknown");
			strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp,"%s", sex_desc);

    if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	{
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		get_race_desc();
		fprintf(fp, "%-15.15s", d_race_desc.arr);
	}

    fprintf(fp, "\n");
	page_break(1);

/********** added on 13.02.2005 *************/

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "NRIC/Alt.IdNo: ");
    fprintf(fp,"%-13.13s: ", local_legend[55]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if (rl_national_id_num.len)
	   //fprintf(fp, "%s", rl_national_id_num.arr);  against scf ML-SD-SCF-1749
         fprintf(fp, "%-30.30s", rl_national_id_num.arr); 
	else
       fprintf(fp, "%-30.30s", rl_alternate_id_num.arr);

//11.04.2005    fprintf(fp, "\n");
//11.04.2005	page_break(1);

/************* upto here added on 13.02.2005 ******/

/////////////////  11.04.2005
    get_nationality_desc();	
	fprintf(fp,"%-8.8s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
	page_break(1);
/////////////////


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
    fprintf(fp,"%-13.13s: ", local_legend[8]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s", rl_source_short_name.arr);

	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	    fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		fprintf(fp, "%-20.20s\n", rl_location.arr);
		page_break(1);
	}
	else
	{
		fprintf(fp, "\n");
		page_break(1);
	}


	/*** NEWLY ADDED ON 26/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO ******/
//	if(rl_hdr_episode_type.arr[0] != 'R')
//		print_hmc_no();


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);

/************** 11.04.2005
/////////////////  12.07.2004
	fprintf(fp,"%-8.8s"," ");
    get_nationality_desc();	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
/////////////////
**************************/

//////// 11.04.2005

	fprintf(fp,"%-9.9s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Ordered   : ");
	fprintf(fp,"%-10.10s: ", local_legend[56]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_order_id.len)
	{
	  fprintf(fp, "%-16.16s\n", nd_order_date_time1.arr);//added for globalisation
    }
	else
	  fprintf(fp, "\n");

//////////// 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[16]); //added for globalisation
// 12.07.2004	fprintf(fp,"%c&k4S",ESC); 
// 12.07.2004  	fprintf(fp,"%c(s-3B",ESC);   

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "    ");
	}

	fprintf(fp, "%-19.19s                    ", l_str);

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

/*******11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
************/

//// added the below on  11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
////////  upto here added on 11.04.2005

	page_break(1);
	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
      fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Recd  Date: ");
	//fprintf(fp, "Received  : ");
    fprintf(fp,"%-10.10s: ", local_legend[59]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Category No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[48]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-4.4s/%-4.4s/%-15.15s              ", rl_category_code.arr, rl_category_year.arr,
								rl_category_number.arr);

/************** 11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
***********************/

//////// added the below on 11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr); //added for globalisation

//////////// upto here added on 11.04.2005

	page_break(1);


/// 31.10.2006 added the below 

		if (strcmp(rl_use_sample_anatomy_ind.arr, "SA") == 0 ||
				strcmp(rl_use_sample_anatomy_ind.arr, "AT") == 0)
		{
	  	 get_anatomy_site();
		 get_anatomy_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Anatomy Site : ");
	     fprintf(fp,"%-13.13s: ", local_legend[60]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_anatomy_site_desc.arr);
  		 page_break(1);
		}

///



    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Clinical     : ");
    fprintf(fp,"%-13.13s: ", local_legend[50]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	   
	if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s4B",ESC);
	 //fprintf(fp, "Comment        ");
     fprintf(fp,"%-15.15s ", local_legend[51]); //added for globalisation
	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s-3B",ESC);

	if (rl_hdr_request_comment_desc2.len)
    {

      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    
	if (rl_hdr_request_comment_desc3.len)
    {
	  fprintf(fp, "               ");
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }

/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///

/// 31.10.2006 added the below 
/*********commented on 31.10.2006
		if (rl_perform_site_code.len)
		{
		 get_perform_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 fprintf(fp, "Performing Location: ");
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_perform_site_desc.arr);
  		 page_break(1);
		}
**************/
///


	if (strcmp(rl_test_requested_yn.arr, "Y") == 0)
	{

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordered Tests: ");
		 fprintf(fp,"%-13.13s: ", local_legend[53]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		strcpy(l_str, "");

		for (i=0;i < no_of_dtl_recs;i++)
		{
			d_inhibit_yn.arr[0]		= '\0';
			d_inhibit_yn.len		= 0;

			strcpy(inhibit_test_code.arr, rl_dtl_test_code[i].arr);
			inhibit_test_code.len = strlen(inhibit_test_code.arr);

			chk_inhibit_yn();

			if (d_inhibit_yn.arr[0]	== 'N') 
			{
				if (i == 0)
					sprintf(l_str,"%s", rl_dtl_test_code[i].arr);
				else
					sprintf(l_str,"%s,%s",l_str, rl_dtl_test_code[i].arr);
			}

//11.04.2005   if (i > 15) 

			if (i > 5) 
				break;
		}

		if(no_of_dtl_recs > 7)
		  sprintf(l_str,"%s...",l_str);

		fprintf(fp,"%s\n",l_str);
		page_break(1);
	}


	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		if (strlen(rl_message_line.arr) > 0)
		{
			fprintf(fp, "%70.70s ", rl_message_line.arr);
			fprintf(fp, "%-15.15s\n", nd_hosp_no.arr);
			page_break(1);

		}
	}

    fprintf(fp,"%c&k4S",ESC);  
    fprintf(fp,"%c(s4B",ESC);
    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);

	page_break(1);
	fprintf(fp, "\n"); 
    
	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {

		 print_result_titles(); /// created this procedure to maintain the below common code

/*****************************************************************************************
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *

		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_range_ind.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s", rl_title_for_range_ind.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(5-rl_title_for_range_ind.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-4.4s", " ");

     if(rl_title_for_result_range.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(14-rl_title_for_result_range.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-15.15s", " ");


	page_break(1);
	fprintf(fp, "\n");
*****************************************************************************************************/
	}
    
}
/*-------------------------------------------*/
/*--------------added on 09.07.2007----- against ARTEMIs request        -----------------------------*/
print_header6()
{

    char t_patient_id[16];   
    char sex_desc[11];
	char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
	char l_age_legend[5];

    pctr++;
    
    get_parameters();
	lctr = 0;
/*---------*/

/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/
	get_sm_installation();
	if (strcmp(BVNewVersionYN.arr,"N") == 0
					|| strcmp(rl_report_format.arr, "6") == 0    /// added on 09.07.2007 against ARTEMIS request
	   )
	{
//	 fprintf(fp,"\n\n\n\n\n\n");
//	 lctr+=6;
	 lctr = 0;
	}    
	else
	{
	 fprintf(fp,"\n");
	 lctr+=1;

	}

/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 

/*-------- upto here on 21.10.2004 -----*/

    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/

	fprintf(fp,"\n\n\n\n");
	 lctr+=4;

/************* commented againt the ARTEMIS request on 09.07.2007 
    if (rl_lab_title.len) 
	{
       fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);
	   lctr+=2;
	}
    if (rl_lab_title_2.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_2.len)/2) - 6)," ",rl_lab_title_2.arr);
	   lctr+=2;
	}
    if (rl_lab_title_3.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_3.len)/2) - 6)," ",rl_lab_title_3.arr);
	   lctr+=2;
	}
    if (rl_lab_title_4.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_4.len)/2) - 6)," ",rl_lab_title_4.arr);
	   lctr+=2;
	}
    if (rl_lab_title_5.len)  
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_5.len)/2) - 6)," ",rl_lab_title_5.arr);
	   lctr+=2;
	}

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

    rl_lab_title_6.arr[0] = '\0';
    rl_lab_title_6.len = 0;
	/// 12.02.2006 if (strcmp(rl_hmc_yn.arr,"Y") == 0)  // because HMC doesnt want hardcoded legend 
	if (strcmp(BVNewVersionYN.arr,"Y") == 0)  // 12.02.2006 becaz ML,HMC doesnt want hardcoded legend
	{
		strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	}
	else
	{
		strcpy(rl_lab_title_6.arr, "Department of ");
		strcat(rl_lab_title_6.arr, rl_section_short_name.arr);
	}

	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);
    if (rl_lab_title_6.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);
	   lctr+=2;
	}
*********************************** upto here commented on 09.07.2007 against ARTEMIS request ***************/

/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;    
		//fprintf(fp, "Draft Copy\n");
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}

/******** commented the below on 09.07.2007 against ARTEMIS request
	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);
	}

///----------------------------------------
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
///----------------------------------------

********************************/
	

	/*** NEWLY ADDED ON 28/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO 
			BEFORE the detail portion of heading******/
	if(rl_hdr_episode_type.arr[0] != 'R')
		print_hmc_no();


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

   for(i=0;i<87;i++)
        fprintf(fp,"_");

	fprintf(fp, "\n");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;
	
	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp,"%-13.13s: ", local_legend[6]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s                ", rl_pat_short_name.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-3.3s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s ", l_age_legend);

	patient_age();

	fprintf(fp, "%s\n", t_age.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
// 09.07.2007	fprintf(fp, "Patient  ID  : ");
	//fprintf(fp, "AHI ID       : ");   // 09.07.2007
    fprintf(fp,"%-13.13s: ", local_legend[54]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	   fetch_mp_ext_per_nric();  ///// 03.07.2005 

       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-15.15s                          ", t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	   //fprintf(fp, "Sex/Race: ");
	   fprintf(fp, "%-8.8s: ",local_legend[42] );//added for globalisation
    else
       //fprintf(fp, "     Sex: ");
	   fprintf(fp, "%8.8s: ",local_legend[7] );//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
		//	strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			// strcpy(sex_desc,"Unknown");  //commented this line against AMS-SCF-0045
			strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp,"%s", sex_desc);

    if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	{
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC);   
   		fprintf(fp,"%c(s-3B",ESC);   

		get_race_desc();
		fprintf(fp, "%-15.15s", d_race_desc.arr);
	}

    fprintf(fp, "\n");
	page_break(1);

/********** added on 13.02.2005 *************/

/******** commented against ARTEMIS request

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "NRIC/Alt.IdNo: ");
    fprintf(fp,"%-13.13s: ", local_legend[55]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if (rl_national_id_num.len)
     //fprintf(fp, "%s", rl_national_id_num.arr);  against scf ML-SD-SCF-1749
	   fprintf(fp, "%-30.30s", rl_national_id_num.arr);
	else
       fprintf(fp, "%-30.30s", rl_alternate_id_num.arr);

****************************************************************/

//11.04.2005    fprintf(fp, "\n");
//11.04.2005	page_break(1);

/************* upto here added on 13.02.2005 ******/

/////////////////  11.04.2005
/**************commented against ARTEMIS request
    get_nationality_desc();	
//09.07.2007	fprintf(fp,"%-8.8s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality  : ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
	page_break(1);
/////////////////
************************/

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
    fprintf(fp,"%-13.13s: ", local_legend[8]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s", rl_source_short_name.arr);

	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	    fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		fprintf(fp, "%-20.20s\n", rl_location.arr);
		page_break(1);
	}
	else
	{
		fprintf(fp, "\n");
		page_break(1);
	}


	/*** NEWLY ADDED ON 26/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO ******/
//	if(rl_hdr_episode_type.arr[0] != 'R')
//		print_hmc_no();


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);

/************** 11.04.2005
/////////////////  12.07.2004
	fprintf(fp,"%-8.8s"," ");
    get_nationality_desc();	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
/////////////////
**************************/

//////// 11.04.2005

	fprintf(fp,"%-9.9s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Ordered   : ");
	fprintf(fp,"%-10.10s: ", local_legend[56]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_order_id.len)
	{
  
	  fprintf(fp, "%-16.16s\n", nd_order_date_time1.arr);//added for globalisation
    }
	else
	  fprintf(fp, "\n");

//////////// 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[16]); //added for globalisation
// 12.07.2004	fprintf(fp,"%c&k4S",ESC); 
// 12.07.2004  	fprintf(fp,"%c(s-3B",ESC);   

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "    ");
	}

	fprintf(fp, "%-19.19s                    ", l_str);

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

/*******11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
************/

//// added the below on  11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
////////  upto here added on 11.04.2005

	page_break(1);
	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
      fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Recd  Date: ");
	//fprintf(fp, "Received  : ");
    fprintf(fp,"%-10.10s: ", local_legend[59]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Category No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[48]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-4.4s/%-4.4s/%-15.15s              ", rl_category_code.arr, rl_category_year.arr,
								rl_category_number.arr);

/************** 11.04.2005
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time.arr);	
***********************/

//////// added the below on 11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr);//added for globalisation

//////////// upto here added on 11.04.2005

	page_break(1);


/// 31.10.2006 added the below 

		if (strcmp(rl_use_sample_anatomy_ind.arr, "SA") == 0 ||
				strcmp(rl_use_sample_anatomy_ind.arr, "AT") == 0)
		{
	  	 get_anatomy_site();
		 get_anatomy_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Anatomy Site : ");
	     fprintf(fp,"%-13.13s: ", local_legend[60]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_anatomy_site_desc.arr);
  		 page_break(1);
		}

///



    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Clinical     : ");
    fprintf(fp,"%-13.13s: ", local_legend[50]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	   
	if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s4B",ESC);
	 //fprintf(fp, "Comment        ");
     fprintf(fp,"%-15.15s ", local_legend[51]); //added for globalisation
	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s-3B",ESC);

	if (rl_hdr_request_comment_desc2.len)
    {

      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    
	if (rl_hdr_request_comment_desc3.len)
    {
	  fprintf(fp, "               ");
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }

/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///

/// 31.10.2006 added the below 
/*********commented on 31.10.2006
		if (rl_perform_site_code.len)
		{
		 get_perform_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 fprintf(fp, "Performing Location: ");
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_perform_site_desc.arr);
  		 page_break(1);
		}
**************/
///


	if (strcmp(rl_test_requested_yn.arr, "Y") == 0)
	{

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordered Tests: ");
		 fprintf(fp,"%-13.13s: ", local_legend[53]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		strcpy(l_str, "");

		for (i=0;i < no_of_dtl_recs;i++)
		{
			d_inhibit_yn.arr[0]		= '\0';
			d_inhibit_yn.len		= 0;

			strcpy(inhibit_test_code.arr, rl_dtl_test_code[i].arr);
			inhibit_test_code.len = strlen(inhibit_test_code.arr);

			chk_inhibit_yn();

			if (d_inhibit_yn.arr[0]	== 'N') 
			{
				if (i == 0)
					sprintf(l_str,"%s", rl_dtl_test_code[i].arr);
				else
					sprintf(l_str,"%s,%s",l_str, rl_dtl_test_code[i].arr);
			}

//11.04.2005   if (i > 15) 

			if (i > 5) 
				break;
		}

		if(no_of_dtl_recs > 7)
		  sprintf(l_str,"%s...",l_str);

		fprintf(fp,"%s\n",l_str);
		page_break(1);
	}


	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		if (strlen(rl_message_line.arr) > 0)
		{
			fprintf(fp, "%70.70s ", rl_message_line.arr);
			fprintf(fp, "%-15.15s\n", nd_hosp_no.arr);
			page_break(1);

		}
	}

    fprintf(fp,"%c&k4S",ESC);  
    fprintf(fp,"%c(s4B",ESC);
    for(i=0;i<87;i++)
        fprintf(fp,"_");
    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);

	page_break(1);
	fprintf(fp, "\n"); 
    
	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {

	 print_result_titles(); /// created this procedure to maintain the below common code

/************************************************************************
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *

		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_range_ind.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s", rl_title_for_range_ind.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(5-rl_title_for_range_ind.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-4.4s", " ");

     if(rl_title_for_result_range.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(14-rl_title_for_result_range.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-15.15s", " ");


	page_break(1);
	fprintf(fp, "\n");
*****************************************************************/
	}
    
}



/*----added on 13.02.2005-------------------------------------------------*/
print_footer4(foot_ind)
int foot_ind;
{
   int fi = 0;
   char l_str[100];
   l_str[0] = '\0'; 

   for(fi=0; fi < 87; fi++)
       fprintf(fp,"%c",'_');

   fprintf(fp,"\n");
   
   fflush(fp);

      if (rl_name_on_report_yn.arr[0] == 'Y')
	  {

		get_print_name(first_user.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(first_user.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Released/Reviewed By : ");
		//fprintf(fp,"Released By   : ");
		fprintf(fp,"%-13.13s : ", local_legend[61]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

//12.04.2005   fprintf(fp,"%-30.30s",l_str);
//12.04.2005   fprintf(fp, "    ");


		if (strcmp(rl_report_format.arr, "6") == 0)  //added on 09.07.2007 against ARTEMIS request.	    
		{
			fprintf(fp,"%-30.30s",l_str);
			fprintf(fp, "    ");
		}
		else
		{
			get_position_desc(sy_func_role_id.arr);
			if (nd_position_desc.len)
				fprintf(fp,"%-15.15s,",l_str);
			else
				fprintf(fp,"%-16.16s",l_str);

			sprintf(l_str,"%s", nd_position_desc.arr);
			fprintf(fp,"%-15.15s",l_str);	
			fprintf(fp, "    ");
		}
		/*----------------------------------------*/

	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
	   //fprintf(fp,"Released Date  : ");
	   fprintf(fp,"%-15.15s : ", local_legend[62]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   fprintf(fp,"%-s\n",footer_released_date);
	   /*----------------------------------------*/

	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;

	 }

	  get_print_name(rl_hdr_released_by_id.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(rl_hdr_released_by_id.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Reviewed By : ");
		//fprintf(fp,"Authorized By : ");
		fprintf(fp,"%-13.13s : ", local_legend[64]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

//12.04.2005	    fprintf(fp,"%-30.30s",l_str);
//12.04.2005		fprintf(fp, "      ");


		if (strcmp(rl_report_format.arr, "6") == 0)  //added on 09.07.2007 against ARTEMIS request.	    
		{
			fprintf(fp,"%-30.30s",l_str);
			fprintf(fp, "      ");
		}
		else
		{
			get_position_desc(sy_func_role_id.arr);
			if (nd_position_desc.len)
				fprintf(fp,"%-15.15s,",l_str);
			else
				fprintf(fp,"%-16.16s",l_str);

			sprintf(l_str,"%s", nd_position_desc.arr);
			fprintf(fp,"%-15.15s",l_str);	
			fprintf(fp, "    ");
		}


	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
//	   fprintf(fp,"Reviewed Date : ");
	   //fprintf(fp,"Authorized Date: ");
	   fprintf(fp,"%-15.15s : ", local_legend[66]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   //fprintf(fp,"%-s\n",rl_hdr_released_date.arr);
	   fprintf(fp,"%-s\n",rl_hdr_released_date1.arr); //added for globalisation
	   /*----------------------------------------*/

   	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;


	  }

		/*----------------------------------------*/
		/***********************
	    fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp,"Reprint Date : ");
        fprintf(fp,"%c&k4S",ESC); 
        fprintf(fp,"%c(s-3B",ESC);   
		***********************/
		/*----------------------------------------*/
	/***********************
	   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
	   else
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);

	   fprintf(fp,"%s",nd_result_printed_date.arr);
	***********************/

///////////////// 12.07.2004 'ss'
		if (p_param8.arr[0] == 'P')
		{
		  get_print_name(sy_user_id.arr);
		  if (print_name_yn.arr[0]	== 'Y')
		  {

			get_user_name(sy_user_id.arr);

		   /*----------------------------------------*/
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp,"Reprinted By  : ");
			fprintf(fp,"%-12.12s: ", local_legend[67]); //added for globalisation 
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC);   
  			sprintf(l_str,"%s", sy_user_name.arr);

//12.04.2005			fprintf(fp,"%-30.30s",l_str);
//12.04.2005			fprintf(fp, "      ");

		if (strcmp(rl_report_format.arr, "6") == 0)  //added on 09.07.2007 against ARTEMIS request.	    
		{
			fprintf(fp,"%-30.30s",l_str);
			fprintf(fp, "      ");
		}
		else
		{
			get_position_desc(sy_func_role_id.arr);
			if (nd_position_desc.len)
				fprintf(fp,"%-15.15s,",l_str);
			else
				fprintf(fp,"%-16.16s",l_str);

			sprintf(l_str,"%s", nd_position_desc.arr);
			fprintf(fp,"%-15.15s",l_str);	
			fprintf(fp, "    ");
		}

		   /*----------------------------------------*/	   
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s4B",ESC);
		   //fprintf(fp,"Reprinted Date : ");
			fprintf(fp,"%-14.14s: ", local_legend[68]); //added for globalisation 
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s-3B",ESC);   

			l_sy_req_date.arr[0]	= '\0';
			l_sy_req_date.len	= 0;

			EXEC SQL SELECT  to_char(to_date(:sy_req_date,'DDMMYYHH24MISS'),'DD/MM/YYYY HH24:MI')
				   INTO		:l_sy_req_date
				   FROM		DUAL;

			   if (OERROR);

			l_sy_req_date.arr[l_sy_req_date.len] = '\0';
	 /**** date conversion start for globalisation ************/
        EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:l_sy_req_date1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:l_sy_req_date1 :=sm_convert_datetime_2t(to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;
	 /**** date conversion end for globalisation ************/


		   fprintf(fp,"%-s\n",l_sy_req_date1.arr);

		   //fprintf(fp,"%-s\n",l_sy_req_date.arr);
		   /*----------------------------------------*/

   	   		sy_user_name.arr[0]		= '\0';
			sy_user_name.len			= 0; 

		  }

		}
////////////////
	  
	}

/****** FOOTER PRINTING FROM RL_SECTION_CTL  ****************/
   if ( (strlen(rl_footer_line_1.arr) > 0) ||
			(strlen(rl_footer_line_2.arr) > 0) )
   {
		if (strlen(rl_footer_line_1.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_1.arr);

		if (strlen(rl_footer_line_2.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_2.arr);
   }


   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2  && 
		strcmp(draft_printing_yn.arr, "N") == 0)
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);
      //fprintf(fp,"Copy To : ");
      fprintf(fp,"%-8.8s: ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

   if(last_page == 0)
      //sprintf(l_str,"%-73.73s--CONTINUED--"," ");
      sprintf(l_str,"%-73.73s--%-9.9s--"," ",local_legend[24]); //added for globalisation
   else
      //sprintf(l_str,"%-73.73s      --END--"," ");
      sprintf(l_str,"%-73.73s --%-3.3s--"," ",local_legend[25]);// added for globalisation

   fprintf(fp,"%s\f",l_str);   

   fprintf(fp,"%cE",ESC); // added on 21.10.2004 to reset the printer settings.

   lctr = 0; 
  
}

/*-----------------------------------------------------*/

/*--------------------------  added on 11.10.2007 against the SD-CRF-20093 -------*/
print_footer5(foot_ind)
int foot_ind;
{
   int fi = 0;
   int bal = 0;
   char l_str[100];
   l_str[0] = '\0'; 


    if (strcmp(l_customer_id.arr, "AMRI") == 0) 
    {

/**************************** changed to show immediately after the body ***************
		if(last_page == 0)
			sprintf(l_str,"%-34.34s--%-9.9s--"," ",local_legend[24]); //added for globalisation
		else
			sprintf(l_str,"%-43.43s --%-3.3s--"," ",local_legend[25]);// added for globalisation

		fprintf(fp,"%s\n",l_str);    

	    for(fi=0; fi < 87; fi++)
		   fprintf(fp,"%c",'_');

		 fprintf(fp,"\n");
**************************** upto here changed to show immediately after the body ***************/

		 fflush(fp);

	}
	else
	{

		   for(fi=0; fi < 87; fi++)
			   fprintf(fp,"%c",'_');

		   fprintf(fp,"\n");
   
		   fflush(fp);

      if (rl_name_on_report_yn.arr[0] == 'Y')
	  {

		get_print_name(first_user.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(first_user.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Released/Reviewed By : ");
		//fprintf(fp,"Released By   : ");
		fprintf(fp,"%-13.13s : ", local_legend[61]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

		fprintf(fp,"%-60.60s\n",l_str);

		get_position_desc(sy_func_role_id.arr);

		fprintf(fp,"                ");
		sprintf(l_str,"%s", nd_position_desc.arr);
		fprintf(fp,"%-30.30s",l_str);	
		fprintf(fp, "    ");
		}
		/*----------------------------------------*/

	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
	   //fprintf(fp,"Released Date  : ");
	   fprintf(fp,"%-15.15s : ", local_legend[62]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   fprintf(fp,"%-s\n",footer_released_date);
	   /*----------------------------------------*/

	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;

	 }

	  get_print_name(rl_hdr_released_by_id.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(rl_hdr_released_by_id.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Reviewed By : ");
		//fprintf(fp,"Authorized By : ");
		fprintf(fp,"%-13.13s : ", local_legend[64]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

		fprintf(fp,"%-60.60s\n",l_str);

		get_position_desc(sy_func_role_id.arr);

		sprintf(l_str,"%s", nd_position_desc.arr);
		fprintf(fp,"                ");
		fprintf(fp,"%-30.30s",l_str);	
		fprintf(fp, "    ");


	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
//	   fprintf(fp,"Reviewed Date : ");
	   //fprintf(fp,"Authorized Date: ");
	   fprintf(fp,"%-15.15s : ", local_legend[66]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   //fprintf(fp,"%-s\n",rl_hdr_released_date.arr);
	   fprintf(fp,"%-s\n",rl_hdr_released_date1.arr); //added for globalisation
	   /*----------------------------------------*/

   	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;


	  }

		/*----------------------------------------*/
		/***********************
	    fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp,"Reprint Date : ");
        fprintf(fp,"%c&k4S",ESC); 
        fprintf(fp,"%c(s-3B",ESC);   
		***********************/
		/*----------------------------------------*/
	/***********************
	   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
	   else
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);

	   fprintf(fp,"%s",nd_result_printed_date.arr);
	***********************/

///////////////// 12.07.2004 'ss'
		if (p_param8.arr[0] == 'P')
		{
		  get_print_name(sy_user_id.arr);
		  if (print_name_yn.arr[0]	== 'Y')
		  {

			get_user_name(sy_user_id.arr);

		   /*----------------------------------------*/ 
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp,"Reprinted By  : ");
			fprintf(fp,"%-13.13s : ", local_legend[67]); //added for globalisation 
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC);   
  			sprintf(l_str,"%s", sy_user_name.arr);

			fprintf(fp,"%-60.60s\n",l_str);

			get_position_desc(sy_func_role_id.arr);

			sprintf(l_str,"%s", nd_position_desc.arr);
			fprintf(fp,"                ");
			fprintf(fp,"%-30.30s",l_str);	
			fprintf(fp, "    ");


		   /*----------------------------------------*/	   
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s4B",ESC);
		   //fprintf(fp,"Reprinted Date : ");
			fprintf(fp,"%-15.15s : ", local_legend[68]); //added for globalisation 
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s-3B",ESC);   

			l_sy_req_date.arr[0]	= '\0';
			l_sy_req_date.len	= 0;

			EXEC SQL SELECT  to_char(to_date(:sy_req_date,'DDMMYYHH24MISS'),'DD/MM/YYYY HH24:MI')
				   INTO		:l_sy_req_date
				   FROM		DUAL;

			   if (OERROR);

			l_sy_req_date.arr[l_sy_req_date.len] = '\0';

	 /**** date conversion start for globalisation ************/
        EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:l_sy_req_date1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:l_sy_req_date1 :=sm_convert_datetime_2t(to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;
	 /**** date conversion end for globalisation ************/


		   fprintf(fp,"%-s\n",l_sy_req_date1.arr);
//		   fprintf(fp,"%-s\n",l_sy_req_date.arr);
		   /*----------------------------------------*/

   	   		sy_user_name.arr[0]		= '\0';
			sy_user_name.len			= 0; 



		}
////////////////
	  
	}
  }

fprintf(fp,"%c&k4S",ESC);       
/****** FOOTER PRINTING FROM RL_SECTION_CTL  ****************/
   if ( (strlen(rl_footer_line_1.arr) > 0) ||
			(strlen(rl_footer_line_2.arr) > 0) || (strlen(rl_footer_line_3.arr) > 0) )
   {
		if (strlen(rl_footer_line_1.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_1.arr);

		if (strlen(rl_footer_line_2.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_2.arr);

		if (strlen(rl_footer_line_3.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_3.arr);
 

   }

fprintf(fp,"%c&k4S",ESC); 

   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2  && 
		strcmp(draft_printing_yn.arr, "N") == 0)
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);
      //fprintf(fp,"Copy To : ");
      fprintf(fp,"%-8.8s: ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

   if (strcmp(l_customer_id.arr, "AMRI") != 0) 
   {
		if(last_page == 0)
			sprintf(l_str,"%-34.34s--%-9.9s--"," ",local_legend[24]); //added for globalisation
		else
			sprintf(l_str,"%-43.43s --%-3.3s--"," ",local_legend[25]);// added for globalisation

		fprintf(fp,"%s\f",l_str);    
	}
	else
	{
		fprintf(fp,"%-11.11s %-30.30s", local_legend[90], first_user.arr); 		

		bal = 66 - (11 + 1 + 30);

		fprintf(fp,"%-*sPage(s):%3d\n", bal," ",pctr);

		fprintf(fp,"\f");    
	}

   fprintf(fp,"%cE",ESC); // added on 21.10.2004 to reset the printer settings.

   lctr = 0; 
  
}

/*-----------------------------------------------------*/


/*----added on 09.07.2007---AGAINST ARTEMIS REQUEST -----------------------------*/
print_footer6(foot_ind)
int foot_ind;
{
   int fi = 0;
   char l_str[100];
   l_str[0] = '\0'; 

   for(fi=0; fi < 87; fi++)
       fprintf(fp,"%c",'_');

   fprintf(fp,"\n");
   
   fflush(fp);

      if (rl_name_on_report_yn.arr[0] == 'Y')
	  {

		get_print_name(first_user.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(first_user.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Released/Reviewed By : ");
		//fprintf(fp,"Released By   : ");
		fprintf(fp,"%-13.13s : ", local_legend[61]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

		fprintf(fp,"%-60.60s\n",l_str);

		get_position_desc(sy_func_role_id.arr);

		fprintf(fp,"                ");
		sprintf(l_str,"%s", nd_position_desc.arr);
		fprintf(fp,"%-30.30s",l_str);	
		fprintf(fp, "    ");
		}
		/*----------------------------------------*/

	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
	   //fprintf(fp,"Released Date  : ");
	   fprintf(fp,"%-15.15s : ", local_legend[62]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   fprintf(fp,"%-s\n",footer_released_date);
	   /*----------------------------------------*/

	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;

	 }

	  get_print_name(rl_hdr_released_by_id.arr);
	  if (print_name_yn.arr[0]	== 'Y')
	  {

		get_user_name(rl_hdr_released_by_id.arr);

	   /*----------------------------------------*/
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
//		fprintf(fp,"Reviewed By : ");
		//fprintf(fp,"Authorized By : ");
		fprintf(fp,"%-13.13s : ", local_legend[64]); //added for globalisation
		fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s-3B",ESC);   
  	    sprintf(l_str,"%s", sy_user_name.arr);

		fprintf(fp,"%-60.60s\n",l_str);

		get_position_desc(sy_func_role_id.arr);

		sprintf(l_str,"%s", nd_position_desc.arr);
		fprintf(fp,"                ");
		fprintf(fp,"%-30.30s",l_str);	
		fprintf(fp, "    ");


	   /*----------------------------------------*/	   
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s4B",ESC);
//	   fprintf(fp,"Reviewed Date : ");
	   //fprintf(fp,"Authorized Date: ");
	   fprintf(fp,"%-15.15s : ", local_legend[66]); //added for globalisation
	   fprintf(fp,"%c&k4S",ESC); 
	   fprintf(fp,"%c(s-3B",ESC);   
	   //fprintf(fp,"%-s\n",rl_hdr_released_date.arr);
	   fprintf(fp,"%-s\n",rl_hdr_released_date1.arr); //added for globalisation
	   /*----------------------------------------*/

   	   	sy_user_name.arr[0]		= '\0';
		sy_user_name.len			= 0;


	  }

		/*----------------------------------------*/
		/***********************
	    fprintf(fp,"%c&k4S",ESC); 
		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp,"Reprint Date : ");
        fprintf(fp,"%c&k4S",ESC); 
        fprintf(fp,"%c(s-3B",ESC);   
		***********************/
		/*----------------------------------------*/
	/***********************
	   if (rl_prn_ctrl_hdr_rp_yn.arr[0] == 'Y')
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);
	   else
		   sprintf(l_str,"%-16.16s         ",nd_result_printed_date.arr);

	   fprintf(fp,"%s",nd_result_printed_date.arr);
	***********************/

///////////////// 12.07.2004 'ss'
		if (p_param8.arr[0] == 'P')
		{
		  get_print_name(sy_user_id.arr);
		  if (print_name_yn.arr[0]	== 'Y')
		  {

			get_user_name(sy_user_id.arr);

		   /*----------------------------------------*/
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
			//fprintf(fp,"Reprinted By  : ");
			fprintf(fp,"%-12.12s: ", local_legend[67]); //added for globalisation 
//			fprintf(fp,"                ");
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC);   
  			sprintf(l_str,"%s", sy_user_name.arr);

			fprintf(fp,"%-60.60s\n",l_str);

			get_position_desc(sy_func_role_id.arr);

			sprintf(l_str,"%s", nd_position_desc.arr);
			fprintf(fp,"                ");
			fprintf(fp,"%-30.30s",l_str);	
			fprintf(fp, "    ");


		   /*----------------------------------------*/	   
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s4B",ESC);
		   //fprintf(fp,"Reprinted Date : ");
			fprintf(fp,"%-14.14s: ", local_legend[68]); //added for globalisation 
		   fprintf(fp,"%c&k4S",ESC); 
		   fprintf(fp,"%c(s-3B",ESC);   

			l_sy_req_date.arr[0]	= '\0';
			l_sy_req_date.len	= 0;

			EXEC SQL SELECT  to_char(to_date(:sy_req_date,'DDMMYYHH24MISS'),'DD/MM/YYYY HH24:MI')
				   INTO		:l_sy_req_date
				   FROM		DUAL;

			   if (OERROR);

			l_sy_req_date.arr[l_sy_req_date.len] = '\0';
	 /**** date conversion start for globalisation ************/
        EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:l_sy_req_date1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:l_sy_req_date1 :=sm_convert_datetime_2t(to_date(:l_sy_req_date,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;
	 /**** date conversion end for globalisation ************/


		   fprintf(fp,"%-s\n",l_sy_req_date1.arr);

		 //  fprintf(fp,"%-s\n",l_sy_req_date.arr);
		   /*----------------------------------------*/

   	   		sy_user_name.arr[0]		= '\0';
			sy_user_name.len			= 0; 



		}
////////////////
	  
	}

/****** FOOTER PRINTING FROM RL_SECTION_CTL  ****************/
   if ( (strlen(rl_footer_line_1.arr) > 0) ||
			(strlen(rl_footer_line_2.arr) > 0) )
   {
		if (strlen(rl_footer_line_1.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_1.arr);

		if (strlen(rl_footer_line_2.arr) > 0) 
			fprintf(fp, "%-79.79s\n", rl_footer_line_2.arr);
   }


   /*----------------------------------------*/

   if (rl_hdr_extra_copies_to.len && copy == 2  && 
		strcmp(draft_printing_yn.arr, "N") == 0)
   {
      /*----------------------------------------*/
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s4B",ESC);
      //fprintf(fp,"Copy To : ");
      fprintf(fp,"%-8.8s: ", local_legend[23]); //added for globalisation
      fprintf(fp,"%c&k4S",ESC); 
      fprintf(fp,"%c(s-3B",ESC);   
      /*----------------------------------------*/

      sprintf(l_str,"%24.24s",rl_hdr_extra_copies_to.arr);
   }
   else
      sprintf(l_str,"%34.34s"," ");

   fprintf(fp,"%s\n",l_str);

/*******
   if(last_page == 0)
      sprintf(l_str,"%-73.73s--CONTINUED--"," ");
   else
      sprintf(l_str,"%-73.73s      --END--"," ");
********/

   if(last_page == 0)
      //sprintf(l_str,"%-43.43s--CONTINUED--"," ");
      sprintf(l_str,"%-43.43s--%-9.9s--"," ",local_legend[24]); //added for globalisation
   else
      sprintf(l_str,"%-43.43s      --END--"," ");
      sprintf(l_str,"%-43.43s --%-3.3s--"," ",local_legend[25]);// added for globalisation


/*----------------------------------------*/

      sprintf(l_str,"%s%10.10sPage(s) : %3d\n",l_str," ",pctr);    /// added 09.07.2007
/*----------------------------------------*/

   fprintf(fp,"%s\f",l_str);   

   fprintf(fp,"%cE",ESC); // added on 21.10.2004 to reset the printer settings.

   lctr = 0; 
  
}

/*-----------------------------------------------------*/


get_order_date_time()
{
	nd_order_date_time.arr[0]		= '\0';
	nd_order_date_time.len		= 0;

   EXEC SQL SELECT TO_CHAR(ord_date_time,'DD/MM/YYYY HH24:MI')
			INTO :nd_order_date_time
			FROM OR_ORDER
			WHERE order_id = :rl_order_id; 

    if(OERROR);

	if (NODATAFOUND);    

	nd_order_date_time.arr[nd_order_date_time.len]	= '\0';
     
   
}
/*------------------------------------------------------------*/
/*------------ added the below on 12.04.2005 -----------*/
get_position_desc(char *fuserid)
{
	strcpy(sy_user.arr, fuserid);
	sy_user.len  = strlen(sy_user.arr);

	nd_position_desc.arr[0]		= '\0';
	nd_position_desc.len		= 0;
    
	EXEC SQL SELECT b.position_desc position_desc
			INTO :nd_position_desc
			FROM  AM_PRACTITIONER A,AM_POSITION B
			WHERE a.practitioner_id  = :sy_user
			AND   a.position_code = b.position_code;

    if(OERROR);

	if (NODATAFOUND);

	nd_position_desc.arr[nd_position_desc.len]	= '\0';

}
/*------------------------------------------------------------*/

/*---- added the below on 21.05.2005  -----------------*/

get_result_printed_date()
{
	rl_hdr_result_printed_date.arr[0]	= '\0';
	rl_hdr_result_printed_date.len		= 0;
	rl_hdr_status.arr[0]				= '\0';
	rl_hdr_status.len					= 0;
    rl_hdr_section_code.arr[0]          = '\0';
    rl_hdr_section_code.len             = 0;
	d_episode_type.arr[0]				= '\0';
	d_episode_type.len					= 0;

   EXEC SQL SELECT  TO_CHAR(result_printed_date,'DD/MM/YYYY HH24:MI:SS'),NVL(status,'O'),
					section_code, episode_type
			  INTO :rl_hdr_result_printed_date,:rl_hdr_status,:rl_hdr_section_code,:d_episode_type
			  FROM  RL_REQUEST_HEADER
             WHERE  SPECIMEN_NO = :nd_spec_no
 			   AND  OPERATING_FACILITY_ID = :nd_operating_facility_id;

	if (NODATAFOUND);    

    if (OERROR);

	rl_hdr_result_printed_date.arr[rl_hdr_result_printed_date.len]	= '\0';
	rl_hdr_status.arr[rl_hdr_status.len]	= '\0';
    rl_hdr_section_code.arr[rl_hdr_section_code.len] 			= '\0';
	d_episode_type.arr[d_episode_type.len] = '\0';

}
/*------------------------------------------------------------*/
/*---- added the below on 21.05.2005  -----------------*/

get_tst_rslt_max_reviewed_date()
{
	rl_tst_rslt_max_rev_date.arr[0]	= '\0';
	rl_tst_rslt_max_rev_date.len		= 0;


   EXEC SQL SELECT  TO_CHAR(MAX(reviewed_date),'DD/MM/YYYY HH24:MI:SS')
			  INTO :rl_tst_rslt_max_rev_date
			  FROM  RL_TEST_RESULT
             WHERE  SPECIMEN_NO = :nd_spec_no
 			   AND  OPERATING_FACILITY_ID = :nd_operating_facility_id;

	if (NODATAFOUND);    

    if (OERROR);

	rl_tst_rslt_max_rev_date.arr[rl_tst_rslt_max_rev_date.len]	= '\0';

}
/*------------------------------------------------------------*/


/*--------- added the below on 19.10.2005 -------------------------------------*/
check_neonate_mother_spec_yn() 
{

   d_mother_specimen_yn.arr[0]		= '\0';      
   d_mother_specimen_yn.len		= 0;

   EXEC SQL SELECT  'Y'
			  INTO :d_mother_specimen_yn
		  	  FROM RL_NEONATE_MOTHER_SPECIMENS
			 WHERE specimen_no 			 = :nd_spec_no
			   AND operating_facility_id = :nd_operating_facility_id
			   AND NVL(nn_specimen_no_yn,'N') = 'N'
			   AND specimen_no <> nn_specimen_no;

	if (NODATAFOUND)
		strcpy(d_mother_specimen_yn.arr,"N");    

    if (OERROR)
		strcpy(d_mother_specimen_yn.arr,"N");    

	d_mother_specimen_yn.arr[d_mother_specimen_yn.len]	= '\0';

	if(strcmp(d_mother_specimen_yn.arr,"N") == 0)
		l_should_print_yn = 'Y';
	if(strcmp(d_mother_specimen_yn.arr,"Y") == 0)
		l_should_print_yn = 'N';

//sprintf(string_var,"checking neonates..specno=%d,should print=%c",nd_spec_no.arr,l_should_print_yn);
//disp_message(ERR_MESG,string_var);

}

/*------------------------------------------------------------*/

/*--------- added the below on 16.01.2006 -------------------------------------*/
get_test_units_desc_from_sy_uom()
{

   rl_tst_cd_test_units_desc.arr[0]		= '\0';      
   rl_tst_cd_test_units_desc.len		= 0;

   EXEC SQL SELECT  short_desc
			  INTO :rl_tst_cd_test_units_desc
		  	  FROM SY_UOM_LANG_VW
			 WHERE uom_code = :rl_tst_cd_test_units
			 AND LANGUAGE_ID = :language_id;

	if (NODATAFOUND)
	{
		strcpy(rl_tst_cd_test_units_desc.arr,rl_tst_cd_test_units.arr);    
		rl_tst_cd_test_units_desc.len = strlen(rl_tst_cd_test_units_desc.arr);
//		rl_tst_cd_test_units_desc.arr[rl_tst_cd_test_units_desc.len]	= '\0';

	}

    if (OERROR)
	{
		strcpy(rl_tst_cd_test_units_desc.arr,rl_tst_cd_test_units.arr);    
		rl_tst_cd_test_units_desc.len = strlen(rl_tst_cd_test_units_desc.arr);
	}

	rl_tst_cd_test_units_desc.arr[rl_tst_cd_test_units_desc.len]	= '\0';

}
/*------------------------------------------------------------*/
get_si_units_equv_val()
{

   d_eqvl_test_units.arr[0]		= '\0';        
   d_eqvl_test_units.len		= 0;

   
   d_numeric_eqvl_value	= 0;
   d_numeric_eqvl_value2	= 0;
   d_low_val_nor_eqvl_value = 0;
   d_high_val_nor_eqvl_value = 0;

   l_flag = 0;


   EXEC SQL SELECT  eqvl_uom_code, eqvl_value
			  INTO :d_eqvl_test_units, :d_numeric_eqvl_value
		  	  FROM SY_UOM_EQVL
			 WHERE uom_code = :rl_tst_cd_test_units
			   AND eqvl_uom_code = :rl_tst_cd_oth_units;


	if (NODATAFOUND)
		l_flag = 1; 

    if (OERROR)
		l_flag = 1;

	d_eqvl_test_units.arr[d_eqvl_test_units.len]	= '\0';

    d_numeric_eqvl_value2	= d_numeric_eqvl_value;

    if (l_flag == 0)
	{

      d_numeric_eqvl_value = d_numeric_eqvl_value * (atof(rl_tst_numeric_result.arr));

	  EXEC SQL SELECT to_char(:d_numeric_eqvl_value)
	           INTO   :rl_tst_numeric_result
			   FROM DUAL;

//	  strcpy(rl_tst_numeric_result.arr,_fcvt(d_numeric_eqvl_value));

   	  rl_tst_numeric_result.arr[rl_tst_numeric_result.len]	= '\0';


	  d_numeric_length = 0;
	  d_dec_pos		   = 0;

	  EXEC SQL SELECT length(:rl_tst_numeric_result), instr(:rl_tst_numeric_result,'.')
	             INTO :d_numeric_length, :d_decimal_pos
				 FROM DUAL;

      if ( (d_numeric_length > 10) && (d_dec_pos == 0) )
         strcpy(rl_tst_numeric_result.arr,">999999999");

	  rl_tst_numeric_result.arr[rl_tst_numeric_result.len]	= '\0';


      strcpy(rl_tst_cd_test_units.arr,d_eqvl_test_units.arr);    

	  if ( rl_tst_ran_low_val_nor.len  || rl_tst_ran_high_val_nor.len )
      {
		d_low_val_nor_eqvl_value = d_numeric_eqvl_value2 * (atof(rl_tst_ran_low_val_nor.arr));
		d_high_val_nor_eqvl_value = d_numeric_eqvl_value2 * (atof(rl_tst_ran_high_val_nor.arr));
//		strcpy(rl_tst_ran_low_val_nor.arr,d_low_val_nor_eqvl_value);
	  EXEC SQL SELECT to_char(:d_low_val_nor_eqvl_value)
	           INTO   :rl_tst_ran_low_val_nor
			   FROM DUAL;
//		strcpy(rl_tst_ran_high_val_nor.arr,d_high_val_nor_eqvl_value);
	  EXEC SQL SELECT to_char(:d_high_val_nor_eqvl_value)
	           INTO   :rl_tst_ran_high_val_nor
			   FROM DUAL;
	  }

	}

}
/*------------------------------------------------------------*/

get_mail_body_oth_dtls()  
{   

   d_mail_subject.arr[0]		= '\0';      
   d_mail_subject.len			= 0;
   d_mail_salutation.arr[0]		= '\0';      
   d_mail_salutation.len		= 0;
   d_mail_body.arr[0]			= '\0';      
   d_mail_body.len				= 0;
   d_mail_footer.arr[0]			= '\0';      
   d_mail_footer.len			= 0;

					 EXEC SQL EXECUTE  
						begin
							RL_MAIL_FORMAT.GENERATE_FORMAT('RLRRSENQ',
														:nd_operating_facility_id,
														:rl_prn_ctrl_hdr_sp_no,
														'M',
														:d_mail_subject,
														:d_mail_salutation,
														:d_mail_body,
														:d_mail_footer
													  );
						end;
					 END-EXEC;

					 d_mail_subject.arr[d_mail_subject.len]		  = '\0';
					 d_mail_salutation.arr[d_mail_salutation.len] = '\0';
					 d_mail_body.arr[d_mail_body.len]			  = '\0';
					 d_mail_footer.arr[d_mail_footer.len]		  = '\0';
}

/*------------------------------------------------------------*/
///// added on 10.04.2006
get_operational_flags()
{
 
	VCbdoperationalYN.arr[0] = '\0';
	VCbdoperationalYN.len = 0;
	strcpy(VCbdoperationalYN.arr,"N");

	VCbtoperationalYN.arr[0] = '\0';
	VCbtoperationalYN.len = 0;
	strcpy(VCbtoperationalYN.arr,"N");

	EXEC SQL EXECUTE 
	BEGIN 
		GET_OPERATIONAL_MODULES(:nd_operating_facility_id, :VCoperational_modules);
	    IF INSTR(:VCoperational_modules, 'BD') > 0 THEN
			:VCbdoperationalYN := 'Y';
		END IF;
		IF INSTR(:VCoperational_modules, 'BT') > 0 THEN
			:VCbtoperationalYN := 'Y';
		END IF;

	END ;
	END-EXEC ;
	VCbdoperationalYN.len = strlen(VCbdoperationalYN.arr);
	VCbtoperationalYN.len = strlen(VCbtoperationalYN.arr);
			
}
/*------------------------------------------------------------*/
///// added on 10.04.2006
get_screen_donor_id() 
{

   d_screen_donor_id.arr[0]		= '\0';      
   d_screen_donor_id.len		= 0;
	
   if(strcmp(VCbdoperationalYN.arr,"Y") == 0)
   {
	   EXEC SQL SELECT  screen_donor_id
				  INTO :d_screen_donor_id
		  		  FROM BD_PARAM;

		if (NODATAFOUND);    
		if (OERROR);    

		d_screen_donor_id.arr[d_screen_donor_id.len]	= '\0';
	}

}
/*------------------------------------------------------------*/
///// added on 10.04.2006
get_screen_patient_id() 
{

   d_screen_patient_id.arr[0]		= '\0';      
   d_screen_patient_id.len		= 0;
	
   if(strcmp(VCbtoperationalYN.arr,"Y") == 0)
   {
	   EXEC SQL SELECT  screen_patient_id
				  INTO :d_screen_patient_id
		  		  FROM BT_PARAM;

		if (NODATAFOUND);    
		if (OERROR);    

		d_screen_patient_id.arr[d_screen_patient_id.len]	= '\0';
	}
}
/*------------------------------------------------------------*/
/*-----------------------------------------------------*/
print_culture_format4()
{

    char temp_sens_ind;
    char temp_line[81];
	char org[MAX_ORGANISMS][5];
    int still_org_dtl_left;
    int print_anti_flag = 0;
    int change_flag = 0;
	int e = 0;
    int anti_flag = 0;
    int c = 0, s = 0;
	int no_of_organisms = 0;
    int oflag = 1;
	int match_found = 0;


    open_result_organism();
	_flushall();
    while(fetch_result_org())
    {
        something_to_print = 1;
		something_to_print_for_test = 1;

		strcpy(org[no_of_organisms],rl_res_organism_code.arr);
	    no_of_organisms++;

		if(group && !group_printed) 
		{
			print_group_test_desc();
			group_printed = 1;
		}
		if(!test_printed)
		{
			sprintf(text_line,"%-40.40s",test_description);
			print_line(text_line);
			test_printed = 1;
		}

		if(oflag)
		{
		   	fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/

                        //sprintf(text_line,"%-46.46s%-41.41s","ORGANISM","COMMENT");
						sprintf(text_line,"%-46.46s%-41.41s", local_legend[29], local_legend[30]);// added for globalisation
			print_line_org_ant(text_line);

		   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

			oflag = 0;
		}

		fetch_org_desc();

		sprintf(text_line,"%-6.6s%-40.40s%-34.34s",rl_res_organism_code.arr,
							rl_res_organism_code_desc.arr,rl_res_comment_desc.arr);
							
/**************** KDAH-CRF-260 The result comment code selection is added ************/
		 if (bold_print_for_org == 1)
		 {
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s4B",ESC);
		 }

		print_line_org_ant(text_line);

/**************** KDAH-CRF-260 The result comment code selection is added ************/
		if (bold_print_for_org == 1)
		{
			fprintf(fp,"%c&k4S",ESC); 
			fprintf(fp,"%c(s-3B",ESC); 		   		    

		}
		org_yn = 1;

	    fprintf(fp,"\n");
		page_break(1); 
		
		open_sensitivity_format4();
		 

		a_flag = 0;   
		antb_yn = 0;  
        b_flag = 1;
		while(fetch_sensitivity_format4())
		{
			if ((! a_flag) && (b_flag))
			{
               
				if ((lctr + 4)> MAX_LINES) //// 17.12.2003
				{
					for (i=lctr;i<=MAX_LINES;i++) 
					   fprintf(fp,"\n");

					page_break(4);  
				}
				//sprintf(text_line,"%-46.46s %s","ANTIBIOTIC ","SENSITIVITY");
				
				get_kb_mic_legend(no_of_organisms, 'C');
				
				sprintf(text_line,"%-46.46s %-13.13s     %s",local_legend[31], local_legend[32], l_kb_mic_legend);//added for globalisation

				fprintf(fp,"%c&k4S",ESC); 
   				fprintf(fp,"%c(s4B",ESC);

				print_line_org_ant(text_line);

				fprintf(fp,"%c&k4S",ESC); 
   				fprintf(fp,"%c(s-3B",ESC);   

				b_flag = 0;
			}

			if(a_flag)
			{
				//sprintf(text_line,"%-46.46s %s","ANTIBIOTIC ","SENSITIVITY");
				sprintf(text_line,"%-46.46s %-13.13s     %s",local_legend[31], local_legend[32], local_legend[76]);//added for globalisation

				fprintf(fp,"%c&k4S",ESC); 
   				fprintf(fp,"%c(s4B",ESC);

				print_line_org_ant(text_line);

				fprintf(fp,"%c&k4S",ESC); 
   				fprintf(fp,"%c(s-3B",ESC);   

				a_flag = 0; 
			}		
		
			strcpy(rl_res_dtl_antibiotic_code.arr,b_antibiotic_code.arr);
			rl_res_dtl_antibiotic_code.len = strlen(b_antibiotic_code.arr);
			fetch_antibiotic_desc();
        /***************************************************       
		    if (strcmp(rl_mic_to_print_yn.arr,"Y")==0) 
			 {

					if (strlen(b_mic_value.arr) > 0)
					{
						sprintf(text_line,"%-47.47s %-13.13s %-5.5s",rl_res_dtl_antibiotic_desc.arr,
													b_sensitivity_ind.arr,b_mic_value.arr);
					}
					else if (strlen(b_zone_value.arr) > 0)
					{
						sprintf(text_line,"%-47.47s %-13.13s %-5.5s",rl_res_dtl_antibiotic_desc.arr,
													b_sensitivity_ind.arr,b_zone_value.arr);

					}
					else
					{
						sprintf(text_line,"%-47.47s %-13.13s %-5.5s",rl_res_dtl_antibiotic_desc.arr,
													b_sensitivity_ind.arr," ");

					}
             } 
		******************************************************/
				


//sprintf(string_var, "%s    %s ", b_mic_value.arr, b_mic_print_yn.arr);
//disp_message(ERR_MESG, string_var);


			if (strlen(b_mic_value.arr) > 0 && (strcmp(b_mic_print_yn.arr,"Y")==0) ) 
			{
				  if (strcmp(rl_print_mic_sign_yn.arr,"N")==0)
				  {
					b_mic_sign.arr[0] = '\0';
					b_mic_sign.len    = 0;
				  }
				sprintf(text_line,"%-47.47s %-13.13s %-4.4s %-9.9s",rl_res_dtl_antibiotic_desc.arr,
															b_sensitivity_ind.arr,b_mic_sign.arr,b_mic_value.arr);

			}
			else
			{
				sprintf(text_line,"%-47.47s %s",rl_res_dtl_antibiotic_desc.arr,b_sensitivity_ind.arr);
            }  
			print_line_org_ant(text_line);

			antb_yn = 1;  /// 18.12.2003
		
		}   /// while(fetch_sensitivity_format4())

		antb_yn = 0;  /// 18.12.2003
		close_sensitivity_cur_format4();

	    fprintf(fp,"\n");
		page_break(1);    


	}  //// while(fetch_result_org())

	antb_yn = 0;  /// 18.12.2003

	if(no_of_organisms)
	{
		//sprintf(text_line,"%-35.35s%-52.52s"," ","S - Sensitive     R - Resistant   I - Intermediate");

			strcpy(string_var, " ");
			sprintf(string_var, "%s     %s     %s", local_legend[17],local_legend[18],local_legend[19]);

		sprintf(text_line,"%-33.33s%-52.52s"," ", string_var); //added for globalisation

//		sprintf(text_line,"%-5.5s%-78.78s"," ","S - Sensitive    R - Resistant  I - Intermediate  N - Negative  P - Positive");
		print_line_org_ant(text_line);
	   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	}
	close_organism_cur();
   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
    org_yn = 0;  

}



/*-----------------------------------------------------*/


print_culture_format5() 
{

    char temp_sens_ind;
    char temp_line[81];
	char org[MAX_ORGANISMS][5];
    int still_org_dtl_left;
    int print_anti_flag = 0;
    int change_flag = 0;
	int e = 0;
    int anti_flag = 0;
    int c = 0, s = 0, c1 = 0, c2 = 0, c3 = 0;
	int no_of_organisms = 0;
    int oflag = 1;
	int match_found = 0;


    open_result_organism();
	_flushall();
    while(fetch_result_org())
    {
        something_to_print = 1;
		something_to_print_for_test = 1;

		strcpy(org[no_of_organisms],rl_res_organism_code.arr);
	    no_of_organisms++;

		if(group && !group_printed) 
		{
			print_group_test_desc();
			group_printed = 1;
		}
		if(!test_printed)
		{
			sprintf(text_line,"%-40.40s",test_description);
			print_line(text_line);
			test_printed = 1;
		}

		if(oflag)
		{
		   	fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/

                        //sprintf(text_line,"%-46.46s%-41.41s","ORGANISM","COMMENT");
						sprintf(text_line,"%-46.46s%-41.41s", local_legend[29], local_legend[30]);// added for globalisation
			print_line_org_ant(text_line);

		   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

			oflag = 0;
		}

		fetch_org_desc();

		sprintf(text_line,"%-6.6s%-40.40s%-34.34s",rl_res_organism_code.arr,
							rl_res_organism_code_desc.arr,rl_res_comment_desc.arr);

		print_line_org_ant(text_line);
	} 

	close_organism_cur();

	_flushall();

	if(no_of_organisms)
	{
		something_to_print = 1;
		something_to_print_for_test = 1;

	    open_sensitivity();
	    fetch_sensitivity();

        c2 = 0;
		while(c2<=no_of_organisms)
		{

				t_antib_head_first_time = 0;

				if (t_antib_head_first_time == 0) 
				{
				    if(lctr +4 > MAX_LINES)
					  page_break(1);

   					fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
					sprintf(text_line,"");
					for(c=0;c<87;c++)
						sprintf(text_line,"%s%s",text_line," ");
					print_line_org_ant(text_line);
   					fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

					//sprintf(text_line,"%-46.46s","ANTIBIOTIC ");
					sprintf(text_line,"%-46.46s", local_legend[31]); //added for globalisation
					
					//// for(c1=c2;c1<no_of_organisms;c1++)	/* Print organism codes as column headings*/
					////	sprintf(text_line,"%s%-5.5s",text_line,org[c1]);
					c1 = c2;
					org1= 1;

					rl_res_organism_code1.arr[0] = '\0'; 
					rl_res_organism_code1.len    = 0;
					rl_res_organism_code2.arr[0] = '\0'; 
					rl_res_organism_code2.len    = 0;

					while(c1< (c2+2)  && c1 <= no_of_organisms)
					{
						 rl_res_organism_code.arr[0] = '\0'; 
						 rl_res_organism_code.len    = 0;
						 strcpy(rl_res_organism_code.arr,org[c1]);
					//	 sprintf(rl_res_organism_code.arr,"%s",org[c1]);
						 rl_res_organism_code.len = strlen(rl_res_organism_code.arr);
						 rl_res_organism_code.arr[rl_res_organism_code.len] = '\0';

						 if(org1<3)
						 {
							strcpy(rl_res_organism_code1.arr,rl_res_organism_code.arr);
						
						 }
						 else
						 {
							strcpy(rl_res_organism_code2.arr,rl_res_organism_code.arr);

						 }
						 
						 fetch_org_desc();			 
 						 ///sprintf(text_line,"%s%-5.5s",text_line,org[c1]);

						 sprintf(text_line,"%s%-16.16s",text_line,rl_res_organism_code_s_desc.arr);
						 c1++;
						 org1=10;
					}

					rl_res_organism_code1.len = strlen(rl_res_organism_code1.arr);
					rl_res_organism_code1.arr[rl_res_organism_code1.len] = '\0';
					rl_res_organism_code2.len = strlen(rl_res_organism_code2.arr);
					rl_res_organism_code2.arr[rl_res_organism_code2.len] = '\0';

					print_line_org_ant(text_line);

   					fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
					sprintf(text_line,"");
					for(c=0;c<87;c++)
						sprintf(text_line,"%s%s",text_line," ");
					print_line_org_ant(text_line);
	   				fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

					t_antib_head_first_time = 1;
				}  
				open_antibiotic_format5();

				_flushall();
				while(fetch_antibiotic_fmt5())
				{
						something_to_print = 1;
						something_to_print_for_test = 1;
						strcpy(rl_res_dtl_antibiotic_code.arr,a_antibiotic_code.arr);
						rl_res_dtl_antibiotic_code.len = strlen(a_antibiotic_code.arr);
						fetch_antibiotic_desc();
						sprintf(text_line,"%-47.47s",rl_res_dtl_antibiotic_desc.arr);

						get_kb_mic_legend(no_of_organisms, 'L');
						sprintf(text_line1,"%-47.47s", l_kb_mic_legend);

						e = c2;
						while(e < (c2 +2) && e <= no_of_organisms)
						///for(e=0;e<no_of_organisms;e++)
						{
							match_found = 0;
							for(s=0; s<no_of_sensitivities; s++)
							{
								if( (strcmp(s_ant[s].arr, a_antibiotic_code.arr) == 0) &&
									(strcmp(s_org[s].arr, org[e]) == 0) )
								{
									 sprintf(text_line,"%s%-16.16s",text_line,s_ind[s].arr);

									 if (strlen(s_mic[s].arr) > 0)
									 {
										 sprintf(text_line1,"%s%-9.9s%-11.11s",text_line1,s_mic[s].arr, " ");
										 
									 }
									 else if (strlen(s_zone[s].arr) > 0)
									 {
										sprintf(text_line1,"%s%-5.5s%-11.11s",text_line1,s_zone[s].arr, " ");
									 }
									 else
									 {
										sprintf(text_line1,"%s%-16.16s",text_line1," ");
									 }


									match_found = 1;
									break;
								}
							}

							if(match_found == 0)
							{
								sprintf(text_line, "%s                ",text_line);
								sprintf(text_line1,"%s                ",text_line1);
							}
						e++;
						}
						sprintf(text_line,"%-87.87s",text_line);			
						sprintf(text_line1,"%-87.87s",text_line1);	

						print_line_org_ant(text_line);

						if ( (strcmp(rl_mic_to_print_yn.arr,"Y")==0) && mic_count > 0)
						{
							print_line_org_ant(text_line1);
						}

				}  //// while(fetch_antibiotic())

			close_antibiotic_cur_fmt5();
			c2+=2;
			fprintf(fp,"\n");
			page_break(1); 
		}  //// while(c2<no_of_organisms)

		if (t_antib_head_first_time == 1)	
		{
			//sprintf(text_line,"%-35.35s%-52.52s"," ","S - Sensitive     R - Resistant   I - Intermediate");

			strcpy(string_var, " ");
			sprintf(string_var, "%s     %s     %s", local_legend[17],local_legend[18],local_legend[19]);

			sprintf(text_line,"%-33.33s%-52.52s"," ", string_var); //added for globalisation

			print_line_org_ant(text_line);

			for(i=0; i < 87; i++)
					fprintf(fp,"%c",'_');

			fprintf(fp,"\n");
			page_break(1);
		}


	   	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */

	}
	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
}
/*-----------------------------------------------------*/
//// 28.09.2006 added 
get_user_conf_access_yn()
{
	nd_user_conf_access_yn.arr[0]	= '\0';
	nd_user_conf_access_yn.len		= 0;

   strcpy(nd_user_conf_access_yn.arr,"N");
   nd_user_conf_access_yn.len = strlen(nd_user_conf_access_yn.arr);

   
   EXEC SQL SELECT NVL(VIEW_CONFIDENTIAL_YN,'N') 
			  INTO :nd_user_conf_access_yn
		      FROM RL_USER_DEPT_VIEW_RESULTS
             WHERE USER_ID = :sy_user_id
--             WHERE USER_ID = USER
		       AND OPERATING_FACILITY_ID = :nd_operating_facility_id
			   AND SECTION_CODE = :rl_hdr_section_code;


    if(OERROR);

	if (NODATAFOUND);

	nd_user_conf_access_yn.arr[nd_user_conf_access_yn.len]	= '\0';
	nd_user_conf_access_yn.arr[nd_user_conf_access_yn.len]	= '\0';

}
/*------------------------------------------------------------*/
//// added on 31.10.2006  
get_perform_site_desc()
{
	nd_perform_site_desc.arr[0]	= '\0';
	nd_perform_site_desc.len		= 0;

   EXEC SQL SELECT long_desc
			  INTO :nd_perform_site_desc
		      FROM RL_SITES_LANG_VW
             WHERE FACILITY_ID = :nd_operating_facility_id
			   AND SITE_CODE   = :rl_perform_site_code
			   AND LANGUAGE_ID = :language_id;


    if(OERROR);

	if (NODATAFOUND);

	nd_perform_site_desc.arr[nd_perform_site_desc.len]	= '\0';
	
}
/*------------------------------------------------------------*/
//// added on 31.10.2006  
get_anatomy_site_desc()
{
	nd_anatomy_site_desc.arr[0]	= '\0';
	nd_anatomy_site_desc.len		= 0;

   EXEC SQL SELECT long_desc
			  INTO :nd_anatomy_site_desc
		      FROM RL_ANATOMY_SITE_CODE_LANG_VW
             WHERE ANATOMY_SITE_CODE   = :nd_anatomy_site
			 AND LANGUAGE_ID = :language_id;


    if(OERROR);

	if (NODATAFOUND);

	nd_anatomy_site_desc.arr[nd_anatomy_site_desc.len]	= '\0';
	
}
/*------------------------------------------------------------*/
//// added on 31.10.2006  
get_anatomy_site()
{
	nd_anatomy_site.arr[0]	= '\0';
	nd_anatomy_site.len		= 0;

	   EXEC SQL SELECT anatomy_site_code
				  INTO :nd_anatomy_site
				  FROM RL_SAMPLE_DETAILS
				 WHERE SPECIMEN_NO     = :nd_spec_no
				   AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				   AND ANATOMY_SITE_CODE IS NOT NULL
				   AND ROWNUM =1;

	if (NODATAFOUND)
	{

	   EXEC SQL SELECT anatomy_site_code
				  INTO :nd_anatomy_site
				  FROM RL_SPECIMEN_ANATOMY_DTLS
				 WHERE SPECIMEN_NO     = :nd_spec_no
				   AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				   AND ANATOMY_SITE_CODE IS NOT NULL
				   AND ROWNUM =1;

	}

	if (NODATAFOUND);

    if(OERROR);

	nd_anatomy_site.arr[nd_anatomy_site.len]	= '\0';
	
}
/*------------------------------------------------------------*/
convert_dates_to_local_lang()
{
    if(rl_order_id.len)
	{
	      get_order_date_time();

	            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:nd_order_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:nd_order_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:nd_order_date_time1 :=sm_convert_datetime_2t(to_date(:nd_order_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;
	  
    }

	/*******************            *****/
            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_recd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_recd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_recd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_recd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_colltd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_colltd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_colltd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_colltd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_released_date,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_released_date1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_released_date1 :=sm_convert_datetime_2t(to_date(:rl_hdr_released_date,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

}
/**********************************************************************************/
write_to_file()

{
   l_debug_yn.arr[0]		    = '\0';
   l_debug_yn.len            = 0;

   getValueInFile("DEBUG",temp1);
   strcpy(l_debug_yn.arr,temp1);

  l_debug_yn.arr[1] = '\0';

  if (strcmp(l_debug_yn.arr,"Y")==0)
    {
	  fp1=fopen(l_file_name,"a+");
      fprintf(fp1,l_text.arr);
      fprintf(fp1,"\n");	  
	  fclose(fp1);

    }
}

/********************** added for globalisation ***********************************/
get_legend_value(int cou)
 {
	EXEC SQL EXECUTE
	BEGIN
	  SM_POPULATE_REPORT_LEGEND.FETCH_LEGEND (:nd_facility_id,:language_id,'RLRSENQ1.LEGEND_');
	END;
	END-EXEC;

	for (i=1; i<=cou; i++)
	{
		l_translated_value.arr[0]		= '\0';
		EXEC SQL EXECUTE
		BEGIN
               :l_translated_value :=    GET_LEGEND(LTRIM(RTRIM('RLRSENQ1.LEGEND_'||LTRIM(RTRIM(TO_CHAR(:i,'009'))))));
		END;
		END-EXEC;
	
		l_translated_value.arr[l_translated_value.len] = '\0';
		//sp_message(ERR_MESG,l_translated_value.arr);
		strcpy(local_legend[i],l_translated_value.arr);
		
		//disp_message(ERR_MESG,local_legend[i]);
	}
 }
/********************** added for globalisation ***********************************/


check_mic_value_present_for_test()
{
	
	mic_count = 0;

	EXEC SQL 

              SELECT COUNT(1)
                 INTO mic_count
                FROM RL_RESULT_ORGANISM_DTL
               WHERE PATIENT_ID      = :nd_hosp_no
                 AND SPECIMEN_NO     = :nd_spec_no
                 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
				 AND GROUP_TEST_CODE = :rl_tst_group_test_code
                 AND TEST_CODE       = :rl_tst_test_code
				 AND ORGANISM_CODE   = :rl_res_organism_code
                 AND REPORT_YN       = 'Y'
				 AND SENSITIVITY_IND IN('S','R','I')
				 AND (mic_result IS NOT NULL);
/////					OR zone_size IS NOT NULL);   ////modified against bru-hims-crf-0050

		if(OERROR);               
}

/********************** added for check_mic_value_present_for_test*******************/

get_kb_mic_legend(int l_no_of_organisms, char l_char)
{

	int fe = 0, fs = 0;



		strcpy(l_kb_mic_legend, " ");

		if (l_char == 'L')
		{
			for(fe=0; fe < l_no_of_organisms; fe++)
			{

				for(fs = 0; fs < l_no_of_organisms; fs++)
				{

						if (strlen(s_mic[fs].arr) > 0)
						 {
						   if (strcmp(s_mic_print_yn[fs].arr,"Y")==0)
						   {
							 strcpy(l_kb_mic_legend, local_legend[76]);
							 break;
						   }
							 
						 }
		/**************** ---COMMENTED ON 03.12.2012 against bru-hims-crf-0050.
						 else if (strlen(s_zone[fs].arr) > 0)
						 {
							strcpy(l_kb_mic_legend, local_legend[77]);
							break;
						 }
		*********************/	


				}


			}
		}
		else
		{

		    check_mic_value_present_for_test();  //////////added against bru-hims-crf-0050.

	////		if (strcmp(rl_mic_to_print_yn.arr,"Y")==0) 
			if (mic_count > 0) 
			{

				strcpy(l_kb_mic_legend, local_legend[76]);

	/*******************

				if (strlen(b_mic_value.arr) > 0)
				{
							 strcpy(l_kb_mic_legend, local_legend[76]);
				}
				else if (strlen(b_zone_value.arr) > 0)
				{
							 strcpy(l_kb_mic_legend, local_legend[77]);

				}
	*************************/
			}
			else
			{
				strcpy(l_kb_mic_legend," ");
			}

		}

}
/********************** added for check_mic_value_present_for_test*******************/


/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
print_header_amri1()
{

    char t_patient_id[16];
    
    char sex_desc[11];
    char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
    int page_col = 0;
	char l_age_legend[5];

    pctr++;
    
    get_parameters();
	lctr = 0;



/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/

	 fprintf(fp,"\n\n");
	 lctr+=2;

/*---------*/
/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 

/*-------- upto here on 21.10.2004 -----*/

    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/
    if (rl_lab_title.len) 
	{
       fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title.len)/2) - 6)," ",rl_lab_title.arr);
	   lctr+=2;
	}
    if (rl_lab_title_2.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_2.len)/2) - 6)," ",rl_lab_title_2.arr);
	   lctr+=2;
	}
    if (rl_lab_title_3.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_3.len)/2) - 6)," ",rl_lab_title_3.arr);
	   lctr+=2;
	}
    if (rl_lab_title_4.len)
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_4.len)/2) - 6)," ",rl_lab_title_4.arr);
	   lctr+=2;
	}
    if (rl_lab_title_5.len)  
	{
	   fprintf(fp,"%-*s%-.80s\n",(int)(((80 - rl_lab_title_5.len)/2) - 6)," ",rl_lab_title_5.arr);
	   lctr+=2;
	}

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

    rl_lab_title_6.arr[0] = '\0';
    rl_lab_title_6.len = 0;
	strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);


// font size changed to 14 to print the department in higher font
	fprintf(fp,"%c&k14S",ESC);	/* This makes the font size to increase to 12 */

    if (rl_lab_title_6.len)
	{
		
	   fprintf(fp,"\n%-*s%-.80s",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);

	}

	page_col = (int) (38 - (rl_lab_title_6.len/2));
	page_col = page_col - 16;

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
//    fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
	fprintf(fp,"%-*sPage(s):%3d\n", page_col," ",pctr);
    lctr+=3;




// font size again changed back to 12 to print the department in higher font
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;    
		//fprintf(fp, "Draft Copy\n"); 
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}

	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);
	}
	

	/*** NEWLY ADDED ON 28/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO 
			BEFORE the detail portion of heading******/
	if(rl_hdr_episode_type.arr[0] != 'R')
		print_hmc_no();


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;
	
	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp,"%-13.13s: ", local_legend[6]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-30.30s            ", rl_pat_short_name.arr);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-3.3s: ", local_legend[41]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s ", l_age_legend);

	patient_age();

	fprintf(fp, "%s\n", t_age.arr);
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient  ID  : ");
    fprintf(fp,"%-13.13s: ", local_legend[26]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	   fetch_mp_ext_per_nric();  ///// 03.07.2005 

       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-15.15s                      ", t_patient_id);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	   //fprintf(fp, "Sex/Race: ");
	   fprintf(fp, "%-8.8s: ",local_legend[42] );//added for globalisation
    else
       //fprintf(fp, "     Sex: ");
	   fprintf(fp, "%8.8s: ",local_legend[7] );//added for globalisation

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
			//strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			//strcpy(sex_desc,"Unknown");
			strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp,"%s", sex_desc);

    if (strcmp(rl_race_accepted_yn.arr,"Y") == 0)
	{
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		get_race_desc();
		fprintf(fp, "%-15.15s", d_race_desc.arr);
	}

    fprintf(fp, "\n");
	page_break(1);

/********** added on 13.02.2005 *************/

/*********** NRIC and Nationality is not required ***********************
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "NRIC/Alt.IdNo: ");
    fprintf(fp,"%-13.13s: ", local_legend[55]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if (rl_national_id_num.len)
	   //fprintf(fp, "%s", rl_national_id_num.arr);  against scf ML-SD-SCF-1749
         fprintf(fp, "%-30.30s", rl_national_id_num.arr); 
	else
       fprintf(fp, "%-30.30s", rl_alternate_id_num.arr);


/////////////////  11.04.2005
    get_nationality_desc();	
	fprintf(fp,"%-8.8s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
	page_break(1);
/////////////////
*********** commented upto here NRIC and Nationality is not required ***********************

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
    fprintf(fp,"%-13.13s: ", local_legend[8]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s", rl_source_short_name.arr);

	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	    fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "/");
		fprintf(fp,"%c&k4S",ESC); 
   		fprintf(fp,"%c(s-3B",ESC);   

		fprintf(fp, "%-20.20s\n", rl_location.arr);
		page_break(1);
	}
	else
	{
		fprintf(fp, "\n");
		page_break(1);
	}


	/*** NEWLY ADDED ON 26/08/2003 TO PRINT THE HMC NO FOR THE MEDICOM NO ******/
//	if(rl_hdr_episode_type.arr[0] != 'R')
//		print_hmc_no();


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);

/************** 11.04.2005
/////////////////  12.07.2004
	fprintf(fp,"%-8.8s"," ");
    get_nationality_desc();	
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Nationality: ");
	fprintf(fp, "%-11.11s: ",local_legend[45]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-15.15s\n", nd_nationality_desc.arr);
	page_break(1);
/////////////////
**************************/

//////// 11.04.2005

	fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Ordered   : ");
	fprintf(fp,"%-10.10s: ", local_legend[56]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_order_id.len)
	{
	  fprintf(fp, "%-16.16s\n", nd_order_date_time1.arr);//added for globalisation
    }
	else
	  fprintf(fp, "\n");

//////////// 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[16]); //added for globalisation
// 12.07.2004	fprintf(fp,"%c&k4S",ESC); 
// 12.07.2004  	fprintf(fp,"%c(s-3B",ESC);   

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "    ");
	}

	fprintf(fp, "%-17.17s                ", l_str);

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

//// added the below on  11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
////////  upto here added on 11.04.2005

	page_break(1);
	
// earlier specimen type was printing which has been moved after category, hence 39 spaces are printing	
	fprintf(fp,"%-48.48s", " ");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Recd  Date: ");
	//fprintf(fp, "Received  : ");
    fprintf(fp,"%-10.10s: ", local_legend[59]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Category No  : ");
    fprintf(fp,"%-13.13s: ", local_legend[48]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%-4.4s/%-4.4s/%-15.15s        ", rl_category_code.arr, rl_category_year.arr,
								rl_category_number.arr);


//////// added the below on 11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				//GET_LOCALE_DATE.CONVERT_TO_LOCALE_DATE (to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'), :language_id , t_date);
				//:rl_hdr_spec_regd_date_time1 := to_char(t_date,'DD/MM/YYYY HH24:MI');
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr); //added for globalisation

//////////// upto here added on 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
      fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	fprintf(fp, "\n");
	page_break(1);

/// 31.10.2006 added the below 

		if (strcmp(rl_use_sample_anatomy_ind.arr, "SA") == 0 ||
				strcmp(rl_use_sample_anatomy_ind.arr, "AT") == 0)
		{
	  	 get_anatomy_site();
		 get_anatomy_site_desc();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Anatomy Site : ");
	     fprintf(fp,"%-13.13s: ", local_legend[60]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",nd_anatomy_site_desc.arr);
  		 page_break(1);
		}

///



    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Clinical     : ");
    fprintf(fp,"%-13.13s: ", local_legend[50]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	   
	if (rl_hdr_request_comment_desc1.len)
    {
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc1.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s4B",ESC);
	 //fprintf(fp, "Comment        ");
     fprintf(fp,"%-15.15s ", local_legend[51]); //added for globalisation
	 fprintf(fp,"%c&k4S",ESC); 
   	 fprintf(fp,"%c(s-3B",ESC);

	if (rl_hdr_request_comment_desc2.len)
    {

      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc2.arr);
      page_break(1);
    }
	else
    {
      fprintf(fp,"\n");
      page_break(1);
    }

    
	if (rl_hdr_request_comment_desc3.len)
    {
	  fprintf(fp, "               ");
      fprintf(fp,"%-40.40s\n",rl_hdr_request_comment_desc3.arr);
      page_break(1);
    }

/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///


	if (strcmp(rl_test_requested_yn.arr, "Y") == 0)
	{

		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordered Tests: ");
		 fprintf(fp,"%-13.13s: ", local_legend[53]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);
		
		strcpy(l_str, "");

		for (i=0;i < no_of_dtl_recs;i++)
		{
			d_inhibit_yn.arr[0]		= '\0';
			d_inhibit_yn.len		= 0;

			strcpy(inhibit_test_code.arr, rl_dtl_test_code[i].arr);
			inhibit_test_code.len = strlen(inhibit_test_code.arr);

			chk_inhibit_yn();

			if (d_inhibit_yn.arr[0]	== 'N') 
			{
				if (i == 0)
					sprintf(l_str,"%s", rl_dtl_test_code[i].arr);
				else
					sprintf(l_str,"%s,%s",l_str, rl_dtl_test_code[i].arr);
			}

//11.04.2005   if (i > 15) 

			if (i > 5) 
				break;
		}

		if(no_of_dtl_recs > 7)
		  sprintf(l_str,"%s...",l_str);

		fprintf(fp,"%s\n",l_str);
		page_break(1);
	}


	if(rl_hdr_episode_type.arr[0] == 'R')
	{
		if (strlen(rl_message_line.arr) > 0)
		{
			fprintf(fp, "%70.70s ", rl_message_line.arr);
			fprintf(fp, "%-15.15s\n", nd_hosp_no.arr);
			page_break(1);

		}
	}

    fprintf(fp,"%c&k4S",ESC);  
    fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);


	fprintf(fp, "\n"); 
	page_break(1);
	
	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {

	 print_result_titles(); /// created this procedure to maintain the below common code

/******************************************************************************
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON *
		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *

		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_range_ind.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s", rl_title_for_range_ind.arr);
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(5-rl_title_for_range_ind.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-4.4s", " ");

     if(rl_title_for_result_range.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   //* Set  UnderLine ON*
		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
        fprintf(fp,"%c&d@",ESC);   //* Set UnderLine OFF *
		for(i=0;i<(14-rl_title_for_result_range.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-15.15s", " ");



	fprintf(fp, "\n");
	page_break(1);
**************************************************************************************/
	}
    
}


/***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ******/
print_header_amri()
{

    char t_patient_id[16];
    
    char sex_desc[11];
    char pat_name[300];
	char uline[82];
	char l_str[100];
    int i;
    int page_col = 0;
	char l_age_legend[5];

    pctr++;
    
    get_parameters();
	lctr = 0;



/*-------------------------- added on 21.10.2004 to skip 2 lines for site AH ------*/

/*---------*/
/*-------  added on 21.10.2004 to reset the printer setting before start printing ------*/
    fprintf(fp,"%cE",ESC); 



/*-------- upto here on 21.10.2004 -----*/

fprintf(fp,"\n\n");
	 lctr+=2;


    fprintf(fp,"%c&a006L",ESC); /* Set the left Margin */

	
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
	fprintf(fp,"%c&l6D",ESC);	/* Set the Density */
   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
/*---------*/
	    

	// New title has to be printed as the department name with hardcoded legend 'Department of' 27.07.2004

        rl_lab_title_6.arr[0] = '\0';
	rl_lab_title_6.len = 0;
	strcpy(rl_lab_title_6.arr, rl_section_short_name.arr);
	rl_lab_title_6.len = strlen(rl_lab_title_6.arr);


// font size changed to 14 to print the department in higher font
	fprintf(fp,"%c&k14S",ESC);	/* This makes the font size to increase to 12 */

    if (rl_lab_title_6.len)
	{
		
	   fprintf(fp,"\n%-*s%-.80s",(int)(((80 - rl_lab_title_6.len)/2) - 6)," ",rl_lab_title_6.arr);

	}

	page_col = (int) (38 - (rl_lab_title_6.len/2));
	page_col = page_col - 16;

/********* page no is required at right hand bottom of the page *****************
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
//      fprintf(fp,"%73.73sPage(s) : %3d\n"," ",pctr);
	fprintf(fp,"%-*sPage(s):%3d\n", page_col," ",pctr);
************************************************************/
	fprintf(fp, "\n");
        lctr+=3;

// font size again changed back to 12 to print the department in higher font
	fprintf(fp,"%c&k12S",ESC);	/* This makes the font size to increase to 12 */
/*----------------------------------------*/

/***** for draft copy legend *********/

	if (strcmp(draft_printing_yn.arr, "N") == 0)
		lctr = lctr;   /// 27.07.2004  lctr = 8;

	else
	{
	    lctr++;       /// 27.07.2004   lctr = 9;    
		//fprintf(fp, "Draft Copy\n"); 
		fprintf(fp, "%-10.10s\n", local_legend[71]); //added for globalisation
	}

	if(l_report_legend.len && strcmp(draft_printing_yn.arr, "N") == 0)  // 21.05.2005
	{
	    lctr++;       
		fprintf(fp, "%s\n",l_report_legend.arr);
	}
	


	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);

	lctr++;
	
	if (strcmp(rl_actual_dob_yn.arr, "Y") == 0)
		strcpy(l_age_legend, "");
	else
		strcpy(l_age_legend, "*");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient Name : ");
	fprintf(fp,"%-13.13s: ", local_legend[6]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

//	fprintf(fp, "%-30.30s            ", rl_pat_short_name.arr);
	fprintf(fp, "%-40.40s\n", rl_pat_short_name.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Patient  ID  : ");
    fprintf(fp,"%-13.13s: ", local_legend[26]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	if(rl_hdr_episode_type.arr[0] == 'R')
	{
	   fetch_mp_ext_per_nric();  ///// 03.07.2005 

       if(strcmp(rl_pat_actual_id.arr,"NULL")==0)
	 	   strcpy(t_patient_id,nd_hosp_no.arr);
	   else
		   strcpy(t_patient_id,rl_pat_actual_id.arr);
	}
    else
       strcpy(t_patient_id,nd_hosp_no.arr);

	fprintf(fp, "%-30.30s   ", t_patient_id);

//disp_message(ERR_MESG, local_legend[82]);

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Age: ");
	fprintf(fp, "%-10.10s: ", local_legend[82]);//Newly added for Age/Sex for AMRI
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

//	fprintf(fp, "%s ", l_age_legend);

	patient_age();

/******** sex is combined with Age ************
       //fprintf(fp, "Sex: ");
//	   fprintf(fp, "%-10.10s: ",local_legend[7] );//added for globalisation
*************************/

    if(rl_pat_sex.arr[0] == 'M')
	   //strcpy(sex_desc,"MALE");
		strcpy(sex_desc,local_legend[37]);//added for globalisation
	else
		if(rl_pat_sex.arr[0] == 'F')
			//strcpy(sex_desc,"FEMALE");
			strcpy(sex_desc,local_legend[38]);//added for globalisation
		else
			//strcpy(sex_desc,"Unknown");
			strcpy(sex_desc,local_legend[43]);//added for globalisation

	fprintf(fp, "%s / %s\n", t_age.arr, sex_desc);
	page_break(1);



    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Location     : ");
    fprintf(fp,"%-13.13s: ", local_legend[8]); //added for globaliation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp, "%s\n", rl_source_short_name.arr);
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Doctor       : ");
	fprintf(fp, "%-13.13s: ",local_legend[44]);//added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_ordering_doctor_name.len)    ///// added on 06.12.2004
	  strcpy(rl_consultant_short_name.arr,rl_ordering_doctor_name.arr);

	fprintf(fp,"%-30.30s",rl_consultant_short_name.arr);


//////// 11.04.2005

	fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Ordered   : ");
	fprintf(fp,"%-10.10s: ", local_legend[56]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

    if(rl_order_id.len)
	{
	  fprintf(fp, "%-16.16s\n", nd_order_date_time1.arr);//added for globalisation
    }
	else
	  fprintf(fp, "\n");

//////////// 11.04.2005
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen No  : ");
	
	// order id printing
    fprintf(fp,"%-13.13s: ", local_legend[78]); //added for globalisation

	fprintf(fp,"%c&k4S",ESC);  // 12.07.2004
  	fprintf(fp,"%c(s-3B",ESC); // 12.07.2004  

//-------- order id
	fprintf(fp, "%-17.17s                ", rl_order_id.arr);


//// added the below on  11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Collt Date: ");
	//fprintf(fp, "Collected : ");
    fprintf(fp,"%-10.10s: ", local_legend[58]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_colltd_date_time1.arr); //added for globalisation	
////////  upto here added on 11.04.2005

	page_break(1);
	
// earlier specimen type was printing which has been moved after category, hence 39 spaces are printing	
	fprintf(fp,"%-48.48s", " ");

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Recd  Date: ");
	//fprintf(fp, "Received  : ");
    fprintf(fp,"%-10.10s: ", local_legend[59]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_recd_date_time1.arr); //added for globalisation
	page_break(1);

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	fprintf(fp, "%-13.13s: ", local_legend[79]);

	if (d_interval_specimen_yn == 'Y')
	{
		strcpy(l_str, first_specimen_no.arr);
		strcat(l_str, " (I)");
	}
	else
	{
		strcpy(l_str, nd_spec_no.arr);
		strcat(l_str, "    ");
	}

	fprintf(fp, "%-17.17s                ", l_str);

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

//////// added the below on 11.04.2005

/************** Registered date is not required instead reported date is required *********
    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
//	fprintf(fp, "Regd  Date: ");
	//fprintf(fp, "Registered: ");
    fprintf(fp,"%-10.10s: ", local_legend[57]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

            EXEC SQL EXECUTE
				DECLARE
				t_date   date;
				BEGIN
				:rl_hdr_spec_regd_date_time1 :=sm_convert_datetime_2t(to_date(:rl_hdr_spec_regd_date_time,'DD/MM/YYYY HH24:MI'),:language_id);
				END;
			END-EXEC;

	//fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time.arr);
	fprintf(fp, "%-16.16s\n", rl_hdr_spec_regd_date_time1.arr); //added for globalisation
****************************************/


//////////// upto here added on 11.04.2005

    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Reported: ");
    fprintf(fp,"%-10.10s: ", local_legend[87]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	fprintf(fp, "%-16.16s\n", rl_hdr_released_date1.arr); 

	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	fprintf(fp,"%-13.13s: ", local_legend[80]); 

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);
	
	l_payer.arr[0]	= '\0';
	l_payer.len	= 0;

	if ( (strcmp(rl_bill_yn.arr, "Y") == 0) && ((strcmp(rl_hdr_episode_type.arr, "H") !=0) || 
		(strcmp(rl_hdr_episode_type.arr, "R") !=0) ) )
	{

		 EXEC SQL EXECUTE
			DECLARE
				pcust_pat_ind		VARCHAR2(50);
				pcust_pat_code		VARCHAR2(50);
				pcust_pat_name		VARCHAR2(500);
				p_error_text		VARCHAR2(1000);
				pmoduleid           VARCHAR2(6);
				pprimarykeymain     VARCHAR2(100);
			BEGIN
				
				pmoduleid := NULL;

				if length(:rl_order_id) > 0 then
				  --pmoduleid := 'OR';
				  pprimarykeymain := :rl_order_id;
				else
				  --pmoduleid := 'RL';
				  pprimarykeymain := :nd_spec_no;
				end if;

				rl_bl_get_payer(:rl_ordered_facility_id, pmoduleid, pprimarykeymain,
							pcust_pat_ind, pcust_pat_code, pcust_pat_name,
							p_error_text);
							
				if pcust_pat_ind = 'P' then
					pcust_pat_name := NULL;
				end if;

				:l_payer := pcust_pat_name;
			END;
		END-EXEC;

	}

	l_payer.arr[l_payer.len]	=	'\0';

	fprintf(fp, "%s\n", l_payer.arr);
	page_break(1);


    fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);


/// 12.07.2004 added the below 
		if (strcmp(rl_ordered_facility_id.arr,nd_operating_facility_id.arr) != 0)
		{
		 get_ordered_company_name();
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s4B",ESC);
		 //fprintf(fp, "Ordering Facility ID: ");
		 fprintf(fp,"%-20.20s: ", local_legend[52]); //added for globalisation
		 fprintf(fp,"%c&k4S",ESC); 
   		 fprintf(fp,"%c(s-3B",ESC);

		 fprintf(fp,"%s\n",sy_ord_acc_entity_name.arr);
  		 page_break(1);
		}
///


    fprintf(fp,"%c&k4S",ESC);  
    fprintf(fp,"%c(s4B",ESC);

    fprintf(fp,"%c&k4S",ESC); 
    fprintf(fp,"%c(s-3B",ESC);


	fprintf(fp, "\n\n\n"); 
	page_break(3);
	
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);
	//fprintf(fp, "Specimen Type: ");
	fprintf(fp,"%-13.13s: ", local_legend[13]); //added for globalisation
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	fprintf(fp,"%-39.39s",rl_spc_specimen_desc.arr);
	fprintf(fp, "\n\n");
	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   
	page_break(2);


	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	    fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	fprintf(fp,"%c(s-3B",ESC);
		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	    fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	fprintf(fp,"%c(s-3B",ESC);
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	    fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	fprintf(fp,"%c(s-3B",ESC);
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if(rl_title_for_range_ind.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	    fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "%s", rl_title_for_range_ind.arr);
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	fprintf(fp,"%c(s-3B",ESC);
		for(i=0;i<(5-rl_title_for_range_ind.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-4.4s", " ");

     if(rl_title_for_result_range.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	    fprintf(fp,"%c(s4B",ESC);
		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	fprintf(fp,"%c(s-3B",ESC);
//		for(i=0;i<(14-rl_title_for_result_range.len);i++)
//		   fprintf(fp, "%s", " ");
     }
//	 else
//		fprintf(fp, "%-15.15s", " ");



	fprintf(fp, "\n");
	fprintf(fp, "\n");

	page_break(2);

	}
    
}

/*-----------------------------------------------------*/
/**------------***** ADDED ON 15/12/2010 AGAINST AMRI REQUIRMENT ----------------------******/
get_site_customer_id()
{
	l_customer_id.arr[0]		= '\0';
	l_customer_id.len		= 0;

	EXEC SQL SELECT NVL(customer_id, '!!')
		INTO l_customer_id
		FROM SM_SITE_PARAM;

	l_customer_id.arr[l_customer_id.len]	= '\0';

	if (NODATAFOUND);

	if (OERROR);

}

print_end_of_report()
{

char l_str[100];
int fi;


	if(last_page == 0)

		sprintf(l_str,"%-34.34s%s"," ",local_legend[89]); //added for globalisation
	else
		sprintf(l_str,"%-34.34s%s"," ",local_legend[88]);// added for globalisation

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s4B",ESC);

	fprintf(fp,"\n%s\n\n\n\n\n",l_str);    

	fprintf(fp,"%c&k4S",ESC); 
   	fprintf(fp,"%c(s-3B",ESC);   

//        for(fi=0; fi < 87; fi++)
//	   fprintf(fp,"%c",'_');

//	 fprintf(fp,"\n");

	page_break(6);
}

/******* added for KDAH requirement to print the long desc of result text code *******/
get_text_code_desc()	
{
	rl_res_text_code_desc.arr[0] = '\0';
	
	EXEC SQL SELECT long_desc
		INTO :rl_res_text_code_desc
		FROM RL_RESULT_TEXT_CODE
		WHERE result_text_code = :rl_res_result_text_code
		AND section_code = :rl_hdr_section_code;

	rl_res_text_code_desc.arr[rl_res_text_code_desc.len]	= 0;

	if(NODATAFOUND);

	if (OERROR);

}

print_text_code_desc()
{

//sprintf(string_var, "String  -> [%s]  ", rl_res_text_code_desc.arr);
//disp_message(ERR_MESG, string_var);

	fprint_repeat(fp,' ',8);

	if (strcmp(rl_print_text_underline_yn.arr, "Y") == 0)
	{
		fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
	}
	if (strcmp(rl_print_text_bold_yn.arr, "Y") == 0)
	{
	   	fprintf(fp,"%c(s4B",ESC);   /* Set Bold */
	}
	
	fprintf(fp,"%s\n",rl_res_text_code_desc.arr);	

   	fprintf(fp,"%c(s4B",ESC);
   	fprintf(fp,"%c(s-3B",ESC);
	fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	page_break(1);
}

/* ----*****----------- created new procedure to maintian the below common code for all the Header formats ----*****---- */
print_result_titles()   
{
	int r_ctr = 0;
	char l_string[100];     
	char l_delimeter;
	int	 l_len = 11;
	int	 l_len1 = 0;
	int	 l_len2 = 0;
	int	 l_len3 = 0;
	int	 l_len4 = 0;
	if (strcmp(rl_print_num_result_title_yn.arr, "Y") == 0)
    {
     if(rl_title_for_test.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
//		fprintf(fp, "%s%s", rl_title_for_test.arr," ");
		fprintf(fp, "%s", rl_title_for_test.arr);
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		fprintf(fp, "%s", " ");
		for(i=0;i<(39-rl_title_for_test.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-40.40s", " ");

     if(rl_title_for_num_result.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
//		fprintf(fp, "%s%s", rl_title_for_num_result.arr," ");
		fprintf(fp, "%s", rl_title_for_num_result.arr);
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		fprintf(fp, "%s", " ");
		for(i=0;i<(9-rl_title_for_num_result.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if (strcmp(l_customer_id.arr, "KDAH") == 0)  ///added this condition against KDAH-CRF-0174 on 12/03/2012
     {
		 if(rl_title_for_range_ind.len)
		 {
			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
			fprintf(fp, "%s", rl_title_for_range_ind.arr);
			fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
			for(i=0;i<(5-rl_title_for_range_ind.len);i++)
			   fprintf(fp, "%s", " ");
		 }
		 else
			fprintf(fp, "%-4.4s", " ");
	 }
	 

     if(rl_title_for_test_units.len)
	 {
	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
//		fprintf(fp, "%s%s", rl_title_for_test_units.arr," ");
		fprintf(fp, "%s", rl_title_for_test_units.arr);
        fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		fprintf(fp, "%s", " ");
		for(i=0;i<(9-rl_title_for_test_units.len);i++)
		   fprintf(fp, "%s", " ");
     }
	 else
		fprintf(fp, "%-10.10s", " ");

     if (strcmp(l_customer_id.arr, "KDAH") != 0)  ///added this condition against KDAH-CRF-0174 on 12/03/2012
     {
		 if(rl_title_for_range_ind.len)
		 {
			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
			fprintf(fp, "%s", rl_title_for_range_ind.arr);
			fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
			for(i=0;i<(5-rl_title_for_range_ind.len);i++)
			   fprintf(fp, "%s", " ");
		 }
		 else
			fprintf(fp, "%-4.4s", " ");
	 }
	 
/*****************commented and added below logic against Artemis CRF on 02.08.2012 *****************/
//     if(rl_title_for_result_range.len)
//	 {
//	    fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
///		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
//		fprintf(fp, "%s", rl_title_for_result_range.arr);
  //      fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
	//	for(i=0;i<(14-rl_title_for_result_range.len);i++)
	//	   fprintf(fp, "%s", " ");
    // } 
	// else
//		fprintf(fp, "%-15.15s", " ");
//
/**********************************************************************/


		if (strlen(rl_title_for_result_range.arr) > 15)
		{
   		    l_delimeter = ' ';
			rl_split_text(rl_title_for_result_range.arr,l_delimeter,l_len,rl_title1_for_result_range.arr,
							  rl_title2_for_result_range.arr,rl_title3_for_result_range.arr,rl_title4_for_result_range.arr);

//  sprintf(string_var,"rl_title1_for_result_range=%s",rl_title1_for_result_range.arr);
//  disp_message(ERR_MESG,string_var);

			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/

			rtrim(rl_title1_for_result_range.arr);
			fprintf(fp, "%s", rl_title1_for_result_range.arr);
			fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		//	for(i=0;i<(14-rl_title1_for_result_range.len);i++)
		//	   fprintf(fp, "%s", " ");
			page_break(1);
			fprintf(fp, "\n");


			for(i=0;i<64;i++)
			   fprintf(fp, "%s", " ");

			fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/

			rtrim(rl_title2_for_result_range.arr);


			rtrim(rl_title3_for_result_range.arr);
			fprintf(fp, "%s %s", rl_title2_for_result_range.arr,rl_title3_for_result_range.arr);
			fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
		//	for(i=0;i<(14-(rl_title2_for_result_range.len + rl_title3_for_result_range.len));i++)
		//	   fprintf(fp, "%s", " ");

		}
	   else
		{
		   if(rl_title_for_result_range.len)
		   {
				fprintf(fp,"%c&d0D",ESC);   /* Set  UnderLine ON*/
		///		fprintf(fp, "%s%s", rl_title_for_result_range.arr," ");
				fprintf(fp, "%s", rl_title_for_result_range.arr);
				fprintf(fp,"%c&d@",ESC);   /* Set UnderLine OFF */
				for(i=0;i<(14-rl_title_for_result_range.len);i++)
				   fprintf(fp, "%s", " ");
		   }
		   else
	    		fprintf(fp, "%-15.15s", " ");
		}
/////////////////////////////////

	if (strcmp(l_customer_id.arr, "MC") != 0)
	{
	//page_break(1);//commented out for GHL-SCF-1130.1
	page_break(1);
	}
	fprintf(fp, "\n");

	}
}
 
/************************** added on 03.09.2012 against KDAH-CRF-210 and 223 ************************************/

get_patient_admn_doc_n_curr_locn()
{


   strcpy(l_pat_curr_source_type.arr,rl_hdr_source_type.arr);
   strcpy(l_pat_curr_source_code.arr,rl_hdr_source_code.arr);
   strcpy(l_pat_admit_pract_id.arr,rl_hdr_consultant_code.arr);

   l_pat_curr_source_type.len = strlen(l_pat_curr_source_type.arr);
   l_pat_curr_source_code.len = strlen(l_pat_curr_source_code.arr);
   l_pat_admit_pract_id.len = strlen(l_pat_admit_pract_id.arr);


   if (strcmp(l_customer_id.arr, "KDAHa") == 0)
   {
	   if (( (rl_hdr_episode_type.arr[0] == 'I') || (rl_hdr_episode_type.arr[0] == 'O') ) 
			 && 	(strcmp(nd_operating_facility_id.arr, rl_ordered_facility_id.arr) == 0) ) 
			
	   {

			EXEC SQL SELECT nursing_unit_code,admit_practitioner_id,'W'
			INTO :l_pat_curr_source_code,:l_pat_admit_pract_id,:l_pat_curr_source_type
			FROM IP_OPEN_ENCOUNTER 
			WHERE FACILITY_ID = NVL(:rl_ordered_facility_id, :nd_operating_facility_id)
			AND   patient_id = :nd_hosp_no;

			l_pat_curr_source_code.len = strlen(l_pat_curr_source_code.arr);
			l_pat_curr_source_type.len = strlen(l_pat_curr_source_type.arr);
			l_pat_admit_pract_id.len = strlen(l_pat_admit_pract_id.arr);

			if(NODATAFOUND);
			if(OERROR);
			
	   }
	}
}

/*-----------------------------------------------------*/
rl_print_ca_note(int l_copies)
{

	int l_copy = 0;

	    l_directory_name.arr[0]			  = '\0';
		l_printer_name.arr[0]			  = '\0';
		l_draft_print_yn.arr[0]			  = '\0';
		l_print_status.arr[0]			  = '\0';
		l_confidential_yn.arr[0]		  = '\0';

		l_directory_name.len			  = 0;
		l_printer_name.len				  = 0;
		l_draft_print_yn.len			  = 0;
		l_print_status.len				  = 0;
		l_confidential_yn.len			  = 0;
 //disp_message(ERR_MESG, "rlprintcanote begin");

		EXEC SQL COMMIT;
	
		EXEC SQL EXECUTE
		DECLARE
			l_spec_no 					NUMBER;
		BEGIN
							
				l_spec_no := TO_NUMBER(:rl_prn_ctrl_hdr_sp_no);

				rl_notes_printing_for_ca(l_spec_no, :nd_operating_facility_id, :nd_hosp_no, 
												'RL', 
												'RLRRSENQ',
												:rl_hdr_section_code, :language_id, 
												:p_param7, :p_param8,
												:sy_user_id, :sy_ws_no, 
												:l_directory_name, :l_printer_name,
												:l_draft_print_yn, :l_print_status, :l_confidential_yn);

		END;		
		END-EXEC;
 //disp_message(ERR_MESG, "rlprintcanote..2");

//sprintf(string_var, "%s    %s    %s  %s", p_param7.arr, p_param8.arr, p_print_name.arr, l_printer_name.arr);
//disp_message(ERR_MESG, string_var);

		l_directory_name.len = strlen(l_directory_name.arr);
		l_printer_name.len = strlen(l_printer_name.arr);
		l_draft_print_yn.len = strlen(l_draft_print_yn.arr);
		l_print_status.len = strlen(l_print_status.arr);
		l_confidential_yn.len = strlen(l_confidential_yn.arr);

		l_header.arr[0]				  = '\0';
		l_footer.arr[0]				  = '\0';

		l_header.len				  = 0;
		l_footer.len				  = 0;

	
		l_comm_line.arr[0]			  = '\0';
		l_html_file_name.arr[0]		  = '\0';

		l_comm_line.len				  = 0;
		l_html_file_name.len		  = 0;

//sprintf(string_var, "[%s]    [%s]   [%s]   [%s]   [%s] [%s]  [%s]  [%s]", l_directory_name.arr, l_printer_name.arr,
//												l_draft_print_yn.arr, l_print_status.arr, l_confidential_yn.arr,
//												nd_hosp_no.arr, nd_operating_facility_id.arr, rl_prn_ctrl_hdr_sp_no.arr);
//disp_message(ERR_MESG, string_var);


		open_note_type();

		while(fetch_note_type()) 
		{
	

		l_header.arr[0]				  = '\0';
		l_footer.arr[0]				  = '\0';

		l_header.len				  = 0;
		l_footer.len				  = 0;

		l_comm_line.arr[0]			  = '\0';
		l_html_file_name.arr[0]		  = '\0';

		l_comm_line.len				  = 0;
		l_html_file_name.len		  = 0;


//sprintf(string_var, "file  ---  [%s]  [%s]  [%s]  [%s]", l_html_file_name.arr, l_comm_line.arr, l_header.arr, l_footer.arr);
//sprintf(string_var, "file  ---  [%s]  ", l_comm_line.arr);
//sprintf(string_var, "file  header--->  [%s] ", l_header.arr);
//disp_message(ERR_MESG, string_var);

/// modified the below to pass sy_user_id instead of logged in user to html package to build header and footer on 12.07.2013

			EXEC SQL EXECUTE
			DECLARE
				l_spec_no 					NUMBER;
				l_file_name					VARCHAR2(1000);
				l_html_file					VARCHAR2(1000);
				l_str 						VARCHAR2(32000);
				ptype						VARCHAR2(5) := 'B';

			BEGIN


					l_spec_no := TO_NUMBER(:rl_prn_ctrl_hdr_sp_no);

					l_file_name := NULL;


					RL_HTML_RESULT_TEXT.RL_CLOB_INSERT(:nd_operating_facility_id, l_spec_no, :nd_hosp_no, :rl_note_type_test);

			/************		
					RL_HTML_RESULT_TEXT.RL_CLOB_INSERT_TEMP(:nd_operating_facility_id,l_spec_no,:nd_hosp_no,:rl_note_type_test,
															:sy_session_id,:sy_req_date);
				********************/

					l_file_name := :nd_operating_facility_id || l_spec_no || :rl_note_type_test || '_' || :c_session_id || '.HTML ';

		
					:l_html_file_name := :l_directory_name || l_file_name;

					:l_header := 'null';
					:l_footer := 'null';
					
					if :rl_report_format in ('4','5') then
						if :l_customer_id = 'AMRI' then
								:l_header := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC_AMRI(:nd_operating_facility_id, l_spec_no, 
											:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'H'); 
						else
								:l_header := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC(:nd_operating_facility_id, l_spec_no, 
											:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'H'); 

						end if;
					elsif :rl_report_format = '7' then
						:l_header := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC7(:nd_operating_facility_id, l_spec_no, 
										:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'H'); 

					elsif :rl_report_format = '6' then
						:l_header := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC6(:nd_operating_facility_id, l_spec_no, 
										:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'H'); 
				    end if;

	
					if :rl_report_format in ('5','7') then
						if :l_customer_id = 'AMRI' then
								:l_footer := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC_AMRI(:nd_operating_facility_id, l_spec_no, 
											:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'F'); 
						else
								:l_footer := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC7(:nd_operating_facility_id, l_spec_no, 
											:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'F'); 

						end if;
					elsif :rl_report_format = '4' then
						:l_footer := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC(:nd_operating_facility_id, l_spec_no, 
										:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'F'); 

					elsif :rl_report_format = '6' then
						:l_footer := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC6(:nd_operating_facility_id, l_spec_no, 
										:rl_note_type_test, :language_id,:nd_hosp_no, :sy_user_id, 'F'); 

					end if;
			
/*****************************				
					l_str := RL_HTML_RESULT_TEXT.RL_HTML_HEAD_FOOT_PROC(:nd_operating_facility_id, l_spec_no, :rl_note_type_test,
				  				:language_id, :nd_hosp_no, USER, 'B');  
		
					If ptype='B' Then
						:l_header := SUBSTR(l_str,1,instr(l_str,'**##**')-1);
						:l_footer := SUBSTR(l_str,instr(l_str,'**##**')+6);
					elsif ptype = 'H' THEN
						:l_header := l_str;
					elsif ptype = 'F' THEN
						:l_footer := l_str;
					end if;
	***********************/

					:l_comm_line := 'htmlprint.exe -hidewindow -marginleft 15 -marginright 15 -printer "'|| :l_printer_name||'" ' 
															|| :l_directory_name || l_file_name;


			END;
			END-EXEC;

			l_header.len = strlen(l_header.arr);
			l_footer.len = strlen(l_footer.arr);
			l_html_file_name.len = strlen(l_html_file_name.arr);
			l_comm_line.len = strlen(l_comm_line.arr);

			l_header.arr[l_header.len] = '\0'; 

//sprintf(string_var, "file  ---  [%s]  [%s]  [%s]  [%s]", l_html_file_name.arr, l_comm_line.arr, l_header.arr, l_footer.arr);
//sprintf(string_var, "file  ---  [%s]  ", l_comm_line.arr);
//sprintf(string_var, "file  --->  [%s]  [%s] ", l_html_file_name.arr, l_comm_line.arr);
//disp_message(ERR_MESG, string_var);

 

			if ((fh=fopen(l_html_file_name.arr, "w"))==NULL)
			{
				strcpy(string_var, "");
				sprintf(string_var, "CA Note Type File Name [%s]", l_html_file_name.arr);

				ins_message(ERR_MESG, string_var);

			}

			fputs(l_header.arr,fh);
			//disp_message(ERR_MESG, "before open clob temp data");
			open_clob_temp_data();
			
			//-- 40302 Sandeep K Gujje 07-FEB-2014
			/*
			//disp_message(ERR_MESG, "after open clob temp data");
			while(fetch_clob_temp_data()) 
			{
			//disp_message(ERR_MESG, "within while");
				fputs(rl_char_val.arr,fh);
			//disp_message(ERR_MESG, "after fputs");
			}
			//disp_message(ERR_MESG, "before close clob temp data");
			close_clob_temp_data();	
									
			fputs(l_footer.arr,fh);
			*/
			
			fputs(l_footer.arr,fh);
			fputs("<tbody><TR><TD>", fh);
			
			while(fetch_clob_temp_data()) 
			{
				fputs(rl_char_val.arr,fh);
			}
			
			// -- 10072014 Sandeep K Gujje 10-JUL-2014
			close_clob_temp_data();	
			// -------
				
			fputs("</table></TD></TR></tbody></table></BODY></HTML>", fh);
			//------------------- 40302
			
			fclose(fh);

			for (l_copy=1;l_copy <= l_copies; l_copy++)
			{
//				_spawnlp(_P_WAIT, "htmlprint",l_comm_line.arr, NULL);	             		


				WinExec(l_comm_line.arr, SW_HIDE);	        

//				ShowWindow( l_comm_line.arr, SW_HIDE );
				
			}

		}

		close_note_type();

	
	
}

/*-----------------------------------------------------*/
open_clob_temp_data()
{
 
    EXEC SQL DECLARE RL_CLOB_TEMP_DATA_CUR CURSOR FOR
									SELECT char_val 
								 FROM RL_TEMP_CLOB_TBL
								 WHERE test_code = :rl_note_type_test
								 ORDER BY seqno;

/*********** commented this on 22.12.12 by Srinivasarao against alpha reopen issue
    EXEC SQL DECLARE RL_CLOB_TEMP_DATA_CUR CURSOR FOR
									SELECT char_val 
								 FROM RL_TEMP_CLOB_TBL_TMP
								 WHERE test_code = :rl_note_type_test
								 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
								 AND SPECIMEN_NO		   = TO_NUMBER(:rl_prn_ctrl_hdr_sp_no)
								 AND PATIENT_ID			   = :nd_hosp_no
								 AND SESSION_ID			   = :sy_session_id
								 AND PGM_DATE			   = :sy_req_date
								 ORDER BY seqno;
**************/

    EXEC SQL OPEN RL_CLOB_TEMP_DATA_CUR;


	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy RL_CLOB_TEMP_DATA_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"OPEN failed on cursor RL_CLOB_TEMP_DATA_CUR");
	}


}
/*-----------------------------------------------------*/
close_clob_temp_data()
{
 
 
    EXEC SQL CLOSE RL_CLOB_TEMP_DATA_CUR;


	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"CLOSE failed resource busy RL_CLOB_TEMP_DATA_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"CLOSE failed on cursor RL_CLOB_TEMP_DATA_CUR");
	}

/**********************
    EXEC SQL DELETE	FROM RL_TEMP_CLOB_TBL_TMP
					 WHERE test_code = :rl_note_type_test
					 AND OPERATING_FACILITY_ID = :nd_operating_facility_id
					 AND SPECIMEN_NO		   = TO_NUMBER(:rl_prn_ctrl_hdr_sp_no)
					 AND PATIENT_ID			   = :nd_hosp_no
					 AND SESSION_ID			   = :sy_session_id
					 AND PGM_DATE			   = :sy_req_date;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"DELETE failed resource busy RL_TEMP_CLOB_TBL_TEMP");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"DELETE failed on error on RL_TEMP_CLOB_TBL_TMP");
	}
*********************/
}

/*-----------------------------------------------------*/
fetch_clob_temp_data()
{

    rl_char_val.arr[0]			  = '\0';
	rl_char_val.len				  = 0;
  

    EXEC SQL FETCH RL_CLOB_TEMP_DATA_CUR
              INTO :rl_char_val;



    if (OERROR)
        ins_message(ORA_MESG,"FETCH failed on cursor RL_CLOB_TEMP_DATA_CUR");

	rl_char_val.arr[rl_char_val.len]							= '\0';
	

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
open_note_type()
{

	rl_report_entire_spec_yn.arr[0] = '\0';
	
    EXEC SQL SELECT NVL(report_entire_spec_yn,'N')
            INTO :rl_report_entire_spec_yn
            FROM RL_SECTION_CTL
            WHERE section_code = :rl_prn_ctrl_hdr_section_code
            AND operating_facility_id = :nd_operating_facility_id;

	rl_report_entire_spec_yn.arr[rl_report_entire_spec_yn.len]	= 0;

    EXEC SQL DECLARE RL_NOTE_TYPE_CUR CURSOR FOR
									SELECT test_code 
									FROM  RL_OLE_RESULT_TEXT
									WHERE patient_id = :nd_hosp_no
									AND specimen_no = TO_NUMBER(:rl_prn_ctrl_hdr_sp_no)
									AND operating_facility_id = :nd_operating_facility_id
									AND group_test_code IN 
											(SELECT test_code 
											FROM RL_REQUEST_DETAIL
											WHERE patient_id = :nd_hosp_no
											AND specimen_no = TO_NUMBER(:rl_prn_ctrl_hdr_sp_no)
											AND operating_facility_id = :nd_operating_facility_id
											AND NVL(cancelled_yn, 'N') <> 'Y' 					
											AND (NVL(result_status, 'O') IN ('R', :l_print_status)
											        OR (:rl_report_entire_spec_yn= 'N' AND 
											               RESULT_PRINTED_DATE = to_date(:nd_result_printed_date,'DD/MM/YYYY HH24:MI:SS') )
													OR :l_draft_print_yn = 'Y' 
													OR (test_code in (SELECT test_code 
																	FROM RL_TEST_CODE
												 					WHERE  NVL(profile_yn, 'N') = 'Y'
												 					AND    NVL(group_test_yn, 'N') = 'Y'
														)  
											AND ( NVL(result_status,'O') = 'O' 
													OR (NVL(result_status,'O') IN ('A') AND released_date IS NOT NULL))
												)
													OR (NVL(preliminary_release_yn,'N') = 'Y' AND NVL(result_status,'O') IN ('A')) 
												)
											)
					  AND test_code in (SELECT test_code 
										FROM RL_TEST_CODE
										WHERE  NVL(inhibit_report_yn, 'N') <> 'Y'
										AND    NVL(confidential_yn, 'N') = :l_confidential_yn
									)  
					ORDER BY test_code;		


    EXEC SQL OPEN RL_NOTE_TYPE_CUR;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy RL_NOTE_TYPE_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"OPEN failed on cursor RL_NOTE_TYPE_CUR");
	}


}
/*-----------------------------------------------------*/
close_note_type()
{
 
 
    EXEC SQL CLOSE RL_NOTE_TYPE_CUR;


	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"CLOSE failed resource busy RL_NOTE_TYPE_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"CLOSE failed on cursor RL_NOTE_TYPE_CUR");
	}


}

/*-----------------------------------------------------*/
fetch_note_type()
{
    rl_note_type_test.arr[0]			  = '\0';
	rl_note_type_test.len					= 0;
  

    EXEC SQL FETCH RL_NOTE_TYPE_CUR
              INTO :rl_note_type_test;



    if (OERROR)
        ins_message(ORA_MESG,"FETCH failed on cursor RL_NOTE_TYPE_CUR");

	rl_note_type_test.arr[rl_note_type_test.len]							= '\0';
	

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/

/**************** KDAH-CRF-260 The result comment code selection is added ************/
get_print_bold_comments(int l_val)
{
	 bold_print_for_comm1 = 0;
	 bold_print_for_comm2 = 0;
	 bold_print_for_comm3 = 0;
	 bold_print_for_comm4 = 0;	

		
			if (l_val == 1)
			{
				EXEC SQL 
				SELECT DECODE(NVL(notify_yn, 'N'), 'N', 0, 1) 
				INTO :bold_print_for_comm1
				FROM RL_ALLOWABLE_COMMENT_CODE
				WHERE test_code = :rl_tst_test_code
				AND allowable_comment_code = :rl_tst_result_comment_code1;
			}
			else if (l_val == 2)
			{
				EXEC SQL
				SELECT DECODE(NVL(notify_yn, 'N'), 'N', 0, 1) 
				INTO :bold_print_for_comm2
				FROM RL_ALLOWABLE_COMMENT_CODE
				WHERE test_code = :rl_tst_test_code
				AND allowable_comment_code = :rl_tst_result_comment_code2;
			}
			else if(l_val == 3)
			{
				EXEC SQL
				SELECT DECODE(NVL(notify_yn, 'N'), 'N', 0, 1) 
				INTO :bold_print_for_comm3
				FROM RL_ALLOWABLE_COMMENT_CODE
				WHERE test_code = :rl_tst_test_code
				AND allowable_comment_code = :rl_tst_result_comment_code3;
			}
			else if(l_val == 4)
			{
				EXEC SQL
				SELECT DECODE(NVL(notify_yn, 'N'), 'N', 0, 1) 
				INTO :bold_print_for_comm4
				FROM RL_ALLOWABLE_COMMENT_CODE
				WHERE test_code = :rl_tst_test_code
				AND allowable_comment_code = :rl_tst_result_comment_code4;
			}

}


/********************************* added by madhu for crf -332 ***************************/
open_notify_type()
{

    EXEC SQL DECLARE RL_NOTIFY_TYPE_CUR CURSOR FOR
									SELECT  NOTIFY_BY ,
											NOTIFY_TO,
											TO_CHAR(NOTIFY_DATE_TIME,'DD/MM/YYYY HH24:MI'),
											NOTIFY_TEXT 
									FROM  RL_NOTIFY_DETAILS 
									WHERE patient_id = :nd_hosp_no
									AND specimen_no = TO_NUMBER(:rl_prn_ctrl_hdr_sp_no)
									AND operating_facility_id = :nd_operating_facility_id
									ORDER BY NOTIFY_DATE_TIME;	

    EXEC SQL OPEN RL_NOTIFY_TYPE_CUR;

	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"OPEN failed resource busy RL_NOTIFY_TYPE_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"OPEN failed on cursor RL_NOTIFY_TYPE_CUR");
	}

}
/*-----------------------------------------------------*/
close_notify_type()
{
 
    EXEC SQL CLOSE RL_NOTIFY_TYPE_CUR;


	if (RESOURCE_BUSY)
	{
		ins_message(ORA_MESG,"CLOSE failed resource busy RL_NOTIFY_TYPE_CUR");
	}

    if (OERROR)
	{
         ins_message(ORA_MESG,"CLOSE failed on cursor RL_NOTIFY_TYPE_CUR");
	}


}

/*-----------------------------------------------------*/
fetch_notify_type()
{
    RL_NOTIFY_BY.arr[0]             = '\0';
    RL_NOTIFY_TEXT.arr[0]			= '\0';
	RL_NOTIFY_TO.arr[0]			    = '\0';
	RL_NOTIFY_DATE_TIME.arr[0]		= '\0';
	RL_NOTIFY_DATE_TIME1.arr[0]		= '\0';
	RL_NOTIFY_BY.len				= 0;
	RL_NOTIFY_TO.len				= 0;
	RL_NOTIFY_DATE_TIME.len         = 0;
	RL_NOTIFY_DATE_TIME1.len         = 0;
	RL_NOTIFY_TEXT.len              = 0;
  
    EXEC SQL FETCH RL_NOTIFY_TYPE_CUR
              INTO RL_NOTIFY_BY ,
	RL_NOTIFY_TO,
	RL_NOTIFY_DATE_TIME1 ,
	RL_NOTIFY_TEXT ;

	
			
    if (OERROR)
        ins_message(ORA_MESG,"FETCH failed on cursor RL_NOTIFY_TYPE_CUR");

	RL_NOTIFY_BY.arr[RL_NOTIFY_BY.len]							= '\0';
	RL_NOTIFY_TO.arr[RL_NOTIFY_TO.len]							= '\0';
	RL_NOTIFY_DATE_TIME.arr[RL_NOTIFY_DATE_TIME.len]			= '\0';
	RL_NOTIFY_DATE_TIME1.arr[RL_NOTIFY_DATE_TIME1.len]			= '\0';
	RL_NOTIFY_TEXT.arr[RL_NOTIFY_TEXT.len]						= '\0';
	

    return (LAST_ROW?0:1);
}
/*-----------------------------------------------------*/
print_notify_details()
{
	if (strcmp(rl_print_notify_yn.arr, "Y") == 0)
    {
		  splitting1();
	 
	}
}

splitting1()
{
    int fetch_notify_type();
	char word[2];
	char l_str[100];
   l_str[0] = '\0'; 

                         	EXEC SQL 
									SELECT COUNT(*) 
   									INTO	c_count_notify
									FROM  RL_NOTIFY_DETAILS 
									where PATIENT_ID = :nd_hosp_no
                                    AND SPECIMEN_NO = :actual_specimen
				                    AND OPERATING_FACILITY_ID = :nd_operating_facility_id
									order by NOTIFY_DATE_TIME;								


						if(NODATAFOUND);
						if (OERROR)
							  disp_message(ORA_MESG,"Failed at Select RL_TEST_RESULT in print_dtls()");

   if (c_count_notify > 0) 
   {
    strcpy(word1,"F");
	_flushall();
	
	fprintf(fp,"%c&k4S",ESC); 
	fprintf(fp,"%c(s4B",ESC);
	fprintf(fp,"%-20.20s: ", local_legend[95]); //added for globalisation 
	fprintf(fp,"%c&k4S",ESC);
	fprintf(fp,"%c(s-3B",ESC); 
	fprintf(fp, "\n");
	page_break(1);
		
    while(fetch_notify_type())
    {
		  something_to_print = 1;
		  something_to_print_for_test = 1;
	get_user_name(RL_NOTIFY_BY.arr);	  
    fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
	fprintf(fp,"%-15.15s: ", local_legend[91]); //added for globalisation 
	fprintf(fp,"%c&k4S",ESC);  
	sprintf(l_str,"%s", sy_user_name.arr);
	fprintf(fp,"%-60.60s\n",l_str);
	
	page_break(1);
	
    get_user_name(RL_NOTIFY_TO.arr);	
	fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
	fprintf(fp,"%-15.15s: ", local_legend[92]); //added for globalisation 
	fprintf(fp,"%c&k4S",ESC); 
    sprintf(l_str,"%s", sy_user_name.arr);
	fprintf(fp,"%-60.60s\n",l_str);	

   page_break(1);
   
   fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
	fprintf(fp,"%-15.15s: ", local_legend[93]); //added for globalisation 
	fprintf(fp,"%c&k4S",ESC); 
   
   if (RL_NOTIFY_DATE_TIME1.len != 0)
    {
		 fprintf(fp,"%-30s",RL_NOTIFY_DATE_TIME1.arr);
		 fprintf(fp, "\n");
		 page_break(1);
   }
   page_break(1);
      
    fprintf(fp,"%-3.3s"," ");
    fprintf(fp,"%c&k4S",ESC); 
	fprintf(fp,"%-15.15s: ", local_legend[94]); //added for globalisation 
	
   
          hell = strlen(RL_NOTIFY_TEXT.arr);

/***** added for KDAH requirement to print the long desc of the result text **********/
//sprintf(string_var, "String  -> [%s]  [%s]", rl_print_text_desc_yn.arr, rl_res_result_text_code.arr);
//disp_message(ERR_MESG, string_var);

         z = 0;
	     clt = 0;
	     strcpy(word1,"F");
	     cntr = 1;
	     qq = 0;

         while(z<hell)
         {
		 		  	
		 
             word[0] = RL_NOTIFY_TEXT.arr[z];
 		     word[1] = '\0';

		     if (strcmp(word,"\n") == 0)
		     {
   
		       cntr = 0;
		       strcpy(word1,"N");
		       qq = z ;
		      }

  		      if(cntr >= 71)
		      {
		   	
			     cmp = cntr;
			     while((RL_NOTIFY_TEXT.arr[z] != 32) && (cmp > 1))
			     {

			         z--;
				     cmp--;
				  
			      }

				  qq = z;
				  			   
			      word[0] = RL_NOTIFY_TEXT.arr[z];
   			      word[1] = '\0';
		
		  	      if (cmp == 1)
				     strcpy(word1,"W");
			      else
			         strcpy(word1,"T");
			   
		
		       }


				if (((z == hell) || (z == hell - 1)) && (strcmp(word1,"F") == 0))
				{
					/*if condition added by madhu for ml-mmoh-crf-0332*/
					if (clt == 0)
					{
				   fprint_repeat(fp,' ',1);	
					}
			       else 
				   {
				   fprint_repeat(fp,' ',8);	
					}
					
				   for(i=clt;i < z + 1;i++)
		           {
		              fprintf(fp,"%c",RL_NOTIFY_TEXT.arr[i]);
				
			       }
			       fprintf	(fp,"\n");
				   if (strcmp(l_customer_id.arr, "MC") != 0)
				   {
				   page_break(1);
				   //page_break(1);//commented out for GHL-SCF-1130.1
				   }
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");


				}
			
		       if (strcmp(word1,"N") == 0) 
		       {
				/*if condition added by madhu for ml-mmoh-crf-0332*/
		         if (clt == 0)
					{
				   fprint_repeat(fp,' ',1);	
					}
			       else 
				   {
				   fprint_repeat(fp,' ',8);	
					}
						   
				  for(i=clt;i<=qq;i++)
		          {
			         fprintf(fp,"%c",RL_NOTIFY_TEXT.arr[i]);
					
			      }
                              page_break(1);                                 
			      strcpy(word1,"F");
			      cntr = 0 ;
			      clt = qq + 1;
		          qq = 0;
	   	       }

		       if (strcmp(word1,"T") == 0)
		       {
				   /*if condition added by madhu for ml-mmoh-crf-0332*/
		 		if (clt == 0)
					{
				   fprint_repeat(fp,' ',1);	
					}
			       else 
				   {
				   fprint_repeat(fp,' ',8);	
					}
					
						   
				  for(i=clt;i<= qq;i++)
		          {
		             fprintf(fp,"%c",RL_NOTIFY_TEXT.arr[i]);
				
			      }

			       fprintf	(fp,"\n");
				   page_break(1);
			       cntr = 0 ;
				   clt = qq + 1 ;
			       qq = 0;
				   strcpy(word1,"F");

				
		        }
		        if (strcmp(word1,"W") == 0)
		        {
		 			/*if condition added by madhu for ml-mmoh-crf-0332*/							 
			     if (clt == 0)
					{
				   fprint_repeat(fp,' ',1);	
					}
			       else 
				   {
				   fprint_repeat(fp,' ',8);	
					}
					
						   
				   for(i=clt;i < clt + 70;i++)
		           {
		              fprintf(fp,"%c",RL_NOTIFY_TEXT.arr[i]);
				
			       }

			       fprintf(fp,"\n");
				   page_break(1);
				   cntr = 0 ;
				   clt = clt + 70 ;
				   z = clt ;
			       qq = 0;
				   strcpy(word1,"F");
		        }

		  
            cntr += 1;
	        z++ ;
          }
		
      }

	  close_notify_type();
   }
  
       fflush(fp);

#ifdef DEBUG
   printf("rl_res_result_text = %s\n", RL_NOTIFY_TEXT.arr);
#endif

if (OERROR)
   ins_message(ORA_MESG,"Error occurred at splitting()");

  return;

err_exit:
   EXEC SQL WHENEVER SQLERROR CONTINUE;
   ins_message(ORA_MESG,"Error occurred at splitting()");
   return;
}


