
<%@ page import="java.sql.*, java.util.*, java.text.*,webbeans.eCommon.*,webbeans.op.CurrencyFormat,blopin.*,com.ehis.util.*,eCommon.Common.*,eOP.*,org.json.simple.parser.JSONParser,org.json.simple.*" contentType="text/html;charset=UTF-8"%>
<%@ include file="../../eCommon/jsp/CommonInclude.jsp"%> 
<html>   
<head>
  <%@ include file="../../eMP/jsp/PatientAddressLegends.jsp" %>
  <%
String sStyle	=
(session.getAttribute("PREFERRED_STYLE")!=null)||(session.getAttribute("PREFERRED_STYLE")!="")?(String)session.getAttribute("PREFERRED_STYLE"):"IeStyle.css";
//Start - Added for GDOH-CRF-149
	session.removeAttribute("str_clinic_code");
	session.removeAttribute("classTypChangeAuthYnPatId");
//End - Added for GDOH-CRF-149
%>  

  <link rel='stylesheet' type='text/css' href='../../eCommon/html/<%=sStyle%>'></link>
  <link rel='stylesheet' type ='text/css' href='../../eCommon/html/Tabs.css'></link>	
  <link rel='stylesheet' type='text/css' href='../../eCommon/html/CommonCalendar.css'></link>
  <script language='javascript' src='../../eCommon/js/common.js'></script>
  <Script src="../../eCommon/js/CommonCalendar.js" language="JavaScript"></Script>
  <script language='javascript' src='../../eCommon/js/dchk.js'></script>
  <script language='javascript' src='../../eCommon/js/ValidateControl.js'></script>
  <script language='javascript' src='../../eCommon/js/FieldFormatMethods.js'></script>
  <script language='javascript' src='../../eAE/js/AERegisterAttn.js'></script>
  <script language='javascript' src='../../eCommon/js/CommonLookup.js' > </script> 
  <script language='javascript' src='../../eCommon/js/DateUtils.js'> </script>
  
  <script language='javascript' src='../../eAE/js/AEPractitionerComponent.js'></script>

  <script>
  function aa(){
	  if(document.forms(0).PrevEncounter.disabled == true && document.forms(0).visit_within_24hrs.disabled == true){
		  document.forms(0).visit_date_time.focus();
	  }
  }
  function tab_click(objName)
	{if(objName=="addVisit_tab")
			{
				document.all.tab1.scrollIntoView();
		        document.forms(0).visit_date_time.focus();
			}
		   if(objName=="arrival_tab")
			{
				document.all.tab2.scrollIntoView();
		        document.forms(0).accompany_by.focus();
			}
			if(objName=="rlcnts_tab")
			{
				document.all.kin.scrollIntoView();
				document.all.next_contact_name.focus();
			}
			if(objName=="#kin1") 
			{
             document.all.kin1.scrollIntoView();
				document.all.first_contact_name.focus();
			}
			if(objName=="#empyr")
			 {
				document.all.empyr.scrollIntoView();
				document.all.organization_name.focus();
			}
			if (objName=="findtl_tab")
		    {
			 var bl_install_yn	= document.forms(0).bl_install_yn.value;   
             if ((objName == 'findtl_tab')  && (bl_install_yn == "Y")){
				 if(document.forms(0).visit_type.value!="")
                chkOnSub();
				 else{
					var err = getMessage('CAN_NOT_BE_BLANK','Common');
					err = err.replace('$', getLabel("eAE.RegistrationType.label","AE"));
					alert(err)
				 }
			 }

			}
	}
	function tab_click1(id) 
		{
			selectTab(id);
			tab_click(id);
		}

		function tab_click2(id,idval){
				selectTab(idval);
				tab_click22(id);
		}

		function tab_click22(Object)
		{
			if(Object=='#kin')
			{
				if(document.all.next_contact_name!=null&&document.all.next_contact_name.disabled==false)
				document.all.next_contact_name.focus();
				 else
				 document.all.kin.scrollIntoView();
			}
			if(Object=='#kin1')
			{
				if(document.all.first_contact_name!=null&&document.all.first_contact_name.disabled==false)
				document.all.first_contact_name.focus();
				 else
				   document.all.kin1.scrollIntoView();
			}
			if(Object=='#empyr')
			{
				if(document.all.organization_name!=null&&document.all.organization_name.disabled==false)
				document.all.organization_name.focus();
				else
				  document.all.empyr.scrollIntoView();
			}
		}


		function expandCollapse(calledFrom) {					

					if(calledFrom == 'add_Visit_tab') {

						document.all.ADDVISIT.style.display = 'inline';
						document.all.ARRIVAL.style.display = 'none';
						document.all.RELATEDCONTACT.style.display = 'none';	
						document.all.NEXT_OF_KIN.style.display = 'none';
						document.all.FIRST_TO_NOTIFY.style.display = 'none';
						document.all.EMP_DETAILS.style.display = 'none';
						
					}else if(calledFrom == 'arrival_tab') {

						document.all.ADDVISIT.style.display = 'none';
						document.all.ARRIVAL.style.display = 'inline';
						document.all.RELATEDCONTACT.style.display = 'none';
						document.all.NEXT_OF_KIN.style.display = 'none';
						document.all.FIRST_TO_NOTIFY.style.display = 'none';
						document.all.EMP_DETAILS.style.display = 'none';
						
					}else if(calledFrom == 'rel_con_tab') {
						selectTab('firstkin');
						document.all.ADDVISIT.style.display = 'none';
						document.all.ARRIVAL.style.display = 'none';
						document.all.RELATEDCONTACT.style.display = 'inline';
						document.all.NEXT_OF_KIN.style.display = 'inline';
						document.all.FIRST_TO_NOTIFY.style.display = 'none';
						document.all.EMP_DETAILS.style.display = 'none';
						
					}else if(calledFrom == 'fin_tab') {
						
						var bl_install_yn	= document.forms(0).bl_install_yn.value;   
						if ((calledFrom == 'fin_tab')  && (bl_install_yn == "Y")){
							 if(document.forms(0).visit_type.value!="")
							chkOnSub();
							 else{
								var err = getMessage('CAN_NOT_BE_BLANK','Common');
								err = err.replace('$', getLabel("eAE.RegistrationType.label","AE"));
								alert(err)
							 }
						 }
						
					}else if(calledFrom == 'next_of_kin') {
						selectTab('firstkin');
						document.all.ADDVISIT.style.display = 'none';
						document.all.ARRIVAL.style.display = 'none';
						document.all.RELATEDCONTACT.style.display = 'inline';
						document.all.NEXT_OF_KIN.style.display = 'inline';
						document.all.FIRST_TO_NOTIFY.style.display = 'none';
						document.all.EMP_DETAILS.style.display = 'none';
						
					}else if(calledFrom == 'first_to_notify') {
						selectTab('firstkin1');
						document.all.ADDVISIT.style.display = 'none';
						document.all.ARRIVAL.style.display = 'none';
						document.all.RELATEDCONTACT.style.display = 'inline';
						document.all.NEXT_OF_KIN.style.display = 'none';
						document.all.FIRST_TO_NOTIFY.style.display = 'inline';
						document.all.EMP_DETAILS.style.display = 'none';
						
					}else if(calledFrom == 'emp_details') {
						selectTab('firstempyr');
						document.all.ADDVISIT.style.display = 'none';
						document.all.ARRIVAL.style.display = 'none';
						document.all.RELATEDCONTACT.style.display = 'inline';
						document.all.NEXT_OF_KIN.style.display = 'none';
						document.all.FIRST_TO_NOTIFY.style.display = 'none';
						document.all.EMP_DETAILS.style.display = 'inline';
						
					} 
		}
var prevTabObj='firstkin';
	function selectTab(tabObj){			
		if(prevTabObj!=null){
				document.getElementById(prevTabObj).className="tabA"
				document.getElementById(prevTabObj+"span").className="tabAspan"
			}			
			document.getElementById(tabObj).className="tabClicked"
			document.getElementById(tabObj+"span").className="tabSpanclicked"
			prevTabObj=tabObj
}
/*Added by Rameswar on 28-Nov-15 for GDOH-CRF-0004.1*/
function doDatecheck(obj)
	{
	  if(obj.value != '') 
	  {
		if(!validDate(obj.value,'DMYHM',localeName))
		{
			alert(getMessage("INVALID_DATE_TIME",'SM'))
			obj.select();
		}
		else
		{
			if((!isBeforeNow(obj.value,'DMYHM',localeName)))
			{
		alert(getMessage("DATE_NOT_GREATER_SYSDATE",'Common'));
		obj.select();
			}	
		}
	  }
    }/*Added by Rameswar on 28-Nov-15 for GDOH-CRF-0004.1*/

/*Added by Rameswar on 08-Feb-16 for GDOH-CRF-081*/
function enablePrac(){

if((document.forms(0).priorityR.checked==true||document.forms(0).priorityY.checked==true||document.forms(0).priorityG.checked==true )&& (document.forms(0).treat_area.value!='')){
	document.forms(0).practitioner_desc.disabled		=	false;
	document.forms(0).pract_button.disabled				=	false;
	document.forms(0).pract_mand_img.style.visibility	=	'visible';
	document.forms(0).practitioner_desc.value			=	'';
	document.forms(0).practitioner_id.value				=	'';
}else{
	document.forms(0).practitioner_desc.disabled		=	true;
	document.forms(0).pract_button.disabled				=	true;
	document.forms(0).pract_mand_img.style.visibility	=	'hidden';
	document.forms(0).practitioner_desc.value			=	'';
	document.forms(0).practitioner_id.value				=	'';
}	
}
/*Added by Rameswar on 08-Feb-16 for GDOH-CRF-081*/
  </script>
  </head> 
  <% 
        Connection con							= null;
    	PreparedStatement pstmt_race			= null;
    	PreparedStatement pstmt					= null;
		ResultSet rset_race						= null; 
		ResultSet rset							= null; 
		ResultSet rs							= null;
		ArrayList contact_addr                  = null; 
        PreparedStatement oth_stmt              = null;
		ResultSet oth_rset                      = null;
		//PreparedStatement pstmtR                = null;
		//ResultSet rsetR                         = null;
		ArrayList race_array = new ArrayList();
		PreparedStatement pstmtEncounter = null;
		ResultSet rsetEncounter = null;
		int countRecEnc =0;
		String auth_win_reqd_yn = "N";
		String sel                              = "";
		String Accept_oth_alt_id_yn             = "";
		//String sql             = "";
        //Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008
		
		Object contactmode[]	= null;
	        Object contactdesc[]	= null;

		Object oth_code[] = null; 
	        Object oth_desc[] = null; 

		ArrayList codes	= null;
	        ArrayList descs	= null;
		
        //Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008
		String[] contact_col_names				= null ;
		String[] contact_prompts				= null ;
		String[] contact_fields					= null ;
		request.setCharacterEncoding("UTF-8");
	    String locale					= (String)session.getAttribute("LOCALE");
		java.util.Properties propertiesBill = (java.util.Properties) session.getValue( "jdbc" ) ;
        String remarks				    = "";
		String alt_id1_no		         = "", 		nat_id_prompt		        = "";
		String blood_group			    = "",		rh_factor			        = "";
		String sysdate				    = "",		proBrought_dead				= "";
		String sysDateWithoutTime       = "",		accept_national_id_no_yn    = "";
		String accept_oth_alt_id_yn     = "",       nat_id_length               = "";
		String nationality_id			= "",		nationality				    = "";
		String date_of_birth            = "",       buildEpisodeRule	        = "X";
		String alt_id1_desc				= "";
		String oth_alt_id_desc			= "",		oth_alt_id_no				= "";
		String residency				= "",		legal_status				= "";	
		String visit_back_yn			= "",		start_date				    = "";
		String sex						= "";
		String paediatric_yn			= "",		gynaec_yn				    = "";
		String EncounterProp ="disabled";
		String blood_group_code         = "",	    rh_factor_code              = "";
		String nat_id_accept_alphanumeric_yn = "";
		String alt_id2_no		         = "", alt_id2_desc				= ""; // added for PMG2014-HSA-CRF-0001 [IN:050020] 
		String alt_id3_no		         = "", alt_id3_desc				= ""; // added for PMG2014-HSA-CRF-0001 [IN:050020] 
		String alt_id4_no		         = "", alt_id4_desc				= ""; // added for PMG2014-HSA-CRF-0001 [IN:050020] 

		int  patient_age				= 0;
		int	 tindex                     = 0;
		
 
		// For AE Related Contacts
		String contact1_relation	    = "",       contact1_name				= "";
	    String contact1_nat_id_no       = "",		contact1_birth_date         = "";
		String job1_title			    = "",		addr1_line1				    = "";	
		String addr1_line2				= "",		addr1_line3				    = "";
		String addr1_line4				= "",		contact1_res_town           = ""; 
		String contact1_area_code       = "",		contact1_region_code        = "";
        String res1_mbo_tel_no          = "",		postal1_code			    = "";
		String country1_code		    = "",		res1_tel_no			        = "";
		String off1_tel_no				= "",		contact2_relation           = "";
		String contact2_nat_id          = "",		contact2_town_code          = "";
		String contact2_res_tel_no      = "",		contact2_mob_tel_no         = "";
		String contact2_off_tel_no      = "",		contact2_mail_id		    = "";
		String contact2_add_l1			= "",		contact2_add_l2			    = "";
		String contact2_add_l3			= "",		contact2_add_l4			    = "";
		String contact2_area_code       = "",		contact2_reg_code		    = "";
		String contact3_org_name        = "",		contact3_town_code          = "";
		String contact3_reg_code		= "",		contact3_area_code		    = "";
		String ocpn_class_code          = "",		contact2_country_code       = "";
		String contact1_email_id        = "",		employer_name		        = "";
		String job2_title			    = "",		postal2_code			    = "";
		String first_to_notify_name		= ""; 
		String addr3_line1				= "";
		String addr3_line2				= "",		addr3_line3				    = "";
		String addr3_line4				= "",		postal3_code			    = "";
		String country3_code		    = "",		res3_tel_no			        = "";
		String off3_tel_no				= "",		ocpn_code				    = "";
		String ocpn_desc				= "",		patient_employee_id         = "";
		String employment_status	    = "",		regn_date				    = "";
		String contact1_res_town_desc   = "",		country1_code_desc          = "";
		String contact2_res_town_desc   = "",		contact2_res_area__desc     = "";
		String contact2_region_desc     = "",		contact1_res_area__desc     = "";
		String contact1_region_desc     = "",		country2_code_desc		    = "";
		String contact3_res_town_desc	= "",		contact3_region_desc        = "";
		String contact3_res_area__desc	= "",		country3_code_desc		    = "";
		String gender1					= "";
		String deceased_yn              = "";
		/*Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008*/
		String nk_mail_addr_line1="", nk_mail_addr_line2="";
		String nk_mail_addr_line3="", nk_mail_addr_line4="";
		String n_contact_ma_town_desc   = "", nkcontact1_res_town  = "";
		String n_contac_region_desc="", nkcontact1_region_code="";
		String n_contact_ma_area_desc="", nkcontact1_area_code="";
		String nkpostal1_code="", nkpostal1_desc="";
		String nk_mail_country_desc="", nkin_m_country_desc="", nk_mail_country_code="";
		String nk_res_contact_name="", nk_mail_contact_name="";
		String nk_contact3_mode="", nk_contact3_no="";
	        String nk_contact4_mode="", nk_contact4_no="";
	        String nk_contact5_mode="", nk_contact5_no=""; 

		String fton_mail_addr_line1="", fton_mail_addr_line2="";
		String fton_mail_addr_line3="", fton_mail_addr_line4="";
		String fst_to_no_ma_town_desc   = "", ftoncontact2_res_town  = "";
		String fst_to_no_ma_reg_desc="", ftoncontact2_region="";
		String fst_to_no_ma_area_desc="", ftoncontact2_res_area="", fton_mail_country_code="";
		String ftonpostal1_code="", ftonpostal1_desc="";
		String fton_res_contact_name="", fton_mail_contact_name="";
		String fton_mail_country_desc="", fton_m_country_desc="";
		String fton_resadd_contact_name="", fton_mailadd_contact_name="";
		String fton_contact3_mode="", fton_contact3_no="";
	        String fton_contact4_mode="", fton_contact4_no="";
	        String fton_contact5_mode="", fton_contact5_no=""; 
		/*Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008*/
        /* below lines are add by venkateshs on 29/06/2012 against  the crf  SKR-CRF-0021 [IN028173] */
         String color="";     
	  String red                      ="";
        String yellow                   ="";
        String green                    ="";
		String unassigned               ="";
		String sql                      ="";
	
       /* CRF  SKR-CRF-0021 [IN028173] end  */
		
		String facilityId				= (String)session.getValue("facility_id");
		
		Properties p=(java.util.Properties) session.getValue("jdbc"); //Added for this CRF GDOH-CRF-0129

	//	String function_id=request.getParameter("function_id")==null?"":request.getParameter("function_id");

		String StartDate1			    = "";
		String AllowedDate			    = "";
		String bl_interface_yn		    = "";
		String sys_date					= "";
		String entitlement_by_cat_yn    = "";
		String patient_id				=   checkForNull(request.getParameter("Patient_ID"));
		//String last_encounter_id        = ""; 
		String bl_install_yn = (String)session.getValue("bl_operational"); 
		
		/*Added For AAKH-CRF-0010 [IN:038535] By Dharma on Feb 26th 2014 Start*/
		String five_level_triage_appl_yn	= (request.getParameter("five_level_triage_appl_yn")==null || request.getParameter("five_level_triage_appl_yn")=="")?"N":request.getParameter("five_level_triage_appl_yn");
		
		/*Added For AAKH-CRF-0010 [IN:038535] By Dharma on Feb 26th 2014 End*/
				
		/*Added by Dharma on Aug 18th 2017 against ML-MMOH-CRF-0631 [IN:062148] Start*/
		String frameRef				= checkForNull(request.getParameter("frameRef"),"top.content");
		String invoke_from			= checkForNull(request.getParameter("invoke_from"));
		/*Added by Dharma on Aug 18th 2017 against ML-MMOH-CRF-0631 [IN:062148] End*/

		String to_locn_type=null;
		String to_locn_code=null;
		String to_service_code=null;
		 if(bl_install_yn == null)
	     {
		   bl_install_yn=""; 
	     }
		String oper_stn_id			    = checkForNull(request.getParameter("oper_stn_id"));
		String patFlag =checkForNull(request.getParameter("patFlag"));
		String referal_id				= checkForNull(request.getParameter("referral_id"));
		String user_id 					= (String)session.getValue("login_user") ;
		StartDate1           = checkForNull(request.getParameter("StartDate1"));
		AllowedDate          = checkForNull(request.getParameter("AllowedDate"));
		bl_interface_yn      = checkForNull(request.getParameter("bl_interface_yn"));
		visit_back_yn		 = checkForNull(request.getParameter("visit_back_yn"));
		start_date			 = checkForNull(request.getParameter("start_date"));
        entitlement_by_cat_yn=checkForNull(request.getParameter("entitlement_by_cat_yn"));
		if(entitlement_by_cat_yn.equals("")) entitlement_by_cat_yn = "N";
        String HcExpired				= request.getParameter("HcExpired");
			  if (HcExpired==null) HcExpired = "N";
	    String ChgToVisitorGrp		 = request.getParameter("ChgToVisitorGrp");                        		  if(ChgToVisitorGrp==null)   ChgToVisitorGrp = "";
	
		//if(!AllowedDate.equals(""))
		//AllowedDate=AllowedDate.substring(0,16);

		//StartDate1=DateUtils.convertDate(StartDate1,"DMYHMS","en",locale);
		AllowedDate=DateUtils.convertDate(AllowedDate,"DMYHMS","en",locale);
		
		/*Added by Ashwini on 18-Dec-2017 for ML-MMOH-CRF-0657*/
		String invoke_recall	= checkForNull(request.getParameter("invoke_recall"));
		String enc_id			= checkForNull(request.getParameter("enc_id"));
		/*ML-MMOH-CRF-0657*/
	   
        // added on 8/25/2003 for billing interface
		//PreparedStatement pstmt2	 =	null;  
		String visit_charge_stage	 =	"";
		String record				 =	"N";
        float outst_amt				 =	0;       
		String outst_amt1			 =	"0";
		String episode = "Y";
		String org_type_data ="";

		//Patient Contact Address

		String	 a_res_addr_line1	= "";
	    String a_res_addr_line2		= "";
	    String a_res_addr_line3		= "";
	    String a_res_addr_line4		= "";
	    String a_country_code		= "";
	    String a_postal_code		= "";
		String a_postal_code1	    = "";
	    String a_res_area			= "";
	    String a_res_area_code		= "";
	    String a_res_town2_code		= "";
	    String a_res_town2_desc		= "";
	    String a_res_region_code	= "";
	    String a_res_region_desc	= "";

	    String m_res_addr_line1		= "";
	    String m_res_addr_line2		= "";
	    String m_res_addr_line3		= "";
	    String m_res_addr_line4		= "";
	    String m_postal_code		= "";
		String m_postal_code1		= "";
		String m_country_code		= "";
		String m_res_area_code		= "";
		String m_res_area_desc		= "";
		String m_res_town2_code		= "";
		String m_res_town2_desc		= "";
		String m_res_region_code	= "";
		String m_res_region_desc	= "";
		String strPrimaryResNo		= "";
		String strOtherResNo		= "";
		String strEmail				= "";

		String country1_desc		= "";
		String country2_desc		= "";
		StringBuffer contactAddress=new StringBuffer();
		StringBuffer sqlRef = new StringBuffer();
		StringBuffer sqlAlt = new StringBuffer();
	    String nat_id_check_digit_id = "";
	    String nat_id_chk_len        = "";
		String nat_id_onKeyPress     = "";
		String postal1_desc			 = "";
		String postal2_desc          = "";
		String postal3_desc          = "";
		
		String sql1="";
		Boolean isPriorityZoneAppl			=	false;//Added By Shanmukh for MMS-DM-CRF-0147
		String patient_id_length	 = ""; // added by mujafar for ML-MMOH-CRF-0632

		String optSelected			 = "";//Added by Rameswar on 28-Nov-15 for GDOH-CRF-0004.1
		
		/*Added by Thamizh selvi on 25th Jan 2018 against ML-MMOH-CRF-0601 Start*/
		String alt_addr_line1 = "",alt_addr_line2="",alt_addr_line3="";
		String alt_addr_line4 = "",alt_country_code="", alt_country_desc="", alt_postal_code="";
		String alt_postal_desc = "", alt_area_desc	= "", alt_area_code="",alt_town_code="";
		String alt_town_desc = "",alt_region_code="", alt_region_desc = ""; 
		boolean isAlternateAddressAppl = false;
		/*End*/
		
//Below line added for this CRF GDOH-CRF-0129
		String assigncare_location_code="",assigncare_location_desc="",assigncareloctype="";
		Boolean isReferral=false;
		Boolean isCurrentEncounter=false;
		ArrayList arrIPList=null;
		ArrayList arrOPList=null; 
		String referralforcurrentencounter="";
//End GDOH-CRF-0129

      /*Below line added for this CRF ML-MMOH-CRF-0629*/
	    Boolean isRegisterAttn=false;
	  /*End this CRF ML-MMOH-CRF-0629*/

		Boolean isCaseDtlsRadioBtnAppl	= false;//Added by Thamizh selvi on 20th Mar 2018 against ML-MMOH-CRF-645

		Boolean isMechInjLabelChngAppl	= false;//Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-649

		Boolean resiAddMailAdd = false;  //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
		
		Boolean isAENextofKinchngAppl   = false; // Added by mujafar for ML-MMOH-CRF-0632
		
		/*Added by Thamizh selvi on 7th Aug 2018 against ML-MMOH-CRF-1177 Start*/
		Boolean isAutoPopulateNOKDOBAppl = false;
		String natInvokeRoutine = "";
		String natDataSourceId = "";
		/*End*/

	/*
		String p_facility_id = request.getParameter("p_facility_id")==null?"":request.getParameter("p_facility_id");

		String p_patient_id = request.getParameter("p_patient_id")==null?"":request.getParameter("p_patient_id");
		String p_episode_type = request.getParameter("p_episode_type")==null?"":request.getParameter("p_episode_type");
	*/

 try{
        con = ConnectionManager.getConnection(request);
		Boolean isForm60Available	= CommonBean.isSiteSpecific(con, "MP","REG_PAT_ALT_ID3_PAN_CARD");//Added by Dharma on 3rd Feb 2016 for KDAH-CRF-0331 [IN058799]

		Boolean validationForPanCardAvail	= CommonBean.isSiteSpecific(con, "MP","GENERATE_FORM_60"); //Added by Sangeetha on  10/apr/17 for KDAH-CRF-0347

	/*Added by Rameswar on 08-Feb-16 for GDOH-CRF-081*/
	isPriorityZoneAppl			= CommonBean.isSiteSpecific(con, "AE", "PRIORITY_ZONE");//Added By Shanmukh for MMS-DM-CRF-0147
	Boolean isPracApplicable	= CommonBean.isSiteSpecific(con, "AE","PRACT_MANDATORY_AE"); 
	/*Below line(s) added by venkateshs against ML-MMOH-CRF-0354 [IN057191] */
	boolean siteSpecific		=eCommon.Common.CommonBean.isSiteSpecific(con, "MR","MLC_TO_MEDICO_LEGAL_CASE"); 
	/*end ML-MMOH-CRF-0354 [IN057191] */
	
	Boolean isLabelChngAppl = CommonBean.isSiteSpecific(con, "AE","LABEL_CHG_BR_DEAD_PLACE_ACCDNT"); //Added by Ashwini on 18-Jan-2017 for GDOH-CRF-0131 and GDOH-CRF-0123
	
	boolean allowSplChar =eCommon.Common.CommonBean.isSiteSpecific(con, "AE","ALLOW_SPLCHAR_DISASTERREF"); //Added by Mano on 26-Apr-2017
	
	Boolean isPlaceOfOccuurrence = eCommon.Common.CommonBean.isSiteSpecific(con, "AE","PLACE_OF_OCCURRENCE"); // Added by mujafar for ML-MMOH-CRF-0647

	isAlternateAddressAppl = eCommon.Common.CommonBean.isSiteSpecific(con, "MP","ALTERNATE_ADDRESS_APPLICABLE");//Added by Thamizh selvi on 1st Feb 2018 against ML-MMOH-CRF-0601

	isCaseDtlsRadioBtnAppl = eCommon.Common.CommonBean.isSiteSpecific(con, "AE","SEC_TRIAGE_CASE_DETAILS");//Added by Thamizh selvi on 20th Mar 2018 against ML-MMOH-CRF-645

	isMechInjLabelChngAppl = eCommon.Common.CommonBean.isSiteSpecific(con, "AE","RENAME_MECH_INJ_SUB_INJ");//Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-649
	
	isAENextofKinchngAppl  = eCommon.Common.CommonBean.isSiteSpecific(con, "AE","AE_NEXT_OF_KIN_CHNG_APPL"); // Added by mujafar for ML-MMOH-CRF-0632

	isAutoPopulateNOKDOBAppl = eCommon.Common.CommonBean.isSiteSpecific(con, "MP","AUTO_POPULATE_NOK_DOB");//Added by Thamizh selvi on 6th Aug 2018 against ML-MMOH-CRF-1177

	resiAddMailAdd   	=eCommon.Common.CommonBean.isSiteSpecific(con, "MP","BMI_REG_PAT_CHNGES_RH101");//Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
	
	
	//Added for this CRF ML-MMOH-CRF-0860.2	
	String maximumLength="30";
	String maxsize="30";
	Boolean increasedaddressLength = eCommon.Common.CommonBean.isSiteSpecific(con, "MP","INCREASED_ADDRESS_LINE_LENGTH");
	if(increasedaddressLength){
	maximumLength="50";	
	//maxsize="58";
	maxsize="64";
	}
	//End ML-MMOH-CRF-0860.2

	/*Below line added for this CRF ML-MMOH-CRF-0629*/
	  isRegisterAttn=CommonBean.isSiteSpecific(con, "AE","REGISTER_ATTENDANCE");	  
		String priorityRed="";
		 if(isRegisterAttn){
			priorityRed="priorityZoneRed();";
		 }	
	//End this CRF ML-MMOH-CRF-0629
	
	//Below line added for this GDOH-CRF-0129
  isReferral=CommonBean.isSiteSpecific(con, "IP","REGISTER_REFERRAL");  
	 if(isReferral){
		arrIPList=(ArrayList)ReferralCurrentEncounterDetails.getIPCurrentEncounterDetails(con,patient_id,facilityId,p);
			 for(int ip=0; ip<arrIPList.size(); ip++){
					ReferralCurrentEncounterDetailsBean ipEncounterDetails=(ReferralCurrentEncounterDetailsBean)arrIPList.get(ip); 
					assigncare_location_code=ipEncounterDetails.getAssigncareloccode();
					assigncare_location_desc=ipEncounterDetails.getAssigncarelocdesc();
					assigncareloctype=ipEncounterDetails.getAssigncareloctype();
					referralforcurrentencounter="disabled";
					isCurrentEncounter=true;
					
			 }
	 if(arrIPList.size()==0){
		arrOPList=(ArrayList)ReferralCurrentEncounterDetails.getOPCurrentEncounterDetails(con,patient_id,facilityId,p);
			 for(int op=0; op<arrOPList.size(); op++){
					ReferralCurrentEncounterDetailsBean opEncounterDetails=(ReferralCurrentEncounterDetailsBean)arrOPList.get(op); 
					assigncare_location_code=opEncounterDetails.getAssigncareloccode();
					assigncare_location_desc=opEncounterDetails.getAssigncarelocdesc();
					assigncareloctype=opEncounterDetails.getAssigncareloctype();
					referralforcurrentencounter="disabled";
					isCurrentEncounter=true;
			}
		  }
	 }
 //End GDOH-CRF-0129
	

	String enablePrac="";
	if(isPracApplicable){
	enablePrac="enablePrac();";
	} /*Added by Rameswar on 08-Feb-16 for GDOH-CRF-081*/
		try{



		contact_addr = fetchContactAddresses(con, out, "parent.parent.messageFrame",propertiesBill) ;
		/* below lines are add by venkateshs on 29/06/2012 against  the crf  SKR-CRF-0021 [IN028173] */
		sql="SELECT PRIORITY_ZONE,PRIORITY_ZONE_DESC FROM AE_PRIORITY_ZONE_LANG_VW WHERE LANGUAGE_ID= ? and EFF_STATUS='E'";
				
			    pstmt   = con.prepareStatement(sql.toString());
				pstmt.setString(1,locale) ;
			    rset    = pstmt.executeQuery();
				while(rset!=null && rset.next())
				{
			     color      =rset.getString("PRIORITY_ZONE");
				 if (color.equals("G")) {green=rset.getString("PRIORITY_ZONE_DESC");}
				 if (color.equals("R")){red=rset.getString("PRIORITY_ZONE_DESC");}
				 if (color.equals("Y")){yellow=rset.getString("PRIORITY_ZONE_DESC");}
				 if (color.equals("U")){unassigned=rset.getString("PRIORITY_ZONE_DESC");}
				}
			/* CRF  SKR-CRF-0021 [IN028173] end  */
		    }catch(Exception e){e.printStackTrace();}
		contact_col_names = (String[])contact_addr.get(1) ;
		contact_prompts   = (String[])contact_addr.get(2) ; 
		contact_fields    = (String[])contact_addr.get(3) ;
		contact_addr = null;

	 int reccnt = 0;
	/* if (bl_install_yn.equals("Y"))
      {	
			  if(!patient_id.equals(""))
              {
				  StringBuffer sqlBLFin = new StringBuffer();
                  sqlBLFin.append("select nvl(tot_def_pat_outst_amt,0) from ");
				  sqlBLFin.append(" bl_patient_fin_dtls where patient_id= ?  ");
				  pstmt2  = con.prepareStatement(sqlBLFin.toString());
                  pstmt2.setString(1,patient_id);
                  rs = pstmt2.executeQuery();     
                  if (rs!=null) 
                  {
                    while (rs.next())
                    {
                        //reccnt = 1;
//                        record="Y";		
                        outst_amt = rs.getFloat(1);
                    }
                  }
				  if (rs != null)   rs.close();
				  if (pstmt2 != null) pstmt2.close();

				  if((sqlBLFin != null) && (sqlBLFin.length() > 0))
				   {
					 sqlBLFin.delete(0,sqlBLFin.length());
				   }
				   reccnt = 1;
			       record="Y";
              }
			 // if (pstmt2 != null) pstmt2.close();
             // if (rs != null)   rs.close();
	    }*/

     if (bl_interface_yn.equals("Y") && bl_install_yn.equals("Y"))
      {
    /*       //calculate outstanding amount if outstanding amount > 0 then display at the end of patient line(blinking)          
  	       CallableStatement cstmt =null;
             try 
             {    
 				// MOD#02 The following statements were commented and the new code is 
 				// introduced between line 457 and line 471   AND IN 483
 				BLFunctionalValidation blFunction  = new BLFunctionalValidation();
 				Hashtable blData = new Hashtable();
 				blData.put("patient",patient_id);
 				blData.put("facilityid",facilityId);
 				blData.put("bl_install_yn",bl_install_yn);
 				blData.put("bl_interface_yn",bl_interface_yn);
 
 				Hashtable blResult = blFunction.billPatientService(propertiesBill,con,blData); 
 				if (blResult != null)
 	                outst_amt = ((Float)blResult.get("outst_amt")).floatValue();
 				else
 					outst_amt =0;
 				blFunction = null;

			   reccnt = 1;
			   record="Y";

				if (cstmt != null) cstmt.close();
			}
            catch (Exception e)
            {
               	outst_amt = 0;
                out.println("Error in calling procedure BL_CALCULATE_OUTST_AMT "+e);
            }
	      // End of Billing
          outst_amt1 = ""+outst_amt;
          CurrencyFormat cf1 = new CurrencyFormat();
          outst_amt1 = cf1.formatCurrency(outst_amt1, 2);

		    sql="select BLCOMMON.IS_AUTH_WINDOW_REQUIRED('"+facilityId+"', '"+patient_id+"','E') from dual";
			pstmt = con.prepareStatement(sql);

			rs = pstmt.executeQuery();

			if(rs!=null && rs.next()) {
				auth_win_reqd_yn = rs.getString(1);
			}
            } */

		CallableStatement call = con.prepareCall("{ ? = call  BLCOMMON.IS_AUTH_WINDOW_REQUIRED('"+facilityId+"', '"+patient_id+"','E',?)}");

		call.registerOutParameter(1, java.sql.Types.VARCHAR);
		call.registerOutParameter(2, java.sql.Types.VARCHAR); 
				
		call.execute(); 
			
		auth_win_reqd_yn = call.getString(1);
		outst_amt1 = call.getString(2);			
	
		CurrencyFormat cf1 = new CurrencyFormat();
		outst_amt1 = cf1.formatCurrency(outst_amt1, 2);
		reccnt = 1;
		record="Y";	

		if(call!=null)
		call.close();
     //   out.println("<script>alert('"+auth_win_reqd_yn+"');</script>");
     //   out.println("<script> alert("+outst_amt1+");</script>");
   }
      
     // End of billing  
	 /* Wednesday, May 05, 2010 venkat s 
	StringBuffer displLastVisit = new StringBuffer();
	displLastVisit.append(" SELECT ENCOUNTER_ID from OP_PATIENT_QUEUE where  ");
	displLastVisit.append(" QUEUE_DATE = (SELECT max(QUEUE_DATE) ");
	displLastVisit.append(" from OP_PATIENT_QUEUE where PATIENT_ID = ? and   ");
	displLastVisit.append(" QUEUE_STATUS !='99'  and FACILITY_ID = ? and ");
	displLastVisit.append(" PATIENT_CLASS = 'EM') ");
	displLastVisit.append(" and PATIENT_ID = ? and  QUEUE_STATUS !='99' ");
	displLastVisit.append(" and FACILITY_ID = ? and patient_class='EM'");
    try{
		   pstmt = con.prepareStatement(displLastVisit.toString());
		   pstmt.setString(1,patient_id);
		   pstmt.setString(2,facilityId);
		   pstmt.setString(3,patient_id);
		   pstmt.setString(4,facilityId);
		   rset = pstmt.executeQuery();
		   while(rset!=null && rset.next())
		   {
				last_encounter_id = rset.getString(1);
		   }
		   if(rset!=null) rset.close();
		   if(pstmt!=null) pstmt.close();
		   if((displLastVisit != null) && (displLastVisit.length() > 0))
		   {
				displLastVisit.delete(0,displLastVisit.length());
		   }
	 }catch(Exception e)
     {
        out.println("Exception in CAInstall ="+e);
					e.printStackTrace();
     }

	 */
	try{ 
				 
    // Arrival Tab 
	 //added changes  HSA-CRF-0226 [IN:050599]
      String mp_sql="select upt_contact_dtls_oa_yn,patient_id_length  from MP_PARAM where  MODULE_ID='MP' "; // modified by mujafar for ML-MMOH-CRF-0632
      pstmt = con.prepareStatement(mp_sql);
	 rset=pstmt.executeQuery();
	 String upt_contact_dtls_oa_yn="";
	 if(rset != null && rset.next()){
     upt_contact_dtls_oa_yn=rset.getString("upt_contact_dtls_oa_yn");
	 patient_id_length = rset.getString("patient_id_length"); // added by mujafar for ML-MMOH-CRF-0632
	}  
	if(rset != null) rset.close();
    if(pstmt!=null)pstmt.close();
 //end changes for HSA-CRF-0226 [IN:050599]

    String sqlRelation =  "select RELATIONSHIP_CODE,SHORT_DESC from MP_RELATIONSHIP_LANG_VW where language_id='"+locale+"' and EFF_STATUS='E'  order by SHORT_DESC ";	
	
	pstmt_race = con.prepareStatement(sqlRelation);
	rset_race  = pstmt_race.executeQuery();
	
	while (rset_race != null && rset_race.next()) {		
		race_array.add(checkForNull(rset_race.getString("RELATIONSHIP_CODE")));
		race_array.add(checkForNull(rset_race.getString("SHORT_DESC")));			
	}	
	
	if(rset_race != null) rset_race.close();
	if(pstmt_race != null) pstmt_race.close();

	StringBuffer episodeDisp = new StringBuffer();
	episodeDisp.append(" select BUILD_EPISODE_RULE ");
	episodeDisp.append(" from OP_PARAM ");
	episodeDisp.append(" where operating_facility_id= ?  ");

    StringBuffer nationalDisp = new StringBuffer();
	nationalDisp.append("select  a.NATIONAL_ID_NO, MP_GET_DESC.MP_ALTERNATE_ID_TYPE(b.ALT_ID1_TYPE,'"+locale+"','1') ALT_ID1_DESC,MP_GET_DESC.MP_ALTERNATE_ID_TYPE(b.ALT_ID2_TYPE,'"+locale+"','1') ALT_ID2_DESC,MP_GET_DESC.MP_ALTERNATE_ID_TYPE(b.ALT_ID3_TYPE,'"+locale+"','1') ALT_ID3_DESC,MP_GET_DESC.MP_ALTERNATE_ID_TYPE(b.ALT_ID4_TYPE,'"+locale+"','1') ALT_ID4_DESC, a.NATIONALITY_CODE, MP_GET_DESC.MP_COUNTRY(a.NATIONALITY_CODE,'"+locale+"','3') short_desc, a.ALT_ID1_NO,a.ALT_ID2_NO,a.ALT_ID3_NO,a.ALT_ID4_NO,MP_GET_DESC.MP_ALTERNATE_ID_TYPE(a.OTH_ALT_ID_TYPE,'"+locale+"','1') OTH_ALT_ID_DESC, a.OTH_ALT_ID_NO, a.SEX, floor((sysdate-date_of_birth)/365) patient_age, to_char(REGN_DATE,'dd/mm/yyyy hh24:mi') regn_date, to_char(DATE_OF_BIRTH,'dd/mm/yyyy') date_of_birth,  A.CITIZEN_YN RESIDENCY, A.LEGAL_YN  LEGAL_STATUS,  b.ALT_ID1_TYPE,  b.NAT_ID_PROMPT,b.ACCEPT_NATIONAL_ID_NO_YN, b.nat_id_accept_alphanumeric_yn, b.NAT_ID_LENGTH, b.ACCEPT_OTH_ALT_ID_YN , a.DECEASED_YN, C.BLOOD_GRP, MR_GET_DESC.MR_BLOOD_GRP(C.BLOOD_GRP,'"+locale+"','2') BLOOD_GRP_DESC, C.RH_FACTOR RHESUS_FACTOR_CODE,MR_GET_DESC.MR_RHESUS_FACTOR(C.RH_FACTOR,'"+locale+"','2') rh_factor_desc,  D.contact1_name, D.contact1_relation, D.contact1_nat_id_no, to_char(D.contact1_birth_date,'dd/mm/rrrr')  contact1_birth_date, D.job1_title, D.addr1_line1, D.addr1_line2,  D.addr1_line3, D.addr1_line4, D.contact1_res_town_code, MP_GET_DESC.MP_RES_TOWN(D.contact1_res_town_code,'"+locale+"','1') contact1_res_town_desc,  D.contact1_res_area_code, MP_GET_DESC.MP_RES_AREA(D.contact1_res_area_code,'"+locale+"','1') contact1_res_area__desc,  D.contact1_region_code, MP_GET_DESC.MP_REGION(D.contact1_region_code,'"+locale+"','1')  contact1_region_desc, D.postal1_code,MP_GET_DESC.MP_POSTAL_CODE(D.postal1_code,'"+locale+"','2') postal1_desc, D.country1_code, MP_GET_DESC.MP_COUNTRY(D.country1_code,'"+locale+"','1') country1_code_desc, D.res1_tel_no,  D.contact1_mob_tel_no, D.off1_tel_no, D.contact1_email_id,  D.contact2_name, D.contact2_relation, D.contact2_nat_id_no,  D.job2_title, D.contact2_res_town_code, MP_GET_DESC.MP_RES_TOWN(D.contact2_res_town_code,'"+locale+"','1') contact2_res_town_desc, D.res2_tel_no,  D.contact2_mob_tel_no,  D.off2_tel_no, D.contact2_email_id, D.addr2_line1, D.addr2_line2,  D.addr2_line3, D.addr2_line4, D.contact2_res_area_code,  MP_GET_DESC.MP_RES_AREA(D.contact2_res_area_code,'"+locale+"','1') contact2_res_area__desc,  D.contact2_region_code, MP_GET_DESC.MP_REGION(D.contact2_region_code,'"+locale+"','1') contact2_region_desc, D.postal2_code,MP_GET_DESC.MP_POSTAL_CODE(D.postal2_code,'"+locale+"','2') postal2_desc, D.country2_code, MP_GET_DESC.MP_COUNTRY(D.country2_code,'"+locale+"','1') country2_code_desc, D.organization_name,  D.contact3_name, D.addr3_line1, D.addr3_line2, D.addr3_line3,  D.addr3_line4, D.contact3_res_town_code, MP_GET_DESC.MP_RES_TOWN(D.contact3_res_town_code,'"+locale+"','1') contact3_res_town_desc,  D.contact3_res_area_code, MP_GET_DESC.MP_RES_AREA(D.contact3_res_area_code,'"+locale+"','1') contact3_res_area__desc,  D.contact3_region_code, MP_GET_DESC.MP_REGION(D.contact3_region_code,'"+locale+"','1') contact3_region_desc, D.postal3_code,MP_GET_DESC.MP_POSTAL_CODE(D.postal3_code,'"+locale+"','2') postal3_desc, D.country3_code, MP_GET_DESC.MP_COUNTRY(D.country3_code,'"+locale+"','1') country3_code_desc, D.res3_tel_no,  D.off3_tel_no, D.patient_employee_id, D.ocpn_class_code,  D.ocpn_code, D.ocpn_desc, D.employment_status,to_char(sysdate,'dd/mm/yyyy hh24:mi:ss') sys, to_char(sysdate,'dd/mm/yyyy') sys1,b.nat_id_check_digit_id,b.nat_id_chk_len,b.invoke_routine,b.nat_data_source_id, D.nk_mail_addr_line1, D.nk_mail_addr_line2,  D.nk_mail_addr_line3, D.nk_mail_addr_line4, D.nk_mail_town_code, MP_GET_DESC.MP_RES_TOWN(D.nk_mail_town_code,'"+locale+"','1') n_contact_ma_town_desc, D.nk_mail_region_code, MP_GET_DESC.MP_REGION(D.nk_mail_region_code,'"+locale+"','1')  n_contac_region_desc, D.nk_mail_area_code, MP_GET_DESC.MP_RES_AREA(D.nk_mail_area_code,'"+locale+"','1') n_contact_ma_area_desc, D.nk_mail_postal_code,MP_GET_DESC.MP_POSTAL_CODE(D.nk_mail_postal_code,'"+locale+"','2') nkpostal1_desc, D.nk_mail_country_code, MP_GET_DESC.MP_COUNTRY(D.nk_mail_country_code,'"+locale+"','1') nk_mail_country_desc, D.nk_res_contact_name, D.nk_mail_contact_name,D.nk_contact3_mode nk_contact3_mode, (CASE WHEN D.nk_contact3_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.nk_contact3_mode,'"+locale+"',2)) END ) nk_contact3_mode_desc, D.nk_contact3_no nk_contact3_no, D.nk_contact4_mode nk_contact4_mode, (CASE WHEN D.nk_contact4_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.nk_contact4_mode,'"+locale+"',2)) END ) nk_contact4_mode_desc, D.nk_contact4_no nk_contact4_no, D.nk_contact5_mode nk_contact5_mode, (CASE WHEN D.nk_contact5_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.nk_contact5_mode,'"+locale+"',2)) END ) nk_contact5_mode_desc, D.nk_contact5_no nk_contact5_no,D.fton_mail_addr_line1, D.fton_mail_addr_line2,  D.fton_mail_addr_line3, D.fton_mail_addr_line4, D.fton_mail_town_code, MP_GET_DESC.MP_RES_TOWN(D.fton_mail_town_code,'"+locale+"','1') fst_to_no_ma_town_desc, D.fton_mail_region_code, MP_GET_DESC.MP_REGION(D.fton_mail_region_code ,'"+locale+"','1')  fst_to_no_ma_reg_desc, D.fton_mail_area_code, MP_GET_DESC.MP_RES_AREA(D.fton_mail_area_code,'"+locale+"','1') fst_to_no_ma_area_desc, D.fton_mail_postal_code,MP_GET_DESC.MP_POSTAL_CODE(D.fton_mail_postal_code,'"+locale+"','2') ftonpostal1_desc, D.fton_mail_country_code, MP_GET_DESC.MP_COUNTRY(D.fton_mail_country_code,'"+locale+"','1') fton_mail_country_desc, D.fton_res_contact_name, D.fton_mail_contact_name,D.fton_contact3_mode fton_contact3_mode, (CASE WHEN D.fton_contact3_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.fton_contact3_mode,'"+locale+"',2)) END ) fton_contact3_mode_desc, D.fton_contact3_no fton_contact3_no, D.fton_contact4_mode fton_contact4_mode, (CASE WHEN D.fton_contact4_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.fton_contact4_mode,'"+locale+"',2)) END ) fton_contact4_mode_desc, D.fton_contact4_no fton_contact4_no, D.fton_contact5_mode fton_contact5_mode, (CASE WHEN D.fton_contact5_mode IS NOT NULL THEN (mp_get_desc.mp_contact_mode(D.fton_contact5_mode,'"+locale+"',2)) END ) fton_contact5_mode_desc, D.fton_contact5_no fton_contact5_no from MP_PATIENT A, MP_PARAM_LANG_VW B,  MP_PAT_OTH_DTLS C, MP_PAT_REL_CONTACTS D  where  B.module_id='MP' AND B.language_id = '"+locale+"' and A.patient_id = C.patient_id  and A.patient_id =D.patient_id and A.patient_id=?  ");//Modified by Thamizh selvi on 7th Aug 2018 against ML-MMOH-CRF-1177
     //Query modified by Suji keerthi for ML-MMOH-CRF-1527 US008
    StringBuffer  displaycontactdet =new StringBuffer();

	if(!referal_id.equals(""))
		{
			displaycontactdet.append("SELECT TO_LOCN_TYPE,TO_LOCN_CODE,TO_SERVICE_CODE,addr_line1 addr1_line1,addr_line2  addr1_line2,addr_line3 addr1_line3,addr_line4 addr1_line4,res_town_code, MP_GET_DESC.MP_RES_TOWN(RES_TOWN_CODE,'"+locale+"','1') res_town,res_area_code, MP_GET_DESC.MP_RES_AREA(RES_AREA_CODE,'"+locale+"','1') res_area, region_code,MP_GET_DESC.MP_REGION(region_code,'"+locale+"','1') region,   country_code country1_code, MP_GET_DESC.MP_COUNTRY(country_code,'"+locale+"','1') country1_desc,nvl(postal_code,'')  postal1_code,MP_GET_DESC.MP_POSTAL_CODE(postal_code,'"+locale+"','2') postal1_desc,mail_addr_line1 addr2_line1,  mail_addr_line2 addr2_line2,  mail_addr_line3 addr2_line3,  mail_addr_line4 addr2_line4,  mail_res_town_code res_town2_code, MP_GET_DESC.MP_RES_TOWN(mail_res_town_code,'"+locale+"','1') res_town2,  mail_res_area_code res_area2_code, MP_GET_DESC.MP_RES_AREA(mail_res_area_code,'"+locale+"','1') res_area2,mail_region_code region2_code, MP_GET_DESC.MP_REGION(MAIL_REGION_CODE,'"+locale+"','1') region2_desc, mail_country_code country2_code, MP_GET_DESC.MP_COUNTRY(mail_country_code,'"+locale+"','1') country2_desc, mail_postal_code postal2_code,MP_GET_DESC.MP_POSTAL_CODE(mail_postal_code,'"+locale+"','2') postal2_desc,contact1_no,  contact2_no,email_id, alt_addr_line1, alt_addr_line2,  alt_addr_line3,  alt_addr_line4, alt_town_code, MP_GET_DESC.MP_RES_TOWN(alt_town_code,'"+locale+"','1') alt_town_desc,  alt_area_code, MP_GET_DESC.MP_RES_AREA(alt_area_code,'"+locale+"','1') alt_area_desc, alt_region_code, MP_GET_DESC.MP_REGION(alt_region_code,'"+locale+"','1') alt_region_desc, alt_country_code, MP_GET_DESC.MP_COUNTRY(alt_country_code,'"+locale+"','1') alt_country_desc, alt_postal_code, MP_GET_DESC.MP_POSTAL_CODE(alt_postal_code,'"+locale+"','2') alt_postal_desc FROM pr_referral_register WHERE  referral_id = '"+referal_id+"'");//Modified by Thamizh selvi on 1st Feb 2018 against ML-MMOH-CRF-0601
		}
		else
		{
			displaycontactdet.append("SELECT a.addr1_type,a.addr1_line1,a.addr1_line2, a.addr1_line3,addr1_line4, nvl(a.postal1_code,'') postal1_code,MP_GET_DESC.MP_POSTAL_CODE(a.postal1_code,'"+locale+"','2') postal1_desc, a.country1_code, MP_GET_DESC.MP_COUNTRY(a.country1_code,'"+locale+"','1') country1_desc, a.contact1_name, a.invalid1_yn, MP_GET_DESC.MP_RES_AREA(b.RES_AREA_CODE,'"+locale+"','1') res_area,  b.res_area_code ,MP_GET_DESC.MP_RES_TOWN(b.RES_TOWN_CODE,'"+locale+"','1') res_town, b.res_town_code , MP_GET_DESC.MP_REGION(b.region_code,'"+locale+"','1') region, b.region_code, a.addr2_type, a.addr2_line1, a.addr2_line2, a.addr2_line3, a.addr2_line4, a.postal2_code, MP_GET_DESC.MP_POSTAL_CODE(a.postal2_code,'"+locale+"','2') postal2_desc, a.country2_code, MP_GET_DESC.MP_COUNTRY(a.country2_code,'"+locale+"','1') country2_desc, a.contact2_name, a.invalid2_yn, MP_GET_DESC.MP_RES_AREA(a.res_area2_code,'"+locale+"','1') res_area2, a.res_area2_code, MP_GET_DESC.MP_RES_TOWN(a.res_town2_code,'"+locale+"','1') res_town2, a.res_town2_code, MP_GET_DESC.MP_REGION(region2_code,'"+locale+"','1') region2_desc,  a.region2_code, b.CONTACT1_NO, b.CONTACT2_NO,  b.EMAIL_ID, a.alt_addr_line1, a.alt_addr_line2,  a.alt_addr_line3,  a.alt_addr_line4, a.alt_town_code, MP_GET_DESC.MP_RES_TOWN(a.alt_town_code,'"+locale+"','1') alt_town_desc,  a.alt_area_code, MP_GET_DESC.MP_RES_AREA(a.alt_area_code,'"+locale+"','1') alt_area_desc, a.alt_region_code, MP_GET_DESC.MP_REGION(a.alt_region_code,'"+locale+"','1') alt_region_desc, a.alt_country_code, MP_GET_DESC.MP_COUNTRY(a.alt_country_code,'"+locale+"','1') alt_country_desc, a.alt_postal_code, MP_GET_DESC.MP_POSTAL_CODE(a.alt_postal_code,'"+locale+"','2') alt_postal_desc FROM mp_pat_addresses a , MP_PATIENT b WHERE b.PATIENT_ID=a.PATIENT_ID  and  b.patient_id='"+patient_id+"'");//Modified by Thamizh selvi on 1st Feb 2018 against ML-MMOH-CRF-0601
		}
		pstmt    = con.prepareStatement(displaycontactdet.toString()) ;
		rset = pstmt.executeQuery() ;
		if(rset != null && rset.next())
		{
			if(!referal_id.equals("")){
			to_locn_type=checkForNull(rset.getString("TO_LOCN_TYPE"));
			to_locn_code=checkForNull(rset.getString("TO_LOCN_CODE"));
			to_service_code=checkForNull(rset.getString("TO_SERVICE_CODE"));
			}
			a_res_addr_line1  = checkForNull(rset.getString("addr1_line1"));
			a_res_addr_line2  = checkForNull(rset.getString("addr1_line2"));
			a_res_addr_line3  = checkForNull(rset.getString("addr1_line3"));
			a_res_addr_line4  = checkForNull(rset.getString("addr1_line4") );
			a_country_code    = checkForNull(rset.getString("country1_code"));
			a_postal_code     = checkForNull(rset.getString("postal1_code"));
			a_postal_code1    = checkForNull(rset.getString("postal1_desc"));
			a_res_area_code   = checkForNull(rset.getString("res_area_code"));
			a_res_area        = checkForNull(rset.getString("res_area") );			
		    a_res_town2_code  = checkForNull(rset.getString("res_town_code"));
		    a_res_town2_desc  = checkForNull(rset.getString("res_town"));
		    a_res_region_code = checkForNull(rset.getString("region_code"));
			a_res_region_desc = checkForNull(rset.getString("region"));			
			m_res_addr_line1  = checkForNull(rset.getString("addr2_line1"));
			m_res_addr_line2  = checkForNull(rset.getString("addr2_line2"));
			m_res_addr_line3  = checkForNull(rset.getString("addr2_line3"));
			m_res_addr_line4  = checkForNull(rset.getString("addr2_line4"));
			m_postal_code     = checkForNull(rset.getString("postal2_code"));
			m_postal_code1     = checkForNull(rset.getString("postal2_desc"));
			m_country_code    = checkForNull(rset.getString("country2_code"));
			m_res_area_code   = checkForNull(rset.getString("res_area2_code"));
			m_res_area_desc   = checkForNull(rset.getString("res_area2"));
		    m_res_town2_code  = checkForNull(rset.getString("res_town2_code"));
		    m_res_town2_desc  = checkForNull(rset.getString("res_town2"));
		    m_res_region_code = checkForNull(rset.getString("region2_code"));
		    m_res_region_desc = checkForNull(rset.getString("region2_desc"));
		    strPrimaryResNo   = checkForNull(rset.getString("CONTACT1_NO"));
			strOtherResNo     = checkForNull(rset.getString("CONTACT2_NO"));
			strEmail	      = checkForNull(rset.getString("EMAIL_ID"));	
			country1_desc	  = checkForNull(rset.getString("country1_desc"));	
			country2_desc	  = checkForNull(rset.getString("country2_desc"));
			/*Added by Thamizh selvi on 25th Jan 2018 against ML-MMOH-CRF-0601 Start*/
			alt_addr_line1 = checkForNull(rset.getString("alt_addr_line1"));
			alt_addr_line2 = checkForNull(rset.getString("ALT_ADDR_LINE2"));
			alt_addr_line3 = checkForNull(rset.getString("ALT_ADDR_LINE3"));
			alt_addr_line4 = checkForNull(rset.getString("ALT_ADDR_LINE4"));
			alt_country_code  = checkForNull(rset.getString("ALT_COUNTRY_CODE"));
			alt_country_desc  = checkForNull(rset.getString("ALT_COUNTRY_DESC"));
			alt_postal_code    = checkForNull(rset.getString("ALT_POSTAL_CODE"));
			alt_postal_desc    = checkForNull(rset.getString("ALT_POSTAL_DESC"));
			alt_area_code = checkForNull(rset.getString("ALT_AREA_CODE"));
			alt_area_desc = checkForNull(rset.getString("ALT_AREA_DESC"));			
			alt_town_code = checkForNull(rset.getString("ALT_TOWN_CODE"));
			alt_town_desc = checkForNull(rset.getString("ALT_TOWN_DESC"));
			alt_region_code = checkForNull(rset.getString("ALT_REGION_CODE"));
			alt_region_desc = checkForNull(rset.getString("ALT_REGION_DESC"));
			/*End*/

		contactAddress.append(""+"^^");
		contactAddress.append(a_res_addr_line1+"^^");
		contactAddress.append(a_res_addr_line2+"^^");
		contactAddress.append(a_res_addr_line3+"^^");
		contactAddress.append(a_res_addr_line4+"^^");
		contactAddress.append(a_res_town2_code+"^^");
		contactAddress.append(a_res_area_code+"^^");
		contactAddress.append(a_postal_code+"^^");
		contactAddress.append(a_res_region_code+"^^");
		contactAddress.append(a_country_code+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(m_res_addr_line1+"^^");
		contactAddress.append(m_res_addr_line2+"^^");
		contactAddress.append(m_res_addr_line3+"^^");
		contactAddress.append(m_res_addr_line4+"^^");
		contactAddress.append(m_res_town2_code+"^^");
		contactAddress.append(m_res_area_code+"^^");
		contactAddress.append(m_postal_code+"^^");
		contactAddress.append(m_res_region_code+"^^");
		contactAddress.append(m_country_code+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(strPrimaryResNo+"^^");
		contactAddress.append(strOtherResNo+"^^");
		contactAddress.append(strEmail+"^^");
		contactAddress.append(""+"^^");
		contactAddress.append(a_res_town2_desc+"^^");
		contactAddress.append(a_res_area+"^^");
		contactAddress.append(a_res_region_desc+"^^");
		contactAddress.append(m_res_town2_desc+"^^");
		contactAddress.append(m_res_area_desc+"^^");
		contactAddress.append(m_res_region_desc+"^^");
		contactAddress.append(country1_desc+"^^");
		contactAddress.append(country2_desc+"^^");
		contactAddress.append(a_postal_code1+"^^");
		contactAddress.append(m_postal_code1);
		/*Added by Thamizh selvi on 25th Jan 2018 against ML-MMOH-CRF-0601 Start*/
		contactAddress.append(""+"^^");
		contactAddress.append(alt_addr_line1+"^^");
		contactAddress.append(alt_addr_line2+"^^");
		contactAddress.append(alt_addr_line3+"^^");
		contactAddress.append(alt_addr_line4+"^^");
		contactAddress.append(alt_town_code+"^^");
		contactAddress.append(alt_area_code+"^^");
		contactAddress.append(alt_postal_code+"^^");
		contactAddress.append(alt_region_code+"^^");
		contactAddress.append(alt_country_code+"^^");
		contactAddress.append(alt_town_desc+"^^");
		contactAddress.append(alt_area_desc+"^^");
		contactAddress.append(alt_postal_desc+"^^");
		contactAddress.append(alt_region_desc+"^^");
		contactAddress.append(alt_country_desc+"^^");
		/*End*/
		}
		if(rset != null) rset.close(); 
		if(pstmt != null) pstmt.close();
		if((displaycontactdet != null) && (displaycontactdet.length() > 0))
		{
			displaycontactdet.delete(0,displaycontactdet.length());
		}

			// Add Visit
	StringBuffer sqlLocation = new StringBuffer();
// sqlLocation.append("select a.CLINIC_CODE, a.long_desc SHORT_DESC, a.SERVICE_CODE, AM_GET_DESC.AM_SERVICE(a.service_code,'"+locale+"','2') SERVICE_DESC, a.CLINIC_TYPE, a.OPEN_TO_ALL_PRACT_YN, c.gender, a.SPECIALITY_CODE from OP_CLINIC_lang_vw a, (select day_no from  sm_day_of_week where day_of_week =  rtrim(to_char(sysdate,'DAY'))) b, am_age_group c where decode(b.day_no, '1', working_day_1, '2', working_day_2, '3', working_day_3, '4',  working_day_4, '5', working_day_5, '6', working_day_6, '7',working_day_7)='Y' and a.facility_id = ? and language_id = '"+locale+"' and a.clinic_type = 'C' and a.level_of_care_ind = 'E' and a.eff_status = 'E' and  (a.clinic_type, a.clinic_code) in  (select locn_type, locn_code from am_os_user_locn_access_vw where facility_id = ? and Oper_stn_id = ? and  appl_user_id = ?  and register_visit_yn = 'Y') and a.age_group_code = c.age_group_code(+) and ? between nvl(c.min_age,?) and nvl(c.max_age,?) order by 2 ");
// Modified query 14.10.09

	sqlLocation.append("select a.CLINIC_CODE, a.long_desc SHORT_DESC, a.SERVICE_CODE, AM_GET_DESC.AM_SERVICE(a.service_code,'"+locale+"','2') SERVICE_DESC, a.CLINIC_TYPE, a.OPEN_TO_ALL_PRACT_YN, c.gender, a.SPECIALITY_CODE from OP_CLINIC_lang_vw a, (select day_no from  sm_day_of_week where day_of_week =  rtrim(to_char(sysdate,'DAY'))) b, am_age_group c where decode(b.day_no, '1', working_day_1, '2', working_day_2, '3', working_day_3, '4',  working_day_4, '5', working_day_5, '6', working_day_6, '7',working_day_7)='Y' and a.facility_id = ? and language_id = '"+locale+"' and a.clinic_type = 'C' and a.level_of_care_ind = 'E' and a.clinic_code like '%' and a.eff_status = 'E' and  (a.clinic_type, a.clinic_code) in  (select locn_type, locn_code from am_os_user_locn_access_vw where facility_id = ? and Oper_stn_id = ? and locn_type = 'C' and  appl_user_id = ?  and register_visit_yn = 'Y') and a.age_group_code = c.age_group_code(+) and ? between nvl(c.min_age,?) and nvl(c.max_age,?) order by 2 ");

//	"SELECT   a.clinic_code, a.long_desc short_desc, a.service_code, am_get_desc.am_service (a.service_code,'en','2') service_desc, a.clinic_type, a.open_to_all_pract_yn, c.gender, a.speciality_code    FROM op_clinic_lang_vw a, (SELECT day_no FROM sm_day_of_week WHERE day_of_week = RTRIM (TO_CHAR (SYSDATE, 'DAY'))) b, am_age_group c WHERE DECODE (b.day_no, '1', working_day_1, '2', working_day_2, '3', working_day_3, '4', working_day_4, '5', working_day_5, '6', working_day_6, '7', working_day_7 ) = 'Y' AND a.facility_id = 'HS'     AND a.language_id = 'en'     AND a.clinic_type = 'C'     AND a.level_of_care_ind = 'E' ****  AND a.clinic_code like '%' **** AND a.eff_status = 'E'     AND (a.clinic_type, a.clinic_code) IN ( SELECT locn_type, locn_code FROM am_os_user_locn_access_vw WHERE facility_id = 'HS' AND oper_stn_id = 'ALL' **** AND locn_type = 'C' **** AND appl_user_id = 'NAREN' AND register_visit_yn = 'Y')     AND a.age_group_code = c.age_group_code(+)     AND 10 BETWEEN NVL (c.min_age, 9) AND NVL (c.max_age, 150)ORDER BY 2"

	%> 
		
	 <body OnMouseDown='CodeArrest()' onKeyDown = 'lockKey()' onSelect="codeArrestThruSelect()" onLoad="Loc();disReset();enableocpn();">	 
	 <form name="ae_reg_attn_result_form"  action="../../servlet/eAE.AERegisterAttnServlet"  method="post" target="messageFrame"> 
   <div id = 'ADDVISIT'>  
	<!--  <a name="tab1" ></a>  -->
		<table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
            <tr><td class='white'>

		 <ul id="tablist" class="tablist" >
			<li class="tablistitem" title="Add Visit">
				<a class="tabClicked" id='addVisit_tab' >
					<span class="tabSpanclicked" id="addVisit_tabspan" onClick='javascript:expandCollapse("add_Visit_tab")'><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></span>
				</a>
			</li>
			<li class="tablistitem" title="Arrival">
				<a class="tabA" id="arrival_tab" >
					<span class="tabAspan" id="arrival_tabspan" onClick='javascript:expandCollapse("arrival_tab")'><fmt:message key="Common.arrival.label" bundle="${common_labels}"/></span>
				</a>
			</li>
			<li class="tablistitem" title="Related Contact details">
				<a class="tabA" id="rlcnts_tab" >
					<span class="tabAspan" id="rlcnts_tabspan" onClick='javascript:expandCollapse("rel_con_tab")'><fmt:message key="eMP.relatedcontacts.label" bundle="${mp_labels}"/></span>
				</a>
			</li>	
			<%if(bl_install_yn.equals("Y")){%>
			<li class="tablistitem" title="Financial Details">
				<a class="tabA" id="findtl_tab" >
					<span class="tabAspan" id="findtl_tabspan" onClick='javascript:expandCollapse("fin_tab")'><fmt:message key="Common.financialdetails.label" bundle="${common_labels}"/></span>
				</a>
			</li>	
		<%}%>	
</ul>

</td></tr></table>


<% if(!referal_id.equals("")) { %>
        <table border='0' cellpadding='0' cellspacing='0' width='92%' align='center'>
           <tr>
                <th align='left'><fmt:message key="Common.referraldetails.label" bundle="${common_labels}"/></th>
           </tr>
          <%
		   sqlRef.append("select get_referral_detail_line( ?,'FROM',?) from dual "); 
           pstmt  = con.prepareStatement(sqlRef.toString());
		   pstmt.setString(1,referal_id );
		   pstmt.setString(2,locale );

           rset = pstmt.executeQuery() ;
           rset.next() ;
          %>       
          <tr>
              <td  width='75%' id='refdetails' style='position:relative;' class="label"><b><%= (rset.getString(1).substring(2))%></b>
		      </td>
          </tr>
        </table>
      <%if(rset!=null) rset.close();    
		if(pstmt!=null) pstmt.close();}
		if((sqlRef != null) && (sqlRef.length() > 0))
		{
			sqlRef.delete(0,sqlRef.length());
		}		
%>

	<!--Referral details Ends here -->
	   <table border="0" cellpadding="2" cellspacing="0" align='center' width='92%'>
		  <tr>
		         <td class='COLUMNHEADER' colspan='4' ><fmt:message key="Common.PatientDetails.label" bundle="${common_labels}"/></td>
	      </tr>
   		  <tr><td  class=label height=5 colspan='4'></td></tr>

           <%
					   // To get the Patient Sex, Nationality, Expiry Date,Alternate Id,blood grp,rhfactor, Address, etc.
				
					   pstmt = con.prepareStatement(nationalDisp.toString());
					   pstmt.setString(1,patient_id);
					   rset = pstmt.executeQuery();
					   while(rset!=null && rset.next())
					   {
						  nationality_id = checkForNull(rset.getString("NATIONAL_ID_NO"));
						  nationality	 = checkForNull(rset.getString("short_desc"));
						  alt_id1_no= checkForNull(rset.getString("ALT_ID1_NO")); 
						  alt_id1_desc   = checkForNull(rset.getString("ALT_ID1_DESC"));
						  //added for PMG2014-HSA-CRF-0001 [IN:050020]
						  alt_id2_no     = checkForNull(rset.getString("ALT_ID2_NO")); 
						  alt_id2_desc   = checkForNull(rset.getString("ALT_ID2_DESC"));
						  alt_id3_no= checkForNull(rset.getString("ALT_ID3_NO")); 
						  alt_id3_desc   = checkForNull(rset.getString("ALT_ID3_DESC"));
						  alt_id4_no= checkForNull(rset.getString("ALT_ID4_NO")); 
						  alt_id4_desc   = checkForNull(rset.getString("ALT_ID4_DESC"));
						  sex			 = checkForNull(rset.getString("SEX"));
						  oth_alt_id_desc= checkForNull(rset.getString("OTH_ALT_ID_DESC"));
                          oth_alt_id_no	 = checkForNull(rset.getString("OTH_ALT_ID_NO"));
						  residency		 = checkForNull(rset.getString("RESIDENCY"));
						  legal_status	 = checkForNull(rset.getString("LEGAL_STATUS"));
						  patient_age	 = rset.getInt("patient_age");
						  regn_date      = checkForNull(rset.getString("regn_date"));
						  date_of_birth  = checkForNull(rset.getString("date_of_birth"));
						  deceased_yn    = checkForNull(rset.getString("DECEASED_YN"));
						  nat_id_prompt = checkForNull(rset.getString("NAT_ID_PROMPT"));
						  accept_national_id_no_yn = checkForNull(rset.getString("ACCEPT_NATIONAL_ID_NO_YN"));
						  nat_id_accept_alphanumeric_yn = checkForNull(rset.getString("nat_id_accept_alphanumeric_yn"));
                          nat_id_length = checkForNull(rset.getString("NAT_ID_LENGTH"));
						  accept_oth_alt_id_yn = checkForNull(rset.getString("ACCEPT_OTH_ALT_ID_YN"));
						  //alt_id1_type = checkForNull(rset.getString("ALT_ID1_TYPE"));
						  blood_group = checkForNull(rset.getString("BLOOD_GRP_DESC"));
						  blood_group_code =checkForNull(rset.getString("BLOOD_GRP"));
						  rh_factor   = checkForNull(rset.getString("rh_factor_desc"));
						  rh_factor_code = checkForNull(rset.getString("RHESUS_FACTOR_CODE"));
						  contact1_relation	     = checkForNull(rset.getString("CONTACT1_RELATION"));
						  contact1_name		     = checkForNull(rset.getString("CONTACT1_NAME"));
							contact1_nat_id_no       = checkForNull(rset.getString("CONTACT1_NAT_ID_NO"));
							contact1_birth_date      = checkForNull(rset.getString("CONTACT1_BIRTH_DATE"));
							job1_title			     = checkForNull(rset.getString("JOB1_TITLE"));
							addr1_line1			     = checkForNull(rset.getString("ADDR1_LINE1"));
							addr1_line2			     = checkForNull(rset.getString("ADDR1_LINE2"));
							addr1_line3			     = checkForNull(rset.getString("ADDR1_LINE3"));
							addr1_line4			     = checkForNull(rset.getString("ADDR1_LINE4"));
							contact1_res_town        = checkForNull(rset.getString("CONTACT1_RES_TOWN_CODE"));
							contact1_res_town_desc   = checkForNull(rset.getString("contact1_res_town_desc"));
							contact1_area_code       = checkForNull(rset.getString("CONTACT1_RES_AREA_CODE"));
							contact1_res_area__desc  = checkForNull(rset.getString("contact1_res_area__desc"));
							contact1_region_code     = checkForNull(rset.getString("CONTACT1_REGION_CODE"));
							contact1_region_desc     = checkForNull(rset.getString("contact1_region_desc"));
							postal1_code		     = checkForNull(rset.getString("POSTAL1_CODE"));
							postal1_desc		     = checkForNull(rset.getString("postal1_desc"));
							country1_code		     = checkForNull(rset.getString("COUNTRY1_CODE"));
							country1_code_desc	     = checkForNull(rset.getString("country1_code_desc"));
							//Below added by Suji keerthi for ML-MMOH-CRF-1527 US008
                                                        nk_mail_addr_line1			     = checkForNull(rset.getString("nk_mail_addr_line1"));
							nk_mail_addr_line2			     = checkForNull(rset.getString("nk_mail_addr_line2"));
							nk_mail_addr_line3			     = checkForNull(rset.getString("nk_mail_addr_line3"));
							nk_mail_addr_line4			     = checkForNull(rset.getString("nk_mail_addr_line4"));
							nkcontact1_res_town        = checkForNull(rset.getString("nk_mail_town_code"));
							n_contact_ma_town_desc   = checkForNull(rset.getString("n_contact_ma_town_desc"));
							nkcontact1_region_code     = checkForNull(rset.getString("nk_mail_region_code"));
							n_contac_region_desc     = checkForNull(rset.getString("n_contac_region_desc"));
		                                        nkcontact1_area_code     = checkForNull(rset.getString("nk_mail_region_code"));
							n_contact_ma_area_desc     = checkForNull(rset.getString("n_contact_ma_area_desc"));
							nkpostal1_code     = checkForNull(rset.getString("nk_mail_postal_code"));
							nkpostal1_desc     = checkForNull(rset.getString("nkpostal1_desc"));
							nk_mail_country_code		     = checkForNull(rset.getString("nk_mail_country_code"));
							nk_mail_country_desc	     = checkForNull(rset.getString("nk_mail_country_desc"));
							nk_res_contact_name			     = checkForNull(rset.getString("nk_res_contact_name"));
							nk_mail_contact_name			     = checkForNull(rset.getString("nk_mail_contact_name"));
							nk_contact3_mode       = checkForNull(rset.getString("nk_contact3_mode"));
							nk_contact3_no       = checkForNull(rset.getString("nk_contact3_no"));
							nk_contact4_mode       = checkForNull(rset.getString("nk_contact4_mode"));
							nk_contact4_no       = checkForNull(rset.getString("nk_contact4_no"));
							nk_contact5_mode       = checkForNull(rset.getString("nk_contact5_mode"));
							nk_contact5_no       = checkForNull(rset.getString("nk_contact5_no"));

							fton_mail_addr_line1			     = checkForNull(rset.getString("fton_mail_addr_line1"));
							fton_mail_addr_line2			     = checkForNull(rset.getString("fton_mail_addr_line2"));
							fton_mail_addr_line3			     = checkForNull(rset.getString("fton_mail_addr_line3"));
							fton_mail_addr_line4			     = checkForNull(rset.getString("fton_mail_addr_line4"));
							ftoncontact2_res_town        = checkForNull(rset.getString("fton_mail_town_code"));
							fst_to_no_ma_town_desc   = checkForNull(rset.getString("fst_to_no_ma_town_desc"));
							ftoncontact2_region     = checkForNull(rset.getString("fton_mail_region_code"));
							fst_to_no_ma_reg_desc     = checkForNull(rset.getString("fst_to_no_ma_reg_desc"));
		                                        ftoncontact2_res_area     = checkForNull(rset.getString("fton_mail_area_code"));
							fst_to_no_ma_area_desc     = checkForNull(rset.getString("fst_to_no_ma_area_desc"));
							ftonpostal1_code     = checkForNull(rset.getString("fton_mail_postal_code"));
							ftonpostal1_desc     = checkForNull(rset.getString("ftonpostal1_desc"));
							fton_mail_country_code		     = checkForNull(rset.getString("fton_mail_country_code"));
							fton_mail_country_desc	     = checkForNull(rset.getString("fton_mail_country_desc"));
							fton_res_contact_name			     = checkForNull(rset.getString("fton_res_contact_name"));
							fton_mail_contact_name			     = checkForNull(rset.getString("fton_mail_contact_name"));

							fton_contact3_mode       = checkForNull(rset.getString("fton_contact3_mode"));
							fton_contact3_no       = checkForNull(rset.getString("fton_contact3_no"));
							fton_contact4_mode       = checkForNull(rset.getString("fton_contact4_mode"));
							fton_contact4_no       = checkForNull(rset.getString("fton_contact4_no"));
							fton_contact5_mode       = checkForNull(rset.getString("fton_contact5_mode"));
							fton_contact5_no       = checkForNull(rset.getString("fton_contact5_no"));
							//Ended by Suji keerthi for ML-MMOH-CRF-1527 US008
							res1_tel_no			     = checkForNull(rset.getString("RES1_TEL_NO"));
							res1_mbo_tel_no		     = checkForNull(rset.getString("CONTACT1_MOB_TEL_NO"));
							off1_tel_no			     = checkForNull(rset.getString("OFF1_TEL_NO"));
							contact1_email_id	     = checkForNull(rset.getString("CONTACT1_EMAIL_ID"));
							first_to_notify_name     = checkForNull(rset.getString("CONTACT2_NAME"));
							contact2_relation	     = checkForNull(rset.getString("CONTACT1_RELATION"));
							contact2_nat_id		     = checkForNull(rset.getString("CONTACT2_NAT_ID_NO"));
							job2_title			     = checkForNull(rset.getString("JOB2_TITLE"));
							contact2_res_tel_no	     = checkForNull(rset.getString("RES2_TEL_NO"));
							contact2_mob_tel_no	     = checkForNull(rset.getString("CONTACT2_MOB_TEL_NO"));
							contact2_off_tel_no	     = checkForNull(rset.getString("OFF2_TEL_NO"));
							contact2_mail_id	     = checkForNull(rset.getString("CONTACT2_EMAIL_ID"));
							contact2_add_l1	         = checkForNull(rset.getString("ADDR2_LINE1"));
							contact2_add_l2	         = checkForNull(rset.getString("ADDR2_LINE2"));
							contact2_add_l3	         = checkForNull(rset.getString("ADDR2_LINE3"));
							contact2_add_l4		     = checkForNull(rset.getString("ADDR2_LINE4"));
							contact2_town_code	     = checkForNull(rset.getString("CONTACT2_RES_TOWN_CODE"));
							contact2_res_town_desc	 = checkForNull(rset.getString("contact2_res_town_desc"));
							contact2_area_code	     = checkForNull(rset.getString("CONTACT2_RES_AREA_CODE"));
							contact2_res_area__desc	 = checkForNull(rset.getString("contact2_res_area__desc"));
							contact2_reg_code	     = checkForNull(rset.getString("CONTACT2_REGION_CODE"));
							contact2_region_desc	 = checkForNull(rset.getString("contact2_region_desc"));
							postal2_code             = checkForNull(rset.getString("POSTAL2_CODE"));
							postal2_desc		     = checkForNull(rset.getString("postal2_desc"));
							contact2_country_code	 = checkForNull(rset.getString("COUNTRY2_CODE"));
							country2_code_desc	     = checkForNull(rset.getString("country2_code_desc"));
							contact3_org_name	     = checkForNull(rset.getString("ORGANIZATION_NAME"));
							employer_name			 = checkForNull(rset.getString("CONTACT3_NAME"));
							addr3_line1			     = checkForNull(rset.getString("ADDR3_LINE1"));
							addr3_line2			     = checkForNull(rset.getString("ADDR3_LINE2"));
							addr3_line3			     = checkForNull(rset.getString("ADDR3_LINE3"));
							addr3_line4			     = checkForNull(rset.getString("ADDR3_LINE4"));
							contact3_town_code	     = checkForNull(rset.getString("CONTACT3_RES_TOWN_CODE"));
							contact3_res_town_desc   = checkForNull(rset.getString("contact3_res_town_desc"));
							contact3_reg_code	     = checkForNull(rset.getString("CONTACT3_REGION_CODE"));
							contact3_region_desc	 = checkForNull(rset.getString("contact3_region_desc"));
							contact3_area_code	     = checkForNull(rset.getString("CONTACT3_RES_AREA_CODE"));
							contact3_res_area__desc	 = checkForNull(rset.getString("contact3_res_area__desc"));
							postal3_code		     = checkForNull(rset.getString("POSTAL3_CODE"));
							postal3_desc		     = checkForNull(rset.getString("postal3_desc"));
							country3_code		     = checkForNull(rset.getString("COUNTRY3_CODE"));
							country3_code_desc	     = checkForNull(rset.getString("country3_code_desc"));
							res3_tel_no			     = checkForNull(rset.getString("RES3_TEL_NO"));
							off3_tel_no			     = checkForNull(rset.getString("OFF3_TEL_NO"));
							patient_employee_id 	 = checkForNull(rset.getString("PATIENT_EMPLOYEE_ID"));
							ocpn_class_code			 = checkForNull(rset.getString("OCPN_CLASS_CODE"));
							ocpn_code			     = checkForNull(rset.getString("OCPN_CODE"));
							ocpn_desc			     = checkForNull(rset.getString("OCPN_DESC"));
							employment_status	     = checkForNull(rset.getString("EMPLOYMENT_STATUS"));
							sysdate				    = checkForNull(rset.getString("sys"));
							sysDateWithoutTime	    = checkForNull(rset.getString("sys1"));
							nat_id_check_digit_id	= checkForNull( rset.getString("nat_id_check_digit_id"));
							nat_id_chk_len		    = checkForNull( rset.getString("nat_id_chk_len"));
							/*Added by Thamizh selvi on 7th Aug 2018 against ML-MMOH-CRF-1177 Start*/
							natInvokeRoutine		= checkForNull( rset.getString("invoke_routine"));
							natDataSourceId		    = checkForNull( rset.getString("nat_data_source_id"));
							/*End*/

					   }
					   if(pstmt!=null) pstmt.close();
					   if(rset!=null) rset.close();  
					   if((nationalDisp != null) && (nationalDisp.length() > 0))
						{
							nationalDisp.delete(0,nationalDisp.length());
						}
						if (deceased_yn.equals("Y")){
							proBrought_dead = "disabled";
						}
						else{
							proBrought_dead = "";
						}
						String  sysDateSer = sysdate;

						sysdate=DateUtils.convertDate(sysdate,"DMYHMS","en",locale);
					

					    if (!contact1_birth_date.equals("")){	contact1_birth_date=DateUtils.convertDate(contact1_birth_date,"DMY","en",locale);
					   }
		   %>
			<tr>
		
			  <input type='hidden'  name="sysDateSer"  value="<%=sysDateSer%>">
			  <input type='hidden'  name="deceased_yn"  value="<%=deceased_yn%>">
			   <% if(!nat_id_prompt.equals("")){  %>
					  <td class='LABEL'  width='25%' ><%=nat_id_prompt%> </td>
					  <td class='QUERYDATA' width='25%'><%=nationality_id%>&nbsp;</td>
			   <% } else {  %>
						  <td class='LABEL'  width='25%' >&nbsp;</td>
						  <td class='LABEL'> &nbsp;</td>
			   <% } %>
			   <% if(!alt_id1_desc.equals("")){  %>
                      <td class='LABEL' width='25%'><%= alt_id1_desc%></td>
				      <td class='QUERYDATA'  width='25%' ><%=alt_id1_no%>&nbsp;</td>
			    <% } else{ %>
					  <td class='LABEL' width='25%'>&nbsp;</td>
					  <td class='QUERYDATA' width='25%'>&nbsp;</td>
                <% }%>
          </tr> 
          <tr><td colspan=4 class=label height=5></td></tr>
         <!--  added for PMG2014-HSA-CRF-0001 [IN:050020] --> 
          <tr>
		
			   <% if(!alt_id2_desc.equals("")){  %>
					  <td class='LABEL'  width='25%' ><%=alt_id2_desc%> </td>
					  <td class='QUERYDATA' width='25%'><%=alt_id2_no%>&nbsp;</td>
			   <% } else {  %>
						  <td class='LABEL'  width='25%' >&nbsp;</td>
						  <td class='LABEL'> &nbsp;</td>
			   <% } %>
			   <% if(!alt_id3_desc.equals("")){  %>
                      <td class='LABEL' width='25%'><%= alt_id3_desc%></td>
				      <td class='QUERYDATA'  width='25%' ><%=alt_id3_no%>&nbsp;</td>
			    <% } else{ %>
					  <td class='LABEL' width='25%'>&nbsp;</td>
					  <td class='QUERYDATA' width='25%'>&nbsp;</td>
                <% }%>
          </tr> 
          <tr><td colspan=4 class=label height=5></td></tr>
          <tr>
		
			   <% if(!alt_id4_desc.equals("")){  %>
					  <td class='LABEL'  width='25%' ><%=alt_id4_desc%> </td>
					  <td class='QUERYDATA' width='25%'><%=alt_id4_no%>&nbsp;</td>
			   <% } else {  %>
						  <td class='LABEL'  width='25%' >&nbsp;</td>
						  <td class='LABEL'> &nbsp;</td>
			   <% } %>
			   
          </tr> 
          <tr><td colspan=4 class=label height=5></td></tr>
		  <tr>
			  <td class='LABEL'  width='25%' ><fmt:message key="Common.nationality.label" bundle="${common_labels}"/></td>
              <td class='QUERYDATA'  width='25%'><%=nationality%>&nbsp;</td>

			  <%if(oth_alt_id_desc.equals(""))  oth_alt_id_desc="&nbsp;"; %>

              <%if (! oth_alt_id_desc.equals("")){%>

				  <td class='LABEL' ><%=oth_alt_id_desc%></td>
				  <td class='QUERYDATA' width='25%' ><%=oth_alt_id_no%>&nbsp;</td>

			  <% } else{ %>
					<td class='LABEL' >&nbsp;</td>
					<td class='QUERYDATA'  width='25%' >&nbsp;</td>
              <% }%>
	      </tr>	
          <tr><td class=label height=5 colspan='4'></td></tr>
		  <tr>
              <td class='LABEL'  width='25%' ><fmt:message key="Common.residency.label" bundle="${common_labels}"/></td>
			  <td class='QUERYDATA' ><% if(residency.equals("Y")){ %> <fmt:message key="Common.citizen.label" bundle="${common_labels}"/><% } else { %><fmt:message key="Common.noncitizen.label" bundle="${common_labels}"/> <% } %>
              </td>
			  <td class='LABEL' width='25%' ><fmt:message key="Common.status.label" bundle="${common_labels}"/></td>
			  <td class='QUERYDATA' ><% if(legal_status.equals("Y")){ %> <fmt:message key="Common.legal.label" bundle="${common_labels}"/><% } else { %><fmt:message key="Common.illegal.label" bundle="${common_labels}"/> <% } %>
              </td>
	      </tr>
          <tr><td class=label height=5 colspan='4'></td></tr>

		  <tr>
		      <td class='LABEL'  width='25%' ><fmt:message key="Common.bloodgroup.label" bundle="${common_labels}"/></td>
  		      <td class='QUERYDATA' width='25%' ><%=blood_group%></td>
			  <input type='hidden'  name="blood_group"  value="<%=blood_group_code%>">
			  <td class='LABEL' width='25%' ><fmt:message key="Common.RhFactor.label" bundle="${common_labels}"/></td>
			  <td class='QUERYDATA' width='25%' > <%=rh_factor%></td>
              <input type='hidden'  name="rh_factor"  value="<%=rh_factor_code%>">
	      </tr>	
       
         <tr>
			 <td  class=label colspan='3'></td>
			 <td class='label' ><input type='button' class='button' name='contact_details' value='<%=com.ehis.util.BundleMessage.getBundleMessage(pageContext,"Common.ContactDetails.label","common_labels")%>'  onclick="Modal_Contact_Details(this);" id = '' ><input type="hidden" name='hdddob' value =      '<%=date_of_birth%>'></td> 
                  
          </tr> 
		   <%
					   // to get the build_episode_rule and the sysdate
					   pstmt = con.prepareStatement(episodeDisp.toString());
					   pstmt.setString(1,facilityId);
				       rset = pstmt.executeQuery();
					   while(rset!=null && rset.next())
					   {
			                buildEpisodeRule	= rset.getString("BUILD_EPISODE_RULE");
					   }

					   if(pstmt!=null) pstmt.close();
					   if(rset!=null) rset.close();
					   if((episodeDisp != null) && (episodeDisp.length() > 0))
						{
							episodeDisp.delete(0,episodeDisp.length());
						}
    					sys_date  =sysDateWithoutTime;
					   if(buildEpisodeRule==null) buildEpisodeRule="X"; 
	  	%> 
		<tr>
		         <td class='COLUMNHEADER' colspan='4' ><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></td>
	    </tr>
		  
		  <tr>
			  <input type='hidden' name='StartDate1' value="<%=StartDate1%>"></input>
              <input type='hidden' name='AllowedDate' value="<%=AllowedDate%>"></input>
              <input type='hidden' name='to_service' value="<%=to_service_code%>"></input>
		      <td class='LABEL'  width='25%' ><fmt:message key="Common.VisitDateTime.label" bundle="${common_labels}"/></td>
  		      <td class='fields' width='25%' >
				<% if (visit_back_yn.equalsIgnoreCase("Y")) { %>
					 <input type='text'  id='regndatetime' name="visit_date_time"  value="<%=sysdate%>" maxLength='19' size='19' onBlur='chkFromToTime2(this);' ><img src="../../eCommon/images/CommonCalendar.gif"  onClick="return showCalendar('regndatetime','dd/mm/yyyy' ,'hh:mm:ss',null );" style='cursor:hand'></img>&nbsp;<img src='../../eCommon/images/mandatory.gif' ></img>
                <% } else { %><input type='text'  id='regndatetime' name="visit_date_time"  value="<%=sysdate%>" maxLength='19' size='19' readonly ><%}%>
              </td> 

			  <%if(!invoke_recall.equals("Y")){%>
              <td class='label' colspan='2'>&nbsp;</td>
			  <%}else{%>
			  <!--Added by Ashwini on 18-Dec-2017 for ML-MMOH-CRF-0657-->
			  <td class='LABEL' width='25%'><fmt:message key="eAE.LinkDelink.label" bundle="${ae_labels}"/> <fmt:message key="Common.followup.label" bundle="${common_labels}"/> <fmt:message key="Common.encounter.label" bundle="${common_labels}"/></td>
			  <td class='fields' width='25%'><input type='text' size='15' name="followup_enc" value="<%=enc_id%>" disabled>&nbsp;<input type='button' name='followup_enc_add' value='+' class='button' onclick = "linkFollowUpEncounters('<%=patient_id%>')">&nbsp;<input type='button' name='followup_enc_remove' value='X' class='button' onclick = "delinkFollowUpEncounters()"></td>
			 <!--ML-MMOH-CRF-0657-->
			  <%}%>

          </tr>
		 
		  <tr>
		      <td class='LABEL' width='15%' ><fmt:message key="Common.Location.label" bundle="${common_labels}"/></td>
			  <td class='fields' width='35%' >
			  <select name='location' onChange='remVal1(document.forms(0).service);remVal(document.forms(0).sub_service);remVal(document.forms(0).treat_area);setTreat();setVisit(this);'>
    			 <%
						   int countRec = 0;		
						   pstmt=con.prepareStatement(sqlLocation.toString(),ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
						   pstmt.setString(1,facilityId);
					       pstmt.setString(2,facilityId);
 					       pstmt.setString(3,oper_stn_id);
					       pstmt.setString(4,user_id);
						   pstmt.setInt(5,patient_age);
						   pstmt.setInt(6,patient_age);
						   pstmt.setInt(7,patient_age);
						   rs = pstmt.executeQuery();
						   boolean rec_exists=false;
						   if(rs != null){
				              rs.last();
			                  countRec = rs.getRow();
                              rs.beforeFirst();
					       }
                           if (countRec >= 1){
					          while(rs!=null && rs.next()){
	        
								 gender1 = rs.getString(7);					 
								 if(gender1==null)  gender1	= "";
								 if(gender1.equals("") || gender1.equals(sex)){									 
									 if(referal_id.equals("")){
										 out.println( "<option value='"+rs.getString(1)+"::"+rs.getString(3)+"::"+rs.getString(4)+"::"+rs.getString(5)+"::"+rs.getString(6)+"::"+rs.getString(8)+"'>"+rs.getString(2)+"</option>"); 
										

										 
									 }else{
										if(!to_locn_code.equals("")){
											if(to_locn_code.equals(rs.getString(1))){										
												out.println( "<option value='"+rs.getString(1)+"::"+rs.getString(3)+"::"+rs.getString(4)+"::"+rs.getString(5)+"::"+rs.getString(6)+"::"+rs.getString(8)+"'>"+rs.getString(2)+"</option>"); 
											
								
											}
										}else{
											out.println( "<option value='"+rs.getString(1)+"::"+rs.getString(3)+"::"+rs.getString(4)+"::"+rs.getString(5)+"::"+rs.getString(6)+"::"+rs.getString(8)+"'>"+rs.getString(2)+"</option>"); 

									}
									 }
						              rec_exists=true;
									 }
									
									
						       }
							   //End of While
						   }else if (countRec == 1){ //End of More Record
						      while(rs!=null && rs.next()) {
								  gender1 = rs.getString(7);


								  if(gender1 == null) gender1	= "";
   						          if(gender1.equals("") || gender1.equals(sex)){
									out.println( "<option value='"+rs.getString(1)+"::"+rs.getString(3)+"::"+rs.getString(4)+"::"+rs.getString(5)+"::"+rs.getString(6)+"::"+rs.getString(8)+"'  selected>"+rs.getString(2)+""); 
									rec_exists=true;
								  }
						       }//End of While
						   }
						   if(rs!=null) rs.close();
						   if(pstmt!=null) pstmt.close();
						  // pstmt=null;
						   if((sqlLocation != null) && (sqlLocation.length() > 0))
							{
								sqlLocation.delete(0,sqlLocation.length());
							}					 
							 
					   %>

				   </select>

				   <script>
						  var rec_exists=<%=rec_exists%>;
							if(!rec_exists){
								alert(getMessage("AE_NO_LOC_FOR_SEL_AGE_SEX","AE"));
								// Commented and added the new code by Suresh M on 01.12.2010
								top.content.frames[1].frames(0).document.forms(0).clear.onclick();
								/*
								top.content.frames[1].frames(0).document.forms(0).patient_id.value='';
								top.content.frames[1].frames(0).document.forms(0).patient_id.disabled=false;
								top.content.frames[1].frames(0).document.forms(0).search.disabled=false;
								top.content.frames[1].frames(0).document.forms(0).patient_search.disabled=false;	
								top.content.frames[1].frames(1).location.href='../../eCommon/html/blank.html';
								top.content.frames[1].frames(2).location.href='../../eCommon/html/blank.html';
								top.content.frames[1].frames(0).document.forms(0).patient_id.focus();
								*/
							}
					</script> 
		
				   <img src='../../eCommon/images/mandatory.gif' align='center'></img>
                   <input type="hidden" name='hddgender' value = '<%=sex%>'></td>

				   </td><td class='LABEL'  width='25%' ><fmt:message key="Common.service.label" bundle="${common_labels}"/></td>
            	   <td class='fields' width='25%' >
				   <select name='service' onFocus='remVal(document.forms(0).sub_service);setSubService(this);' onChange='remVal(document.forms(0).sub_service);setSubService(this);' >  

		     </select><img id='mandatory' src='../../eCommon/images/mandatory.gif'></img></td>
		  <tr>
		      <td class='LABEL'  width='25%' ><fmt:message key="eAE.RegistrationType.label" bundle="${ae_labels}"/></td>
  		      <td class='fields' width='25%' >
 				   <select name='visit_type' >
					     <option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------



					
                   </select><img src='../../eCommon/images/mandatory.gif' align='center'></img>
              </td>

			  <td class='LABEL' width='25%' ><fmt:message key="Common.subservice.label" bundle="${common_labels}"/></td>
			  <td class='fields' width='25%' >
                   <select name='sub_service' >
						<option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------

				       </select>
			  </td>
	      </tr>
  		  <tr>
		    <td class='LABEL' width='25%' ><fmt:message key="Common.ModeofArrival.label" bundle="${common_labels}"/></td>
			<td class='fields'  colspan='3'>
				   <select name='transport_mode'	  onFocus="remVal(document.forms(0).mode_of_arrival);setTrans(this);" onChange="remVal(document.forms(0).mode_of_arrival);setTrans(this);" >
				    	<option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
                <%  
				   PreparedStatement pstmtTrans = null;
				   ResultSet rsetTrans = null;
				   StringBuffer sqlAMTrans = new StringBuffer();
                   sqlAMTrans.append("SELECT transport_mode, short_desc FROM am_transport_mode_lang_vw WHERE language_id='"+locale+"' and PATIENT_RELATED_YN='Y' AND eff_status = 'E' ORDER BY 2 ");
                   pstmtTrans = con.prepareStatement(sqlAMTrans.toString());
					
				   rsetTrans = pstmtTrans.executeQuery();
				  while(rsetTrans!=null && rsetTrans.next())
					 {
					out.println("<option value='"+rsetTrans.getString(1)+"'>"+rsetTrans.getString(2)+""); 
					 }
				  if(pstmtTrans!=null) pstmtTrans.close();
				  if(rsetTrans!=null) rsetTrans.close();
				  if((sqlAMTrans != null) && (sqlAMTrans.length() > 0))
				  {
						sqlAMTrans.delete(0,sqlAMTrans.length());
				   }
	            %>
				   </select>
                   <select name='mode_of_arrival' >
						 <option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
				   </select>
		    </td> 
		    </td> 
          </tr>
		  <!--Added by Thamizh selvi on 20th Mar 2018 against ML-MMOH-CRF-0645 Start-->
		 <% if(isCaseDtlsRadioBtnAppl){ %>
		</table>
		<table border="0" cellpadding="2" cellspacing="0" align='center' width='92%'>

			<tr>
				<td class='label' width='25%'>
					<fmt:message key="Common.Trauma.label" bundle="${common_labels}"/>
				</td>
				<td class='fields' width='15%'>
					<input type='radio' name='caseDetails' id='trauma' value='N' onClick='caseDetailsOnChange(this);'></input>
				</td>
				<td class='label' width='13%'>
					<fmt:message key="Common.oscc.label" bundle="${common_labels}"/>
				</td>
				<td class='fields' width='7%'>
					<input type='radio' name='caseDetails' id='oscc' value='N' onClick='caseDetailsOnChange(this);'></input>
				</td>
				<td class='label' width='25%'>
					<span id='osccTypeLabel' style="visibility:hidden"><fmt:message key="Common.oscc.label" bundle="${common_labels}"/>&nbsp;<fmt:message key="Common.type.label" bundle="${common_labels}"/></span>
				</td>
				<td class='fields' width='25%'>
					<select name='osccType' style="visibility:hidden">
						<option value=''>--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
						<%
								JSONArray osccTypeJsonArr	= new JSONArray();
								osccTypeJsonArr  = eAE.AECommonBean.getOSCCTypeList(con,locale,"");	
									
								for(int i = 0 ; i < osccTypeJsonArr.size() ; i++) 
								{
									JSONObject osccTypejson		= (JSONObject)osccTypeJsonArr.get(i);
									String injCategoryCode		= (String) osccTypejson.get("injCategoryCode");
									String injSubCategoryCode	= (String) osccTypejson.get("injSubCategoryCode");
									String subCategoryShortDesc	= (String) osccTypejson.get("subCategoryShortDesc");
											
									out.println("<option value="+injCategoryCode+","+injSubCategoryCode+">"+subCategoryShortDesc+"</option>");
											
								}
											
						%>
					</select><img src='../../eCommon/images/mandatory.gif' id='osccTypeMandImg' style="visibility:hidden" align='center'></img>
				</td>
			</tr>
			<tr>
				<td class='label'  width='25%'>
					<fmt:message key="Common.medical.label" bundle="${common_labels}"/>
				</td>
				<td class='fields' width='15%'>
					<input type='radio' name="caseDetails" id='medical' value='N' onClick='caseDetailsOnChange(this);' checked></input>
				</td>
				<td class='label' width='13%'>
					<fmt:message key="Common.Surgical.label" bundle="${common_labels}"/>
				</td>
				<td class='fields' colspan=3>
					<input type='radio' name="caseDetails" id='surgical' value='N' onClick='caseDetailsOnChange(this);'></input> 
				</td>
			</tr>
			<tr>
				<td class='label'  width='25%'>
					<fmt:message key="eAE.OandG.label" bundle="${ae_labels}"/>
				</td>
				<td class='fields' colspan=5>
					<input type='radio' name="caseDetails" id='OandG' value='N' onClick='caseDetailsOnChange(this);'></input>
				</td>
			</tr>
			<input type='hidden' name='oscc_yn' value='N'>
			<input type='hidden' name='medical_yn' value='Y'>
			<input type='hidden' name='surgical_yn' value='N'>
			<input type='hidden' name='CaseofTrauma_val' value='N'>
		</table>
		<table border="0" cellpadding="2" cellspacing="0" align='center' width='92%'>
		 <% }else{ %>
		 <!--End-->
          <!--Added by Rameswar on 04-Oct-16 for GDOH-CRF-0004.2-->
          <tr>  
			        <td class='label' width='25%'><fmt:message key="Common.CaseofTrauma.label" bundle="${common_labels}"/></td>
			        <td class='fields' width='25%' ><input type='checkbox'   name="CaseofTrauma"  onClick='checktrauma(this);setMechInj1(this);'  >
					</td>	
					<td class='label' width='25%'><fmt:message key="Common.oscc.label" bundle="${common_labels}"/></td>
                    <td class='fields' width='25%' ><input type='checkbox'  name="oscc_yn"   value='N' onClick='chkOsccValue(this);remVal(document.forms(0).mechan_injury);setMechInj();'  >
					</td><input type='hidden' name='CaseofTrauma_val' value='N'>
         </tr>
          <tr> 
					<td class='label'  width='25%'><fmt:message key="Common.medical.label" bundle="${common_labels}"/></td>
					<td class='fields' width='25%' ><input type='checkbox'  name="medical_yn"  onClick='chkMedicalValue(this);' ></td>
					<td class='label'  width='25%' ><fmt:message key="Common.Surgical.label" bundle="${common_labels}"/></td>
					<td class='fields' width='25%'> <input type='checkbox'  name="surgical_yn"   value='' onClick='chkSurgValue(this);'> 
					</td>
		 </tr> 
		 <% }
		 if(isCaseDtlsRadioBtnAppl){ %>
		 <tbody id='MechInjFieldsDisplay' style="display:none;">
		 <% } %>
		 <tr>	
		           <td class='LABEL' width='25%' >
						<!--Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-0649 Start-->
						<% if(isMechInjLabelChngAppl){ %>
							<fmt:message key="eAE.MechOfMainInj.label" bundle="${ae_labels}"/>
						<% }else{ %><!--End-->
							<fmt:message key="Common.MechanismofInjury.label" bundle="${common_labels}"/>
						<% } %>
				   </td>
  		           <td class='fields' width='25%'>
				   <select name='mechan_injury' onChange='setInjury(this)' > 
				    <option value=''>--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
					   <%
					
						 StringBuffer sqlMechaInjury = new StringBuffer();
						 sqlMechaInjury.append("SELECT INJ_CATEGORY_CODE,SHORT_DESC FROM AE_INJURY_CATEGORY_LANG_VW  WHERE language_id='"+locale+"'  and EFF_STATUS='E'  and oscc_yn=  'N'  ORDER BY 2 ");  
						 pstmtTrans = con.prepareStatement(sqlMechaInjury.toString());
					     rsetTrans = pstmtTrans.executeQuery();
						 
						 while(rsetTrans!=null && rsetTrans.next())
						   {
							 
                              out.println("<option value='"+rsetTrans.getString(1)+"' >"+rsetTrans.getString(2)+" ");
						   }
						 if(pstmtTrans!=null) pstmtTrans.close();
						 if(rsetTrans!=null) rsetTrans.close();
						 if((sqlMechaInjury != null) && (sqlMechaInjury.length() > 0))
						 {
							sqlMechaInjury.delete(0,sqlMechaInjury.length());
						 }
					     %>  
                 </select><img src='../../eCommon/images/mandatory.gif' id='mand4' style="visibility:hidden" align='center'></img>
				<% if(!isMechInjLabelChngAppl){ %><!--Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-0649-->
				 <font  class='label'></font>&nbsp;&nbsp;&nbsp;<fmt:message key="Common.and.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;
			 	<select name='injury' >
				  <option value=''>--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
				</select><img src='../../eCommon/images/mandatory.gif' id='mand5' style="visibility:hidden" align='center'></img>
				<input type='hidden' name='mech_sub_code' value='' >
				<% } %>
              </td> 
			  <!--Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-0649 Start-->
			  <% if(isMechInjLabelChngAppl){ %>
				<td class='LABEL'  width='25%'><fmt:message key="eAE.MechaofSubInjury.label" bundle="${ae_labels}"/></td>
				<td class='fields' width='25%' >
					<select name='injury' >
					  <option value=''>--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
					</select><img src='../../eCommon/images/mandatory.gif' id='mand5' style="visibility:hidden" align='center'></img>
					<input type='hidden' name='mech_sub_code' value='' >
				</td>
			  <% } %>
			  <!--End-->
			  <!--Added by Shanmukh for MMS-DM-CRF-0147 Start-->
			  <%if(isPriorityZoneAppl){%>
				<td class='LABEL'  width='25%'><fmt:message key="Common.Critical.label" bundle="${common_labels}"/>&nbsp;<fmt:message key="eST.Patient.label" bundle="${st_labels}"/>&nbsp;<fmt:message key="eMO.Case.label" bundle="${mo_labels}"/></td>
				<td class='fields' width='25%'>					
					<input type='checkbox'  name="pat_critical_case_yn" value='Y'>
				</td>
			  <% } %>
			  <!--End-->
	  </tr>
	  <% if(isCaseDtlsRadioBtnAppl){ %>
	  </tbody>
	  <% } %>
	  <tr>	
		      <td class='LABEL' width='25%' ><fmt:message key="Common.ProtectiveDeviceUsed.label" bundle="${common_labels}"/></td>
  		      <td class='fields' width='25%' >
				 <select name='protective_device' >
				   <option value=''>---------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
			   <%
			   StringBuffer sqlProtect = new StringBuffer();
			  
			   sqlProtect.append("SELECT PROTECTIVE_DEVICE_CODE, SHORT_DESC FROM  AE_PROTECTIVE_DEVICE_LANG_VW WHERE language_id='"+locale+"'  and EFF_STATUS ='E' and PROTECTIVE_DEVICE_CODE like '%%' ORDER BY 2");

			   pstmtTrans = con.prepareStatement(sqlProtect.toString());
			   rsetTrans = pstmtTrans.executeQuery();
			    
			   optSelected="";
			   while(rsetTrans!=null && rsetTrans.next())
			   {				   
				  out.println("<option value='"+rsetTrans.getString(1)+"' >"+rsetTrans.getString(2)+" ");
			   }
			   if(pstmtTrans!=null) pstmtTrans.close();
			   if(rsetTrans!=null)	rsetTrans.close();
			   if((sqlProtect != null) && (sqlProtect.length() > 0))
				 {
					sqlProtect.delete(0,sqlProtect.length());
				 } 
			   %>
                 </select>
               </td>
               <tr>	
           <!--Added by Rameswar on 04-Oct-16 for GDOH-CRF-0004.2-->
		  <tr>
		  <!--Below line modified by Ashwini on 18-Jan-2017 for GDOH-CRF-0123--> 
		   <%if(!five_level_triage_appl_yn.equals("Y") && (isLabelChngAppl == false)){ %> 
				 <td class='LABEL'  width='25%' ><fmt:message key="Common.broughtdead.label" bundle="${common_labels}"/></td>
			 <%}else{ %>
			 	<td class='LABEL'  width='25%' ><fmt:message key="eAE.DeadOnArrival.label" bundle="${common_labels}"/></td>
			 <%} %>
			 <!-- below line(s) modified by VenkateshS against ML-MMOH-CRF-0354 [IN057191] -->
  		     <td class='fields' width='25%' ><input type='checkbox'  name="brought_dead_yn"  onClick='broughtDead(this);'  <%=proBrought_dead%> >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%if(siteSpecific){%>
			 <fmt:message key="Common.MedicalLegalCase.label" bundle="${common_labels}"/>
			<%}else{%>
			 <fmt:message key="Common.mlc.label" bundle="${common_labels}"/><%}%>&nbsp;&nbsp;<input type='checkbox'  name="mlc_case_yn"  onClick='mlcCase(this);' ></td>
			 <!--end ML-MMOH-CRF-0354 [IN057191 -->
			 <td class='LABEL'  width='25%'><fmt:message key="eAE.MotorVehicleAccident.label" bundle="${ae_labels}"/></td>

			 <!--Modified by Ashwini on 17-Aug-2017 for GDOH-CRF-0161-->
  		     <td class='fields' width='25%' ><input type='checkbox'  name="mv_accident_yn"  onClick="mvAccident(this); <%if(isLabelChngAppl == true){%>placeOfAccidentMandatory(this);<%}%>" value='N'></td>
             <input type='hidden' name='brought_dead_ynhdd' value=''>
			 <input type='hidden' name='mlc_case_ynhdd' value=''>
		  </tr>

		 <% if(isCaseDtlsRadioBtnAppl){ %>
		 <tbody id='placeOfOccFieldsDisplay' style="display:none;">
		 <% } %>
			
			<!--Added by Rameswar on 28-Nov-15 for GDOH-CRF-0004.1-->
			
			<tr>
			<!-- if else block added by mujafar for ML-MMOH-CRF-0647 -->
			<%if(isPlaceOfOccuurrence == true){%>
			 <td class='LABEL'  width='25%' ><fmt:message key="eAE.DateTimeOfOccurrence.label" bundle="${ae_labels}"/></td>
			<% }
			else{
				%>
			
		      <td class='LABEL'  width='25%' ><fmt:message key="eAE.DateTimeOfAccident.label" bundle="${ae_labels}"/></td>
			<%}%>
			  
  		      <td class='fields' width='25%' >
 				   <input type='text'  id='accidentdatetime' name='accidentdatetime'   maxLength='16' size='16' tabindex=''
			  value=""  onBlur='doDatecheck(this);' ><img src="../../eCommon/images/CommonCalendar.gif"  onClick="return showCalendar('accidentdatetime', null, 'hh:mm' );" style='cursor:hand'> </img><img src='../../eCommon/images/mandatory.gif' id='dateOfOccurImg' style="visibility:hidden" align='center'><!--Added mandatory image for ML-MMOH-CRF-0648 on 5th Apr 2018 by Thamizh selvi-->
              </td>

			<!--Added by Ashwini on 18-Jan-2017 for GDOH-CRF-0131-->
			<!-- if else code modified by mujafar for ML-MMOH-CRF-0647 --> 
			<!--Modified by Ashwini on 17-Aug-2017 for GDOH-CRF-0161-->
			<%if(isLabelChngAppl == true){ %>
			  <td class='LABEL' width='25%' ><fmt:message key="eAE.PlaceOfAccident.label" bundle="${ae_labels}"/>/<fmt:message key="eAE.PickupPlace.label" bundle="${ae_labels}"/></td>
			  <%}
			  else if(isPlaceOfOccuurrence == true)
			  {%>
				<td class='LABEL' width='25%' ><fmt:message key="eAE.PlaceOfOccurrence.label" bundle="${ae_labels}"/></td> 
				
			 <% }
			  else{
				  %><td class='LABEL' width='25%' ><fmt:message key="eAE.PlaceOfAccident.label" bundle="${ae_labels}"/></td>
				  <%} %>
				
			<!--Modified by Ashwini on 17-Aug-2017 for GDOH-CRF-0161-->
			<%if(isPlaceOfOccuurrence == false){ %>
			  <td class='fields' width='25%' >
                   <input type='text' name="place_of_accident"  maxLength='30' size='25'  tabindex='' value="" onBlur="makeValidString(this)"> <%if(isLabelChngAppl == true){ %><img src='../../eCommon/images/mandatory.gif' id='poa_mand' style="visibility:hidden" align='center'></img> <%}%>
			  </td>
			<%}
			else
			{
				
			%>
			<!--<td class='fields' width='25%' >
                   <input type='text' name="place_of_accident"  maxLength='30' size='25'  tabindex='' value="" onBlur="makeValidString(this)">
			  </td> -->
			  <td class='fields' width='25%'><select name='place_of_accident' >
			   <option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------</option> 
                <%  
                  try 
				  {	
				   PreparedStatement pstmtTrans1 = null;
				   ResultSet rsetTrans1 = null;
                   pstmtTrans1 = con.prepareStatement("select PLACE_OCCURRENCE_TYPE_CODE, short_desc from AE_PLACE_OF_OCCURRENCE where  eff_status='E' order by short_desc");
					
				   rsetTrans1 = pstmtTrans1.executeQuery();
				   while(rsetTrans1!=null && rsetTrans1.next())
					{
					  out.println("<option value='"+rsetTrans1.getString("PLACE_OCCURRENCE_TYPE_CODE")+"'>"+rsetTrans1.getString("short_desc")+""); 
					}
                  if(rsetTrans1!=null) rsetTrans1.close();
				  if(pstmtTrans1!=null) pstmtTrans1.close();
				  }catch(Exception e) {out.println("Exception in Place of Occurrence="+e);			e.printStackTrace();}
	            %>
				</select><img src='../../eCommon/images/mandatory.gif' id='placeOfOccurImg' style="visibility:hidden" align='center'><!--Added mandatory image for ML-MMOH-CRF-0648 on 5th Apr 2018 by Thamizh selvi-->
				</td>
			
			<%}%>
	<!--	<input type="hidden" name='isPlaceOfOccuurrence' value="<%=isPlaceOfOccuurrence%>"> -->

	      </tr>
	  <% if(isCaseDtlsRadioBtnAppl){ %>
	  </tbody>
	  <% } %>
			<tr>
		      <td class='LABEL'  width='25%' ><fmt:message key="Common.VehiclesInvolved.label" bundle="${common_labels}"/></td>
  		      <td class='fields' width='25%' >
 				   <select name='vehicle_invol1' ><option value='' >--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>-------
					   <%
						 StringBuffer sqlVehicleInv = new StringBuffer();
						 //sqlVehicleInv.append("select ARRIVAL_CODE, SHORT_DESC ARRIVAL_SHORT_DESC from am_arrival_lang_vw where language_id='"+locale+"'  and EFF_STATUS='E' and facility_id='"+facilityId+"'  order by 2");

						 sqlVehicleInv.append("select ARRIVAL_CODE, SHORT_DESC ARRIVAL_SHORT_DESC from am_arrival_lang_vw where language_id='"+locale+"'  and EFF_STATUS='E' and facility_id='"+facilityId+"' and ARRIVAL_CODE like '%%' order by 2");

						 pstmt = con.prepareStatement(sqlVehicleInv.toString());
					     rset = pstmt.executeQuery();
						 optSelected="";
						 while(rset!=null && rset.next())
						   {
							  optSelected="";
                              out.println("<option value='"+rset.getString(1)+"'"+optSelected+">"+rset.getString(2)+" ");
						   }
						 if(pstmt!=null) pstmt.close();
						 if(rset!=null) rset.close();
					   %>
				  </select><fmt:message key="Common.and.label" bundle="${common_labels}"/> 
				  <select name='vehicle_invol2' >
				  <option value=''>--------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>-------
				<%
						 pstmt = con.prepareStatement(sqlVehicleInv.toString());
					     rset = pstmt.executeQuery();
						 optSelected="";
						 while(rset!=null && rset.next())
						   {
							  optSelected="";
                              out.println("<option value='"+rset.getString(1)+"'"+optSelected+">"+rset.getString(2)+" ");
						   }
						 if(pstmt!=null) pstmt.close();
						 if(rset!=null) rset.close();
						 if((sqlVehicleInv != null) && (sqlVehicleInv.length() > 0))
						 {
							sqlVehicleInv.delete(0,sqlVehicleInv.length());
						 }
					   %>
				  </select>
  
              </td>

			  <td class='LABEL' width='25%' ><fmt:message key="Common.PositionDuringIncident.label" bundle="${common_labels}"/></td>
			  <td class='fields' width='25%' ><select name='PosDurInc' >
				  <option value=''>---------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>--------
					   <%
							StringBuffer  sqlPosition = new StringBuffer();
		
							sqlPosition.append("SELECT a.PAT_POSITION_CODE, a.SHORT_DESC FROM AE_PAT_POSITION_LANG_VW a WHERE a.language_id = '"+locale+"' AND a.EFF_STATUS = 'E' AND a.pat_position_code like '%%' ORDER BY a.SHORT_DESC");

						   pstmt = con.prepareStatement(sqlPosition.toString());
					       rset = pstmt.executeQuery();
						   optSelected="";
						   while(rset!=null && rset.next())
						   {
							  optSelected="";
                              out.println("<option value='"+rset.getString(1)+"'"+optSelected+">"+rset.getString(2)+" ");
						   }
						   if(pstmt!=null) pstmt.close();
						   if(rset!=null) rset.close();
						   if((sqlPosition != null) && (sqlPosition.length() > 0))
							{
								sqlPosition.delete(0,sqlPosition.length());
							}
					   %>
				  </select></td>
	      </tr>

<!--Added by Ashwini on 04-Apr-2017 for GDOH-CFR-0004.3-->
	<tr>
	 <td class='LABEL' width='25%' ><fmt:message key="eAE.VehicleRegNo.label" bundle="${ae_labels}"/></td>
	 <td class='fields' width='25%' >
        <input type='text' name="Vehicle_Reg_No1"  maxLength='15' size='20'  onKeyPress="return SpCharChkForMotorVecRegNo(event);">
		<fmt:message key="Common.and.label" bundle="${common_labels}"/> 
        <input type='text' name="Vehicle_Reg_No2"  maxLength='15' size='20' onKeyPress="return SpCharChkForMotorVecRegNo(event);">
	 </td>
	</tr>

<!--Added by Rameswar on 28-Nov-15 for GDOH-CRF-0004.1-->

        <%if(!five_level_triage_appl_yn.equals("Y")){ %> 
		<tr id='PrimaryTriageDetailsHeader' >
			<td class='COLUMNHEADER' colspan='4' ><fmt:message key="eAE.PrimaryTriageDetails.label" bundle="${ae_labels}"/></td>
	    </tr>
	    <%} %>
		 </table>
		<%if(!five_level_triage_appl_yn.equals("Y")){ %> 
		
		
	<!--Added by Shanmukh on 10th-SEPT-2018 for MMS-DM-CRF-0147-->	 
	<%if(isPriorityZoneAppl){%>
	<table border="0" cellpadding="2" cellspacing="0" align='center' width='92%'>
	<tr>
		<td class='LABEL' width='25%' ><fmt:message key="Common.PriorityZone.label" bundle="${common_labels}"/></td>
			<td class='fields' width='25%'>
			<select name='Priority_Zone_Type' onChange='remVal(document.forms(0).treat_area);setTreatment(this);enableBed(this)'>
			
						
		<%
		try{
		sql1="SELECT PRIORITY_ZONE,PRIORITY_ZONE_DESC FROM AE_PRIORITY_ZONE_LANG_VW WHERE LANGUAGE_ID= ? and EFF_STATUS='E' and PRIORITY_ZONE not in('B','W') order by PRIORITY_ZONE_ORDER";
				
			    pstmt   = con.prepareStatement(sql1);
				pstmt.setString(1,locale) ;
				rset    = pstmt.executeQuery();
				 while(rset!=null && rset.next())
				{
					if(rset.getString("PRIORITY_ZONE").equals("U"))
							out.println("<option value='"+rset.getString(1)+"' selected>");	
							else
				            out.println("<option value='"+rset.getString(1)+"'>");	     
							out.println(rset.getString(2));
							out.println("</option>"); 
				}
					 
				
		    }catch(Exception e){e.printStackTrace();}
						%>
					 </select>
			</td>
		
		 </tr>
		
	<%}else{%>
	<table border="0" align='center' width='92%'>
         <tr>
		    <td class='LABELCENTER' align='center' width='18%'>&nbsp;</td>
			<!-- below lines designing are add by Suresh.M on 29/06/2012 against  the crf  SKR-CRF-0021 [IN028173] -->
			<td style = "COLOR:#444444;background-color:#FFFFFF; FONT-SIZE: 8pt;TEXT-ALIGN: CENTER; PADDING-LEFT:7px;PADDING-RIGHT:7px"  width='15%'><%=red%>&nbsp;</td>
			
			<td style = "COLOR:#444444;background-color:#FFFFFF; FONT-SIZE: 8pt;TEXT-ALIGN: CENTER; PADDING-LEFT:7px;PADDING-RIGHT:7px"  width='15%'><%=yellow%>&nbsp;</td>
			<td style = "COLOR:#444444;background-color:#FFFFFF; FONT-SIZE: 8pt;TEXT-ALIGN: CENTER; PADDING-LEFT:7px;PADDING-RIGHT:7px"   width='15%'><%=green%>&nbsp;</td>
			<td  colspan='2'></td>
			<!--CRF  SKR-CRF-0021 [IN028173] end-->
		 </tr> 
		<!--Below line added for this CRF ML-MMOH-CRF-0629-->
		 <tr>
			<td class='LABEL' width='18%'><fmt:message key="Common.PriorityZone.label" bundle="${common_labels}"/></td>
            <td  align='center' width='15%' >
			<input type="checkbox" name='priorityR' onClick='remVal(document.forms(0).treat_area);setTreatment(this);enableBed(this);<%=enablePrac%><%=priorityRed%>'></td>
			 <td  align='center'  width='15%'>
			 <input type="checkbox" name='priorityY' onClick='remVal(document.forms(0).treat_area);setTreatment(this);enableBed(this);<%=enablePrac%>'></td>
			 <td  align='center'  width='15%'>
			 <input type="checkbox" name='priorityG' onClick='remVal(document.forms(0).treat_area);setTreatment(this);enableBed(this);<%=enablePrac%>' >
           			<!--enablePrac () is added by Rameswar on 08-Feb-16 for GDOH-CRF-081-->
            </td>
			</tr>
			</table>
		<table border="0" cellpadding="2" cellspacing="0" align='center' width='92%'>	
<%}%>			
			
			 
			
<tr>
			<td class='LABEL' width='25%' ><fmt:message key="Common.priority.label" bundle="${common_labels}"/></td>
			<td class='fields' width='25%'>
				    <select name='priority11' >
						<option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
					</select>
			</td>
			
			<!--Added by Rameswar on 08-Feb-16 for GDOH-CRF-081-->
			<%if(isPracApplicable){%>
			<!--<td class='LABEL' width='25%'><fmt:message key="Common.practitioner.label" bundle="${common_labels}"/></td>
		<td class='fields' width='25%'><input type=text  name=practitioner_desc size=30 maxlength=30 value="" onBlur="aegetPractitioneratVisit(this,practitioner_desc);" disabled><input type=hidden value="" name=practitioner_id ><input type=button class=button value='?' name=pract_button   onclick="aegetPractitioneratVisit(this,practitioner_desc); " disabled><img src='../../eCommon/images/mandatory.gif' align='center' id='pract_mand_img' style="Visibility : 'hidden'"></img><input type='text' name=practitioner_id value=""><input type='hidden' name='prev_pract_name' value=""> -->

		<td class='LABEL' width='25%'><fmt:message key="Common.practitioner.label" bundle="${common_labels}"/></td>
		<td class='fields' width='25%'><input type=text  name="practitioner_desc" size=30 maxlength=30 value="" onBlur="beforeGetPractitioneratVisit(document.forms(0).pract_button,practitioner_desc);" disabled><input type=hidden value="" name="practitioner_id" ><input type=button class=button value='?' name="pract_button"   onclick="aegetPractitioneratVisit(this,practitioner_desc); " disabled><img src='../../eCommon/images/mandatory.gif' align='center' id='pract_mand_img' style="Visibility : 'hidden'"></img><input type='hidden' name='prev_pract_name' value="">
		</td> 
		<%}%>
			<!-- Added by Rameswar on 08-Feb-16 for GDOH-CRF-081-->

		   </tr>
           <tr>
			<td class='LABEL'  width='25%'><fmt:message key="Common.treatmentarea.label" bundle="${common_labels}"/></td>
			<td class='fields'  id="treat_area" width='25%'>
				    <select name='treat_area' onChange='enableBed(this);<%=enablePrac%>'>
						<option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
					</select>
			</td>

			<td class='label' width='25%'><fmt:message key="eAE.BedBayNo.label" bundle="${ae_labels}"/></td>
			<td class='fields' width='25%' ><input type='text' name='bed_bay_no' size='8' maxlength='8' readonly onblur="ChangeUpperCase(this)" onKeyPress="return(CheckForSpecChars(event))" disabled><input type=button class=button value='?' name='bed_button'  onClick="callBedAvailChart();" disabled>
			   </td>
		  </tr> 
           <tr> 
			<td class='LABEL' width='25%'><fmt:message key="Common.Disaster.label" bundle="${common_labels}"/></td>
			<td class='fields' width='25%'><input type="checkbox" name='Disaster_YN'  onClick='setDisaster(this)'></td>
			<td class='LABEL'  ><fmt:message key="eAE.DisasterArea.label" bundle="${ae_labels}"/></td>
			<td class='fields' width='25%'><input type='text'  name="disaster_area1"  maxLength='15' onblur='if(this.value !="")searchDisasterArea(this,disaster_area1);'  disabled><input type='button' name='disaster' value='?' class='button' onclick="searchDisasterArea(this,disaster_area1);"  disabled>
            </td>
		   <%
			   try 
				  {	
			       StringBuffer encoutBuff = new StringBuffer();
                   encoutBuff.append("select count(*) from pr_encounter where ");	
				   encoutBuff.append(" facility_id= ?  and patient_id= ? ");
				   pstmtEncounter = con.prepareStatement(encoutBuff.toString());
                   pstmtEncounter.setString(1,facilityId);
				   pstmtEncounter.setString(2,patient_id);
					
				   rsetEncounter = pstmtEncounter.executeQuery();
						  while(rsetEncounter!=null && rsetEncounter.next())
							 {
						      countRecEnc=rsetEncounter.getInt(1);
							 }
			          if(rsetEncounter!=null) rsetEncounter.close();
			          if(pstmtEncounter!=null) pstmtEncounter.close();
					  if (countRecEnc==0)
					  {
						  EncounterProp = "disabled";
					  }else
					  {
						  EncounterProp ="";
					  }
                      if((encoutBuff != null) && (encoutBuff.length() > 0))
				      {
						encoutBuff.delete(0,encoutBuff.length());
				      }
				  }catch(Exception e) {out.println("Exception in Encounter="+e);e.printStackTrace();}
			%>
			</tr>
			<tr>
              <td class='LABEL'  width='25%'><fmt:message key="eAE.DisasterType.label" bundle="${ae_labels}"/></td>
              <td class='fields' width='25%'><select name='disaster_type' disabled>
			   <option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------</option> 
                <%  
                  try 
				  {	
				   PreparedStatement pstmtTrans1 = null;
				   ResultSet rsetTrans1 = null;
                   pstmtTrans1 = con.prepareStatement("select disaster_type_code, short_desc from ae_disaster_type_lang_vw where language_id='"+locale+"' and eff_status='E' order by short_desc");
					
				   rsetTrans1 = pstmtTrans1.executeQuery();
				   while(rsetTrans1!=null && rsetTrans1.next())
					{
					  out.println("<option value='"+rsetTrans1.getString("disaster_type_code")+"'>"+rsetTrans1.getString("short_desc")+""); 
					}
                  if(rsetTrans1!=null) rsetTrans1.close();
				  if(pstmtTrans1!=null) pstmtTrans1.close();
				  }catch(Exception e) {out.println("Exception in Disaster Type="+e);			e.printStackTrace();}
	            %>
				</select>
				</td>
				<%
				/*Below line added for this CRF MMOH-CRF-0644*/
				if(allowSplChar)
				{
				%>
				<td class='LABEL'  width='25%'><fmt:message key="eAE.DisasterReference.label" bundle="${ae_labels}"/></td>
		<td class='fields' width='25%'><input type='text'  name="disaster_Reference"   onKeyPress="return CheckForSpecChar(event)"   maxLength='15' disabled>
		<td colspan=2 class=label >&nbsp;</td>	
		<%
		}
		else
		{
		%>			
		<td class='LABEL'  width='25%'><fmt:message key="eAE.DisRegnReference.label" bundle="${ae_labels}"/></td>
		<td class='fields' width='25%'><input type='text'  name="disaster_Reference"   onKeyPress="return CheckForSpecChars(event)"   maxLength='15' disabled>
		<td colspan=2 class=label >&nbsp;</td>
		<%
		}
		%>
		</tr>
		<tr>
	<%
	/*Below line added for this CRF GDOH-CRF-0129*/
if(isReferral){
     if(isCurrentEncounter){%>
	 <td  class='label' NOWRAP width = '18%'><fmt:message key="Common.Referralfrom.label" bundle="${common_labels}"/></td>
     <td  class='Fields' width = '30%'><input type="text" name="assigncare_location_desc" maxlength="40" size="25" value="<%=assigncare_location_desc%>" <%=referralforcurrentencounter%> >
     </td>	 
	 <%}else{%>
		<td class='LABEL'  width='25%'><fmt:message key="Common.Referralfrom.label" bundle="${common_labels}"/></td>
		<td class='fields' width='25%'><input type='text'  name="presentingproblem_desc" value="" onblur='if(this.value !="") searchPresentingProblem(this,presentingproblem_desc);' ><input type='button' name='presenting_problem' value='?' class='button' onclick='searchPresentingProblem(this,presentingproblem_desc);'  onblur='aa();'></td>
		<td colspan=2 class=label >&nbsp;</td>
		<%}%>
		 <input type='hidden' name='presentingproblem_code' value="">
		<%}else{%>
		 <td class='LABEL'  width='25%'><fmt:message key="Common.PresentingProblem.label" bundle="${common_labels}"/></td>
		<td class='fields' width='25%'><input type='text'  name="presentingproblem_desc" value="" onblur='if(this.value !="") searchPresentingProblem(this,presentingproblem_desc);' ><input type='button' name='presenting_problem' value='?' class='button' onclick='searchPresentingProblem(this,presentingproblem_desc);'  onblur='aa();'><input type='hidden' name='presentingproblem_code' value=""></td>
		<td colspan=2 class=label >&nbsp;</td>
		<%}
		  //End this CRF GDOH-CRF-0129
		%>
		</tr>
		</table> 
		<%} %>
		<table border="0" cellpadding="0" cellspacing="0" align='center' width='92%'>
		<tr><td colspan=4 class=label height=5></td></tr>
		<tr>
		  <td  class=label width='25%'>&nbsp;</td>
	      <td class='BUTTON' width='25%'><input type="button" name="PrevEncounter" class="BUTTON" value='<%=com.ehis.util.BundleMessage.getBundleMessage(pageContext,"Common.PreviousEncounters.label","common_labels")%>'  onClick="showPrevEncounter();"  onblur='if(document.forms(0).visit_within_24hrs.disabled==true)document.forms(0).visit_date_time.focus();' <%=EncounterProp%>></td>
		  <td class='BUTTON' colspan='2'>
          <input type="button" name="visit_within_24hrs" class="BUTTON" value='<%=com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eAE.LastVisitWithin24Hrs.label","ae_labels")%>'   onClick="showLastVisitDetails('LastVisit24');" onblur='document.forms(0).visit_date_time.focus();' disabled>&nbsp;&nbsp;</td>
          </tr>  
		       </table>
</div>
<!-- fields for contact details start -->
<input type='hidden' name='change_address' value=''>
<!-- concat_address_hidden -->
<input type='hidden' name='concat_address_hidden' value=''>		
<input type='hidden' name='concat_NatIdDetails_hidden' value=''>		
<input type='hidden' name='addr1_type' value=''>
<input type='hidden' name='addr_line1' value='' >
<input type='hidden' name='addr_line2' value='' >
<input type='hidden' name='addr_line3' value='' >
<input type='hidden' name='addr_line4' value='' >
<input type='hidden' name='res_town_code' value='' >
<input type='hidden' name='res_town_desc' value='' >
<input type='hidden' name='res_area_code' value=''>
<input type='hidden' name='res_area_desc' value=''>
<input type='hidden' name='postal_code' value=''>	
<input type='hidden' name='postals_code' value=''>	
<input type='hidden' name='region_code' value='' >	
<input type='hidden' name='res_region_code' value='' >	
<input type='hidden' name='region_desc' value='' >	
<input type='hidden' name='country_code' value='' >
<input type='hidden' name='contact1_name' value=''>
<input type='hidden' name='invalid1_yn' value=''>
<input type='hidden' name='addr2_type' value=''>
<input type='hidden' name='mail_addr_line1' maxlength='30' value=''>
<input type='hidden' name='mail_addr_line2' maxlength='30' value=''>
<input type='hidden' name='mail_addr_line3' value=''  maxlength='30'>
<input type='hidden' name='mail_addr_line4' value='' maxlength='30'>
<input type='hidden' name='mail_res_town_code' value='' maxlength='6'>
<input type='hidden' name='mail_res_town_desc' value='' maxlength='6'>
<input type='hidden' name='mail_res_area_code' value='' maxlength='6'>
<input type='hidden' name='mail_res_area_desc' value='' maxlength='6'>
<input type='hidden' name='mail_postal_code' value='' maxlength='8'>
<input type='hidden' name='mail_region_code' value='' maxlength='8'>
<input type='hidden' name='mail_region_desc' value='' maxlength='8'>
<input type='hidden' name='mail_country_code' value='' maxlength='4'>
<input type='hidden' name='contact2_name' value=''>
<input type='hidden' name='invalid2_yn' value=''>
<input type='hidden' name='country_desc' value='' maxlength='6'>
<input type='hidden' name='mail_country_desc' value='' maxlength='6'>
<input type='hidden' name='r_postal_code1' value='' maxlength='45'>
<input type='hidden' name='m_postal_code12' value='' maxlength='45'>
<input type='hidden' name='contact1_no' value=''>
<input type='hidden' name='contact2_no' value=''>
<input type='hidden' name='email' value=''>
<input type='hidden' name='patient_valuables_rcdby' value=''>
<input type='hidden' name='patient_valuables_chkin_dtm' value=''>
<input type='hidden' name='patient_valuables_remarks' value=''> 
  <input type="hidden" name='hddpriority' value='U'>
 <input type="hidden" name='upt_contact_dtls_oa_yn' value="<%=upt_contact_dtls_oa_yn%>"> <!--added changes for HSA-CRF-0226 [IN:050599]-->
<!--Added by Thamizh selvi on 1st Feb 2018 against ML-MMOH-CRF-0601 Start-->
<input type='hidden' name='addr3_type' value="">
<input type='hidden' name='alt_addr_line1' value="">
<input type='hidden' name='alt_addr_line2' value="">
<input type='hidden' name='alt_addr_line3' value="">
<input type='hidden' name='alt_addr_line4' value="">
<input type='hidden' name='alt_town_code' value="">
<input type='hidden' name='alt_town_desc' value="">
<input type='hidden' name='alt_area_code' value="">
<input type='hidden' name='alt_area_desc' value="">
<input type='hidden' name='alt_postal_code' value="">
<input type='hidden' name='alt_postal_desc' value="">
<input type='hidden' name='alt_region_code' value="">
<input type='hidden' name='alt_region_desc' value="">
<input type='hidden' name='alt_country_code' value="">
<input type='hidden' name='alt_country_desc' value="">
<!--End-->
<!--Added by Rameswar on 08-Feb-16 for GDOH-CRF-081-->
<input type="hidden" name='isPracApplicable' value="<%=isPracApplicable%>">

<input type="hidden" name='isAutoPopulateNOKDOBAppl' value="<%=isAutoPopulateNOKDOBAppl%>"><!--Added by Thamizh selvi on 6th Aug 2018 against ML-MMOH-CRF-1177-->

<!-- fields for contact details ends here -->

<script>
		populateContactDetails("<%=contactAddress.toString()%>");
</script>

<!--Added by Ashwini on 18-Dec-2017 for ML-MMOH-CRF-0657-->
<input type="hidden" name='invoke_recall' value="<%=invoke_recall%>">
<script>
if(document.forms(0).invoke_recall.value == "Y")
{
	if(document.forms(0).followup_enc.value == "" || document.forms(0).followup_enc.value == null)
	{
		document.forms(0).followup_enc_remove.style.visibility='hidden';
	}else
	{
		document.forms(0).followup_enc_remove.style.visibility='visible';
	}
}
</script>
<!--End ML-MMOH-CRF-0657-->

<div id = 'ARRIVAL' style = 'display:none'>
 <!--  <a name="tab2" tabindex='23' ></a> -->
	 <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
        <tr><td class='white'>
				<ul id="tablist" class="tablist" >
						<li class="tablistitem" title="Add Visit">
							<a  class="tabA" id='addVisit_tab' >
								<span class="tabAspan" id="addVisit_tabspan" onClick='javascript:expandCollapse("add_Visit_tab")'><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></span>
							</a>
						</li>
						<li class="tablistitem" title="Arrival">
						<a class="tabClicked" id="arrival_tab" >
								<span class="tabSpanclicked" id="arrival_tabspan" onClick='javascript:expandCollapse("arrival_tab")'><fmt:message key="Common.arrival.label" bundle="${common_labels}"/></span>
							</a>
						</li>
						<li class="tablistitem" title="Related Contact details">
							<a class="tabA" id="rlcnts_tab" >
								<span class="tabAspan" id="rlcnts_tabspan" onClick='javascript:expandCollapse("rel_con_tab")'><fmt:message key="eMP.relatedcontacts.label" bundle="${mp_labels}"/></span>
							</a>
						</li>	
						<%if(bl_install_yn.equals("Y")){%>
						<li class="tablistitem" title="Financial Details">
							<a class="tabA" id="findtl_tab" >
								<span class="tabAspan" id="findtl_tabspan" onClick='javascript:expandCollapse("fin_tab")'><fmt:message key="Common.financialdetails.label" bundle="${common_labels}"/></span>
							</a>
						</li>	
					<%}%>	
			</ul>
	</td></tr></table> 

    <table border="0" cellpadding="0" cellspacing="0" align='center' width='92%'>
	<tr>
		<td class='COLUMNHEADER' colspan='4' ><fmt:message key="eAE.EscortDetail.label" bundle="${ae_labels}"/></td>
	</tr>

          <tr><td colspan=4 class=label height=5></td></tr>
          <tr>
            <td class='LABEL'  width='25%' ><fmt:message key="eAE.AccompaniedBy.label" bundle="${ae_labels}"/></td>
			<td class='fields'  width='25%'>
				 <select name='accompany_by' >
					<option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---
				<%  
				   PreparedStatement pstmtAccom = null;
				   ResultSet rsetAccom = null;
				   StringBuffer sqlAMEsc = new StringBuffer();
                   sqlAMEsc.append("SELECT ESCORT_TYPE_CODE, SHORT_DESC  FROM  AM_ESCORT_TYPE_LANG_VW WHERE language_id='"+locale+"' AND EFF_STATUS='E' ORDER BY 2 ");
				   pstmtAccom = con.prepareStatement(sqlAMEsc.toString());
				   rsetAccom = pstmtAccom.executeQuery();
				   while(rsetAccom!=null && rsetAccom.next())
					 {
					out.println("<option value='"+rsetAccom.getString(1)+"'>"+rsetAccom.getString(2)+""); 
					 }
				   if(rsetAccom!=null) rsetAccom.close();
				   if(pstmtAccom!=null) pstmtAccom.close(); 
				   if((sqlAMEsc != null) && (sqlAMEsc.length() > 0))
					{
						sqlAMEsc.delete(0,sqlAMEsc.length());
					}
	             %> 
				 </select>
			</td>
			<td class='label'  colspan='2'>&nbsp;</td> 
          </tr>
		  <tr>	
				<td class='LABEL' ><fmt:message key="Common.relationship.label" bundle="${common_labels}"/></td>
  				<td class='fields' >
 			     <select name='relation_val' >
				  <option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
					   <%
							/*	 
						   pstmt = con.prepareStatement(sqlRelation.toString());
					       rset = pstmt.executeQuery();
						   while(rset_race!=null && rset_race.next())
						   {
                              out.println("<option value='"+rset_race.getString(1)+"'>"+rset_race.getString(2)+" ");
						   }
						   if(pstmt!=null) pstmt.close();
						   if(rset!=null) rset.close();
						   */
						for(int i=0;i<race_array.size();i+=2) {
							out.println("<option value='"+(String) race_array.get(i)+"'>"+(String) race_array.get(i+1)+" ");		
						}
					   %>
                 </select>
				</td>
			<td class='label'  colspan='2'>&nbsp;</td> 
		  </tr>	
		  <tr>	
            <%if(accept_oth_alt_id_yn.equals("Y")){ %>
			<td class='LABEL'  ><fmt:message key="Common.otheraltid.label" bundle="${common_labels}"/></td>
  		    <td class='fields'  colspan='2' >
 			      <select name='other_alt_id'  onchange='ClearAltID();' >
				     <option value='' >----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----------
					     <%
                             sqlAlt.append("select alt_id_type,mp_get_desc.mp_alternate_id_type(alt_id_type,'"+locale+"','1') short_desc from  mp_alternate_id_type where  alt_id_type not in (select alt_id1_type   from mp_param where module_id='MP' union select  nvl(alt_id2_type,1) from mp_param where module_id='MP' union  select nvl(alt_id3_type,2) from mp_param where module_id='MP' union select nvl(alt_id4_type,3) from  mp_param where module_id='MP') and eff_status='E' order by 2");
						     PreparedStatement pstmtAlt = null;
				             ResultSet rsetAlt = null;
						     pstmtAlt = con.prepareStatement(sqlAlt.toString());
					         rsetAlt = pstmtAlt.executeQuery();
							  while(rsetAlt!=null && rsetAlt.next())
						      {
						          out.println("<option value='"+rsetAlt.getString(1)+"'>"+rsetAlt.getString(2)+" ");
						      }
						      if(pstmtAlt!=null) pstmtAlt.close();
						      if(rsetAlt!=null) rsetAlt.close(); 
				            %>  
                   </select>
                 <input type='text'  name="oth_alt_id"  value="" maxLength='15' size='15'  ></td>
               <%}else {%>
				  <td class='label'  colspan='2'>&nbsp;</td>
              <% }%>
			      <td class='label' >&nbsp;</td> 
				</tr>		 
               <tr>	
				 <%String nat_on_blurfn_st = "";
				   String nat_on_blurfn_st_nok = "";//Added by Thamizh selvi on 8th Aug 2018 against ML-MMOH-CRF-1177
							//validateNationalID(this,'"+nat_id_check_digit_id+"','"+nat_id_chk_len+"','"+nat_id_prompt+"');

							/*  above line commeted for icn:19689 date:Thursday, March 11, 2010*/ 

					if(accept_national_id_no_yn.equals("Y")){
						nat_on_blurfn_st = "makeValidString(this);CheckSplCharsNatID(this);";
						 /*Added by Thamizh selvi on 8th Aug 2018 against ML-MMOH-CRF-1177 Start*/
						 if(isAutoPopulateNOKDOBAppl && natDataSourceId.equals("NRIC"))
							nat_on_blurfn_st_nok = "makeValidString(this);if(CheckSplCharsNatID(this)){validateNOKNatIDWithDOB(this);}";
						 else
							nat_on_blurfn_st_nok = "makeValidString(this);CheckSplCharsNatID(this)";
						 /*End*/
						
						if(nat_id_accept_alphanumeric_yn.equals("Y"))
						{
							nat_id_onKeyPress = "CheckForAlphaCharsNatID(event);";
						}
						else
						{
							if(nat_id_check_digit_id.equals("M11"))
								nat_id_onKeyPress = "CheckForCharsNatID(event);";
							else
								nat_id_onKeyPress = "allowValidNumber(this,event,2, 0);";
						}

						/*
						if ( nat_id_check_digit_id.equals("M11") )
							nat_id_onKeyPress = "return CheckForCharsNatID(event);";
						else
							nat_id_onKeyPress = "return allowValidNumber(this,event,2, 0);";

						*/							
					%>
	    	    <td class='LABEL' ><%=nat_id_prompt%>&nbsp;</td>
				<td class='fields' ><input type='text'  name="nat_id_no"  value="" maxlength='<%= nat_id_length%>' onblur="<%=nat_on_blurfn_st%>;document.forms(0).e_addr_line1.focus();" onkeypress='return <%=nat_id_onKeyPress%>'  size='20' >
		    	</td><%}else{%>
                <td class='label'  colspan='2'>&nbsp;</td> 
                <% } %>
				<td class='label'  colspan='2'>&nbsp;</td> 
	        </tr>	
			<input type='hidden' name='nat_id_check_digit_id' value='<%= nat_id_check_digit_id%>'>
			<input type='hidden' name='nat_id_chk_len' value='<%= nat_id_chk_len%>'>
			<input type='hidden' name='nat_id_prompt' value='<%= nat_id_prompt%>'>
			<!--Added by Thamizh selvi on 7th Aug 2018 against ML-MMOH-CRF-1177 Start-->
			<input type='hidden' name='natInvokeRoutine' value='<%=natInvokeRoutine%>'>
			<input type='hidden' name='natDataSourceId' value='<%=natDataSourceId%>'>
			<!--End-->
			<input type='hidden' name='m_town' value=''>
			<input type='hidden' name='r_town' value='' >
			<input type='hidden' name='n_town' value='' >
			<input type='hidden' name='f_town' value='' >
			<input type='hidden' name='e_town' value='' >
			<input type='hidden' name='r_area' value=''>
			<input type='hidden' name='m_area' value=''>
			<input type='hidden' name='n_area' value=''>
			<input type='hidden' name='f_area' value=''>
			<input type='hidden' name='e_area' value=''>
			<input type='hidden' name='r_region' value=''>
			<input type='hidden' name='m_region' value=''>
			<input type='hidden' name='n_region' value=''>
			<input type='hidden' name='f_region' value=''>
			<input type='hidden' name='e_region' value=''>
			

			<!-- added new -->
            <input type='hidden' name='employ_postal_code' value=''> 
			<input type='hidden' name='m_postal_code' value=''>
			<input type='hidden' name='next_postal_code' value=''>
			<input type='hidden' name='first_postal_code' value=''>
            
			<!-- Below Added by Suji Keerthi for ML-MMOH-CRF-1527 US008 -->
			<input type='hidden' name='nkma_town' value=''>
			<input type='hidden' name='contact1_region' value=''>
			<input type='hidden' name='nkma_area' value=''>
			<input type='hidden' name='n_ma_postal_code' value=''>

			<input type='hidden' name='contact2_res_town' value=''>
			<input type='hidden' name='contact2_region' value=''>
			<input type='hidden' name='contact2_res_area' value=''>		
			<input type='hidden' name='fst_no_ma_pos_cod' value=''>
			<!--Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008 -->
	<%
		tindex	=	31;
		out.println("<tr>") ; 
		StringBuffer sb2 = new StringBuffer() ;
		StringBuffer sb12 = new StringBuffer() ;
		StringBuffer sba2 = new StringBuffer() ;
		StringBuffer sbar2 = new StringBuffer();
        StringBuffer fieldVal2 = new StringBuffer("");
                    for(int i=0;i<contact_col_names.length; i++)
                            {
                                  String  val = contact_fields[i] ;
								  sb2.append(val);
                                   int j=0 ;
								   int j1 = 0;
                                   String old_val = "" ;
                                   String new_val = "" ;
                                     
                                     if(contact_col_names[i].equalsIgnoreCase("addr_line1_prompt"))
                                     {
                                        old_val = "r_addr_line1" ;
                                        new_val = "e_addr_line1" ;
										     
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line2_prompt"))
                                     {
                                        old_val = "r_addr_line2" ;
                                        new_val = "e_addr_line2" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line3_prompt"))
                                     {
                                        old_val = "r_addr_line3" ;
                                        new_val = "e_addr_line3" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line4_prompt"))
                                     {
                                        old_val = "r_addr_line4" ;
                                        new_val = "e_addr_line4" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("res_town_prompt"))
                                     {
                                        old_val = "r_town_code" ;
                                        new_val = "m_town_code" ;
									 }//Added by kumar on 13/03/2003 for region 
									 else if(contact_col_names[i].equalsIgnoreCase("region_prompt"))
                                     {
                                        old_val = "r_region_code" ;
                                        new_val = "m_region_code" ;
                                     }
									 else if(contact_col_names[i].equalsIgnoreCase("res_area_prompt"))
                                     {
                                        old_val = "r_area_code" ;
                                        new_val = "m_area_code" ;
                                     }                                     
                                     else if(contact_col_names[i].equalsIgnoreCase("postal_code_prompt"))
                                     {
                                        old_val = "r_postal_code" ;
                                        new_val = "m_postal_code" ;
                                     }
									out.println("<td class='label'  >"+contact_prompts[i]+"</td>") ;	
                                    while(val.indexOf(old_val) != -1)
                                    {
                                        j = val.indexOf(old_val,j) ;
                                        sb2 = sb2.replace(j,(j+old_val.length()),new_val);
                                        val = sb2.toString();
                                    }
             // Newly added
			if(contact_col_names[i].equalsIgnoreCase("res_town_prompt")) {
				sba2.append(val);
				while(val.indexOf("r_postal_code") != -1) {
					j1 = val.indexOf("r_postal_code",j1) ;
					sba2 = sba2.replace(j1,(j1+"r_postal_code".length()),"m_postal_code");
					val = sba2.toString();
				}
			}
			if(contact_col_names[i].equalsIgnoreCase("res_area_prompt")) {
				j1 = 0;
				sbar2.append(val);
				while(val.indexOf("r_postal_code") != -1) {
					j1 = val.indexOf("r_postal_code",j1) ;
					sbar2 = sbar2.replace(j1,(j1+"r_postal_code".length()),"m_postal_code");
					val = sbar2.toString();
				}
			}
								   sb12.append(val);
									for(int z=0;z<val.length();z++)
									{
										String tempVal=sb12.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal2.append(++tindex);
										}
										else
										{
											fieldVal2.append(tempVal);
										}
									}
                                    val = fieldVal2.toString();
                                    out.println("<td class='fields'>"+val) ;
									
						   out.println("</td>");
						   out.println("<td class='label'  colspan='2'>&nbsp;</td>");
						   out.println("</tr>") ;
						   sb12.delete(0,sb12.length());
						   fieldVal2.delete(0,fieldVal2.length());
						   sb2.delete(0,sb2.length());
						   sba2.delete(0,sba2.length());
						   sbar2.delete(0,sbar2.length());
                            }
		       %>                
          <tr>
    		<td  class='label'><fmt:message key="Common.country.label" bundle="${common_labels}"/></td>
            <td class='fields'><input  type='text' name='e_country_desc' size='15' maxlength='15' onblur='if(this.value !="")searchCountry(contry_code[0],e_country_desc);' tabindex='44'><input type='button' name='contry_code' value='?' class='button' onclick='searchCountry(this,e_country_desc)' tabindex='45'>
				<input type='hidden' name='e_country_code' value=''>
            </td>
            <td class='LABEL'  colspan='2'>&nbsp;</td> 
		  </tr>
		  <tr>
		    <td class='LABEL' ><fmt:message key="Common.remarks.label" bundle="${common_labels}"/></td>
  		    <td class='fields'  colspan='3'>
 				   <textarea name='arrival_remarks' cols='60' rows='2' align='left'  onKeyPress='checkMaxLimit(this,2000);' onBlur='makeValidString(this);return(callCheckMaxLen(this,2000,"Remarks"));'  tabindex='46'><%=remarks%></textarea>
		    </td>
		  </tr>
		  <tr><td colspan=4 class=label height=5></td></tr>	
		  <tr>
				<td class='COLUMNHEADER' colspan='4' ><fmt:message key="eAE.AmbulanceDetails.label" bundle="${ae_labels}"/></td>
		  </tr>
          <tr><td colspan=4 class=label height=5></td></tr>
          <tr>
			 <td class='LABEL'  width='25%' ><fmt:message key="eAE.NameofEscortService.label" bundle="${ae_labels}"/></td>
  		     <td class='fields'  width='25%'>
 			 <input type='text'  name="name_of_escort"  value="" maxLength='30' size='25'  onBlur="makeValidString(this)" tabindex='47'>
		     </td>
			 <td colspan=2 class=label >&nbsp;</td>
		  </tr>

          <tr>
				<td class='LABEL' ><fmt:message key="eAE.EscAmbulanceContNo.label" bundle="${ae_labels}"/></td>
				<td class='fields' ><input type='text'  name='ambulance_contact_no' value='' maxLength='18' size='20' onBlur='makeValidString(this)' tabindex='48'></td>
			   <td colspan=2 class=label >&nbsp;</td>
		  </tr>

		  <tr>
			   <td class='LABEL' ><fmt:message key="eAE.VehicleRegNo.label" bundle="${ae_labels}"/></td>
			   <td class='fields' ><input type='text'  name='motor_vehicle_reg_no' value="" maxLength='15' size='20'  onBlur='makeValidString(this);document.forms(0).accompany_by.focus();' tabindex='49'></td>
			   <td colspan=2 class=label >&nbsp;</td>
		  </tr>
          <tr><td colspan=4 class=label height=5></td></tr>

	    </table>
  </div>
     <!--  <a name="tab3" ></a>  -->
	 <div id = 'RELATEDCONTACT' style = 'display:none'>
	   <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
        <tr><td class='white'>
				  <ul id="tablist" class="tablist" >
						<li class="tablistitem" title="Add Visit">
							<a class="tabA" id='addVisit_tab' >
								<span class="tabAspan" id="addVisit_tabspan" onClick='javascript:expandCollapse("add_Visit_tab")'><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></span>
							</a>
						</li>
						<li class="tablistitem" title="Arrival">
							<a class="tabA" id="arrival_tab" >
								<span class="tabAspan" id="arrival_tabspan" onClick='javascript:expandCollapse("arrival_tab")'><fmt:message key="Common.arrival.label" bundle="${common_labels}"/></span>
							</a>
						</li>
						<li class="tablistitem" title="Related Contact details">
							<a class="tabClicked" id="rlcnts_tab" >
								<span class="tabSpanclicked" id="rlcnts_tabspan" onClick='javascript:expandCollapse("rel_con_tab")'><fmt:message key="eMP.relatedcontacts.label" bundle="${mp_labels}"/></span>
							</a>
						</li>	
						<%if(bl_install_yn.equals("Y")){%>
						<li class="tablistitem" title="Financial Details">
							<a class="tabA" id="findtl_tab" >
								<span class="tabAspan" id="findtl_tabspan" onClick='javascript:expandCollapse("fin_tab")'><fmt:message key="Common.financialdetails.label" bundle="${common_labels}"/></span>
							</a>
						</li>	
					<%}%>	
			</ul>
	 </td></tr></table> 
	   
	<table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
      <tr><td class='white'>
	  
	  	<!-- <a name='kin'></a> -->
			<ul id="tablist" class="tablist">
				<li class="tablistitem" title="Next of kin">
					<a class="tabClicked" id="firstkin" >
						<span class="tabSpanclicked" id="firstkinspan" onClick='javascript:expandCollapse("next_of_kin")'><fmt:message key="Common.nextofkin.label" bundle="${common_labels}"/></span>
					</a>
				</li>
				<li class="tablistitem" title="Contact Mode and Address details">
					<a class="tabA" id="firstkin1" >
						<span class="tabAspan" id="firstkin1span" onClick='javascript:expandCollapse("first_to_notify")'><fmt:message key="Common.firsttonotify.label" bundle="${common_labels}"/></span>
					</a>
				</li>
				<li class="tablistitem" title="Employment Details">
					<a class="tabA" id="firstempyr" >
						<span class="tabAspan" id="firstempyrspan" onClick='javascript:expandCollapse("emp_details")'><fmt:message key="Common.employmentdetails.label" bundle="${common_labels}"/></span>
					</a>
				</li>	
			</ul>
          </td></tr>
</table>
<div id = 'NEXT_OF_KIN' style = 'display:none'>
  <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
            <tr><td valign=top width='50%'><table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
				<tr><td colspan=4 class=label height=5></td></tr>
			<!-- added by mujafar for ML-MMOH-CRF-0632 START -->	
				<%
				if(isAENextofKinchngAppl)
				{
				%>
				<tr>
				<td  class='label' width='25%' >
				<fmt:message key="Common.patientId.label" bundle="${common_labels}"/>&nbsp;&nbsp;<span class='field'><td class='fields' width='25%'><input type='text'  name="patient_id1"  value="" maxLength='<%=patient_id_length%>' size='20' onKeyPress="return(CheckForSpecChars(event))" 
			onBlur='changeCase(this);searchPatient1(document.forms(0).patient_id1);'>&nbsp;<input type="button" name="patient_search" class=BUTTON value="?" onChange='disReset();' onClick="if(document.forms(0).patient_id1.value==''){callPatientSearch1()}" ></td></span>	
             <input type='hidden' name='patient_id1_val' value=''>
            </td>
			
				</tr>
				
				<tr>
				 <% if (accept_national_id_no_yn.equals("Y")){%>  
		 		  <td  class='label' width='25%'><%=nat_id_prompt%>&nbsp;</td>
			      <td class='fields'  width='25%'>
				     <input type='text' name='contact1_new_nat_id_no' maxlength='<%=nat_id_length%>' size='20'  onkeypress='return <%=nat_id_onKeyPress%>'  onblur="<%=nat_on_blurfn_st_nok%>" value="<%=contact1_nat_id_no%>" onkeypress="return allowValidNumber(this,event,20, 0);" ><!--Modified by Thamizh selvi on 6th Aug 2018 against ML-MMOH-CRF-1177-->
				  </td>  
			   <%}else {%>  
                 <td align='right' class='label' width='5%' ></td> 
               <%}%>   
		  </tr>
				
			
				<%}%>
			<!-- added by mujafar for ML-MMOH-CRF-0632 END -->	
				
				
				
				
				<tr> <!--below length change CRF-0887 by mano -->
	                <td  class='label' width='25%'><fmt:message key="Common.name.label" bundle="${common_labels}"/></td>
	                <td class='fields' width='25%'>
					<% //Below line added for ML-MMOH-CRF-0887.1
					if(increasedaddressLength){%>
					<textarea name='next_contact_name' rows=3 maxlength=100 cols=45 onblur='makeValidString(this); maxLengthPaste(this);' onkeypress='checkMaxLimit(this,80)' onkeyup='RemoveSpecialChar(this)'><%=contact1_name%></textarea> <!-- maxlength increased to 100 for ICN-7899 -->
					<%}else{%>					
					<input type="text" name="next_contact_name"  maxlength='80' size='30'  value="<%=contact1_name%>">
					<%}%>
					</td>
				 </tr>
				 <tr>
					<td class='label'  width='25%'><fmt:message key="Common.relationship.label" bundle="${common_labels}"/></td>
					<td class='fields' width='25%'>
						<select name='next_contact_relation' >
                            <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
                         
					<%

					/*
					String relcode = contact1_relation;
					pstmtR = con.prepareStatement(sqlRelation.toString());
                    rsetR=pstmtR.executeQuery();
					if(rset_race!=null)
					{
					   while(rset_race.next())
					   {
							String relationDesc = rset_race.getString(2);
							String relationCode = rset_race.getString(1);
						
							if(relcode.equals(relationCode))
								sel = "selected";
							else
								sel="";
				
							out.println("<option value='"+relationCode+"' "+sel+">"+relationDesc+"</option>");
						}
					} 
					*/
					String relcode = contact1_relation;

					for(int i=0;i<race_array.size();i+=2) {

						String relationDesc = (String) race_array.get(i+1);
						String relationCode = (String) race_array.get(i);
						
						if(relcode.equals(relationCode))
							sel = "selected";
						else
							sel="";
				
						out.println("<option value='"+relationCode+"' "+sel+">"+relationDesc+"</option>");

						//out.println("<option value='"+(String) race_array.get(i)+"'>"+(String) array_list.get(i+1)+" ");		
					}

				   //if(rsetR!=null) rsetR.close();
				   //if(pstmtR!=null) pstmtR.close();
                    %>
                    </select>
				 </td>
				</tr>
		<!-- IF added by mujafar for ML-MMOH-CRF-0632  -->		
			<%if(!isAENextofKinchngAppl)
			{%>
		      <tr>
				 <% if (accept_national_id_no_yn.equals("Y")){%>  
		 		  <td  class='label' width='25%'><%=nat_id_prompt%>&nbsp;</td>
			      <td class='fields'  width='25%'>
				     <input type='text' name='contact1_new_nat_id_no' maxlength='<%=nat_id_length%>' size='20'  onkeypress='return <%=nat_id_onKeyPress%>'  onblur="<%=nat_on_blurfn_st_nok%>" value="<%=contact1_nat_id_no%>" onkeypress="return allowValidNumber(this,event,20, 0);" ><!--Modified by Thamizh selvi on 6th Aug 2018 against ML-MMOH-CRF-1177-->
				  </td>  
			   <%}else {%>  
                 <td align='right' class='label' width='5%' ></td> 
               <%}%>   
		  </tr>
			<%}%> 
	<%	
	if(Accept_oth_alt_id_yn.equals("Y")){%>
          <tr><td class='label' width='25%'><fmt:message key="Common.otheraltid.label" bundle="${common_labels}"/></td>
              <td  class='fields'  width='25%'>
					<select name='contact1_oth_alt_id_type' onChange='enableOtherAltIdText(this.value)' > 
  						<option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---
					<%
					  oth_stmt = con.prepareStatement(sqlAlt.toString());
					  oth_rset = oth_stmt.executeQuery();	
				
					  if(oth_rset != null)
					  {
						while (oth_rset.next())
						{          
						  out.println ( "<Option value=\""+oth_rset.getString("alt_id_type")+"\" >"+oth_rset.getString("SHORT_DESC")+"</Option>" ) ;
						}
					  }
                     if(oth_rset!=null) oth_rset.close();
                     if(oth_stmt!=null) oth_stmt.close();

				    %>
					</select>
                        <input type='text' name='contact1_oth_alt_id_no' maxlength='20' size='20' onblur='makeValidString(this);'  DISABLED value = "">
              </td>
		  </tr><%}%>
		  <tr><td class='label'  width='25%'><fmt:message key="Common.birthDate.label" bundle="${common_labels}"/></td>
              <td class='fields'  width='25%'>
                  <input type='text' name='contact1_birth_date' id='birthdate1' maxlength='10' size='10'  value="<%=contact1_birth_date%>" onBlur = 'makeValidString(this);doDate(this);'><img src='../../eCommon/images/CommonCalendar.gif' id="birthdate"  onClick="document.forms(0).contact1_birth_date.select();return showCalendar('birthdate1');" style='cursor:hand' ></img>
                </td>
		  </tr>	
		  <tr><td  class='label' width='25%'><fmt:message key="eMP.occupation.label" bundle="${mp_labels}"/></td>
              <td class='fields'  width='25%'>
                  <input type='text' name='next_job_title' maxlength='30' size='30' onblur='makeValidString(this);document.forms(0).next_addr_line1.focus();' value ="<%=job1_title%>">
              </td>
			
		</table>
			  </td>  
			  <td><table cellspacing='0' cellpadding='0' border=0>
			  <!-- Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008 -->
				<% if(resiAddMailAdd){%>
				<td width='70%'><table cellspacing='0' cellpadding='3' border='0' width='100%'>
				<tr>
                     <td class='COLUMNHEADER'  ></td>
                     <td  class='COLUMNHEADER' ><fmt:message key="eMP.residenceaddress.label" bundle="${mp_labels}"/></td>
                     <td  class='COLUMNHEADER' ><fmt:message key="Common.MailingAddress.label" bundle="${common_labels}"/></td>
                </tr>
                </td>
                <%} %>
                <!-- Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008 -->
                <%
					out.println("<tr><td colspan=8 class=label height=5></td></tr>");
					out.println("<tr>") ;
					StringBuffer sb3 = new StringBuffer() ;
					StringBuffer sb31 = new StringBuffer() ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
					StringBuffer sb13 = new StringBuffer() ;
					StringBuffer sb131 = new StringBuffer() ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
					StringBuffer sba3 = new StringBuffer() ;
					StringBuffer sba31 = new StringBuffer() ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
					StringBuffer sbar3 = new StringBuffer() ;
					StringBuffer sbar31 = new StringBuffer() ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                    StringBuffer fieldVal3 = new StringBuffer("");
                                        StringBuffer fieldVal31 = new StringBuffer(""); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                    for(int i=0;i<contact_col_names.length; i++)
                            {   
						            String  val = contact_fields[i] ;
						            String  val1 = contact_fields[i] ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sb3.append(val);
									sb31.append(val1); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
								    int j=0 ;
									int j1 = 0;
                                     String old_val = "" ;
                                     String new_val = "" ;
                                     String new_val1 = "" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     
                                     if(contact_col_names[i].equalsIgnoreCase("addr_line1_prompt"))
                                     {
                                        old_val = "r_addr_line1" ;
                                        new_val = "next_addr_line1" ;
										new_val1 = "n_next_addr_line1" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
										     
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line2_prompt"))
                                     {
                                        old_val = "r_addr_line2" ;
                                        new_val = "next_addr_line2" ;
										new_val1 = "n_ma_addr_line2" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line3_prompt"))
                                     {
                                        old_val = "r_addr_line3" ;
                                        new_val = "next_addr_line3" ;
										new_val1 = "n_ma_addr_line3" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line4_prompt"))
                                     {
                                        old_val = "r_addr_line4" ;
                                        new_val = "next_addr_line4" ;
										new_val1 = "n_ma_addr_line4" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("res_town_prompt"))
                                     {
                                        old_val = "r_town_code" ;
                                        new_val = "contact1_res_town_code" ;
										new_val1 = "n_contact_ma_town_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									 }
									 else if(contact_col_names[i].equalsIgnoreCase("region_prompt"))
                                     {
                                        old_val = "r_region_code" ;
                                        new_val = "contact1_region_code" ;
										new_val1 = "n_contac_region_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
									 else if(contact_col_names[i].equalsIgnoreCase("res_area_prompt"))
                                     {
                                        old_val = "r_area_code" ;
                                        new_val = "contact1_res_area_code" ;
										new_val1 = "n_contact_ma_area_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }                                     
                                     else if(contact_col_names[i].equalsIgnoreCase("postal_code_prompt"))
                                     {
                                        old_val = "r_postal_code" ;
                                        new_val = "next_postal_code" ;
										new_val1 = "n_ma_postal_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
									out.println("<td class='label' nowrap align='right' >"+contact_prompts[i]+"</td>") ;	
                                    while(val.indexOf(old_val) != -1)
                                    {
                                        j = val.indexOf(old_val,j) ;
                                        sb3 = sb3.replace(j,(j+old_val.length()),new_val);
                                        val = sb3.toString();

										sb31 = sb31.replace(j,(j+old_val.length()),new_val1); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                        val1 = sb31.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                    }
                     // Newly added
					if(contact_col_names[i].equalsIgnoreCase("res_town_prompt")) {
						sba3.append(val);
						sba31.append(val1); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sba3 = sba3.replace(j1,(j1+"r_postal_code".length()),"next_postal_code");
							val = sba3.toString();

							sba31 = sba31.replace(j1,(j1+"r_postal_code".length()),"n_ma_postal_code"); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
							val1 = sba31.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						}
					}
					if(contact_col_names[i].equalsIgnoreCase("res_area_prompt")) {
						j1 = 0;
						sbar3.append(val);
						sbar31.append(val1); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sbar3 = sbar3.replace(j1,(j1+"r_postal_code".length()),"next_postal_code");
							val = sbar3.toString();

							sbar31 = sbar31.replace(j1,(j1+"r_postal_code".length()),"n_ma_postal_code"); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
							val1 = sbar31.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						}
					}
								   sb13.append(val);
									for(int z=0;z<val.length();z++)
									{
										String tempVal=sb13.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal3.append(++tindex);
										}
										else
										{
											fieldVal3.append(tempVal);
										}
									}
                                    val = fieldVal3.toString();	
									
									//Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sb131.append(val1);
									for(int z=0;z<val1.length();z++)
									{
										String tempVal=sb131.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal31.append(++tindex);
										}
										else
										{
											fieldVal31.append(tempVal);
										}
									}
                                    val1 = fieldVal31.toString();	
									if(resiAddMailAdd){
                                    out.println("<td class='fields' >"+val+"&nbsp;&nbsp;") ;
                                    out.println("<td class='fields' >"+val1+"&nbsp;&nbsp;") ;
						            out.println("</td>");
						            out.println("</td>");
									}else{
                                    out.println("<td class='fields' >"+val) ;
						            out.println("</td>");
									}
						            //Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008
						   out.println("</tr>") ;
						   sb13.delete(0,sb13.length());
						   sb131.delete(0,sb131.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                           fieldVal3.delete(0,fieldVal3.length());
                           fieldVal31.delete(0,fieldVal31.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						   sb3.delete(0,sb3.length());
						   sb31.delete(0,sb31.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						   sba3.delete(0,sba3.length());
						   sba31.delete(0,sba31.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						   sbar3.delete(0,sbar3.length());
						   sbar31.delete(0,sbar31.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                            }
        		  
                %>  
		<script>
		  // Added on 7/05/2004 for assigning values to dynamically generated address related fields..
						if(document.forms(0).next_addr_line1)
						   document.forms(0).next_addr_line1.value = "<%=addr1_line1%>" ;
						if(document.forms(0).next_addr_line2)
						   document.forms(0).next_addr_line2.value = "<%=addr1_line2%>" ;
						if(document.forms(0).next_addr_line3)
						   document.forms(0).next_addr_line3.value = "<%=addr1_line3%>" ;
						if(document.forms(0).next_addr_line4)
						   document.forms(0).next_addr_line4.value = "<%=addr1_line4%>" ;
						if(document.forms(0).contact1_res_town_code)
						{
						 document.forms(0).contact1_res_town_code.value = "<%=contact1_res_town_desc%>";
						 document.forms(0).n_town.value = "<%=contact1_res_town%>";
						}
						if(document.forms(0).contact1_region_code)
						{
					     document.forms(0).contact1_region_code.value = "<%=contact1_region_desc%>";
						 document.forms(0).n_region.value = "<%=contact1_region_code%>"; 
                        }
						if(document.forms(0).contact1_res_area_code)
						{
                		document.forms(0).contact1_res_area_code.value = "<%=contact1_res_area__desc%>";
						document.forms(0).n_area.value = "<%=contact1_area_code%>"; 
						}
						if(document.forms(0).next_postal_code1){
						   document.forms(0).next_postal_code.value = "<%=postal1_code%>";
						 document.forms(0).next_postal_code1.value = "<%=postal1_desc%>";
						 
						}
                        //Below added by Suji keerthi for ML-MMOH-CRF-1527 US008
						if(document.forms(0).n_next_addr_line1)
						   document.forms(0).n_next_addr_line1.value = "<%=nk_mail_addr_line1%>" ;
						if(document.forms(0).n_ma_addr_line2)
						   document.forms(0).n_ma_addr_line2.value = "<%=nk_mail_addr_line2%>" ;
						if(document.forms(0).n_ma_addr_line3)
						   document.forms(0).n_ma_addr_line3.value = "<%=nk_mail_addr_line3%>" ;
						if(document.forms(0).n_ma_addr_line4)
						   document.forms(0).n_ma_addr_line4.value = "<%=nk_mail_addr_line4%>" ;
						if(document.forms(0).n_contact_ma_town_code)
						{
						 document.forms(0).n_contact_ma_town_code.value = "<%=n_contact_ma_town_desc%>";
						 document.forms(0).nkma_town.value = "<%=nkcontact1_res_town%>";
						}
						if(document.forms(0).n_contac_region_code)
						{
					     document.forms(0).n_contac_region_code.value = "<%=n_contac_region_desc%>";
						 document.forms(0).contact1_region.value = "<%=nkcontact1_region_code%>"; 
                        }
						if(document.forms(0).n_contact_ma_area_code)
						{
                		document.forms(0).n_contact_ma_area_code.value = "<%=n_contact_ma_area_desc%>";
						document.forms(0).nkma_area.value = "<%=nkcontact1_area_code%>"; 
						}
						if(document.forms(0).n_ma_postal_code1){
						   document.forms(0).n_ma_postal_code.value = "<%=nkpostal1_code%>";
						 document.forms(0).n_ma_postal_code1.value = "<%=nkpostal1_desc%>";
						 
						}
						
                        //Ended by Suji keerthi for ML-MMOH-CRF-1527 US008
        // End of addition on 7/05/2004 for assigning values to dynamically generated address related fields..
		</script>
          <tr>
			  <td  class='label' width='25%'><fmt:message key="Common.country.label" bundle="${common_labels}"/></td>
              <td class='fields' width='25%'><input align='left' type='text' name='next_country_desc'                       size='15' maxlength='15' onblur='if(this.value !="")searchCountry(contry_code[0],next_country_desc);' value = "<%=country1_code_desc%>" tabindex='56'><input type='button' name='contry_code' value='?' class='button' onclick='searchCountry(this,next_country_desc)' tabindex='57'>
						<input type='hidden' name='next_country_code' >
                        <script>
						   if(document.forms(0).next_country_code)
						      document.forms(0).next_country_code.value = "<%=country1_code%>";
						   if(document.forms(0).next_country_desc)
							  document.forms(0).next_country_desc.value = "<%=country1_code_desc%>";
						</script>
              </td>
			  <!--Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008-->
				<% if(resiAddMailAdd){%>
					
					<td class='fields'><input  type='text' name='nk_ma_country_desc' size='15' maxlength='15' value='<%=nk_mail_country_desc%>' onblur='if(this.value !="") searchCountry(nk_ma_country_code,nk_ma_country_desc);' ><input type='button' name='nk_ma_country_code' value='?' class='button' onclick='searchCountry(this,nk_ma_country_desc)' >
					<input type='hidden' name='nkin_mail_country_code' value="<%=nkin_m_country_desc%>">
                    <script>
						   if(document.forms(0).nkin_mail_country_code)
						      document.forms(0).nkin_mail_country_code.value = "<%=nk_mail_country_code%>";
						   if(document.forms(0).nk_ma_country_desc)
							  document.forms(0).nk_ma_country_desc.value = "<%=nk_mail_country_desc%>";
						</script>
					</td>
				</tr>
				<tr>
					<td class='label' nowrap ><fmt:message key="eMP.ContactPerson.label" bundle="${mp_labels}"/></td> 
                    <td class='fields'>
                    <input type='text' name='ra_contact_name' size='30' maxlength='30'  onblur='makeValidString(this);' value= "<%=nk_res_contact_name%>" >
                    </td>
                    <td class='fields'>
                    <input type='text' name='ma_contact_name' size='30' maxlength='30'  onblur='makeValidString(this);' value="<%=nk_mail_contact_name%>">
                    </td></tr>
					<table border = 0 cellspacing='0' cellpadding='1' width='100%'>
			        <tr><td class='label' width='25%'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				    <a href='javascript:copyDetails(2)'><fmt:message key="eMP.CopyFirsttoNotify.label" bundle="${mp_labels}"/></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			        <a href='javascript:copyDetails(1)'><fmt:message key="eMP.CopyResidenceAddress.label" bundle="${mp_labels}"/></a>
			    </td></tr></table>
					</table>			
			
				<%}%>
			 <!--Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008-->
          <% if(!resiAddMailAdd){ //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
          <tr>
              <td  class='label' width='25%'><fmt:message key="Common.homephoneno.label" bundle="${common_labels}"/></td>
              <td class='fields' width='25%'><input type='text' name='next_res_tel_no' maxlength='20' size='20' onblur='makeValidString(this);' value ='<%=res1_tel_no%>' tabindex='58'>
              </td>
		  </tr>
          <tr>
              <td class='label' width='25%' ><fmt:message key="Common.MobileNo.label" bundle="${common_labels}"/></td>
              <td class='fields' width='25%'><input type='text' name='contact1_mob_tel_no' maxlength='20' size='20' onblur='makeValidString(this);' value ="<%=res1_mbo_tel_no%>" tabindex='59'>
              </td>
		  <tr>
			  <td class='label' width='25%'><fmt:message key="Common.officephoneno.label" bundle="${common_labels}"/></td>
              <td class='fields' width='25%'><input type='text' name='next_off_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value ="<%=off1_tel_no%>" tabindex='60'>
              </td>
          </tr>
		  <tr>
		      <td class='label' width='25%'><fmt:message key="Common.email.label" bundle="${common_labels}"/></td>
              <td class='fields' width='25%'><input type='text' name='contact1_email_id' maxlength='50' size='42' onblur='makeValidString(this);document.forms(0).next_contact_name.focus();' value = "<%=contact1_email_id%>" tabindex='61'>
              </td>
          </tr>
		  <%} //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
		  
		  </td></tr>
		  <tr><td colspan=6 class=label height=5></td></tr></table>
		  <%//Below Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
			  if(resiAddMailAdd){%>
		  <table width="100%"><tr>
				<td  class='COLUMNHEADER' colspan='7' ><fmt:message key="eMP.ContactModes.label" bundle="${mp_labels}"/></td>
                </tr>
				<tr>

					<td  class='label' width='25%'><fmt:message key="Common.homephoneno.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type='text' name='next_res_tel_no' maxlength='20' size='20' onblur='makeValidString(this);' value ='<%=res1_tel_no%>' tabindex='58'>
                    </td>
				
                    <td class='label' width='25%' ><fmt:message key="Common.MobileNo.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type='text' name='contact1_mob_tel_no' maxlength='20' size='20' onblur='makeValidString(this);' value ="<%=res1_mbo_tel_no%>" tabindex='59'>
                    </td>
				
					<td class='label' width='25%'><fmt:message key="Common.email.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type='text' name='contact1_email_id' maxlength='50' size='42' onblur='makeValidString(this);' value = "<%=contact1_email_id%>" tabindex='61'>
                    </td>     
                </tr>
				<%String enabledisable = "disabled";
					   codes = new ArrayList() ; 
					   descs = new ArrayList() ;
					   sql = "select contact_mode,short_desc from mp_contact_mode_lang_vw where language_id='"+locale+"' and eff_status='E' and contact_mode not in ('PRN','ORN') order by 2";
						if(oth_rset!=null) oth_rset.close();
						if(oth_stmt!=null) oth_stmt.close();
						oth_stmt = con.prepareStatement(sql);
						oth_rset = oth_stmt.executeQuery();	
						if(oth_rset!=null) {
							 enabledisable = ""; 
							while (oth_rset.next()) {
							   codes .add(oth_rset.getString(1));
							   descs .add(oth_rset.getString(2));
							}
						}
						contactmode = codes.toArray();   
						contactdesc = descs.toArray();

						codes = null; 
						descs = null;
						if( oth_rset != null )  oth_rset.close();%>
				<tr>
						<td class='label'><fmt:message key="eMP.othermodes.label" bundle="${mp_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<select name='nk_contact3_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<% for(int i=0;i<contactmode.length;i++) { %>
							<option value="<%=contactmode[i]%>"><%=contactdesc[i]%></option>
							<%}%>
							</select><input type='text' name='nk_contact3_no' maxlength='20' size='13' onChange='makeValidString(this);' value=''>
						</td>
						<td class='fields'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name='nk_contact4_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<%
							for(int i=0;i<contactmode.length;i++)
							out.println("<option value='"+contactmode[i]+"'>"+contactdesc[i]+ "</option>");
							%>
							</select><input type='text' name='nk_contact4_no' maxlength='20' size='13' onchange='makeValidString(this);' value="">
							
						</td>
						<td class='fields'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name='nk_contact5_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<%
							for(int i=0;i<contactmode.length;i++)
							out.println("<option value='"+contactmode[i]+"'>"+contactdesc[i]+ "</option>");
							%>
							</select><input type='text' name='nk_contact5_no' maxlength='20' size='13' onblur='makeValidString(this);'value="">

							<script>
						if(document.forms(0).nk_contact3_mode.value=='') 
								document.forms(0).nk_contact3_no.disabled= true;
						if(document.forms(0).nk_contact4_mode.value=='') 
						       document.forms(0).nk_contact4_no.disabled= true; 
						if(document.forms(0).nk_contact5_mode.value=='') 
						       document.forms(0).nk_contact5_no.disabled= true; 

						if(document.forms(0).nk_contact3_mode)
						   document.forms(0).nk_contact3_mode.value = "<%=nk_contact3_mode%>" ;
						if(document.forms(0).nk_contact3_no)
						   document.forms(0).nk_contact3_no.value = "<%=nk_contact3_no%>" ;

						if(document.forms(0).nk_contact4_mode)
						   document.forms(0).nk_contact4_mode.value = "<%=nk_contact4_mode%>" ;
						if(document.forms(0).nk_contact4_no)
						   document.forms(0).nk_contact4_no.value = "<%=nk_contact4_no%>" ;

						if(document.forms(0).nk_contact5_mode)
						   document.forms(0).nk_contact5_mode.value = "<%=nk_contact5_mode%>" ;
						if(document.forms(0).nk_contact5_no)
						   document.forms(0).nk_contact5_no.value = "<%=nk_contact5_no%>" ;
						</script>
						</td>
				</tr>	
				</table>
				<%}//Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
		  </table>

</div>
<div id = 'FIRST_TO_NOTIFY' style = 'display:none'>  
   <!-- <a name="kin1" ></a>   -->
 <!-- <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
    <tr><td class='white'>
		<ul id="tablist" class="tablist">
					<li class="tablistitem" title="Add Visit">
						<a  class="tabA" id='addVisit_tab' >
							<span class="tabAspan" id="addVisit_tabspan" onClick='javascript:expandCollapse("add_Visit_tab")'><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></span>
						</a>
					</li>
					<li class="tablistitem" title="Arrival">
						<a class="tabA" id="arrival_tab" >
							<span class="tabAspan" id="arrival_tabspan" onClick='javascript:expandCollapse("arrival_tab")'><fmt:message key="Common.arrival.label" bundle="${common_labels}"/></span>
						</a>
					</li>
					<li class="tablistitem" title="Related Contact details">
						<a class="tabClicked" id="rlcnts_tab" >
							<span class="tabSpanclicked" id="rlcnts_tabspan" onClick='javascript:expandCollapse("rel_con_tab")'><fmt:message key="eMP.relatedcontacts.label" bundle="${mp_labels}"/></span>
						</a>
					</li>	
					<%if(bl_install_yn.equals("Y")){%>
					<li class="tablistitem" title="Financial Details">
						<a  class="tabA" id="findtl_tab" >
							<span class="tabAspan" id="findtl_tabspan" onClick='javascript:expandCollapse("fin_tab")'><fmt:message key="Common.financialdetails.label" bundle="${common_labels}"/></span>
						</a>
					</li>	
				<%}%>	
		</ul>
	</td></tr></table> 
	 <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
       <tr >
		   <td class='white'>
				<ul id="tablist" class="tablist" >
					<li class="tablistitem" title="Next of kin">
						<a class="tabA" id="secondkin" >
							<span class="tabAspan" id="secondkinspan" onClick='javascript:expandCollapse("next_of_kin")'><fmt:message key="Common.nextofkin.label" bundle="${common_labels}"/></span>
						</a>
					</li>
					<li class="tablistitem" title="Contact Mode and Address details">
						<a  class="tabClicked" id="secondkin1" >
							<span class="tabSpanclicked" id="secondkin1span" onClick='javascript:expandCollapse("first_to_notify")'><fmt:message key="Common.firsttonotify.label" bundle="${common_labels}"/></span>
						</a>
					</li>

					<li class="tablistitem" title="Employment Details">
						<a class="tabA" id="secondempr" >
							<span class="tabAspan" id="secondemprspan" onClick='javascript:expandCollapse("emp_details")'><fmt:message key="Common.employmentdetails.label" bundle="${common_labels}"/></span>
						</a>
					</li>	
			   </ul>
	       </td>
	   </tr>
     </table>  -->

            <table cellspacing='0' cellpadding='0' width='92%' align='center' border='0'>
			</tr><td colspan=4 class=label height=5>&nbsp;</td></tr>
			<!--Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008-->
        <%if(resiAddMailAdd){%>
			<td valign=top width='45%'>
			<table cellspacing='0' cellpadding='0' width='92%' align='center' border='0'>
			</tr><td colspan=4 class=label height=5>&nbsp;</td></tr>
            <tr>
				<td  class='label' width='25%'><fmt:message key="Common.name.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<input type='text' name='first_contact_name' value="<%=first_to_notify_name%>" onblur='makeValidString(this);' maxlength='80' size ='30'>
			    </td>
				<td colspan=2 class=label height=5>&nbsp;</td>
			</tr>
		    <tr>
				<td class='label' width='25%'><fmt:message key="Common.relationship.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<select name='first_contact_relation' >
                         <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
                            <%	
			relcode = contact2_relation;

						   for(int i=0;i<race_array.size();i+=2) {

							String relationDesc = (String) race_array.get(i+1);
							String relationCode = (String) race_array.get(i);
						
							if(relcode.equals(relationCode))
								sel = "selected";
							else
								sel="";
				
							out.println("<option value='"+relationCode+"' "+sel+">"+relationDesc+"</option>");							
						  }							  
                           %>
                        </select></td>
					   <td colspan=2 class=label height=5>&nbsp;</td>
		   
				</tr>
		       	
				 <%if(accept_national_id_no_yn.equals("Y") ){%>
				 <tr>
					  <td class='LABEL' width='25%'><%=nat_id_prompt%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					  <input type='text'  name="contact2_nat_id_no"   value = "<%=contact2_nat_id%>" onkeypress='return <%=nat_id_onKeyPress%>'  maxlength='<%=nat_id_length%>' onblur="<%=nat_on_blurfn_st%>"  size='20'  ></td>
					  <td class='label'  colspan='2'>&nbsp;</td> 
	            </tr>	
                <% } %>
			
				<%
					if(Accept_oth_alt_id_yn.equals("Y"))
					{%>
					<tr>
						<td class='label' width='25%'><fmt:message key="Common.otheraltid.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						    <select name='notify_oth_alt_id_type' >
                            <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
                            <%
					oth_stmt = con.prepareStatement(sqlAlt.toString());
					oth_rset = oth_stmt.executeQuery();	
					if(oth_rset != null){
						while (oth_rset.next()){          
							out.println ( "<Option value=\""+oth_rset.getString("alt_id_type")+"\" >"+oth_rset.getString("SHORT_DESC")+"</Option>" ) ;
						}
					}
                    if(oth_rset!=null) oth_rset.close();
                    if(oth_stmt!=null) oth_stmt.close();
					if((sqlAlt != null) && (sqlAlt.length() > 0))
					{
						sqlAlt.delete(0,sqlAlt.length());
					}
					%>
                        </select>&nbsp;<input type='text' name='notify_oth_alt_id_text' value=''  maxlength='20' size='20'  onblur='makeValidString(this);' ></td>
						<td colspan=2 class=label height=5>&nbsp;</td>
                    </tr>
							<%}%>
					<tr>
						<td class='label' width='25%'><fmt:message key="eMP.occupation.label" bundle="${mp_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                           <input type='text' name='first_job_title' maxlength='30' size='30'  onblur='makeValidString(this);document.forms(0).first_addr_line1.focus();' value="<%=job2_title%>">
                        </td> 
   					   <td colspan=2 class=label height=5>&nbsp;</td>
					 </tr>
					 </table></td>
		<%}else {%>
            <tr>
				<td  class='label' width='25%'><fmt:message key="Common.name.label" bundle="${common_labels}"/></td>
				<td class='fields' width='25%'><input type='text' name='first_contact_name' value="<%=first_to_notify_name%>" onblur='makeValidString(this);' maxlength='80' size ='30'>
			    </td>
				<td colspan=2 class=label height=5>&nbsp;</td>
			</tr>
		    <tr>
				<td class='label' width='25%'><fmt:message key="Common.relationship.label" bundle="${common_labels}"/></td>
				<td class='fields' width='25%'><select name='first_contact_relation' >
                         <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
                            <%						   
						   /*
					       pstmtR = con.prepareStatement(sqlRelation.toString());
                           rsetR=pstmtR.executeQuery();
					       if(rset_race!=null)
					       {
					       while(rset_race.next())
					        {
							String relationDesc = rset_race.getString(2);
							String relationCode = rset_race.getString(1);
						
							if(relcode.equals(relationCode))
								sel = "selected";
							else
								sel="";
				
							out.println("<option value='"+relationCode+"' "+sel+">"+relationDesc+"</option>");
						    }
					       }

                           if(rsetR!=null) rsetR.close();
                           if(pstmtR!=null) pstmtR.close();
						   */

						   relcode = contact2_relation;

						   for(int i=0;i<race_array.size();i+=2) {

							String relationDesc = (String) race_array.get(i+1);
							String relationCode = (String) race_array.get(i);
						
							if(relcode.equals(relationCode))
								sel = "selected";
							else
								sel="";
				
							out.println("<option value='"+relationCode+"' "+sel+">"+relationDesc+"</option>");							
						  }							  
                           %>
                        </select></td>
					   <td colspan=2 class=label height=5>&nbsp;</td>
		   
				</tr>
		       	
				 <%if(accept_national_id_no_yn.equals("Y") ){%>
				 <tr>
					  <td class='LABEL' width='25%'><%=nat_id_prompt%>&nbsp;</td>
					  <td class='fields' width='25%'><input type='text'  name="contact2_nat_id_no"   value = "<%=contact2_nat_id%>" onkeypress='return <%=nat_id_onKeyPress%>'  maxlength='<%=nat_id_length%>' onblur="<%=nat_on_blurfn_st%>"  size='20'  ></td>
					  <td class='label'  colspan='2'>&nbsp;</td> 
	            </tr>	
                <% } %>
			
				<%
					if(Accept_oth_alt_id_yn.equals("Y"))
					{%>
					<tr>
						<td class='label' width='25%'><fmt:message key="Common.otheraltid.label" bundle="${common_labels}"/></td>
						<td class='fields' width='25%'>
						    <select name='notify_oth_alt_id_type' >
                            <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
                            <%
					oth_stmt = con.prepareStatement(sqlAlt.toString());
					oth_rset = oth_stmt.executeQuery();	
					if(oth_rset != null){
						while (oth_rset.next()){          
							out.println ( "<Option value=\""+oth_rset.getString("alt_id_type")+"\" >"+oth_rset.getString("SHORT_DESC")+"</Option>" ) ;
						}
					}
                    if(oth_rset!=null) oth_rset.close();
                    if(oth_stmt!=null) oth_stmt.close();
					if((sqlAlt != null) && (sqlAlt.length() > 0))
					{
						sqlAlt.delete(0,sqlAlt.length());
					}
					%>
                        </select>&nbsp;<input type='text' name='notify_oth_alt_id_text' value=''  maxlength='20' size='20'  onblur='makeValidString(this);' ></td>
						<td colspan=2 class=label height=5>&nbsp;</td>
                    </tr>
							<%}%>
					<tr>
						<td class='label' width='25%'><fmt:message key="eMP.occupation.label" bundle="${mp_labels}"/></td>
                        <td class='fields' width='25%'>
                           <input type='text' name='first_job_title' maxlength='30' size='30'  onblur='makeValidString(this);document.forms(0).first_addr_line1.focus();' value="<%=job2_title%>">
                        </td> 
   					   <td colspan=2 class=label height=5>&nbsp;</td>
					</tr>
                    <!--Below added by Suji keerthi for ML-MMOH-CRF-1527 US008-->
					<% } 
					if(resiAddMailAdd){%>
				<td width='50%'><table cellspacing='0' cellpadding='3' border='0' width='100%'>
				<tr>
                     <td class='COLUMNHEADER' ></td>
                     <td  class='COLUMNHEADER' ><fmt:message key="eMP.residenceaddress.label" bundle="${mp_labels}"/></td>
                     <td  class='COLUMNHEADER' ><fmt:message key="Common.MailingAddress.label" bundle="${common_labels}"/></td>
                </tr>
                </td>
                <%} %>
			    <!--Ended by Suji keerthi for ML-MMOH-CRF-1527 US008-->
                <%  
					out.println("<tr>") ;
						//int counter1=0;
						StringBuffer sb4 = new StringBuffer() ;
						StringBuffer sb41 = new StringBuffer() ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
						StringBuffer sb14 = new StringBuffer() ;
						StringBuffer sb141 = new StringBuffer() ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
						StringBuffer sba4 = new StringBuffer() ;
						StringBuffer sba41 = new StringBuffer() ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
						StringBuffer sbar4 = new StringBuffer() ;
						StringBuffer sbar41 = new StringBuffer() ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
						StringBuffer fieldVal4 = new StringBuffer("");
						StringBuffer fieldVal41 = new StringBuffer(""); //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
                    for(int i=0;i<contact_col_names.length; i++)
                            {
                                                                   
									out.println("<td class='label' nowrap width='25%' >"+contact_prompts[i]+"</td>") ; //Modified by Suji keerthi for ML-MMOH-CRF-1527 US008

                                    String val = contact_fields[i] ;
                                    String val2 = contact_fields[i] ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
									sb4.append(val);
									sb41.append(val2); //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
                                    int j1=0;
                                     int j=0 ;
                                     String old_val = "" ;
                                     String new_val = "" ;
                                     String new_val2 = "" ; //Added by Suji keerthi for ML-MMOH-CRF-1527 US008
                                     if(contact_col_names[i].equalsIgnoreCase("addr_line1_prompt"))
                                     {
                                        old_val = "r_addr_line1" ;
                                        new_val = "first_addr_line1" ;
										new_val2 = "fton_mail_addr_line1" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line2_prompt"))
                                     {
                                        old_val = "r_addr_line2" ;
                                        new_val = "first_addr_line2" ;
										new_val2 = "fton_mail_addr_line2" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line3_prompt"))
                                     {
                                        old_val = "r_addr_line3" ;
                                        new_val = "first_addr_line3" ;
										new_val2 = "fton_mail_addr_line3" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line4_prompt"))
                                     {
                                        old_val = "r_addr_line4" ;
                                        new_val = "first_addr_line4" ;
										new_val2 = "fton_mail_addr_line4" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("res_town_prompt"))
                                     {
                                        old_val = "r_town_code" ;
                                        new_val = "contact2_res_town_code" ;
										new_val2 = "fst_to_no_ma_town_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
									 else if(contact_col_names[i].equalsIgnoreCase("region_prompt"))
                                     {
                                        old_val = "r_region_code" ;
                                        new_val = "contact2_region_code" ;
										new_val2 = "fst_to_no_ma_reg_cod" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }
									 else if(contact_col_names[i].equalsIgnoreCase("res_area_prompt"))
                                     {
                                        old_val = "r_area_code" ;
                                        new_val = "contact2_res_area_code" ;
										new_val2 = "fst_to_no_ma_area_code" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }                                     
                                     else if(contact_col_names[i].equalsIgnoreCase("postal_code_prompt"))
                                     {
                                        old_val = "r_postal_code" ;
                                        new_val = "first_postal_code" ;
										new_val2 = "fst_no_ma_pos_cod" ; //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                     }

                                    while(val.indexOf(old_val) != -1)
                                    {
                                        j = val.indexOf(old_val,j) ;
                                        sb4 = sb4.replace(j,(j+old_val.length()),new_val);
                                        val = sb4.toString();

										sb41 = sb41.replace(j,(j+old_val.length()),new_val2); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                        val2 = sb41.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                                    }
                                    // Newly added
					if(contact_col_names[i].equalsIgnoreCase("res_town_prompt")) {
						sba4.append(val);
						sba41.append(val2); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sba4 = sba4.replace(j1,(j1+"r_postal_code".length()),"first_postal_code");
							val = sba4.toString();

							sba41 = sba41.replace(j1,(j1+"r_postal_code".length()),"fst_no_ma_pos_cod"); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
							val2 = sba41.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						}
					}
					if(contact_col_names[i].equalsIgnoreCase("res_area_prompt")) {
						j1 = 0;
						sbar4.append(val);
						sbar41.append(val2); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sbar4 = sbar4.replace(j1,(j1+"r_postal_code".length()),"first_postal_code");
							val = sbar4.toString();

							sbar41 = sbar41.replace(j1,(j1+"r_postal_code".length()),"fst_no_ma_pos_cod"); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
							val2 = sbar41.toString(); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
						}
					}
									sb14.append(val);
									for(int z=0;z<val.length();z++)
									{
										String tempVal=sb14.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal4.append(++tindex);
										}
										else
										{
											fieldVal4.append(tempVal);
										}
									}
                                  	val = fieldVal4.toString();
                                    //Below Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sb141.append(val2);
									for(int z=0;z<val2.length();z++)
									{
										String tempVal=sb141.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal41.append(++tindex);
										}
										else
										{
											fieldVal41.append(tempVal);
										}
									}
                                  	val2 = fieldVal41.toString();
                                    if(resiAddMailAdd){
                                    out.println("<td class='fields' >"+val+"&nbsp;") ;
                                    out.println("<td class='fields' >"+val2+"&nbsp;") ;
								    out.println("</td>");
								    out.println("</td>");
                                    }else{
									out.println("<td class='fields' width='25%'>"+val) ;
								    out.println("</td>");
									}
									//Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008
									out.println("<td colspan=2 class=label>&nbsp;</td>");
						            out.println("</tr>") ;
									sb14.delete(0,sb14.length());
									sb141.delete(0,sb141.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
								    fieldVal4.delete(0,fieldVal4.length());
								    fieldVal41.delete(0,fieldVal41.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sb4.delete(0,sb4.length());
									sb41.delete(0,sb41.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sba4.delete(0,sba4.length());
									sba41.delete(0,sba41.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
									sbar4.delete(0,sbar4.length());
									sbar41.delete(0,sbar41.length()); //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008
                            }
                %> 
					<script>
				        // Added on 7/05/2004 for assigning values to dynamically generated address related fields..
						if(document.forms(0).first_addr_line1)
						   document.forms(0).first_addr_line1.value = "<%=contact2_add_l1%>" ;
						if(document.forms(0).first_addr_line2)
						   document.forms(0).first_addr_line2.value = "<%=contact2_add_l2%>" ;
						if(document.forms(0).first_addr_line3)
						   document.forms(0).first_addr_line3.value = "<%=contact2_add_l3%>" ;
						if(document.forms(0).first_addr_line4)
						   document.forms(0).first_addr_line4.value = "<%=contact2_add_l4%>" ;
						if(document.forms(0).contact2_res_town_code)
						{
						 document.forms(0).contact2_res_town_code.value = "<%=contact2_res_town_desc%>";
						 document.forms(0).f_town.value = '<%=contact2_town_code%>';

						}
						if(document.forms(0).contact2_region_code)
						{
					     document.forms(0).contact2_region_code.value = "<%=contact2_region_desc%>";
						 document.forms(0).f_region.value = '<%=contact2_reg_code%>'; 

                        }
						if(document.forms(0).contact2_res_area_code)
						{
                		document.forms(0).contact2_res_area_code.value = "<%=contact2_res_area__desc%>";
						document.forms(0).f_area.value = '<%=contact2_area_code%>';

						}
						if(document.forms(0).first_postal_code1){
						   document.forms(0).first_postal_code.value = "<%=postal2_code%>"; 
						   document.forms(0).first_postal_code1.value = "<%=postal2_desc%>"; 
						}

						if(document.forms(0).fton_mail_addr_line1)
						   document.forms(0).fton_mail_addr_line1.value = "<%=fton_mail_addr_line1%>" ;
						if(document.forms(0).fton_mail_addr_line2)
						   document.forms(0).fton_mail_addr_line2.value = "<%=fton_mail_addr_line2%>" ;
						if(document.forms(0).fton_mail_addr_line3)
						   document.forms(0).fton_mail_addr_line3.value = "<%=fton_mail_addr_line3%>" ;
						if(document.forms(0).fton_mail_addr_line4)
						   document.forms(0).fton_mail_addr_line4.value = "<%=fton_mail_addr_line4%>" ;
						if(document.forms(0).fst_to_no_ma_town_code)
						{
						 document.forms(0).fst_to_no_ma_town_code.value = "<%=fst_to_no_ma_town_desc%>";
						 document.forms(0).contact2_res_town.value = "<%=ftoncontact2_res_town%>";
						}
						if(document.forms(0).fst_to_no_ma_reg_cod)
						{
					     document.forms(0).fst_to_no_ma_reg_cod.value = "<%=fst_to_no_ma_reg_desc%>";
						 document.forms(0).contact2_region.value = "<%=ftoncontact2_region%>"; 
                        }
						if(document.forms(0).fst_to_no_ma_area_code)
						{
                		document.forms(0).fst_to_no_ma_area_code.value = "<%=fst_to_no_ma_area_desc%>";
						document.forms(0).contact2_res_area.value = "<%=ftoncontact2_res_area%>"; 
						}
						if(document.forms(0).fst_no_ma_pos_cod1){
						   document.forms(0).fst_no_ma_pos_cod.value = "<%=ftonpostal1_code%>";
						 document.forms(0).fst_no_ma_pos_cod1.value = "<%=ftonpostal1_desc%>";
						 
						}
					
						// End of addition on 7/05/2004 for assigning values to dynamically generated address related fields..
						 </script>
                  <tr>
					   <td class='label' width='25%'><fmt:message key="Common.country.label" bundle="${common_labels}"/></td>
					   <td class='fields' width='25%'><input align='left' type='text' name='first_country_desc'  size='15' maxlength='15' onblur='if(this.value !="")searchCountry(contry_code[0],first_country_desc);'  value ="<%=country2_code_desc%>" tabindex='68'><input type='button' name='contry_code' value='?' class='button' onclick='searchCountry(this,first_country_desc)' tabindex='69'>
					   <input type='hidden' name='first_country_code' value=''>
					   <script>
							if(document.forms(0).first_country_code)
							   document.forms(0).first_country_code.value = "<%=contact2_country_code%>";
							if(document.forms(0).first_country_desc)
							   document.forms(0).first_country_desc.value = "<%=country2_code_desc%>";
					  </script>
                      </td>
                      <!--Below added by Suji Keerthi for ML-MMOH-CRF-1527 US008-->
				<% if(resiAddMailAdd){%>	

					<td class='fields'><input  type='text' name='first_mail_country_desc' size='15' maxlength='15' value='<%=fton_mail_country_desc%>' onblur='if(this.value !="") searchCountry(ma_country_code,first_mail_country_desc); ' ><input type='button' name='ma_country_code' value='?' class='button' onclick='searchCountry(this,first_mail_country_desc)' >
					<input type='hidden' name='first_mail_country_code' value="<%=fton_m_country_desc%>">
					 <script>
							if(document.forms(0).first_mail_country_code)
							   document.forms(0).first_mail_country_code.value = "<%=fton_mail_country_code%>";
							if(document.forms(0).first_mail_country_desc)
							   document.forms(0).first_mail_country_desc.value = "<%=fton_mail_country_desc%>";
					  </script>
					</td>
				</tr>
				<tr>
					<td class='label' nowrap ><fmt:message key="eMP.ContactPerson.label" bundle="${mp_labels}"/></td> 
                    <td class='fields'>
                    <input type='text' name='fton_ra_contact_name' size='30' maxlength='30'  onblur='makeValidString(this);' value= "<%=fton_res_contact_name%>" >
                    </td>
                    <td class='fields'>
                    <input type='text' name='fton_ma_contact_name' size='30' maxlength='30'  onblur='makeValidString(this);' value= "<%=fton_mail_contact_name%>" >
                    </td>
				</tr>

				<table border = 0 cellspacing='0' cellpadding='1' width='100%'>
			    <tr><td class='label' width='25%'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				    <a href='javascript:copyDetails(4)'><fmt:message key="eMP.CopyNextofKin.label" bundle="${mp_labels}"/></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			        <a href='javascript:copyDetails(3)'><fmt:message key="eMP.CopyResidenceAddress.label" bundle="${mp_labels}"/></a>
			    </td></tr></table></table>

				<table width="100%"><tr>
				<td  class='COLUMNHEADER' colspan='7' ><fmt:message key="eMP.ContactModes.label" bundle="${mp_labels}"/></td>
                </tr>
				<tr>
				    
					<td class='label' width='25%' ><fmt:message key="Common.homephoneno.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type='text' name='first_res_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value ="<%=contact2_res_tel_no%>" tabindex='70'>
				    </td>

					<td class='label' width='25%' ><fmt:message key="Common.MobileNo.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type='text' name='contact2_mob_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value = "<%=contact2_mob_tel_no%>" tabindex='71'>
				    </td>

					<td class='label' width='25%' ><fmt:message key="Common.email.label" bundle="${common_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type='text' name='contact2_email_id' maxlength='50' size='45'  onblur='makeValidString(this);document.forms(0).first_contact_name.focus();' value = "<%=contact2_mail_id%>" tabindex='73'>
					</td></tr>
					<%String enabledisable="";%>
					<tr>
						<td class='label'><fmt:message key="eMP.othermodes.label" bundle="${mp_labels}"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							<select name='fton_contact3_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<% for(int i=0;i<contactmode.length;i++) { %>
							<option value="<%=contactmode[i]%>"><%=contactdesc[i]%></option>
							<%}%>
							</select><input type='text' name='fton_contact3_no' maxlength='20' size='13'   onChange='makeValidString(this);' value=''>
						</td>
						<td class='fields'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name='fton_contact4_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<%
							for(int i=0;i<contactmode.length;i++)
							out.println("<option value='"+contactmode[i]+"'>"+contactdesc[i]+ "</option>");
							%>
							</select><input type='text' name='fton_contact4_no' maxlength='20' size='13'   onchange='makeValidString(this);' value="">
						</td>
						<td class='fields'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select name='fton_contact5_mode' <%=enabledisable%>  onchange='enableContactNo(this)'>
							<option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>----</option>
							<%
							for(int i=0;i<contactmode.length;i++)
							out.println("<option value='"+contactmode[i]+"'>"+contactdesc[i]+ "</option>");
							%>
							</select><input type='text' name='fton_contact5_no' maxlength='20' size='13'   onblur='makeValidString(this);'value="">

							<script>
						if(document.forms(0).fton_contact3_mode.value=='') 
								document.forms(0).fton_contact3_no.disabled= true;
						if(document.forms(0).fton_contact4_mode.value=='') 
						       document.forms(0).fton_contact4_no.disabled= true; 
						if(document.forms(0).fton_contact5_mode.value=='') 
						       document.forms(0).fton_contact5_no.disabled= true; 
						if(document.forms(0).fton_contact3_mode)
						   document.forms(0).fton_contact3_mode.value = "<%=fton_contact3_mode%>" ;
						if(document.forms(0).fton_contact3_no)
						   document.forms(0).fton_contact3_no.value = "<%=fton_contact3_no%>" ;

						if(document.forms(0).fton_contact4_mode)
						   document.forms(0).fton_contact4_mode.value = "<%=fton_contact4_mode%>" ;
						if(document.forms(0).fton_contact4_no)
						   document.forms(0).fton_contact4_no.value = "<%=fton_contact4_no%>" ;

						if(document.forms(0).fton_contact5_mode)
						   document.forms(0).fton_contact5_mode.value = "<%=fton_contact5_mode%>" ;
						if(document.forms(0).fton_contact5_no)
						   document.forms(0).fton_contact5_no.value = "<%=fton_contact5_no%>" ;
						</script>
						</td>
				    </tr>	
					
					</table>
				<% } //Ended by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
				<td colspan=2 class=label>&nbsp;</td>
                <%if(!resiAddMailAdd){  //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
                <tr>
						<td class='label' width='25%' ><fmt:message key="Common.homephoneno.label" bundle="${common_labels}"/></td>
						<td class='fields' width='25%'>
                        <input type='text' name='first_res_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value ="<%=contact2_res_tel_no%>" tabindex='70'>
						<td colspan=2 class=label>&nbsp;</td>
					</tr>
					<tr>
						<td class='label' width='25%' ><fmt:message key="Common.MobileNo.label" bundle="${common_labels}"/></td>
                        <td class='fields' width='25%'>
                        <input type='text' name='contact2_mob_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value = "<%=contact2_mob_tel_no%>" tabindex='71'>
						<td colspan=2 class=label>&nbsp;</td>
				    </tr>
					<tr>
						<td class='label' width='25%'  ><fmt:message key="Common.officephoneno.label" bundle="${common_labels}"/></td>
						<td class='fields' width='25%'>
							<input type='text' name='first_off_tel_no' maxlength='20' size='20'  onblur='makeValidString(this);' value = "<%=contact2_off_tel_no%>" tabindex='72'>
					    <td colspan=2 class=label>&nbsp;</td>
					</tr>
					<tr>
						<td class='label' width='25%' ><fmt:message key="Common.email.label" bundle="${common_labels}"/></td>
						<td class='fields' width='25%'>
							<input type='text' name='contact2_email_id' maxlength='50' size='45'  onblur='makeValidString(this);document.forms(0).first_contact_name.focus();' value = "<%=contact2_mail_id%>" tabindex='73'>
						<td colspan=2 class=label>&nbsp;</td>
				  </tr>
				  <%} //Added by Suji Keerthi for ML-MMOH-CRF-1527 US008%>
    			  <tr><td colspan=4 class=label height=5></td></tr>
    </table>
    
</div>
<div id = 'EMP_DETAILS' style = 'display:none'>  
<!--  <a name="empyr" ></a>  --> 
<!--  <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
    <tr><td class='white'>
		  <ul id="tablist" class="tablist">
				<li class="tablistitem" title="Add Visit">
					<a class="tabA" id='addVisit_tab' >
						<span class="tabAspan" id="addVisit_tabspan" onClick='javascript:expandCollapse("add_Visit_tab")'><fmt:message key="Common.VisitDetail.label" bundle="${common_labels}"/></span>
					</a>
				</li>
				<li class="tablistitem" title="Arrival">
					<a  class="tabA" id="arrival_tab" >
						<span class="tabAspan" id="arrival_tabspan" onClick='javascript:expandCollapse("arrival_tab")'><fmt:message key="Common.arrival.label" bundle="${common_labels}"/></span>
					</a>
				</li>
				<li class="tablistitem" title="Related Contact details">
					<a class="tabClicked" id="rlcnts_tab" >
						<span class="tabSpanclicked" id="rlcnts_tabspan" onClick='javascript:expandCollapse("rel_con_tab")'><fmt:message key="eMP.relatedcontacts.label" bundle="${mp_labels}"/></span>
					</a>
				</li>	
				<%if(bl_install_yn.equals("Y")){%>
				<li class="tablistitem" title="Financial Details">
					<a class="tabA" id="findtl_tab" >
						<span class="tabAspan" id="findtl_tabspan" onClick='javascript:expandCollapse("fin_tab")'><fmt:message key="Common.financialdetails.label" bundle="${common_labels}"/></span>
					</a>
				</li>	
			<%}%>	
		 </ul>
	</td></tr></table>
	 <table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
        <tr><td class='white'>

	<ul id="tablist" class="tablist" >
			<li class="tablistitem" title="Next of kin">
				<a class="tabA" id="thirdkin" >
					<span class="tabAspan" id="thirdkinspan" onClick='javascript:expandCollapse("next_of_kin")'><fmt:message key="Common.nextofkin.label" bundle="${common_labels}"/></span>
				</a>
			</li>
			<li class="tablistitem" title="Contact Mode and Address details">
				<a  class="tabA" id="thirdkin1" >
					<span class="tabAspan" id="thirdkin1span" onClick='javascript:expandCollapse("first_to_notify")'> <fmt:message key="Common.firsttonotify.label" bundle="${common_labels}"/></span>
				</a>
			</li>

			
			<li class="tablistitem" title="Employment Details">
				<a class="tabClicked" id="thirdempr" >
					<span class="tabSpanclicked" id="thirdemprspan" onClick='javascript:expandCollapse("emp_details")'><fmt:message key="Common.employmentdetails.label" bundle="${common_labels}"/></span>
				</a>
			</li>	
		</ul>
				</td></tr></table> -->
 

			<table cellspacing='0' cellpadding='0' width='92%' border=0 align='center'>
				<tr>
                   <td align='center' class='COLUMNHEADER' ><fmt:message key="Common.employerdetails.label" bundle="${common_labels}"/></td>
				   <td align='center' class='COLUMNHEADER' ><fmt:message key="Common.employeedetails.label" bundle="${common_labels}"/></td>
                </tr>
				<tr>
				<td><table cellspacing='0' cellpadding='0' width='92%' border='0' align='center'>
				<tr><td colspan=2 class=label height=5></td></tr>
				<!--Below line added for this ML-MMOH-CRF-0860.2-->  
				<tr>
					 <td class='label' width='50%'  ><fmt:message key="Common.orgName.label" bundle="${common_labels}"/></td>
                     <td class='fields' width='50%'>
                      <input type='text' name='organization_name' maxlength='<%=maximumLength%>' size='<%=maxsize%>'  onblur="makeValidString(this);" value="<%=contact3_org_name%>"></input>
                    </td>		
			   </tr>
			   <!--End ML-MMOH-CRF-0860.2-->
			   <tr>
					<td class='label' width='50%' nowrap><fmt:message key="eMP.ContactPersonName.label" bundle="${mp_labels}"/></td>
                    <td class='fields' width='50%'>
                        <input type='text' name='empyr_contact_name' maxlength='30' size='30' onblur='makeValidString(this);document.forms(0).employ_addr_line1.focus();'  value = "<%=employer_name%>" ></input>
                    </td>
							
			</tr>
				<%
					out.println("<tr>") ; 
					StringBuffer sb5 = new StringBuffer() ;
					StringBuffer  sb15 = new StringBuffer() ;
					StringBuffer  sba5 = new StringBuffer() ;
					StringBuffer  sbar5 = new StringBuffer() ;
					StringBuffer fieldVal5 = new StringBuffer("");
                    for(int i=0;i<contact_col_names.length; i++)
                            {                             
								out.println("<td class='label'  >"+contact_prompts[i]+"</td>") ;	

                                   String val = contact_fields[i] ;
								   sb5.append(val);
                                    int j1=0;
                                     int j=0 ;
                                     String old_val = "" ;
                                     String new_val = "" ;
                                     
                                     if(contact_col_names[i].equalsIgnoreCase("addr_line1_prompt"))
                                     {
                                        old_val = "r_addr_line1" ;
                                        new_val = "employ_addr_line1" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line2_prompt"))
                                     {
                                        old_val = "r_addr_line2" ;
                                        new_val = "employ_addr_line2" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line3_prompt"))
                                     {
                                        old_val = "r_addr_line3" ;
                                        new_val = "employ_addr_line3" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("addr_line4_prompt"))
                                     {
                                        old_val = "r_addr_line4" ;
                                        new_val = "employ_addr_line4" ;
                                     }
                                     else if(contact_col_names[i].equalsIgnoreCase("res_town_prompt"))
                                     {
                                        old_val = "r_town_code" ;
                                        new_val = "contact3_res_town_code" ;
                                     } 
									 else if(contact_col_names[i].equalsIgnoreCase("region_prompt"))
                                     {
                                        old_val = "r_region_code" ;
                                        new_val = "contact3_region_code" ;
                                     }
									 else if(contact_col_names[i].equalsIgnoreCase("res_area_prompt"))
                                     {
                                        old_val = "r_area_code" ;
                                        new_val = "contact3_res_area_code" ;
                                     }                                     
                                     else if(contact_col_names[i].equalsIgnoreCase("postal_code_prompt"))
                                     {
                                        old_val = "r_postal_code" ;
                                        new_val = "employ_postal_code" ;
                                     }
                                    while(val.indexOf(old_val) != -1)
                                    {
                                        j = val.indexOf(old_val,j) ;
                                        sb5 = sb5.replace(j,(j+old_val.length()),new_val);
                                        val = sb5.toString();
                                    }
                    // Newly added
					if(contact_col_names[i].equalsIgnoreCase("res_town_prompt")) {
						sba5.append(val);
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sba5 = sba5.replace(j1,(j1+"r_postal_code".length()),"employ_postal_code");
							val = sba5.toString();
						}
					}
					if(contact_col_names[i].equalsIgnoreCase("res_area_prompt")) {
						j1 = 0;
						sbar5.append(val);
						while(val.indexOf("r_postal_code") != -1) {
							j1 = val.indexOf("r_postal_code",j1) ;
							sbar5 = sbar5.replace(j1,(j1+"r_postal_code".length()),"employ_postal_code");
							val = sbar5.toString();
						}
					}
								  sb15.append(val);
								for(int z=0;z<val.length();z++)
									{
										String tempVal=sb15.substring(z,z+1);
										if(tempVal.equals("@"))
										{
											fieldVal5.append(++tindex);
										}
										else
										{
											fieldVal5.append(tempVal);
										}
									}
                                    val = fieldVal5.toString();
						   out.println("<td class='fields' >"+val+"</td>") ;
						   out.println("</tr>") ;
						   sb15.delete(0,sb15.length());
						   fieldVal5.delete(0,fieldVal5.length());
						   sb5.delete(0,sb5.length());
						   sba5.delete(0,sba5.length());
						   sbar5.delete(0,sbar5.length());
                            }
							 
				%> 
				<script>
				        // Added on 7/05/2004 for assigning values to dynamically generated address related fields..
						if(document.forms(0).employ_addr_line1)
						   document.forms(0).employ_addr_line1.value = "<%=addr3_line1%>" ;
						if(document.forms(0).employ_addr_line2)
						   document.forms(0).employ_addr_line2.value = "<%=addr3_line2%>" ;
						if(document.forms(0).employ_addr_line3)
						   document.forms(0).employ_addr_line3.value = "<%=addr3_line3%>" ;
						if(document.forms(0).employ_addr_line4)
						   document.forms(0).employ_addr_line4.value = "<%=addr3_line4%>" ;
						if(document.forms(0).contact3_res_town_code)
						{
						 document.forms(0).contact3_res_town_code.value = "<%=contact3_res_town_desc%>";
						 document.forms(0).e_town.value = "<%=contact3_town_code%>";
						}
						if(document.forms(0).contact3_region_code)
						{
					     document.forms(0).contact3_region_code.value = "<%=contact3_region_desc%>";
						 document.forms(0).e_region.value = "<%=contact3_reg_code%>"; 	
                        }
						if(document.forms(0).contact3_res_area_code)
						{
                		document.forms(0).contact3_res_area_code.value = "<%=contact3_res_area__desc%>";
						document.forms(0).e_area.value = "<%=contact3_area_code%>"; 
						}
						if(document.forms(0).employ_postal_code1){
						   document.forms(0).employ_postal_code.value = "<%=postal3_code%>";
						   document.forms(0).employ_postal_code1.value = "<%=postal3_desc%>";
						}
					
       						// End of addition on 7/05/2004 for assigning values to dynamically generated address related fields..
						 </script>	
                <tr>
                    <td class='label' width='50%'><fmt:message key="Common.country.label" bundle="${common_labels}"/></td>

                    <td class='fields' width='50%'><input  type='text' name='empyr_country_desc'                       size='15' maxlength='15' onblur='if(this.value !="")searchCountry(contry_code[0],empyr_country_desc);' value = "<%=country3_code_desc%>" onblur='if(this.value !="")searchCountry(contry_code[0],empyr_country_desc);' tabindex='80'><input type='button' name='contry_code' value='?' class='button'  onclick='searchCountry(this,empyr_country_desc)' tabindex='81'>
							<input type='hidden' name='empyr_country_code' value=''>
							<script>
							   if(document.forms(0).empyr_country_code)
							     document.forms(0).empyr_country_code.value = "<%=country3_code%>";
							   if(document.forms(0).empyr_country_desc)
							     document.forms(0).empyr_country_desc.value = "<%=country3_code_desc%>";
				           </script>
                   </td>
               </tr>
               <tr>
                   <td class='label' width='50%' ><fmt:message key="Common.homephoneno.label" bundle="${common_labels}"/></td>
                   <td class='fields' width='50%'>
                       <input type='text' name='res3_tel_no' size='20' maxlength='20'  onblur='makeValidString(this);' value ="<%=res3_tel_no%>" tabindex='82'>
                   </td>
				   
                   </tr>
				   <tr>
               
                   <td class='label' width='50%' ><fmt:message key="Common.officephoneno.label" bundle="${common_labels}"/></td>
                   <td class='fields' width='50%'>
                        <input type='text' name='empyr_off_tel_no' size='20' maxlength='20'  onblur='makeValidString(this);' value ="<%=off3_tel_no%>" tabindex='83'>
                   </td>
               </tr><tr><td colspan=8 class=label height=5></td></tr>
			   </table> </td>
			   <td valign=top><table cellspacing='1' cellpadding='0' width='100%' border=0>
			   <tr><td colspan=8 class=label height=5></td></tr>
			   <tr><td class='label' width='25%'><fmt:message key="Common.employmentid.label" bundle="${common_labels}"/></td>
                    <td class='fields' width='25%'>
                        <input type='text' name='empyr_eid' maxlength='20' size='20' onfocus="" onblur='makeValidString(this);' value = "<%=patient_employee_id%>" tabindex='84'></input>
                    </td>
					</tr>
					<tr>
					        <td class='label' width='25%' ><fmt:message key="eMP.OccupationClass.label" bundle="${mp_labels}"/></td>
							<td class='fields' width='25%'> <select name='occ_class'  onchange='setOccOfPerson();' tabindex='85'>
                            <option value=''>----<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
						<%
						String occpnC = ocpn_class_code;
						StringBuffer sqlOccp = new StringBuffer();
						sqlOccp.append("select OCPN_CLASS_CODE,LONG_DESC from mp_occupation_class_lang_vw where language_id='"+locale+"' and EFF_STATUS='E'   order by 2  ");
                        oth_stmt = con.prepareStatement(sqlOccp.toString());
						oth_rset = oth_stmt.executeQuery();	
						while(oth_rset.next())
						{
						   String occuDesc = oth_rset.getString("LONG_DESC");
						   String occuCode = oth_rset.getString("OCPN_CLASS_CODE");
						   if(occpnC.equals(occuCode))
								sel = "selected";
						   else
								sel="";
				    	   out.println("<option value='"+occuCode+"' "+sel+">"+occuDesc+"</option>");
						}
                        while(oth_rset.next())
						{
						   out.println("<Option value='" + oth_rset.getString("OCPN_CLASS_CODE") + "'>" + oth_rset.getString("LONG_DESC")+"</option>");
						}
                           if(oth_rset!= null) oth_rset.close() ;
						   if(oth_stmt!= null) oth_stmt.close() ;
						   if((sqlOccp != null) && (sqlOccp.length() > 0))
							{
								sqlOccp.delete(0,sqlOccp.length());
							}
						%>
                        </select></td>
						</tr>
				<tr>
			        <td class='label' width='25%' ><fmt:message key="eMP.OccupationofthePerson.label" bundle="${mp_labels}"/></td>
                    <td class='fields' colspan='2'>
                        <select name='occ_of_per' onchange= 'enableocpn();' tabindex='86'>
                            <option value=''>---<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>---</option>
							<%
						String occ_of_per = ocpn_code;
						String occpnc_sv = ocpn_class_code;


						StringBuffer sqlOcc = new StringBuffer();
						
						//sqlOcc.append("select ocpn_code,SHORT_DESC from mp_occupation_lang_vw where language_id='"+locale+"'  and EFF_STATUS='E'    order by 2");

						sqlOcc.append("SELECT ocpn_code, short_desc FROM mp_occupation_lang_vw WHERE language_id = '"+locale+"' AND eff_status = 'E' and ocpn_class_code ='"+occpnc_sv+"' and ocpn_code LIKE '%%' ORDER BY 2");	
	
                        oth_stmt = con.prepareStatement(sqlOcc.toString());
						oth_rset = oth_stmt.executeQuery();	
						while(oth_rset.next())
						{
						   String occuDesc1 = oth_rset.getString("SHORT_DESC");
						   String occuCode1 = oth_rset.getString("ocpn_code");
						   if(occ_of_per.equals(occuCode1))
								sel = "selected";
						   else
								sel="";
				    	   out.println("<option value='"+occuCode1+"' "+sel+">"+occuDesc1+"</option>");
						}
						 while(oth_rset.next())
						{
						   out.println("<Option value='" + oth_rset.getString("ocpn_code") + "'>" + oth_rset.getString("Short_Desc")+"</option>");
						}
					   if(oth_rset!= null) oth_rset.close() ;
					   if(oth_stmt!= null) oth_stmt.close() ;
					   if((sqlOcc != null) && (sqlOcc.length() > 0))
						{
							sqlOcc.delete(0,sqlOcc.length());
						}
						%>
					</select>&nbsp;&nbsp;<input type='text' name='occu_of_per_desc' size='<%=maxsize%>' maxlength='<%=maximumLength%>' onblur=''  onblur='makeValidString(this);' value="<%=ocpn_desc%>" align='left' tabindex='87'></td> 		
					</tr>
					<!--Above line modified for ML-MMOH-CRF-860.2-->
			    <tr>
				<td class='label' width='25%' ><fmt:message key="Common.status.label" bundle="${common_labels}"/></td>
                    <td class='fields' width='25%'>
                        <select name='empyr_employment_status'  onblur="tab_click2('#empyr','firstempyr')" onchange='' tabindex='88'>
						<option value=''>----------<fmt:message key="Common.defaultSelect.label" bundle="${common_labels}"/>-----------&nbsp;&nbsp;&nbsp;</option>
						<% String emp_stat_code =employment_status;
					       String emp_stat_desc = "";
					      if (emp_stat_code.equals("FE"))
		                  	   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.FullTimeEmployed.label","mp_labels");
                          else if  (emp_stat_code.equals("FS"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.FullTimeStudent.label","mp_labels");
						  else if  (emp_stat_code.equals("NA"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"Common.notapplicable.label","common_labels");
						  else if  (emp_stat_code.equals("PE"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.PartTimeEmployed.label","mp_labels");
    					  else if  (emp_stat_code.equals("PS"))
							   emp_stat_desc =  com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.PartTimeStudent.label","mp_labels");
						  else if  (emp_stat_code.equals("SE"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.SelfEmployed.label","mp_labels");
						  else if  (emp_stat_code.equals("UE"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"eMP.Unemployed.label","mp_labels");
						  else if  (emp_stat_code.equals("UK"))
							   emp_stat_desc = com.ehis.util.BundleMessage.getBundleMessage(pageContext,"Common.unknown.label","common_labels");
						  if (employment_status != ""){
                          %>
						  <option value="<%=employment_status%>" selected><%=emp_stat_desc%></option>
                         <%}%>
                            <option value='FE'><fmt:message key="eMP.FullTimeEmployed.label" bundle="${mp_labels}"/></option>
								<option value='FS'><fmt:message key="eMP.FullTimeStudent.label" bundle="${mp_labels}"/></option>
								<option value='NA'><fmt:message key="Common.notapplicable.label" bundle="${common_labels}"/></option>					
								<option value='PE'><fmt:message key="eMP.PartTimeEmployed.label" bundle="${mp_labels}"/></option>
								<option value='PS'><fmt:message key="eMP.PartTimeStudent.label" bundle="${mp_labels}"/></option>
								<option value='SE'><fmt:message key="eMP.SelfEmployed.label" bundle="${mp_labels}"/></option>
								<option value='UE'><fmt:message key="eMP.Unemployed.label" bundle="${mp_labels}"/></option>
								<option value='UK'><fmt:message key="Common.unknown.label" bundle="${common_labels}"/></option>
                        </select>	

			</td>
			</tr>
		</table></table>
		</div>
		</div>
    <!--Start--Hidden Fields for Billing Interface-->
    <%
    if((episode.equals("Y") && record.equals("Y")) || (episode.equals("N") && record.equals("Y")))
    {
    %> 
        <jsp:include page="../../eBL/jsp/BLFinDetHiddenFlds.jsp" flush="true">
        <jsp:param name="patient_id" value="<%=patient_id%>" />
        <jsp:param name="episode" value="<%=episode%>" />
        <jsp:param name="record" value="<%=record%>" />
        <jsp:param name="calling_module" value="AE" />
        <jsp:param name="episode_type" value="E" />
        <jsp:param name="calling_function_id" value="VISIT_REGISTRATION" />
        </jsp:include> 
    <%
    }
    else {
    %>
    <input type='hidden' name='billing_group' value=""></input>
    <input type='hidden' name='billing_class' value=""></input>
    <input type='hidden' name='employer_code' value=""></input>
    <input type='hidden' name='cash_set_type1' value=""></input>
    <input type='hidden' name='cash_insmt_ref1' value=""></input>
    <input type='hidden' name='cash_insmt_date1' value=""></input>
    <input type='hidden' name='cash_insmt_rmks1' value=""></input>
    <input type='hidden' name='cust_1' value=""></input>  
    <input type='hidden' name='credit_doc_ref1' value=""></input>
    <input type='hidden' name='credit_doc_date1' value=""></input>
    <input type='hidden' name='cust_2' value=""></input>  
    <input type='hidden' name='credit_doc_ref2' value=""></input>
    <input type='hidden' name='credit_doc_date2' value=""></input>
    <input type='hidden' name='cust_3' value=""></input>
    <input type='hidden' name='policy_type' value=""></input>
    <input type='hidden' name='policy_no' value=""></input>
    <input type='hidden' name='policy_expiry_date' value=""></input>
    <input type='hidden' name='non_insur_blng_grp' value=""></input>
    <input type='hidden' name='cash_set_type2' value=""></input>
    <input type='hidden' name='cash_insmt_ref2' value=""></input>
    <input type='hidden' name='cash_insmt_date2' value=""></input>
    <input type='hidden' name='cash_insmt_rmks2' value=""></input>
    <input type='hidden' name='cust_4' value=""></input>
    <input type='hidden' name='credit_doc_ref3' value=""></input>
    <input type='hidden' name='credit_doc_date3' value=""></input>
    <input type='hidden' name='setlmt_ind' value=""></input>
    <input type='hidden' name='upd_fin_dtls' value=""></input>
    <input type='hidden' name='billing_mode' value="Add"></input>
    <input type='hidden' name='credit_auth_date' value=''></input>
    <input type='hidden' name='app_days' value=''></input>
    <input type='hidden' name='app_amount' value=''></input>
<!-- Added for Billing Enhancements -->    
	<input type='hidden' name='health_card_expired_yn' value=''></input>
    <input type='hidden' name='annual_income' value=''></input>
    <input type='hidden' name='family_asset' value=''></input>
    <input type='hidden' name='no_of_dependants' value=''></input>
    <input type='hidden' name='resp_for_payment' value=''></input>
    <input type='hidden' name='credit_doc_reqd_yn1' value=''></input>
    <input type='hidden' name='credit_doc_reqd_yn2' value=''></input>
    <!-- End for Billing Enhancements -->
    <input type='hidden' name='eff_frm_date' value=''></input>
    <input type='hidden' name='remarks' value=''></input>  
	<input type='hidden' name='gl_holder_name' value=""></input>  
	<input type='hidden' name='gl_holder_reln' value=""></input> 
    <%} %>
    <!--End--Hidden Fields for Billing Interface-->
	<input type='hidden' name='ct_patient_id' value="C"></input>
	<input type='hidden' name='care_locn_type_ind' value="C"></input>
    <input type='hidden' name='user_id' value=''></input>
	<input type='hidden' name='remarks' value=''></input>
    <input type='hidden' name='upd_user_flag' value=''></input>
    <input type='hidden' name='reccnt' value="<%=reccnt%>"></input>
    <!-- Hidden fields for Visit Charge Calculation  -->
    <input type='hidden' name='pkg_bill_doc_type' value=""></input>
    <input type='hidden' name='pkg_bill_doc_num' value=""></input>
    <input type='hidden' name='policy_type_code' value=""></input>
    <input type='hidden' name='effective_date' value=""></input>
    <input type='hidden' name='credit_auth_ref' value=""></input>
    <input type='hidden' name='approved_days' value=""></input>
    <input type='hidden' name='base_qty' value=""></input>
    <input type='hidden' name='base_rate' value=""></input>
    <input type='hidden' name='base_charge_amt' value=""></input>
    <input type='hidden' name='gross_charge_amt' value=""></input>
    <input type='hidden' name='disc_amt' value=""></input>
    <input type='hidden' name='net_charge_amt' value=""></input>
    <input type='hidden' name='pat_base_qty' value=""></input>
    <input type='hidden' name='pat_base_rate' value=""></input>
    <input type='hidden' name='pat_serv_qty' value=""></input>
    <input type='hidden' name='pat_base_charge_amt' value=""></input>
    <input type='hidden' name='pat_gross_charge_amt' value=""></input>
    <input type='hidden' name='pat_disc_amt' value=""></input>
    <input type='hidden' name='pat_net_charge_amt' value=""></input>
    <input type='hidden' name='cust_base_qty' value=""></input>
    <input type='hidden' name='cust_base_rate' value=""></input>
    <input type='hidden' name='cust_serv_qty' value=""></input>
    <input type='hidden' name='cust_base_charge_amt' value=""></input>
    <input type='hidden' name='cust_gross_charge_amt' value=""></input>
    <input type='hidden' name='cust_disc_amt' value=""></input>
    <input type='hidden' name='cust_net_charge_amt' value=""></input>
    <input type='hidden' name='split_yn' value=""></input>
    <input type='hidden' name='pkg_ins_pat_ind' value=""></input>
    <input type='hidden' name='req_pkg_qty' value=""></input>
    <input type='hidden' name='req_addl_qty' value=""></input>
    <input type='hidden' name='req_std_qty' value=""></input>
    <input type='hidden' name='curr_availed' value=""></input>
    <input type='hidden' name='canadj_alert_ind' value=""></input>
    <input type='hidden' name='pkg_serv_code' value=""></input>
    <input type='hidden' name='visit_charge_stage' value="<%=visit_charge_stage%>"></input>
    <input type='hidden' name='day_type_code' value=""></input>  
    <input type='hidden' name='time_type_code' value=""></input>     
    <input type='hidden' name='disc_perc' value=""></input>  
    <input type='hidden' name='addl_fctr' value=""></input>  
    <!-- End of Hidden fields for Visit Charge Calculation  -->
    <input type='hidden' name='sys_date' value="<%=sys_date%>"></input>  
    <input type='hidden' name='pkg_sel' value=""></input>    
    <input type='hidden' name='pkg_bill_type' value=""></input>  
    <input type='hidden' name='pkg_bill_no' value=""></input> 

    <!--   Start of modifications for billing enhancement on 9th Dec 2003  -->
    <input type='hidden' name='cred_start_dt1' value=""></input>  
    <input type='hidden' name='cred_start_dt2' value=""></input>  
    <input type='hidden' name='cred_start_dt3' value=""></input> 
	   
    <!-- End of modifications for billing enhancement on 9th Dec 2003    -->

   	<!-- added on 8/25/2003 -->  
	 <input type='hidden' name='Chg_to_Visitor_Grp' value="<%=ChgToVisitorGrp%>">
	<input type='hidden' name='outst_amt' value="<%=outst_amt%>">
	<input type='hidden' name='bl_interface_yn' value="<%=bl_interface_yn%>"> 
	<input type='hidden' name='bl_install_yn' value="<%=bl_install_yn%>"> 
    <!-- Added for Billing validation on 16/8/2002 -->
	<input type='hidden' name='health_card_expired_yn1' value='<%=HcExpired%>'>
	<input type='hidden' name='bl_success' value="N">
	<!-- Added by Dharma on Aug 18th 2017 against ML-MMOH-CRF-0631 [IN:062148] Start-->
	<input type='hidden' name='invoke_from' value="<%=invoke_from%>">
	<input type='hidden' name='frameRef' value="<%=frameRef%>">
	<!-- Added by Dharma on Aug 18th 2017 against ML-MMOH-CRF-0631 [IN:062148] End-->

  <%
     //Added for biling  
		
      if (bl_interface_yn.equals("Y") && bl_install_yn.equals("Y") )
      {
            //calculate outstanding amount if outstanding amount > 0 then display at the end of patient line(blinking)          
           //if (outst_amt > 0) 
          //{
			  if(auth_win_reqd_yn.equals("Y")) {
              //Credit Authorisation screen is called.
              out.println("<script>dispAuth1("+outst_amt+",'"+patient_id+"');</script>");
			  }
			  /*
				  Below code added for Scrum 10638
				*/
			  else
		  {
				
					  out.println("<script>funPatRegCharges('"+patient_id+"');</script>");

		  }
          //}
      }
      // End of Billing
	  boolean downtimePatient =CommonBean.isDownTimePatient(con,patient_id);//Rameswar on 05-Nov-15

	  /*Added by Dharma on May 25th 2016 against KAUH-SCF-0261 [IN:059835] Start*/
	  String reg_date_time =CommonBean.getRegistrationDateTime(con,patient_id);//Dharma May 24,2016
	  if(!reg_date_time.equals("")){
		  reg_date_time = DateUtils.convertDate(reg_date_time,"DMYHMS","en",locale);
	  }
	 /*Added by Dharma on May 25th 2016 against KAUH-SCF-0261 [IN:059835] End*/
		
try
  {
PreparedStatement refTypePstmt = null;
ResultSet refTypeRS = null;
PreparedStatement orgTypePstmt = null;
ResultSet orgTypeRS = null;
String 	from_ref_type="";
org_type_data="";
StringBuffer  refTypeSQL = new StringBuffer();	
StringBuffer  orgTypeSQL = new StringBuffer();
			if (!referal_id.equals(""))
            {
                // Insurance Expiry check 
                // Check whether package exists for the patient or not  
				  refTypeSQL.append("select from_ref_type from pr_referral_register where referral_id = ?");
				  refTypePstmt = con.prepareStatement( refTypeSQL.toString());
	              refTypePstmt.setString ( 1, referal_id ) ;
				  refTypeRS = refTypePstmt.executeQuery() ;
		            if(refTypeRS.next()) {
					from_ref_type = refTypeRS.getString( "from_ref_type");
					}
                
					if(from_ref_type.equals("E") || from_ref_type.equals("L")){
								
					org_type_data="G";				
					
					}else{
					
					orgTypeSQL.append("select org_type from pr_referral_register, am_referral where referral_id = ? and from_ref_code = referral_code");
					orgTypePstmt = con.prepareStatement( orgTypeSQL.toString());
	                orgTypePstmt.setString ( 1, referal_id ) ;
					orgTypeRS = orgTypePstmt.executeQuery() ;
		            if(orgTypeRS.next()) {
						org_type_data = orgTypeRS.getString( "org_type");
						if(org_type_data==null)  		
							org_type_data="";
					
					}
					}
					if (orgTypePstmt != null) orgTypePstmt.close();
                    if (orgTypeRS != null)   orgTypeRS.close();
					if (refTypePstmt != null) refTypePstmt.close();
                    if (refTypeRS != null)   refTypeRS.close();
					if((refTypeSQL != null) && (refTypeSQL.length() > 0))
					{
						refTypeSQL.delete(0,refTypeSQL.length());
					}
					if((orgTypeSQL != null) && (orgTypeSQL.length() > 0))
					{
						orgTypeSQL.delete(0,orgTypeSQL.length());
					}
            }
          }

          catch(Exception e) { out.println("Exception in Referral ID End="+e);			e.printStackTrace();}
		%>
   
		  <%if(localeName.equals("en"))
			{%>
			<input type="hidden" name="p_passing_local_date" value="N">
			<%}
		  else if(localeName.equals("th"))
			{%>
			<input type="hidden" name="p_passing_local_date" value="Y">
		  <%}%>

		  <input type="hidden" name="isAENextofKinchngAppl" value="<%=isAENextofKinchngAppl%>"> <!-- added by mujafar for ML-MMOH-CRF-0632 -->
		  <input type="hidden" name="p_language_id" value="<%=localeName%>">	
		  <input type='hidden' name='locale' value="<%=locale%>"> 
          <input type='hidden' name='nat_id_val' value='S'></input>
		  <input type='hidden' name='entitlement_by_cat_yn' value="<%=entitlement_by_cat_yn%>"> 
		  <input type='hidden' name='patFlag' value="<%=patFlag%>"> 
		  <input type='hidden' name='facilityId' value="<%=facilityId%>">
		  <input type='hidden' name='patient_age' value="<%=patient_age%>">
		  <input type='hidden' name='accident_type_val' value="">
   		  <input type='hidden' name='location_code' value="">
   		  <input type='hidden' name='location_type' value="">
		  <input type='hidden' name='speciality_code' value="">
		  <input type='hidden' name='service_code' value="">
		  <input type='hidden' name='sub_service_code' value="">
			<input type='hidden' name='priority_no_code' value="">
		  <input type='hidden' name='visit_type_code' value="">
		  <input type='hidden' name='visit_type_ind' value="">
		  <input type='hidden' name='sysDateWithoutTime' value="<%=sysDateWithoutTime%>">
		  <input type='hidden' name='new_episode_yn_val' value="Y">
		  <input type='hidden' name='open_to_all_pract_yn' value="">		  
   		  <input type='hidden' name='patient_id' value="<%=patient_id%>">
		  <input type='hidden' name='referral_id' value="<%=referal_id%>">
   		  <input type='hidden' name='buildEpisodeRule' value="<%=buildEpisodeRule%>">
          <input type='hidden' name='disaster_area' value=''>
          <input type='hidden' name='new_file_no' value=''>
		  <input type='hidden' name='responsiveness' value=''>
		  <input type='hidden' name='symptom' value=''> 
		  <input type='hidden' name='pregnant_at_present_yn' value=''>
		  <input type='hidden' name='developmental_mile_stone_yn' value=''>
		  <input type='hidden' name='immunization_upto_date_yn' value=''>
   		  <input type='hidden' name='relation' value=''>		   
   		  <input type='hidden' name='blunt_yn' value=''>		   
   		  <input type='hidden' name='penetrating_yn' value=''>		 
   		  <input type='hidden' name='case_of_trauma_yn' value=''>		 
   		  <input type='hidden' name='rtaCheck' value=''>		   
		  <input type='hidden' name='vaccinated_yn' value=''>		     
   		  <input type='hidden' name='operation' value='GENERATEFILE'>
		  <input type='hidden' name='sysdate' value="<%=sysdate%>">
		  <input type='hidden' name='start_date' value="<%=start_date%>">
		  <input type='hidden' name='paediatric_yn' value="<%=paediatric_yn%>">
   		  <input type='hidden' name='gynaec_yn' value="<%=gynaec_yn%>">
		  <input type='hidden' name='oper_stn_id' value="<%=oper_stn_id%>">
		  <input type='hidden' name='sex' value="<%=sex%>">
		  <input type='hidden' name='regn_date' value="<%=regn_date%>">
		  <input type='hidden' name='dummy_visit_dttm' value="">
		  <input type='hidden' name='dummy_location_code' value="">
		  <input type='hidden' name='dummy_visit_type' value="">
		  <input type='hidden' name='nat_id_accept_alphanumeric_yn' value="<%=nat_id_accept_alphanumeric_yn%>"> 
		   <input type='hidden' name='nationality_id' value="<%=nationality_id%>"> 
		  
		<input type='hidden' name='downtimePatient' value="<%=downtimePatient%>">
		<input type='hidden' name='reg_date_time' value="<%=reg_date_time%>"><!--Added by Dharma on May 25th 2016 against KAUH-SCF-0261 [IN:059835] -->


<!-- *********added on 9th Dec 2003 , pass referral_id  to financila details******* -->
	<input type='hidden' name='financial_detail_ref_id' value=''>
	<input type='hidden' name='org_type' value="<%=org_type_data%>">
    <input type='hidden' name='bl_enter_yn' value='N'>
		
<!-- ends  -->
    <input type='hidden' name='patient_class' value='EM'>
<!-- Added on 26/08/2004 for calling MP_PAT_ADD_UPDATE in ejb -->
<!-- 	<input type='hidden' name='call_mp_pat_add_update' value="N"></input>  Monday, April 26, 2010 (venkat s) Contact deatisl proc change related modification -->
<!-- Addition ends-->
	<!-- Added For AAKH-CRF-0010 [IN:038535] By Dharma on Feb 26th 2014 Start -->
	<input type="hidden" name="five_level_triage_appl_yn" value="<%=five_level_triage_appl_yn%>">
	<!-- Added For AAKH-CRF-0010 [IN:038535] By Dharma on Feb 26th 2014 End -->
	<!--Added by Dharma on 3rd Feb 2016 for KDAH-CRF-0331 [IN058799] Start-->
	<input type = 'hidden' name = 'isForm60Available' value="<%=isForm60Available%>">  
	<!--Added by Dharma on 3rd Feb 2016 for KDAH-CRF-0331 [IN058799] End-->
	
	<!--Below line added for this CRF GDOH-CRF-0129-->
	<input type="hidden" name="assigncare_loctype_ind" id="assigncare_loctype_ind" value="<%=assigncareloctype%>">
	<input type="hidden" name="assigncare_locacode" id="assigncare_locacode" value="<%=assigncare_location_code%>">
	<input type="hidden" name="isReferral" id="isReferral" value="<%=isReferral%>"> 
	<!--End GDOH-CRF-0129-->
	<!--Below line added for this CRF ML-MMOH-CRF-0629-->
	<input type="hidden" name="priorityZone" id="priorityZone" value=""> 
	<!-- End this CRF ML-MMOH-CRF-0629-->
	
	<!-- START Added by Sangeetha for KDAH-CRF-0347-->
	<input type="hidden" name="validationForPanCardAvail" value="<%=validationForPanCardAvail%>"> 
	<input type="hidden" name="form60_YN" value="">
	<!-- END KDAH-CRF-0347-->

	<!--Added by Ashwini on 17-Aug-2017 for GDOH-CRF-0161-->
	<input type="hidden" name="isLabelChngAppl" value="<%=isLabelChngAppl%>"> 

	<input type='hidden' name='isAlternateAddressAppl' value="<%=isAlternateAddressAppl%>"><!--Added by Thamizh selvi on 1st Feb 2018 against ML-MMOH-CRF-0601-->

	<input type='hidden' name='isMechInjLabelChngAppl' value="<%=isMechInjLabelChngAppl%>"><!--Added by Thamizh selvi on 29th Mar 2018 against ML-MMOH-CRF-0649-->

	<!--Added by Thamizh selvi on 12th Mar 2018 against ML-MMOH-CRF-0645 Start-->
	<input type='hidden' name='isCaseDtlsRadioBtnAppl' value='<%=isCaseDtlsRadioBtnAppl%>'>
	<input type='hidden' name='OandG_yn' value='N'>
	<!--End-->
	<!--Added by Shanmukh on 10th-SEPT-2018 for MMS-DM-CRF-0147-->
	<input type='hidden' name='isPriorityZoneAppl' value='<%=isPriorityZoneAppl%>'>
	<!-- Below Added by Suji keerthi for ML-MMOH-CRF-1527 US008 -->
    <input type='hidden' name='resiAddMailAdd' value='<%=resiAddMailAdd%>'>
	
	
	 </form>
	 </body>
<%
   }
    catch(Exception e)
    {
        out.println("Exception in Main ="+e);
					e.printStackTrace();
    }
   }
   catch(Exception e)
   {
        out.println("Exception in Main ="+e);
					e.printStackTrace();
   }
   finally
   {
	    ConnectionManager.returnConnection(con,request);
   }
%>
<%!
	// To Handle java.lang.NullPointerException.
	public static String checkForNull(String inputString)
	{
		return ( ((inputString == null) || (inputString.equals("null"))) ? "" : inputString );
	}

	public static String checkForNull(String inputString, String defaultValue){
		return(((inputString == null) || (inputString.equals("null")) || (inputString.equals("")) ) ? defaultValue : inputString);
	}
%>

</html>