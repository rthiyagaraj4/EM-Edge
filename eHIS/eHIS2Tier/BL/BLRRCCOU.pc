/************************************************************************/
/* OCS MEDICOM VER 1.0                                                  */ 
/************************************************************************/
/* PROGRAM NAME          : BLRRCCOU.PC                                  */
/* AUTHOR                : HARISH                                       */
/* MODIFIED BY		 : RAGHAVA,NAGARAJAN /* 
/* DATE WRITTEN          : 30/12/2003                                   */
/*																		*/
/* FUNCTION		:  TO PRINT SETTLEMNT RECEIPT,	                */
/*			   DEPOSIT SLIP					*/
/*			   DETAILED RECEIPT	                        */
/*			   PACKAGE RECEIPT IN DETAILED	                */
/************************************************************************/

#include <stdio.h>
#include <string.h>
#include <math.h>
#include <bl.h>

#define NODATAFOUND sqlca.sqlcode == 1403
#define OERROR (sqlca.sqlcode < 0)
#define LAST_ROW (sqlca.sqlcode == 1403)
#define NOT_FOUND (sqlca.sqlerrd[2] == 0)
//#define MAX_LINES 40
#define ESC     0x1B
#define INIT_MESG       "  Printing in progress  "
#define ONLINE_PRINTING 1
/*
#define DEBUG 1
*/
#define ERR_MESG  4
#define NODATAFOUND sqlca.sqlcode == 1403
#define RESOURCE_BUSY (sqlca.sqlcode == -54)
#define SKIP_1 3
#define SKIP_2 64
#define SKIP_3 3
#define SKIP_4 10
#define SKIP_4_1 2
#define SKIP_5 22
#define SKIP_6 15
#define SKIP_6_1 15
#define SKIP_7 3
#define SKIP_8 13
#define SKIP_9 10
#define LENGTH_WORDS 80

EXEC SQL BEGIN DECLARE SECTION;


VARCHAR	uid_pwd					[132],
		uid						[50],
		date_time				[20],
		user_id					[91],
		nd_pgm_date				[35],
		nd_facility_name		[1000],
		nd_hcard_status			[12],	
		l_errortext				[1000],
		l_logo_yniflaser		[1000],
		LOGO_DIR				[1000],
		l_logo_name				[1000],
		l_errorlevel			[10],
		nd_user_name			[100],
		nd_user_id				[20],
		l_sysmessageid			[10],
		nd_hosp_name			[1000],
		d_exm_reason_remarks	[2000],
		nd_hosp_name1			[1000],
		nd_tel					[500],
		nd_tel_fax              [1000],
		orig_desc_string		[2000],
		nd_ln1_add				[500],
		nd_ln2_add				[500],
		nd_ln3_add				[500],
		nd_ln4_add				[500],
		nd_addr_line1		    [500],
		nd_addr_line2		    [500],
		nd_addr_line3		    [500],
        nd_addr_line4		    [500],
		nd_area_desc            [500],
		nd_town_desc		    [500],
		nd_region_desc			[500],
		nd_postal_desc			[500],
		d_addr_line1_prompt     [500],
		d_addr_line2_prompt		[500],
		d_addr_line3_prompt		[500],
		d_addr_line4_prompt		[500],
		d_res_area_prompt		[500],
		d_res_town_prompt		[500],
		d_postal_code_prompt	[500],
		d_region_prompt			[500],
		nd_zip_code				[500],
		d_exm_remark			[2000],
		nd_status				[3],
		d_exm_remark1			[2000],
		d_exm_remark2			[2000],
		nd_use_in_hosp			[500],
		nd_medical_faclt        [1000],
		nd_hosp_add				[2000],
		nd_hosp_add1		    [2000],
		nd_use_in_hosp1			[500],
		nd_fax					[500],
		nd_receipt_format_id	[3],
		nd_slmt_mode_yn			[3],
		curr_date				[20],
		nd_sys_date			    [20];
VARCHAR d_receipt_by_inv_yn     [2],
		d_pmnt_ref_num			[100];
VARCHAR	d_bill_doc_type_code	[18],
		d2_bill_doc_type_code	[18],
		p_language_id			[3],
		d2_patient_id			[30],
		l_pk_value				[100],
		l_translated_value		[201],
		d_bill_doc_num			[9],
		d2_bill_doc_num			[20],
		//d2_doc_date				[17],
		d2_doc_date				[30],
		d_receipt_date			[17],
		d_receipt_date_nd		[17],//changed by sarvinder for SCF-9456		
		nd_reason_code			[30],
		nd_actual_reason		[30],
		d_reason_desc			[2000],
		d_reason				[30],
		nd_pgm_id				[50],
		d_bill_format			[2],
		sub_print_text			[70],
		d_payer_adjust_yn		[3],
		sub_print_text1			[100];

VARCHAR	d_settlement_type_code	[7],
        d_settlement_desc		[46],
		d_cash_slmt_flag		[2],
		d_slmnt_doc_ref			[61],
		d_bank_code				[25],
		d_ref_dep_doc_type_code [19],
		d_ref_dep_doc_number	[9],
		d_ref_dep_doc_srno		[3],
		d5_ref_dep_doc_type_code[19],
		d5_ref_dep_doc_number	[9],
		d5_ref_dep_doc_srno		[3],
		d_dep_doc_type_code     [19],  //ragahav on 21/07/2010
		d_dep_doc_number        [9],   //ragahav on 21/07/2010
		d_org_dep_doc_type_code [25],
		d_org_dep_doc_number	[9],
		d_org_dep_doc_srno		[3],
		d_org_dep_code			[21],
		nd_d_org_dep_code		[21],  //for SCF-7093
		nd_org_dep_num		    [21],  //ragahav on 21/07/2010
		d_org_dep_num			[21],
		d5_org_dep_code			[21],
		d_payer_name			[41],
		nd_patient_name			[41],
		d_same_payer_name		[41],
		d_rcpt_rfnd_id_no		[31],
		d_same_rcpt_rfnd_id_no	[31], //raghava for ICN-275(internal icn raised by gift)
		d_slmt_doc_ref_date		[20],
		d_bank_name				[60],
		d_receipt_nature_code	[9],
		d_recpt_refund_ind		[3],
		d_remarks				[1000],
		nd_exempted_bill_yn		[3],	
		d_added_by_id			[50],
		d_receipt_type_code		[10],
		d_doc_type_code1    	[10],		
		d_doc_number1		    [50],
		d3_bill_doc_type_code	[50],
		d3_bill_doc_number		[50],
		d3_bill_doc_srno		[10],
		d2_episode_type			[2],
		d2_episode_id			[9],
		d2_visit_id				[5],
		d2_customer_code		[25],
		d_print_yn				[5],
		d_cash_counter_code     [5],
		d_oth_rec_desc			[50],
		d_cashier_cheque_yn     [3],
		d_rcpt_nat_desc         [500],
		nd_pad_req_yn			[3],
		nd_print_option			[3],
		nd_batch_filename		[20],
		nd_report_option		[3],
		nd_desc_with_spl_chr	[2000],
		nd_counter_name			[1000],
		d_row_id				[1000];
	
			   
double  d_pay_amt				=0,
		d_adj_amt				=0,
		tot_dep_adj_amt			=0,  //raghava on 20/07/2010
		tot_dep_rem_amt		    =0,  //raghava on 20/07/2010
		nd_tot_dep_amt	        =0,  //raghava on 20/07/2010
		d_oth_receipt_amt		=0,
		nd_rem_dep_amt			=0,  //SCF-7093
		d_adj_payer_dist_amt	=0;

double  d_bill_amt				=0,
		nd_rcpt_amt				=0,
		d_settled_amt			=0,
		nd_tot_spl_agency_amt   =0;

VARCHAR	nd_session_id			[16],
		nd_facility_id			[3] ,
		nd_fm_doc_type			[7],
		nd_to_doc_type			[7],
		nd_nationality			[5],
		nd_fm_doc_num			[10],
		nd_to_doc_num			[10],
		nd_fm_doc_date			[20],
		nd_bill_doc_code		[10],
		nd_bill_doc_num			[12],
		nd_detail_type_yn		[3],
		nd_option				[3],
		cur_str					[8],
		sub_cur_str				[8],	   
		nd_to_doc_date			[20],
		nd_ws_no				[50];

char	print_y,
        rec_out, 
		grp_out, 
		sec_box_out;

char	st_var[50]; 
VARCHAR	st_tel_fax[100];

//char	amt_in_words	[10][133],
//		amt_in_words1	[10][133];

VARCHAR	amt_in_words	  [2000],
		amt_in_words_Sep  [2000],
		amt_in_words_Sep1 [2000];

int		v_lno = 0,
		v_pno = 0,
		l_count_no_of_docs=0,
		v_lnum =0,
		print_hdr_cnt=0,
		print_two_cnt=0,
		refidcnt=0,
		d_hdr_doc_amt=0,
		d_dtl_doc_amt=0,
		nd_length_of_string=0,
		l_comma_position=0,
		l_len_remark	=0,
		l_exits_print_route=0,
		filecount=0;
		  

int		ccnt=0,ccnt1=0,
		rcnt=0,
		oth_cnt=0,k=1,i=0,p=1,print_cnt=0,
		othp_cnt=0,
		legend_cnt=0,
		l_discount_count=0,
		l_addlcharge_count=0,
		lcol_cnt=0,r_ctr,
		l_cnt_no_of_legends=0,
		l_print_adj_dep=0,     //ragahav on 21/07/2010
		l_dep_adjst_exists=0,  //ragahav on 21/07/2010
		l_tot_adjst_dep_amt=0; //ragahav on 21/07/2010

long	MAX_LINES=40;

double 	nd_net_total			=0,
		nd_gross_total			=0,
		nd_disc_total			=0,
		nd_othp_payer_amt		=0,
		nd_tot_othp_payer_amt	=0,
		p_tot_pat_disc_amt		=0,
		nd_tot_paid_amt         =0, //12128
		nd_partial_settled_amt	=0,
		nd_net_pay_pat			=0,
		print_gd_tot_amt		=0;

VARCHAR	d_doc_type_code         [7],
		d_doc_number            [9],
		nd_doc_type				[7],
		nd_doc_num				[19],
		d_bill_out_amt			[100],
		nd_doc_num_ccc			[19],
		d_episode_type          [2],
		d_patient_id            [21],
		d_patient_name          [61],
		d_date_of_birth			[31],
		d_org_dept				[100],
		d_gender				[2],
		d_gender_desc			[500],
		d_ward_code_desc		[300],
		d1_blng_grp_id			[5],
		d_blng_grp_desc			[300],
		d_patient_name_loc_lang [61],
		d_episode_id            [9],
		nd_episode				[10],
		d_visit_id              [5],
		d_doc_amt               [23],
		d_acc_int_code			[7],
		d_ac_code				[51],
		d_nric_no				[21],
		d_receipt_type			[10],
		d_receipt_desc			[16],
		nd_reportid				[20], 
		reportid                [20],       
		nd_logo_pgm_id			[1000],
		nd_patient_id_loc		[25],
		nd_patient_id_loc_desc	[200],
		l_to_doc_type_code		[10],
		l_to_doc_type_num		[10],
		l_rcpt_rfnd_ind			[2],
		l_online_print_yn		[5],
		l_fr_date				[30],
		l_arg_patient_id		[25],
		l_to_date				[30],
		l_curr_date				[30],
		l_episode_type          [2],
		nd_episode_type			[5],
		nd_reprint_yn			[2],
		nd_pmnt_ref_num			[31],
		nd_function_id          [31],
		d_customer_name			[101],
		d_customer1				[46],
		d_customer2				[46],
		d_customer3				[46],
		nd_cust_nm				[46],
		leg_cust				[70],
		TEMP1 [50];


VARCHAR	d_encounter_id			[13],
		d_cust_code1			[25],
		nd_cust_code1			[25],
		nd_cust_cd1				[25],
		d_cust_code				[25],
		nd_cust_code			[25],
		dc_bill_print_flag		[2],
		d_bill_trx_type_code	 [41],
		d_bill_nature_code		[2],
		d_trx_doc_ref			[61],
		d_trx_doc_ref_line_num	[9],
		d_trx_doc_ref_seq_num	[5],
		d_blng_serv_code		[31],
		nd_blng_serv_code		[31],
		d_mapping_code_ind		[3],
		d_serv_anal_grp 		[31],
		nd_serv_anal_grp		[31],
		d_serv_class_code		[10],
		nd_serv_class_code		[10],
		d_serv_item_code		[61],
		d_serv_item_desc		[61],
		d_payer_serv_grp_hdr	[7],
		d_payer_serv_grp_line	[7],
		d_exm_bill_code			[15],
		d_exm_bill_num			[10],
		//d_exm_bill_out_amt		[20],
		d_exm_episode_type		[4],		
		d_exm_episode_id		[15],			
		d_exm_visit_id			[10],
		d_prt_grp_hdr_code		[7],
		d_prt_grp_line_code		[7],
		d_ent_item_grp_code		[13],
		d_payer_item_grp_code	[7],
		d_print_seq				[5],
		d_serv_qty			    [20],
		d_summary_dtl_ind		[3],
		d_package_trx_yn		[2],
		nd_summary_dtl_ind		[3],
		nd_acc_entity_code		[5],
		d2_short_name			[16],
		d_adm_rec_flag			[2],
		d_acct_seq_no			[4],
		d_token_string		    [500],
		d_token_serial_no		[6],
		nd1_trx_doc_ref			[61],
		nd1_trx_doc_ref_line_num[61],
		nd_trx_doc_ref			[61],
		nd_trx_doc_ref_line_num [61];		

double	d_upd_gross_charge_amt=0,
		d_upd_disc_amt=0,
		d_upd_net_charge_amt=0,
		d_bill_tot_exmpt_amt=0,
		d_package_seq_no=0,
		nd_upd_gross_charge_amt=0,
		nd_upd_net_charge_amt=0,
		tot_upd_gross_charge_amt=0,
		tot_upd_net_charge_amt=0,
		pat_upd_gross_charge_amt=0,
		pat_upd_net_charge_amt=0,
		oth_p_upd_gross_charge_amt=0,
		oth_p_upd_net_charge_amt=0,
		tot_upd_disc_amt=0,
		nd_upd_disc_amt=0,
		oth_p_upd_disc_amt=0,
		pat_upd_disc_amt=0,
		nd_net_payable=0,
		d_net_reimbursable_amt,
		d_addl_charge_amt_in_charge=0,
		nd_pat_net_amt=0,
		nd_net_non_reimbursable_amt=0,
		nd_tot_non_reimbursable_amt=0,
		nd_gnd_tot_net_non_reimbursable_amt=0,
		d_adj_payer_amt=0,
		d1_adj_payer_amt,
		d_exm_bill_out_amt=0;


VARCHAR	d1_trx_doc_ref			[61],
		d1_trx_doc_ref_line_num	[9],
		d1_trx_doc_ref_seq_num	[5],
		d1_cust_code			[25],
		nd1_cust_code			[25],
		d1_blng_serv_code		[31],
		nd2_blng_serv_code		[31],
		nd1_blng_serv_code		[31],
		d1_serv_anal_grp		[31],
		d1_mapping_code_ind		[3],
		d1_mapping_code			[12],
		nd1_mapping_code		[12],
		d_mapping_code			[12],
		nd2_serv_anal_grp		[31],
		nd1_serv_anal_grp		[31],
		d1_serv_class_code		[10],
		nd1_serv_class_code		[10],
		d1_serv_item_code		[61],
		d1_serv_item_desc		[61],
		d1_payer_serv_grp_hdr	[7],
		d1_payer_serv_grp_line	[7],
		d1_prt_grp_hdr_code		[7],
		d1_prt_grp_line_code	[7],
		d1_bill_doc_type_code	[18],
		d_exempted_bill_yn		[5],
		d1_bill_doc_num			[9],
		d1_ent_item_grp_code	[13],
		d1_payer_item_grp_code	[7],
		d1_print_seq			[5],
		d1_serv_qty				[20],
		d1_summary_dtl_ind		[3],
		d1_package_trx_yn		[2],
		nd1_package_trx_yn		[2],
		nd2_summary_dtl_ind		[3],
		nd1_summary_dtl_ind	    [2], 
		d1_episode_type			[2],
		d1_episode_id			[9],
		d1_visit_id				[5],	
		d1_patient_id			[61],
		d_ward_code				[5],
		d1_encounter_id			[13],
		d1_cust_code1			[25],
		nd1_cust_code1			[25],
		dp_cust_code			[25],
		nd1_prt_grp_hdr_code	[7],
		nd1_prt_grp_line_code	[7],
		nd1_payer_serv_grp_hdr	[30],
		nd_payer_serv_grp_hdr	[30],
		nd1_payer_serv_grp_line	[30],
		nd_payer_serv_grp_line	[30],
		dc_cust_code			[9],
		nd_prt_grp_hdr_code		[7],
		nd_prt_grp_line_code	[7],
		nd_ref_prt_grp_hdr_code [7],
		nd_ref_prt_grp_line_code [7],
		nd_prt_hd_desc			 [46],
		nd_prt_line_desc		 [46],
		nd_blng_desc			 [46],
		nd_blng_desc1			 [46],
		nd_mapping_code_desc	 [46],
		nd1_mapping_code_desc	 [46],
		nd_blng_class_desc		 [46],
		nd_blng_class_desc1		 [46],
		l_dflt_bill_print_in_summ_yn[5],
		nd_aggr_doc_type_code	  [50],
		nd_aggr_doc_num			 [50],
		nd_aggr_inst_no			 [1000],
		nd_cashier_name			 [500],
		nd_print_cashier_name	 [500],
		nd_print_user_name		 [500],
		nd_user_position		 [500],
		dc_admn_date			 [12],
		d_dis_date				 [12],
		nd_encounter_id			 [1000];


double	nd_pat_net_charge_amt	=0,
		p_pat_gross_amt			=0,
		p_pat_disc_amt			=0,
		p_pat_net_amt			=0,
		d1_upd_net_charge_amt	=0,
		d1_upd_gross_charge_amt	=0,
		d1_upd_disc_amt			=0,
		d1_addl_charge_amt_in_charge=0,
		d1_package_seq_no=0,
		nd_tot_pat_net_charge_amt=0,
		p_tot_pat_gross_amt		=0,
		p_tot_pat_net_amt		=0,
		nd_subdiv_amt			=0,
		nd_tot_subdiv_amt		=0,
		nd_tot_pat_disc_amt		=0,
		nd_pat_gross_amt		=0, // added at 09/07/07
		nd_pat_net_amt1			=0,
		nd_pat_disc_amt			=0,
		nd_pat_gross_amt1		=0,
		nd_pat_net_amt2			=0,
		nd_pat_disc_amt1		=0,
		nd_pat_addl_charge_amt  =0,
		nd_total_pat_addl_charge_amt=0;
		
		
VARCHAR p_gross_net_amt_ind				[4],              
		p_serv_disc_on_gross_ind		[4],        
		p_all_oth_adj_amt_row_ind		[4],     
		p_bill_disc_sep_row_yn			[4],     
		p_bill_adj_sep_row_yn			[4],     
		p_bill_exm_sep_row_yn			[4],     
		p_bill_wo_sep_row_yn			[4],     
		p_oth_payers_amt_print_row_ind  [4], 
		p_patient_amt_print_row_ind		[4],   
		p_bill_net_payable_ind			[4],   
		c_gross_net_amt_ind				[4],   
		c_serv_disc_on_gross_ind		[4],  
		c_reim_amt_ind					[4],
		c_non_reim_amt_ind				[4], 
		c_all_oth_adj_amt_ind			[4],   
		c_bill_disc_sep_row_yn			[4],   
		c_bill_adj_sep_row_yn			[4],   
		c_bill_exm_sep_row_yn			[4],   
		c_bill_wo_sep_row_yn			[4],   
		c_oth_payers_amt_print_row_ind	[4],  
		c_bill_subsidized_amt_ind		[4],  
		c_bill_net_payable_ind			[4],  
		status							[4],
		print_legend_yn					[2],
        print_legend_dtl_rcpt			[2],
		c_addl_charge_amt_ind			[2],
		p_print_zero_adcharg_column_yn  [2],
		p_print_zero_disc_column_yn		[2],
		p_print_zero_other_adj_yn		[2],
		c_print_zero_adcharg_column_yn  [2],
		c_print_zero_disc_column_yn     [2],
		c_print_zero_other_adj_yn		[2],
		c_serv_desc_sep_line_yn			[2],
		c_print_separator_line			[2],
		c_print_zero_net_amt_serv_yn    [2];

VARCHAR nd_temp_date[20],
		nd_temp_date1[20],
		nd_loc_date1[20],
		nd_loc_date[20],
		date_convert[20],
		cCheck					[2],     /* Scrum Changes */
		cCheck1                 [2], /* Scrum Changes */
		nd_preprint_flag[3]; //added by raghava as per kuila sir instructions
/*********CRF-656*******/
VARCHAR     date							[20],
            nd_pwd 							[91],
		    nd_pwd1 						[91],
            d_curr_pgm_name                 [15],
			nd_report	         		    [20],
			nd_facility				        [3],
			nd_REGION_CODE					[100],
			nd_RES_AREA_CODE				[100],
			nd_RES_TOWN_CODE				[100],
			nd_REGION_CODE1					[100],
			nd_RES_AREA_CODE1				[100],
			nd_RES_TOWN_CODE1				[100],
			nd_CASH_SLMT_FLAG				[4],
			nd_print_falg					[2],
			nd_bank_name					[100],
			nd_reminder_format_id			[21],
			bl_reminder_format_id			[21],
			bl_report_title_text			[101],
			b1_original_text				[101],
			b1_copy_text					[101],
			bl_header_line_01				[101],
			bl_header_line_02				[101],
			bl_header_line_03				[101],
			bl_header_line_04				[101],
			bl_header_line_05				[101],
			bl_header_line_06				[101],
			bl_header_line_07				[101],
			bl_header_line_08				[101],
			bl_header_line_09				[101],
			bl_header_line_10				[101],
			bl_body_line_01					[101],
			bl_body_line_02					[101],
			bl_body_line_03					[101],
			bl_body_line_04					[101],
			bl_body_line_05					[101],
			bl_body_line_06					[101],
			bl_body_line_07					[101],
			bl_body_line_08					[101],
			bl_body_line_09					[101],
			bl_body_line_10					[101],
			bl_body_line_11					[101],
			bl_body_line_12					[101],
			bl_body_line_13					[101],
			bl_body_line_14					[101],
			bl_body_line_15					[101],
			bl_body_line_16					[101],
			bl_body_line_17					[101],
			bl_body_line_18					[101],
			bl_body_line_19					[101],
			bl_body_line_20					[101],
			bl_footer_line_01				[101],
			bl_footer_line_02				[101],
			bl_footer_line_03				[101],
			bl_footer_line_04				[101],
			bl_footer_line_05				[101],
			bl_footer_line_06				[101],
			bl_footer_line_07				[101],
			bl_footer_line_08				[101],
			bl_footer_line_09				[101],
			bl_footer_line_10				[101],
			nd_doc_type_code				[17],
			nd_doc_type_code_ccc				[17],
			nd_patient_id					[21],
			nd_reminder_no					[4],
			column_var						[101],
			nd_column_val					[1000],
			str_var							[101],
			str_var2						[101],
			line_var						[101],
			dup_var							[101],
			lc_str_val						[101],
			lc_str_var						[101],
			tab_name						[31],
			ls_str_var						[101],
			lc_var							[3],
			ls_char_var						[3],
			ls_str							[101],
			ls_var							[101],
			lc_splch_var					[101];
		 

	char	sql_stmt             [5000]; 			
 varchar    sql_stmt1            [1000],
			sql_stmt2            [1000];

	char   string_arr	[1000], 
		   new_str		[1001];	
char st_var[50]; 

int date_yn = 0,line_ctr = 0;
int splch_pos,st_pos,spchar_type,bold_st = 0,font_st = 0,uline_st=1;
int spchar_pos = 0,spchar_pos1,ctr;
int i,bl_doc_srl_no,pos_var,pos_var1,pos_var2,print_upto,pos_length,var_length;
int l_pos,lv_var,j,len_lc_str_val,prt_len,print_upto_c,ld_var,char_pos;
int ld_pos,ld_length,len=0;

char nd_order_by;
char filename[150];
char pfilename[150];
char x_msg[200];
char loc_legend[999][201];
char fm_date[11],to_date[11];
int l_inst_rec,l_payer_name_exsts;
/********UPTO HERE**********/

VARCHAR d_inv_doc_type_code[10],
		d_inv_doc_number[20],
		d_drg_inv_yn[2],
		d_inv_cust_grp[5],
		d_inv_cust_code[15],
		d_inv_policy_type_code[50],
		d_inv_episode_type[5],
		d_ref_source_code_sub[10],
		d_chk_drg_reim_spec_yn[5],
		d_drg_reim_spec_grp[5],
		v_print_format	   [3],
		d_inv_patient      [30],
		d_inv_pat_name	   [500],
		d_ref_episode_id   [20],
		d_ref_episode_type [5],
		d_ref_visit_id     [5],
		d_let_body_header_ln01[150],       
		d_let_body_header_ln02[150],        
		d_let_body_header_ln03[150],        
		d_let_body_header_ln04[150],        
		d_let_body_header_ln05[150],        
		d_let_body_footer_ln01[150],        
		d_let_body_footer_ln02[150],        
		d_let_body_footer_ln03[150],        
		d_let_body_footer_ln04[150],        
		d_let_body_footer_ln05[150],        
		d_let_foot_note_ln01[150],          
		d_let_foot_note_ln02[150],          
		d_let_foot_note_ln03[150],          
		d_let_foot_note_ln04[150],          
		d_let_foot_note_ln05[150],          
		d_authorized_signatory[150],        
		d_authorized_signatory_desg[150],   
		d_outstd_doc_in_annex_only_yn[150], 
		d_inv_auth_signatory[150],          
		d_inv_auth_signatory_desg[150],     
		d_disd_let_auto_finalize_yn[150],   
		d_disd_let_auto_acceptance_yn[150], 
		d_inv_issueing_signatory[150],      
		d_inv_issueing_signatory_desg[150],  
		d_print_text_for_markup[150],        
		d_print_text_for_markdown[150],      
		d_print_text_for_drg[150],           
		d_print_text_for_rcpt[150],
		d_print_renal_inv_no_yn[10],     
        d_disp_doc_print_rule_ind[10],      
        d_gen_disp_for_printed_inv_yn[10],
        d_print_cons_dur_inv_print[10],   
        d_inv_print_rule_ind[10],
		d_print_patient_dtl_yn[2],
		d_print_text_for_drg_rcpt[150],		 //added by raghava on 20/09/2010 
		d_spec_payer_srv_grp_for_df[3],		 //added by raghava on 20/09/2010 
		d_spec_payer_srv_grp_line_df[4],	 //added by raghava on 20/09/2010 
		d_print_text_for_spec_grp_rcpt[150]; //added by raghava on 20/09/2010 

double   d_factor,
		 d_drg_base_rate,
		 d_adjrw,
		 d_inv_amt,
		 d_non_drg_amt,
		 d_other_payable_amt,
		 d_inv_settled_amt,
		 nd_spec_payer_srv_grp_stld_amt; //added by raghava on 20/09/2010
			
VARCHAR	l_printer_ids		[1000],
	    l_printer_names		[1000],
	    l_printer_types		[1000],
	    l_queue_names		[1000],
	    l_no_of_copies		[1000],
		l_file_name			[50],
		l_line1				[50],
		l_line2				[50],
		l_line3				[50],
		l_line4				[50],
		l_line5				[50],
		l_line6				[50],
		l_line7				[50],
		l_bill_contact_name	[50],
		l_bill_contact_name_p		[50],
		l_bill_contact_name_p1		[50],
		l_bill_contact_name_p2		[50],
		l_bill_contact_name_c		[50],
		l_bill_contact_name_c1		[50],
		l_bill_contact_name_c2		[50],
		l_bill_contact_name_title	[50],
		l_bill_contact_name_title_p	[50],
		P_START_TIME			[60],  
		l_bill_contact_name_title_p1[50],
		l_bill_contact_name_title_p2[50],
		l_bill_contact_name_title_c	[50],
		l_bill_contact_name_title_c1[50],
		l_bill_contact_name_title_c2[50],
		l_bill_long_desc			[40],
		l_bill_long_desc_p			[40],
		l_bill_long_desc_p1			[40],
		l_bill_long_desc_p2			[40],
		l_bill_long_desc_c			[40],
		l_bill_long_desc_c1			[40],
		l_bill_long_desc_c2			[40],
		l_bill_add1_desc			[40],
		l_bill_add1_desc_p			[40],
		l_bill_add1_desc_p1			[40],
		l_bill_add1_desc_p2			[40],
		l_bill_add1_desc_c			[40],
		l_bill_add1_desc_c1			[40],
		l_bill_add1_desc_c2			[40],
		l_bill_add2_desc			[40],
		l_bill_add2_desc_p			[40],
		l_bill_add2_desc_p1			[40],
		l_bill_add2_desc_p2			[40],
		l_bill_add2_desc_c			[40],
		l_bill_add2_desc_c1			[40],
		l_bill_add2_desc_c2			[40],
		l_bill_add3_desc			[40],
		l_bill_add3_desc_p			[40],
		l_bill_add3_desc_p1			[40],
		l_bill_add3_desc_p2			[40],
		l_bill_add3_desc_c			[40],
		l_bill_add3_desc_c1			[40],
		l_bill_add3_desc_c2			[40],
		l_bill_add3_desc_temp		[40],
		l_episode_settlement_ind	[4],
		l_episode_cust_code			[10],
		l_nric_number				[25],
		l_gl_holder_name			[181],
		l_gl_holder_name1			[181],
		l_gl_holder_name2			[181],
		l_gl_ic						[1000],
		l_pat_reln_with_gl_holder	[90],
		l_pat_reln_with_gl_holder1	[90],
		l_pat_reln_with_gl_holder2	[90],
		l_detail_report_flag		[3],
		l_print_without_disc_func	[4],
		l_no_settlement_details		[5],
		l_credit_doc_ref_desc		[90],
		l_credit_doc_ref_desc1		[90],
		l_credit_doc_ref_desc2		[90];

double  p_gross_amt		=0,
	    p_disc_amt		=0,
		p_net_amt		=0,
		nd_oth_payer_amt=0,
		nd_tot_oth_payer_amt=0,
		nd_tot_disc_amount=0,
		nd_tot_net_reimbursable_amt=0,
		nd_gnd_tot_net_reimbursable_amt=0,
		nd_grnd_total=0;

VARCHAR	p_err_level				[10],
		p_sys_message_id		[10],
		p_error_text			[200],
		ar_cust					[46],
		dc_blng_grp_id	        [5];

VARCHAR nd_cahier_position[500];

        
				   
char	nd_print_flag,
		nd_lang_ind,			
		nd_printed_yn,
		v_c_billed_serv, 
		d_summary_yn,
		d_err_code[30];
char	l_sql_stmt[3000];
char    l_temp_line1[300];
char    l_temp_line2[300];
char	l_mesg[1000];
char	msg_str_var[1000];

char l_filename[300][300];

int		no_of_lines,end_of_report,no_of_char=0,l_num_rec=1;
int     l_bill_print_opt_for_disc_print,
		cnt				= 0;
		int	l_page_no	= 0,
		l_bill_page_no  = 0,
		page_no			= 1,
		l_main_hdr		= 1,
		three_tier		= 0,
		l_rcpt_page_no  = 0,
		nd_tot_serv_qty = 0;

char str_qty[30];
double	d_doc_amt_num, 
		l_coupon_amt,
		nd_dep_amt,
		d_serv_disc_amt			= 0,
		d1_man_disc_amt			= 0,
		d1_overall_disc_amt		= 0,
		d1_tot_adjust_amt		= 0,
		d1_bill_tot_exmpt_amt	= 0,
		d1_bill_amt				= 0,
		d1_tot_write_off_amt	= 0,
		d1_deposit_adj_amt		= 0,
		d1_bill_tot_outst_amt	= 0;

long    l_bill_doc_number;

int		nd_no_of_decimal, 
		dep_cnt			= 0, 
		rec_cnt			= 0,
		line_no			= 0,
		nd_dep_status	= 0, 
		l_tier_arch, 
		l_no_of_page	= 0,
		l_dmp			= 0, 
		l_lsr			= 0,
		l_margin_len	= 30,
		print_deposit_header_flag=0;

int		string_var[10],
		l_dtl_receipt_cnt=0,
		l_depos_cnt=0,
		l_receipt_cnt=0,
		l_invoice_cnt=0,
		l_receipt_type=0,
		l_exmp_cnt=0,
		l_exmp_can_cnt=0,
		head_len=0,
		flag=0,end_of_subsidy=0;
// end_of_subsidy - This variable if recipt have multiple bills and if bill settled partially then
// receipt format will print one line....like total settled amount

int		hl	 = 196,
		//vl	 = 179,
		vl	 = 179,
		tlc	 = 218,
		trc	 = 191,
		blc	 = 192,
		brc	 = 217,
		vlti	 = 195,
		vrti	 = 180,
		htti	 = 194,
		hbti	 = 193,
		plus	 = 197;

/****** Added The following variables on 29/09/2009 for Package CRF-203 ******/

VARCHAR p_pkg_amt_str	    [200],
		p_pkg_dep_str	    [200],
		p_pkg_seq_num_str   [200],
		temp_pkg_amt_str	[200],
		temp_pkg_dep_str	[200],
		p_pkg_dep_amt_str	[200],
		temp_pkg_seq_num_str[200],
		nd_package_code		[10],
		nd_package_desc		[100],
		l_pkg_seq_num		[50],
		p_no_of_pkgs		[50],
		nd_round_flag		[2],
		d_pkg_blng_grp_yn	[2],
		nd_slmt_type_desc   [500];


char    p_pkg_seq_num       [1500][201],
		p_pkg_amt			[1500][201],
		p_pkg_dep_amt		[1500][201];

int     l_pkg_len=0,l_lcnt=0;
double  l_pkg_amt=0,
		l_exm_bill_amt=0,
		l_pkg_dep_amt=0;
VARCHAR l_print_serv_item_yn [2],
        l_print_grping_serv_yn[2],
		l_print_footer_each_page_yn[2];  //Added by raghava on 01/07/2010 for UAT

/****** on 29/09/2009 for Package CRF-203 ******/

/****** on 29/10/2009 for CRF-521 ******/
VARCHAR  l_detail_desc	[500];
int      len_desc=0,r_ctrdesc=0,l_ctr=1,len_leg=0,pat_len=0,l_hig_len=0;
char     cl_string_desc[500];
/****** on 29/10/2009 for CRF-521 ******/  
/*** 06/01/2010 ***/
VARCHAR  l_con_rcpt_yn [2],
		 l_receipt_doc_size[3],
         lv_episode_type [100],
		 nd_inst_rcpt_yn[10],
		 d_location[500],
		 d_locn_code[15],
		 l_con_rcpt_blng_grp[5],
		 c1_pat_name[500]; //scf-7238
int      l_no_of_blng_grp=0,
         l_sum_bill_amt=0,
		 l_instr_rec=0;
/*** 06/01/2010 ***/
VARCHAR	nd_file_name [50],
		nd_lang_id	[4],
		l_temp_loc_legend[201],
		l_temp_legend[201],
		loc_legend1	[201],
		loc_legend2	[201],
		loc_legend3	[201],
		loc_legend4	[201],
		loc_legend5	[201],
		loc_legend6	[201],
		loc_legend7	[201],
		loc_legend8	[201],
		loc_legend9	[201],
		loc_legend999[201],
		loc_legend10[201],
		loc_legend11[201],
		loc_legend12[201],
		loc_legend13[201],
		loc_legend14[201],
		loc_legend15[201],
		loc_legend16[201],
		loc_legend17[201],
		loc_legend18[201],
		loc_legend19[201],
		loc_legend20[201],
		loc_legend21[201],
		loc_legend22[201],
		loc_legend23[201],
		loc_legend24[201],
		loc_legend25[201],
		loc_legend26[201],
		loc_legend27[201],
		loc_legend28[201],
						/*------20/09/2005---------*/
        loc_legend29[201],
		loc_legend30[201],
		loc_legend31[201],
		loc_legend32[201],
		loc_legend33[201],
		loc_legend34[201],
		loc_legend35[201],
		loc_legend36[201],
		loc_legend37[201],
		loc_legend38[201],
		loc_legend39[201],
		loc_legend40[201],
		loc_legend41[201],
		loc_legend42[201],
		loc_legend43[201],
		loc_legend50[201],
        loc_legend54[201],
		loc_legend55[201],
		loc_legend56[201],
		loc_legend57[201],
		loc_legend58[201],
		loc_legend59[201],
		loc_legend60[201],
		loc_legend61[201],
		loc_legend62[201],
		loc_legend63_rc[201],
		loc_legend64[201],
		loc_legend65[201],
		loc_legend66[201],
		loc_legend67[201],
		legend_doc_date[201],
		loc_legend_90[201],
	
		loc_legend63[210],
		loc_legend68[201],
		loc_legend69[201],
		loc_legend70[201],
		loc_legend71[201],
		loc_legend72[201],
		loc_legend73[201],
		loc_legend74[201],
		loc_legend75[201],
		loc_legend76[201],
		loc_legend77[201],
		loc_legend78[201],
		loc_legend79[201],
		loc_legend80[201],
		loc_legend81[201],
		loc_legend82[201],
		loc_legend83[201],
		loc_legend84[201],
		loc_legend85[201],
		loc_legend87[201],
		loc_legend88[201],
		loc_legend89[201],
		loc_legend90[201],
		loc_legend91[201],
		loc_legend92[201],
		loc_legend93[201],
		loc_legend94[201],
		loc_legend95[201],
		loc_legend96[201],
		loc_legend97[201],
		loc_legend98[201],
		loc_legend99[201],
		loc_legend100[201],
		loc_legend101[201],
		loc_legend102[201],
		loc_legend103[201],
		loc_legend104[201],
		loc_legend105[201],
		loc_legend106[201],
		loc_legend107[201],
		loc_legend108[201],
		loc_legend109[201],
		loc_legend680[201],
		loc_legend690[201],
		loc_legend700[201],
		loc_legend701[201],
		loc_legend1100[201],
		loc_legend1110[201],
		loc_legend1120[201],
		loc_legend1130[201],
		loc_legend1140[201],
		loc_legend1160[201],
		loc_legend1220[201],
		loc_legend1230[201],
		loc_legend110[201],
		loc_legend120[201],
		loc_legend210[210],
		loc_legend211[211],
		loc_legend1300[201],
		loc_legend1310[201],
		loc_legend1320[201],
		loc_legend1330[201],
		loc_legend1340[201],
		loc_legend1350[201],
		loc_legend1360[201],
		loc_legend1370[201],
		loc_legend1380[201],
		loc_legend1390[201],
		loc_legend1400[201],
		loc_legend1401[201],
		loc_legend1260[201],
		loc_legend1270[201],
		loc_legend1280[201],
		loc_legend1290[201],
		loc_legend1407[201],
		loc_legend1411[201],
		loc_legend1412[201],
		loc_legend1413[201],
		loc_legend1414[201],
		loc_legend1444[201],
		loc_legend1445[201],
		loc_legend1446[201],
		loc_legend1447[201],
		loc_legend1448[201],
		loc_legend1449[201],
		loc_legend1450[201],
		loc_legend1451[201],
		loc_legend1452[201],
		loc_legend1453[201],
		loc_legend1454[201],
		loc_legend1455[201],
		loc_legend1456[201],
		loc_legend1457[201],
		loc_legend1458[201],
		loc_legend1459[201],
		loc_legend1460[201],
		loc_legend1461[201],	//Added by raghava on 01/07/2010 for UAT
		loc_legend1462[201],	//Added by raghava on 01/07/2010 for UAT 
		loc_legend1464[201],	//Added by raghava on 01/07/2010 for UAT 
		loc_legend1465[201],	//Added by raghava on 01/07/2010 for UAT 
		loc_legend1466[201],	//Added by raghava on 01/07/2010 for UAT 
		loc_legend1415[401],
		loc_legend1439[401],
		loc_legend1423[401],
		loc_legend1424[401],
		loc_legend995[401];
							/******Up To Here  ********/
long	d_age;
char	d_summary_yn,
		nd_lang_ind, 
		nd_online_print_yn,
		l_print_option;
long	rcheck			= 0,
		last_line_check = 0,
		d_service_qty,
		d_base_rate,
		d_base_qty;
char    ar_cust_amt[45][30];	 
char    ar_amt[30][30],amt[30],temp[200]; 
int     call_mode;
int     l_dba_cnt;
EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE SQLCA.H;
EXEC SQL INCLUDE SQLDA.H;
#include <winproc.h>

FILE *fp;

int    lctr = 0,pctr = 1,nvalid = 0,ncancel = 0;
int    first = 1;

char filename[150];
char dep_filename[150];

char l_epi_barcode[50],
     l_rec_barcode[50];


char put_string(ls_var,ld_pos,ld_length)
char ls_var[101];
int ld_pos,ld_length;
{
 ls_str_var.arr[0] = '\0';
 ls_str_var.len = 0;

 strcpy(ls_str_var.arr,ls_var);
 ls_str_var.len = strlen(ls_str_var.arr);

 EXEC SQL select substr(:ls_str_var,:ld_pos,:ld_length)
	         into :ls_str
			 from dual;

 ls_str.arr[ls_str.len] = '\0';

 if (OERROR)
        err_mesg("SELECT failed on table DUAL",0,"");

 return(ls_str.arr);
 
}


void proc_main(argc,argv)
char *argv[];
int argc;
{
    char lv_msg[1024];
	
  

   if (argc < 6) 
   {
		disp_message(ERR_MESG,"BLRRCCOU : Usage Error - Check Command Line Parameter\n");
        proc_exit();
   } 
   //disp_message(ERR_MESG,"version-2"); 
   
   if (argc >= 10)
   {
       
		strcpy(nd_reportid.arr,argv[9]);
		nd_reportid.len = strlen(nd_reportid.arr);
		
   }
 
      
   if (argc < 8)
   {
	
		strcpy(nd_reportid.arr,"BLRRCPRT");
		nd_reportid.len = strlen(nd_reportid.arr);
   }
		
		nd_pgm_id.arr[0]='\0';
		nd_pgm_id.len=0;		
        strcpy(uid_pwd.arr,argv[1]);
        uid_pwd.len = strlen(uid_pwd.arr);
		strcpy(g_session_id,argv[2]);
		strcpy(nd_session_id.arr,argv[2]);
		nd_session_id.len = strlen(nd_session_id.arr);
		strcpy(g_pgm_id,"BLRRCCOU");
		strcpy(nd_pgm_id.arr,"BLRRCCOU");
		nd_pgm_id.len=strlen(nd_pgm_id.arr);
		nd_pgm_id.arr[nd_pgm_id.len]='\0';
		
	
   if(sql_connect() == -1)
   {
        disp_message(ERR_MESG,"Error in connecting to Oracle\n");
        if (uid_pwd.len == 0)
        disp_message(ERR_MESG,"Null oracle uid/pwd\n\n\n");
        proc_exit();
   }
 
   
   
	  
	set_meduser_role();

		uid.arr[0] = '\0';
		uid.len	   =	0;

	EXEC SQL select GET_TRACE_TIMESTAMP,substr(:uid_pwd,0,instr(:uid_pwd,'/')-1)
			 into :P_START_TIME,:uid  from dual;

		 uid.arr[uid.len] = '\0';


	strcpy(nd_lang_id.arr,l_language_id.arr);
    nd_lang_id.len = l_language_id.len;
	strcpy(g_pgm_date,argv[3]);
	strcpy(nd_pgm_date.arr,argv[3]);
	nd_pgm_date.len = strlen(nd_pgm_date.arr);


	get_param_for_three_tier();

	   

			if(l_tier_arch==2)
			{
			
				strcpy(d_doc_type_code.arr, argv[5]);
				strcpy(d_doc_number.arr, argv[6]);
				d_doc_type_code.len = strlen(d_doc_type_code.arr);
				d_doc_number.len    = strlen(d_doc_number.arr);
				
			}
			else
			{
				strcpy(l_file_name.arr, argv[6]);
				l_file_name.len = strlen(l_file_name.arr);
				l_file_name.arr[l_file_name.len] ='\0';
			}

		  
		   if(argc>=11)
			{
				
				
		
				strcpy(l_to_doc_type_code.arr,argv[10]);
				l_to_doc_type_code.len = strlen(l_to_doc_type_code.arr);
				strcpy(l_to_doc_type_num.arr,argv[11]);
				l_to_doc_type_num.len = strlen(l_to_doc_type_num.arr);

			}

		   if (argc >= 13)
			{
				

				strcpy(l_fr_date.arr,argv[12]);
				l_fr_date.len = strlen(l_fr_date.arr);
				strcpy(l_to_date.arr,argv[13]);
				l_to_date.len = strlen(l_to_date.arr);
			}
	
	//Incorporated as mentioned in Program from Muscat, by Harish on 12/03/2004.
	//Incorporation of additional front end parameter for Patient ID
			   
			   if (argc >= 15)      
				{
				   
				   strcpy(l_arg_patient_id.arr,argv[14]);
				   l_arg_patient_id.len = strlen(l_arg_patient_id.arr);
				   
				}

			   if (strcmp(l_arg_patient_id.arr,"$$$$$$$$$$") == 0)
				{
				  
				  l_arg_patient_id.arr[0] ='\0';
				  l_arg_patient_id.len = 0;

				}
				
			

			   if (argc >= 16)
				{
				  
				  strcpy(l_episode_type.arr,argv[15]);
				  l_episode_type.len = strlen(l_episode_type.arr);

				}


			   if (argc >= 17)
				{
						
				   strcpy(nd_reprint_yn.arr,argv[16]);
				   nd_reprint_yn.len = strlen(nd_reprint_yn.arr);

				}

			
				if (argc >= 18)
				{
				   
				   strcpy(nd_ws_no.arr,argv[17]);
				   nd_ws_no.len = strlen(nd_ws_no.arr);
				}

				 if(l_tier_arch==3)
				 {
					
					 strcpy(nd_facility_id.arr,argv[4]);
					 nd_facility_id.len  = strlen(nd_facility_id.arr);
					 nd_facility_id.arr[nd_facility_id.len] = '\0';
				 }
				 else
				 {
					 
					 
					 strcpy(nd_facility_id.arr,argv[8]);
					 nd_facility_id.len  = strlen(nd_facility_id.arr);
					 strcpy(g_facility_id,nd_facility_id.arr);
   					 nd_print_flag = argv[7][0];  
					 nd_facility_name.arr[0] = '\0';
					 nd_facility_name.len	 = 0;
				 }


			   /* Added by Raghava on 21/01/2008 as per CRF-0186 */

				 if (strcmp(nd_reportid.arr,"BLRRCPRT")==0)
				 {
					 if(l_tier_arch==3)
					 {
						strcpy(nd_detail_type_yn.arr,"N");
						nd_detail_type_yn.len  = strlen(nd_detail_type_yn.arr);
						strcpy(nd_option.arr,"A");
						nd_option.len  = strlen(nd_option.arr);
					 }
					 else
					 {
						 
						 strcpy(nd_detail_type_yn.arr,argv[18]);
						 nd_detail_type_yn.len  = strlen(nd_detail_type_yn.arr);
						 strcpy(nd_option.arr,argv[19]);
						 nd_option.len  = strlen(nd_option.arr);
					 }
				 }
				 else
				 {
					 
					 strcpy(nd_detail_type_yn.arr,"N");
					 nd_detail_type_yn.len  = strlen(nd_detail_type_yn.arr);
					 strcpy(nd_option.arr,"A");
					 nd_option.len  = strlen(nd_option.arr);

					 chk_instr_rec_exists();

				 }
				
				if (argc >= 21)
				{
				   
				   strcpy(nd_pmnt_ref_num.arr,argv[20]);
				   nd_pmnt_ref_num.len = strlen(nd_pmnt_ref_num.arr);

				   strcpy(nd_function_id.arr,argv[21]);
				   nd_function_id.len = strlen(nd_function_id.arr);
				}

	
      get_print_type();
	
	 
	/*
	 fetch_single_bill_foramt_bg();
	 if(nd_detail_type_yn.arr[0]=='Y')
	 {
	   //if(print_legend_dtl_rcpt.arr[0]=='Y' || print_legend_yn.arr[0]=='Y')
	   if(print_legend_dtl_rcpt.arr[0]=='Y')
	   nd_preprint_flag.arr[0]='N';
	   else
	   nd_preprint_flag.arr[0]='Y';
	 }
	 else
	 {
	   if(print_legend_yn.arr[0]=='Y')
       nd_preprint_flag.arr[0]='N';
	   else
	   nd_preprint_flag.arr[0]='Y';

	 }
	
    */



	 l_logo_yniflaser.arr[0] = 'N';
	 //get_logo_dtl(); 
	 //sprintf(l_mesg,"Dotmatrix : %d; Laser: %d",l_dmp,l_lsr);

	 	
	 get_left_margin();	
	 	
		
	/** added for crf-530**/
	if(strcmp(nd_reportid.arr,"BLR0014E")==0 || strcmp(nd_reportid.arr,"BLR0014C")==0 )
	get_param_for_Exemption();
	/**upto here***/
 

   /**CRF-0656 Changes**/
	get_Receipt_Format();
   /**upt here**/

		
	if ( strcmp(nd_receipt_format_id.arr,"1")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	{
		declare_oth_receipt_cur(); //added by raghava on 14/3/2008
			   
		 get_exemption_instr_print_text();

  	   fetch_legend_value();
	   get_hosp_name();

	   if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	   fetch_legend_value1(); //added by vani fro crf-530 Exemption Document
	
	   open_oth_receipt_cur();
	  
     }
	 
	 
	 //print_recpt();
	   print_hdr_cnt=0;
	 
	 //get_episode_type_desc();
/** The below code added by raghava at BKK for walk-through issue ****/ 
 //l_print_serv_item_yn.arr[0]='\0';
 //l_print_serv_item_yn.len=0;
 //l_print_grping_serv_yn.arr[0]='\0';
 //l_print_grping_serv_yn.len=0;
  if (l_lsr == 0 && l_dmp != 0) 
  {
 	 l_print_serv_item_yn.arr[0]='N';
	 l_print_grping_serv_yn.arr[0]='Y';
	 l_print_footer_each_page_yn.arr[0]='Y';  //Added by raghava on 01/07/2010 for UAT
  }
  else
  {
   	 l_print_serv_item_yn.arr[0]='Y';
	 l_print_grping_serv_yn.arr[0]='N';
	 l_print_footer_each_page_yn.arr[0]='N';  //Added by raghava on 01/07/2010 for UAT
  }
 //l_print_serv_item_yn.arr[l_print_serv_item_yn.len]='\0';
 //l_print_grping_serv_yn.arr[l_print_grping_serv_yn.len]='\0';
 /*** upto here *****/

if ( strcmp(nd_receipt_format_id.arr,"1")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
{

while (fetch_oth_receipt_cur())
 {
	 
	 l_rcpt_page_no=0;
	 d_exm_remark.arr[0]='\0';
	 d_exm_remark.len =0;
	
		/**ADDED FOR CRF-458.1 BY VANI****/

		if(strcmp(nd_pgm_id.arr,"BLRRCCOU")==0)
		payer_adjust_receipt_yn();

		/******UPTO HERE*******/

						
		if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
		{
			end_of_subsidy=0;
		    d_added_by_id.arr[0]='\0';
            d_added_by_id.len    =0;

			if(strcmp(nd_reportid.arr,"BLR0014C")==0)
			{
			 d_print_yn.arr[0] ='\0';
			 d_print_yn.len		=0;
			 d_reason.arr[0] ='\0';
			 d_reason.len               =0;
			 d_exm_reason_remarks.arr[0] ='\0';
			 d_exm_reason_remarks.len    =0;


			 EXEC SQL select PRINT_FLAG,REASON_CODE,REMARKS,AUTH_BY_ID
					  into :d_print_yn,:d_reason,:d_exm_reason_remarks,:d_added_by_id    
					  from BL_BILL_ADJ_HDR_CANC
					  where doc_type_code=:d_doc_type_code1
					  and doc_num		=:d_doc_number1;

				d_print_yn.arr[d_print_yn.len] = '\0';
				d_reason.arr[d_reason.len] = '\0';
				d_exm_reason_remarks.arr[d_exm_reason_remarks.len] = '\0';
		

			}
			if(strcmp(nd_reportid.arr,"BLR0014E")==0)
            {
			EXEC SQL select  STAGE_AUTH_BY_ID 
                 into :d_added_by_id
                 from  bl_exemption_track_dtls
                 where OPERATING_FACILITY_ID=:nd_facility_id
                 and exm_doc_type_code=:d_doc_type_code1
                 and exm_doc_num         =:d_doc_number1
                 and  NXT_EXEMPTION_STAGE_SEQ is null
                 and  status='A';

            }
          d_added_by_id.arr[d_added_by_id.len] = '\0';
			


		}

	  get_episode_type_desc();
	
	  //if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0 )
	  get_counter_location();

	  open_files();	 
	  
	  print_recpt();
	  
	  print_hdr_cnt=0;  

	  print_two_cnt=0;

	  print_deposit_header_flag=0;
 
	 /* Added by Raghava at 13/11/07 */	
  
	   if (l_lsr != 0 && l_dmp == 0)
		{

			if ( l_logo_yniflaser.arr[0] != 'Y')
			{
				fprintf(fp,"%c&a1L",ESC);    /* To Set the Left margin */ 
				fprintf(fp,"%c(s14H",ESC); 	 /* To set the font size   */	
	  		    //fprintf(fp,"%c(s3B",ESC);  /* To set Bold style      */	 
				fprintf(fp,"\n"); 
				line_no = line_no + 1; 
			}
		}
		else
		{
		    fprintf(fp,"%cg",ESC); 		      /* To Set compressed mode */
			fprintf(fp,"%c2",ESC); 		      /* To Set 1/6 LINE SPACING */
			//fprintf(fp,"%cp",ESC);
			//fprintf(fp,"%cSI",ESC); 		          /* To Set Font Size(12CPI) For Dotmatrix*/ 
			fprintf(fp,"\n");
			line_no = line_no + 1;
		}
			  	 	      	   
  	   declare_bills_receipt_cur();

	 	 
	  //This Condtion for printing Invoice Receipt 
	 if(strcmp(d_receipt_nature_code.arr,"AR")==0)
	  {
	     get_inv_type();
		 fetch_receipt_setup(2);
	   	 print_invoice_receipt();

	  }
	  else 
	  if( strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(d_receipt_nature_code.arr,"IN")==0 || strcmp(nd_pgm_id.arr,"BLREXMAD")==0 )
	  {
		//d_oth_receipt_amt=0;
                
		open_receipt_cur();

	    while(fetch_receipt_cur())
	    { 
		   
		  
		   print_hdr_cnt=print_hdr_cnt+1;
		   	
			
			   if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
			   {
				   
				   chk_multiple_rcpt_serv_list_yn();
				   /*** This code added by raghava for counting billing group if consilated receipt 06/01/2010****/
				   if (l_con_rcpt_yn.arr[0]=='Y' && strcmp(d3_bill_doc_type_code.arr,"\0")==0)
				   {
					chk_no_of_blng_grp();
					if(l_no_of_blng_grp>1)
					chk_rcpt_setup();	
					get_episode_type();
					get_sum_bills_amt();
				   }
				   /*** 06/01/2010 ***/
				}
				else
				{
					l_no_of_blng_grp=2;
					strcpy(l_con_rcpt_yn.arr,"Y");
					l_con_rcpt_yn.len=strlen(l_con_rcpt_yn.arr);
					l_con_rcpt_yn.arr[l_con_rcpt_yn.len] = '\0';
					chk_Exemption_setup();
					get_episode_type();
					get_Exemption_bills_amt();
						
				}
			
		
			
		    fetch_single_bill_foramt_bg();

			get_column_count_pat(); //28/04/2009
		    get_legends_cnt();
			
			if(nd_detail_type_yn.arr[0]=='Y')
			{
			   //if(print_legend_dtl_rcpt.arr[0]=='Y' || print_legend_yn.arr[0]=='Y')
			   if(print_legend_dtl_rcpt.arr[0]=='Y')
			   {
				   nd_preprint_flag.arr[0]='N';
				   //l_dmp=0;
				   //l_lsr=1;	
				   if(strcmp(l_receipt_doc_size.arr,"A4")==0) //added by raghava at BKK on 21/01/2010 ICN-322
				   MAX_LINES=65;
				   if(strcmp(l_receipt_doc_size.arr,"A5")==0)  //added by raghava at BKK on 21/01/2010
				   MAX_LINES=35;
			   }
			   else
			   {
				   nd_preprint_flag.arr[0]='Y';
				   //l_dmp=1;
				   //l_lsr=0;
				   if(strcmp(l_receipt_doc_size.arr,"A4")==0)		//added by raghava at BKK on 21/01/2010
				   MAX_LINES=65;								    //added by raghava at BKK on 21/01/2010
				   if(strcmp(l_receipt_doc_size.arr,"A5")==0)		//added by raghava at BKK on 21/01/2010
				   MAX_LINES=35;
			   }

			 }
			 else
			 {
			   if(print_legend_yn.arr[0]=='Y')
			   {
			     nd_preprint_flag.arr[0]='N';
				 //l_dmp=0;
				 //l_lsr=1;	
				   if(strcmp(l_receipt_doc_size.arr,"A4")==0) //added by raghava at BKK on 21/01/2010
				   MAX_LINES=65;
				   if(strcmp(l_receipt_doc_size.arr,"A5")==0)  //added by raghava at BKK on 21/01/2010
				   MAX_LINES=35;
			   }
			   else
			   {
			     nd_preprint_flag.arr[0]='Y';
				 //l_dmp=1;
				 //l_lsr=0;
				   if(strcmp(l_receipt_doc_size.arr,"A4")==0)		//added by raghava at BKK on 21/01/2010
				   MAX_LINES=63;								    //added by raghava at BKK on 21/01/2010
				   if(strcmp(l_receipt_doc_size.arr,"A5")==0)		//added by raghava at BKK on 21/01/2010
				   MAX_LINES=35;
			   }

			 }

	      
		  if (print_hdr_cnt==1) 
		  {

			if(nd_detail_type_yn.arr[0]=='N')
			{
					if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
					print_report_header();
					else
					print_header_exemption();

					if(strcmp(nd_preprint_flag.arr,"N")==0)
					{
						
						if( strcmp(c_print_separator_line.arr,"N")!=0)
						{
							if( lcol_cnt == 1)
							prt_line_uc();
							if(lcol_cnt == 2)
							prt_line_uc_wide();
							if(lcol_cnt == 3)
							prt_line_uc_wide1();
							fprintf(fp,"\n");lsr_line_cnt();
						}
					}
			}
			else
			{
					
				if((strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0) && strcmp(d_bill_format.arr,"B")== 0)
				{
              		if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
					print_report_header();
					else
					print_header_exemption();

					if(strcmp(nd_preprint_flag.arr,"N")==0)
					{
					    if( strcmp(c_print_separator_line.arr,"N")!=0)
						{
							if( lcol_cnt == 1)
							prt_line_uc();
							if(lcol_cnt == 2)
							prt_line_uc_wide();
							if(lcol_cnt == 3)
							prt_line_uc_wide1();
							fprintf(fp,"\n");lsr_line_cnt();
					    }
					}

				}
		    }
		  
		  }
			
			/* This Condition added by raghava on 23/05/2008 against SCF-1733.2 */
			/* If any Subsidy Bill is there then it will print one line Receipt format as Subsidy Amount*/		
			if (strcmp(d_bill_format.arr,"S")== 0 && strcmp(d_receipt_nature_code.arr,"IN")!=0 && d_adj_payer_dist_amt==0)
			{
			   
				 if(end_of_subsidy!=1)
				 print_subsidy();
				 
			}
			/*upto here*/
			/* This IF Condition will Execute when patient Settled Full */
			
			//sprintf(st_var,"%d",end_of_subsidy);
			//disp_message(ERR_MESG,st_var);

			if(end_of_subsidy!=1)
			if( (strcmp(d_bill_format.arr,"B")== 0 && strcmp(d_receipt_nature_code.arr,"IN")!=0) || d_adj_payer_dist_amt!=0 || strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
			{	
			   	   		
				if(strcmp(nd_preprint_flag.arr,"N")==0)
				{
					if(nd_detail_type_yn.arr[0]=='N')
					{
					  if( (l_con_rcpt_yn.arr[0]=='N' && strcmp(d3_bill_doc_type_code.arr,"\0")==0)||
					      strcmp(d3_bill_doc_type_code.arr,"\0")!=0)
					  { 
						if (l_lsr != 0 && l_dmp == 0)  //Added by raghava at BKK for CRF-561
						{
						 fprintf(fp," %-7.7s :",loc_legend11.arr);
						 fprintf(fp," %-s%1s%-10s \n",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					    }
						if( strcmp(c_print_separator_line.arr,"N")!=0)
						{
							if( lcol_cnt == 1)
							prt_line_uc();
							if(lcol_cnt == 2)
							prt_line_uc_wide();
							if(lcol_cnt == 3)
							prt_line_uc_wide1();
						}
						//fprintf(fp,"\n");lsr_line_cnt();
					 }
					}
				}
			    if(strcmp(nd_preprint_flag.arr,"N")==0 && strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
                {
				 //fprintf(fp,"\n%-7.7s%-44.44s (%-s %-s%-s"," "," ",loc_legend67.arr,cur_str.arr,")");	
				 if ((l_lsr != 0 && l_dmp == 0)|| nd_detail_type_yn.arr[0]=='Y')  //Added by raghava at BKK for CRF-561
				 {
				  fprintf(fp,"\n%-7.7s%44.44s %-s%-s"," ",loc_legend1401.arr,cur_str.arr,")");	
				  line_no = line_no + 1;
				 }
				}
				
				call_bill_print();

				if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
				end_of_subsidy=1;

				if(strcmp(nd_preprint_flag.arr,"N")==0)
				{
					if( strcmp(c_print_separator_line.arr,"N")!=0)
					{
						if( lcol_cnt == 1)
						prt_line_uc();
						if(lcol_cnt == 2)
						prt_line_uc_wide();
						if(lcol_cnt == 3)
						prt_line_uc_wide1();
						fprintf(fp,"\n");
						line_no = line_no + 1;
					}
				}
							
				//if(l_receipt_type==1)	
		        //d_oth_receipt_amt=nd_partial_settled_amt+nd_grnd_total;
				
					 
			 }
			
			else
			if(nd_detail_type_yn.arr[0]=='N')
			{
			   
			   /* This is for Installment printing */
			  			  			  
			   if(strcmp(d_receipt_nature_code.arr,"IN")==0)
			   {
				 
			  		get_agg_type_code();
					get_inst_nums();
					if(strcmp(nd_preprint_flag.arr,"N")==0)
					{
					 if (l_lsr != 0 && l_dmp == 0)
					 {
					  if(legend_cnt==1)
					  {
					   //fprintf(fp,"%-7.7s%-60.60s (%-s %-s%-s\n"," ",loc_legend110.arr,loc_legend67.arr,cur_str.arr,")");	
			  		   fprintf(fp,"%-7.7s%-60.60s (%-s%-s\n"," ",loc_legend110.arr,cur_str.arr,")");	
					   fprintf(fp," %-7.7s :",loc_legend11.arr);
					   fprintf(fp," %-6s%1s%-10s  ",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   fprintf(fp,"%-32.32s%12.12s   %16.16s\n"," "," ",loc_legend69.arr);
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
			   		   prt_line_uc();
					  }
					  else
					  {
					     //fprintf(fp,"%-7.7s%-60.60s (%-s %-s%-s\n"," ",loc_legend110.arr,loc_legend67.arr,cur_str.arr,")");	
			  		   fprintf(fp,"%-7.7s%-60.60s (%-s%-s\n"," ",loc_legend110.arr,cur_str.arr,")");	
					   fprintf(fp," %-7.7s :",loc_legend11.arr);
					   fprintf(fp," %-6s%1s%-10s  ",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   fprintf(fp,"%-32.32s%12.12s   %16.16s\n"," ",loc_legend82.arr,loc_legend83.arr);
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
			   		   prt_line_uc();
					  }
					 }
					 if (l_lsr == 0 && l_dmp!= 0)
					 {
					  if(legend_cnt==1)
					  {
					   //fprintf(fp,"%-7.7s%-60.60s (%-s%-s\n"," ",loc_legend110.arr,cur_str.arr,")");	
					   //fprintf(fp," %-7.7s :",loc_legend11.arr);
					   //fprintf(fp," %-6s%1s%-10s  ",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   fprintf(fp,"\n");
					   fprintf(fp,"%-7.7s %-55.55s%12.12s   %16.16s\n"," ",loc_legend110.arr," ",loc_legend69.arr);
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
			   		   prt_line_uc();
					  }
					  else
					  {
					   //fprintf(fp,"%-7.7s%-60.60s (%-s%-s\n"," ",loc_legend110.arr,cur_str.arr,")");	
					   //fprintf(fp," %-7.7s :",loc_legend11.arr);
					   //fprintf(fp," %-6s%1s%-10s  ",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   fprintf(fp,"\n");
					   fprintf(fp,"%-7.7s %-55.55s%12.12s   %16.16s\n"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
			   		   prt_line_uc();

					  }
					  line_no = line_no + 1;

					 }				
					}
					else
					{
					 fprintf(fp,"\n");
					}
					fprintf(fp,"\n");
					fprintf(fp," %-76.76s ",sub_print_text1.arr);
					print_formated_amt(d_settled_amt);
					fprintf(fp,"\n");
					fprintf(fp," (%-s: ",loc_legend64.arr);
					fprintf(fp," %-s/%-s)",nd_aggr_doc_type_code.arr,nd_aggr_doc_num.arr);
					//nd_partial_settled_amt=nd_partial_settled_amt+d_settled_amt;
											
					line_no = line_no + 3;
					fprintf(fp,"\n\n");
					line_no = line_no + 2;
					if(strcmp(nd_preprint_flag.arr,"N")==0)
					fprintf(fp," %-s ",loc_legend1460.arr);
					else
					fprintf(fp," %-s "," ");
					fprintf(fp,"%-s",nd_aggr_inst_no.arr);
					fprintf(fp,"\n");
				    line_no = line_no + 1;

				    if(strcmp(nd_preprint_flag.arr,"N")==0)
					if( strcmp(c_print_separator_line.arr,"N")!=0)
				    prt_line_uc();

				    fprintf(fp,"\n");
				    line_no = line_no + 1;

				   	/*** The below Code added by raghava at BKK for CRF-561 ***/

					if (l_lsr== 0 && l_dmp!= 0)
					{
					 if(strcmp(l_receipt_doc_size.arr,"A4")==0) 
					 {
					  while(v_lno <= (MAX_LINES-20))
					  {
						fprintf(fp,"\n");//08/03/2010
						v_lno++;
					  }
					 }
					}
				    /*** BKK for CRF-561 ***/	


                  /* For Printing Total and Grand Total Amt */
				
				  if(nd_detail_type_yn.arr[0]=='N' && strcmp(d_bill_format.arr,"B")!=0)
				  {
					if (l_lsr!= 0 && l_dmp== 0)
					{ 
					  fprintf(fp," %-59.59s",loc_legend68.arr);
					  print_formated_amt(d_oth_receipt_amt);
					  fprintf(fp,"\n");
					  fprintf(fp," %-59.59s",loc_legend54.arr);
					  //print_gd_tot_amt =print_gd_tot_amt+nd_net_pay_pat+nd_partial_settled_amt+d_oth_receipt_amt;
					  //print_gd_tot_amt =print_gd_tot_amt+d_oth_receipt_amt;
					  print_formated_amt(d_oth_receipt_amt);
					  line_no = line_no + 1;
					}
					/**** The below code added by raghava at BKK on 21/01/2010 *****/
					if (l_lsr== 0 && l_dmp!= 0)
					{
					  if(strcmp(nd_preprint_flag.arr,"N")==0)
					  {
					   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
					   fprintf(fp," %-77.77s",loc_legend68.arr);
					   fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
					   print_formated_amt(d_oth_receipt_amt);
					   fprintf(fp,"\n");
					   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
					   fprintf(fp," %-66.66s",loc_legend54.arr);
					   print_formated_amt(d_oth_receipt_amt);
					   fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
					   line_no = line_no + 1;
					  }
					  else
					  {
					   fprintf(fp," %-77.77s"," ");
					   print_formated_amt(d_oth_receipt_amt);
					   fprintf(fp,"\n");
					   fprintf(fp," %-66.66s"," ");
					   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
					   print_formated_amt(d_oth_receipt_amt);
					   fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
					   line_no = line_no + 1;
					  }
					}
					/****upto here ********/
				  }
				 fprintf(fp,"\n");
				 lsr_line_cnt();

				

			   }
			  
			  /* This will print when Exemption case and partial payment case*/
              
			  else 
			  //if(strcmp(d_exempted_bill_yn.arr,"Y")==0)
			   {
				   
				   strcpy(nd_exempted_bill_yn.arr,d_exempted_bill_yn.arr);   
			 
			
				   if(strcmp(nd_preprint_flag.arr,"N")==0)
				   {
					  
					   fprintf(fp," %-7.7s :",loc_legend11.arr);
					   fprintf(fp," %-6s%1s%-10s  \n",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
					   {
					   prt_line_uc();fprintf(fp,"\n");	
					   }
					
					   if(legend_cnt==2||legend_cnt==0)
					   {
					   
						   //fprintf(fp,"%-51.51s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
						   fprintf(fp,"%51.51s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
						   fprintf(fp,"%-45.45s%12.12s   %16.16s\n",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
						   

					   }
					   else
					   {
						   //fprintf(fp,"%-67.67s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
						   fprintf(fp,"%67.67s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
						   fprintf(fp,"%-62.62s%12.12s   %16.16s\n",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
						   
					   }
					   if( strcmp(c_print_separator_line.arr,"N")!=0)
					   prt_line_uc();


				   }
				   fprintf(fp,"\n");
				   if(legend_cnt==2||legend_cnt==0)
				   {
				
					   if(strcmp(nd_preprint_flag.arr,"N")==0)
					   fprintf(fp," %-7.7s (%-s%-s %45.45s ",sub_print_text.arr,nd_episode_type.arr,")"," ");
					   else
					   fprintf(fp," %-7.7s (%-s%-s(%-7.7s: %-6s%1s%-10s%-s%18.18s ",sub_print_text.arr,nd_episode_type.arr,")",loc_legend11.arr,d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr,")"," ");
					   
					   print_formated_amt(d_settled_amt);
				   }
				   else
				   {
					   
					   fprintf(fp," %-7.7s (%-s%-s %64.64s ",sub_print_text.arr,nd_episode_type.arr,")"," ");
					   print_formated_amt(d_settled_amt);
				   }
				  
				   fprintf(fp,"\n");
				   if(strcmp(nd_preprint_flag.arr,"N")==0)
				   if( strcmp(c_print_separator_line.arr,"N")!=0)
				   prt_line_uc();
				   fprintf(fp,"\n");
				   nd_partial_settled_amt=nd_partial_settled_amt+d_settled_amt;
				   line_no = line_no + 3;


				   if(legend_cnt==2||legend_cnt==0)
				   {
					   fprintf(fp," %-59.59s",loc_legend68.arr);
					   print_formated_amt(d_settled_amt);
					   fprintf(fp,"\n");
					   fprintf(fp," %-59.59s",loc_legend54.arr);
					   print_formated_amt(d_settled_amt);
				   }
				   else
				   {
					   fprintf(fp,"%73.73s      ",loc_legend68.arr);
					   print_formated_amt(d_settled_amt);
					   fprintf(fp,"\n");
					   fprintf(fp,"%79.79s",loc_legend54.arr);
					   print_formated_amt(d_settled_amt);
				   }
				   
				 
				   			   
			   }
 	   		   
			   /* This will execute when patient will settled partially  
			   else
			   {
			   	   line_no=v_lno;	
				   
				     			   
				   if(strcmp(nd_preprint_flag.arr,"N")==0)
				   {
					  
					   fprintf(fp," %-7.7s :",loc_legend11.arr);
					   fprintf(fp," %-6s%1s%-10s  \n",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
					   prt_line_uc();fprintf(fp,"\n");	
					
					   if(legend_cnt==2||legend_cnt==0)
					   {
					   
						   //fprintf(fp,"%-51.51s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
						   fprintf(fp,"%51.51s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
					   	   fprintf(fp,"%-45.45s%12.12s   %16.16s\n",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
				
					   }
					   else
					   {
						   //fprintf(fp,"%-67.67s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
						   fprintf(fp,"%67.67s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
					 	   fprintf(fp,"%-62.62s%12.12s   %16.16s\n",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
						   
					   }
					   prt_line_uc();


				   }
			
				   fprintf(fp,"\n");
				   if(legend_cnt==2||legend_cnt==0)
				   {
					   if(strcmp(nd_preprint_flag.arr,"N")==0)
					   fprintf(fp," %-7.7s (%-s%-s %45.45s ",sub_print_text.arr,nd_episode_type.arr,")"," ");
					   else
					   fprintf(fp," %-7.7s (%-s%-s(%-7.7s: %-6s%1s%-10s%-s%18.18s ",sub_print_text.arr,nd_episode_type.arr,")",loc_legend11.arr,d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr,")"," ");
					   print_formated_amt(d_settled_amt);
				   }
				   else
				   {
					   fprintf(fp," %-7.7s (%-s%-s %64.64s ",sub_print_text.arr,nd_episode_type.arr,")"," ");
					   print_formated_amt(d_settled_amt);
				   }
				  
				   fprintf(fp,"\n");
				   if(strcmp(nd_preprint_flag.arr,"N")==0)
				   prt_line_uc();
				   fprintf(fp,"\n");
				   nd_partial_settled_amt=nd_partial_settled_amt+d_settled_amt;
				   line_no = line_no + 5;
				   if(legend_cnt==2||legend_cnt==0)
				   {
					   
					   fprintf(fp," %-59.59s",loc_legend68.arr);
					   print_formated_amt(d_settled_amt);
					   fprintf(fp,"\n");
					   fprintf(fp," %-59.59s",loc_legend54.arr);
					   print_formated_amt(d_settled_amt);
				   }
				   else
				   {
					  
					   fprintf(fp,"%73.73s      ",loc_legend68.arr);
					   print_formated_amt(d_settled_amt);
					   fprintf(fp,"\n");
					   fprintf(fp,"%79.79s",loc_legend54.arr);
					   print_formated_amt(d_settled_amt);
				   }
				   
				  
			   }
				
			   
			   fprintf(fp,"\n");
			   if(strcmp(nd_preprint_flag.arr,"N")==0)
			   if( strcmp(c_print_separator_line.arr,"N")!=0)
			   prt_line_uc();
			   fprintf(fp,"\n");
			   line_no = line_no + 2;
			  */
			   
			
           }

	     }// inner while end braces

			
		  fprintf(fp,"\n");
		  lsr_line_cnt();
		  close_receipt_cur();
		  end_of_subsidy=0;	 

	 }//if condition end braces
	
     else
	 {
	   	 /* Added by raghava on 14/3/2008 FOR PRINTING DEPOSIT SLIP SEPERATLY */

		 if(d_ref_dep_doc_type_code.arr[0]=='\0' && d_ref_dep_doc_number.arr[0]=='\0')
		 {
		   fetch_receipt_setup(1);
		   if(nd_option.arr[0]=='A') 
	       print_deposit_slip();
         }
		 /* UP TO HERE */
		else
	    {
		  d_oth_rec_desc.arr[0] = '\0';
		  d_oth_rec_desc.len    =   0 ;

		  EXEC SQL SELECT   SHORT_DESC 
				   INTO    :d_oth_rec_desc 
				   FROM     BL_RECEIPT_TYPE_LANG_VW
				   WHERE    RECEIPT_TYPE_CODE =:d_receipt_type_code
				   AND      RECPT_NATURE_CODE =:d_receipt_nature_code
				   AND      LANGUAGE_ID       =:nd_lang_id;

		  d_oth_rec_desc.arr[d_oth_rec_desc.len] =0;

		  print_hdr_cnt=print_hdr_cnt+1;

		  if (print_hdr_cnt==1) 
		  {
				print_report_header();
				if(strcmp(nd_preprint_flag.arr,"N")==0)
				prt_line_uc();
				fprintf(fp,"\n");
			
		  }
        
		 fprintf(fp,"%45.45s ",d_oth_rec_desc.arr);
		 print_formated_amt(d_oth_receipt_amt);
		 fprintf(fp,"\n\n");

		 }
		
	 }// else end braces
		
    
/***11793 from here added by vani  ***/
/***** Printing the Amount in words ******/
if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
{


			    if(nd_detail_type_yn.arr[0]=='N')
				{
				  if (l_lsr!= 0 && l_dmp== 0)
				  {
					fprintf(fp,"%c(s3B",ESC);
					if(d_oth_receipt_amt<0)
					fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					else
					fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					
					  fun_amt_in_words();
					  fprintf(fp,"%s ","(");
					  fprintf(fp,"%-s",amt_in_words_Sep.arr);
					  fprintf(fp,"%s",")");
					  fprintf(fp,"%c(s-3B",ESC);
					  fprintf(fp,"\n");
					  lsr_line_cnt();lsr_line_cnt();
				  }
				  else
				  {
				   if(strcmp(nd_preprint_flag.arr,"N")==0)
				   {
				  
				  	if(d_oth_receipt_amt<0)
					fprintf(fp,"%s(%-s%-s: ",loc_legend1447.arr,loc_legend1423.arr,")");
					else
					fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					fun_amt_in_words();
					fprintf(fp,"%s ","(");
					fprintf(fp,"%-s",amt_in_words_Sep.arr);
					fprintf(fp,"%s",")");
					fprintf(fp,"\n");
					lsr_line_cnt();
				   }
				   else
				   {
					fprintf(fp,"%-18.18s: "," ");
					fun_amt_in_words();
					fprintf(fp,"%s ","(");
					fprintf(fp,"%-s",amt_in_words_Sep.arr);
					fprintf(fp,"%s",")");
					fprintf(fp,"\n");
					lsr_line_cnt();
				   }
				  }
				}
				else
				{
				if(strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0)
				 {
				   if (l_lsr!= 0 && l_dmp== 0)
				   {
					if(d_oth_receipt_amt<0)
					fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					else
					fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
				    fun_amt_in_words();
					fprintf(fp,"%s ","(");
					fprintf(fp,"%-s",amt_in_words_Sep.arr);
					fprintf(fp,"%s",")");
					fprintf(fp,"\n");
					lsr_line_cnt();
				  }
				  if (l_lsr== 0 && l_dmp!= 0)
				  {
					if(strcmp(nd_preprint_flag.arr,"N")==0)
					{
					 if(d_oth_receipt_amt<0)
				     fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					 else
					 fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend1423.arr,")");
					 fun_amt_in_words();
					 fprintf(fp,"%s ","(");
					 fprintf(fp,"%-s",amt_in_words_Sep.arr);
					 fprintf(fp,"%s",")");
					 fprintf(fp,"\n");
					 lsr_line_cnt();	
				    }
					else
					{
					 fprintf(fp,"%-18.18s: "," ");
				     fun_amt_in_words();
					 fprintf(fp,"%s ","(");
					 fprintf(fp,"%-s",amt_in_words_Sep.arr);
					 fprintf(fp,"%s",")");
					 fprintf(fp,"\n");
					 lsr_line_cnt();
					}
				  }
				 }

				} 


				 if(nd_option.arr[0]=='A') 
				 {
				  /*
				  if ( strcmp(d_receipt_nature_code.arr,"BI")!=0 && strcmp(d_receipt_nature_code.arr,"DC")!=0 &&
					   strcmp(d_receipt_nature_code.arr,"AR")!=0 && strcmp(d_receipt_nature_code.arr,"IN")!=0 )	  
				  {
				   
				   if(d_oth_receipt_amt>0)
				   {
				    fun_payment_det1();
				    fprintf(fp,"\n");
				    lsr_line_cnt();
				   }
				  }
				  */
				 
				  //if(strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || 
				     //strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(d_receipt_nature_code.arr,"IN")==0 )
				  //{
					 //if(d_oth_receipt_amt>0)
					 //{
					   fun_payment_det1();
					   fprintf(fp,"\n");
					   lsr_line_cnt();
					 //}
				  //}
				 
				 }
				
				/*if(nd_option.arr[0]=='A') 
				 {
				  fun_payment_det();
				  fprintf(fp,"\n");
				  lsr_line_cnt();
				 }*/ //11793_RESEND


				 /***11793 upto here**/

	if(nd_detail_type_yn.arr[0]=='N')
	{
				
				/*if(d_oth_receipt_amt<0)
				fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend91.arr,")");
				else
				fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend90.arr,")"); */ //11793
				
				/* THIS IS FOR PRINTING AMOUNT IN WORDS */

				/*	
				if(d_oth_receipt_amt<0)
				no_of_lines = print_in_words(-1*d_oth_receipt_amt,LENGTH_WORDS,sub_cur_str.arr,amt_in_words,nd_no_of_decimal);
				else
				no_of_lines = print_in_words(d_oth_receipt_amt,LENGTH_WORDS,sub_cur_str.arr,amt_in_words,nd_no_of_decimal);
				
				fprintf(fp,"(%s ",cur_str.arr);
  
				for (i =0;i<no_of_lines;i++)
				{
   				 
				 no_of_char=no_of_char+strlen(amt_in_words[i]);
   				 if(no_of_char>=70)
				 {
				   fprintf(fp,"\n%-32.32s"," ");
				   no_of_char=0;
				  }
				  fprintf(fp," %s",amt_in_words[i]);
				 
				 }
				 commented by raghava on 5/1/2009 b/z now we are calling new function for printing amt in words
				 */

				  /*fun_amt_in_words();
				  fprintf(fp,"%s ","(");
				  fprintf(fp," %s",amt_in_words_Sep.arr);
				  fprintf(fp,"%s",")");
				  fprintf(fp,"\n\n");
				  lsr_line_cnt();lsr_line_cnt();*/ //11793
	 



	/* FOR PRINTING SIGNATURE */
	  
	  get_cashier_name();
	  get_cashier_designation();

	  if(nd_option.arr[0]=='A')
	  {
	    strcpy(dep_filename,WORKING_DIR);
		strcat(dep_filename,"blrdepos.lis");
      /*** Need to modify here for fixing footer 4 each page **/
	   	 if(strcmp(filename,dep_filename)!=0)
		 {
		 //fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s",loc_legend56.arr,loc_legend57.arr,loc_legend63_rc.arr);
		  if (l_lsr!= 0 && l_dmp== 0)
		  fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s"," ",loc_legend57.arr,loc_legend63_rc.arr);
		  if (l_lsr== 0 && l_dmp!= 0)
		  {
		   if(strcmp(nd_preprint_flag.arr,"N")==0) 
		   {
		    if (d_oth_receipt_amt>=0)
			fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s"," ",loc_legend57.arr,loc_legend63_rc.arr);
			else
			fprintf(fp,"%-27.27s %23.23s---------------------------- "," ",loc_legend57.arr);
           }

		  }
		 
		
		 
		 }
		 else
		 {
			 if (l_lsr!= 0 && l_dmp== 0)
			 {
			  fprintf(fp,"%c(s3B",ESC);
			  if (d_oth_receipt_amt>=0)
			  fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend63_rc.arr);
			  else
			  fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend57.arr);
			  fprintf(fp,"%c(s-3B",ESC);
			 }
			 else
			 {
			  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			  if (d_oth_receipt_amt>=0)
			  fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend63_rc.arr);
			  else
			  fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend57.arr);
			  fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
			 }
		 
	
		 }

	  }
  	  else
	  fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s"," ",loc_legend57.arr,loc_legend63_rc.arr);
      fprintf(fp,"\n");lsr_line_cnt();
	  if(print_deposit_header_flag)
	  {
	    fun_centre(nd_cashier_name.arr,40);    //The below code added by raghava at BKK on 15/01/2010 
	    fprintf(fp," %-60.60s (%-s%-s"," ",nd_cashier_name.arr,")");
	  }
	  else
	  fprintf(fp," %-57.57s (%-s%-s"," ",nd_cashier_name.arr,")");
	  fprintf(fp,"\n");lsr_line_cnt();
	  
     //Added By Raghava on 18/03/2008 for Deposit Slip
     if(print_deposit_header_flag)
	 {		
		    if (strcmp(nd_cahier_position.arr,"\0")!=0)
		    fprintf(fp," %70.70s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);
			else
	        fprintf(fp,"\n");

		  if (d_oth_receipt_amt>=0)
		  {
			if (l_lsr!= 0 && l_dmp== 0)
			{
			fprintf(fp,"%c(s3B",ESC);
			fprintf(fp,"%-10.10s: ",loc_legend120.arr);
			fprintf(fp,"%c(s-3B",ESC);
		    fprintf(fp,"%-s\n",loc_legend108.arr);
		    fprintf(fp,"%-10.10s  %-60.60s\n"," ",loc_legend109.arr);
		   }
		   else
		   {
			fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			fprintf(fp,"%-10.10s: ",loc_legend120.arr);
			fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
			fprintf(fp,"%-s\n",loc_legend108.arr);
		    fprintf(fp,"%-6.6s  %-s\n"," ",loc_legend109.arr);
		   }

		  }
		  else
		  {
		  if (l_lsr!= 0 && l_dmp== 0)
		  {
			fprintf(fp,"%c(s3B",ESC);
			fprintf(fp,"%-10.10s: ",loc_legend120.arr);
			fprintf(fp,"%c(s-3B",ESC);
		    fprintf(fp,"%-s\n",loc_legend1370.arr);
		   }
		   else
		   {
		   	fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			fprintf(fp,"%-10.10s: ",loc_legend120.arr);
			fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
			fprintf(fp,"%-s\n",loc_legend1370.arr);
		   }
		  }

	  }
	 else
	 {
	  if (strcmp(nd_cahier_position.arr,"\0")!=0)
	  {
	   if(l_lsr== 0 && l_dmp!= 0)
	   {
	    if(strcmp(nd_preprint_flag.arr,"N")==0) 
		fprintf(fp," %58.58s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);
		else
		fprintf(fp," %58.58s %-60.60s\n"," ",nd_cahier_position.arr);

	   }
	   else
	   fprintf(fp," %58.58s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);
	  }
	 }

		//if(nd_sys_date.arr[0]!='\0')
		if (nd_sys_date.arr[0]=='\0')//--Leap Year Changes for SCF 9445  by sarvinder
		{
		 init_date_temp_var();
		 strcpy(date_convert.arr,nd_sys_date.arr);
		 fun_change_loc_date1();
		 strcpy(nd_sys_date.arr,nd_loc_date1.arr);
        }
		 if(curr_date.arr[0]!='\0')
		 {
		  init_date_temp_var();
		  strcpy(date_convert.arr,curr_date.arr);
		  fun_change_loc_date4();
		  strcpy(curr_date.arr,nd_loc_date1.arr);
		  }

	  
	  /*****if(strcmp(d_print_yn.arr,"Y")==0)
      if(print_deposit_header_flag)
	  fprintf(fp,"%13.13s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);
	  else
	  fprintf(fp,"%80.80s %18s",loc_legend62.arr,curr_date.arr);
	  fprintf(fp,"\n\n%-80.80s%-s%d\n"," ",loc_legend210.arr,page_no); 
	  page_no=1;
	  printf(fp,"%-50.50s",loc_legend56.arr); // credit
      fprintf(fp,"\n");// cash 
	  printf(fp,"%75s %-30.30s"," ",loc_legend58.arr); 
      fprintf(fp,"\n");//cheque
	  fprintf(fp,"\f");
	  fprintf(fp,"\n");****/  //11793
	  
	  
	  strcpy(dep_filename,WORKING_DIR);
	  strcat(dep_filename,"blrdepos.lis");


	  if(strcmp(filename,dep_filename)==0)
	  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
      else
	  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
	  
  
  }
  else
  if(strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0)
  {

	/*if(d_oth_receipt_amt<0)
    fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend91.arr,")");
	else
    fprintf(fp,"%s(%-s%-s: ",loc_legend55.arr,loc_legend90.arr,")");*/ //11793
	
	/* THIS IS FOR PRINTING AMOUNT IN WORDS */

	/*	
	if(d_oth_receipt_amt<0)
	no_of_lines = print_in_words(-1*d_oth_receipt_amt,LENGTH_WORDS,sub_cur_str.arr,amt_in_words,nd_no_of_decimal);
	else
	no_of_lines = print_in_words(d_oth_receipt_amt,LENGTH_WORDS,sub_cur_str.arr,amt_in_words,nd_no_of_decimal);
	
	fprintf(fp,"(%s ",cur_str.arr);
		
  	for (i =0;i<no_of_lines;i++)
	{

   	  no_of_char=no_of_char+strlen(amt_in_words[i]);
     
	  if(no_of_char>=70)
	  {
	   fprintf(fp,"\n%-32.32s"," ");
	   no_of_char=0;
	  }
	
	  fprintf(fp," %s",amt_in_words[i]);
	 
	 }
	 */

	 /*fun_amt_in_words();
	  fprintf(fp,"%s ","(");
	  fprintf(fp," %s",amt_in_words_Sep.arr);
	  fprintf(fp,"%s",")");
	  fprintf(fp,"\n\n");
	  lsr_line_cnt();lsr_line_cnt();*/  //11793

	  
	 
	/* FOR PRINTING SIGNATURE */
	  
	  get_cashier_name();
	  get_cashier_designation();

	  strcpy(dep_filename,WORKING_DIR);
	  strcat(dep_filename,"blrdepos.lis");

	   	 if(strcmp(filename,dep_filename)!=0)
		 {

	   	 //fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s",loc_legend56.arr,loc_legend57.arr,loc_legend63_rc.arr);
		  if(strcmp(nd_preprint_flag.arr,"N")==0) 
		  if (l_lsr != 0 && l_dmp == 0)
		  fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s"," ",loc_legend57.arr,loc_legend63_rc.arr);
		  if (l_lsr == 0 && l_dmp!= 0)
		  {
		   if(strcmp(nd_preprint_flag.arr,"N")==0)
		   {
			fprintf(fp,"%-27.27s %23.23s---------------------------- %-28.28s"," ",loc_legend57.arr,loc_legend63_rc.arr);
		   }
		  }
		 }
		 else
		 {
		 if (l_lsr!= 0 && l_dmp== 0)
		 {
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend63_rc.arr);
		 fprintf(fp,"%c(s-3B",ESC);
		 }
		 else
		 {
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"%-45.45s %28.28s----------------------------"," ",loc_legend63_rc.arr);
		 fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
		 }
		 }

      fprintf(fp,"\n");lsr_line_cnt();
	  //fun_centre_sign(nd_cashier_name.arr,20);    //The below code added by raghava at BKK on 15/01/2010 
	  fprintf(fp," %-55.55s (%-s%-s"," ",nd_cashier_name.arr,")");
	  fprintf(fp,"\n");lsr_line_cnt();
	  
     //Added By Raghava on 18/03/2008 for Deposit Slip
     if(print_deposit_header_flag)
	 {
		   if (strcmp(nd_cahier_position.arr,"\0")!=0)
	        fprintf(fp," %58.58s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);

		  if (d_oth_receipt_amt>=0)
		  {
		   fprintf(fp,"%-6.6s: %-60.60s\n",loc_legend120.arr,loc_legend108.arr);
		   fprintf(fp,"%-6.6s  %-s"," ",loc_legend109.arr);
		  }
		  else
		  {
		   fprintf(fp,"%-6.6s: %-60.60s\n",loc_legend120.arr,loc_legend1370.arr);
		  }

	  }
	 else
	 {
	 if (strcmp(nd_cahier_position.arr,"\0")!=0)
	 {
	  if(l_lsr== 0 && l_dmp!= 0)
	  {
	   if(strcmp(nd_preprint_flag.arr,"N")==0)
	   fprintf(fp," %58.58s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);
	   else
	   fprintf(fp," %58.58s %-60.60s\n",loc_legend66.arr,nd_cahier_position.arr);
	  }
	  else
	  fprintf(fp," %58.58s %-60.60s\n"," ",nd_cahier_position.arr);
	 }
	}
	  	
	if(nd_sys_date.arr[0]!='\0')
	{
	 init_date_temp_var();
	 strcpy(date_convert.arr,nd_sys_date.arr);
	 fun_change_loc_date1();
	 strcpy(nd_sys_date.arr,nd_loc_date1.arr);
	}
	 
	 if(curr_date.arr[0]!='\0')
	 {
	  init_date_temp_var();
	  strcpy(date_convert.arr,curr_date.arr);
	  fun_change_loc_date4();
	  strcpy(curr_date.arr,nd_loc_date1.arr);
	  }	

	 if (l_lsr == 0 && l_dmp != 0)
	 {
		  /****
		  if(strcmp(d_print_yn.arr,"Y")==0)
		  if(print_deposit_header_flag)
		  fprintf(fp,"%13.13s %18s",loc_legend62.arr,curr_date.arr);
		  else
		  fprintf(fp,"%80.80s %18s"," ",loc_legend62.arr,curr_date.arr);
		  fprintf(fp,"\n\n%-80.80s%-s%d\n"," ",loc_legend210.arr,page_no);  //11793 
		  page_no=1;
		  if(strcmp(filename,dep_filename)!=0)
		  {
		   printf(fp,"%-50.50s",loc_legend56.arr); // credit
		  }
		  fprintf(fp,"\n");// cash 
		  printf(fp,"%75s %-30.30s"," ",loc_legend58.arr); 
		  fprintf(fp,"\n");//cheque
		  //fprintf(fp,"\f"); 
		  fprintf(fp,"\n"); **/ //11793
	  
	
		  strcpy(dep_filename,WORKING_DIR);
	      strcat(dep_filename,"blrdepos.lis");

		  if(strcmp(filename,dep_filename)==0)
		  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
		  else
		  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
	
	}
	else
	{
	      strcpy(dep_filename,WORKING_DIR);
	      strcat(dep_filename,"blrdepos.lis");

		  if(strcmp(filename,dep_filename)==0)
		  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
		  else
		  fprintf(fp,"%64.64s %18s %s",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);   //11793
		  
	  //fprintf(fp,"%13.13s %18s\n",loc_legend62.arr,curr_date.arr); commented by raghava on 02/08/2010 for UAT
	}


  }

 fprintf(fp,"\n");
 fprintf(fp,""); /* To Eject Page */  
  	  
fflush(fp); //Added on 20/3/2008
fclose(fp); //Added on 20/3/2008
      
}
else
{
	print_two_cnt=print_two_cnt+1;
	print_cnt=print_cnt+1;

	Print_footer();
	get_cashier_name();
	get_cashier_designation1();
	get_uesr_position();
	get_prepare_by();

   /* Commented by raghava at BKK for Walk-through correction
	if(strcmp(nd_reportid.arr,"BLR0014E")==0)
	{
	 
	 fprintf(fp,"\n\n  %-13.13s:------------------ %-20.20s %-10.10s:-------------------",loc_legend[18]," ",loc_legend[13]);
	}

	if(strcmp(nd_reportid.arr,"BLR0014C")==0)
	fprintf(fp,"\n\n  %-13.13s %-39.39s %-10.10s-------------------",loc_legend[17]," ",loc_legend[13]); //changed on 21/01/2010
    
	fprintf(fp,"\n");lsr_line_cnt();
    fprintf(fp,"  %-13.13s %-45.45s %-4.4s %-45.45s"," ",nd_cahier_position.arr," ",nd_user_position.arr);
	fprintf(fp,"\n");lsr_line_cnt();
	
	fprintf(fp,"  %-18.18s %-45.45s %-6.6s %-45.45s"," ",nd_print_cashier_name.arr," ",nd_print_user_name.arr);


	*/
	
	/*** The below code added by raghava at BKK for walk-through correction ***/

	if(strcmp(nd_reportid.arr,"BLR0014E")==0)
	 fprintf(fp,"\n\n  %-53.53s %-15.15s:-----------------------------"," ",loc_legend[18]);
	if(strcmp(nd_reportid.arr,"BLR0014C")==0)
	fprintf(fp,"\n\n  %-53.53s %-15.15s-----------------------------"," ",loc_legend[18]); //changed on 21/01/2010
    	
	fprintf(fp,"\n");lsr_line_cnt();
    fprintf(fp,"  %-66.66s"," ");
	fun_centre(nd_print_cashier_name.arr,30);
	fprintf(fp,"%-s",nd_print_cashier_name.arr);
	fprintf(fp,"\n");lsr_line_cnt();
	fprintf(fp,"  %-66.66s"," ");
	fun_centre(nd_cahier_position.arr,30);
	fprintf(fp,"%-s",nd_cahier_position.arr);
	//fprintf(fp,"  %-64.64s %-45.45s"," ",nd_cahier_position.arr);
	//fprintf(fp,"  %-64.64s %-45.45s"," ",nd_cahier_position.arr);
  	//fprintf(fp,"  %-66.66s %-45.45s"," ",nd_print_cashier_name.arr);

    /*** upto here ***/
	
	fprintf(fp,"\n\n");
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	fprintf(fp,"%-2.2s %-8.8s %-40.40s ", " ",loc_legend[10],loc_legend[14]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	
	declare_exm_footer();
	open_exm_footer();

	while(fetch_exm_footer())
	 {

		
			if(print_two_cnt==1)
			{
				//fprintf(fp,"%s/%s %s %s",d_exm_bill_code.arr,d_exm_bill_num.arr,d_exm_bill_out_amt.arr,cur_str.arr); Commented on 15/03/2010
				fprintf(fp,"%s/%s ",d_exm_bill_code.arr,d_exm_bill_num.arr);
				print_formated_amt2(d_exm_bill_out_amt);
				//fprintf(fp,"%s",cur_str.arr);
				print_cnt=print_cnt+1;
			}
			else
			{
				
				if(print_cnt==1)
				{
				fprintf(fp,",");
				fprintf(fp,"\n");
				fprintf(fp,"%-2.2s %-8.8s %-18.18s ", " "," "," ");
				//fprintf(fp,"%s/%s %s %s",d_exm_bill_code.arr,d_exm_bill_num.arr,d_exm_bill_out_amt.arr,cur_str.arr); Commented on 15/03/2010
				fprintf(fp,"%s/%s ",d_exm_bill_code.arr,d_exm_bill_num.arr);
				print_formated_amt2(d_exm_bill_out_amt);
				//fprintf(fp,"%s",cur_str.arr);
				print_cnt=print_cnt+1;
				}
				else
				{
					fprintf(fp,",");
					//fprintf(fp,"%s/%s %s %s",d_exm_bill_code.arr,d_exm_bill_num.arr,d_exm_bill_out_amt.arr,cur_str.arr); Commented on 15/03/2010
					fprintf(fp,"%s/%s ",d_exm_bill_code.arr,d_exm_bill_num.arr);
					print_formated_amt2(d_exm_bill_out_amt);
					//fprintf(fp,"%s",cur_str.arr);
					print_cnt=1;
						
				}
				
			}

			print_two_cnt = print_two_cnt+1;
	
	 }
     fprintf(fp,"\n\n");lsr_line_cnt();lsr_line_cnt();

	 close_exm_footer();

	/*if(nd_sys_date.arr[0]!='\0')
	{
	 init_date_temp_var();
	 strcpy(date_convert.arr,nd_sys_date.arr);
	 fun_change_loc_date1();
	 strcpy(nd_sys_date.arr,nd_loc_date1.arr);
    } --Leap Year Changes for SCF 9445  by sarvinder*/

   fprintf(fp,"%-64.64s%-s %18s %s"," ",loc_legend62.arr,nd_sys_date.arr,loc_legend1424.arr);

fflush(fp);   //added on 21/01/2010
fclose(fp);    //added on 21/01/2010


}


}// outer while end brace


/*****fprintf(fp,"%-30.30s ",loc_legend12.arr);
  fprintf(fp,"\n");
  open_payment_cur();

 while(fetch_payment_det_cur())
   {
      fprintf(fp,"%-30.30s ",d_settlement_desc.arr);

	  print_formated_amt(d_pay_amt);
      fprintf(fp,"%-30.30s ",d_slmnt_doc_ref.arr);
      d_bank_name.arr[0] = '\0';
      d_bank_name.len =0;

      EXEC SQL SELECT BANK_NAME 
	  INTO :d_bank_name 
	  FROM BL_BANK_NAME_LANG_VW
      WHERE bank_code=:d_bank_code
	  AND language_id=:nd_lang_id;
   
      d_bank_name.arr[d_bank_name.len] =0;
      fprintf(fp,"%-50s ",d_bank_code.arr);
      fprintf(fp,"\n");

   }// while end brces
disp_message(ERR_MESG,"6\n");
      fprintf(fp,"%79.79s \n",loc_legend21.arr);
	  fprintf(fp,"\n%80.80s %-15s\n",loc_legend62.arr,curr_date.arr);
	  fprintf(fp,"%-30.30s ",loc_legend61.arr);
    *****/

//fflush(fp);
//fclose(fp);
    //delete_temp_data();
} //end of if get_Receipt_Format
else  //if Receipt Format Id 2 
{
	
//declare_cur();
//open_cur();

print_body();   
fflush(fp);
close_cur();

}



if(strcmp(nd_reportid.arr,"BLR0014E")==0)
{

	EXEC SQL EXECUTE
	BEGIN	
		TRACE_DURATION_BL(
		 :nd_reportid ,
		 'Exemption Document Report Spooling' ,
		 :P_START_TIME ,
		 :uid );
	  END;
	  END-EXEC;
}


if(strcmp(nd_reportid.arr,"BLR0014C")==0)
{

	EXEC SQL EXECUTE
	BEGIN	
		TRACE_DURATION_BL(
		 :nd_reportid ,
		 'Cancel Exemption Report Spooling' ,
		 :P_START_TIME ,
		 :uid );
	  END;
	  END-EXEC;
}

if(strcmp(pfilename,"blrrcdtl.lis")==0)
{

	EXEC SQL EXECUTE
	BEGIN	
		TRACE_DURATION_BL(
		 :nd_reportid ,
		 'Detailed Receipt Report Spooling' ,
		 :P_START_TIME ,
		 :uid );
	  END;
	  END-EXEC;
}

if(strcmp(pfilename,"blrrccou.lis")==0)
{

	
	if(strcmp(nd_reportid.arr,"BLRREFND")==0)
	{
		EXEC SQL EXECUTE
		BEGIN	
			TRACE_DURATION_BL(
			 :nd_reportid ,
			 'Refund Report Spooling' ,
			 :P_START_TIME ,
			 :uid );
		  END;
		  END-EXEC;
	 }
	 else
	 {
		EXEC SQL EXECUTE
		BEGIN	
			TRACE_DURATION_BL(
			 :nd_reportid ,
			 'Receipt Report Spooling' ,
			 :P_START_TIME ,
			 :uid );
		  END;
		  END-EXEC;	
	 }

}

if(strcmp(pfilename,"blrinvrc.lis")==0)
{

	EXEC SQL EXECUTE
	BEGIN	
		TRACE_DURATION_BL(
		 :nd_reportid ,
		 'Invoice Receipt Report Spooling' ,
		 :P_START_TIME ,
		 :uid );
	  END;
	  END-EXEC;
}

if(strcmp(pfilename,"blrdepos.lis")==0)
{

	EXEC SQL EXECUTE
	BEGIN	
		TRACE_DURATION_BL(
		 :nd_reportid ,
		 'Deposit Slip Report Spooling' ,
		 :P_START_TIME ,
		 :uid );
	  END;
	  END-EXEC;
}



if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
{
	count_no_of_records();

	if(l_count_no_of_docs==0)
	{
		disp_message(ERR_MESG,"No record found for this Dcoument");
		return;
	}


	print_route_exits();
	
	if(l_exits_print_route==0)
	{
		disp_message(ERR_MESG,"Printer not defined for this document");
		return;
	}

}


 if(filecount==0)
 filecount=1; 
			
  if (l_online_print_yn.arr[0] == 'Y')
	{
		if (l_logo_yniflaser.arr[0] != 'Y')
		{
		
		int l=0;
						
				
				for(l=1;l<=filecount;l++)  //11793
				{	
							
				//disp_message(ERR_MESG,filename);
				//disp_message(ERR_MESG,uid_pwd.arr);
				//disp_message(ERR_MESG,nd_session_id.arr);

				//disp_message(ERR_MESG,nd_facility_id.arr);
				
				//disp_message(ERR_MESG,nd_reportid.arr);

				 EXEC SQL  select GET_TRACE_TIMESTAMP into :P_START_TIME from dual;

				                 if (strcmp(pfilename,"blrdepos.lis")==0)
								 {
									if (strcmp(nd_reprint_yn.arr,"Y")==0)
									{
										strcpy(reportid.arr,"BLRDEPOS1");
										reportid.len = strlen(reportid.arr);
									}
									else
									{
										strcpy(reportid.arr,"BLRDEPOS");
									    reportid.len = strlen(reportid.arr);
									}
								}
								else
								{
									if(strcmp(pfilename,"blrrcdtl.lis")==0)
									 {
										if (strcmp(nd_reprint_yn.arr,"Y")==0)
										 {
										    strcpy(reportid.arr,"BLRRCDTL1");
											reportid.len = strlen(reportid.arr);
										  }
										else
										{
											strcpy(reportid.arr, "BLRRCDTL");
											reportid.len = strlen(reportid.arr);
										}
									}
									else
									{
									strcpy(reportid.arr,nd_reportid.arr);
									reportid.len = strlen(reportid.arr);
									}
									
								}
			 	PrintDocument(uid_pwd.arr,				//char	*PUidPwd;
							nd_session_id.arr,	        //char	*PSessionID;
							nd_facility_id.arr,		    //char	*PFacilityID;
							"BL",						//char	*PModuleID;
						     reportid.arr,
							//nd_reportid.arr,		    //char	*PDocumentID;
							//l_filename[l],
							filename,					//char	*POnlinePrintFileNames;  //11793
							"O",						//char	*PLocationTypes;         //11793
							" ",						//char	*PLocationCodes;
							1,							//int		PNumOfCopies;  //ealrier value is 1
							1,							//int		PPageFrom;
							9999);	
												//int		PPageTo;);


			}
			
			
			if(strcmp(nd_reportid.arr,"BLR0014E")==0)
				{

					EXEC SQL EXECUTE
					BEGIN	
						TRACE_DURATION_BL(
						 :nd_reportid ,
						 'Exemption Document Report Printing' ,
						 :P_START_TIME ,
						 :uid );
					  END;
					  END-EXEC;
				}


				if(strcmp(nd_reportid.arr,"BLR0014C")==0)
				{

					EXEC SQL EXECUTE
					BEGIN	
						TRACE_DURATION_BL(
						 :nd_reportid ,
						 'Cancel Exemption Report Printing' ,
						 :P_START_TIME ,
						 :uid );
					  END;
					  END-EXEC;
				}

				if(strcmp(pfilename,"blrrcdtl.lis")==0)
				{

					EXEC SQL EXECUTE
					BEGIN	
						TRACE_DURATION_BL(
						 :nd_reportid ,
						 'Detailed Receipt Report Printing' ,
						 :P_START_TIME ,
						 :uid );
					  END;
					  END-EXEC;
				}

				if(strcmp(pfilename,"blrrccou.lis")==0)
				{

					if(strcmp(nd_reportid.arr,"BLRREFND")==0)
						{
							EXEC SQL EXECUTE
							BEGIN	
								TRACE_DURATION_BL(
								 :nd_reportid ,
								 'Refund Report Spooling' ,
								 :P_START_TIME ,
								 :uid );
							  END;
							  END-EXEC;
						 }
						 else
						 {
							EXEC SQL EXECUTE
							BEGIN	
								TRACE_DURATION_BL(
								 :nd_reportid ,
								 'Receipt Report Spooling' ,
								 :P_START_TIME ,
								 :uid );
							  END;
							  END-EXEC;	
						 }

				}

				if(strcmp(pfilename,"blrinvrc.lis")==0)
				{

					EXEC SQL EXECUTE
					BEGIN	
						TRACE_DURATION_BL(
						 :nd_reportid ,
						 'Invoice Receipt Report Printing' ,
						 :P_START_TIME ,
						 :uid );
					  END;
					  END-EXEC;
				}

				if(strcmp(pfilename,"blrdepos.lis")==0)
				{

					EXEC SQL EXECUTE
					BEGIN	
						TRACE_DURATION_BL(
						 :nd_reportid ,
						 'Deposit Slip Report Printing' ,
						 :P_START_TIME ,
						 :uid );
					  END;
					  END-EXEC;
				}

		
		   if ( (strcmp(nd_receipt_format_id.arr,"1")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 )&& strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
		   {
			declare_print_yn_cur();
			open_print_yn_cur();
			while(fetch_print_yn_cur())
			{
			update_print_yn_cur();
			}
			close_print_yn_cur();
           }
		   

		   if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
		   {
			
				if(strcmp(nd_reportid.arr,"BLR0014E")==0)	
				{	
				
					EXEC SQL UPDATE BL_BILL_ADJ_HDR A 
					set PRINT_FLAG='Y',REPRINT_COPY_NUM=nvl(REPRINT_COPY_NUM,0)+1
					where a.operating_facility_id=:nd_facility_id
						and a.doc_type_code BETWEEN :d_doc_type_code
						AND NVL(:l_to_doc_type_code,:d_doc_type_code)
						and a.DOC_NUM BETWEEN    :d_doc_number 
						AND NVL(:l_to_doc_type_num, :d_doc_number)
						and to_date(to_char(a.doc_date,'DD/MM/YYYY'),'DD/MM/YYYY') between to_date(:nd_fm_doc_date,'DD/MM/YYYY') and  to_date(:nd_to_doc_date,'DD/MM/YYYY')
						and A.reason_code=nvl(:nd_actual_reason,A.reason_code)
						and nvl(CANCELLED_YN,'N')=:nd_status;
						

					if(OERROR)
					 {
						disp_mesg(ERR_MESG,"update failed on BL_BILL_ADJ_HDR");
					 }

					 
					 	EXEC SQL COMMIT; 
				}

				if(strcmp(nd_reportid.arr,"BLR0014C")==0)	
				{	
				
					EXEC SQL UPDATE BL_BILL_ADJ_HDR_CANC A set PRINT_FLAG='Y',
					REPRINT_COPY_NUM=nvl(REPRINT_COPY_NUM,0)+1
					where a.operating_facility_id=:nd_facility_id
						and a.doc_type_code BETWEEN :d_doc_type_code
						AND NVL(:l_to_doc_type_code,:d_doc_type_code)
						and a.DOC_NUM BETWEEN    :d_doc_number 
						AND NVL(:l_to_doc_type_num, :d_doc_number)
						and A.reason_code=nvl(:nd_actual_reason,A.reason_code);
						
						

					if(OERROR)
					 {
						disp_mesg(ERR_MESG,"update failed on BL_BILL_ADJ_HDR");
					 }

					 
					 	EXEC SQL COMMIT; 

				}

		   }

					
		}
	}
	else
	{
		if (l_lsr != 0 && l_dmp == 0 && l_logo_yniflaser.arr[0] == 'Y')
		{		

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;			

		EXEC SQL EXECUTE
		DECLARE
			l_print_status BOOLEAN;
		BEGIN		
	
			 
			APPPRINT.SUBMIT_ORACLE_REPORT
				 (:nd_ws_no,
				  :nd_facility_id,
				  'BL',
				  :nd_logo_pgm_id,
				  'P', --p_report_option
				  '',  --p_outputfile_format
				  '',  --p_outputfile_name
				  'O',
				  ' ', --p_location_code
				  NULL, --:l_printer_names,
				  NULL,
				  NULL, --p_page_from
				  NULL, --p_page_to
				  NULL, --p_print_mode
				  'P_FILE_NAME='||:nd_file_name||'+'||'P_LOGO_NAME='||:l_logo_name, --p_param_list
				  l_print_status, --OUT BOOLEAN,
				 :l_errortext);			  
		
		END;
		END-EXEC;

		if (l_errortext.arr[0] != '\0')
		{
			disp_message(ERR_MESG,l_errortext.arr);			
			proc_exit(0);
			
		}

	  }
	}

	
	
  
}// Main end braces


declare_print_yn_cur()
{


if(nd_pmnt_ref_num.arr[0]!='\0')
{

/* COMMENTED FOR PE CORRECTION
	EXEC SQL DECLARE BL_INV_RECEIPT_REFUND_HDR_CUR CURSOR FOR
		SELECT A.DOC_TYPE_CODE,A.DOC_NUMBER
		FROM bl_receipt_refund_hdr A
		WHERE A.operating_facility_id=:nd_facility_id
		AND A.DOC_TYPE_CODE||'/'||A.DOC_NUMBER IN
				(
				SELECT B.SLMT_DOC_TYPE_CODE||'/'||B.SLMT_DOC_NUM
				FROM BL_CUST_PAYMENT_REF_DTL B
				WHERE B.OPERATING_FACILITY_ID=:nd_facility_id
				AND B.PMNT_REF_NUM = :nd_pmnt_ref_num
				)
		And ( (NVL(:nd_function_id,'X')='BL_REPRINT_RCPT_FOR_PMNT_DOC'
		        And Exists (Select 'X' From SY_PROG_PARAM C
				            Where  C.Operating_Facility_Id = :nd_facility_id
							   And C.PGM_ID='BLTCANPR'
							   And C.SESSION_ID = :nd_session_id
							   And C.PGM_DATE = :nd_pgm_date
							   And C.PARAM1 = A.DOC_TYPE_CODE
							   And C.PARAM2 = A.DOC_NUMBER)
			   )
			  OR (NVL(:nd_function_id,'X')!='BL_REPRINT_RCPT_FOR_PMNT_DOC' )
			 );
	 */

	 	EXEC SQL DECLARE BL_INV_RECEIPT_REFUND_HDR_CUR CURSOR FOR
		SELECT A.DOC_TYPE_CODE,A.DOC_NUMBER
		FROM bl_receipt_refund_hdr A
		WHERE A.operating_facility_id=:nd_facility_id
        /* AND A.DOC_TYPE_CODE||'/'||A.DOC_NUMBER IN
				(
				SELECT B.SLMT_DOC_TYPE_CODE||'/'||B.SLMT_DOC_NUM
				FROM BL_CUST_PAYMENT_REF_DTL B
				WHERE B.OPERATING_FACILITY_ID=:nd_facility_id
				AND B.PMNT_REF_NUM = :nd_pmnt_ref_num
				)  ADDED EXISTS FOR PE CORRECTION */ 

        And EXISTS (SELECT 'X' FROM BL_CUST_PAYMENT_REF_DTL B
		WHERE B.OPERATING_FACILITY_ID=:nd_facility_id
		        AND A.DOC_TYPE_CODE=B.SLMT_DOC_TYPE_CODE
				AND A.DOC_NUMBER=B.SLMT_DOC_NUM
				AND B.PMNT_REF_NUM = :nd_pmnt_ref_num
				)
		And ( (NVL(:nd_function_id,'X')='BL_REPRINT_RCPT_FOR_PMNT_DOC'
		        And Exists (Select 'X' From SY_PROG_PARAM C
				            Where  C.Operating_Facility_Id = :nd_facility_id
							   And C.PGM_ID='BLTCANPR'
							   And C.SESSION_ID = :nd_session_id
							   And C.PGM_DATE = :nd_pgm_date
							   And C.PARAM1 = A.DOC_TYPE_CODE
							   And C.PARAM2 = A.DOC_NUMBER)
			   )
			  OR (NVL(:nd_function_id,'X')!='BL_REPRINT_RCPT_FOR_PMNT_DOC' )
			 );

}
else
{
	/*disp_message(ERR_MESG,nd_facility_id.arr);
	disp_message(ERR_MESG,d_doc_type_code.arr);
	disp_message(ERR_MESG,l_to_doc_type_code.arr);
	disp_message(ERR_MESG,d_doc_number.arr);
	disp_message(ERR_MESG,l_to_doc_type_num.arr);*/

	EXEC SQL DECLARE BL_RECEIPT_REFUND_HDR_CUR CURSOR FOR
		SELECT DOC_TYPE_CODE,DOC_NUMBER
		FROM bl_receipt_refund_hdr
		WHERE operating_facility_id=:nd_facility_id
		AND DOC_TYPE_CODE BETWEEN   :d_doc_type_code
		AND NVL(:l_to_doc_type_code,:d_doc_type_code)
		and DOC_NUMBER BETWEEN      :d_doc_number 
		AND NVL(:l_to_doc_type_num, :d_doc_number);

}
 
	
	if (OERROR)
		{ 
		
			disp_message (ERR_MESG,"declare failed FROM BL_RECEIPT_REFUND_HDR TABLE");
			proc_exit();
		}
}

open_print_yn_cur()
{ 
		if(nd_pmnt_ref_num.arr[0]!='\0')
		  EXEC SQL OPEN BL_INV_RECEIPT_REFUND_HDR_CUR;
		
		else
		  EXEC SQL OPEN BL_RECEIPT_REFUND_HDR_CUR;

		if (OERROR) 
		{ 
		disp_message (ERR_MESG,"Open BL_RECEIPT_REFUND_HDR_CUR cursor failed");
		proc_exit();
		}
	return;
}

fetch_print_yn_cur()
{
  	
	nd_doc_type.arr[0] ='\0';
	nd_doc_num.arr[0]  ='\0';
	nd_doc_type.len		=0;
	nd_doc_num.len		=0;
	
	if(nd_pmnt_ref_num.arr[0]!='\0')
	{

	  EXEC SQL FETCH BL_INV_RECEIPT_REFUND_HDR_CUR
			   INTO :nd_doc_type,
					:nd_doc_num;
	}
	else
	{
	  
	  EXEC SQL FETCH BL_RECEIPT_REFUND_HDR_CUR
			   INTO :nd_doc_type,
					:nd_doc_num;
	}
		

	if(OERROR)
	{ 
		disp_message(ERR_MESG,"FETCH FAILED IN BL_RECEIPT_REFUND_HDR_CUR");
		
	}

	if(NODATAFOUND)
	{
		return 0;
	}

	nd_doc_type.arr[nd_doc_type.len]  ='\0';
	nd_doc_num.arr[nd_doc_num.len]	  ='\0';
    
   return 1;
 
}

update_print_yn_cur()
{
	
    

	EXEC SQL UPDATE BL_RECEIPT_REFUND_HDR SET
		PRINT_FLAG ='Y' 
		WHERE DOC_TYPE_CODE=:nd_doc_type
		and DOC_NUMBER=:nd_doc_num;


	EXEC SQL SELECT bill_doc_type_code,bill_doc_number
	         into :nd_bill_doc_code,:nd_bill_doc_num
			 from BL_RECEIPT_REFUND_HDR
			 WHERE DOC_TYPE_CODE=:nd_doc_type
			  and DOC_NUMBER=:nd_doc_num;

	EXEC SQL UPDATE BL_BILL_HDR set BILL_PRINT_FLAG='Y'
			 where doc_type_Code=:nd_bill_doc_code
			 and doc_num=:nd_bill_doc_num;
		
	EXEC SQL COMMIT; 

	return 1;
		
}

close_print_yn_cur()
{ 
	
	if(nd_pmnt_ref_num.arr[0]!='\0')
	  EXEC SQL CLOSE BL_INV_RECEIPT_REFUND_HDR_CUR;
	
	else
	  EXEC SQL CLOSE BL_RECEIPT_REFUND_HDR_CUR;

	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close BL_RECEIPT_REFUND_HDR_CUR failed");
	proc_exit();
	}
	return;
}

fun_payment_det()
{
      
	 /*if (l_lsr!= 0 && l_dmp== 0) 
	 { 
	  fprintf(fp,"%c(s3B",ESC); 
	  fprintf(fp,"%-30.30s ",loc_legend12.arr);
	  fprintf(fp,"%c(s-3B",ESC); 
     }
	 if (l_lsr== 0 && l_dmp!= 0)
	 fprintf(fp,"%-30.30s ",loc_legend12.arr);
	 	 
	  fprintf(fp,"\n");
	  lsr_line_cnt();*/ //11793
	 	 
	  declare_payment_type_det();
      open_payment_cur(); 
 
 while(fetch_payment_det_cur())
   {
    
	  /*fprintf(fp,"%-30.30s",d_settlement_desc.arr);
	  print_formated_amt(d_pay_amt);
      fprintf(fp," %-s ",cur_str.arr); 
      if (strcmp(d_cash_slmt_flag.arr,"D")==0) 
	  {
	    
		  if(d_slmt_doc_ref_date.arr[0]!='\0')
		  {
			init_date_temp_var();
			strcpy(date_convert.arr,d_slmt_doc_ref_date.arr);
			fun_change_loc_date2();
			strcpy(d_slmt_doc_ref_date.arr,nd_loc_date.arr);
		  }
			fprintf(fp,"%-2.2s: %-25.25s %-4.4s: %-10.10s ",loc_legend106.arr,d_rcpt_rfnd_id_no.arr,loc_legend3.arr,d_slmt_doc_ref_date.arr);
		 
	  }
	  else
	  {
	    fprintf(fp,"%-30.30s ",d_slmnt_doc_ref.arr);
	  }

      d_bank_name.arr[0] = '\0';
      d_bank_name.len =0;

      EXEC SQL SELECT BANK_NAME 
	  INTO :d_bank_name 
	  FROM BL_BANK_NAME_LANG_VW
      WHERE bank_code=:d_bank_code
	  AND language_id=:nd_lang_id;
   
     d_bank_name.arr[d_bank_name.len] =0;
     fprintf(fp,"%-30.30s ",d_bank_code.arr);
     fprintf(fp,"\n");
	 lsr_line_cnt();*/ //11793
   
    if ( strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(d_receipt_nature_code.arr,"IN")==0 )
	{
	 EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC (:nd_facility_id,
			:d_ref_dep_doc_type_code,
				:d_ref_dep_doc_number,
				:d_ref_dep_doc_srno,
				:d_org_dep_doc_type_code,
				:d_org_dep_doc_number,
				:d_org_dep_doc_srno);
		END;
		END-EXEC;
	 

	  if(strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0)
      {
	    fprintf(fp,"%-35.35s : %s\n",loc_legend92.arr,d_org_dep_code.arr);
		//fprintf(fp,"%-35.35s : %s/%s/%s\n",loc_legend92.arr,d_ref_dep_doc_type_code.arr,d_ref_dep_doc_number.arr,d_ref_dep_doc_srno.arr);
		fprintf(fp,"%-35.35s :",loc_legend700.arr);
		EXEC SQL select doc_amt into d_adj_amt
				 from bl_receipt_refund_dtl
				 where doc_type_code=:d_ref_dep_doc_type_code
				 and doc_number=:d_ref_dep_doc_number
				 and doc_srno=:d_ref_dep_doc_srno;

		print_formated_amt(d_pay_amt);
		fprintf(fp,"\n");
		fprintf(fp,"%-35.35s :",loc_legend701.arr);
		print_formated_amt(d_pay_amt-d_adj_amt);
		fprintf(fp,"\n");
		lsr_line_cnt();
      }

	}
	else
	{

	EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC (:nd_facility_id,
			:d_ref_dep_doc_type_code,
				:d_ref_dep_doc_number,
				:d_ref_dep_doc_srno,
				:d_org_dep_doc_type_code,
				:d_org_dep_doc_number,
				:d_org_dep_doc_srno);
		END;
		END-EXEC;
	     
	 if(strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0)
      {	
	  
		fprintf(fp,"%-35.35s : %s\n",loc_legend93.arr,d_org_dep_code.arr);
	    //fprintf(fp,"(%-35.35s : %s/%s/%s)\n",loc_legend93.arr,d_ref_dep_doc_type_code.arr,d_ref_dep_doc_number.arr,d_ref_dep_doc_srno.arr);
		lsr_line_cnt();
      }

	}
		

   }// while end brces


    //fprintf(fp,"%79.79s \n",loc_legend21.arr);
	 
  	//fprintf(fp,"%80.80s %-15s\n",loc_legend62.arr,curr_date.arr);
    
	 close_payment_cur();

}

fun_payment_det1()
{

  
    l_print_adj_dep=0;      //raghava on 21/07/2010
    l_dep_adjst_exists=0;	//raghava on 21/07/2010
	l_tot_adjst_dep_amt=0;  //raghava on 22/09/2010
	l_num_rec=1;			//raghava on 22/09/2010
	nd_d_org_dep_code.arr[0] ='\0'; //SCF-7093
	
		
	strcpy(dep_filename,WORKING_DIR);
	strcat(dep_filename,"blrdepos.lis");
   	if(d_oth_receipt_amt>0)
	{	
		if(strcmp(filename,dep_filename)!=0)
		{
		 if (l_lsr!= 0 && l_dmp== 0)
		 fprintf(fp,"%-50.50s\n",loc_legend56.arr);
		 if (l_lsr== 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  fprintf(fp,"%-50.50s\n",loc_legend56.arr);
		  else
		  fprintf(fp,"%-50.50s\n"," ");
		 }
		}
 	 }	 
	  declare_payment_type_det();
      open_payment_cur(); 
		/***upto here***/

 while(fetch_payment_det_cur())
 {
   
   
   if(d_oth_receipt_amt>0) 
   {
	 if(l_num_rec==1)
     {
		 /**added for 11793**/
		 if (l_lsr!= 0 && l_dmp== 0) 
		 { 
		  fprintf(fp,"%c(s3B",ESC); 
		  fprintf(fp,"%-20.20s ",loc_legend12.arr);
		  fprintf(fp,"%c(s-3B",ESC); 
		 }

		 if (l_lsr== 0 && l_dmp!= 0)
		 {
		  fprintf(fp,"%cE",ESC); 		           /* To Set Bold For Dotmatrix*/ 
		  fprintf(fp,"%-20.20s ",loc_legend12.arr);
		  fprintf(fp,"%cF",ESC); 		           /* To Set Realse the Bold For Dotmatrix*/
		 }	 
		 //fprintf(fp,"\n");
		 //lsr_line_cnt();
     }
	 
     /** the below code added by raghava on 21/07/2010 for adjust deposit should print document wise not settlement wise ***/
	 
	     EXEC SQL SELECT COUNT(1)
         INTO l_dep_adjst_exists
         FROM BL_RECEIPT_REFUND_DTL A
         WHERE A.OPERATING_FACILITY_ID = :nd_facility_id
         AND a.DOC_TYPE_CODE=:d_doc_type_code1
         AND a.DOC_NUMBER=:d_doc_number1
         AND A.REF_DEP_DOC_TYPE_CODE IS NOT NULL
	     AND A.REF_DEP_DOC_NUMBER IS NOT NULL
         AND A.REF_DEP_DOC_SRNO IS NOT NULL;

		 EXEC SQL SELECT SUM(DOC_AMT)
         INTO l_tot_adjst_dep_amt
         FROM BL_RECEIPT_REFUND_DTL A
         WHERE A.OPERATING_FACILITY_ID = :nd_facility_id
         AND a.DOC_TYPE_CODE=:d_doc_type_code1
         AND a.DOC_NUMBER=:d_doc_number1
         AND A.REF_DEP_DOC_TYPE_CODE IS NOT NULL
	     AND A.REF_DEP_DOC_NUMBER IS NOT NULL
         AND A.REF_DEP_DOC_SRNO IS NOT NULL;

	   if(strcmp(nd_receipt_format_id.arr,"1")==0 && l_dep_adjst_exists>1)
	   {
	    
		if ( strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(d_receipt_nature_code.arr,"IN")==0 )
		{
			if (l_lsr== 0 && l_dmp!= 0)
			{
			   if(l_print_adj_dep==0) 
			   {
				 declare_adjst_dep_cur();
				 open_adjst_dep_cur();
				 while(fetch_adjst_dep_cur())
				 {
		   						
					 EXEC SQL SELECT sum(doc_amt) 
					 INTO  nd_tot_dep_amt
					 FROM  bl_receipt_refund_dtl
					 WHERE doc_type_code=:d_dep_doc_type_code
					 AND   doc_number=:d_dep_doc_number;

			 		fprintf(fp,"\n");
					lsr_line_cnt();	  
					fprintf(fp,"%-35.35s : %s\n",loc_legend92.arr,d_org_dep_num.arr);
					fprintf(fp,"%-35.35s :",loc_legend700.arr);
					print_formated_amt(tot_dep_adj_amt);				   //Adjusted Amt from deposit
					fprintf(fp,"\n");
					fprintf(fp,"%-35.35s :",loc_legend701.arr);
					print_formated_amt(nd_tot_dep_amt-tot_dep_adj_amt);    //Remaing Amt from deposit
					l_print_adj_dep++;
				 
				 }
				 close_adjst_dep_cur();
				 if(l_print_adj_dep>0)
				 {
				  fprintf(fp,"\n");
				  lsr_line_cnt();	
				  goto next_record;
                 }
			   }
			   else
			   {
			    if(strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0)
				goto next_record;
			   }
			   
			 }
		   
	      }
	   }
	 
 
	 /*** raghava 21/07/2010 ***/

	 if(l_num_rec>1)
	 {
	  fprintf(fp,"%-15.15s "," ");
	 } 
	 /** The below code added by raghava on 22/09/2010 **/
	 //if (strcmp(nd_receipt_format_id.arr,"1")==0 && l_dep_adjst_exists>0 && (d_oth_receipt_amt==l_tot_adjst_dep_amt)) ICN-187
	 if( (strcmp(nd_receipt_format_id.arr,"1")==0 && l_dep_adjst_exists>0 && (d_oth_receipt_amt==l_tot_adjst_dep_amt))||
	     (strcmp(nd_receipt_format_id.arr,"1")==0 && l_dep_adjst_exists>0 && (strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0) && (d_oth_receipt_amt!=l_tot_adjst_dep_amt)))   //added by raghava for ICN-187
	 {
	  if (l_lsr== 0 && l_dmp!= 0)
	  {
		fprintf(fp,"\n");
	    lsr_line_cnt();
		goto adjst_deposit;
	  }
	 } 
     /** Upto here 22/09/2010 **/

	  fprintf(fp,"%-18.18s",d_settlement_desc.arr);
	  
	  if (l_lsr!= 0 && l_dmp== 0) 
	  {
	   print_formated_amt(d_pay_amt);
       fprintf(fp," %-s ",cur_str.arr); 
	  }
	  if (l_lsr== 0 && l_dmp!= 0)
	  {
	   fprintf(fp,"%cE",ESC); 		           /* To Set Bold For Dotmatrix*/ 
	   print_formated_amt(d_pay_amt);
       fprintf(fp," %-s ",cur_str.arr); 
	   fprintf(fp,"%cF",ESC); 		           /* To Set Realse the Bold For Dotmatrix*/
	  }
      
      d_bank_name.arr[0] = '\0';
      d_bank_name.len =0;

      EXEC SQL SELECT BANK_NAME 
	  INTO :d_bank_name 
	  FROM BL_BANK_NAME_LANG_VW
      WHERE bank_code=:d_bank_code
	  AND language_id=:nd_lang_id;
   
     d_bank_name.arr[d_bank_name.len] =0;

	  if (strcmp(d_cash_slmt_flag.arr,"D")==0) 
	  {
	    
		  if(d_slmt_doc_ref_date.arr[0]!='\0')
		  {
			init_date_temp_var();
			strcpy(date_convert.arr,d_slmt_doc_ref_date.arr);
			fun_change_loc_date2();
			strcpy(d_slmt_doc_ref_date.arr,nd_loc_date.arr);
		  }
		  //fprintf(fp,"%-2.2s: %-s %-s: %-s ",loc_legend106.arr,d_rcpt_rfnd_id_no.arr,loc_legend3.arr,d_slmt_doc_ref_date.arr);
		  //fprintf(fp,"%-s: %-s %-s: %-s ",loc_legend106.arr,d_slmnt_doc_ref.arr," ",d_slmt_doc_ref_date.arr);
		  fprintf(fp,"%-s: %-s %-s %-s ",loc_legend106.arr,d_slmnt_doc_ref.arr,d_bank_code.arr,d_slmt_doc_ref_date.arr);
		 
	  }
	  else
	  if (strcmp(d_cash_slmt_flag.arr,"B")==0)
	  {
	    
		  if(d_slmt_doc_ref_date.arr[0]!='\0')
		  {
			init_date_temp_var();
			strcpy(date_convert.arr,d_slmt_doc_ref_date.arr);
			fun_change_loc_date2();
			strcpy(d_slmt_doc_ref_date.arr,nd_loc_date.arr);
		  }
		
		//fprintf(fp," %-s %-s",d_slmnt_doc_ref.arr,d_slmt_doc_ref_date.arr);
		fprintf(fp," %-s %-s %-s",d_slmnt_doc_ref.arr,d_bank_code.arr,d_slmt_doc_ref_date.arr);
	  }
      else
	  {
	    fprintf(fp," %-s",d_slmnt_doc_ref.arr);
	  }
	  /*
	  d_bank_name.arr[0] = '\0';
      d_bank_name.len =0;

      EXEC SQL SELECT BANK_NAME 
	  INTO :d_bank_name 
	  FROM BL_BANK_NAME_LANG_VW
      WHERE bank_code=:d_bank_code
	  AND language_id=:nd_lang_id;
   
     d_bank_name.arr[d_bank_name.len] =0;
	 fprintf(fp," %s ",d_bank_code.arr);
	 scf-7238 the code moved to above*/

     fprintf(fp,"\n");
	 lsr_line_cnt();
   }
    /*********11793******** RESEND******/
   adjst_deposit:l_num_rec++;

	if ( strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 || strcmp(d_receipt_nature_code.arr,"AR")==0 || strcmp(d_receipt_nature_code.arr,"IN")==0 )
	{
	   /** the below code added for SCF-6379 ***/
	   if(strcmp(nd_receipt_format_id.arr,"1")==0 && (l_lsr== 0 && l_dmp!= 0))
	   {
	    EXEC SQL EXECUTE
		BEGIN
		:d_org_dep_code:=BLCOMMON.GET_ORG_DEP_DOC 
			  (:nd_facility_id,
			   :d_ref_dep_doc_type_code,
			   :d_ref_dep_doc_number,
			   :d_ref_dep_doc_srno
			  );

		END;
		END-EXEC;
	   
	   }
	   else
	   /** upto here ***/ 
	   {
	    EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC 
							   (:nd_facility_id,
								:d_ref_dep_doc_type_code,
								:d_ref_dep_doc_number,
								:d_ref_dep_doc_srno,
								:d_org_dep_doc_type_code,
								:d_org_dep_doc_number,
								:d_org_dep_doc_srno);
		END;
		END-EXEC;
	 
       }
	  d_org_dep_code.arr[d_org_dep_code.len]='\0';
	 

	  
	  if(strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0)
      {
	    
		//need to change
		fprintf(fp,"%-35.35s : %s\n",loc_legend92.arr,d_org_dep_code.arr);
		//fprintf(fp,"%-35.35s : %s/%s/%s\n",loc_legend92.arr,d_ref_dep_doc_type_code.arr,d_ref_dep_doc_number.arr,d_ref_dep_doc_srno.arr);
		fprintf(fp,"%-35.35s :",loc_legend700.arr);
		
		/* commented for SCF-6379
		EXEC SQL SELECT doc_amt into d_adj_amt
				 FROM  bl_receipt_refund_dtl
				 WHERE doc_type_code=:d_ref_dep_doc_type_code
				 AND   doc_number=:d_ref_dep_doc_number
				 AND   doc_srno=:d_ref_dep_doc_srno;

		*/
		/** the below code added for SCF-6379 **/

		 
		 EXEC SQL SELECT sum(b.doc_amt) into d_adj_amt
				  FROM  bl_receipt_refund_hdr a,
					    bl_receipt_refund_dtl b
				  WHERE a.operating_facility_id=:nd_facility_id
				    AND a.operating_facility_id = b.operating_facility_id
					AND a.doc_type_code = b.doc_type_code
				    AND a.doc_number = b.doc_number
				    AND b.ref_dep_doc_type_code=:d_ref_dep_doc_type_code
				    AND b.ref_dep_doc_number=:d_ref_dep_doc_number
					AND a.recpt_nature_code IN ('AD', 'PR');
			 
	    /** upto here **/
		
		print_formated_amt(d_pay_amt);				//Adjusted Amt from deposit
		fprintf(fp,"\n");
		fprintf(fp,"%-35.35s :",loc_legend701.arr);
		print_formated_amt(d_adj_amt); //Remaing Amt from deposit for SCF-6379
	    //print_formated_amt(d_pay_amt-d_adj_amt);     //Remaing Amt from deposit commented for SCF-6379
		fprintf(fp,"\n");
		lsr_line_cnt();
      }

	}
	else
	{

	 if(strcmp(d_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d_ref_dep_doc_number.arr,"\0")!=0)
	 {	
	   /** the below code added for SCF-6379 ***/
	  

	   if(strcmp(nd_receipt_format_id.arr,"1")==0 && (l_lsr== 0 && l_dmp!= 0))
	   {
	    EXEC SQL EXECUTE
		BEGIN
		:d_org_dep_code:=BLCOMMON.GET_ORG_DEP_DOC 
			  (:nd_facility_id,
			   :d_ref_dep_doc_type_code,
			   :d_ref_dep_doc_number,
			   :d_ref_dep_doc_srno
			  );

		END;
		END-EXEC;
	   
	   }
	  else /** upto here for SCF-6379 ***/
	  {	
		
		EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC(:nd_facility_id,
			    :d_ref_dep_doc_type_code,
				:d_ref_dep_doc_number,
				:d_ref_dep_doc_srno,
				:d_org_dep_doc_type_code,
				:d_org_dep_doc_number,
				:d_org_dep_doc_srno);
		END;
		END-EXEC;
	     
       }
	   d_org_dep_code.arr[d_org_dep_code.len]='\0';

	   //the below code added for SCF-7093
	    if(strcmp(nd_receipt_format_id.arr,"1")==0 && (l_lsr== 0 && l_dmp!= 0))
		{
		    if(strcmp(nd_d_org_dep_code.arr,d_org_dep_code.arr)!=0)
			{
				 fprintf(fp,"%-35.35s : %s\n",loc_legend93.arr,d_org_dep_code.arr);
				//fprintf(fp,"(%-35.35s : %s/%s/%s)\n",loc_legend93.arr,d_ref_dep_doc_type_code.arr,d_ref_dep_doc_number.arr,d_ref_dep_doc_srno.arr);
				lsr_line_cnt();
			}
		}
		else//upto here for SCF-7093
        {

			fprintf(fp,"%-35.35s : %s\n",loc_legend93.arr,d_org_dep_code.arr);
			//fprintf(fp,"(%-35.35s : %s/%s/%s)\n",loc_legend93.arr,d_ref_dep_doc_type_code.arr,d_ref_dep_doc_number.arr,d_ref_dep_doc_srno.arr);
			lsr_line_cnt();
		}


		/**** the below code added for SCF-7093(26880)****/
		  if(strcmp(nd_receipt_format_id.arr,"1")==0 && (l_lsr== 0 && l_dmp!= 0))
		  {
		
			EXEC SQL SELECT b.short_desc,a.doc_amt
					  INTO  :nd_slmt_type_desc,:nd_rem_dep_amt
					  FROM  bl_receipt_refund_dtl a,bl_slmt_type_lang_vw b 
					  WHERE a.operating_facility_id=:nd_facility_id
						AND a.slmt_type_code=b.slmt_type_code
						AND language_id=:nd_lang_id
						AND b.acc_entity_code in (select acc_entity_code 
									   from sy_acc_entity
									   where acc_entity_id = :nd_facility_id
									   )
						AND a.doc_type_code=:d_doc_type_code1
                        AND a.doc_number=:d_doc_number1
						AND a.ref_dep_doc_type_code = :d_ref_dep_doc_type_code
						AND a.ref_dep_doc_number = :d_ref_dep_doc_number
						AND a.ref_dep_doc_srno=:d_ref_dep_doc_srno;


			  fprintf(fp,"   %-11.11s   ",nd_slmt_type_desc.arr);
			  print_formated_amt(nd_rem_dep_amt);
			  //fprintf(fp,"\n");
		  }

      }

	} /********UPTO HERE********/

    strcpy(nd_d_org_dep_code.arr,d_org_dep_code.arr); //scf-7093

   next_record:l_num_rec++;
  }  //while end;

  close_payment_cur();


   /*** The below code added by raghava on 15/03/2010  for displaying reference of deposit document For Refund Slip ***/ 
  //if (l_lsr== 0 && l_dmp!= 0)
  //{
    if ( strcmp(d_receipt_nature_code.arr,"BI")!=0 && strcmp(d_receipt_nature_code.arr,"DC")!=0 &&
       strcmp(d_receipt_nature_code.arr,"AR")!=0 && strcmp(d_receipt_nature_code.arr,"IN")!=0 )
    {
     if(strcmp(d3_bill_doc_type_code.arr,"\0")!=0 && strcmp(d3_bill_doc_number.arr,"\0")!=0)
	 {
	 	EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC (:nd_facility_id,
							nvl(:d3_bill_doc_type_code,:d_ref_dep_doc_type_code),
							nvl(:d3_bill_doc_number,:d_ref_dep_doc_number),
							nvl(:d3_bill_doc_srno,:d_ref_dep_doc_srno),
							:d_org_dep_doc_type_code,
							:d_org_dep_doc_number,
							:d_org_dep_doc_srno);
		END;
		END-EXEC;
	  
	  nd_org_dep_num.arr[0]='\0';   //raghava on 21/07/2010
	  nd_org_dep_num.len=0;			//raghava on 21/07/2010
	  
	  
	  	 
	  EXEC SQL SELECT substr(:d_org_dep_code,1,instr(:d_org_dep_code,'/',1,2)-1) 
	           INTO  :nd_org_dep_num
			   FROM   DUAL;
	  
	  nd_org_dep_num.arr[nd_org_dep_num.len]='\0';
	  
	  fprintf(fp,"\n%-s : %-s\n",loc_legend1448.arr,nd_org_dep_num.arr);
	  /**** the below code added for ICN-363****/
	  if(strcmp(nd_receipt_format_id.arr,"1")==0 && (l_lsr== 0 && l_dmp!= 0))
	  {
	    EXEC SQL SELECT b.short_desc
				  INTO  :nd_slmt_type_desc
				  FROM  bl_receipt_refund_dtl a,bl_slmt_type_lang_vw b 
				  WHERE a.operating_facility_id=:nd_facility_id
					AND a.slmt_type_code=b.slmt_type_code
					AND language_id=:nd_lang_id
					AND b.acc_entity_code in (select acc_entity_code 
		                           from sy_acc_entity
		                           where acc_entity_id = :nd_facility_id
		                           )
					AND a.doc_type_code = :d3_bill_doc_type_code
				    AND a.doc_number = :d3_bill_doc_number
					AND a.doc_srno=:d3_bill_doc_srno;


	  fprintf(fp,"- %-s   ",nd_slmt_type_desc.arr);
	  print_formated_amt(d_oth_receipt_amt);
	  fprintf(fp,"\n");
	  }
	      /*****upto here ICN-363*****/
     }
	}
  //}

 }
print_subsidy()
{
				  
   if(strcmp(nd_preprint_flag.arr,"N")==0)
   {
	   /*
	   fprintf(fp," %-7.7s",loc_legend11.arr);
	   fprintf(fp," %-6s%1s%-10s  \n",d2_bill_doc_type_code.arr,"/",d2_bill_doc_num.arr);
	   prt_line_uc();fprintf(fp,"\n");
	   */	
	   strcat(sub_print_text.arr,"(");
	   strcat(sub_print_text.arr,nd_episode_type.arr);
	   strcat(sub_print_text.arr,")");
       fprintf(fp," %-7.7s "," ");
	   if(legend_cnt==2||legend_cnt==0)
	   {
		   if (l_lsr != 0 && l_dmp == 0)
		   {	
		    //fprintf(fp,"%-51.51s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
		    fprintf(fp,"%51.51s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
		    fprintf(fp,"%-7.7s%-45.45s%12.12s   %16.16s\n"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		   }
		   if (l_lsr == 0 && l_dmp!= 0)
		   {
		    fprintf(fp,"\n");
			fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			fprintf(fp,"%-7.7s%-45.45s%12.12s   %16.16s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
			fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
		    fprintf(fp,"\n");
		   }
		   

	   }
	   else
	   if(legend_cnt==1)
	   {
		   if (l_lsr != 0 && l_dmp == 0)
		   {	
		    //fprintf(fp,"%-51.51s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
		    fprintf(fp,"%51.51s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
		    fprintf(fp,"%-45.45s%12.12s   %16.16s\n",loc_legend110.arr," ",loc_legend69.arr);
		   }
		   if (l_lsr == 0 && l_dmp!= 0)
		   {
		    fprintf(fp,"\n");
			fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			fprintf(fp,"%-7.7s%-45.45s%12.12s   %16.16s"," ",loc_legend110.arr," ",loc_legend69.arr);
			fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
		    fprintf(fp,"\n");
		   }
		   

	    }
	   else
	   {
		   if (l_lsr!= 0 && l_dmp== 0)
		   {
		    //fprintf(fp,"%-67.67s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");
		    fprintf(fp,"%67.67s %-s%-s\n",loc_legend1401.arr,cur_str.arr,")");	
		    fprintf(fp,"%-62.62s%12.12s   %16.16s\n",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		   }
		   if (l_lsr == 0 && l_dmp!= 0)
		   {
		     fprintf(fp,"\n");
			 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			 fprintf(fp,"%-7.7s%-62.62s%12.12s   %16.16s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
			 fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
		     fprintf(fp,"\n");
		   }
		   
	   }
	   prt_line_uc();


   }
   fprintf(fp,"\n");
   
   if(legend_cnt==2||legend_cnt==0)
   {
      fprintf(fp," %-21.21s  %35.35s ",sub_print_text.arr," ");
	  print_formated_amt(d_oth_receipt_amt);
   }
   else
   if(legend_cnt==1)
   {
	   fprintf(fp," %-21.21s  %35.35s ",sub_print_text.arr," ");
	   print_formated_amt(d_oth_receipt_amt);
   }
   else
   {   
	   fprintf(fp," %-21.21s  %54.54s ",sub_print_text.arr," ");
	   print_formated_amt(d_oth_receipt_amt);
   }
  
   if (l_lsr == 0 && l_dmp== 0)
   fprintf(fp,"\n");
   if (l_lsr == 0 && l_dmp!= 0)
   {
    fprintf(fp,"\n\n\n");
    line_no = line_no + 2;
   }
   if(strcmp(nd_preprint_flag.arr,"N")==0)
   {
    if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%-45.45s____________________________________________________________\n"," ");
    //prt_line_uc();
   }
   else
   {
     fprintf(fp,"\n");
   }
   //nd_partial_settled_amt=nd_partial_settled_amt+d_settled_amt;
   line_no = line_no + 3;

   
   /*** The below Code added by raghava at BKK for CRF-561 ****/
   	
	if (l_lsr== 0 && l_dmp!= 0)
	{
	 if(strcmp(l_receipt_doc_size.arr,"A4")==0) 
	 {
	  while(v_lno <= (MAX_LINES-20))
	  {
	    fprintf(fp,"\n"); //08/03/2010
		v_lno++;
	  }
	 }
	}
   /**** BKK for CRF-561 ***/	

   if(legend_cnt==2||legend_cnt==0)
   {
 
	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 {
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp," %-59.59s",loc_legend68.arr);
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-59.59s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	   
		//fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp," %-59.59s",loc_legend68.arr);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp," %-50.50s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	 }
	 else
	 {
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	    
		fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-50.50s"," ");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	 }
   }
   else
   if(legend_cnt==1)
   {
   
	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 {
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp," %-59.59s",loc_legend68.arr);
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-59.59s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp," %-59.59s",loc_legend68.arr);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp," %-50.50s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	 }
	 else
	 {
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	    fprintf(fp," %-59.59s"," ");
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp," %-50.50s"," ");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	 }
   }
   else
   {

	  if(strcmp(nd_preprint_flag.arr,"N")==0)
	  {	
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp,"%73.73s      ",loc_legend68.arr);
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp,"%79.79s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp,"%73.73s      ",loc_legend68.arr);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		fprintf(fp,"%70.70s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	  }
	  else
	  {
	   if (l_lsr!= 0 && l_dmp== 0)
	   {
	    fprintf(fp,"%73.73s      ",loc_legend68.arr);
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp,"%79.79s",loc_legend54.arr);
	    print_formated_amt(d_oth_receipt_amt);
	   }
	   if (l_lsr == 0 && l_dmp!= 0)
	   {
	    fprintf(fp,"%73.73s      "," ");
	    print_formated_amt(d_oth_receipt_amt);
	    fprintf(fp,"\n");
	    fprintf(fp,"%70.70s"," ");
	    //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		print_formated_amt(d_oth_receipt_amt);
		//fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   }
	  }
   }
   

   fprintf(fp,"\n");
   //if(strcmp(nd_preprint_flag.arr,"N")==0)
   //prt_line_uc();
   //fprintf(fp,"\n");
   line_no = line_no + 1;	 
   end_of_subsidy=1;
}
get_inv_type()
{
	d_inv_doc_type_code.arr[0] ='\0';
	d_inv_doc_type_code.len=0;
	d_inv_doc_number.arr[0] ='\0';
	d_inv_doc_number.len=0;
	d_drg_inv_yn.arr[0]='\0';
	d_drg_inv_yn.len=0;
	d_inv_cust_grp.arr[0]='\0';
	d_inv_cust_grp.len=0;
	d_inv_cust_code.arr[0]='\0';
	d_inv_cust_code.len=0;
	d_inv_policy_type_code.arr[0]='\0';
	d_inv_policy_type_code.len=0;
	d_inv_episode_type.arr[0]='\0';
	d_inv_episode_type.len=0;
	d_ref_source_code_sub.arr[0]='\0';
	d_ref_source_code_sub.len=0;
	d_inv_patient.arr[0]='\0';
	d_inv_patient.len=0;
    d_inv_pat_name.arr[0]='\0';
	d_inv_pat_name.len=0;
	d_ref_episode_id.arr[0]='\0';
	d_ref_episode_id.len=0;
	d_ref_episode_type.arr[0]='\0';
	d_ref_episode_type.len=0;
	d_ref_visit_id.arr[0]='\0';
	d_ref_visit_id.len=0;
		
  /* COMMENTED FOR PE CORRECTION
  EXEC SQL SELECT DOC_TYPE_CODE,DOC_NUM,
				  NVL(DRG_INV_YN,'N'),
				  (NVL(DRG_PMNT_CCU_FACTOR,1)*DRG_PMNT_ADJRW)FINAL_FACTOR,
				  DRG_PMNT_AMT_PER_ADJRW BASE_RATE,
				  ((NVL(DRG_PMNT_CCU_FACTOR,1)*DRG_PMNT_ADJRW)*DRG_PMNT_AMT_PER_ADJRW)ADJRW,
				  NVL(NONDRG_NET_AMT,0)NON_DRG_AMT, 	
				  (NVL(ORG_DRG_NET_AMT,0)-NVL(DRG_REIM_AMT,0))INV_AMT,
				  CUST_GROUP_CODE,
				  CUST_CODE,
				  POLICY_TYPE_CODE,
				  EPISODE_TYPE,
				  REF_SOURCE_CODE_SUB,
				  PATIENT_ID,
				  REF_EPISODE_ID,
				  REF_EPISODE_TYPE,
				  REF_VISIT_ID
		   INTO   :d_inv_doc_type_code,
				  :d_inv_doc_number,
				  :d_drg_inv_yn,
				  :d_factor,
				  :d_drg_base_rate,
				  :d_adjrw,
				  :d_non_drg_amt,
				  :d_inv_amt,
				  :d_inv_cust_grp,
				  :d_inv_cust_code,
				  :d_inv_policy_type_code,
				  :d_inv_episode_type,
				  :d_ref_source_code_sub,
				  :d_inv_patient,
				  :d_ref_episode_id,
				  :d_ref_episode_type,
				  :d_ref_visit_id
		   FROM    BL_INV_DBN_CRN_INT_HDR
		   WHERE   NVL(CANCELLED_YN,'N')='N'
		   AND     OPERATING_FACILITY_ID=:nd_facility_id
		   AND     (DOC_TYPE_CODE,DOC_NUM) IN(
					   SELECT  DISTINCT ALL_DOC_TYPE_CODE,ALL_DOC_NUM
					   FROM    BL_PATIENT_LEDGER
					   WHERE   ORG_DOC_TYPE_CODE =:d_doc_type_code1
					   AND     ORG_DOC_NUM =:d_doc_number1
					   AND     OPERATING_FACILITY_ID=:nd_facility_id); */

/*ADDED FOR PE CORRECTION ADDED PATIENT ID*/
     EXEC SQL SELECT DOC_TYPE_CODE,DOC_NUM,
				  NVL(DRG_INV_YN,'N'),
				  (NVL(DRG_PMNT_CCU_FACTOR,1)*DRG_PMNT_ADJRW)FINAL_FACTOR,
				  DRG_PMNT_AMT_PER_ADJRW BASE_RATE,
				  ((NVL(DRG_PMNT_CCU_FACTOR,1)*DRG_PMNT_ADJRW)*DRG_PMNT_AMT_PER_ADJRW)ADJRW,
				  NVL(NONDRG_NET_AMT,0)NON_DRG_AMT, 	
				  (NVL(ORG_DRG_NET_AMT,0)-NVL(DRG_REIM_AMT,0))INV_AMT,
				  CUST_GROUP_CODE,
				  CUST_CODE,
				  POLICY_TYPE_CODE,
				  EPISODE_TYPE,
				  REF_SOURCE_CODE_SUB,
				  PATIENT_ID,
				  REF_EPISODE_ID,
				  REF_EPISODE_TYPE,
				  REF_VISIT_ID
		   INTO   :d_inv_doc_type_code,
				  :d_inv_doc_number,
				  :d_drg_inv_yn,
				  :d_factor,
				  :d_drg_base_rate,
				  :d_adjrw,
				  :d_non_drg_amt,
				  :d_inv_amt,
				  :d_inv_cust_grp,
				  :d_inv_cust_code,
				  :d_inv_policy_type_code,
				  :d_inv_episode_type,
				  :d_ref_source_code_sub,
				  :d_inv_patient,
				  :d_ref_episode_id,
				  :d_ref_episode_type,
				  :d_ref_visit_id
		   FROM    BL_INV_DBN_CRN_INT_HDR
		   WHERE   NVL(CANCELLED_YN,'N')='N'
		   AND     OPERATING_FACILITY_ID=:nd_facility_id
		   AND     patient_id=:d1_patient_id //ADDED PATIENT ID FOR PE CORRECTION
		   AND     (DOC_TYPE_CODE,DOC_NUM) IN(
					   SELECT  DISTINCT ALL_DOC_TYPE_CODE,ALL_DOC_NUM
					   FROM    BL_PATIENT_LEDGER
					   WHERE   ORG_DOC_TYPE_CODE =:d_doc_type_code1
					   AND     ORG_DOC_NUM =:d_doc_number1
					   AND     OPERATING_FACILITY_ID=:nd_facility_id);

/*ADDED FOR PE CORRECTION ADDED PATIENT ID*/
		

	 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_INV_DBN_CRN_INT_HDR TABLE");
	  }
 
   
  d_inv_doc_type_code.arr[d_inv_doc_type_code.len]='\0';
  d_inv_doc_number.arr[d_inv_doc_number.len]='\0';	
  d_drg_inv_yn.arr[d_drg_inv_yn.len]='\0';
  d_inv_cust_grp.arr[d_inv_cust_grp.len]='\0';
  d_inv_cust_code.arr[d_inv_cust_code.len]='\0';
  d_inv_policy_type_code.arr[d_inv_policy_type_code.len]='\0';
  d_inv_episode_type.arr[d_inv_episode_type.len]='\0';
  d_ref_source_code_sub.arr[d_ref_source_code_sub.len]='\0';
  d_inv_patient.arr[d_inv_patient.len]='\0';
  d_ref_episode_id.arr[d_ref_episode_id.len]='\0';
  d_ref_episode_type.arr[d_ref_episode_type.len]='\0';
  d_ref_visit_id.arr[d_ref_visit_id.len]='\0';

  EXEC SQL select decode(:nd_lang_id,'en',short_name,SHORT_NAME_LOC_LANG)  
		   into :d_inv_pat_name 
		   from mp_patient_mast
		   where patient_id=:d_inv_patient;

    d_inv_pat_name.arr[d_inv_pat_name.len]='\0';
	
}

get_other_payer_amt()
{
	  d_chk_drg_reim_spec_yn.arr[0]='\0';
	  d_chk_drg_reim_spec_yn.len=0;
	  d_drg_reim_spec_grp.arr[0]='\0';
	  d_drg_reim_spec_grp.len=0;

	  l_errorlevel.arr[0] = '\0';
	  l_errorlevel.len = 0;

	  l_sysmessageid.arr[0] = '\0';
	  l_sysmessageid.len = 0;

	  l_errortext.arr[0] = '\0';
	  l_errortext.len = 0;
	
		
	EXEC SQL EXECUTE
	DECLARE
		l_adjrw    NUMBER;
		l_exp_less_perc NUMBER;
		l_drg_payer_yn VARCHAR2(1);
		l_payment_bas_ind VARCHAR2(5);
	BEGIN

		l_drg_payer_yn:=blcommon.get_drg_adjrw_amt_by_payer(
     					:nd_facility_id,
						:d_inv_episode_type,
						:d_inv_cust_grp,
						:d_inv_cust_code,
						:d_inv_policy_type_code,
						:d_ref_source_code_sub,
						 l_payment_bas_ind,
						 l_adjrw,
						 l_exp_less_perc,
						:d_chk_drg_reim_spec_yn,
						:d_drg_reim_spec_grp,
						:l_errorlevel,
						:l_sysmessageid,
						:l_errortext);

  
		if :l_sysmessageid is not null then
			:l_errorlevel := '10';
			:l_errortext := blcommon.get_error_text(:l_sysmessageid);
		end if;

	END;
	END-EXEC;
		if(strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
		{
		   proc_exit(0);
		}

		l_errorlevel.arr[0] = '\0';
		l_errorlevel.len = 0;

		l_sysmessageid.arr[0] = '\0';
		l_sysmessageid.len = 0;

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;

		d_chk_drg_reim_spec_yn.arr[d_chk_drg_reim_spec_yn.len]='\0';
		d_drg_reim_spec_grp.arr[d_drg_reim_spec_grp.len]='\0';
   
}
get_prev_stled_amt()
{
  
  
    //EXEC SQL  SELECT NVL(B.SETTLED_AMT,0) 
	//		  INTO :d_inv_settled_amt
	//		  FROM(
	//		  SELECT MAX(SLMT_DOC_NUM)SLMT_DOC_NUM
	//		  FROM BL_CUST_PAYMENT_REF_DTL
	//		  WHERE OPERATING_FACILITY_ID=:nd_facility_id
	//		  AND DOC_TYPE_CODE||'/'||DOC_NUMBER=:d_inv_doc_type_code||'/'||:d_inv_doc_number
	//		  AND SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM!=:d_doc_type_code1||'/'||:d_doc_number1
	//		  )A,BL_CUST_PAYMENT_REF_DTL B
	//		  WHERE A.SLMT_DOC_NUM=B.SLMT_DOC_NUM
	//		  AND B.DOC_TYPE_CODE||'/'||B.DOC_NUMBER=:d_inv_doc_type_code||'/'||:d_inv_doc_number
	//		  AND B.OPERATING_FACILITY_ID=:nd_facility_id;
	
	 EXEC SQL  Select SUM(NVL(Settled_Amt,0))
	          Into :d_inv_settled_amt
	          From (
                          Select (A.Settled_Amt) Settled_Amt From BL_CUST_PAYMENT_REF_DTL A
                          Where SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM!=:d_doc_type_code1||'/'||:d_doc_number1
                            And DOC_TYPE_CODE||'/'||DOC_NUMBER=:d_inv_doc_type_code||'/'||:d_inv_doc_number
                            And Added_Date < (Select Added_Date 
                                              From BL_CUST_PAYMENT_REF_DTL B
                                              Where SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM=:d_doc_type_code1||'/'||:d_doc_number1
                                             )
                                              ORDER BY ADDED_DATE DESC  
                                  ); 
	
	 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_CUST_PAYMENT_REF_DTL TABLE");
	  }			   	 

     EXEC SQL  Select SUM(NVL(Settled_Amt,0))
	           Into :nd_tot_paid_amt
	           From (
                          Select (A.Settled_Amt) Settled_Amt From BL_CUST_PAYMENT_REF_DTL A
                          Where SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM!=:d_doc_type_code1||'/'||:d_doc_number1
                            And DOC_TYPE_CODE||'/'||DOC_NUMBER=:d_inv_doc_type_code||'/'||:d_inv_doc_number
                            And Added_Date < (Select Added_Date 
                                              From BL_CUST_PAYMENT_REF_DTL B
                                              Where SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM=:d_doc_type_code1||'/'||:d_doc_number1
                                             )
                                  );

	 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_CUST_PAYMENT_REF_DTL TABLE");
	  }	

					   		 
}
/** The below code added by raghava on 20/09/2010 as per vinod **/
get_spec_grp_setld_amt()
{
    nd_spec_payer_srv_grp_stld_amt=0;


	EXEC SQL SELECT Sum(SETTLED_AMT) NET_AMT
			 INTO    :nd_spec_payer_srv_grp_stld_amt 
			 FROM    BL_INV_PAYER_SERV_SLMT_DTL  A
			 WHERE   OPERATING_FACILITY_ID = :nd_facility_id
			 AND     TRX_STATUS Is Null
			 AND     NVL(SLMT_ADJ_IND,'X')!='V'
			 AND     SLMT_DOC_TYPE_CODE=:d_doc_type_code1
			 AND     SLMT_DOC_NUM = :d_doc_number1
			 AND     EXISTS (SELECT 'X' FROM  BL_INV_DBN_CRN_INT_HDR B 
							 WHERE A.DOC_TYPE_CODE=B.DOC_TYPE_CODE
							 AND   A.DOC_NUM =B.DOC_NUM
					        )
             AND     SERV_GRP_HDR_CODE=:d_spec_payer_srv_grp_for_df
             AND     SERV_GRP_LINE_CODE=:d_spec_payer_srv_grp_line_df;
	     
 	 
	 
	 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_INV_PAYER_SERV_SLMT_DTL TABLE");
	  }	



}
/** upto here **/
get_txt_for_inv_rcpt()
{
  
  
EXEC SQL EXECUTE

	BEGIN

		bl_generate_invoice.get_disp_format_by_payer
				(:nd_facility_id,                
				:d_inv_cust_grp,
				:d_inv_cust_code,
				:d_inv_policy_type_code,       
				'Y',							
				'Y',               
				'Y',               
				'Y',        
				:d_let_body_header_ln01,      
				:d_let_body_header_ln02,       
				:d_let_body_header_ln03,       
				:d_let_body_header_ln04,       
				:d_let_body_header_ln05,       
				:d_let_body_footer_ln01,       
				:d_let_body_footer_ln02,       
				:d_let_body_footer_ln03,       
				:d_let_body_footer_ln04,       
				:d_let_body_footer_ln05,       
				:d_let_foot_note_ln01,         
				:d_let_foot_note_ln02,         
				:d_let_foot_note_ln03,         
				:d_let_foot_note_ln04,        
				:d_let_foot_note_ln05,         
				:d_authorized_signatory,       
				:d_authorized_signatory_desg,  
				:d_outstd_doc_in_annex_only_yn,
				:d_inv_auth_signatory,         
				:d_inv_auth_signatory_desg,    
				:d_disd_let_auto_finalize_yn,  
				:d_disd_let_auto_acceptance_yn,
				:d_inv_issueing_signatory,     
				:d_inv_issueing_signatory_desg, 
				:d_print_text_for_markup,       
				:d_print_text_for_markdown,     
				:d_print_text_for_drg,          
				:d_print_text_for_rcpt,
				:d_print_renal_inv_no_yn,      
				:d_disp_doc_print_rule_ind,      
				:d_gen_disp_for_printed_inv_yn,
				:d_print_cons_dur_inv_print,   
				:d_inv_print_rule_ind,  
				:v_print_format,                        
				:l_errorlevel,
				:l_sysmessageid,
				:l_errortext);
  
		if :l_sysmessageid is not null then
			:l_errorlevel := '10';
			:l_errortext := blcommon.get_error_text(:l_sysmessageid);
		end if;

	END;
	END-EXEC;

		if(strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
		{
		   proc_exit(0);
		}

		l_errorlevel.arr[0] = '\0';
		l_errorlevel.len = 0;

		l_sysmessageid.arr[0] = '\0';
		l_sysmessageid.len = 0;

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;

		d_let_body_header_ln01.arr[d_let_body_header_ln01.len]='\0';
		d_let_body_header_ln02.arr[d_let_body_header_ln02.len]='\0';	
		d_let_body_header_ln03.arr[d_let_body_header_ln03.len]='\0';	
		d_let_body_header_ln04.arr[d_let_body_header_ln04.len]='\0';	
		d_let_body_header_ln05.arr[d_let_body_header_ln05.len]='\0';	
		d_let_body_footer_ln01.arr[d_let_body_footer_ln01.len]='\0';	
		d_let_body_footer_ln02.arr[d_let_body_footer_ln02.len]='\0';	
		d_let_body_footer_ln03.arr[d_let_body_footer_ln03.len]='\0';	
		d_let_body_footer_ln04.arr[d_let_body_footer_ln04.len]='\0';	
		d_let_body_footer_ln05.arr[d_let_body_footer_ln05.len]='\0';	
		d_let_foot_note_ln01.arr[d_let_foot_note_ln01.len]='\0';	
		d_let_foot_note_ln02.arr[d_let_foot_note_ln02.len]='\0';	
		d_let_foot_note_ln03.arr[d_let_foot_note_ln03.len]='\0';	
		d_let_foot_note_ln04.arr[d_let_foot_note_ln04.len]='\0';	
		d_let_foot_note_ln05.arr[d_let_foot_note_ln05.len]='\0';	
		d_authorized_signatory.arr[d_authorized_signatory.len]='\0';	
		d_authorized_signatory_desg.arr[d_authorized_signatory_desg.len]='\0';	
		d_outstd_doc_in_annex_only_yn.arr[d_outstd_doc_in_annex_only_yn.len]='\0';	
		d_inv_auth_signatory.arr[d_inv_auth_signatory.len]='\0';	
		d_inv_auth_signatory_desg.arr[d_inv_auth_signatory_desg.len]='\0';	
		d_disd_let_auto_finalize_yn.arr[d_disd_let_auto_finalize_yn.len]='\0';	
		d_disd_let_auto_acceptance_yn.arr[d_disd_let_auto_acceptance_yn.len]='\0';	
		d_inv_issueing_signatory.arr[d_inv_issueing_signatory.len]='\0';	
		d_inv_issueing_signatory_desg.arr[d_inv_issueing_signatory_desg.len]='\0';	
		d_print_text_for_markup.arr[d_print_text_for_markup.len]='\0';	
		d_print_text_for_markdown.arr[d_print_text_for_markdown.len]='\0';	
		d_print_text_for_drg.arr[d_print_text_for_drg.len]='\0';	
		d_print_text_for_rcpt.arr[d_print_text_for_rcpt.len]='\0';
		d_print_renal_inv_no_yn.arr[d_print_renal_inv_no_yn.len]='\0';	
		d_disp_doc_print_rule_ind.arr[d_disp_doc_print_rule_ind.len]='\0';
		d_gen_disp_for_printed_inv_yn.arr[d_gen_disp_for_printed_inv_yn.len]='\0';
		d_print_cons_dur_inv_print.arr[d_print_cons_dur_inv_print.len]='\0';
		d_inv_print_rule_ind.arr[d_inv_print_rule_ind.len]='\0';		

}
get_inv_param_setup()
{
  
  d_print_patient_dtl_yn.arr[0]='\0';
  d_print_patient_dtl_yn.len=0;
  d_print_text_for_drg_rcpt.arr[0]='\0';
  d_print_text_for_drg_rcpt.len=0;
  d_spec_payer_srv_grp_for_df.arr[0]='\0';
  d_spec_payer_srv_grp_for_df.len=0;
  d_spec_payer_srv_grp_line_df.arr[0]='\0';
  d_spec_payer_srv_grp_line_df.len=0;
  d_print_text_for_spec_grp_rcpt.arr[0]='\0';
  d_print_text_for_spec_grp_rcpt.len=0;


  EXEC SQL EXECUTE
  DECLARE
   v_PRINT_PATIENT_DTL_YN            varchar2(1);
   v_PRINT_TEXT_FOR_DRG_RCPT         varchar2(60);
   v_SPEC_PAYER_SRV_GRP_FOR_DF       BL_PAYER_SERV_GRP_LINE.PAYER_SERV_GRP_HDR%Type;
   v_SPEC_PAYER_SRV_GRP_LINE_DF      BL_PAYER_SERV_GRP_LINE.PAYER_SERV_GRP_LINE%Type;
   v_PRINT_TEXT_FOR_SPEC_GRP_RCPT    varchar2(60);

  BEGIN
   Begin
    select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
			SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
			PRINT_TEXT_FOR_SPEC_GRP_RCPT
	into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
	       v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
           v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
	from   BL_INV_CUST_PARAM
	where  OPERATING_FACILITY_ID=:nd_facility_id
	and    CUST_GROUP_CODE=:d_inv_cust_grp
	and    CUST_CODE=:d_inv_cust_code
	and    POLICY_TYPE_CODE=:d_inv_policy_type_code;
   Exception
    When No_Data_Found Then
	   Begin
		select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
				SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
			    PRINT_TEXT_FOR_SPEC_GRP_RCPT
		into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
			   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
               v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
		from   BL_INV_CUST_PARAM
		where  OPERATING_FACILITY_ID=:nd_facility_id
		and    CUST_GROUP_CODE=:d_inv_cust_grp
		and    CUST_CODE='**'
		and    POLICY_TYPE_CODE=:d_inv_policy_type_code;
	   Exception
		When No_Data_Found Then
		   Begin
			select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
					SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
					PRINT_TEXT_FOR_SPEC_GRP_RCPT
			into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
				   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                   v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
			from   BL_INV_CUST_PARAM
			where  OPERATING_FACILITY_ID=:nd_facility_id
			and    CUST_GROUP_CODE=:d_inv_cust_grp
			and    CUST_CODE=:d_inv_cust_code
			and    POLICY_TYPE_CODE='**';
		   Exception
			When No_Data_Found Then
			   Begin
				select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
					    SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
					    PRINT_TEXT_FOR_SPEC_GRP_RCPT
				into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
					   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                       v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
				from   BL_INV_CUST_PARAM
				where  OPERATING_FACILITY_ID=:nd_facility_id
				and    CUST_GROUP_CODE=:d_inv_cust_grp
				and    CUST_CODE='**'
				and    POLICY_TYPE_CODE='**';
			   Exception
				When No_Data_Found Then
				   Begin
					select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
							SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
							PRINT_TEXT_FOR_SPEC_GRP_RCPT
					into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
						   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                           v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
					from   BL_INV_CUST_PARAM
					where  OPERATING_FACILITY_ID=:nd_facility_id
					and    CUST_GROUP_CODE='**'
					and    CUST_CODE=:d_inv_cust_code
					and    POLICY_TYPE_CODE=:d_inv_policy_type_code;
				   Exception
					When No_Data_Found Then
					   Begin
						select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
								SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
								PRINT_TEXT_FOR_SPEC_GRP_RCPT
						into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
							   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                               v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
						from   BL_INV_CUST_PARAM
						where  OPERATING_FACILITY_ID=:nd_facility_id
						and    CUST_GROUP_CODE='**'
						and    CUST_CODE='**'
						and    POLICY_TYPE_CODE=:d_inv_policy_type_code;
					   Exception
						When No_Data_Found Then
						   Begin
							select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
									SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
									PRINT_TEXT_FOR_SPEC_GRP_RCPT
							into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
								   v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                                   v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
							from   BL_INV_CUST_PARAM
							where  OPERATING_FACILITY_ID=:nd_facility_id
							and    CUST_GROUP_CODE='**'
							and    CUST_CODE=:d_inv_cust_code
							and    POLICY_TYPE_CODE='**';
						   Exception
							When No_Data_Found Then
							   Begin
								select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT,
									    SPEC_PAYER_SRV_GRP_FOR_DF,SPEC_PAYER_SRV_GRP_LINE_FOR_DF,
									    PRINT_TEXT_FOR_SPEC_GRP_RCPT
								into   v_PRINT_PATIENT_DTL_YN,v_PRINT_TEXT_FOR_DRG_RCPT,
								       v_SPEC_PAYER_SRV_GRP_FOR_DF,v_SPEC_PAYER_SRV_GRP_LINE_DF,
                                       v_PRINT_TEXT_FOR_SPEC_GRP_RCPT
								from   BL_INV_CUST_PARAM
								where  OPERATING_FACILITY_ID=:nd_facility_id
								and    CUST_GROUP_CODE='**'
								and    CUST_CODE='**'
								and    POLICY_TYPE_CODE='**';
							   Exception
								When No_Data_Found Then
								  Begin
									select  nvl(PRINT_PATIENT_DTL_YN,'N'),PRINT_TEXT_FOR_DRG_INV_RCPT
									into   v_PRINT_PATIENT_DTL_YN,v_SPEC_PAYER_SRV_GRP_LINE_DF
									from   BL_INV_FACILITY_PARAM
									where  OPERATING_FACILITY_ID=:nd_facility_id;
								  Exception
									When Others Then v_PRINT_PATIENT_DTL_YN:='N';
								   End;
							   End;
						   End;
					   End;
				   
				   End;
			   End;
		   End;
	   End;
   End;
   :d_print_patient_dtl_yn			 :=v_PRINT_PATIENT_DTL_YN;
   :d_print_text_for_drg_rcpt		 :=v_PRINT_TEXT_FOR_DRG_RCPT;
   :d_spec_payer_srv_grp_for_df		 :=v_SPEC_PAYER_SRV_GRP_FOR_DF;
   :d_spec_payer_srv_grp_line_df	 :=v_SPEC_PAYER_SRV_GRP_LINE_DF;
   :d_print_text_for_spec_grp_rcpt	 :=v_PRINT_TEXT_FOR_SPEC_GRP_RCPT;
  END;
 
  END-EXEC;

 d_print_patient_dtl_yn.arr[d_print_patient_dtl_yn.len]='\0';
 d_print_text_for_drg_rcpt.arr[d_print_text_for_drg_rcpt.len]='\0';
 d_spec_payer_srv_grp_for_df.arr[d_spec_payer_srv_grp_for_df.len]='\0';
 d_spec_payer_srv_grp_line_df.arr[d_spec_payer_srv_grp_line_df.len]='\0';
 d_print_text_for_spec_grp_rcpt.arr[d_print_text_for_spec_grp_rcpt.len]='\0';


}
print_invoice_receipt()
{
 int len=0;
 char s_amt[30];


  /** the below code added by raghava on 18/03/2010 at BKK ***/
   chk_inv_recpt_yn();
  /*** upto here ***/
  get_inv_param_setup();
  print_hdr_cnt=print_hdr_cnt+1;
  if(print_hdr_cnt==1) 
  {
	 print_report_header();
  }
  

 if(d_spec_payer_srv_grp_for_df.arr[0]!='\0' && d_spec_payer_srv_grp_line_df.arr[0]!='\0')
 {
  get_spec_grp_setld_amt(); //added by raghava on 20/09/2010 as per vinod
 }
  if(strcmp(nd_preprint_flag.arr,"N")==0)
  {
	  prt_line_uc();
	  fprintf(fp,"\n");
	  lsr_line_cnt();
	  //fprintf(fp,"%-67.67s (%-s %-s%-s\n"," ",loc_legend67.arr,cur_str.arr,")");	
	  
	  if (l_lsr!=0 && l_dmp==0)
	  {
	   //fprintf(fp,"%c(s3B",ESC); 
	   //fprintf(fp,"%-67.67s (%-s%-s"," ",cur_str.arr,")");
	   //fprintf(fp,"%c(s-3B",ESC);	
	   //fprintf(fp,"\n");
	   fprintf(fp,"%c(s3B",ESC);
	   //fprintf(fp,"%-7.7s%-55.55s%12.12s    %16.16s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr); FOR ICN-319
	   fprintf(fp,"%-7.7s%-55.55s%12.12s    %-s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
	   fprintf(fp,"%c(s-3B",ESC);	
	   fprintf(fp,"\n");
      }
	  else // Added By Kalyan On 24 JUN 2009 FOR IN11702
	  {
          //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  //fprintf(fp,"%-67.67s (%-s%-s"," ",cur_str.arr,")");
		  //fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
		  //fprintf(fp,"\n");
		  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  //fprintf(fp,"%-7.7s%-55.55s%12.12s    %16.16s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr); FOR ICN-319
		  fprintf(fp,"%-7.7s%-55.55s%12.12s    %-s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		  fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
		  fprintf(fp,"\n");
	  }



	  prt_line_uc();
	  fprintf(fp,"\n");
	  lsr_line_cnt();
  }
  else
  {
      fprintf(fp,"\n");
	  lsr_line_cnt();
  }
  //fprintf(fp," %-7.7s (%-s%-s %64.64s ",sub_print_text.arr,nd_episode_type.arr,")"," ");
  get_txt_for_inv_rcpt();
  //The below code added by raghava on 20/09/2010 for siriraj as per vinod
  if(d_drg_inv_yn.arr[0]=='Y') 
  {
    if(d_receipt_by_inv_yn.arr[0]=='Y')
	fprintf(fp," %-59.59s",d_print_text_for_drg_rcpt.arr);
	else
	fprintf(fp," %-59.59s",d_print_text_for_rcpt.arr);
  }
  else
  {
   //upto here 20/09/2010
   fprintf(fp," %-59.59s",d_print_text_for_rcpt.arr);
  }
  
  //fprintf(fp," %-10.10s   %64.64s ",sub_print_text.arr," "); Commented by raghava ar BKK on 13/03/2010 text need to take from invoice param
  //added by raghava on 20/09/2010 as per vinod
  if(d_print_text_for_spec_grp_rcpt.arr[0]!='\0' && nd_spec_payer_srv_grp_stld_amt!=0) 
  {
   print_formated_amt(d_oth_receipt_amt-nd_spec_payer_srv_grp_stld_amt);
  }
  else
  {
   print_formated_amt(d_oth_receipt_amt);
  }

  fprintf(fp,"\n");
  lsr_line_cnt();

  if(d_print_text_for_spec_grp_rcpt.arr[0]!='\0' && nd_spec_payer_srv_grp_stld_amt!=0) 
  {
    fprintf(fp," %-59.59s",d_print_text_for_spec_grp_rcpt.arr);
	print_formated_amt(nd_spec_payer_srv_grp_stld_amt);
    fprintf(fp,"\n");
    lsr_line_cnt();
  }

  /** Added on 10/12/2008 for DRG related **/  

  if(d_drg_inv_yn.arr[0]=='Y') 
  {
  
	if (l_lsr!=0 && l_dmp==0)
	{ 
	   fprintf(fp,"%c(s0P",ESC);	/* To fix the Primary Spacing */
	   fprintf(fp,"%c(s4099T",ESC); /* To set the font name	      */
	   fprintf(fp,"%c(s12H",ESC);	/* To set the font size	      */
	   fprintf(fp,"%c&l8D",ESC); 	/* To set vertical lines per inch */
	   fprintf(fp,"\n");lsr_line_cnt(); 
	   get_other_payer_amt();
	   get_drg_other_payer_amt();
	   get_prev_stled_amt();
	   //get_txt_for_inv_rcpt();
	   //fprintf(fp,"   %-25.25s",d_print_text_for_rcpt.arr);
	   //fprintf(fp,"   %-25.25s",d_print_text_for_drg.arr); commneted by raghava on 20/09/2010 as per vinod
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(tlc,1);
	   replicate(hl,80);
	   replicate(trc,1);
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(vl,1);
	   fprintf(fp,"%-s = ",loc_legend1300.arr);
	   //fprintf(fp,"%-5.5s = ",loc_legend1300.arr); 
	   len=9;
	   print_formated_amt3(d_factor);
	   put_val(s_amt,d_factor);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+1;
	   fprintf(fp,"%-s","X");
	   print_formated_amt3(d_drg_base_rate);
	   put_val(s_amt,d_drg_base_rate);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+2;
	   fprintf(fp,"    %-s =",loc_legend100.arr);
	   len=len+strlen(loc_legend100.arr)+6;
	   print_formated_amt3(d_adjrw);
	   put_val(s_amt,d_drg_base_rate);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+1;
	   replicate(' ',(80-len));
	   replicate(vl,1);
	   fprintf(fp,"\n");lsr_line_cnt();
	   len=0;
	   replicate(' ',2);
	   replicate(vl,1);
	   fprintf(fp,"%s =",loc_legend1310.arr);
	   print_formated_amt3(d_non_drg_amt);
	   put_val(s_amt,d_non_drg_amt);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+strlen(loc_legend1310.arr)+3;
	   fprintf(fp,"  %s =",loc_legend1320.arr);
	   print_formated_amt3(d_other_payable_amt);
	   put_val(s_amt,d_other_payable_amt);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+strlen(loc_legend1320.arr)+5;
	   replicate(' ',(80-len));
	   replicate(vl,1);
	   len=0;
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(vl,1);
	   fprintf(fp,"%s =",loc_legend1330.arr);
	   print_formated_amt3(d_inv_amt);
	   put_val(s_amt,d_inv_amt);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+strlen(loc_legend1330.arr)+3;
	   replicate(' ',(80-len));
	   replicate(vl,1);
	   len=0;
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(vl,1);

	   fprintf(fp,"%s =",loc_legend1340.arr);
	   print_formated_amt3(d_inv_settled_amt);
	   put_val(s_amt,d_inv_settled_amt);         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+strlen(loc_legend1340.arr)+3;
	   replicate(' ',(80-len));
	   replicate(vl,1);
	   len=0;
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(vl,1);
	   fprintf(fp,"%s =",loc_legend89.arr);
	   print_formated_amt3(d_inv_amt-d_oth_receipt_amt-nd_tot_paid_amt);
	   put_val(s_amt,(d_inv_amt-d_oth_receipt_amt-nd_tot_paid_amt));         
	   format_amt(s_amt);
	   len=len+strlen(s_amt)+strlen(loc_legend89.arr)+3;
	   replicate(' ',(80-len));
	   replicate(vl,1);
	   len=0;
	   fprintf(fp,"\n");lsr_line_cnt();
	   replicate(' ',2);
	   replicate(blc,1);
	   replicate(hl,80);
	   replicate(brc,1);
   
	   fprintf(fp,"\n");lsr_line_cnt();
	}
   else
   {
       get_other_payer_amt();
	   get_drg_other_payer_amt();
	   get_prev_stled_amt();
	   get_txt_for_inv_rcpt();
	   //fprintf(fp,"   %-25.25s",d_print_text_for_drg.arr); commneted by raghava on 20/09/2010 as per vinod
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"%-s = ",loc_legend1300.arr);
	   //fprintf(fp,"%-5.5s = ",loc_legend1300.arr);
	   print_formated_amt3(d_factor);
	   fprintf(fp,"%-s","X");
	   print_formated_amt3(d_drg_base_rate);
	   fprintf(fp,"    %-s =",loc_legend100.arr);
	   print_formated_amt3(d_adjrw);
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"%s =",loc_legend1310.arr);
	   print_formated_amt3(d_non_drg_amt);
	   fprintf(fp,"  %s =",loc_legend1320.arr);
	   print_formated_amt3(d_other_payable_amt);
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"%s =",loc_legend1330.arr);
	   print_formated_amt3(d_inv_amt);
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"%s =",loc_legend1340.arr);
	   print_formated_amt3(d_inv_settled_amt);
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"%s =",loc_legend89.arr);
	   print_formated_amt3(d_inv_amt-d_oth_receipt_amt);
	   fprintf(fp,"\n");lsr_line_cnt();
	   fprintf(fp,"\n");lsr_line_cnt();
   }
  }
  /** upto **/

  if (l_lsr!= 0 && l_dmp== 0)
  fprintf(fp,"%c(s14H",ESC);	/* To set the font size	      */
  
  if(strcmp(nd_preprint_flag.arr,"N")==0)
  {
	  prt_line_uc();
	  fprintf(fp,"\n");
	  lsr_line_cnt();
  }
  
  fprintf(fp,"%54.54s      ",loc_legend68.arr);
  print_formated_amt(d_oth_receipt_amt);
  fprintf(fp,"\n");
  lsr_line_cnt();
  fprintf(fp,"%60.60s",loc_legend54.arr);
  print_formated_amt(d_oth_receipt_amt);
  fprintf(fp,"\n");
  lsr_line_cnt();
  if(d_receipt_by_inv_yn.arr[0]=='Y')
  fprintf(fp," %-s:%-s/%-s\n",loc_legend1450.arr,d_inv_doc_type_code.arr,d_inv_doc_number.arr);
  else
  fprintf(fp," %-s:%-s\n",loc_legend1450.arr,d_pmnt_ref_num.arr);
 

}
chk_inv_recpt_yn()
{
  
  d_receipt_by_inv_yn.arr[0]='\0';
  d_receipt_by_inv_yn.len=0;
  d_pmnt_ref_num.arr[0]='\0';
  d_pmnt_ref_num.len=0;
  
  EXEC SQL SELECT DISTINCT NVL(RECEIPT_BY_INV_YN,'N'),A.PMNT_REF_NUM
		   INTO   :d_receipt_by_inv_yn,:d_pmnt_ref_num
           FROM   BL_CUST_PAYMENT_REF_HDR A,BL_CUST_PAYMENT_REF_DTL B
		   WHERE  A.OPERATING_FACILITY_ID=B.OPERATING_FACILITY_ID
		   AND    A.PMNT_REF_NUM=B.PMNT_REF_NUM
		   AND    A.OPERATING_FACILITY_ID=:nd_facility_id
		   AND    SLMT_DOC_TYPE_CODE=:d_doc_type_code1
		   AND    SLMT_DOC_NUM=:d_doc_number1;
		   


d_receipt_by_inv_yn.arr[d_receipt_by_inv_yn.len]='\0';
d_pmnt_ref_num.arr[d_pmnt_ref_num.len]='\0';
}
get_drg_other_payer_amt()
{
	if(d_chk_drg_reim_spec_yn.arr[0]=='N' && d_drg_reim_spec_grp.arr[0]=='\0')
	{
	   EXEC SQL	SELECT SUM(NVL(DRG_REIM_AMT,0))OTHER_PAYABLE_AMT
				INTO :d_other_payable_amt
				FROM BL_INV_DBN_CRN_INT_HDR
				WHERE 
				OPERATING_FACILITY_ID=:nd_facility_id AND --ADDED OPERATING FACILITY ID FOR PE CORRECTION
				ACC_ENTITY_CODE= (SELECT acc_entity_code 
			   							FROM sy_acc_entity
										WHERE acc_entity_id =:nd_facility_id)
				AND (PATIENT_ID,EPISODE_TYPE,EPISODE_ID,ACCT_SEQ_NO)IN
								(SELECT PATIENT_ID,EPISODE_TYPE,EPISODE_ID,ACCT_SEQ_NO 
								FROM BL_INV_DBN_CRN_INT_HDR
								WHERE DOC_TYPE_CODE=:d_inv_doc_type_code
								AND DOC_NUM=:d_inv_doc_number
								AND OPERATING_FACILITY_ID=:nd_facility_id
								AND NVL(CANCELLED_YN,'N') ='N')
				AND cancelled_yn='N'
				AND priority <(SELECT priority
							  FROM BL_INV_DBN_CRN_INT_HDR
							  WHERE DOC_TYPE_CODE=:d_inv_doc_type_code
							  AND DOC_NUM=:d_inv_doc_number
							  AND OPERATING_FACILITY_ID=:nd_facility_id
							  AND NVL(CANCELLED_YN,'N') ='N' )
				AND Nvl(TRN_TYPE,'INV')='INV';

	}
	else
	if(d_chk_drg_reim_spec_yn.arr[0]=='Y' && d_drg_reim_spec_grp.arr[0]!='\0')
	{
	   EXEC SQL	SELECT SUM(NVL(PAYABLE_AMT,0))OTHER_PAYABLE_AMT
				INTO :d_other_payable_amt
				FROM BL_INV_DBN_CRN_INT_HDR
				WHERE ACC_ENTITY_CODE= (SELECT acc_entity_code 
			   							FROM sy_acc_entity
										WHERE acc_entity_id =:nd_facility_id)
				AND (PATIENT_ID,EPISODE_TYPE,EPISODE_ID,ACCT_SEQ_NO)IN
								(SELECT PATIENT_ID,EPISODE_TYPE,EPISODE_ID,ACCT_SEQ_NO 
								FROM BL_INV_DBN_CRN_INT_HDR
								WHERE DOC_TYPE_CODE=:d_inv_doc_type_code
								AND DOC_NUM=:d_inv_doc_number
								AND OPERATING_FACILITY_ID=:nd_facility_id
								AND NVL(CANCELLED_YN,'N') ='N')
				AND cancelled_yn='N'
				AND priority <(SELECT priority
							  FROM BL_INV_DBN_CRN_INT_HDR
							  WHERE DOC_TYPE_CODE=:d_inv_doc_type_code
							  AND DOC_NUM=:d_inv_doc_number
							  AND OPERATING_FACILITY_ID=:nd_facility_id
							  AND NVL(CANCELLED_YN,'N') ='N' )
				AND Nvl(TRN_TYPE,'INV')='INV';

	}
}
print_deposit_slip()
{

	print_deposit_header_flag=1;
	d_oth_rec_desc.arr[0] = '\0';
	d_oth_rec_desc.len    =   0 ;

	l_temp_loc_legend.arr[0]='\0';
	l_temp_loc_legend.len=0;


	EXEC SQL SELECT   SHORT_DESC 
		   INTO    :d_oth_rec_desc 
		   FROM     BL_RECEIPT_TYPE_LANG_VW
		   WHERE    RECEIPT_TYPE_CODE =:d_receipt_type_code
		   AND      RECPT_NATURE_CODE =:d_receipt_nature_code
		   AND      LANGUAGE_ID       =:nd_lang_id;

	d_oth_rec_desc.arr[d_oth_rec_desc.len] =0;
	/*
	if(d_oth_receipt_amt>=0) 
	{
		strcpy(l_temp_legend.arr,loc_legend99.arr);
		strcpy(l_temp_loc_legend.arr,"(");
		strcat(loc_legend99.arr,strcat(l_temp_loc_legend.arr,strcat(d_oth_rec_desc.arr,")")));
	}*/
	print_hdr_cnt=print_hdr_cnt+1;

	if(print_hdr_cnt==1) 
	{
	 print_report_header();
	}
	prt_line_uc();
	fprintf(fp,"\n");
	lsr_line_cnt();
	lsr_line_cnt();
	if (l_lsr!= 0 && l_dmp== 0)
	{
    fprintf(fp,"%c(s3B",ESC); 
	fprintf(fp,"%-7.7s%-60.60s  %15.15s(%s)\n"," ",loc_legend110.arr,loc_legend100.arr,cur_str.arr);
	fprintf(fp,"%c(s-3B",ESC); 	
	}
	else
	{
	 fprintf(fp,"%cE",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
	 fprintf(fp,"%-7.7s%-60.60s  %15.15s(%s)"," ",loc_legend110.arr,loc_legend100.arr,cur_str.arr);
	 fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
	 fprintf(fp,"\n"); 
	}
	prt_line_uc();
	fprintf(fp,"\n");
	lsr_line_cnt();
	if(d_oth_receipt_amt>=0) 
	{
	  fprintf(fp,"%-69.69s",loc_legend99.arr);
	  strcpy(loc_legend99.arr,l_temp_legend.arr);
    }
	else
	{
	   fprintf(fp,"%-69.69s",loc_legend1360.arr);
	}
	

	
	print_formated_amt(d_oth_receipt_amt);
	fprintf(fp,"\n");
	if(d_oth_receipt_amt>=0) 
	{
	 fprintf(fp,"%-s",d_remarks.arr);
	 fprintf(fp,"\n");
	}
	lsr_line_cnt();lsr_line_cnt();lsr_line_cnt();
 	 		 
	declare_payment_type_det();
	open_payment_cur();
 
	d_same_payer_name.arr[0]='\0';
	d_same_rcpt_rfnd_id_no.arr[0]='\0'; //ICN-275
	refidcnt=0;
	 while(fetch_payment_det_cur())
	 {

		 
	  //if(strcmp(nd_patient_name.arr,d_payer_name.arr)!=0)
      //{	
		 if(d_payer_name.arr[0]!='\0')
		  {
		  	
			if(strcmp(d_same_payer_name.arr,d_payer_name.arr)!=0)
			{ 
				refidcnt=0;
				//fprintf(fp,"\n%-s(%-s) %-s ",loc_legend94.arr,loc_legend95.arr,d_payer_name.arr);
				fprintf(fp,"\n%-s %-s ",loc_legend94.arr,d_payer_name.arr);
			}
			/*else
			{
			 fprintf(fp,",");
			} commented for ICN-275 */
		
			if(d_rcpt_rfnd_id_no.arr[0]!='\0')
			{
				
			  if(refidcnt==0)
			  {
			     if(d_cash_slmt_flag.arr[0]=='D')
			     fprintf(fp,"%-s : %-s",loc_legend1220.arr,d_rcpt_rfnd_id_no.arr);
			     else
			     fprintf(fp,"%-s : %-s",loc_legend105.arr,d_rcpt_rfnd_id_no.arr);
			     refidcnt=refidcnt+1;
			  }
			  else
			  {
			    if(strcmp(d_same_rcpt_rfnd_id_no.arr,d_rcpt_rfnd_id_no.arr)!=0) // added for ICN-275
				fprintf(fp,",%-s",d_rcpt_rfnd_id_no.arr);
	              
			  }
			
			}
			strcpy(d_same_payer_name.arr,d_payer_name.arr);
			strcpy(d_same_rcpt_rfnd_id_no.arr,d_rcpt_rfnd_id_no.arr);
			//else
			//fprintf(fp,"\n");
			
		  }
	   
	    //}
	   } //while 

	   fprintf(fp,"\n");
	   lsr_line_cnt();
	close_payment_cur();

	prt_line_uc();
	fprintf(fp,"\n");
	lsr_line_cnt();
	if (l_lsr!= 0 && l_dmp== 0)
	{
	fprintf(fp,"%c(s3B",ESC);
	fprintf(fp,"%-7.7s%-60.60s  "," ",loc_legend68.arr);
	fprintf(fp,"%c(s-3B",ESC);
	}
	else
	{
	  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	  fprintf(fp,"%-7.7s%-60.60s  "," ",loc_legend68.arr);
	  fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
	}
	print_formated_amt(d_oth_receipt_amt);
	fprintf(fp,"\n");
	lsr_line_cnt();
	prt_line_uc();
	fprintf(fp,"\n");
	lsr_line_cnt();

}
   
/* IT FETCH THE REFENCE DOCTYPE CODE,DOCNUMBER */

get_agg_type_code()
{
  
  nd_aggr_doc_type_code.arr[0]='\0';
  nd_aggr_doc_num.arr[0]	  ='\0'; 
  nd_aggr_doc_type_code.len	  =0;
  nd_aggr_doc_num.len	      =0; 


  EXEC SQL SELECT DISTINCT AGGR_DOC_TYPE_CODE,AGGR_DOC_NUM
  INTO  :nd_aggr_doc_type_code,:nd_aggr_doc_num
  FROM  BL_INST_PMNT_PLAN 
  WHERE  LAST_INST_PAID_DOC_TYPE_CODE=:d_doc_type_code1
  AND    LAST_INST_PAID_DOC_NUM      =:d_doc_number1
  AND	 OPERATING_FACILITY_ID  =:nd_facility_id;

   

 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_INST_PMNT_PLAN TABLE");
	  }
 
  nd_aggr_doc_type_code.arr[nd_aggr_doc_type_code.len]='\0';
  nd_aggr_doc_num.arr[nd_aggr_doc_num.len]		      ='\0';  

}
get_inst_nums()
{
  nd_aggr_inst_no.arr[0]='\0';
  nd_aggr_inst_no.len=0;
	
	EXEC SQL EXECUTE
	DECLARE
	 CURSOR C_INST IS
			  SELECT DISTINCT AGGR_DOC_TYPE_CODE,AGGR_DOC_NUM,AGGR_INST_NO
			  FROM   BL_INST_PMNT_PLAN 
			  WHERE  LAST_INST_PAID_DOC_TYPE_CODE=:d_doc_type_code1
			  AND    LAST_INST_PAID_DOC_NUM      =:d_doc_number1
			  AND	 OPERATING_FACILITY_ID  =:nd_facility_id;

	 LV_INST VARCHAR2(2000);
	 L_CNT NUMBER:=1;
	BEGIN
	 FOR I IN C_INST LOOP
	  If L_CNT=1 Then
	   LV_INST:=I.AGGR_INST_NO;
	  Else
	   LV_INST:=LV_INST||','||I.AGGR_INST_NO;
	  End If;
	 L_CNT:=L_CNT+1;
	 END LOOP;
	:nd_aggr_inst_no:=LV_INST;
	END;
	END-EXEC;
  nd_aggr_inst_no.arr[nd_aggr_inst_no.len]='\0';  
}
get_cashier_name()
{

  nd_cashier_name.arr[0]='\0';
  nd_cashier_name.len	  =0; 
  nd_print_cashier_name.arr[0]='\0';
  nd_print_cashier_name.len	  =0; 
  

  EXEC SQL SELECT DISTINCT APPL_USER_NAME
  INTO  :nd_cashier_name
  FROM   SM_APPL_USER_LANG 
  WHERE  APPL_USER_ID=:d_added_by_id
  AND	 LANGUAGE_ID  =:nd_lang_id;
  


 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }
 
  nd_cashier_name.arr[nd_cashier_name.len]='\0';
   
  strcpy(nd_print_cashier_name.arr,"(");
  strcat(nd_print_cashier_name.arr,nd_cashier_name.arr);
  strcat(nd_print_cashier_name.arr,")");
  
  nd_print_cashier_name.len=strlen(nd_print_cashier_name.arr);
  nd_print_cashier_name.arr[nd_print_cashier_name.len]='\0';
}

/* Getting designation of cashier */

get_cashier_designation()
{
 
 
 nd_cahier_position.arr[0] ='\0';
 nd_cahier_position.len	   = 0;


 EXEC SQL EXECUTE
    
	DECLARE
    nd_func_role  VARCHAR2(3);
	
	BEGIN
		
		SELECT FUNC_ROLE 
		INTO nd_func_role
        FROM SM_APPL_USER_LANG_VW 
		WHERE  APPL_USER_ID=:d_added_by_id
        AND	 LANGUAGE_ID  =:nd_lang_id;

		IF nd_func_role='O' THEN

			SELECT long_desc 
			INTO :nd_cahier_position
			FROM sm_appl_user_lang_vw a,am_other_staff b,am_other_staff_type_lang_vw C
			WHERE a.appl_user_id=:d_added_by_id
			AND a.FUNC_ROLE='O'
			AND b.OTHER_STAFF_ID = a.FUNC_ROLE_ID
			AND c.OTHER_STAFF_TYPE = b.OTHER_STAFF_TYPE
			AND c.language_id=:nd_lang_id
			AND a.language_id=:nd_lang_id;

		END IF;



	END;

END-EXEC;
 
    
    nd_cahier_position.arr[nd_cahier_position.len]='\0';

 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }

 
}
get_pkg_name()
{

  nd_package_code.arr[0]='\0';
  nd_package_code.len	  =0; 


  EXEC SQL SELECT DISTINCT PRICE_CLASS_CODE
  INTO  :nd_package_code
  FROM   BL_PATIENT_PACKAGE_HDR 
  WHERE  OPERATING_FACILITY_ID=:nd_facility_id
  AND	 PATIENT_ID  =:d_patient_id
  AND    PACKAGE_SEQ_NO=:l_pkg_seq_num;
  

 
   if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_PATIENT_PACKAGE_HDR TABLE");
	  }
 
    nd_package_code.arr[nd_package_code.len]='\0';

	if(nd_package_code.arr[0]!='\0')
	{
    
	  get_package_desc();

	} 

}
get_package_desc()
{
  nd_package_desc.arr[0]='\0';
  nd_package_desc.len	  =0; 


  EXEC SQL SELECT LONG_DESC
  INTO  :nd_package_desc
  FROM   BL_PRICE_CLASS_LANG_VW 
  WHERE  OPERATING_FACILITY_ID=:nd_facility_id
  AND	 LANGUAGE_ID  =:nd_lang_id
  AND    PRICE_CLASS_CODE=:nd_package_code;
  


   if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_PRICE_CLASS_LANG_VW TABLE");
	  }
 
  nd_package_desc.arr[nd_package_desc.len]='\0';



}
declare_oth_receipt_cur()
 {

	 if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
	  {
		  
				  if(nd_pmnt_ref_num.arr[0]!='\0')
				  {
/*
    				EXEC SQL DECLARE oth_inv_receipt_cursor CURSOR FOR
						SELECT 
						a.RECPT_NATURE_CODE,a.ADDED_BY_ID,
						a.RECPT_TYPE_CODE,a.DOC_TYPE_CODE,a.DOC_NUMBER,
						to_char(a.DOC_DATE,'DD/MM/YYYY HH12:MI AM'),
						to_char(a.DOC_DATE,'DD/MM/YYYY HH24:MI'),
						nvl(a.DOC_AMT,0)+NVL(a.CC_REFUND_DEDUCTION_AMT,0),
						PATIENT_ID,a.BILL_DOC_TYPE_CODE ,a.BILL_DOC_NUMBER,
						a.BILL_DOC_SRNO,
						a.EPISODE_TYPE,
						a.EPISODE_ID,
						a.VISIT_ID,
						a.CUSTOMER_CODE,
						PRINT_FLAG,
						a.CASH_COUNTER_CODE,
						a.RECPT_REFUND_IND,
						a.NARRATION
						FROM  bl_receipt_refund_hdr a
						WHERE A.operating_facility_id=:nd_facility_id
						AND a.DOC_TYPE_CODE||'/'||a.DOC_NUMBER IN(
									SELECT SLMT_DOC_TYPE_CODE||'/'||SLMT_DOC_NUM
									FROM BL_CUST_PAYMENT_REF_DTL
									WHERE OPERATING_FACILITY_ID=:nd_facility_id
									AND PMNT_REF_NUM = :nd_pmnt_ref_num)
						And ( (NVL(:nd_function_id,'X')='BL_REPRINT_RCPT_FOR_PMNT_DOC'
								And Exists (Select 'X' From SY_PROG_PARAM C
											Where  C.Operating_Facility_Id = :nd_facility_id
											   And C.PGM_ID='BLTCANPR'
											   And C.SESSION_ID = :nd_session_id
											   And C.PGM_DATE = :nd_pgm_date
											   And C.PARAM1 = A.DOC_TYPE_CODE
											   And C.PARAM2 = A.DOC_NUMBER)
							   )
							 OR (NVL(:nd_function_id,'X')!='BL_REPRINT_RCPT_FOR_PMNT_DOC' )
							)
						And Nvl(CANCELLED_IND,'N')='N';
						disp_message(ERR_MESG,"IN SIDE COMMENT");
						
commented for PE CORRECTION */

//ADDED FOR PE CORRECTION
			       EXEC SQL DECLARE oth_inv_receipt_cursor CURSOR FOR
						SELECT 
						a.RECPT_NATURE_CODE,a.ADDED_BY_ID,
						a.RECPT_TYPE_CODE,a.DOC_TYPE_CODE,a.DOC_NUMBER,
						to_char(a.DOC_DATE,'DD/MM/YYYY HH12:MI AM'),
						to_char(a.DOC_DATE,'DD/MM/YYYY HH24:MI'),
						nvl(a.DOC_AMT,0)+NVL(a.CC_REFUND_DEDUCTION_AMT,0),
						PATIENT_ID,a.BILL_DOC_TYPE_CODE ,a.BILL_DOC_NUMBER,
						a.BILL_DOC_SRNO,
						a.EPISODE_TYPE,
						a.EPISODE_ID,
						a.VISIT_ID,
						nvl(a.CUSTomer_CODE,b.cust_code),
						PRINT_FLAG,
						a.CASH_COUNTER_CODE,
						a.RECPT_REFUND_IND,
						a.NARRATION
						FROM  bl_receipt_refund_hdr a,BL_CUST_PAYMENT_REF_DTL b
						WHERE A.operating_facility_id=:nd_facility_id
						AND  a.DOC_TYPE_CODE=b.SLMT_DOC_TYPE_CODE 
						AND a.DOC_NUMBER=b.SLMT_DOC_NUM
						AND PMNT_REF_NUM = :nd_pmnt_ref_num;
						                        
									/*EXISTS (
									SELECT 'X' 
									FROM BL_CUST_PAYMENT_REF_DTL
									WHERE OPERATING_FACILITY_ID=:nd_facility_id
									AND a.DOC_TYPE_CODE=SLMT_DOC_TYPE_CODE AND a.DOC_NUMBER=SLMT_DOC_NUM
									AND PMNT_REF_NUM = :nd_pmnt_ref_num);

						                       And ( (NVL(:nd_function_id,'X')='BL_REPRINT_RCPT_FOR_PMNT_DOC'
								         And Exists (Select 'X' From SY_PROG_PARAM C
									Where  C.Operating_Facility_Id = :nd_facility_id
									And C.PGM_ID='BLTCANPR'
									And C.SESSION_ID = :nd_session_id
									And C.PGM_DATE = :nd_pgm_date
								        And C.PARAM1 = A.DOC_TYPE_CODE
									And C.PARAM2 = A.DOC_NUMBER))
							   
							              OR (NVL(:nd_function_id,'X')!='BL_REPRINT_RCPT_FOR_PMNT_DOC' ))	                
 
						And Nvl(CANCELLED_IND,'N')='N';*/
						
//ADDED FOR PE CORRECTION


							if (OERROR)
							  { 
									disp_message (ERR_MESG,"Declare oth_inv_receipt_cursor failed");
									proc_exit();
							  }
						

				  }
				  else
				  {
            
						EXEC SQL DECLARE oth_receipt_cursor CURSOR FOR
						SELECT 
						a.RECPT_NATURE_CODE,a.ADDED_BY_ID,
						a.RECPT_TYPE_CODE,a.DOC_TYPE_CODE,a.DOC_NUMBER,
						to_char(a.DOC_DATE,'DD/MM/YYYY HH12:MI AM'),
						to_char(a.DOC_DATE,'DD/MM/YYYY HH24:MI'),
						nvl(a.DOC_AMT,0)+NVL(a.CC_REFUND_DEDUCTION_AMT,0),
						PATIENT_ID,a.BILL_DOC_TYPE_CODE ,a.BILL_DOC_NUMBER,
						a.BILL_DOC_SRNO,
						a.EPISODE_TYPE,
						a.EPISODE_ID,
						a.VISIT_ID,
						a.CUSTOMER_CODE,
						PRINT_FLAG,
						a.CASH_COUNTER_CODE,
						a.RECPT_REFUND_IND,
						a.NARRATION
						FROM  bl_receipt_refund_hdr a
						WHERE 
						A.operating_facility_id=:nd_facility_id
						AND ( (nvl(:nd_inst_rcpt_yn,'N')='Y' and
								  (a.DOC_TYPE_CODE,a.DOC_NUMBER) In
								  ( select RECPT_DOC_TYPE_CODE,RECPT_DOC_NUM
									from BL_REC_REF_TEMP
									where SESSION_ID = :nd_session_id
									and PGM_DATE  = :nd_pgm_date
								   )
							   )
							 or((Nvl(:nd_inst_rcpt_yn,'N')!='Y' or :nd_inst_rcpt_yn is null) 
								AND a.DOC_TYPE_CODE BETWEEN :d_doc_type_code
								AND NVL(:l_to_doc_type_code,:d_doc_type_code)
								and a.DOC_NUMBER BETWEEN    :d_doc_number 
								AND NVL(:l_to_doc_type_num, :d_doc_number)
							   )

							)
						And Nvl(CANCELLED_IND,'N')='N';
						if (OERROR)
						  { 
								disp_message (ERR_MESG,"Declare oth_receipt_cur failed");
								proc_exit();
						  }


				 }  
         }
	else
		{
					
				nd_actual_reason.arr[0] = '\0';
				nd_actual_reason.len	= 0;
				
					if(strcmp(nd_reportid.arr,"BLR0014E")==0)
					strcpy(nd_actual_reason.arr,nd_reason_code.arr);
							
				
				nd_actual_reason.arr[nd_actual_reason.len] = '\0';
				
					

				EXEC SQL DECLARE Exemption_cursor CURSOR FOR
						Select a.MODIFIED_BY_ID
						,a.DOC_TYPE_CODE,a.DOC_NUM,
						to_char(a.DOC_DATE,'DD/MM/YYYY HH12:MI AM'),
						to_char(a.DOC_DATE,'DD/MM/YYYY HH24:MI'),
						nvl(a.DOC_AMT,0),a.patient_id,a.PRINT_FLAG,a.REMARKS,a.REASON_CODE,
						a.CASH_COUNTER_CODE						   
						from BL_BILL_ADJ_HDR A
						where a.operating_facility_id=:nd_facility_id
						and a.doc_type_code BETWEEN :d_doc_type_code
						AND NVL(:l_to_doc_type_code,:d_doc_type_code)
						and a.DOC_NUM BETWEEN    :d_doc_number 
						AND NVL(:l_to_doc_type_num, :d_doc_number)
						and to_date(to_char(a.doc_date,'DD/MM/YYYY'),'DD/MM/YYYY') between to_date(:nd_fm_doc_date,'DD/MM/YYYY') and  to_date(:nd_to_doc_date,'DD/MM/YYYY')
						and A.reason_code=nvl(:nd_actual_reason,A.reason_code)
						and nvl(CANCELLED_YN,'N')=:nd_status;
						/*disp_message(ERR_MESG,"IN ELSE")*/;


			 if (OERROR)
				  { 
						disp_message (ERR_MESG,"Declare Exemption_cursor failed");
						proc_exit();
				  }
						
		 
		 }

	 
 
 }

 open_oth_receipt_cur()
 { 

  if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
  {	
	  if(nd_pmnt_ref_num.arr[0]!='\0')
		 EXEC SQL OPEN oth_inv_receipt_cursor;
   
	  else
		 EXEC SQL OPEN oth_receipt_cursor;
  }
  else
	EXEC SQL OPEN Exemption_cursor;

	if (OERROR) 
	{ 
	    disp_message (ERR_MESG,"Open oth_receipt_cursor failed");
		proc_exit();
	}
	
	return;
  }

fetch_oth_receipt_cur()
  {
	
	d_receipt_nature_code.arr[0] ='\0';
	d_added_by_id.arr[0]		 ='\0';
	d_receipt_type_code.arr[0]   ='\0';
	d_doc_type_code1.arr[0]		 ='\0';
	d_doc_number1.arr[0]	     ='\0';
    d2_doc_date.arr[0]			 ='\0';
	d_receipt_date.arr[0]		 ='\0';
	d_receipt_date_nd.arr[0]	 ='\0';//changed by sarvinder for SCF-9456
	d1_patient_id.arr[0]         ='\0';
	d2_patient_id.arr[0]		 ='\0';
	d3_bill_doc_type_code.arr[0] ='\0';
	d3_bill_doc_number.arr[0]	 ='\0';
	d3_bill_doc_srno.arr[0]		 ='\0';
	d2_episode_type.arr[0]		 ='\0';
	d2_episode_id.arr[0]		 ='\0';
	d2_visit_id.arr[0]			 ='\0';
	d2_customer_code.arr[0]		 ='\0';
	d_print_yn.arr[0]			 ='\0';
	d_cash_counter_code.arr[0]	 ='\0';
	d_exm_reason_remarks.arr[0]	 ='\0';
	d_reason.arr[0]				 ='\0';
	d_recpt_refund_ind.arr[0]    ='\0';
	d_remarks.arr[0]			 ='\0';
	
	      	
	d_receipt_nature_code.len =0;
	d_added_by_id.len		  =0;
	d_receipt_type_code.len   =0;
	d_doc_type_code1.len	  =0;
	d_doc_number1.len		  =0;
	d2_doc_date.len			  =0;
	d_receipt_date.len		  =0;
	d_receipt_date_nd.len	  =0;//changed by sarvinder for SCF-9456
	d1_patient_id.len         =0;
	d2_patient_id.len		  =0;
	d3_bill_doc_type_code.len =0;
	d3_bill_doc_number.len    =0;
	d3_bill_doc_srno.len	  =0;
	d2_episode_type.len		  =0;
	d2_episode_id.len		  =0;
	d2_visit_id.len			  =0;
	d2_customer_code.len	  =0;
	d_print_yn.len			  =0;
	d_exm_reason_remarks.len  =0;
	d_reason.len			  =0;
	d_recpt_refund_ind.len    =0;
	d_remarks.len			  =0;
	
  if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0 )
	  {

					if(nd_pmnt_ref_num.arr[0]!='\0')
					{
						EXEC SQL FETCH oth_inv_receipt_cursor INTO 
							d_receipt_nature_code,
							d_added_by_id,
							d_receipt_type_code,
							d_doc_type_code1,
							d_doc_number1,
							d2_doc_date,
							d_receipt_date,
							d_oth_receipt_amt,
							d1_patient_id,
							d3_bill_doc_type_code,
							d3_bill_doc_number,
							d3_bill_doc_srno,
							d2_episode_type,
							d2_episode_id,
						    d2_visit_id,
						    d2_customer_code,
						    d_print_yn,
						    d_cash_counter_code,
							d_recpt_refund_ind,
							d_remarks;
							

					if(OERROR)
					{ 
					err_mesg("FETCH FAILED IN oth_inv_receipt_cursor",0,"");
					proc_exit();
					}
					

					
				}
				else
				{
				
					EXEC SQL FETCH oth_receipt_cursor INTO 
						d_receipt_nature_code,
						d_added_by_id,
						d_receipt_type_code,
						d_doc_type_code1,
						d_doc_number1,
						d2_doc_date,
						d_receipt_date,
						d_oth_receipt_amt,
						d1_patient_id,
						d3_bill_doc_type_code,
						d3_bill_doc_number,
						d3_bill_doc_srno,
						d2_episode_type,
						d2_episode_id,
						d2_visit_id,
						d2_customer_code,
						d_print_yn,
						d_cash_counter_code,
						d_recpt_refund_ind,
						d_remarks;

					if(OERROR)
					{ 
					err_mesg("FETCH FAILED IN oth_receipt_cursor",0,"");
					proc_exit();
					}
				}

		 }
	else
		{

		

			EXEC SQL FETCH Exemption_cursor INTO
					d_added_by_id,
					d_doc_type_code1,
					d_doc_number1,
					d2_doc_date,
					d_receipt_date,
					d_oth_receipt_amt,
					d2_patient_id,
					d_print_yn,
					d_exm_reason_remarks,
					d_reason,
					d_cash_counter_code;

			

					if(OERROR)
					{ 
					err_mesg("FETCH FAILED IN Exemption_cursor",0,"");
					proc_exit();
					}
			
	
		
		
		
		}

  
      
    if(NODATAFOUND)
	{
		
		  return 0;

	 }
	
	



	d_receipt_nature_code.arr[d_receipt_nature_code.len]	='\0';
	d_added_by_id.arr[d_added_by_id.len]					='\0';
	d_receipt_type_code.arr[d_receipt_type_code.len]		='\0';
	d_doc_type_code1.arr[d_doc_type_code1.len]				='\0';
    d_doc_number1.arr[d_doc_number1.len]					='\0';
	d2_doc_date.arr[d2_doc_date.len]						='\0';
	d_receipt_date.arr[d_receipt_date.len]					='\0';
	d_receipt_date_nd.arr[d_receipt_date_nd.len]			='\0';//changed by sarvinder for SCF-9456
	d1_patient_id.arr[d1_patient_id.len]					='\0';	
	d2_patient_id.arr[d2_patient_id.len]					='\0';
	d3_bill_doc_type_code.arr[d3_bill_doc_type_code.len]	='\0';
	d3_bill_doc_number.arr[d3_bill_doc_number.len]			='\0';
	d3_bill_doc_srno.arr[d3_bill_doc_srno.len]				='\0';
	d2_episode_type.arr[d2_episode_type.len]				='\0';
	d2_episode_id.arr[d2_episode_id.len]					='\0';
	d2_visit_id.arr[d2_visit_id.len]						='\0';
	d2_customer_code.arr[d2_customer_code.len]				='\0';
	d_print_yn.arr[d_print_yn.len]							='\0';
	d_cash_counter_code.arr[d_cash_counter_code.len]        ='\0';
	d_exm_reason_remarks.arr[d_exm_reason_remarks.len]		='\0';
	d_recpt_refund_ind.arr[d_recpt_refund_ind.len]          ='\0';
	d_remarks.arr[d_remarks.len]						    ='\0';
	 
   
   
   return 1;
			
  }

get_exemption_auth_user()
{
    d_added_by_id.arr[0]='\0';
	d_added_by_id.len=0;	 
  
	 EXEC SQL  select STAGE_AUTH_BY_ID
		  into  :d_added_by_id
		  from  BL_EXEMPTION_TRACK_DTLS
		  where OPERATING_FACILITY_ID=:nd_facility_id
		  and   EXM_DOC_TYPE_CODE=:d_doc_type_code1
		  and   EXM_DOC_NUM=:d_doc_number1
		  and   CUR_EXEMPTION_STAGE_SEQ=(select max(CUR_EXEMPTION_STAGE_SEQ)
										from    BL_EXEMPTION_TRACK_DTLS
										where   OPERATING_FACILITY_ID=:nd_facility_id
										and     EXM_DOC_TYPE_CODE=:d_doc_type_code1
										and     EXM_DOC_NUM=:d_doc_number1);

  d_added_by_id.arr[d_added_by_id.len]='\0';


}

// added by raghava on 14/3/2008
close_oth_receipt_cur()
{ 
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
	{
		if(nd_pmnt_ref_num.arr[0]!='\0')
		  EXEC SQL CLOSE oth_inv_receipt_cursor;

		else
		  EXEC SQL CLOSE oth_receipt_cursor;
	}
	else
		EXEC SQL CLOSE Exemption_cursor;

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close oth_receipt_cursor failed");
		proc_exit();
	}

   return;
}
declare_bills_receipt_cur()
  {
     
   
   if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
   {
			   if (strcmp(d3_bill_doc_type_code.arr,"\0")!=0)
				 {
					
					EXEC SQL DECLARE  get_single_bill_cursor CURSOR FOR	
	       				SELECT distinct
						a.BILL_DOC_TYPE_CODE BILL_DOC_TYPE_CODE,
						to_char(a.BILL_DOC_NUMBER) BILL_DOC_NUM,
						b.bill_amt+nvl(b.bill_rounding_amt,0) bill_amt,
						a.DOC_AMT,
						decode(b.bill_tot_amt,a.DOC_AMT,'B','S') bill_format,
						--decode(b.bill_amt+nvl(b.bill_rounding_amt,0),a.DOC_AMT,'B','S') bill_format,
		  				decode((nvl(b.BILL_TOT_ADJUST_AMT,0)+nvl(b.BILL_TOT_EXEMPT_AMT,0)+nvl(b.BILL_TOT_WRITE_OFF_AMT,0)),0,'N','Y') Exempted_bill_YN, 
						a.RECPT_TYPE_CODE,
						a.PATIENT_ID,
						b.EPISODE_TYPE,
						b.EPISODE_ID,
						b.VISIT_ID,
						b.WARD_CODE,
						b.BLNG_GRP_ID,
						nvl(b.ADJ_PAYER_DIST_AMT,0)
						FROM bl_receipt_refund_hdr a, bl_bill_hdr b
						WHERE
						a.operating_facility_id=b.operating_facility_id
						AND a.operating_facility_id=:nd_facility_id
						AND a.BILL_DOC_TYPE_CODE = b.DOC_TYPE_CODE
						AND a.BILL_DOC_NUMBER = b.DOC_NUM
						AND a.DOC_TYPE_CODE  =:d_doc_type_code1
						AND a.DOC_NUMBER=:d_doc_number1;
					
						
						
						/*SELECT distinct
						a.BILL_DOC_TYPE_CODE,
						to_char(a.BILL_DOC_NUMBER),
						b.bill_amt+nvl(b.bill_rounding_amt,0) bill_amt,
						a.DOC_AMT,
						decode(b.bill_amt,a.DOC_AMT,'B','S'),
						a.RECPT_TYPE_CODE,
						a.PATIENT_ID
						FROM bl_receipt_refund_hdr a, bl_bill_hdr b
						WHERE
						a.operating_facility_id=b.operating_facility_id
						AND a.operating_facility_id=:nd_facility_id
						AND a.BILL_DOC_TYPE_CODE = b.DOC_TYPE_CODE
						AND a.BILL_DOC_NUMBER = b.DOC_NUM
						AND a.DOC_TYPE_CODE  =:d_doc_type_code1
						AND a.DOC_NUMBER=:d_doc_number1
						AND a.EPISODE_TYPE=:l_episode_type;*/

					if (OERROR)
					{ 
						disp_message (ERR_MESG,"Declare get_single_bill_cursor failed");
						proc_exit();
					}
				
				 }
  
			  else
				{
					
				EXEC SQL DECLARE bills_receipt_cursor CURSOR FOR
				
					  SELECT a.DOC_TYPE_CODE BILL_DOC_TYPE_CODE,to_char(a.DOC_NUM) BILL_DOC_NUM,
						 a.bill_amt+nvl(a.bill_rounding_amt,0) bill_amt,
						 b.settled_amt settled_amt,
						 decode(a.bill_amt+nvl(a.bill_rounding_amt,0),b.settled_amt,'B','S') bill_format,
						 decode((nvl(a.BILL_TOT_ADJUST_AMT,0)+nvl(a.BILL_TOT_EXEMPT_AMT,0)+nvl(a.BILL_TOT_WRITE_OFF_AMT,0)),0,'N','Y') Exempted_bill_YN, 
						 b.RECPT_TYPE_CODE,
						 b.PATIENT_ID,
						 a.EPISODE_TYPE,
						 a.EPISODE_ID,
						 a.VISIT_ID,
						 a.WARD_CODE,
						 a.BLNG_GRP_ID,
						 nvl(a.ADJ_PAYER_DIST_AMT,0)
						 FROM bl_bill_hdr a ,(SELECT BILL_DOC_TYPE_CODE,BILL_DOC_NUM,RECPT_TYPE_CODE,PATIENT_ID,sum(settled_amt) settled_amt 
						 FROM bl_bills_for_cons_receipt
						 WHERE DOC_TYPE_CODE  =:d_doc_type_code1
						 AND DOC_NUMBER=:d_doc_number1
						 GROUP BY BILL_DOC_TYPE_CODE,BILL_DOC_NUM,
						 RECPT_TYPE_CODE,
						 PATIENT_ID) b
						 WHERE a.operating_facility_id=:nd_facility_id
						 AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
						 AND b.BILL_DOC_NUM = a.DOC_NUM
						 ORDER BY bill_format DESC; 

						
						
						/*SELECT distinct
						a.BILL_DOC_TYPE_CODE,
						to_char(a.BILL_DOC_NUM),
						b.bill_amt+nvl(b.bill_rounding_amt,0) bill_amt,
						a.settled_amt,
						decode(b.bill_amt,a.settled_amt,'B','S'),
						a.RECPT_TYPE_CODE,
						a.PATIENT_ID
						FROM bl_bills_for_cons_receipt a, bl_bill_hdr b
						WHERE
						a.operating_facility_id=b.operating_facility_id
						AND a.operating_facility_id=:nd_facility_id
						AND a.BILL_DOC_TYPE_CODE = b.DOC_TYPE_CODE
						AND a.BILL_DOC_NUM = b.DOC_NUM
						AND a.DOC_TYPE_CODE  =:d_doc_type_code1
						AND a.DOC_NUMBER=:d_doc_number1
						AND a.EPISODE_TYPE=:l_episode_type;*/
						
						/*AND a.DOC_TYPE_CODE BETWEEN:d_doc_type_code
								  AND NVL(:l_to_doc_type_code,:d_doc_type_code)
						AND a.DOC_NUMBER BETWEEN :d_doc_number 
								  AND NVL(:l_to_doc_type_num, :d_doc_number);*/
   
				
				if (OERROR)
					{ 
						disp_message (ERR_MESG,"Declare bills_receipt_cursor failed");
						proc_exit();
					}

				}
		}
		else
		{
		
				EXEC SQL DECLARE Exemption_Bills_cursor CURSOR FOR
				SELECT  ADJ_DOC_TYPE_CODE, ADJ_DOC_NUM,to_char(BILL_OUT_AMT_BEF_ADJ_EXM),
						 EPISODE_TYPE,
						 EPISODE_ID,
						 VISIT_ID											 
						 FROM bl_bill_adj_dtl
						 WHERE operating_facility_id=:nd_facility_id
						 and  DOC_TYPE_CODE  =:d_doc_type_code1
						 AND DOC_NUM=:d_doc_number1
						 order by ADJ_DOC_TYPE_CODE,ADJ_DOC_NUM;
						 
						 

					if (OERROR)
					{ 
						disp_message (ERR_MESG,"Declare Exemption_Bills_cursor failed");
						proc_exit();
					}

						 
				
		}
				
	 return ;      
  }

open_receipt_cur()
  { 
	
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
	{
		if (strcmp(d3_bill_doc_type_code.arr,"\0")!=0)
		
		EXEC SQL OPEN get_single_bill_cursor;

		else

		EXEC SQL OPEN bills_receipt_cursor;
	 }
	 else
	   EXEC SQL OPEN Exemption_Bills_cursor;
   
	if (OERROR) 
	{ 
	    disp_message (ERR_MESG,"Open bills_receipt_cursor failed");
		proc_exit();
	}
	
	return;
  }

fetch_receipt_cur()
  {
   
    d2_bill_doc_type_code.arr[0]	= '\0';
	d2_bill_doc_num.arr[0]			= '\0';
	d_bill_format.arr[0]			= '\0';
	d1_patient_id.arr[0]			= '\0';
	d_exempted_bill_yn.arr[0]		= '\0';
	d1_episode_type.arr[0]			= '\0';		
	d1_episode_id.arr[0]			= '\0';			
	d1_visit_id.arr[0]				= '\0';	
	d_ward_code.arr[0]				= '\0';
	d1_blng_grp_id.arr[0]			= '\0';
	
	d1_bill_doc_type_code.len		=0;
	d_bill_doc_num.len				=0;
	d_bill_format.len				=0;
	d_exempted_bill_yn.len			=0;
	d1_patient_id.len				=0;
	d1_episode_type.len				=0;	
	d1_episode_id.len				=0;
	d1_visit_id.len					=0;
	d_ward_code.len					=0;
	d1_blng_grp_id.len				=0;


	d_bill_out_amt.arr[0]		  ='\0';
	d_bill_out_amt.len	=0;

  if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
  {
			  if (strcmp(d3_bill_doc_type_code.arr,"\0")!=0)
				 {
				
					
					EXEC SQL FETCH get_single_bill_cursor INTO 
					d2_bill_doc_type_code,
					d2_bill_doc_num,
					d_bill_amt,
					d_settled_amt,
					d_bill_format,
					d_exempted_bill_yn,
					d_receipt_type,
					d1_patient_id,
					d1_episode_type,		
					d1_episode_id,			
					d1_visit_id,	
					d_ward_code,
					d1_blng_grp_id,
					d_adj_payer_dist_amt;

				 }

			  else
				{
					
        
					EXEC SQL FETCH bills_receipt_cursor INTO 
					d2_bill_doc_type_code,
					d2_bill_doc_num,
					d_bill_amt,
					d_settled_amt,
					d_bill_format,
					d_exempted_bill_yn,
					d_receipt_type,
					d1_patient_id,
					d1_episode_type,		
					d1_episode_id,			
					d1_visit_id,	
					d_ward_code,
					d1_blng_grp_id,
					d_adj_payer_dist_amt;
					
				}
         }
		 else
		 {

			EXEC SQL FETCH Exemption_bills_cursor INTO 
					d2_bill_doc_type_code,
					d2_bill_doc_num,
					d_bill_out_amt,
					d1_episode_type,		
					d1_episode_id,			
					d1_visit_id;
			 

		 }
		  

  	if(NODATAFOUND)
	{
	   return 0;
	}
	
	if(OERROR)
	{ 
		/*sprintf(string_var,"%d %d",OERROR, sqlca.sqlcode);
		disp_message(ERR_MESG,string_var);*/
		err_mesg("FETCH FAILED IN RECEIPT_CUR",0,"");
		proc_exit();
	}

	d2_bill_doc_type_code.arr[d2_bill_doc_type_code.len]= '\0';
	d2_bill_doc_num.arr[d2_bill_doc_num.len]			= '\0';
	d_bill_format.arr[d_bill_format.len]				= '\0';
	d_exempted_bill_yn.arr[d_exempted_bill_yn.len]		= '\0';
	d1_episode_type.arr[d1_episode_type.len]			= '\0';		
	d1_episode_id.arr[d1_episode_id.len]				= '\0';			
	d1_visit_id.arr[d1_visit_id.len]					= '\0';	
	d1_patient_id.arr[d1_patient_id.len]				= '\0';
	d_ward_code.arr[d_ward_code.len]					= '\0';
	d1_blng_grp_id.arr[d1_blng_grp_id.len]				= '\0';
	d_bill_out_amt.arr[d_bill_out_amt.len]				= '\0';
	
	
	return 1;

  }


close_receipt_cur()
{ 
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
	{
		if (strcmp(d3_bill_doc_type_code.arr,"\0")!=0)
		
		EXEC SQL CLOSE get_single_bill_cursor;
		else
		
		EXEC SQL CLOSE bills_receipt_cursor;
	}
	else
		EXEC SQL CLOSE Exemption_bills_cursor;

	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close bills_receipt_cursor failed");
	proc_exit();
	}

   return;
}
/*** Added by raghav at BKK on 06/01/2010 ***/

chk_multiple_rcpt_serv_list_yn()
{
  	l_con_rcpt_yn.arr[0] ='\0';
	l_con_rcpt_yn.len    =  0;

	l_receipt_doc_size.arr[0]='\0';
	l_receipt_doc_size.len   =  0;

	

	EXEC SQL SELECT nvl(MLTPTCL_CONS_RCPT_SERV_LIST_YN,'N'),
	                DECODE(NVL(:nd_detail_type_yn,'N'),'Y','A4',nvl(RECEIPT_DOC_SIZE,'A4'))
			 INTO  :l_con_rcpt_yn,
			       :l_receipt_doc_size
			 FROM   BL_PARAMETERS
			 WHERE  OPERATING_FACILITY_ID=:nd_facility_id;  

	if (OERROR)
        err_mesg("SELECT failed Table BL_PARAMETERS",0,"");
    
	if (NODATAFOUND)
		err_mesg("No Record found in BL_PARAMETERS",0,"");

    l_con_rcpt_yn.arr[l_con_rcpt_yn.len] = '\0';
	l_receipt_doc_size.arr[l_receipt_doc_size.len]='\0';
}

chk_no_of_blng_grp()
{
    EXEC SQL SELECT COUNT(distinct a.BLNG_GRP_ID)
			INTO  :l_no_of_blng_grp
			FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
			WHERE a.operating_facility_id=:nd_facility_id
			AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
			AND b.BILL_DOC_NUM = a.DOC_NUM
			AND b.DOC_TYPE_CODE  =:d_doc_type_code1
			AND b.DOC_NUMBER=:d_doc_number1;
	 if (OERROR)
	 l_no_of_blng_grp=1;
}
chk_rcpt_setup()
{
  l_con_rcpt_blng_grp.arr[0]='\0';
  l_con_rcpt_blng_grp.len=0;
  
  EXEC SQL select BLNG_GRP_ID 
           into   :l_con_rcpt_blng_grp  
		   from   BL_CASH_BILL_PRINT_FORMAT
		   where  OPERATING_FACILITY_ID=:nd_facility_id
		   and bill_rcpt_ind='R'
		   and    BLNG_GRP_ID In(
				   (SELECT distinct a.BLNG_GRP_ID
					FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
					WHERE a.operating_facility_id=:nd_facility_id
					AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
					AND b.BILL_DOC_NUM = a.DOC_NUM
					AND b.DOC_TYPE_CODE  =:d_doc_type_code1
					AND b.DOC_NUMBER=:d_doc_number1 
				   ))
      
           and  nvl(USE_FOR_MULTI_ENC_CONS_RCPT_YN,'N')='Y';  

  	if(NODATAFOUND)
	{
	
	   EXEC SQL select BLNG_GRP_ID 
           into   :l_con_rcpt_blng_grp  
		   from   BL_CASH_BILL_PRINT_FORMAT
		   where  OPERATING_FACILITY_ID=:nd_facility_id
		   and bill_rcpt_ind='R'
		   and    BLNG_GRP_ID ='**'
           and    nvl(USE_FOR_MULTI_ENC_CONS_RCPT_YN,'N')='Y'; 
	
		if(NODATAFOUND)
		{
		 l_errortext.arr[0] = '\0';
		 l_errortext.len = 0;
		  EXEC SQL EXECUTE
		   BEGIN
			:l_errortext := blcommon.get_error_text('BL7368');
		   END;
		  END-EXEC;
			if (l_errortext.arr[0] != '\0')
			{
				disp_message(ERR_MESG,l_errortext.arr);			
				proc_exit(0);
				
			}
		 }
	}
	 
   	if (OERROR)
     err_mesg("chk_rcpt_setup - SELECT failed Table BL_PARAMETERS",0,"");

  l_con_rcpt_blng_grp.arr[l_con_rcpt_blng_grp.len]='\0';
}


chk_Exemption_setup()
{
  l_con_rcpt_blng_grp.arr[0]='\0';
  l_con_rcpt_blng_grp.len=0;
    	
	   EXEC SQL select BLNG_GRP_ID 
           into   :l_con_rcpt_blng_grp  
		   from   BL_CASH_BILL_PRINT_FORMAT
		   where  OPERATING_FACILITY_ID=:nd_facility_id
		   and    BLNG_GRP_ID ='**'
		   and   Bill_rcpt_ind='E'; 
	
		if(NODATAFOUND)
		{
		 	
			disp_message(ERR_MESG,"Exemption Format Setup Not Available ");
			proc_exit(0);
		 }
	
	 
   	if (OERROR)
     err_mesg("chk_Exemption_setup - SELECT failed Table BL_CASH_BILL_PRINT_FORMAT",0,"");

  l_con_rcpt_blng_grp.arr[l_con_rcpt_blng_grp.len]='\0';
}


get_episode_type()
{
   lv_episode_type.arr[0]='\0';
   lv_episode_type.len   =  0;
	
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
	{
	EXEC SQL EXECUTE
		DECLARE
		 CURSOR Episode_Cur Is
			SELECT DISTINCT a.EPISODE_TYPE
			FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
			WHERE a.operating_facility_id=:nd_facility_id
			AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
			AND b.BILL_DOC_NUM = a.DOC_NUM
			AND b.DOC_TYPE_CODE  =:d_doc_type_code1
			AND b.DOC_NUMBER=:d_doc_number1;

		 l_cnt Number:=1;
			
		BEGIN
		 FOR I IN Episode_Cur LOOP
		  IF l_cnt=1 THEN
		   :lv_episode_type:=I.EPISODE_TYPE;
		  ELSE
		   :lv_episode_type:=:lv_episode_type||'|'||I.EPISODE_TYPE;
		  END IF;
		  l_cnt:=l_cnt+1;
		 END LOOP;
		END;
	END-EXEC;

	}
	else
	{
		EXEC SQL EXECUTE
		DECLARE
		 CURSOR Episode_Cur1 Is
			SELECT DISTINCT EPISODE_TYPE
			FROM bl_bill_adj_dtl
			WHERE operating_facility_id=:nd_facility_id
			AND DOC_TYPE_CODE  =:d_doc_type_code1
			AND DOC_NUM=:d_doc_number1;

		 l_cnt Number:=1;
			
		BEGIN
		 FOR I IN Episode_Cur1 LOOP
		  IF l_cnt=1 THEN
		   :lv_episode_type:=I.EPISODE_TYPE;
		  ELSE
		   :lv_episode_type:=:lv_episode_type||'|'||I.EPISODE_TYPE;
		  END IF;
		  l_cnt:=l_cnt+1;
		 END LOOP;
		END;
	END-EXEC;
	}

  if (OERROR)
   err_mesg("fun get_episode_type",0,"");
  
  lv_episode_type.arr[lv_episode_type.len]='\0';
}


get_sum_bills_amt()
{
  EXEC SQL SELECT sum(nvl(BILL_AMT,0))
		INTO l_sum_bill_amt
		FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
		WHERE a.operating_facility_id=:nd_facility_id
		AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
		AND b.BILL_DOC_NUM = a.DOC_NUM
		AND b.DOC_TYPE_CODE  =:d_doc_type_code1
		AND b.DOC_NUMBER=:d_doc_number1;
			
    if (OERROR)
	l_sum_bill_amt=0;
}

get_Exemption_bills_amt()
{
	l_exm_bill_amt=0;
  
  EXEC SQL SELECT sum(nvl(doc_amt,0))
		INTO l_exm_bill_amt
		FROM bl_bill_adj_dtl
		WHERE operating_facility_id=:nd_facility_id
		AND DOC_TYPE_CODE  =:d_doc_type_code1
		AND DOC_NUM=:d_doc_number1;
			
    if (OERROR)
	l_sum_bill_amt=0;
}


/*** Added by raghav at BKK on 06/01/2010 ***/
/***************************CALL BILL************************/
call_bill_print()
{

//fetch_bill_foramt();

declare_master_cur(); 
nd_tot_spl_agency_amt = 0;
get_print_net_gross();
open_master_cur();

while(fetch_master_cur())
  {

		get_adm_rec_flag();
        p_tot_pat_net_amt=0;
		p_tot_pat_gross_amt=0;
		nd_gnd_tot_net_reimbursable_amt=0;
		nd_tot_pat_net_charge_amt=0;
		nd_tot_pat_disc_amt=0;
		nd_gnd_tot_net_non_reimbursable_amt=0;
		nd_pat_net_amt=0;
		nd_tot_pat_disc_amt=0;
		nd_pat_gross_amt=0;
		nd_pat_net_amt1=0;
		nd_pat_disc_amt=0;
		nd_pat_gross_amt1=0;
		nd_pat_net_amt2=0;
		nd_pat_disc_amt1=0;
		nd_tot_net_reimbursable_amt=0;
		nd_tot_non_reimbursable_amt=0;
		nd_pat_net_charge_amt=0;
		nd_tot_oth_payer_amt=0;
		nd_pat_addl_charge_amt=0;
	    nd_total_pat_addl_charge_amt=0;
		pat_upd_net_charge_amt=0;
		v_pno = 1,ccnt=0,ccnt1=0; //v_lno=line_no;
		l_bill_page_no = 0,page_no=1;

		chk_pkg_blng_grp();
		if(d_pkg_blng_grp_yn.arr[0]=='Y')
		{
		 get_closed_packages();
		}
	

		if (l_lsr != 0 && l_dmp == 0)
		{			
			l_main_hdr = 1;	
			if ( l_logo_yniflaser.arr[0] != 'Y')
			  {
				if (l_page_no > 0)
				{
					l_page_no = 0;
					fprintf(fp,"\n");
					fprintf(fp,"");
					fprintf(fp,"\n");
				}
			  }
		}
		else
		{
			if(l_page_no > 1)
			{
				l_page_no = 0;
				fprintf(fp,"\n");
				fprintf(fp,"");
				fprintf(fp,"\n");
			}
		}

		/*nd_lang_id.arr[0] = '\0';
		nd_lang_id.len = 0;

		EXEC SQL EXECUTE
		BEGIN
			blcommon.get_language_ind_id(
				:nd_facility_id,
				:d1_patient_id,
				:nd_lang_ind,
				:nd_lang_id);
		END;
		END-EXEC;
       	nd_lang_id.arr[strlen(nd_lang_id.arr)] = '\0';
    	fetch_legend_value();*/

		declare_grp_hdr_cur();
		
		
		//PRINTING CODE IS THERE
		fprintf(fp,"\n");  

			nd_tot_disc_amount=d1_man_disc_amt+d1_overall_disc_amt;
			open_grp_hdr_cur();

/***********************************************************/
/*if (strcmp(d_bill_nature_code.arr,"C")==0)
  {
     
		EXEC SQL select 'Y' into :v_c_billed_serv
  		   from bl_patient_charges_folio a
		   where cust_code is not null 
		       and 
			exists (select 'x' TRX_DOC_REF,TRX_DOC_REF_LINE_NUM
         from bl_patient_charges_folio b
         where b.TRX_DOC_REF = a.TRX_DOC_REF
		 and   b.operating_facility_id=a.operating_facility_id
		 and   b.operating_facility_id=:nd_facility_id
         and   b.TRX_DOC_REF_LINE_NUM = a.TRX_DOC_REF_LINE_NUM
         and   b.bill_doc_type_code = :d2_bill_doc_type_code
         and   b.bill_doc_num=:d2_bill_doc_num)
		 and rownum=1;

		if (OERROR)
		{	
		err_mesg(ERR_MESG,"Select bl_patient_charges_folio Failed",0,"");
		proc_exit();
		}

  } b/z instead of v_c_billed_serv we are using adm_rec_flag */

 
/***********************************************************/

if ((strcmp(d_cust_code.arr,"\0")!=0)&& (strcmp(d_adm_rec_flag.arr,"2")==0) && strcmp(nd_pgm_id.arr,"BLREXMAD")!=0 )
 {
	    
	
		get_column_count_cust();

		ccnt=0;
		nd_summary_dtl_ind.arr[0]='\0';
		
		while(fetch_grp_hdr_cur())
		{ 	
			
		
			/** added by vani for crf458.1***/
               //disp_message(ERR_MESG,"1");
			   //disp_message(ERR_MESG,d_payer_adjust_yn.arr);
				if(strcmp(d_payer_adjust_yn.arr,"A")==0)
				{
					if(d_net_reimbursable_amt>d_adj_payer_amt)
					d_net_reimbursable_amt=d_adj_payer_amt;

			//	TEMP1.arr[0] = '\0';
			//	TEMP1.len = 0;

			//	EXEC SQL SELECT :d_net_reimbursable_amt INTO TEMP1 FROM DUAL;
                 
				//  disp_message(ERR_MESG,TEMP1.arr);
					//nd_net_non_reimbursable_amt=0;
				EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
				INTO :nd_net_non_reimbursable_amt
				FROM BL_PATIENT_CHARGES_SLMT_DTL
				WHERE OPERATING_FACILITY_ID =:nd_facility_id
				AND	TRX_DOC_REF=:d1_trx_doc_ref
				AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
				AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
				AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
				AND BILL_DOC_NUM=:d1_bill_doc_num
				AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
				AND SLMT_DOC_NUM=:d_doc_number1;

				//EXEC SQL SELECT :nd_net_non_reimbursable_amt INTO TEMP1 FROM DUAL;
                

				 // disp_message(ERR_MESG,TEMP1.arr);
 
				 // disp_message(ERR_MESG,TEMP1.arr);
				}

				if(strcmp(d_payer_adjust_yn.arr,"O")==0)
				{
					if(d_net_reimbursable_amt>d_adj_payer_amt)
					d_net_reimbursable_amt=d_net_reimbursable_amt-d_adj_payer_amt;
					else
					{
						if(d_net_reimbursable_amt<d_adj_payer_amt)
						d_net_reimbursable_amt=d_net_reimbursable_amt-d_net_reimbursable_amt;
						else
						d_net_reimbursable_amt=d_net_reimbursable_amt-d_net_reimbursable_amt;
					}

					nd_net_non_reimbursable_amt=d_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
				}
			
			/***UPTO HERE***/

		ccnt = ccnt + 1;
		ccnt1= ccnt1+ 1; // printing the header		
		//print_cust_header();  commented as per kuila sir instruction
		//This function  for Printing Payer bill
		print_prt_grp_hdr();   		
		}

		if(end_of_report)
		{
		 nd_net_total=nd_net_total+nd_pat_net_amt2;
		 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
		 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;

		 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
		 print_formated_amt(nd_pat_gross_amt1);
		 if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
		 print_formated_amt(nd_pat_net_amt2);

         if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)  
		 {
		  get_discount_count();
		if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051 
		 print_formated_amt(nd_pat_disc_amt1);
		 }

		 if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
		 {
		  print_formated_amt(nd_upd_net_charge_amt);
		 }
			
		}
		fprintf(fp,"\n");
		lsr_line_cnt();
	
		if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
		
		if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		if( strcmp(c_print_separator_line.arr,"N")!=0)
		prt_line_uc();

		if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
		if( strcmp(c_print_separator_line.arr,"N")!=0)
		prt_line_uc_wide();

		fprintf(fp,"\n");
		lsr_line_cnt();
		fprintf(fp," %-49s",loc_legend68.arr);

		if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
		print_formated_amt(nd_gross_total);
		if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(nd_net_total);
		
		}

		fprintf(fp,"\n");
		lsr_line_cnt();
		if (strcmp(p_serv_disc_on_gross_ind.arr,"R")==0)   
		{
		fprintf(fp," %-49s",loc_legend71.arr);
		print_formated_amt(nd_disc_total);
		fprintf(fp,"\n");
		lsr_line_cnt();
		}

		if (strcmp(p_all_oth_adj_amt_row_ind.arr,"R")==0)  
		{
		fprintf(fp," %-49s",loc_legend78.arr);
		print_formated_amt(d1_tot_adjust_amt);
		fprintf(fp,"\n");
		lsr_line_cnt();

		fprintf(fp," %-49s",loc_legend79.arr);
		print_formated_amt(nd_tot_disc_amount);
		fprintf(fp,"\n");
		lsr_line_cnt();

		fprintf(fp," %-49s",loc_legend72.arr);
		print_formated_amt(d1_bill_tot_exmpt_amt);
		fprintf(fp,"\n");lsr_line_cnt();

		fprintf(fp," %-49s",loc_legend80.arr);
		print_formated_amt(d1_tot_write_off_amt);
		fprintf(fp,"\n");lsr_line_cnt();
		}

		if (strcmp(p_all_oth_adj_amt_row_ind.arr,"S")==0)  
		{
			fprintf(fp," %-49s",loc_legend85.arr);
			print_formated_amt(d1_tot_adjust_amt+nd_tot_disc_amount+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);

			fprintf(fp,"\n");lsr_line_cnt();

			if (strcmp(p_bill_disc_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-49s",loc_legend71.arr);
			print_formated_amt(nd_tot_disc_amount);
			fprintf(fp,"\n");lsr_line_cnt();
			}

			if (strcmp(p_bill_adj_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-49s",loc_legend78.arr);
			print_formated_amt(d1_tot_adjust_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}


			if (strcmp(p_bill_exm_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-49s",loc_legend72.arr);
			print_formated_amt(d1_bill_tot_exmpt_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}

			if (strcmp(p_bill_wo_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-49s",loc_legend80.arr);
			print_formated_amt(d1_tot_write_off_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}

		}

  
  if(strcmp(d_customer2.arr,"\0")!=0)
	{
	  
	  if (strcmp(p_oth_payers_amt_print_row_ind.arr,"R")==0)
		{
			if(k<=1) 
			{
				if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{
				strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
				strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer2.arr));

				fprintf(fp," %-49s",leg_cust.arr);
				leg_cust.arr[0] = '\0';
				put_val(ar_amt[0],nd_oth_payer_amt); 
				nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;
				format_amt(ar_amt[0]);
				fprintf(fp,"%15s",ar_amt[0]);
				}
			}

			else
			{
				if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{
				strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
				strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer2.arr));
				fprintf(fp," %-49s",leg_cust.arr);
				leg_cust.arr[0] = '\0';
				put_val(ar_amt[0],nd_oth_payer_amt); 
				nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;
				format_amt(ar_amt[0]);
				fprintf(fp,"%15s",ar_amt[0]);
				}
				
				/*for (i=1;i<k;i++)
				{
				strcpy(ar_cust.arr,	ar_cust_amt[i]);
				fprintf(fp,"\n");lsr_line_cnt();
				if(strcmp(ar_cust_amt[i],"\0")!=0)
					{
					strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
					strcpy(leg_cust.arr,strcat(leg_cust.arr,ar_cust.arr));
					fprintf(fp," %-49s",leg_cust.arr);
					leg_cust.arr[0] = '\0';
					fprintf(fp,"%15s",ar_amt[i]);
					}
				}*/
			}
		 }
  }

		if (strcmp(p_oth_payers_amt_print_row_ind.arr,"S")==0)
		{
		fprintf(fp," %-49s ",loc_legend81.arr);
		print_formated_amt(nd_tot_oth_payer_amt);
		}
		fprintf(fp,"\n");lsr_line_cnt();
		if (strcmp(p_patient_amt_print_row_ind.arr,"R")==0)
		{
		fprintf(fp," %-49s",loc_legend76.arr);
		print_formated_amt(pat_upd_net_charge_amt);
		}
		fprintf(fp,"\n");lsr_line_cnt();
		if (strcmp(p_bill_net_payable_ind.arr,"R")==0  || strcmp(p_bill_net_payable_ind.arr,"B")==0)
		{
		fprintf(fp," %-49s",loc_legend74.arr);
		print_formated_amt(nd_net_payable);
		nd_net_pay_pat=nd_net_payable;
		}
		fprintf(fp,"\n");lsr_line_cnt();
		close_grp_hdr_cur();		
			
   }
  

else 
if (strcmp(d_cust_code.arr,"\0")==0 || strcmp(nd_pgm_id.arr,"BLREXMAD")==0 )  
 {
   
   if (strcmp(d_adm_rec_flag.arr,"2")==0)
	    
//if (v_c_billed_serv=='Y')
    {

/*	to print all receipts same as cash receipts 

		get_column_count_pat();
		nd_cust_code1.arr[0] ='\0';

		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
		fprintf(fp,"%-34s %21s %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend75.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
		fprintf(fp,"%-34s %21s %17s %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend84.arr,loc_legend75.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)  
		fprintf(fp,"%-34s %21s \n",loc_legend77.arr,loc_legend68.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)  
		fprintf(fp,"%-34s %21s %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend84.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
		fprintf(fp,"%-34s %21s %17s \n",loc_legend77.arr,loc_legend68.arr,loc_legend84.arr,loc_legend69.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
		fprintf(fp,"%-34s %21s \n",loc_legend77.arr,loc_legend68.arr,loc_legend69.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
		fprintf(fp,"%-34s %21s %17s %17s %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend84.arr,loc_legend69.arr,loc_legend75.arr);

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
		fprintf(fp,"%-34s %21s %17s  %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend69.arr,loc_legend75.arr);

		lsr_line_cnt();

		if( lcol_cnt == 1)
		prt_line_uc();
		if(lcol_cnt == 2)
		prt_line_uc_wide();

		if(lcol_cnt == 3)
		prt_line_uc_wide1();

		fprintf(fp,"\n");lsr_line_cnt();
*/

	    
		fetch_single_bill_foramt_bg();
		get_column_count_pat();
		get_legends_cnt();
		
	    print_header_legeds(); 
	

		//fprintf(fp,"%-34s %21s %17s  %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
			
		lsr_line_cnt();

		if( strcmp(c_print_separator_line.arr,"N")!=0)
		{
		
			if( lcol_cnt == 1)
			prt_line_uc();
			if(lcol_cnt == 2)
			prt_line_uc_wide();
			if(lcol_cnt == 3)
			prt_line_uc_wide1();
			fprintf(fp,"\n");lsr_line_cnt();
		}

		open_patient_cur();

		ccnt=0;
		nd1_summary_dtl_ind.arr[0]='\0';
		nd1_prt_grp_hdr_code.arr[0]='\0';
		nd1_prt_grp_line_code.arr[0]='\0';
		nd1_blng_serv_code.arr[0]='\0';
		nd1_mapping_code.arr[0]='\0';  //added by raghava for scf-5413
		while(fetch_patient_cur())
		{ 
			

			/** added by vani for crf458.1***/
			//disp_message(ERR_MESG,"2");
			   //disp_message(ERR_MESG,d_payer_adjust_yn.arr);
				if(strcmp(d_payer_adjust_yn.arr,"A")==0)
					{
						if(d_net_reimbursable_amt>d1_adj_payer_amt)
						d_net_reimbursable_amt=d1_adj_payer_amt;
                    
				//		TEMP1.arr[0] = '\0';
				//TEMP1.len = 0;

				//EXEC SQL SELECT :d_net_reimbursable_amt INTO TEMP1 FROM DUAL;
                 
					//nd_net_non_reimbursable_amt=0;

				EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
				INTO :nd_net_non_reimbursable_amt
				FROM BL_PATIENT_CHARGES_SLMT_DTL
				WHERE OPERATING_FACILITY_ID =:nd_facility_id
				AND	TRX_DOC_REF=:d1_trx_doc_ref
				AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
				AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
				AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
				AND BILL_DOC_NUM=:d1_bill_doc_num
				AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
				AND SLMT_DOC_NUM=:d_doc_number1;

				//EXEC SQL SELECT :nd_net_non_reimbursable_amt INTO TEMP1 FROM DUAL;


				  //disp_message(ERR_MESG,TEMP1.arr);

				  //disp_message(ERR_MESG,TEMP1.arr);  
											
					}

				if(strcmp(d_payer_adjust_yn.arr,"O")==0)
				{
					
					if(d_net_reimbursable_amt>d1_adj_payer_amt)
					d_net_reimbursable_amt=d_net_reimbursable_amt-d1_adj_payer_amt;
					else
					{
						if(d_net_reimbursable_amt<d1_adj_payer_amt)
						d_net_reimbursable_amt=d_net_reimbursable_amt-d_net_reimbursable_amt;
						else
						d_net_reimbursable_amt=d_net_reimbursable_amt-d_net_reimbursable_amt;
					}

				
					
				}

				
				
		
			/***UPTO HERE***/

		 ccnt = ccnt + 1;
		 //print_patient_hdr(); //commneted as per kuila sir instruction on 31/10/2007
		 print_cash_patient_hdr();
		}

        fun_print_end_of_report();
		
		/*if(end_of_report)
		{
		
		 p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
		 p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
		 p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
										    					
		 if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		 print_formated_amt(nd_pat_gross_amt);
										 
		 if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		 print_formated_amt(nd_pat_net_amt1);
						
		 //if(nd_pat_net_amt1>=0)
		 //nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
		 //else
		 nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;

		 if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
		 print_formated_amt(nd_pat_gross_amt);
					
		 if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
		 {
		 print_formated_amt(nd_pat_net_charge_amt);
		 }

	
		 nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

		 if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
		 print_formated_amt(nd_subdiv_amt);
												                    
	    }

		fprintf(fp,"\n");
		lsr_line_cnt();

		if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			{
			if(lcol_cnt == 1)
			prt_line_uc();
			if( lcol_cnt == 2)
			prt_line_uc_wide();
			if( lcol_cnt == 3)
			prt_line_uc_wide1();
			}
		}
		fprintf(fp,"\n");lsr_line_cnt();
		
		fprintf(fp," %-41s",loc_legend68.arr);

		if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		print_formated_amt(p_tot_pat_gross_amt);
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(p_tot_pat_net_amt);

		if(strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0 )
		fprintf(fp,"%36s"," ");
		if(strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 )
		fprintf(fp,"%18s"," ");
   
		if( strcmp(c_bill_subsidized_amt_ind.arr,"R")==0)
		{
		fprintf(fp,"\n%-41s",loc_legend75.arr);lsr_line_cnt();
		print_formated_amt(nd_tot_subdiv_amt);
		}
		if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0)
		print_formated_amt(nd_tot_subdiv_amt);
		fprintf(fp,"\n");lsr_line_cnt();

		if (strcmp(c_serv_disc_on_gross_ind.arr,"R")==0)   
		{
		fprintf(fp," %-41s",loc_legend71.arr);
		print_formated_amt(p_tot_pat_disc_amt);
		}
		fprintf(fp,"\n");lsr_line_cnt();
			
	
		if (strcmp(c_all_oth_adj_amt_ind.arr,"R")==0)  
		{
		fprintf(fp," %-41s",loc_legend78.arr);
		print_formated_amt(d1_tot_adjust_amt);
		fprintf(fp,"\n");lsr_line_cnt();

		fprintf(fp," %-41s",loc_legend79.arr);
		print_formated_amt(nd_tot_disc_amount);
		fprintf(fp,"\n");lsr_line_cnt();

		fprintf(fp," %-41s",loc_legend72.arr);
		print_formated_amt(d1_bill_tot_exmpt_amt);
		fprintf(fp,"\n");lsr_line_cnt();

		fprintf(fp," %-41s",loc_legend80.arr);
		print_formated_amt(d1_tot_write_off_amt);
		fprintf(fp,"\n");lsr_line_cnt();
		}

        if (strcmp(c_all_oth_adj_amt_ind.arr,"S")==0)  
		 {
		fprintf(fp," %-41s",loc_legend78.arr);
		print_formated_amt(d1_tot_adjust_amt+nd_tot_disc_amount+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
		fprintf(fp,"\n");lsr_line_cnt();
		if (strcmp(c_bill_disc_sep_row_yn.arr,"Y")==0)
		{
		fprintf(fp," %-41s",loc_legend71.arr);
		print_formated_amt(nd_tot_disc_amount);
		fprintf(fp,"\n");lsr_line_cnt();
		}
		*/
		  
		 
         /*
		   if (strcmp(c_bill_adj_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-41s",loc_legend78.arr);
			print_formated_amt(d1_tot_adjust_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}

         
			if (strcmp(c_bill_exm_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-41s",loc_legend72.arr);
			print_formated_amt(d1_bill_tot_exmpt_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}

			if (strcmp(c_bill_wo_sep_row_yn.arr,"Y")==0)
			{
			fprintf(fp," %-41s",loc_legend80.arr);
			print_formated_amt(d1_tot_write_off_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}

		     }*/

		/* THIS CINDITION FOR PRINTING  OTHER PAYER	AS ROW */
		
		/*if (strcmp(c_oth_payers_amt_print_row_ind.arr,"R")==0)
	       {

			if(p<=1) 
			{
				if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{
				strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
				strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer3.arr));
				fprintf(fp," %-41s",leg_cust.arr);
				leg_cust.arr[0] = '\0';
				put_val(ar_amt[0],nd_othp_payer_amt); 
				format_amt(ar_amt[0]);
				fprintf(fp,"%15s",ar_amt[0]);
				}

			}

			else
			{
				if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{
				strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
				strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer3.arr));
				fprintf(fp," %-41s",leg_cust.arr);
				leg_cust.arr[0] = '\0';
				put_val(ar_amt[0],nd_othp_payer_amt); 
				format_amt(ar_amt[0]);
				fprintf(fp,"%15s",ar_amt[0]);
				}
				for (i=1;i<=p;++i)
				{
					strcpy(ar_cust.arr,	ar_cust_amt[i]);
					if(strcmp(ar_cust_amt[i],"\0")!=0)
					{
					fetch_customer2();
					strcpy(leg_cust.arr,strcat(loc_legend73.arr," "));
					strcpy(leg_cust.arr,strcat(leg_cust.arr,ar_cust.arr));
					ar_cust.arr[0] ='\0';
					fprintf(fp,"\n");lsr_line_cnt();
					fprintf(fp," %-41s",leg_cust.arr);
					leg_cust.arr[0] = '\0';
					fprintf(fp,"%15s",ar_amt[i]);
					}
				}


			}
		 }

			if (strcmp(c_oth_payers_amt_print_row_ind.arr,"S")==0)
			{
			fprintf(fp," %-41s",loc_legend81.arr);
			print_formated_amt(nd_tot_othp_payer_amt+nd_net_payable);
			}
			fprintf(fp,"\n\n");lsr_line_cnt();lsr_line_cnt();
			if( strcmp(c_bill_net_payable_ind.arr,"B")==0 || strcmp(c_bill_net_payable_ind.arr,"R")==0)
			{
			fprintf(fp," %-41s",loc_legend74.arr);
			print_formated_amt(nd_tot_pat_net_charge_amt);
			nd_net_pay_pat=nd_tot_pat_net_charge_amt;
			fprintf(fp,"\n");
			lsr_line_cnt();
		
			}
			*/
     }          

 
 else 
   {			
	    	
		fetch_single_bill_foramt_bg();

		get_column_count_pat();
		get_legends_cnt();
		
	    print_header_legeds();
	
		//fprintf(fp,"%-34s %21s %17s  %17s\n",loc_legend77.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
			
		lsr_line_cnt();

		if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			{
				if( lcol_cnt == 1)
				prt_line_uc();
				if(lcol_cnt == 2)
				prt_line_uc_wide();

				if(lcol_cnt == 3)
				prt_line_uc_wide1();
				
				fprintf(fp,"\n");lsr_line_cnt();
		    }

		}

		open_patient_cur();
		nd1_summary_dtl_ind.arr[0]='\0';
		nd1_prt_grp_hdr_code.arr[0]='\0';
		nd1_prt_grp_line_code.arr[0]='\0';
		nd1_blng_serv_code.arr[0]='\0';
		nd1_mapping_code.arr[0]='\0';   //added by raghava for scf-5413

		/***** This code added for printing package bill if it is there ****/
	    
		if(l_pkg_len!=0)
		{
		 print_package_dtls(); 
		}
		
		/***** upto here *****/
      
		while(fetch_patient_cur())
		{ 
		ccnt = ccnt + 1;
		print_cash_patient_hdr();
		}
        fun_print_end_of_report(); 
		
   }


}
   
	/*if (l_lsr != 0 && l_dmp == 0 )
	{
		l_main_hdr = 0;
		fprintf(fp,"\n");
		v_lno = v_lno+1;	
	if (v_lno > MAX_LINES) 
	 print_next_page1();
	
	}
	else
	{  
	  
	  if(v_lno!=32)
	  {
	  v_lnum=32-v_lno;
	  v_lno=v_lnum+v_lno;
	  }

	  while(v_lno <= MAX_LINES)
		{
			fprintf(fp,"\n");
			v_lno++;
		}
	 }*/

  }

}

print_package_dtls()
{
	//l_pkg_seq_num.arr[0]='\0';
	//l_pkg_seq_num.len=0;
	for(i=1;i<=l_pkg_len;i++)
	{

		strcpy(l_pkg_seq_num.arr,p_pkg_seq_num[i]);
		l_pkg_seq_num.len = strlen(p_pkg_seq_num[i]);
		l_pkg_seq_num.arr[l_pkg_seq_num.len] = '\0';
		get_pkg_name();
		fprintf(fp," %-30.30s  (%-21.21s : %s)",nd_package_desc.arr,loc_legend1290.arr,p_pkg_seq_num[i]);
		l_pkg_amt=atoi(p_pkg_amt[i]);	//atoi function will convert string to double
		print_formated_amt(l_pkg_amt);
		fprintf(fp,"\n");lsr_line_cnt();
		
	
	}

      	if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
		 if( strcmp(c_print_separator_line.arr,"N")!=0)
		 {
			if(lcol_cnt == 1)
			prt_line_uc();
			if( lcol_cnt == 2)
			prt_line_uc_wide();
			if( lcol_cnt == 3)
			prt_line_uc_wide1();
		  }
		}
		fprintf(fp,"\n");lsr_line_cnt();
		fprintf(fp," %-50.50s",loc_legend1270.arr);
		fprintf(fp,"\n");lsr_line_cnt();
        if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			 {
				if(lcol_cnt == 1)
				prt_line_uc();
				if( lcol_cnt == 2)
				prt_line_uc_wide();
				if( lcol_cnt == 3)
				prt_line_uc_wide1();
			}
		}
	    fprintf(fp,"\n");lsr_line_cnt();
	  /*
		//fprintf(fp,"\n");lsr_line_cnt();
		if( lcol_cnt == 1)
		prt_line_uc();
		if(lcol_cnt == 2)
		prt_line_uc_wide();
		if(lcol_cnt == 3)
		prt_line_uc_wide1();
		if(lcol_cnt == 5 || lcol_cnt == 6)
		prt_line_uc_wide2();
		fprintf(fp,"\n");lsr_line_cnt();
 	    fprintf(fp," %-50.50s",loc_legend[1270]);
		fprintf(fp,"\n");lsr_line_cnt();
		if( lcol_cnt == 1)
		prt_line_uc();
		if(lcol_cnt == 2)
		prt_line_uc_wide();
		if(lcol_cnt == 3)
		prt_line_uc_wide1();
		if(lcol_cnt == 5 || lcol_cnt == 6)
		prt_line_uc_wide2();
		fprintf(fp,"\n");lsr_line_cnt();

     */
}

fun_print_end_of_report()
{
	
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0) 
	fetch_legend_value2();

    if(end_of_report)
	 {

		p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
		p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
		nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;

		//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_pat_net_charge_amt;
		//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; COMMENTED AT 04/11/2007
 
		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		{
		get_addlcharge_count();
		if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
		print_formated_amt1(nd_pat_addl_charge_amt);
		}
	  
        if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		print_formated_amt(nd_pat_gross_amt);
	
	    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )  
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(nd_pat_net_amt1);
	    
		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
		{
		 get_discount_count();
		if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
		print_formated_amt(nd_pat_disc_amt);
		}

		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
		 {
		  nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
		  print_formated_amt(nd_pat_net_amt1); //Net Amount
		 }

		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		 {
			print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt);
		 }
		 else
		 if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
		 {
		 print_formated_amt(nd_pat_net_charge_amt);
		 }

		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if(strcmp(c_reim_amt_ind.arr,"Y")==0)
		print_formated_amt(nd_tot_net_reimbursable_amt); //Total Reimbursable Amt
		
		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		fprintf(fp," ");
		
		if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
		if(strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		print_formated_amt(nd_tot_non_reimbursable_amt); //Total Non Reimbursable Amt 
		
		//print_formated_amt(nd_pat_net_charge_amt);
		
		lsr_line_cnt();
	}

			
		fprintf(fp,"\n");lsr_line_cnt();
		
		if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			{
				if( lcol_cnt == 1)
				prt_line_uc();
				if(lcol_cnt == 2)
				prt_line_uc_wide();
				if(lcol_cnt == 3)
				prt_line_uc_wide1();
			 	fprintf(fp,"\n");lsr_line_cnt();
			}
	
		}
		
	    /*** The Below code added by raghava at BKK on 21/01/2010 *****/		
		if (l_lsr == 0 && l_dmp!= 0)
		{

		 if(strcmp(l_receipt_doc_size.arr,"A4")==0) 
		 {
		  while(v_lno <= (MAX_LINES-15))
		  {
		   fprintf(fp,"\n"); //08/03/2010
		   lsr_line_cnt();
		  }
		 }
		 
		 if(strcmp(nd_preprint_flag.arr,"N")==0)
		 {
		  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  if(d_oth_receipt_amt>=0)
		  fprintf(fp," %-39.39s ",loc_legend68.arr);
		  else
		  fprintf(fp," %-39.39s ",loc_legend1459.arr);
		  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		 }
		 else
		 fprintf(fp," %-39.39s "," ");	
		}
		/*** The Below code added by raghava at BKK on 21/01/2010 *****/	
		else
		{
		 if(d_oth_receipt_amt>=0)
		 fprintf(fp," %-39.39s ",loc_legend68.arr);
		 else
		 fprintf(fp," %-39.39s ",loc_legend1459.arr);
		}
		if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		{
		get_addlcharge_count();
		if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
		print_formated_amt1(nd_total_pat_addl_charge_amt);
		}
		if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		print_formated_amt(p_tot_pat_gross_amt);
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(p_tot_pat_net_amt);
		
		if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
		{ get_discount_count();
		 if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
	      print_formated_amt(nd_tot_pat_disc_amt);

		  print_formated_amt(p_tot_pat_gross_amt-nd_tot_pat_disc_amt);
		  //print_formated_amt(nd_tot_pat_net_charge_amt);	
		}

		if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		 {
		  print_formated_amt(nd_tot_pat_net_charge_amt-nd_total_pat_addl_charge_amt);
		 }
		else
		if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
		 {
		 print_formated_amt(nd_tot_pat_net_charge_amt);
		 }
				
		/***** Printing Total Reimbursable Amt *****/
	//	if(strcmp(nd_preprint_flag.arr,"N")==0)                     //Added by raghava on 10/01/2010 for Siriraj format
       // {
		 if (strcmp(c_reim_amt_ind.arr,"Y")==0)
		 print_formated_amt(nd_gnd_tot_net_reimbursable_amt);    
		 fprintf(fp," ");
	//	}

		/***** Printing Total Non Reimbursable Amt *****/
		if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
		print_formated_amt(nd_gnd_tot_net_non_reimbursable_amt);
		//print_formated_amt(nd_tot_pat_net_charge_amt);
       	fprintf(fp,"\n");lsr_line_cnt();

		/***** Printing Total Service Line Discount Amt *****/
		if (strcmp(c_serv_disc_on_gross_ind.arr,"R")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
		{
		  
		  fprintf(fp," %-39.39s ",loc_legend71.arr);
		  get_discount_count();
		  if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
		  print_formated_amt(nd_tot_pat_disc_amt);
		  fprintf(fp,"\n");lsr_line_cnt();
		} 

		if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0 && (strcmp(d_bill_format.arr,"B")== 0 && d_oth_receipt_amt>=0))
		{		
		/****** Printing Grand Total ******/
		nd_grnd_total=nd_gnd_tot_net_reimbursable_amt+nd_gnd_tot_net_non_reimbursable_amt; 	
	
		if(legend_cnt==1)
		{
		if(l_cnt_no_of_legends==4)
		{
		 if (l_lsr == 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  {
		   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		   fprintf(fp," %-87.87s ",loc_legend54.arr);
		   fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  }
		  else
		  fprintf(fp," %-87.87s "," ");	
		 }
		 else
		 fprintf(fp," %-87.87s ",loc_legend54.arr);
		}
		else
		{
		 if (l_lsr == 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  {
		   //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		   fprintf(fp," %-26.26s ",loc_legend54.arr);
		   //fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  }
		  else
		  fprintf(fp," %-26.26s "," ");
		 }
		 else
		 fprintf(fp," %-26.26s ",loc_legend54.arr);
		}
		if (l_lsr == 0 && l_dmp!= 0)
		{
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 print_formated_amt(nd_grnd_total);
		 fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		}
		else
		print_formated_amt(nd_grnd_total);
		}
		if(legend_cnt==2) 
		{
		 if (l_lsr == 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  {
		   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		   fprintf(fp," %-55.55s ",loc_legend54.arr);
		   fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  }
		  else
		  fprintf(fp," %-55.55s "," ");
		 }
		 else
		 fprintf(fp," %-55.55s ",loc_legend54.arr);
		 if (l_lsr == 0 && l_dmp!= 0)
		 {
		  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  print_formated_amt(nd_grnd_total);
		  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		 }
		 else
		 print_formated_amt(nd_grnd_total);
		}
		if(legend_cnt==4) 
		{
		 if(l_lsr == 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  {
		   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		   fprintf(fp," %-94.94s ",loc_legend54.arr);
		   fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  }
		  else
		  fprintf(fp," %-94.94s "," ");
		 }
		else
		fprintf(fp," %-94.94s ",loc_legend54.arr);
		if(l_lsr == 0 && l_dmp!= 0)
		{
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 print_formated_amt(nd_grnd_total);
		 fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		}
		else
		print_formated_amt(nd_grnd_total);
		}
		if(legend_cnt==9) 
		{
		 if(l_lsr == 0 && l_dmp!= 0)
		 {
		  if(strcmp(nd_preprint_flag.arr,"N")==0)
		  {
		   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		   fprintf(fp," %-57.57s ",loc_legend54.arr);
		   fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  }
		  else
		   fprintf(fp," %-57.57s ",loc_legend54.arr);
		 }
		 else
		 fprintf(fp," %-57.57s "," ");
		 if(l_lsr == 0 && l_dmp!= 0)
		 {
		  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  print_formated_amt(nd_grnd_total);
		  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		 }
		 else
		 print_formated_amt(nd_grnd_total);
		}
        fprintf(fp,"\n");lsr_line_cnt();	
	   } 
     

	   /***** Printing Bill Adjustments As Separate Row *****/
	    if (strcmp(c_all_oth_adj_amt_ind.arr,"R")==0)  
		{
			
			if(nd_tot_disc_amount!=0)
			{
			fprintf(fp," %-40.40s",loc_legend79.arr);
			print_formated_amt(nd_tot_disc_amount);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			if(d1_tot_adjust_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend78.arr);
			print_formated_amt(d1_tot_adjust_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			if(d1_bill_tot_exmpt_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend72.arr);
			print_formated_amt(d1_bill_tot_exmpt_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			if(d1_tot_write_off_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend80.arr);
			print_formated_amt(d1_tot_write_off_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
		}

		/***** Printing Bill Adjustments As Summarized Row *****/
		if (strcmp(c_all_oth_adj_amt_ind.arr,"S")==0)  
		{
			if(d1_tot_adjust_amt!=0 || nd_tot_disc_amount!=0 || d1_bill_tot_exmpt_amt!=0 || d1_tot_write_off_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend85.arr);
			print_formated_amt(d1_tot_adjust_amt+nd_tot_disc_amount+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
	
			if (strcmp(c_bill_adj_sep_row_yn.arr,"Y")==0)
			{
			if(d1_tot_adjust_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend78.arr);
			print_formated_amt(d1_tot_adjust_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			}
		
			if (strcmp(c_bill_disc_sep_row_yn.arr,"Y")==0)
			{
			if(nd_tot_disc_amount!=0)
			{
			fprintf(fp," %-40.40s",loc_legend79.arr);
			print_formated_amt(nd_tot_disc_amount);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			}
			
			if (strcmp(c_bill_exm_sep_row_yn.arr,"Y")==0)
			{
			if(d1_bill_tot_exmpt_amt!=0)
			{	
			fprintf(fp," %-40.40s",loc_legend72.arr);
			print_formated_amt(d1_bill_tot_exmpt_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			}
		
			if (strcmp(c_bill_wo_sep_row_yn.arr,"Y")==0)
			{
			if(d1_tot_write_off_amt!=0)
			{
			fprintf(fp," %-40.40s",loc_legend80.arr);
			print_formated_amt(d1_tot_write_off_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
			}

		}
           
		/***** Printing Additional Charge Amt As Row *****/		
		if(strcmp(c_addl_charge_amt_ind.arr,"R")==0)
		{
		   if(nd_total_pat_addl_charge_amt!=0)
		   {
		   fprintf(fp," %-39.39s ",loc_legend1230.arr);
		   print_formated_amt(nd_total_pat_addl_charge_amt);
		   fprintf(fp,"\n");lsr_line_cnt();
		   }
		}
		
	   //fprintf(fp," %-39.39s ",loc_legend74.arr);      //Printing Net Payable Amt as row
	   //print_formated_amt(nd_tot_pat_net_charge_amt);
		 nd_net_pay_pat=(nd_tot_pat_net_charge_amt+nd_gnd_tot_net_reimbursable_amt);
		  	  
	   
	    /***** Added on 30/09/2008 for printing package deposit if it is there *****/	 

		  if(l_pkg_len!=0)
		  {
	
			fprintf(fp,"%-41.41s",loc_legend1260.arr);
			fprintf(fp,"\n");lsr_line_cnt(); 
			for(i=1;i<=l_pkg_len;i++)
			{
			  fprintf(fp,"       %-21.21s : %-6.6s",loc_legend1290.arr,p_pkg_seq_num[i]);
			  l_pkg_dep_amt=atoi(p_pkg_dep_amt[i]);	//atoi function will convert string to double
			  print_formated_amt(l_pkg_dep_amt);
			  fprintf(fp,"\n"); //lsr_line_cnt(); 
			}
		  }
		   
		   
		 /***** Printing Deposit Amt As Row *****/	
		   if(d1_deposit_adj_amt!=0)
			{
			//fprintf(fp,"\n");lsr_line_cnt();
			fprintf(fp,"%-41.41s",loc_legend88.arr);
			print_formated_amt(d1_deposit_adj_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			fprintf(fp,"%-41.41s",loc_legend89.arr);
			print_formated_amt(d1_bill_tot_outst_amt);
			fprintf(fp,"\n");lsr_line_cnt();
			}
		  
		

}

declare_master_cur()
{
	
	EXEC SQL DECLARE HEADER_CUR CURSOR FOR
			SELECT 
			EPISODE_TYPE,
			EPISODE_ID,
			VISIT_ID,
			PATIENT_ID,
			ENCOUNTER_ID,
			CUST_CODE, 
			BILL_PRINT_FLAG,
			NVL(PREPAY_ADJ_AMT,0)+NVL(DEPOSIT_ADJ_AMT,0)+NVL(SPL_AGENCY_DEP_ADJ_AMT,0)Deposit_Adjusted,
			BILL_TOT_OUTST_AMT,   
			MAN_DISC_AMT,
			OVERALL_DISC_AMT,
			BILL_TOT_ADJUST_AMT,            
			BILL_TOT_EXEMPT_AMT,            
			BILL_TOT_WRITE_OFF_AMT,
			BILL_NATURE_CODE,
			BLNG_GRP_ID,
			ACCT_SEQ_NO,
			nvl(BILL_AMT,0) BILL_AMT 
	    FROM BL_BILL_HDR
		WHERE OPERATING_FACILITY_ID = :nd_facility_id
		AND DOC_TYPE_CODE			= :d2_bill_doc_type_code
		AND to_char(DOC_NUM)		= :d2_bill_doc_num;
		//AND episode_type			= :l_episode_type;


		if (OERROR)
		{ 
			disp_message (ERR_MESG,"Declare Master Cursor failed");
			proc_exit();
		}
	
	return;
}

open_master_cur()
{ 
	EXEC SQL OPEN HEADER_CUR;

	if (OERROR) 
	{ 
	disp_message (ERR_MESG,"Open HEADER_CUR cursor failed");
	proc_exit();
	}
return;
}

fetch_master_cur()
{
	d_episode_type.arr[0]	= '\0';
	d_episode_type.len		=   0;
	d_episode_id.arr[0]		= '\0';
	d_episode_id.len		=   0;
	d_visit_id.arr[0]		= '\0';
	d_visit_id.len			=   0;
	d_patient_id.arr[0]		= '\0';
	d_patient_id.len		=   0;
	d_encounter_id.arr[0]	= '\0';
	d_encounter_id.len		=   0;
	d_cust_code.arr[0]		= '\0';
	dc_bill_print_flag.arr[0] = '\0';
	d_bill_nature_code.arr[0] = '\0';
	d_acct_seq_no.arr[0]      = '\0';
	d_bill_nature_code.len    =   0 ;
	dc_blng_grp_id.arr[0]     = '\0';
	dc_blng_grp_id.len		  =   0 ;
	dc_bill_print_flag.len    =   0;
	d_cust_code.len           =   0;
	d_acct_seq_no.len         =   0;
	

EXEC SQL FETCH HEADER_CUR INTO 
	d_episode_type,
	d_episode_id,
	d_visit_id,
	d_patient_id,
	d_encounter_id,
	d_cust_code,
	dc_bill_print_flag,
	d1_deposit_adj_amt,
	d1_bill_tot_outst_amt,
	d1_man_disc_amt,
	d1_overall_disc_amt,
	d1_tot_adjust_amt,
	d1_bill_tot_exmpt_amt,
	d1_tot_write_off_amt,
	d_bill_nature_code,
	dc_blng_grp_id,
	d_acct_seq_no,
	d1_bill_amt;

	
	if(NODATAFOUND)
	{
		return 0;
	}
	
	
	if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN HEADER_CUR",0,"");
		proc_exit();
	}

	

	d_episode_type.arr[d_episode_type.len]			 ='\0';
	d_episode_id.arr[d_episode_id.len]				 ='\0';	
	d_visit_id.arr[d_visit_id.len]					 ='\0';	
	d_patient_id.arr[d_patient_id.len]				 ='\0';	
	d_encounter_id.arr[d_encounter_id.len]			 ='\0';	
	d_cust_code.arr[d_cust_code.len]				 ='\0';
	dc_bill_print_flag.arr[dc_bill_print_flag.len]   ='\0';	
	d_bill_nature_code.arr[d_bill_nature_code.len]   ='\0';
	dc_blng_grp_id.arr[dc_blng_grp_id.len]			 ='\0';
	d_acct_seq_no.arr[d_acct_seq_no.len]			 ='\0';
	
	return 1;

}

close_master_cur()
{ 
	EXEC SQL CLOSE HEADER_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close header cursor failed");
	proc_exit();
	}
	return;
}


declare_payment_type_det()
{

	EXEC SQL SELECT NVL(sum(doc_amt),0) INTO d_hdr_doc_amt 
			 FROM bl_receipt_refund_hdr
			 WHERE DOC_TYPE_CODE=:d_doc_type_code1
			 AND DOC_NUMBER=:d_doc_number1
			 AND OPERATING_FACILITY_ID = :nd_facility_id;

	EXEC SQL SELECT NVL(sum(doc_amt),0) INTO d_dtl_doc_amt 
			 FROM bl_receipt_refund_dtl
			 WHERE DOC_TYPE_CODE=:d_doc_type_code1
			 AND DOC_NUMBER=:d_doc_number1
			 AND OPERATING_FACILITY_ID = :nd_facility_id;

	if ( d_hdr_doc_amt== d_dtl_doc_amt )
	{
		EXEC SQL DECLARE PAYMENT_CUR CURSOR FOR
			SELECT
			A.DOC_AMT,
			A.SLMT_TYPE_CODE,
			C.SHORT_DESC,
			B.CASH_SLMT_FLAG,
			A.SLMT_DOC_REF_DESC,
			A.BANK_CODE,
			A.REF_DEP_DOC_TYPE_CODE,
			A.REF_DEP_DOC_NUMBER,
			A.REF_DEP_DOC_SRNO,
			TRIM(A.PAYER_NAME),
			A.RCPT_RFND_ID_NO,
			A.SLMT_DOC_REF_DATE,
			B.CASHIER_CHEQUE_YN
			FROM BL_RECEIPT_REFUND_DTL A,BL_SLMT_TYPE B,
			BL_SLMT_TYPE_LANG_VW C
			WHERE
			A.OPERATING_FACILITY_ID = :nd_facility_id
			AND a.DOC_TYPE_CODE=:d_doc_type_code1
			AND a.DOC_NUMBER=:d_doc_number1
			AND A.SLMT_TYPE_CODE=B.SLMT_TYPE_CODE
			AND B.SLMT_TYPE_CODE=C.SLMT_TYPE_CODE
			AND UPPER(C.LANGUAGE_ID)=UPPER(:nd_lang_id)
			AND B.acc_entity_code in (select acc_entity_code 
			from sy_acc_entity_lang_vw
			where acc_entity_id = :nd_facility_id
			and language_id= :nd_lang_id)
			order by A.DOC_SRNO;     //Added by raghava on 20/07/2010 
			//order by A.PAYER_NAME;  Commented by raghava on 20/07/2010 
      }
	else
	  {
		EXEC SQL DECLARE PAYMENT_CUR1 CURSOR FOR
			SELECT
			A.DOC_AMT,
			A.SLMT_TYPE_CODE,
			B.SHORT_DESC,
			B.CASH_SLMT_FLAG,
			A.SLMT_DOC_REF_DESC,
			A.BANK_CODE,
			A.REF_DEP_DOC_TYPE_CODE,
			A.REF_DEP_DOC_NUMBER,
			A.REF_DEP_DOC_SRNO,
			TRIM(A.PAYER_NAME),
			A.RCPT_RFND_ID_NO,
			A.SLMT_DOC_REF_DATE,
			B.CASHIER_CHEQUE_YN
			FROM BL_RECEIPT_REFUND_DTL A,BL_SLMT_TYPE B,BL_RECEIPT_REFUND_HDR C,
			BL_SLMT_TYPE_LANG_VW D
			WHERE
			A.OPERATING_FACILITY_ID = :nd_facility_id
			AND a.DOC_TYPE_cODE=C.DOC_TYPE_CODE
			AND A.DOC_NUMBER=C.DOC_NUMBER
			AND A.DOC_AMT=C.DOC_AMT
			AND a.DOC_TYPE_CODE=:d_doc_type_code1
			AND a.DOC_NUMBER=:d_doc_number1
			AND A.SLMT_TYPE_CODE=B.SLMT_TYPE_CODE
			AND B.SLMT_TYPE_CODE=D.SLMT_TYPE_CODE
			AND UPPER(D.LANGUAGE_ID)=UPPER(:nd_lang_id)
			AND B.acc_entity_code in (select acc_entity_code 
			from sy_acc_entity_lang_vw
			where acc_entity_id = :nd_facility_id
			and language_id= :nd_lang_id)
			order by A.DOC_SRNO;            //Added by raghava on 20/07/2010 
			//order by A.PAYER_NAME;  Commented by raghava on 20/07/2010 

	   }


	if (OERROR) 
	{
		disp_message (ERR_MESG,"Failed to Declare Pyament Type Cursor");
		proc_exit;
	}
	
	return;
}

open_payment_cur()
{ 
   if ( d_hdr_doc_amt== d_dtl_doc_amt )
   {
	EXEC SQL OPEN PAYMENT_CUR;
	}
	else
	{
	EXEC SQL OPEN PAYMENT_CUR1;
	}

	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open payment_det_cur cursor failed");
		proc_exit();
	}
	return;
}


fetch_payment_det_cur()
{

	d_settlement_type_code.arr[0]   = '\0'; 
	d_settlement_desc.arr[0]		= '\0';
	d_cash_slmt_flag.arr[0]			= '\0';
	d_slmnt_doc_ref.arr[0]          = '\0';
	d_bank_code.arr[0]				= '\0';
	d_ref_dep_doc_type_code.arr[0]	= '\0';
	d_ref_dep_doc_number.arr[0]		= '\0';
	d_ref_dep_doc_srno.arr[0]		= '\0';
	d_payer_name.arr[0]			    = '\0';
	d_rcpt_rfnd_id_no.arr[0]		= '\0';
	d_slmt_doc_ref_date.arr[0]		= '\0';
    d_cashier_cheque_yn.arr[0]      = '\0';
    

	d_settlement_type_code.len		= 0;
	d_settlement_desc.len			= 0;
	d_cash_slmt_flag.len			= 0;
	d_slmnt_doc_ref.len				= 0;
	d_bank_code.len					= 0;
	d_ref_dep_doc_type_code.len		= 0;
	d_ref_dep_doc_number.len		= 0;
	d_ref_dep_doc_srno.len			= 0;
	d_payer_name.len				= 0;
	d_rcpt_rfnd_id_no.len			= 0;
	d_slmt_doc_ref_date.len			= 0;
    d_cashier_cheque_yn.len         = 0; 


	if ( d_hdr_doc_amt== d_dtl_doc_amt )
	{
		EXEC SQL FETCH PAYMENT_CUR INTO 
		  d_pay_amt,
		  d_settlement_type_code,
		  d_settlement_desc,
		  d_cash_slmt_flag,
		  d_slmnt_doc_ref,
		  d_bank_code,
		  d_ref_dep_doc_type_code,
		  d_ref_dep_doc_number,
		  d_ref_dep_doc_srno,
		  d_payer_name,
		  d_rcpt_rfnd_id_no,
		  d_slmt_doc_ref_date,
		  d_cashier_cheque_yn;

	 }
	else
	{
		 EXEC SQL FETCH PAYMENT_CUR1 INTO 
		  d_pay_amt,
		  d_settlement_type_code,
		  d_settlement_desc,
		  d_cash_slmt_flag,
		  d_slmnt_doc_ref,
		  d_bank_code,
		  d_ref_dep_doc_type_code,
		  d_ref_dep_doc_number,
		  d_ref_dep_doc_srno,
		  d_payer_name,
		  d_rcpt_rfnd_id_no,
		  d_slmt_doc_ref_date,
		  d_cashier_cheque_yn;
		

	 }


	d_settlement_type_code.arr[d_settlement_type_code.len]	= '\0'; 
	d_settlement_desc.arr[d_settlement_desc.len]			= '\0';
	d_cash_slmt_flag.arr[d_cash_slmt_flag.len]				= '\0';
	d_slmnt_doc_ref.arr[d_slmnt_doc_ref.len]				= '\0';
	d_bank_code.arr[d_bank_code.len]						= '\0';
	d_ref_dep_doc_type_code.arr[d_ref_dep_doc_type_code.len]= '\0'; 
	d_ref_dep_doc_number.arr[d_ref_dep_doc_number.len]		= '\0';
	d_ref_dep_doc_srno.arr[d_ref_dep_doc_srno.len]			= '\0';
	d_payer_name.arr[d_payer_name.len]					    = '\0';
	d_rcpt_rfnd_id_no.arr[d_rcpt_rfnd_id_no.len]			= '\0';
	d_slmt_doc_ref_date.arr[d_slmt_doc_ref_date.len]		= '\0';
    d_cashier_cheque_yn.arr[d_cashier_cheque_yn.len]        = '\0'; 


  
  if(NODATAFOUND)
	{
		return 0;
	}
  

  if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN PAYMENT_CUR",0,"");
		proc_exit();
	}

	

    return 1;

}

close_payment_cur()
{ 
	if ( d_hdr_doc_amt== d_dtl_doc_amt )
	EXEC SQL CLOSE PAYMENT_CUR;
	else
	EXEC SQL CLOSE PAYMENT_CUR1;

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close header cursor failed");
		proc_exit();
	}
	return;
}
/** The below code added by raghava on 21/07/2010 ****/
declare_adjst_dep_cur()
{


	EXEC SQL DECLARE ADJST_DEP_CUR CURSOR FOR
			 SELECT  ORG_DEP_DOC,
             REF_DEP_DOC_TYPE_CODE,
             REF_DEP_DOC_NUMBER,       
             SUM(DOC_AMT)
             FROM
            (
        		SELECT
        		A.DOC_AMT,
        		A.OPERATING_FACILITY_ID,
				A.REF_DEP_DOC_TYPE_CODE, 
        		A.REF_DEP_DOC_NUMBER, 
        		A.REF_DEP_DOC_SRNO,
				BLCOMMON.GET_ORG_DEP_DOC 
				 (A.OPERATING_FACILITY_ID,
				  A.REF_DEP_DOC_TYPE_CODE,
				  A.REF_DEP_DOC_NUMBER,
				  A.REF_DEP_DOC_SRNO
				  )ORG_DEP_DOC
				 FROM BL_RECEIPT_REFUND_DTL A
				 WHERE A.OPERATING_FACILITY_ID = :nd_facility_id
				 AND a.DOC_TYPE_CODE=:d_doc_type_code1
				 AND a.DOC_NUMBER=:d_doc_number1
				 AND A.REF_DEP_DOC_TYPE_CODE IS NOT NULL
				 AND A.REF_DEP_DOC_NUMBER IS NOT NULL
				 AND A.REF_DEP_DOC_SRNO IS NOT NULL
            )    
           GROUP BY ORG_DEP_DOC,REF_DEP_DOC_TYPE_CODE,REF_DEP_DOC_NUMBER;
            
     

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Failed to Declare ADJST_DEP_CUR Cursor");
		proc_exit;
	}
	
	return;
}

open_adjst_dep_cur()
{ 

	EXEC SQL OPEN ADJST_DEP_CUR;


	if (OERROR) 
	{	
		
	    disp_message (ERR_MESG,"Open ADJST_DEP_CUR cursor failed");
		proc_exit();
	}
	return;
}
fetch_adjst_dep_cur()
{


	 d_org_dep_num.arr[0]	    = '\0';
	 d_dep_doc_type_code.arr[0]	= '\0';
	 d_dep_doc_number.arr[0]	= '\0';

	 d_org_dep_num.len			=  0;
	 d_dep_doc_type_code.len    =  0;
	 d_dep_doc_number.len		=  0;

	 EXEC SQL FETCH ADJST_DEP_CUR INTO 
			  d_org_dep_num,
			  d_dep_doc_type_code,
			  d_dep_doc_number,
			  tot_dep_adj_amt;
			  

	d_org_dep_num.arr[d_org_dep_num.len] = '\0';
	d_dep_doc_type_code.arr[d_dep_doc_type_code.len]='\0';
    d_dep_doc_number.arr[d_dep_doc_number.len]='\0';

  
  if(NODATAFOUND)
	{
		return 0;
	}
 
  if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN ADJST_DEP_CUR",0,"");
		proc_exit();
	}

	

    return 1;

}
close_adjst_dep_cur()
{ 

	EXEC SQL CLOSE ADJST_DEP_CUR;

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close ADJST_DEP_CUR failed");
		proc_exit();
	}
	return;
}
/** upto here raghava on 21/07/2010 ****/

declare_ref_cur()
{

	
	EXEC SQL DECLARE REF_CUR CURSOR FOR
		SELECT
		A.REF_DEP_DOC_TYPE_CODE,
		A.REF_DEP_DOC_NUMBER,
		A.REF_DEP_DOC_SRNO
		FROM BL_RECEIPT_REFUND_DTL A,BL_RECEIPT_REFUND_HDR C
		WHERE A.OPERATING_FACILITY_ID = :nd_facility_id
		AND a.DOC_TYPE_cODE=C.DOC_TYPE_CODE
		AND A.DOC_NUMBER=C.DOC_NUMBER
		AND a.DOC_TYPE_CODE=:d_doc_type_code1
		AND a.DOC_NUMBER=:d_doc_number1;



	if (OERROR) 
	{
		disp_message (ERR_MESG,"Failed to Declare REF_CUR Cursor");
		proc_exit;
	}
	
	return;
}

open_ref_cur()
{ 

	EXEC SQL OPEN REF_CUR;

	if (OERROR) 
	{	
	  disp_message (ERR_MESG,"Open REF_CUR cursor failed");
	  proc_exit();
	}
	return;
}

fetch_ref_cur()
{


	d5_ref_dep_doc_type_code.arr[0]	= '\0';
	d5_ref_dep_doc_number.arr[0]	= '\0';
	d5_ref_dep_doc_srno.arr[0]	= '\0';
	

	d5_ref_dep_doc_type_code.len	= 0;
	d5_ref_dep_doc_number.len	= 0;
	d5_ref_dep_doc_srno.len		= 0;

	 EXEC SQL FETCH REF_CUR INTO 
			  d5_ref_dep_doc_type_code,
			  d5_ref_dep_doc_number,
			  d5_ref_dep_doc_srno;



	d5_ref_dep_doc_type_code.arr[d5_ref_dep_doc_type_code.len]= '\0'; 
	d5_ref_dep_doc_number.arr[d5_ref_dep_doc_number.len]		= '\0';
	d5_ref_dep_doc_srno.arr[d5_ref_dep_doc_srno.len]			= '\0';


  if(NODATAFOUND)
	{
		return 0;
	}
  

  if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN REF_CUR",0,"");
		proc_exit();
	}

    return 1;

}

close_ref_cur()
{ 

	EXEC SQL CLOSE REF_CUR;

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close REF_CUR cursor failed");
		proc_exit();
	}
	return;
}

declare_grp_hdr_cur()
{


	/***** Commented By raghava on 06/01/2010 for making new query 

  EXEC SQL DECLARE  BL_BILL_GRP_HDR_LINE_CUR CURSOR FOR
 	SELECT TRX_DOC_REF,
	TRX_DOC_REF_LINE_NUM,
	TRX_DOC_REF_SEQ_NUM, 
	CUST_CODE,
	A.BLNG_SERV_CODE,
	DECODE(module_id,'PH','M','ST','M','MM','M','S') MAPPING_CODE_IND,
	SERV_ANAL_GRP1||SERV_ANAL_GRP2,
	SERV_CLASSIFICATION_CODE,
	SERV_ITEM_CODE, 
	DECODE(module_id,'PH',NVL(SERV_ITEM_DESC_OTH_LANG,SERV_ITEM_DESC),'X'),
	PAYER_SERV_GRP_HDR,
	PAYER_SERV_GRP_LINE,
	A.PRT_GRP_HDR_CODE,
	A.PRT_GRP_LINE_CODE,
	BILL_DOC_TYPE_CODE,
	BILL_DOC_NUM,
	ENT_ITEM_GRP_CODE,
	PAYER_ITEM_GRP_CODE,
	BLCORE.GET_PAYER_DOC_PRINT_SEQ(A.OPERATING_FACILITY_ID, 
	EPISODE_TYPE,
	CUST_CODE, 
	CUST_GROUP_CODE,
	PAYER_SERV_GRP_HDR, 
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE) PRINT_SEQ,
    Decode(:nd_detail_type_yn,'Y',Decode(:nd_option,'C','S','N','DXA', 
	nvl(BLCORE.GET_BILL_FORMAT_IND(A.OPERATING_FACILITY_ID,
	CUST_GROUP_CODE,
	CUST_CODE,
	BLNG_GRP_ID,
	EPISODE_TYPE,
	PAYER_SERV_GRP_HDR, 
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE, 
	PAYER_ITEM_GRP_CODE),'SGN')),nvl(BLCORE.GET_BILL_FORMAT_IND(A.OPERATING_FACILITY_ID,
	CUST_GROUP_CODE,
	CUST_CODE,
	BLNG_GRP_ID,
	EPISODE_TYPE,
	PAYER_SERV_GRP_HDR, 
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE, 
	PAYER_ITEM_GRP_CODE),'SGN')) SUMMARY_DTL_IND,
	UPD_GROSS_CHARGE_AMT,
	UPD_DISC_AMT,
	UPD_NET_CHARGE_AMT,
	NET_REIMBURSABLE_AMT,
	ADDL_CHARGE_AMT_IN_CHARGE,
	NVL(PACKAGE_TRX_YN,'N'),
	PACKAGE_SEQ_NO,
	NVL(ADJ_PAYER_DIST_AMT,0)
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND UPD_NET_CHARGE_AMT <>0
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
    06/01/2010 ****/
	/*
	AND 
	(
			nvl(trx_status,'N')<>'C' 
			or
			(
			nvl(trx_status,'N')='C' and 
			A.bill_doc_type_code =:d2_bill_doc_type_code
			AND A.BILL_DOC_NUM =  :d2_bill_doc_num
			and 
			  ( 
				  ( 
				(ORIG_DOC_REF, ORIG_DOC_REF_LINE_NUM,ORIG_DOC_REF_SEQ_NUM) in
				( select
				  trx_doc_ref,trx_doc_ref_line_num ,TRX_DOC_REF_SEQ_NUM
				  from bl_patient_charges_folio where trx_status = 'C'           		
				  and operating_facility_id = :nd_facility_id
				  and patient_id =:d_patient_id
				  and 
				   (
					   (:d_episode_type IN('O','E')
					   and episode_id = NVL(:d_episode_id,EPISODE_ID)
					   and visit_id   = NVL(: ,VISIT_ID))
					   OR(:d_episode_type IN('I','D')
					   and episode_id = NVL(:d_episode_id,EPISODE_ID))
					) 
				AND bill_doc_type_code||BILL_DOC_NUM<> A.bill_doc_type_code||A.BILL_DOC_NUM) 
				   )  
			  ) 
			)
	)
	*/
	/*** 06/01/2010
	 and (trx_status is null 

                or (trx_status ='C' and  
						
					  (	(REV_ADJ_TRX_IND='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                         bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                         patient_id=:d_patient_id         and 

                         bill_doc_type_code =:d2_bill_doc_type_code

                         and bill_doc_num =  :d2_bill_doc_num)
						)
						or (:d1_bill_amt=0)
					  )
					) 

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

                        bill_doc_type_code =:d2_bill_doc_type_code

                        and bill_doc_num =  :d2_bill_doc_num )

        ))
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
	AND B.BILL_DOC_NUM =:d2_bill_doc_num)
	ORDER BY CUST_CODE, Decode(:nd_detail_type_yn,'Y',SERV_CLASSIFICATION_CODE,PAYER_ITEM_GRP_CODE),ENT_ITEM_GRP_CODE, 
	DECODE(PAYER_SERV_GRP_HDR,NULL, A.PRT_GRP_HDR_CODE, PAYER_SERV_GRP_HDR), 
	PRINT_SEQ ,  SUMMARY_DTL_IND, 
	DECODE(PAYER_SERV_GRP_LINE, NULL,A.PRT_GRP_LINE_CODE, PAYER_SERV_GRP_LINE);
  
   06/01/2010 for making new query *****/
 
 /***** 06/01/2010 new query *****/
   
  EXEC SQL DECLARE  BL_BILL_GRP_HDR_LINE_CUR CURSOR FOR
 	SELECT TRX_DOC_REF,
	TRX_DOC_REF_LINE_NUM,
	TRX_DOC_REF_SEQ_NUM, 
	CUST_CODE,
	A.BLNG_SERV_CODE,
	DECODE(module_id,'PH','M','ST','M','MM','M','S') MAPPING_CODE_IND,
	SERV_ANAL_GRP1||SERV_ANAL_GRP2,
	SERV_CLASSIFICATION_CODE,
	SERV_ITEM_CODE, 
	DECODE(module_id,'PH',NVL(SERV_ITEM_DESC_OTH_LANG,SERV_ITEM_DESC),'X'),
	PAYER_SERV_GRP_HDR,  
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE,
	A.PRT_GRP_LINE_CODE,
	BILL_DOC_TYPE_CODE,
	BILL_DOC_NUM,
	ENT_ITEM_GRP_CODE,
	PAYER_ITEM_GRP_CODE,
	BLCORE.GET_PAYER_DOC_PRINT_SEQ(A.OPERATING_FACILITY_ID, 
	EPISODE_TYPE,
	CUST_CODE, 
	CUST_GROUP_CODE,
	NULL,--PAYER_SERV_GRP_HDR,  Commented by raghava at BKK for walk-through issue
	NULL,--PAYER_SERV_GRP_LINE, Commented by raghava at BKK for walk-through issue
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE) PRINT_SEQ,
    Decode(:nd_detail_type_yn,'Y',Decode(:nd_option,'C','S','N','DXA', 
	nvl(BLCORE.GET_RECEIPT_FORMAT_IND(A.OPERATING_FACILITY_ID,
	Nvl(:lv_episode_type,EPISODE_TYPE),
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE),'SGN')),nvl(BLCORE.GET_RECEIPT_FORMAT_IND(A.OPERATING_FACILITY_ID,
	Nvl(:lv_episode_type,EPISODE_TYPE),
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE),'SGN')) SUMMARY_DTL_IND,
	UPD_GROSS_CHARGE_AMT,
	UPD_DISC_AMT,
	UPD_NET_CHARGE_AMT,
	NET_REIMBURSABLE_AMT,
	ADDL_CHARGE_AMT_IN_CHARGE,
	NVL(PACKAGE_TRX_YN,'N'),
	PACKAGE_SEQ_NO,
	NVL(ADJ_PAYER_DIST_AMT,0),
	A.SERV_QTY
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND (  (Nvl(:c_print_zero_net_amt_serv_yn,'N')='N' and UPD_NET_CHARGE_AMT <>0)   //06/01/2010
	     or(Nvl(:c_print_zero_net_amt_serv_yn,'N')='Y')								 //06/01/2010
	    )
	AND ( ( :l_con_rcpt_yn='Y') or (EPISODE_TYPE = :d_episode_type and :l_con_rcpt_yn='N') )
	AND ((((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and 
 	//AND ((((:d3_bill_doc_type_code Is Not Null and :l_con_rcpt_yn='N')) and 
			 (
				(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
				OR 
				(:d_episode_type = 'R')
			 )
	     and (
				(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
				OR
				(:d_episode_type IN ('I','D','R'))
	         )
		 )
        or
		(:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
       )
	AND PATIENT_ID = :d_patient_id
	
	 and (trx_status is null 

                or (trx_status ='C' and  
						
					  (	(REV_ADJ_TRX_IND='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 
                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
					    /* the below code added by raghava on 23/09/2010 for UAT */
						or
                        (REV_ADJ_TRX_IND IS NULL and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) not in 
                         (Select NVL(SOURCE_DOC_REF,'XXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,9999) from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						/*upto here */
						or (  ((:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and :l_sum_bill_amt=0)
						    or(((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and :d1_bill_amt=0)
						   )
					  )
					) 
 					//or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) Commented by raghava on 04/10/2010 for UAT
                    //    not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from  Commented by raghava on 04/10/2010 for UAT
					or (REV_ADJ_TRX_IND ='B' and (nvl(SOURCE_DOC_REF,'XXXXXXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,99999999)) 
                        not in (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 
								bl_patient_charges_folio 
								where OPERATING_FACILITY_ID = :nd_facility_id 
								and patient_id=:d_patient_id           
								and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								   )
							   )

        ))
	AND EXISTS (SELECT B.TRX_DOC_REF,B.TRX_DOC_REF_LINE_NUM,B.TRX_DOC_REF_SEQ_NUM FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND	B.TRX_DOC_REF_SEQ_NUM  = A.TRX_DOC_REF_SEQ_NUM
	AND ( (((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))     
		   AND B.BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
	       AND B.BILL_DOC_NUM =:d2_bill_doc_num
		  )
		 OR(  ( (:nd_pgm_id='BLRRCCOU') and :d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and 
		      (B.BILL_DOC_TYPE_CODE,B.BILL_DOC_NUM) In
		      (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
				FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
				WHERE a.operating_facility_id=:nd_facility_id
				AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
				AND b.BILL_DOC_NUM = a.DOC_NUM
				AND b.DOC_TYPE_CODE  =:d_doc_type_code1
				AND b.DOC_NUMBER=:d_doc_number1	
			  )
		    )
		   OR(	  (:nd_pgm_id='BLREXMAD') and 
				  (BILL_DOC_TYPE_CODE,BILL_DOC_NUM) In
				  (	SELECT ADJ_DOC_TYPE_CODE,ADJ_DOC_NUM
					FROM bl_bill_adj_dtl
					WHERE operating_facility_id=:nd_facility_id
					AND DOC_TYPE_CODE  =:d_doc_type_code1
					AND DOC_NUM=:d_doc_number1	
				  )
				
			 )
		   
		)
	 )
	ORDER BY CUST_CODE, Decode(:nd_detail_type_yn,'Y',Decode(:nd_option,'C',SERV_CLASSIFICATION_CODE,'N',a.blng_serv_code),PAYER_ITEM_GRP_CODE), --,ENT_ITEM_GRP_CODE, Commented by raghava at BKK 07/03/2010 for walk-through issue
	DECODE(PAYER_SERV_GRP_HDR,NULL,A.PRT_GRP_HDR_CODE,PAYER_SERV_GRP_HDR), 
	PRINT_SEQ,SUMMARY_DTL_IND,DECODE(PAYER_SERV_GRP_LINE,NULL,A.PRT_GRP_LINE_CODE,PAYER_SERV_GRP_LINE);

 /***** 06/01/2010 new query *****/



	if (OERROR) 
	{	
	
		disp_message (ERR_MESG,"Failed to Declare Group Header Cursor");
		proc_exit;
	}
	
	return;
}

open_grp_hdr_cur()
{
	EXEC SQL OPEN BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open Cursor Group Header Failed");
		proc_exit();
	}
	return;
}

close_grp_hdr_cur()
{ 
	EXEC SQL CLOSE BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close BL_BILL_GRP_HDR_LINE_CUR failed");
		proc_exit();
	}
	return;
}

fetch_grp_hdr_cur()
{
		
	
	d_trx_doc_ref.arr[0]			= '\0';
	d_trx_doc_ref_line_num.arr[0]	= '\0';
	d_trx_doc_ref_seq_num.arr[0]	= '\0';
	d_cust_code1.arr[0]				= '\0';
	d_blng_serv_code.arr[0]			= '\0';
	d_mapping_code_ind.arr[0]		= '\0';
	d_serv_anal_grp.arr[0]			= '\0';
	d_serv_class_code.arr[0]		= '\0';
	d_serv_item_code.arr[0]			= '\0';
	d_serv_item_desc.arr[0]			= '\0';
	d_payer_serv_grp_hdr.arr[0]		= '\0';
	d_payer_serv_grp_line.arr[0]	= '\0';
	d_prt_grp_hdr_code.arr[0]		= '\0';
	d_prt_grp_line_code.arr[0]		= '\0';
	d_bill_doc_type_code.arr[0]		= '\0';
	d_bill_doc_num.arr[0]			= '\0';
	d_ent_item_grp_code.arr[0]		= '\0';
	d_payer_item_grp_code.arr[0]	= '\0';
	d_summary_dtl_ind.arr[0]		= '\0';
	d_package_trx_yn.arr[0]			= '\0';
	

	d_trx_doc_ref.len				= 0;
	d_trx_doc_ref_line_num.len		= 0;
	d_trx_doc_ref_seq_num.len		= 0;
	d_cust_code1.len				= 0;
	d_blng_serv_code.len			= 0;
	d_mapping_code_ind.len			= 0;
	d_serv_anal_grp.len				= 0;
	d_serv_class_code.len			= 0;
	d_serv_item_code.len			= 0; 
	d_serv_item_desc.len			= 0;
	d_payer_serv_grp_hdr.len		= 0;
	d_payer_serv_grp_line.len		= 0;
	d_prt_grp_hdr_code.len			= 0;
	d_prt_grp_line_code.len			= 0;
	d_bill_doc_type_code.len		= 0;
	d_bill_doc_num.len				= 0;
	d_ent_item_grp_code.len			= 0;
	d_payer_item_grp_code.len		= 0;
	d_summary_dtl_ind.len			= 0;
	d_package_trx_yn.len		    = 0;
	

	EXEC SQL FETCH BL_BILL_GRP_HDR_LINE_CUR INTO	
		:d_trx_doc_ref,
		:d_trx_doc_ref_line_num,
		:d_trx_doc_ref_seq_num,
		:d_cust_code1,
		:d_blng_serv_code,
		:d_mapping_code_ind,
		:d_serv_anal_grp,
		:d_serv_class_code,
		:d_serv_item_code,
		:d_serv_item_desc,
		:d_payer_serv_grp_hdr,
		:d_payer_serv_grp_line,
		:d_prt_grp_hdr_code,
		:d_prt_grp_line_code,
		:d_bill_doc_type_code,
		:d_bill_doc_num,
		:d_ent_item_grp_code,
		:d_payer_item_grp_code,
		:d_print_seq,
		:d_summary_dtl_ind,
		:d_upd_gross_charge_amt,
		:d_upd_disc_amt,
		:d_upd_net_charge_amt,
		:d_net_reimbursable_amt,
		:d_addl_charge_amt_in_charge,
		:d_package_trx_yn,
		:d_package_seq_no,
		:d_adj_payer_amt,
		:d_serv_qty;
		
	
	if(NODATAFOUND)
	{
   		return 0;
	}
	
	
	if (OERROR)
	{ 
		disp_message(ERR_MESG,"Fetch Group Header Cursor Failed");
		proc_exit();
	}
    
    strcpy(d_summary_dtl_ind.arr,"DLA");

	d_trx_doc_ref.arr[d_trx_doc_ref.len]					= '\0';
	d_trx_doc_ref_line_num.arr[d_trx_doc_ref_line_num.len]	= '\0';
	d_trx_doc_ref_seq_num.arr[d_trx_doc_ref_seq_num.len]	= '\0';
	d_cust_code1.arr[d_cust_code1.len]						= '\0';
	d_blng_serv_code.arr[d_blng_serv_code.len]				= '\0';
	d_mapping_code_ind.arr[d_mapping_code_ind.len]			= '\0';
	d_serv_anal_grp.arr[d_serv_anal_grp.len]				= '\0';
	d_serv_class_code.arr[d_serv_class_code.len]			= '\0';
	d_serv_item_code.arr[d_serv_item_code.len]				= '\0';
	d_serv_item_desc.arr[d_serv_item_desc.len]				= '\0';
	d_payer_serv_grp_hdr.arr[d_payer_serv_grp_hdr.len]		= '\0';
	d_payer_serv_grp_line.arr[d_payer_serv_grp_line.len]	= '\0';
	d_prt_grp_hdr_code.arr[d_prt_grp_hdr_code.len]			= '\0';
	d_prt_grp_line_code.arr[d_prt_grp_line_code.len]		= '\0';
	d_bill_doc_type_code.arr[d_bill_doc_type_code.len]		= '\0';
	d_bill_doc_num.arr[d_bill_doc_num.len]					= '\0';
	d_ent_item_grp_code.arr[d_ent_item_grp_code.len]		= '\0';
	d_payer_item_grp_code.arr[d_payer_item_grp_code.len]	= '\0';
    d_summary_dtl_ind.arr[d_summary_dtl_ind.len]			= '\0';
	d_package_trx_yn.arr[d_package_trx_yn.len]				= '\0';



	return 1;
}


open_patient_cur()
{	
	EXEC SQL OPEN BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open Cursor Group Header Failed");
		proc_exit();
	}
	return;
}


close_patient_cur()
{ 
	EXEC SQL CLOSE BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close BL_BILL_GRP_HDR_LINE_CUR failed");
	proc_exit();
	}
	return;
}

fetch_patient_cur()
{
	d1_trx_doc_ref.arr[0]				= '\0';
	d1_trx_doc_ref_line_num.arr[0]		= '\0';
	d1_trx_doc_ref_seq_num.arr[0]		= '\0';
	d1_cust_code1.arr[0]				= '\0';
	d1_blng_serv_code.arr[0]			= '\0';
	d1_mapping_code_ind.arr[0]			= '\0';
	d1_serv_anal_grp.arr[0]				= '\0';
	d1_serv_class_code.arr[0]			= '\0';
	d1_serv_item_code.arr[0]			= '\0';
	d1_serv_item_desc.arr[0]			= '\0';
	d1_payer_serv_grp_hdr.arr[0]		= '\0';
	d1_payer_serv_grp_line.arr[0]		= '\0';
	d1_prt_grp_hdr_code.arr[0]			= '\0';
	d1_prt_grp_line_code.arr[0]			= '\0';
	d1_bill_doc_type_code.arr[0]		= '\0';
	d1_bill_doc_num.arr[0]				= '\0';
	d1_ent_item_grp_code.arr[0]			= '\0';
	d1_payer_item_grp_code.arr[0]		= '\0';
	d1_summary_dtl_ind.arr[0]			= '\0';
	d1_package_trx_yn.arr[0]		    = '\0';

	d1_trx_doc_ref.len				= 0;
	d1_trx_doc_ref_line_num.len		= 0;
	d1_trx_doc_ref_seq_num.len		= 0;
	d1_cust_code1.len				= 0;
	d1_blng_serv_code.len			= 0;
	d1_mapping_code_ind.len			= 0;
	d1_serv_anal_grp.len			= 0;
	d1_serv_class_code.len			= 0;
	d1_serv_item_code.len			= 0;
	d1_serv_item_desc.len			= 0; 
	d1_payer_serv_grp_hdr.len		= 0;
	d1_payer_serv_grp_line.len		= 0;
	d1_prt_grp_hdr_code.len			= 0;
	d1_prt_grp_line_code.len		= 0;
	d1_bill_doc_type_code.len		= 0;
	d1_bill_doc_num.len				= 0;
	d1_ent_item_grp_code.len		= 0;
	d1_payer_item_grp_code.len		= 0;
	d1_summary_dtl_ind.len			= 0;
	d1_package_trx_yn.len		    = 0;


	EXEC SQL FETCH BL_BILL_GRP_HDR_LINE_CUR INTO	
		:d1_trx_doc_ref,
		:d1_trx_doc_ref_line_num,
		:d1_trx_doc_ref_seq_num,
		:d1_cust_code1,
		:d1_blng_serv_code,
		:d1_mapping_code_ind,
		:d1_serv_anal_grp,
		:d1_serv_class_code,
		:d1_serv_item_code,
		:d1_serv_item_desc,
		:d1_payer_serv_grp_hdr,
		:d1_payer_serv_grp_line,
		:d1_prt_grp_hdr_code,
		:d1_prt_grp_line_code,
		:d1_bill_doc_type_code,
		:d1_bill_doc_num,
		:d1_ent_item_grp_code,
		:d1_payer_item_grp_code,
		:d1_print_seq,
		:d1_summary_dtl_ind,
		:d1_upd_gross_charge_amt,
		:d1_upd_disc_amt,
		:d1_upd_net_charge_amt,
		:d_net_reimbursable_amt,
		:d1_addl_charge_amt_in_charge,
		:d1_package_trx_yn,
		:d1_package_seq_no,
		:d1_adj_payer_amt,
		:d1_serv_qty;

	
	if(NODATAFOUND)
	{
   		return 0;
	}
	
	
	if (OERROR)
	{ 
		disp_message(ERR_MESG,"Fetch Group Header Cursor Failed");
		proc_exit();
	}

   //strcpy(d1_summary_dtl_ind.arr,"DLS"); 
   
	d1_trx_doc_ref.arr[d1_trx_doc_ref.len]						= '\0';
	d1_trx_doc_ref_line_num.arr[d1_trx_doc_ref_line_num.len]	= '\0';
	d1_trx_doc_ref_seq_num.arr[d1_trx_doc_ref_seq_num.len]		= '\0';
	d1_cust_code1.arr[d1_cust_code1.len]						= '\0';
	d1_blng_serv_code.arr[d1_blng_serv_code.len]				= '\0';
	d1_mapping_code_ind.arr[d1_mapping_code_ind.len]			= '\0';
	d1_serv_anal_grp.arr[d1_serv_anal_grp.len]					= '\0';
	d1_serv_class_code.arr[d1_serv_class_code.len]				= '\0';
	d1_serv_item_code.arr[d1_serv_item_code.len]				= '\0';
	d1_serv_item_desc.arr[d1_serv_item_desc.len]				= '\0';
	d1_payer_serv_grp_hdr.arr[d1_payer_serv_grp_hdr.len]		= '\0';
	d1_payer_serv_grp_line.arr[d1_payer_serv_grp_line.len]		= '\0';
	d1_prt_grp_hdr_code.arr[d1_prt_grp_hdr_code.len]			= '\0';
	d1_prt_grp_line_code.arr[d1_prt_grp_line_code.len]			= '\0';
	d1_bill_doc_type_code.arr[d1_bill_doc_type_code.len]		= '\0';
	d1_bill_doc_num.arr[d1_bill_doc_num.len]					= '\0';
	d1_ent_item_grp_code.arr[d1_ent_item_grp_code.len]			= '\0';
	d1_payer_item_grp_code.arr[d1_payer_item_grp_code.len]		= '\0';
    d1_summary_dtl_ind.arr[d1_summary_dtl_ind.len]				= '\0';
	d1_package_trx_yn.arr[d1_package_trx_yn.len]			    = '\0';


	return 1;
}
get_service_amt()
{
 

 EXEC SQL EXECUTE
 DECLARE
  CURSOR C_SERV Is	
	SELECT TRX_DOC_REF,
	TRX_DOC_REF_LINE_NUM,
	TRX_DOC_REF_SEQ_NUM, 
	CUST_CODE,
	A.BLNG_SERV_CODE,
	DECODE(module_id,'PH','M','ST','M','MM','M','S') MAPPING_CODE_IND,
	SERV_ANAL_GRP1||SERV_ANAL_GRP2,
	SERV_CLASSIFICATION_CODE,
	SERV_ITEM_CODE, 
	DECODE(module_id,'PH',NVL(SERV_ITEM_DESC_OTH_LANG,SERV_ITEM_DESC),'X'),
	PAYER_SERV_GRP_HDR,  
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE,
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE,
	PAYER_ITEM_GRP_CODE,
	BLCORE.GET_PAYER_DOC_PRINT_SEQ(A.OPERATING_FACILITY_ID, 
	EPISODE_TYPE,
	CUST_CODE, 
	CUST_GROUP_CODE,
	NULL,--PAYER_SERV_GRP_HDR,  Commented by raghava at BKK for walk-through issue
	NULL,--PAYER_SERV_GRP_LINE, Commented by raghava at BKK for walk-through issue
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE) PRINT_SEQ,
    Decode(:nd_detail_type_yn,'Y',Decode(:nd_option,'C','S','N','DXA', 
	nvl(BLCORE.GET_RECEIPT_FORMAT_IND(A.OPERATING_FACILITY_ID,
	Nvl(:lv_episode_type,EPISODE_TYPE),
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE),'SGN')),nvl(BLCORE.GET_RECEIPT_FORMAT_IND(A.OPERATING_FACILITY_ID,
	Nvl(:lv_episode_type,EPISODE_TYPE),
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE),'SGN')) SUMMARY_DTL_IND,
	UPD_GROSS_CHARGE_AMT,
	UPD_DISC_AMT,
	UPD_NET_CHARGE_AMT,
	NET_REIMBURSABLE_AMT,
	ADDL_CHARGE_AMT_IN_CHARGE,
	NVL(PACKAGE_TRX_YN,'N'),
	PACKAGE_SEQ_NO,
	NVL(ADJ_PAYER_DIST_AMT,0) ADJ_PAYER_DIST_AMT,
	A.SERV_QTY SERV_QTY
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND (  (Nvl(:c_print_zero_net_amt_serv_yn,'N')='N' and UPD_NET_CHARGE_AMT <>0)   //06/01/2010
	     or(Nvl(:c_print_zero_net_amt_serv_yn,'N')='Y')								 //06/01/2010
	    )
	AND ( ( :l_con_rcpt_yn='Y') or (EPISODE_TYPE = :d_episode_type and :l_con_rcpt_yn='N') )
	AND ((((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and 
 	//AND ((((:d3_bill_doc_type_code Is Not Null and :l_con_rcpt_yn='N')) and 
			 (
				(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
				OR 
				(:d_episode_type = 'R')
			 )
	     and (
				(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
				OR
				(:d_episode_type IN ('I','D','R'))
	         )
		 )
        or
		(:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
       )
	AND PATIENT_ID = :d_patient_id
	
	 and (trx_status is null 

                or (trx_status ='C' and  
						
					  (	(REV_ADJ_TRX_IND='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 
                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
					    /* the below code added by raghava on 23/09/2010 for UAT */
						or
                        (REV_ADJ_TRX_IND IS NULL and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) not in 
                         (Select NVL(SOURCE_DOC_REF,'XXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,9999) from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						/* upto here */
						or (  ((:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and :l_sum_bill_amt=0)
						    or(((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and :d1_bill_amt=0)
						   )
					  )
					) 

                    //or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) Commented by raghava on 04/10/2010 for UAT
                    //    not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from  Commented by raghava on 04/10/2010 for UAT
					or (REV_ADJ_TRX_IND ='B' and (nvl(SOURCE_DOC_REF,'XXXXXXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,99999999)) 
                        not in (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 		bl_patient_charges_folio 
								where OPERATING_FACILITY_ID = :nd_facility_id 
								and patient_id=:d_patient_id           
								and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								   )
							   )

        ))
	AND EXISTS (SELECT B.TRX_DOC_REF,B.TRX_DOC_REF_LINE_NUM,B.TRX_DOC_REF_SEQ_NUM FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND	B.TRX_DOC_REF_SEQ_NUM  = A.TRX_DOC_REF_SEQ_NUM
	AND ( (((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))     
		   AND B.BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
	       AND B.BILL_DOC_NUM =:d2_bill_doc_num
		  )
		 OR(  ( (:nd_pgm_id='BLRRCCOU') and :d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and 
		      (B.BILL_DOC_TYPE_CODE,B.BILL_DOC_NUM) In
		      (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
				FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
				WHERE a.operating_facility_id=:nd_facility_id
				AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
				AND b.BILL_DOC_NUM = a.DOC_NUM
				AND b.DOC_TYPE_CODE  =:d_doc_type_code1
				AND b.DOC_NUMBER=:d_doc_number1	
			  )
		    )
		   OR(	  (:nd_pgm_id='BLREXMAD') and 
				  (BILL_DOC_TYPE_CODE,BILL_DOC_NUM) In
				  (	SELECT ADJ_DOC_TYPE_CODE,ADJ_DOC_NUM
					FROM bl_bill_adj_dtl
					WHERE operating_facility_id=:nd_facility_id
					AND DOC_TYPE_CODE  =:d_doc_type_code1
					AND DOC_NUM=:d_doc_number1	
				  )
				
			 )
		   
		)
	 )
	AND A.PRT_GRP_HDR_CODE=:d1_prt_grp_hdr_code
	AND A.PRT_GRP_LINE_CODE=:d1_prt_grp_line_code
	AND A.BLNG_SERV_CODE=:d1_blng_serv_code
	ORDER BY CUST_CODE, Decode(:nd_detail_type_yn,'Y',SERV_CLASSIFICATION_CODE,PAYER_ITEM_GRP_CODE), --,ENT_ITEM_GRP_CODE, Commented by raghava at BKK 07/03/2010 for walk-through issue
	DECODE(PAYER_SERV_GRP_HDR,NULL,A.PRT_GRP_HDR_CODE,PAYER_SERV_GRP_HDR), 
	PRINT_SEQ,SUMMARY_DTL_IND,DECODE(PAYER_SERV_GRP_LINE,NULL,A.PRT_GRP_LINE_CODE,PAYER_SERV_GRP_LINE);

  l_org_pat_gross_amt Number:=0;
  l_org_pat_net_amt   Number:=0;
  l_org_pat_disc_amt  Number:=0;
  l_org_add_chrg_amt  Number:=0;
  l_pat_net_amount	  Number:=0;
  l_tot_amt_payable   Number:=0;
  l_tot_net_reim_amt  Number:=0;
  l_non_net_reim_amt  Number:=0;
  l_tot_net_non_reim_amt Number:=0;
  l_tot_qty           Number:=0;
 BEGIN
  
  For I In C_SERV Loop
   :l_dba_cnt:=nvl(:l_dba_cnt,0)+1;
 	BLCOMMON.GET_SERV_TOT_AMT_BY_TRX(
	:nd_facility_id,
	 I.trx_doc_ref,
	 I.trx_doc_ref_line_num,
	:p_pat_gross_amt,
	:p_pat_disc_amt,
	:p_pat_net_amt,
	:p_err_level,
	:p_sys_message_id,
	:p_error_text);
     
	if :p_sys_message_id is not null then
	:p_err_level := '10';
	:p_error_text := blcommon.get_error_text(:p_sys_message_id);
	end if;

    l_org_pat_gross_amt:=l_org_pat_gross_amt+:p_pat_gross_amt;
	l_org_pat_net_amt  :=l_org_pat_net_amt+:p_pat_net_amt;
	l_org_pat_disc_amt :=l_org_pat_disc_amt+:p_pat_disc_amt;
    l_org_add_chrg_amt :=l_org_add_chrg_amt+nvl(I.ADDL_CHARGE_AMT_IN_CHARGE,0);
    l_tot_amt_payable  :=l_tot_amt_payable+nvl(I.upd_net_charge_amt,0);
	l_tot_net_reim_amt :=l_tot_net_reim_amt+nvl(I.net_reimbursable_amt,0);
    l_tot_qty		   :=l_tot_qty+I.SERV_QTY;
	if :d_payer_adjust_yn='A' then
		
		SELECT ABS(SETTLED_AMT-I.NET_REIMBURSABLE_AMT)
		INTO l_tot_net_non_reim_amt
		FROM BL_PATIENT_CHARGES_SLMT_DTL
		WHERE OPERATING_FACILITY_ID =:nd_facility_id
		AND	TRX_DOC_REF=I.trx_doc_ref
		AND TRX_DOC_REF_LINE_NUM=I.trx_doc_ref_line_num
		AND TRX_DOC_REF_SEQ_NUM=I.trx_doc_ref_seq_num
		AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
		AND BILL_DOC_NUM=:d1_bill_doc_num
		AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
		AND SLMT_DOC_NUM=:d_doc_number1;
      
	  
	else

		if :d_payer_adjust_yn='O' then
		 l_tot_net_non_reim_amt:=l_tot_net_non_reim_amt+(nvl(I.upd_net_charge_amt,0)-(nvl(I.ADJ_PAYER_DIST_AMT,0)+nvl(I.net_reimbursable_amt,0)));
	    else
		 l_tot_net_non_reim_amt:=l_tot_net_non_reim_amt+(nvl(I.upd_net_charge_amt,0)-nvl(I.net_reimbursable_amt,0));
		end if;
	end if;

  End Loop;

   :p_pat_gross_amt:=l_org_pat_gross_amt;
   :p_pat_net_amt  :=l_org_pat_net_amt;
   :p_pat_disc_amt :=l_org_pat_disc_amt;
   :d1_upd_net_charge_amt:=l_tot_amt_payable;
   :d1_addl_charge_amt_in_charge:=l_org_add_chrg_amt;
   :d_net_reimbursable_amt:=l_tot_net_reim_amt;
   :nd_tot_non_reimbursable_amt:=l_tot_net_non_reim_amt;
   :nd_tot_serv_qty            :=l_tot_qty;
 END;
 END-EXEC;

}
get_adm_rec_flag()
{

  d_adm_rec_flag.arr[d_adm_rec_flag.len]='\0';
  d_adm_rec_flag.len=0;

 EXEC SQL Select b.ADM_REC_FLAG  
		INTO :d_adm_rec_flag  
		from BL_ENCOUNTER_PAYER_PRIORITY a,bl_blng_grp b
		where OPERATING_FACILITY_ID =:nd_facility_id
		and a.patient_id =:d_patient_id
		and a.EPISODE_TYPE = :d_episode_type
		and ((:d_episode_type in ('O','E','I','D') and EPISODE_ID   =:d_episode_id) or :d_episode_type ='R')
		and ((:d_episode_type in ('O','E') and VISIT_ID =:d_visit_id ) or (:d_episode_type in ('R','I','D')))
		and a.ACCT_SEQ_NO  = :d_acct_seq_no
		and priority	 = 1
		and a.blng_grp_id = b.blng_grp_id;

	
	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Failed to Declare Group Header Cursor");
	
	}
     d_adm_rec_flag.arr[d_adm_rec_flag.len]='\0';

}

/* THIS FUNCTION WILL PRINT THE PAYER BILL */
 
print_prt_grp_hdr()
 { 
       get_discount_count(); 
	       
		    l_receipt_type=2;   	 		  
				fetch_bill_foramt_payer();
				if (ccnt1==1)
				{
			
				fetch_cust_cur();
								
				if(strcmp(nd_preprint_flag.arr,"N")==0)
				 {
				if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
				 {
					if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
					fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend84.arr);
					else
					fprintf(fp," \n%-25.25s %-20s %18s ",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr);
					lsr_line_cnt();
				 }

				 if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
				 {
					fprintf(fp," \n%-25.25s %-20s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr);
					lsr_line_cnt();
				 }


               if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
			    {

					if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
					fprintf(fp," \n%-25.25s %-20s %18s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend84.arr,loc_legend69.arr);
					else
					fprintf(fp," \n%-25.25s %-20s %18s  %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend69.arr);
				lsr_line_cnt();
				}

               if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
			    {
				fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend69.arr);
				lsr_line_cnt();
				}
				
					if( strcmp(c_print_separator_line.arr,"N")!=0)
					{
     					fprintf(fp,"\n");
						lsr_line_cnt();
						prt_line_uc();
					}
				}
               }

			if (strcmp(d_cust_code1.arr,"\0")==0)
	         {  
			  pat_upd_gross_charge_amt=pat_upd_gross_charge_amt+d_upd_gross_charge_amt;
			  pat_upd_net_charge_amt=pat_upd_net_charge_amt+d_upd_net_charge_amt;
			  pat_upd_disc_amt=pat_upd_disc_amt+d_upd_disc_amt;
	         }
		   else
		   {
             if(strcmp(d_cust_code1.arr,d_cust_code.arr)==0)
              {

      
				 /*****************summary****************/

			  if(d_summary_dtl_ind.arr[0] == 'S')  
			   {
				  if( ccnt==1)
					{
                       					 
					 get_print_group_hd_desc3();
					 get_print_group_line_desc3();
					 //get_blng_serv_desc();
					 get_blng_classification_desc();

					if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='C') 
					{
						fprintf(fp,"%-3.3s - %-43.43s",d_serv_class_code.arr,nd_blng_class_desc.arr);
					}
					else
					if(nd_option.arr[0]=='A') 
					{
					   if(nd_summary_dtl_ind.arr[0] == 'D')
					   {
							if(d_summary_dtl_ind.arr[1] == 'L')
							{
							
							//fprintf(fp,"%-23.23s - %-23.23s",nd_prt_line_desc.arr," ");
							fprintf(fp," %-13.13s   %-36.36s"," ",nd_prt_line_desc.arr);	
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s - %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
							}
							else
							{
							fprintf(fp,"%-10.10s   %-36.36s"," ",nd_prt_hd_desc.arr);
							}	
							
						}
						else
						{
							if(d_summary_dtl_ind.arr[1] == 'L')
							{ 
							//fprintf(fp,"\n%-23.23s - %-23.23s",nd_prt_line_desc.arr," ");	
							fprintf(fp,"\n %-10.10s   %-36.36s"," ",nd_prt_line_desc.arr);
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s - %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
							}
							else
							{
							
							fprintf(fp,"\n %-10.10s   %-36.36s"," ",nd_prt_hd_desc.arr);
							}	
							lsr_line_cnt();
						}

					}

					//fprintf(fp," %-10.10s %-20.20s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
					get_gross_net_amt1();
								
					nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
					nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
					nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
									
					nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;  //total service AmtPayable
					nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				   //total AmtPayable	
					
					end_of_report=1;
					}
				  else
				  if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='C')
				   {
					 if(strcmp(d_serv_class_code.arr,nd_serv_class_code.arr)==0)
					 {
						nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; // Total sevicewise Amtpayable
						nd_net_payable=nd_net_payable+d_upd_net_charge_amt;               // Total Amtpayable
																
					    get_gross_net_amt1();
											
						nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 				
						end_of_report=1;
					 }
					 else
					 {
						 nd_net_total=nd_net_total+nd_pat_net_amt2;
						 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
						 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;	

						 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
						 print_formated_amt(nd_pat_gross_amt1);
					     if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt2);

                         if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0) 
						 {
						  get_discount_count();
						  if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
							 print_formated_amt(nd_pat_disc_amt1);
						 }

						 if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					     {
						 print_formated_amt(nd_upd_net_charge_amt);
						 }

						 nd_pat_gross_amt1=0;
						 nd_pat_net_amt2=0;
						 nd_pat_disc_amt1=0;
						 nd_upd_net_charge_amt=0;

						 //get_print_group_hd_desc3();
					     //get_print_group_line_desc3();
						 //fprintf(fp,"\n%-23.23s - %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						 
						 get_blng_classification_desc();
						 fprintf(fp,"\n%-3.3s - %-43.43s",d_serv_class_code.arr,nd_blng_class_desc.arr);
					
						 
						 lsr_line_cnt();
						 
						 get_gross_net_amt1();

						 nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;  //Total sevicewise Amtpayable
						 nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				// Total Amtpayable
											
						 nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						 nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						 nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 
						 end_of_report=1;

						}
					}

    			 else
				 if(nd_option.arr[0]=='A')
				  {
				  if(d_summary_dtl_ind.arr[1] == 'L')
				   {
					if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)==0 && strcmp(d_prt_grp_line_code.arr,nd_prt_grp_line_code.arr)==0
					&& strcmp(d_payer_serv_grp_hdr.arr,nd_payer_serv_grp_hdr.arr)==0 && strcmp(d_payer_serv_grp_line.arr,nd_payer_serv_grp_line.arr)==0)
					 {
						
						nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; // Total sevicewise Amtpayable
						nd_net_payable=nd_net_payable+d_upd_net_charge_amt;               // Total Amtpayable
																
					    get_gross_net_amt1();
											
						nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 				
						end_of_report=1;
					 }
					else
					 {
						 nd_net_total=nd_net_total+nd_pat_net_amt2;
						 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
						 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;	

						 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
						 print_formated_amt(nd_pat_gross_amt1);
					     if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt2);

                         if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)  
						 { 
						  get_discount_count();
						 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
							 print_formated_amt(nd_pat_disc_amt1);
						 }

						 if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					     {
						 print_formated_amt(nd_upd_net_charge_amt);
						 }

						 nd_pat_gross_amt1=0;
						 nd_pat_net_amt2=0;
						 nd_pat_disc_amt1=0;
						 nd_upd_net_charge_amt=0;

						 get_print_group_hd_desc3();
					     get_print_group_line_desc3();
 						 //fprintf(fp,"\n%-23.23s   %-23.23s",nd_prt_line_desc.arr," ");
						 fprintf(fp,"\n %-15.15s   %-36.36s"," ",nd_prt_line_desc.arr);	
					     //Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
						 //fprintf(fp,"\n%-23.23s - %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						 lsr_line_cnt();
						 
						 //get_blng_serv_desc();
						 //fprintf(fp," %-10.10s %-20.20s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
						 
						 get_gross_net_amt1();

						 nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;  //Total sevicewise Amtpayable
						 nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				// Total Amtpayable
											
						 nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						 nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						 nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 
						 end_of_report=1;

						}
									 
					}

				 else
				  {
					if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)==0 && strcmp(d_payer_serv_grp_hdr.arr,nd_payer_serv_grp_hdr.arr)==0)
					 {
						
						nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; // Total sevicewise Amtpayable
						nd_net_payable=nd_net_payable+d_upd_net_charge_amt;               // Total Amtpayable
																
					    get_gross_net_amt1();
											
						nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 				
						end_of_report=1;
					 }
					else
					 {
						 nd_net_total=nd_net_total+nd_pat_net_amt2;
						 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
						 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;	

						 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
						 print_formated_amt(nd_pat_gross_amt1);
					     if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt2);

                         if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0) 
						 {  
							 get_discount_count();
							if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
							print_formated_amt(nd_pat_disc_amt1);
						 }

						 if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					     {
						 print_formated_amt(nd_upd_net_charge_amt);
						 }

						 nd_pat_gross_amt1=0;
						 nd_pat_net_amt2=0;
						 nd_pat_disc_amt1=0;
						 nd_upd_net_charge_amt=0;

						 get_print_group_hd_desc3();
					     get_print_group_line_desc3();
						 
						 fprintf(fp,"\n %-10.10s   %-36.36s"," ",nd_prt_hd_desc.arr);	
						 lsr_line_cnt();
						 //get_blng_serv_desc();
						 //fprintf(fp," %-10.10s %-20.20s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
						 
						 get_gross_net_amt1();

						 nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;  //Total sevicewise Amtpayable
						 nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				// Total Amtpayable
											
						 nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						 nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						 nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						 
						 end_of_report=1;

						}
									 
					}

				 }

			  }//summary end
								
	
            else
             {
			  if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='N') 
			   {
				 if(strcmp(d_serv_class_code.arr,nd_serv_class_code.arr)!=0)
				 {
					 
					get_blng_classification_desc();
					get_blng_serv_desc();
					//fprintf(fp,"%-43.43s\n",nd_blng_class_desc.arr);
					//lsr_line_cnt();
					//fprintf(fp," %-12.12s %-18.18s %-11.11s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
				    fprintf(fp," %-12.12s %-18.18s %-11.11s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);
				 }
				 else
				 {
					get_blng_serv_desc();
					//fprintf(fp," %-12.12s %-18.18s %-11.11s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
					fprintf(fp," %-12.12s %-18.18s %-11.11s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);

				 }
				}
				
			  else
			  if(nd_option.arr[0]=='A')
			   {
				if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)!=0 || strcmp(d_prt_grp_line_code.arr,nd_prt_grp_line_code.arr)!=0)
				{

				 if(nd_summary_dtl_ind.arr[0] == 'S')  
				  {
                    nd_upd_net_charge_amt=0;
					nd_net_total=nd_net_total+p_net_amt;
					nd_gross_total=nd_gross_total+p_gross_amt;
					nd_disc_total=nd_disc_total+p_disc_amt;
					nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;

					if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
					print_formated_amt(nd_pat_gross_amt1);
					if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
					print_formated_amt(nd_pat_net_amt2);

                    if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0) 
					{
						 get_discount_count();
					 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
    					 print_formated_amt(nd_pat_disc_amt1);
					}

					if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					{
					print_formated_amt(nd_upd_net_charge_amt);
					}
				   }	
    			 get_print_group_hd_desc3();
				 get_print_group_line_desc3();
				 get_blng_serv_desc();
				
				//added by raghava on 18/03/2008
				if(nd_summary_dtl_ind.arr[0] == 'S')
				{
				fprintf(fp,"\n");
				lsr_line_cnt();
				}
				

				/*Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e don't print the detail title description)	
				fprintf(fp,"\n%-2s-%-23s \n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
				lsr_line_cnt();lsr_line_cnt();
				*/
				//fprintf(fp,"\n%-2s-%-3s\n",d_prt_grp_hdr_code.arr,d_prt_grp_line_code.arr);
				
				
				if(d_summary_dtl_ind.arr[2]=='S')
				fprintf(fp," %-12.12s %-18.18s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
				if(d_summary_dtl_ind.arr[2]=='A')
				fprintf(fp," %-12.12s %-18.18s %-17.17s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);
				
				//fprintf(fp," %-12.12s %-30.30s",d_serv_anal_grp.arr,nd_blng_desc.arr);

				}
				else
				{
				
				if(nd_summary_dtl_ind.arr[0] == 'S')  
				  {
                    nd_upd_net_charge_amt=0;
					nd_net_total=nd_net_total+p_net_amt;
					nd_gross_total=nd_gross_total+p_gross_amt;
					nd_disc_total=nd_disc_total+p_disc_amt;
					nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;

					if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
					print_formated_amt(nd_pat_gross_amt1);
					if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
					print_formated_amt(nd_pat_net_amt2);

                    if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)   
					print_formated_amt(nd_pat_disc_amt1);

					if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					{
					print_formated_amt(nd_upd_net_charge_amt);
					}
				  }	
				get_blng_serv_desc();

								
				if(d_summary_dtl_ind.arr[2]=='S')
				fprintf(fp," %-12.12s %-18.18s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
				if(d_summary_dtl_ind.arr[2]=='A')
				fprintf(fp," %-12.12s %-18.18s %-17.17s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);

				}
			    }
				get_gross_net_amt1();
			
				nd_net_total=nd_net_total+p_net_amt;
				nd_gross_total=nd_gross_total+p_gross_amt;
				nd_disc_total=nd_disc_total+p_disc_amt;
	      
			    if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
				print_formated_amt(p_gross_amt);
				if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
				print_formated_amt(p_net_amt);
				if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)  
				{
				 get_discount_count();
					if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
					 print_formated_amt(p_disc_amt);
				}

                if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
				{
				  print_formated_amt(d_upd_net_charge_amt);
				}
				nd_net_payable=nd_net_payable+d_upd_net_charge_amt;
				fprintf(fp,"\n");
				lsr_line_cnt();
				ccnt=0;
				nd_pat_gross_amt1=0;
				nd_pat_net_amt2=0;
				nd_pat_disc_amt1=0;
				nd_upd_net_charge_amt=0;
                end_of_report=0;

             }

      }
	 else
		{
	   		 oth_cnt=oth_cnt+1;
			 if (strcmp(d_cust_code1.arr,nd_cust_code1.arr)==0)
			 {
			   
			   nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
			   nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;

			 }
			 else
			 {

				if (oth_cnt==1)
				{					
				  nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
				  nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;
			
				}
				else
				{
				  //nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;
		    
					strcpy(ar_cust_amt[k],nd_cust_nm.arr);
                    put_val(ar_amt[k],nd_oth_payer_amt); 
					format_amt(ar_amt[k]);
		
					nd_oth_payer_amt=0;
					nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
					nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;
					k=k+1;

				}
				
			 }
			 
			ccnt=0;
			nd_cust_code1.arr[0] ='\0';
			nd_cust_code1.len = 0;
			strcpy(nd_cust_code1.arr,d_cust_code1.arr);

         fetch_customer1();

		 strcpy(nd_cust_nm.arr,d_customer2.arr);

          //nd_cust_code1.arr[nd_cust_code1.len]='\0';


	   }
	  //strcpy(nd_cust_code1.arr,d_cust_code1.arr);
		strcpy(nd_prt_grp_hdr_code.arr,d_prt_grp_hdr_code.arr);
	    strcpy(nd_prt_grp_line_code.arr,d_prt_grp_line_code.arr);
		strcpy(nd_payer_serv_grp_hdr.arr,d_payer_serv_grp_hdr.arr);
		strcpy(nd_payer_serv_grp_line.arr,d_payer_serv_grp_line.arr);
		strcpy(nd_blng_serv_code.arr,d_blng_serv_code.arr); //ADDED AT 29/10/2007
		strcpy(nd_serv_anal_grp.arr,d_serv_anal_grp.arr); //ADDED AT 29/10/2007
		strcpy(nd_summary_dtl_ind.arr,d_summary_dtl_ind.arr);
		strcpy(nd_serv_class_code.arr,d_serv_class_code.arr);
	
 }

}

/* THIS FUNCTION WILL PRINT THE PATIENT BILL WITH SUBSIDIZED AMT */

print_patient_hdr()
 { 
   	
    if (strcmp(d1_cust_code1.arr,"\0")==0)
	  {
             
		 if (d1_summary_dtl_ind.arr[0] == 'S')  
		  {
				if ( ccnt==1)
				 {

						get_print_group_hd_desc();
						get_print_group_line_desc();
						//get_blng_serv_desc1();

						//fprintf(fp,"\n%-s%10s-",nd_prt_hd_desc.arr," ");
						//lsr_line_cnt();
						//fprintf(fp," %-20s\n",nd_prt_line_desc.arr);

						fprintf(fp,"\n%-23.23s -  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						lsr_line_cnt();

						//fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						
						get_gross_net_amt();

					 						
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          //total service discount
							
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;         //total service Amtpayble 
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt; //total Amtpayble 
						
						end_of_report=1;	
					
				  }
				 else
				  {
						
					  if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0
					  && strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0 && strcmp(d1_payer_serv_grp_line.arr,nd1_payer_serv_grp_line.arr)==0)
					   {
						
						 
						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;
																	
					     get_gross_net_amt();
															 
						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          //total service discount
												
						 end_of_report=1; 
					   }
					  else
					   {

						 p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
					     p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
					     p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
						 
						 if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						 print_formated_amt(nd_pat_gross_amt);
												 
						 if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt1);

						 nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
						 if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)  
						 { 
						   get_discount_count();
						  if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
						  print_formated_amt(nd_pat_gross_amt);
						 }
						
						 if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						 {
						  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
						 }

						 nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

					     if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
						 print_formated_amt(nd_subdiv_amt);
						 fprintf(fp,"\n");

						 nd_pat_gross_amt=0;
						 nd_pat_net_amt1=0;
						 nd_pat_net_charge_amt=0;
						 nd_subdiv_amt=0;
					 	 						 
						 get_print_group_hd_desc();
						 get_print_group_line_desc();
						 fprintf(fp,"\n%-23.23s -  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						 lsr_line_cnt();

						 
						 //get_blng_serv_desc1();
						 //fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);

						 get_gross_net_amt();

						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;

						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          //total service discount	

						 end_of_report=1;

					}

										   					    
				}

			}

	      else
           {
			
				if (strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)!=0 || strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)!=0)
				{
					
						if (nd2_summary_dtl_ind.arr[0] == 'S')  
						{
							
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
							p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
										    					
							if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							print_formated_amt(nd_pat_gross_amt);
													 
							if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							print_formated_amt(nd_pat_net_amt1);
							
							//if(nd_pat_net_amt1>=0)
							//nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
							//else
							nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
													

							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
							print_formated_amt(nd_pat_gross_amt);
							
							if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
							{
								print_formated_amt(nd_pat_net_charge_amt);
							}

							nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

						   if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
							print_formated_amt(nd_subdiv_amt);
							  
						}
						nd_ref_prt_grp_hdr_code.arr[nd_ref_prt_grp_hdr_code.len] ='\0';
					   
						get_print_group_hd_desc();

						get_print_group_line_desc();

						get_blng_serv_desc1();
						
                       fprintf(fp,"\n%-s%6s-",nd_prt_hd_desc.arr," ");
					   //fprintf(fp," %-20s\n",nd_prt_line_desc.arr);
					   fprintf(fp," %-23s\n",nd_prt_line_desc.arr);
					   lsr_line_cnt();lsr_line_cnt();

						//fprintf(fp,"\n%-45s-%-45s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);

						//fprintf(fp,"\n%-2s-%-3s\n",d1_prt_grp_hdr_code.arr,d1_prt_grp_line_code.arr);
						//fprintf(fp," %10s %-20s %-1s%8s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr," ");
						//fprintf(fp," %-10.10s %-20s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						//fprintf(fp," %-12.12s %-18s %-9.9s",d1_serv_anal_grp.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						fprintf(fp," %-12.12s %-28.28s",d1_serv_anal_grp.arr,nd_blng_desc1.arr);

				}
				else
				{
						if (nd2_summary_dtl_ind.arr[0] == 'S')  
						{
							
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
							p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
										    					
							if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							print_formated_amt(nd_pat_gross_amt);
													 
							if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							print_formated_amt(nd_pat_net_amt1);
							
							//if(nd_pat_net_amt1>=0)
							//nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
							//else
							nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
													

							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
							print_formated_amt(nd_pat_gross_amt);
							
							if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
							{
								print_formated_amt(nd_pat_net_charge_amt);
							}

							nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

						   if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
							print_formated_amt(nd_subdiv_amt);
							  
						}

						get_blng_serv_desc1();
						//fprintf(fp," %10s %-20s %-1s%8s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr," ");
						//fprintf(fp," %-10.10s %-20s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						//fprintf(fp," %-12.12s %-18s %-9.9s",d1_serv_anal_grp.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						fprintf(fp," %-12.12s %-28.28s",d1_serv_anal_grp.arr,nd_blng_desc1.arr);

				}
			

				get_gross_net_amt();
				
				p_tot_pat_gross_amt=p_tot_pat_gross_amt+p_pat_gross_amt;
				p_tot_pat_net_amt=p_tot_pat_net_amt+p_pat_net_amt;
				p_tot_pat_disc_amt=p_tot_pat_disc_amt+p_pat_disc_amt;
	      
				if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
				 {
					print_formated_amt(p_pat_gross_amt);
					
				}
				if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
				{
					print_formated_amt(p_pat_net_amt);
					
				 }
				 
				 //if(d1_upd_net_charge_amt>=0)
				 //nd_subdiv_amt=p_pat_net_amt-d1_upd_net_charge_amt;

				 nd_subdiv_amt=p_pat_net_amt-d1_upd_net_charge_amt;
				

				if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
				{
				 get_discount_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
					print_formated_amt(p_pat_disc_amt);
				}

				if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
				{
				print_formated_amt(d1_upd_net_charge_amt);
				}

              /*
				if(d1_upd_net_charge_amt>=0)
				{
				nd_subdiv_amt=p_pat_gross_amt-d1_upd_net_charge_amt;
				}
				else
				{
				nd_subdiv_amt=p_pat_gross_amt+d1_upd_net_charge_amt;
				}

			*/
				nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt;

				if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
				print_formated_amt(nd_subdiv_amt);

				nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;				
				fprintf(fp,"\n");
				lsr_line_cnt();
				nd_pat_gross_amt=0;
				nd_pat_net_amt1=0;
				nd_subdiv_amt=0;
				nd_pat_net_charge_amt=0;
				end_of_report=0;
				ccnt=0;

             }
     strcpy(nd1_prt_grp_hdr_code.arr,d1_prt_grp_hdr_code.arr);
     strcpy(nd1_prt_grp_line_code.arr,d1_prt_grp_line_code.arr);
     strcpy(nd1_payer_serv_grp_hdr.arr,d1_payer_serv_grp_hdr.arr);
     strcpy(nd1_payer_serv_grp_line.arr,d1_payer_serv_grp_line.arr);
	 strcpy(nd2_blng_serv_code.arr,d1_blng_serv_code.arr); //ADDED AT 29/10/2007
	 strcpy(nd2_serv_anal_grp.arr,d1_serv_anal_grp.arr); //ADDED AT 29/10/2007
	 strcpy(nd2_summary_dtl_ind.arr,d1_summary_dtl_ind.arr);

	
  }

 else
 {
			 ccnt=0;
			 othp_cnt=othp_cnt+1;
			 if (strcmp(d1_cust_code1.arr,nd_cust_code1.arr)==0)
			 {
			   nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
			   //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;
			   nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
			 }
			 else
			 {

				if (othp_cnt==1)
				{					
				  nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
				  nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
				  //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;
				}
				else
				{
				  //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;

              		strcpy(ar_cust_amt[p],nd_cust_nm.arr);
                    put_val(ar_amt[p],nd_othp_payer_amt); 
					format_amt(ar_amt[p]);
					nd_othp_payer_amt=0;
					nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
					nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
					p=p+1;
				
				}
				
			 }
			 
			  nd_cust_code1.arr[0] ='\0';
			  nd_cust_code1.len = 0;
		      strcpy(nd_cust_code1.arr,d1_cust_code1.arr);
		      fetch_customer2();
		      strcpy(nd_cust_nm.arr,d_customer3.arr);
             //nd_cust_code1.arr[nd_cust_code1.len] ='\0';


  }


} //END OF print_patient_hdr




/* THIS FUNCTION WILL PRINT PURE CASH PATIENT BILL */

print_cash_patient_hdr()
 { 


   l_receipt_type=1;
    
	if (strcmp(d1_cust_code1.arr,"\0")!=0)
	{
	  
	  ccnt=0;
    } 


	if (strcmp(d1_cust_code1.arr,"\0")==0)
	{
						
			if(d1_summary_dtl_ind.arr[0] == 'S')  
			 {
				   
				  if(ccnt==1)
				  {
                        
						get_print_group_hd_desc();
						get_print_group_line_desc();
						get_blng_classification_desc1();

						//get_blng_serv_desc1();

						if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='C') 
						{
						    if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
							{
							  fprintf(fp,"%-3.3s - %-35.35s\n",d1_serv_class_code.arr,nd_blng_class_desc1.arr);
							  lsr_line_cnt();
							  fprintf(fp,"%-3.3s - %-35.35s"," "," ");
							}
							else
							fprintf(fp,"%-3.3s - %-35.35s",d1_serv_class_code.arr,nd_blng_class_desc1.arr);
						}
						else
						if(nd_option.arr[0]=='A') 
						{
						  if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						  {
							if (nd1_summary_dtl_ind.arr[0]== 'D')
							{

								if(d1_summary_dtl_ind.arr[1] == 'L') 
							    {
								 if (l_lsr!= 0 && l_dmp== 0)
								 { 
								  print_bold_underline();
								  fprintf(fp,"\n%-s / %-2s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 	//added by vani
								  Release_bold_underline();
								 }

								 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
								 {
								   //fprintf(fp,"%-10.10s  %-28.28s \n"," ",nd_prt_line_desc.arr);  //UAT(23/09/2010)
								   //fprintf(fp,"\n%-13.13s  %-33.33s "," ",nd_prt_line_desc.arr);
								   fprintf(fp,"\n%-8.8s  %-31.31s "," ",nd_prt_line_desc.arr);
								   //fprintf(fp,"%-11.11s   %-26.26s \n"," ",nd_prt_line_desc.arr); UAT(23/09/2010)
								   lsr_line_cnt();
								   fprintf(fp,"%-11.11s   %-26.26s "," "," ");
								 }
								 else
								 //fprintf(fp,"%-13.13s   %-33.33s "," ",nd_prt_line_desc.arr); //UAT(23/09/2010) CHANGING LINE
								 fprintf(fp,"\n%-8.8s  %-31.31s "," ",nd_prt_line_desc.arr);
								 //fprintf(fp,"%-11.11s   %-26.26s "," ",nd_prt_line_desc.arr); UAT(23/09/2010)
								//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the print line description)	
								//fprintf(fp,"\n%-19.19s - %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 	
								}
								else
								{
								  if(l_lsr!= 0 && l_dmp== 0)
								  {
								    print_bold_underline();
								    fprintf(fp,"%-s\n",nd_prt_hd_desc.arr); //added by vani
							        Release_bold_underline();
								  }
							
								 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
								 {
								   fprintf(fp,"%-10.10s  %-28.28s \n"," ",nd_prt_hd_desc.arr);//UAT(23/09/2010)
								   //fprintf(fp,"%-11.11s   %-26.26s \n"," ",nd_prt_hd_desc.arr);UAT(23/09/2010)
								   lsr_line_cnt();
								   fprintf(fp,"%-11.11s   %-26.26s "," "," ");
								 }
								 else
								 fprintf(fp,"%-10.10s  %-28.28s "," ",nd_prt_hd_desc.arr);    //UAT(23/09/2010)
								 //fprintf(fp,"%-11.11s   %-26.26s "," ",nd_prt_hd_desc.arr); UAT(23/09/2010)
								
								}
							}
							else
							{
								if(d1_summary_dtl_ind.arr[1] == 'L') 
								{
								  if(l_lsr!= 0 && l_dmp== 0)
								  {
								   print_bold_underline();
								   fprintf(fp,"\n%-s / %-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 	//added by vani
								   Release_bold_underline();
								  }
						         if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
								 {
								   //fprintf(fp,"\n%-10.10s  %-33.33s \n"," ",nd_prt_line_desc.arr); //UAT(23/09/2010)
								   //fprintf(fp,"\n%-13.13s  %-33.33s "," ",nd_prt_line_desc.arr);
								   fprintf(fp,"\n%-8.8s  %-31.31s "," ",nd_prt_line_desc.arr);
								   //fprintf(fp,"\n%-11.11s   %-26.26s \n"," ",nd_prt_line_desc.arr); UAT(23/09/2010)
								   lsr_line_cnt();
								   fprintf(fp,"\n%-11.11s   %-26.26s "," "," ");
								 }
								 else
								 //fprintf(fp,"\n%-13.13s  %-33.33s "," ",nd_prt_line_desc.arr);  //UAT(23/09/2010)
								 fprintf(fp,"\n%-8.8s  %-31.31s "," ",nd_prt_line_desc.arr);  //UAT(23/09/2010)
								 //fprintf(fp,"\n%-11.11s   %-26.26s "," ",nd_prt_line_desc.arr); UAT(23/09/2010)
								//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the print line description)	
								//fprintf(fp,"\n%-19.19s - %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 	
								}
								else
								{
								  if(l_lsr!= 0 && l_dmp== 0)
								  {
								   print_bold_underline();
								   fprintf(fp,"%-s\n",nd_prt_hd_desc.arr); //added by vani
							       Release_bold_underline();
								  }
								  if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
								  {
								   fprintf(fp,"\n%-10.10s  %-28.28s \n"," ",nd_prt_hd_desc.arr); //UAT(23/09/2010)
								   //fprintf(fp,"\n%-11.11s   %-26.26s \n"," ",nd_prt_hd_desc.arr); UAT(23/09/2010)
								   lsr_line_cnt();
								   fprintf(fp,"\n%-11.11s   %-26.26s "," "," ");
								  }
								  else
								  fprintf(fp,"\n%-10.10s  %-28.28s "," ",nd_prt_hd_desc.arr); //UAT(23/09/2010)
								  //fprintf(fp,"\n%-11.11s   %-26.26s "," ",nd_prt_hd_desc.arr); UAT(23/09/2010)
								}
								lsr_line_cnt();
							}
								
						  }	
						}
						//fprintf(fp," %-10.10s %-19.19s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);

						get_gross_net_amt();
					
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
					
					   //fprintf(fp,"\n%-2s-%-3s",nd1_prt_grp_hdr_code.arr,nd1_prt_grp_line_code.arr);
					   //fprintf(fp,"%-2s %-3s\n"," "," ");

						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;				//total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;			//total service Reimbursable Amt

					
						/**added by vani for crf 458.1**/
					
						if(strcmp(d_payer_adjust_yn.arr,"A")==0)
							{
							//	nd_net_non_reimbursable_amt=0;
							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;
							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                

						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;    //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt; //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt

						end_of_report=1;
					}
				  else
				  if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='C')
				  {
					 if(strcmp(d1_serv_class_code.arr,nd1_serv_class_code.arr)==0)
					 {

					   get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
										
					
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;			   //total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;		   //total service Reimbursable Amt
						
					
						/**added by vani for crf 458.1**/
						
						if(strcmp(d_payer_adjust_yn.arr,"A")==0)
							{
								//nd_net_non_reimbursable_amt=0;

							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;
							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 

						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;//total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt
					

						end_of_report=1;
					 }
					 else
					 {
						
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
						p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;

					    if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						{
						get_addlcharge_count();
						if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
						print_formated_amt1(nd_pat_addl_charge_amt);
						}
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						print_formated_amt(nd_pat_gross_amt);				// Gross Amt
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(nd_pat_net_amt1);				// Net Amt
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
						{
						get_discount_count();
						if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
						print_formated_amt(nd_pat_disc_amt);				// Discount
						}

						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
						{
						nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt1);                //Net Amount will print if u select discount as a column
						}
						else
						{
						nd_pat_net_amt1= nd_pat_net_amt1;
						}
					    if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt);
						else
						if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						 {
						  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
						 }

						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_net_reimbursable_amt);   //Reimbursable Amt

						//nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
						//nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
		
					
						fprintf(fp," ");
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_non_reimbursable_amt);

						//print_formated_amt(nd_net_non_reimbursable_amt);   //Non Reimbursable Amt

						nd_pat_gross_amt=0;
						nd_pat_net_amt1=0;
						nd_pat_disc_amt=0;
						nd_pat_addl_charge_amt=0;
						nd_tot_net_reimbursable_amt=0;
						nd_tot_non_reimbursable_amt=0;
						nd_tot_serv_qty=0;   //added by raghava at BKK for walk-through issue
						//nd_net_non_reimbursable_amt=0;
						nd_pat_net_charge_amt=0;

						lsr_line_cnt(); //added 12/12/07

						get_blng_classification_desc1();
					    if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //CRF-521
						{
						  fprintf(fp,"\n%-3.3s - %-35.35s\n",d1_serv_class_code.arr,nd_blng_class_desc1.arr);
						  lsr_line_cnt(); 
						  fprintf(fp,"\n%-3.3s - %-35.35s"," "," ");
						}
						else
						fprintf(fp,"\n%-3.3s - %-35.35s",d1_serv_class_code.arr,nd_blng_class_desc1.arr);
																	
						get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
												
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;							//total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;						//total service Reimbursable Amt

					
						/**added by vani for crf 458.1**/
					
						   if(strcmp(d_payer_adjust_yn.arr,"A")==0)
						   {
						
							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;

							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt

						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;                //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;				 //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt
									
						end_of_report=1;
						
											
        		     }
	
				  }
				  else
				  if(nd_option.arr[0]=='A')
				   {
				
				   if(d1_summary_dtl_ind.arr[1] == 'L') 
				    {
					if( (strcmp(d3_bill_doc_type_code.arr,"\0")==0 && l_con_rcpt_yn.arr[0]=='Y' &&
						  strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0)|| 
					     (strcmp(d3_bill_doc_type_code.arr,"\0")==0 && l_con_rcpt_yn.arr[0]=='N' &&
						  strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0
						  && strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0 && strcmp(d1_payer_serv_grp_line.arr,nd1_payer_serv_grp_line.arr)==0)|| 
					     (strcmp(d3_bill_doc_type_code.arr,"\0")!=0 &&
						  strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0) 
						  //&& strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0 && strcmp(d1_payer_serv_grp_line.arr,nd1_payer_serv_grp_line.arr)==0) Commented by raghava at BKK for Waltk-through issue
					      
					   
					   )
					 
					 {
											
					    get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
										
					
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;			   //total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;		   //total service Reimbursable Amt
			
					
						/**added by vani for crf 458.1**/
			
						  if(strcmp(d_payer_adjust_yn.arr,"A")==0)
						  {
						
							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;

							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

											
						/**upto here**/
						
						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 


						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;//total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt

						end_of_report=1;
					 }
						

					 else
					 {
					
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
						p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;

					    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						{
						get_addlcharge_count();
						if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
						print_formated_amt1(nd_pat_addl_charge_amt);
						}
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						print_formated_amt(nd_pat_gross_amt);				// Gross Amt
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(nd_pat_net_amt1);				// Net Amt
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
						{
						get_discount_count();
						if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
						print_formated_amt(nd_pat_disc_amt);				// Discount
						}

						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
						{
						nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt1);                //Net Amount will print if u select discount as a column
						}
						else
						{
						nd_pat_net_amt1= nd_pat_net_amt1;
						}

						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						 print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt); // Amt Payble
						else
						if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						 {
						  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
						 }

						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_net_reimbursable_amt);   //Reimbursable Amt

						//nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
						//nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
		
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						fprintf(fp," ");
						
					
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						 print_formated_amt(nd_tot_non_reimbursable_amt);
						
						//print_formated_amt(nd_net_non_reimbursable_amt);   //Non Reimbursable Amt

						nd_pat_gross_amt=0;
						nd_pat_net_amt1=0;
						nd_pat_disc_amt=0;
						nd_pat_addl_charge_amt=0;
						nd_tot_net_reimbursable_amt=0;
						nd_tot_non_reimbursable_amt=0;
				        nd_tot_serv_qty=0; //added by raghava at BKK for walth-through issue
						//nd_net_non_reimbursable_amt=0;
						nd_pat_net_charge_amt=0;

						lsr_line_cnt(); //added 12/12/07

						get_print_group_hd_desc();
						get_print_group_line_desc();
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
						 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
						 {
						   //fprintf(fp,"\n%-13.13s  %-15.15s \n"," ",nd_prt_line_desc.arr);//UAT(23/09/2010)
						   fprintf(fp,"\n%-8.8s  %-31.31s \n"," ",nd_prt_line_desc.arr);//UAT(23/09/2010)
						   //fprintf(fp,"\n%-11.11s   %-26.26s \n"," ",nd_prt_line_desc.arr);//UAT(23/09/2010)
						   lsr_line_cnt();
						   fprintf(fp,"\n%-11.11s   %-26.26s "," "," ");
						 }
						 else
						 fprintf(fp,"\n%-8.8s  %-31.31s "," ",nd_prt_line_desc.arr); //UAT(23/09/2010) change the length
						 //fprintf(fp,"\n%-11.11s   %-26.26s "," ",nd_prt_line_desc.arr); UAT(23/09/2010)						

						}
						//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the print line description)	
						//fprintf(fp,"\n%-19.19s - %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
						
																	
						get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
												
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;							//total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;						//total service Reimbursable Amt

					
						/**added by vani for crf 458.1**/
			
						  if(strcmp(d_payer_adjust_yn.arr,"A")==0)
							{
								//nd_net_non_reimbursable_amt=0;
							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;

							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt


						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;                //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;				 //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt
									
						end_of_report=1;
						
											
        		     }
				  }

				  else
				  {
										
					 if( (strcmp(d3_bill_doc_type_code.arr,"\0")==0 && l_con_rcpt_yn.arr[0]=='Y' && 
					      strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0)|| 
	                     (strcmp(d3_bill_doc_type_code.arr,"\0")==0 && l_con_rcpt_yn.arr[0]=='N' && 
					      strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && 
					      strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0)|| 
						 (strcmp(d3_bill_doc_type_code.arr,"\0")!=0 && 
					      strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0) 
						  //&& strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0) Commented by raghava at BKK for Walk-through
							
								   				   
					   )
					 {
											
					    get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
										
					
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;			   //total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;		   //total service Reimbursable Amt
	
					
						/**added by vani for crf 458.1**/
				
						 if(strcmp(d_payer_adjust_yn.arr,"A")==0)
						 {
							
							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;

							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt; 

						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;//total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt

						end_of_report=1;
					 }
						

					 else
					 {
						
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
						p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;

					    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						{
						get_addlcharge_count();
						if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
						print_formated_amt1(nd_pat_addl_charge_amt);
						}
					
					    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						print_formated_amt(nd_pat_gross_amt);				// Gross Amt
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(nd_pat_net_amt1);				// Net Amt
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
						{
						get_discount_count();
						if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
						print_formated_amt(nd_pat_disc_amt);				// Discount
						}

						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
						{
						nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt1);                //Net Amount will print if u select discount as a column
						}
						else
						{
						nd_pat_net_amt1= nd_pat_net_amt1;
						}

					   if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					   if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt);
						else
						if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						 {
						  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
						 }

						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_net_reimbursable_amt);   //Reimbursable Amt

						//nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
						//nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
		
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						fprintf(fp," ");
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_non_reimbursable_amt);

						//print_formated_amt(nd_net_non_reimbursable_amt);   //Non Reimbursable Amt

						nd_pat_gross_amt=0;
						nd_pat_net_amt1=0;
						nd_pat_disc_amt=0;
						nd_pat_addl_charge_amt=0;
						nd_tot_net_reimbursable_amt=0;
						nd_tot_non_reimbursable_amt=0;
						nd_tot_serv_qty=0; //added by raghav at BKK for walk-through issue
						//nd_net_non_reimbursable_amt=0;
						nd_pat_net_charge_amt=0;

						lsr_line_cnt(); //added 12/12/07

						get_print_group_hd_desc();
						get_print_group_line_desc();
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
						   if(l_lsr!= 0 && l_dmp== 0)
						   {	
							print_bold_underline();
							fprintf(fp,"\n%s",nd_prt_hd_desc.arr); //added by vani
							Release_bold_underline();
						   }
						}
						
						if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
						 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
						 {
						   fprintf(fp,"\n%-10.10s  %-28.28s \n"," ",nd_prt_hd_desc.arr);  //UAT(23/09/2010)
						   //fprintf(fp,"\n%-11.11s   %-26.26s \n"," ",nd_prt_hd_desc.arr);UAT(23/09/2010)
						   lsr_line_cnt();
						   fprintf(fp,"\n%-11.11s   %-26.26s "," "," ");
						 }
						 else
						 fprintf(fp,"\n%-10.10s  %-28.28s "," ",nd_prt_hd_desc.arr);    //UAT(23/09/2010)
						 //fprintf(fp,"\n%-11.11s   %-26.26s "," ",nd_prt_hd_desc.arr); UAT(23/09/2010)
						}
																	
						get_gross_net_amt();

						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;
												
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;							//total Net Amt
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;				//Total Addl Charge Amt For same category records
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;						//total service Reimbursable Amt

					
						/**added by vani for crf 458.1**/
		
						if(strcmp(d_payer_adjust_yn.arr,"A")==0)
							{

							EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
							INTO :nd_net_non_reimbursable_amt
							FROM BL_PATIENT_CHARGES_SLMT_DTL
							WHERE OPERATING_FACILITY_ID =:nd_facility_id
							AND	TRX_DOC_REF=:d1_trx_doc_ref
							AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
							AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
							AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
							AND BILL_DOC_NUM=:d1_bill_doc_num
							AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
							AND SLMT_DOC_NUM=:d_doc_number1;
							
				
							}
							else
							{
								if(strcmp(d_payer_adjust_yn.arr,"O")==0)
								{
									nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
								}
								else
								nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt
								//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
							}

						/**upto here**/

						//nd_net_non_reimbursable_amt=d1_upd_net_charge_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt

						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;                //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;				 //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Additional Charge amt
								
						end_of_report=1;
						
											
        		     }
				  }
				 
				} //end of if(nd_option)

				 d_net_reimbursable_amt=0;     
				 d1_upd_gross_charge_amt=0;
				 d1_upd_disc_amt=0;
				 d1_upd_net_charge_amt=0; //ADDED AT 05/11/2007 
			}//summary end

        else
           {
			 /*
			 if(nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='N') 
			  {
				 if(strcmp(d1_serv_class_code.arr,nd1_serv_class_code.arr)!=0)
				 {
				   nd_tot_non_reimbursable_amt=0;
				   nd_ref_prt_grp_hdr_code.arr[nd_ref_prt_grp_hdr_code.len] ='\0';
					   
						get_blng_serv_desc1();

						get_blng_classification_desc1();
						
						//fprintf(fp,"%-35.35s\n",nd_blng_class_desc1.arr);
						//lsr_line_cnt();
						//fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
						{
						  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
						  fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
						  else
						  fprintf(fp," %-10.10s %-28.28s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr);  //UAT(23/09/2010)
						  //fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr," ");  UAT(23/09/2010)
						  lsr_line_cnt();
						  fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
						}
						else
						{
						 if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
						 fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
						 else
						 fprintf(fp," %-10.10s %-28.28s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr);//UAT(23/09/2010)
						 //fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
						}
   				 
				  }
			     else
				 {
					get_blng_serv_desc1();
					//fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
				    if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)  //Added by raghava for CRF-521
					{
					  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
					  fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
					  else
					  fprintf(fp," %-10.10s %-28.28s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
					  //fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
					  lsr_line_cnt();
					  fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
					}
					else
					{
					 if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
					 fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
					 else
					 fprintf(fp," %-10.10s %-28.28s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
					 //fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr," ");  UAT(23/09/2010)
					}

				 }
			  }
			else
			 commented by raghava on 04/10/2010 for SCF-5413*/
			if(nd_option.arr[0]=='A' || (nd_detail_type_yn.arr[0]=='Y' && nd_option.arr[0]=='N'))
			 {	
                //if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)!=0 || strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)!=0) Commented b y raghava at BKK for walk-through issue - old
				if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)!=0 || strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)!=0) // if -1
		   		{		
									  
					   nd_tot_non_reimbursable_amt=0;
					 				 		   
					   if (nd1_summary_dtl_ind.arr[0] == 'S') 
					   { 
					
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
							nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							{
							get_addlcharge_count();
							if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
							print_formated_amt1(nd_pat_addl_charge_amt);
							}
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							print_formated_amt(nd_pat_gross_amt);				// Gross Amt
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							print_formated_amt(nd_pat_net_amt1);				// Net Amt
						
						    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
							{
							get_discount_count();
							if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
							print_formated_amt(nd_pat_disc_amt);				// Discount
							}

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
							{
							nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
							print_formated_amt(nd_pat_net_amt1);                //Net Amount will print if u select discount as a column
							}
							else
							{
							nd_pat_net_amt1= nd_pat_net_amt1;
							}

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							 print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt);
							else
							if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
							 {
							  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
							 }

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_net_reimbursable_amt);   //Reimbursable Amt
							
						
							/**added by vani for crf 458.1**/
						

							if(strcmp(d_payer_adjust_yn.arr,"A")==0)
								{
									//nd_net_non_reimbursable_amt=0;
									EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
									INTO :nd_net_non_reimbursable_amt
									FROM BL_PATIENT_CHARGES_SLMT_DTL
									WHERE OPERATING_FACILITY_ID =:nd_facility_id
									AND	TRX_DOC_REF=:d1_trx_doc_ref
									AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
									AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
									AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
									AND BILL_DOC_NUM=:d1_bill_doc_num
									AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
									AND SLMT_DOC_NUM=:d_doc_number1;

								}
								else
								{
									if(strcmp(d_payer_adjust_yn.arr,"O")==0)
									{
										nd_net_non_reimbursable_amt=d_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
									}
									else
								    nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
								  
								}

							/**upto here**/

							//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;

							nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							fprintf(fp," ");
						
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_non_reimbursable_amt);
							//print_formated_amt(nd_net_non_reimbursable_amt);   //Non Reimbursable Amt
							
							lsr_line_cnt();//added at 12/12/07
						   
										
						  }
						  
							nd_ref_prt_grp_hdr_code.arr[nd_ref_prt_grp_hdr_code.len] ='\0';
												   
							get_print_group_hd_desc();
							get_print_group_line_desc();
							//get_blng_serv_desc1();  Commented by raghava at BKK for walk-throuth issue
							
							//added by raghava on 18/03/2008
							if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(nd1_summary_dtl_ind.arr[0] == 'S')
							{
							 fprintf(fp,"\n");
							 lsr_line_cnt();
							}

							
							if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							{
								if(l_lsr!= 0 && l_dmp== 0)
								{
								 print_bold_underline();
								 fprintf(fp,"%-s / %-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
								 Release_bold_underline();
								}
						
								//lsr_line_cnt();lsr_line_cnt(); Upto here 
							}
						
							/* Commented by raghava at BKK for walk-through issue 
					  		
							if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(d1_summary_dtl_ind.arr[2]=='S')
							{
							 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
							 {
							   if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
							   fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
							   else
							   fprintf(fp," %-10.10s %-28.28s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //UAT(23/09/2010)
							   //fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr," "); UAT(23/09/2010)
							   lsr_line_cnt();
							   fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
							 }
							 else
							 {
							  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
							  fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
							  else
							  fprintf(fp," %-10.10s %-28.28s ",d1_blng_serv_code.arr,nd_blng_desc1.arr," "); //UAT(23/09/2010)
							  //fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr," "); UAT(23/09/2010)
							 }
							}
							if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(d1_summary_dtl_ind.arr[2]=='A')
							{
					 		 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)  //Added by raghava for CRF-521
							 {
							  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
							  fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
							  else
							  fprintf(fp," %-10.10s %-28.28s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
							  //fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr," ");  UAT(23/09/2010)
							  lsr_line_cnt();
							  fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
							 }
							 else
							 {
							  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
							  fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
							  else
							  fprintf(fp," %-10.10s %-28.28s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
							  //fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
							 }
							}
							//fprintf(fp," %-12.12s %-27.27s",d1_serv_anal_grp.arr,nd_blng_desc1.arr);
						    upto here */
											        
				}
				else
				{
					  if (nd1_summary_dtl_ind.arr[0] == 'S') 
					   { 
						 	
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;
							nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							{
							get_addlcharge_count();
							if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
							print_formated_amt1(nd_pat_addl_charge_amt);
							}
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							print_formated_amt(nd_pat_gross_amt);				// Gross Amt
						
						    if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							print_formated_amt(nd_pat_net_amt1);				// Net Amt
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
							{
							get_discount_count();
							if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
							print_formated_amt(nd_pat_disc_amt);				// Discount
							}

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
							{
							nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
							print_formated_amt(nd_pat_net_amt1);                //Net Amount will print if u select discount as a column
							}
							else
							{
							nd_pat_net_amt1= nd_pat_net_amt1;
							}

							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							 print_formated_amt(nd_pat_net_charge_amt-nd_pat_addl_charge_amt);
							else
							if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
							 {
							  print_formated_amt(nd_pat_net_charge_amt); // Amt Payble
							 }

							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_net_reimbursable_amt);   //Reimbursable Amt

													
							/**added by vani for crf 458.1**/
								  if(strcmp(d_payer_adjust_yn.arr,"A")==0)
								  {
												//nd_net_non_reimbursable_amt=0;
									EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
									INTO :nd_net_non_reimbursable_amt
									FROM BL_PATIENT_CHARGES_SLMT_DTL
									WHERE OPERATING_FACILITY_ID =:nd_facility_id
									AND	TRX_DOC_REF=:d1_trx_doc_ref
									AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
									AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
									AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
									AND BILL_DOC_NUM=:d1_bill_doc_num
									AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
									AND SLMT_DOC_NUM=:d_doc_number1;

									}
									else
									{
										if(strcmp(d_payer_adjust_yn.arr,"O")==0)
										{
											nd_net_non_reimbursable_amt=d_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
										}
										else
										nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;                
									}

							/**upto here**/

							//nd_net_non_reimbursable_amt=nd_pat_net_charge_amt-nd_tot_net_reimbursable_amt;

							nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							fprintf(fp," ");

							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_non_reimbursable_amt);

							//print_formated_amt(nd_net_non_reimbursable_amt);   //Non Reimbursable Amt
							
							lsr_line_cnt();//added at 12/12/07
						 
						
						}
						/* Commented by raghava at BKK for walk-through issue 
					    
						get_blng_serv_desc1(); 

						if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						if(d1_summary_dtl_ind.arr[2]=='S')
						{
						 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)  //Added by raghava for CRF-521
						 {
						   fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						   lsr_line_cnt();
						   fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
						 }
						 else
						 fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						}
						if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						if(d1_summary_dtl_ind.arr[2]=='A')
						{
						 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)  //Added by raghava for CRF-521
						 {
						  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
						  fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
						  else
						  fprintf(fp," %-10.10s %-28.28s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr);
						  lsr_line_cnt();
						  fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
						 }
						 else
						 {
						  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
						  fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
						  else
						  fprintf(fp," %-10.10s %-28.28s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
						  //fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
						 }
						}						
						//fprintf(fp," %-12.12s %-27.27s",d1_serv_anal_grp.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						*/						

				    }
			  
			   }
            
			   if( (l_print_grping_serv_yn.arr[0]=='N')||((l_print_grping_serv_yn.arr[0]=='Y') && strcmp(d1_blng_serv_code.arr,nd1_blng_serv_code.arr)!=0))
			   {
			    /*** The below Code added by raghava at BKK for walk-through issue ***/
				
				nd_tot_non_reimbursable_amt=0;
				get_gross_net_amt();
				//if(l_print_grping_serv_yn.arr[0]=='Y' && nd_detail_type_yn.arr[0]=='N') commented by raghava for scf-5413
			    if(l_print_grping_serv_yn.arr[0]=='Y') //added by raghava for scf-5413
				{
				 get_service_amt();
				 sprintf(str_qty,"%7d",nd_tot_serv_qty);
                }
		
				get_blng_serv_desc1(); 

				//if( (d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0)) && nd_detail_type_yn.arr[0]=='N') commented by raghava on 04/10/2010 for scf-5413
				if( (d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0)) || nd_detail_type_yn.arr[0]=='Y') //added by raghava on 04/10/2010 for scf-5413
				if(d1_summary_dtl_ind.arr[2]=='S')
				{
				 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0) //Added by raghava for CRF-521
				 {
				   if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
				   fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
				   else
				   {
				    if(nd_tot_serv_qty==1)
					fprintf(fp," %-10.10s %-28.28s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //UAT(23/09/2010)
					//fprintf(fp," %-12.12s %-17.17s   %-7.7s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr," "); UAT(23/09/2010)
					else
					fprintf(fp," %-12.12s %-20.20s X%-7.7s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr,str_qty); //UAT(23/09/2010)
					//fprintf(fp," %-12.12s %-17.17s X %-7.7s\n",d1_blng_serv_code.arr,nd_blng_desc1.arr,str_qty); UAT(23/09/2010)
								
				   }
				   lsr_line_cnt();
				   fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
				 }
				 else
				 {
				  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
				  fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
				  else
				  {
				   if(nd_tot_serv_qty==1)
				   fprintf(fp," %-10.10s %-28.28s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s   %-7.7s",d1_blng_serv_code.arr,nd_blng_desc1.arr," "); UAT(23/09/2010)
				   else
				   fprintf(fp," %-10.10s %-20.20s X%-7.7s",d1_blng_serv_code.arr,nd_blng_desc1.arr,str_qty); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s X %-7.7s",d1_blng_serv_code.arr,nd_blng_desc1.arr,str_qty); UAT(23/09/2010
							   
				  }
				 }
				}
				//if( (d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0)) && nd_detail_type_yn.arr[0]=='N') commented by raghava on 04/10/2010 for scf-5413
				if( (d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0)) || nd_detail_type_yn.arr[0]=='Y') //added by raghava on 04/10/2010 for scf-5413
				if(d1_summary_dtl_ind.arr[2]=='A')
				{
				 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)  //Added by raghava for CRF-521
				 {
				  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
				  fprintf(fp," %-12.12s %-17.17s %-9.9s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
				  else
				  {
				   if(nd_tot_serv_qty==1)
				   fprintf(fp," %-10.10s %-28.28s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s   %-7.7s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
				   else
				   fprintf(fp," %-10.10s %-20.20s X%-7.7s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,str_qty); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s X %-7.7s\n",d1_mapping_code.arr,nd1_mapping_code_desc.arr,str_qty); UAT(23/09/2010)
				   				   
				  }
				  lsr_line_cnt();
				  fprintf(fp," %-12.12s %-17.17s %-9.9s"," "," "," ");
				 }
				 else
				 {
				  if(l_print_serv_item_yn.arr[0]=='Y')  //added by raghava at BKK for walk-through issue
				  fprintf(fp," %-12.12s %-17.17s %-9.9s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,d1_serv_item_code.arr);
				  else
				  {
				   if(nd_tot_serv_qty==1)
				   fprintf(fp," %-10.10s %-28.28s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s   %-7.7s",d1_mapping_code.arr,nd1_mapping_code_desc.arr," "); UAT(23/09/2010)
				   else
				   fprintf(fp," %-10.10s %-20.20s X%-7.7s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,str_qty); //UAT(23/09/2010)
				   //fprintf(fp," %-12.12s %-17.17s X %-7.7s",d1_mapping_code.arr,nd1_mapping_code_desc.arr,str_qty); UAT(23/09/2010)
				   
				   
				  }
				 }
				}
		
				
				/*** Upto Here ****/
			
				p_tot_pat_gross_amt=p_tot_pat_gross_amt+p_pat_gross_amt;
				p_tot_pat_net_amt=p_tot_pat_net_amt+p_pat_net_amt;
												
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
				{
				 get_addlcharge_count();
				if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
				 print_formated_amt1(d1_addl_charge_amt_in_charge);
				}

				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
				print_formated_amt(p_pat_gross_amt);
			
			    if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
				print_formated_amt(p_pat_net_amt);
				
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
				{
				 get_discount_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
				print_formated_amt(p_pat_disc_amt);
				}
			
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
				{
				nd_pat_net_amt=p_pat_gross_amt-p_pat_disc_amt;
				print_formated_amt(nd_pat_net_amt);
				}
				else
				{
				nd_pat_net_amt=	p_pat_net_amt;
				}

				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if ((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
				 {
				  print_formated_amt(d1_upd_net_charge_amt-d1_addl_charge_amt_in_charge);  // Amt Payble
				 }
              	else
				if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
				 {
				  print_formated_amt(d1_upd_net_charge_amt);      // Amt Payble
				 }
				
				
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_reim_amt_ind.arr,"Y")==0)
				print_formated_amt(d_net_reimbursable_amt);      //Servivewise  Reimbursable Amt
				
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				fprintf(fp," ");

				/***added by vani for crf-458.1***/
	            if(l_print_grping_serv_yn.arr[0]=='N')  //added by raghava at BKK for walk-through issue
				{ 
				   if(strcmp(d_payer_adjust_yn.arr,"A")==0)
					{
						//nd_tot_non_reimbursable_amt=0;
						EXEC SQL  SELECT ABS(SETTLED_AMT - :d_net_reimbursable_amt)
						INTO :nd_tot_non_reimbursable_amt
						FROM BL_PATIENT_CHARGES_SLMT_DTL
						WHERE OPERATING_FACILITY_ID =:nd_facility_id
						AND	TRX_DOC_REF=:d1_trx_doc_ref
						AND TRX_DOC_REF_LINE_NUM=:d1_trx_doc_ref_line_num
						AND TRX_DOC_REF_SEQ_NUM=:d1_trx_doc_ref_seq_num
						AND BILL_DOC_TYPE_CODE=:d1_bill_doc_type_code
						AND BILL_DOC_NUM=:d1_bill_doc_num
						AND SLMT_DOC_TYPE_CODE=:d_doc_type_code1 
						AND SLMT_DOC_NUM=:d_doc_number1;

					}
					else
					{
						if(strcmp(d_payer_adjust_yn.arr,"O")==0)
						{
							nd_tot_non_reimbursable_amt=d1_upd_net_charge_amt-(d1_adj_payer_amt+d_net_reimbursable_amt);
						}
						else
						nd_tot_non_reimbursable_amt = d1_upd_net_charge_amt-d_net_reimbursable_amt;;
					}
				}
				/***upto here***/

				//nd_tot_non_reimbursable_amt = d1_upd_net_charge_amt-d_net_reimbursable_amt;

				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
				print_formated_amt(nd_tot_non_reimbursable_amt);//Non Reimbursable Amt
							
				
				//nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+p_pat_disc_amt;
				nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+d1_upd_disc_amt;
				nd_total_pat_addl_charge_amt=nd_total_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;   //Total Additional Charge Amt
				nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;
				nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;
				nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_tot_non_reimbursable_amt; //total Non Reimbursable Amt

				//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt;//raghava
					
			    
				if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				{
				 fprintf(fp,"\n");
				 lsr_line_cnt();
				}
		        }
				ccnt=0;
				nd_pat_gross_amt=0;
				nd_pat_net_amt1=0;
				nd_pat_disc_amt=0;
				nd_pat_addl_charge_amt=0;
				nd_tot_net_reimbursable_amt=0;
				//nd_net_non_reimbursable_amt=0;
				nd_tot_non_reimbursable_amt=0;
				nd_pat_net_charge_amt=0;
				d_net_reimbursable_amt=0;     
				d1_upd_gross_charge_amt=0;
				d1_upd_disc_amt=0;
				d1_upd_net_charge_amt=0; 
				d1_addl_charge_amt_in_charge=0;
				end_of_report=0;
				//lsr_line_cnt();
              			  
             }

  strcpy(nd1_prt_grp_hdr_code.arr,d1_prt_grp_hdr_code.arr);
  strcpy(nd1_prt_grp_line_code.arr,d1_prt_grp_line_code.arr);
  strcpy(nd1_payer_serv_grp_hdr.arr,d1_payer_serv_grp_hdr.arr);
  strcpy(nd1_payer_serv_grp_line.arr,d1_payer_serv_grp_line.arr);
  strcpy(nd1_blng_serv_code.arr,d1_blng_serv_code.arr);
  strcpy(nd1_mapping_code.arr,d1_mapping_code.arr);  //added by raghava for scf-5413
  strcpy(nd1_serv_anal_grp.arr,d1_serv_anal_grp.arr);     
  strcpy(nd1_summary_dtl_ind.arr,d1_summary_dtl_ind.arr);
  strcpy(nd1_serv_class_code.arr,d1_serv_class_code.arr);
  strcpy(nd1_package_trx_yn.arr,d1_package_trx_yn.arr);

  }

 if (l_con_rcpt_yn.arr[0]=='Y' && strcmp(d3_bill_doc_type_code.arr,"\0")==0)
 end_of_subsidy=1;
 
 
 
}
/* THIS FUNCTION FOR GETTING GROSS, NET, DISCOUNT AMOUNT */
get_gross_net_amt()
{
  
  EXEC SQL EXECUTE
				BEGIN
				BLCOMMON.GET_SERV_TOT_AMT_BY_TRX(
				:nd_facility_id,
				:d1_trx_doc_ref,
				:d1_trx_doc_ref_line_num,
				:p_pat_gross_amt,
				:p_pat_disc_amt,
				:p_pat_net_amt,
				:p_err_level,
				:p_sys_message_id,
				:p_error_text);
                 
				if :p_sys_message_id is not null then
				:p_err_level := '10';
				:p_error_text := blcommon.get_error_text(:p_sys_message_id);
				end if;

				END;
				END-EXEC;

			if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
				{
				disp_message(ERR_MESG,p_error_text.arr);
				proc_exit(0);
				}

				p_err_level.arr[0] = '\0';
				p_err_level.len = 0;

				p_sys_message_id.arr[0] = '\0';
				p_sys_message_id.len = 0;

				p_error_text.arr[0] = '\0';
				p_error_text.len = 0;


}
get_gross_net_amt1()
{
	
	EXEC SQL EXECUTE
				BEGIN
				BLCOMMON.GET_SERV_TOT_AMT_BY_TRX(
				:nd_facility_id,
				:d_trx_doc_ref,
				:d_trx_doc_ref_line_num,
				:p_gross_amt,
				:p_disc_amt,
				:p_net_amt,
				:p_err_level,
				:p_sys_message_id,
				:p_error_text);

				if :p_sys_message_id is not null then
				:p_err_level := '10';
				:p_error_text := blcommon.get_error_text(:p_sys_message_id);
				end if;

				END;
				END-EXEC;

				if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
				{
				proc_exit(0);
				}

				p_err_level.arr[0] = '\0';
				p_err_level.len = 0;

				p_sys_message_id.arr[0] = '\0';
				p_sys_message_id.len = 0;

				p_error_text.arr[0] = '\0';
				p_error_text.len = 0;


}
chk_pkg_blng_grp()
{
   
   d_pkg_blng_grp_yn.arr[0]='\0';
   d_pkg_blng_grp_yn.len=0;

   EXEC SQL SELECT NVL(PACKAGE_YN,'N')
			INTO   :d_pkg_blng_grp_yn
			FROM BL_BLNG_GRP
			WHERE BLNG_GRP_ID=:dc_blng_grp_id;


   if (OERROR)
        err_mesg("SELECT failed on table BL_PARAMETERS",0,"");

   if (NODATAFOUND)
     d_pkg_blng_grp_yn.arr[0]='N';
	 
	 d_pkg_blng_grp_yn.arr[d_pkg_blng_grp_yn.len]='\0';						
}


get_closed_packages()
{

  	p_pkg_seq_num_str.arr[0] ='\0';
	p_pkg_seq_num_str.len	 =  0;
	p_pkg_amt_str.arr[0]	 ='\0';
	p_pkg_amt_str.len		 =  0;
	p_pkg_dep_str.arr[0]	 ='\0';
	p_pkg_dep_str.len		 =  0;

	temp_pkg_seq_num_str.arr[0] ='\0';
	temp_pkg_seq_num_str.len	=  0;
	temp_pkg_amt_str.arr[0]	    ='\0';
	temp_pkg_amt_str.len		=  0;
	temp_pkg_dep_str.arr[0]	    ='\0';
	temp_pkg_dep_str.len		=  0;


		  EXEC SQL EXECUTE
		
		   BEGIN

			 BL_PROC_FOR_EXT_SERVICE_MP.CLOSED_PKG_BILL_LIST(
			:nd_facility_id,
			:d_patient_id,
			:d2_bill_doc_type_code,
			:d2_bill_doc_num,
		    :p_pkg_seq_num_str,
			:p_pkg_amt_str,
			:p_pkg_dep_str,
			:p_pkg_dep_amt_str,
			:p_err_level,
			:p_sys_message_id,
			:p_error_text);

	
			if :p_sys_message_id is not null then
			:p_err_level := '10';
			:p_error_text := blcommon.get_error_text(:p_sys_message_id);
			end if;
			
			
			END;
			END-EXEC;

	
			if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
			{
			  disp_message(ERR_MESG,l_errortext.arr);
			  proc_exit(0);
			}

			p_err_level.arr[0] = '\0';
			p_err_level.len = 0;

			p_sys_message_id.arr[0] = '\0';
			p_sys_message_id.len = 0;

			p_error_text.arr[0] = '\0';
			p_error_text.len = 0;

		
		
			p_pkg_seq_num_str.arr[p_pkg_seq_num_str.len]='\0';
			p_pkg_amt_str.arr[p_pkg_amt_str.len]='\0';
			p_pkg_dep_str.arr[p_pkg_dep_str.len]='\0';

			strcpy(temp_pkg_seq_num_str.arr,p_pkg_seq_num_str.arr);
			strcpy(temp_pkg_amt_str.arr,p_pkg_amt_str.arr);
			strcpy(temp_pkg_dep_str.arr,p_pkg_dep_str.arr);

			
			temp_pkg_seq_num_str.len = strlen(temp_pkg_seq_num_str.arr);
			temp_pkg_seq_num_str.arr[temp_pkg_seq_num_str.len] = '\0';

			temp_pkg_amt_str.len = strlen(temp_pkg_amt_str.arr);
			temp_pkg_amt_str.arr[temp_pkg_amt_str.len] = '\0';

			temp_pkg_dep_str.len = strlen(temp_pkg_dep_str.arr);
			temp_pkg_dep_str.arr[temp_pkg_dep_str.len] = '\0';

			p_pkg_seq_num_str.arr[0]='\0';
			p_pkg_amt_str.arr[0]='\0';
			p_pkg_dep_str.arr[0]='\0';
			

			if (temp_pkg_seq_num_str.arr[0] != '\0')
			{
			

				  EXEC SQL SELECT length(:temp_pkg_seq_num_str)-length(replace(:temp_pkg_seq_num_str,',',null)) + 1
						   INTO :l_pkg_len
						   FROM DUAL;
				
				//sprintf(st_var,"%d",l_pkg_len);
				//disp_message(ERR_MESG,st_var);
		
				  for(i=1;i<=l_pkg_len;i++)
				  {
								  
					  
					  EXEC SQL SELECT SUBSTR(:temp_pkg_seq_num_str,1,INSTR(:temp_pkg_seq_num_str,',')-1),
									  SUBSTR(:temp_pkg_amt_str,1,INSTR(:temp_pkg_amt_str,',')-1),
									  SUBSTR(:temp_pkg_dep_str,1,INSTR(:temp_pkg_dep_str,',')-1)
							   INTO   :p_pkg_seq_num_str,
									  :p_pkg_amt_str,
									  :p_pkg_dep_str
								FROM DUAL;

					 

					  EXEC SQL SELECT  rtrim(SUBSTR(:temp_pkg_seq_num_str,INSTR(:temp_pkg_seq_num_str,',')+1)),
									   rtrim(SUBSTR(:temp_pkg_amt_str,INSTR(:temp_pkg_amt_str,',')+1)),
									   rtrim(SUBSTR(:temp_pkg_dep_str,INSTR(:temp_pkg_dep_str,',')+1))
							   INTO   :temp_pkg_seq_num_str,
									  :temp_pkg_amt_str,
									  :temp_pkg_dep_str
								FROM DUAL;

						
						p_pkg_seq_num_str.arr[p_pkg_seq_num_str.len]='\0';
						p_pkg_amt_str.arr[p_pkg_amt_str.len]='\0';
						p_pkg_dep_str.arr[p_pkg_dep_str.len]='\0';
						
						strcpy(p_pkg_seq_num[i],p_pkg_seq_num_str.arr);
						strcpy(p_pkg_amt[i],p_pkg_amt_str.arr);
						strcpy(p_pkg_dep_amt[i],p_pkg_dep_str.arr);
					
						temp_pkg_seq_num_str.arr[temp_pkg_seq_num_str.len]='\0';
						temp_pkg_amt_str.arr[temp_pkg_amt_str.len]='\0';
						temp_pkg_dep_str.arr[temp_pkg_dep_str.len]='\0';
											
						
				   }
					
						
						strcpy(p_pkg_seq_num[l_pkg_len],temp_pkg_seq_num_str.arr);
						strcpy(p_pkg_amt[l_pkg_len],temp_pkg_amt_str.arr);
						strcpy(p_pkg_dep_amt[l_pkg_len],temp_pkg_dep_str.arr);

		        }
			


}			



get_logo_dtl()
{
	
	  l_logo_yniflaser.arr[0] = 'N';

	  l_errorlevel.arr[0] = '\0';
	  l_errorlevel.len = 0;

	  l_sysmessageid.arr[0] = '\0';
	  l_sysmessageid.len = 0;

	  l_errortext.arr[0] = '\0';
	  l_errortext.len = 0;
			

	   if (l_lsr != 0 && l_dmp == 0)
	   {
		EXEC SQL EXECUTE	
		BEGIN					
			
			BLOPIN.GET_PRINT_SETUP_COL_VALUE(
				:nd_facility_id,
				'BLRVSBL1',
				'PRINT_LOGO_YN_IF_LASER',
				:l_logo_yniflaser,
				:l_errorlevel,
				:l_sysmessageid,
				:l_errortext) ;

				
				
			:l_logo_yniflaser := nvl(:l_logo_yniflaser,'N');

			if :l_sysmessageid is not null then
				:l_errorlevel := '10';
				:l_errortext := blcommon.get_error_text(:l_sysmessageid);
			end if;

		END;
		END-EXEC;

		if (strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
		{
			
			proc_exit(0);
		}

		l_errorlevel.arr[0] = '\0';
		l_errorlevel.len = 0;

		l_sysmessageid.arr[0] = '\0';
		l_sysmessageid.len = 0;

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;
	
		
		if (l_logo_yniflaser.arr[0] == 'Y')
		{
			EXEC SQL EXECUTE	
			BEGIN				
				BLOPIN.GET_PRINT_SETUP_COL_VALUE(
					:nd_facility_id,
					'BLRBILLO',
					'LOGO_NAME',
					:l_logo_name,
					:l_errorlevel,
					:l_sysmessageid,
					:l_errortext) ;
				

				if :l_sysmessageid is not null then
					:l_errorlevel := '10';
					:l_errortext := blcommon.get_error_text(:l_sysmessageid);
				end if;

			END;
			END-EXEC;
			if (strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
			{
			
				proc_exit(0);
			}

			LOGO_DIR.arr[0] = '\0';
			LOGO_DIR.len = 0;

		       l_errorlevel.arr[0] = '\0';
		       l_errorlevel.len = 0;

		       l_sysmessageid.arr[0] = '\0';
		       l_sysmessageid.len = 0;

		       l_errortext.arr[0] = '\0';
		       l_errortext.len = 0;	

			if (l_online_print_yn.arr[0] == 'N')
			{			
				EXEC SQL EXECUTE	
				BEGIN				
					WORKSTATION.GET_WS_PARAM(
						:nd_ws_no,				
						'BLLOGODIR',
						:LOGO_DIR,
						:l_errortext);			
					if :l_errortext is not null then 
						:l_errortext	:= 'BLLOGODIR:'||:l_errortext;
					end if;

				END;
				END-EXEC;
				if (l_errortext.arr[0] != '\0')
				{
					
					proc_exit(0);
				}		
			}
		}
	    }
   }


get_print_net_gross()
{
	//Modified by Harish against the instructions from Mr. Kuila 
	//Date - 06/11/2003 Point # 18 - Customization document.
	l_bill_print_opt_for_disc_print=0;



	EXEC SQL SELECT bill_print_opt_for_disc_print
	           INTO :l_bill_print_opt_for_disc_print
	           FROM bl_parameters
			  WHERE operating_facility_id = :nd_facility_id;

   if (OERROR)
        err_mesg("SELECT failed on table BL_PARAMETERS",0,"");

   if (NODATAFOUND)
     err_mesg("No Record found in BL_PARAMETERS",0,"");
	

	//This option will be used while the bill is printed form 
	//Print Visit Bill - No Discount option.
	if(strcmp(l_print_without_disc_func.arr,"1")==0)
	{
		l_bill_print_opt_for_disc_print=3;
	}
}


/* Procedure Part */


declare_cust_cur()
{
    EXEC SQL DECLARE BL_BILL_HDR_CUST_CUR CURSOR FOR
        SELECT SHORT_NAME
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d_cust_code1
	 AND  acc_entity_code = :nd_acc_entity_code
	 AND LANGUAGE_ID       =:nd_lang_id;

if (OERROR) 
	{	
		disp_message (ERR_MESG,"Failed to Declare customer cursor");
		proc_exit;
	}
return;
}


fetch_cust_cur()
{
d2_short_name.arr[0] = '\0';
d2_short_name.len=0;
 EXEC SQL SELECT SHORT_NAME into :d2_short_name
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d_cust_code1
	 AND  acc_entity_code = :nd_acc_entity_code
	 AND  LANGUAGE_ID       =:nd_lang_id;

d2_short_name.arr[d2_short_name.len] = '\0';
if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Cust Cursor Failed");
		proc_exit();
	}
  }

/*
open_cust_cur()
{
	EXEC SQL OPEN BL_BILL_HDR_CUST_CUR;

	if (OERROR) 
	{	
		disp_message(ERR_MESG,"Open Customer Cursor Failed");
		proc_exit();
	}

	return;
}


fetch_cust_cur()
{
	d2_short_name.arr[0] = '\0';
	d2_short_name.len = 0;

	EXEC SQL FETCH BL_BILL_HDR_CUST_CUR INTO	
			:d2_short_name;

   	if(NODATAFOUND)
	{
   		return 0;
	}

	if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor Failed");
		proc_exit();
	}

	d2_short_name.arr[d2_short_name.len] = '\0';

	return 1;
}



close_cust_cur()
{
	EXEC SQL CLOSE BL_BILL_HDR_CUST_CUR;
}	
*/
get_payer_name()
{
   d_customer_name.arr[0] = '\0';
   d_customer_name.len=0;

  
   /** The Below code added by raghava on 0110201 for SRR20056-SCF-5420 **/

   EXEC SQL SELECT COUNT(1) INTO l_payer_name_exsts
			FROM BL_CUST_PAYMENT_REF_HDR 
			WHERE OPERATING_FACILITY_ID = :nd_facility_id
			AND   PMNT_REF_NUM = :nd_pmnt_ref_num
			AND   PAYER_NAME IS NOT NULL;
   
   EXEC SQL EXECUTE
	 
	   DECLARE
	    V_CUST_NAME VARCHAR2(500);
	   BEGIN
		SELECT PAYER_NAME INTO :d_customer_name
		FROM BL_CUST_PAYMENT_REF_HDR 
		WHERE OPERATING_FACILITY_ID = :nd_facility_id
		AND   PMNT_REF_NUM = :nd_pmnt_ref_num;
		

       //disp_message(ERR_MESG,d_customer_name.arr);
	     IF :d_customer_name IS NULL THEN
		  
		  BEGIN
		     
			 SELECT DISTINCT long_name
			   INTO :d_customer_name
			   FROM bl_cust_payment_ref_hdr a,
					bl_cust_payment_ref_dtl b,
					ar_customer_lang_vw c
			  WHERE a.operating_facility_id = b.operating_facility_id
				AND a.pmnt_ref_num = b.pmnt_ref_num
				AND b.cust_code = c.cust_code
				AND c.acc_entity_code = :nd_acc_entity_code
				AND c.language_id = :nd_lang_id
				AND UPPER (a.operating_facility_id) = UPPER (:nd_facility_id)
				AND a.pmnt_ref_num = :nd_pmnt_ref_num
				AND b.slmt_doc_type_code = :d_doc_type_code1
				AND b.slmt_doc_num = :d_doc_number1;
				
				
		 
		  END;
		 
		 END IF;
		  
	   END;   
   END-EXEC;
 
   /*  
   if(NODATAFOUND)
   {
    fetch_customer();
   }
   
   */
   d_customer_name.arr[d_customer_name.len] = '\0';
   
  
   if (OERROR)
    err_mesg("SELECT failed on table  BL_CUST_PAYMENT_REF_HDR",0,"");
     

}
fetch_customer()
{

   d_customer_name.arr[0] = '\0';
   d_customer_name.len=0;

   EXEC SQL  SELECT SHORT_NAME into :d_customer_name
			 FROM	AR_CUSTOMER_LANG_VW 
			 WHERE  CUST_CODE = :d2_customer_code
			 AND  acc_entity_code = :nd_acc_entity_code
			 AND LANGUAGE_ID=:nd_lang_id;

  d_customer_name.arr[d_customer_name.len] = '\0';
  disp_message(ERR_MESG,d_customer_name.arr);
  
  if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor0 Failed");
		proc_exit();
	}
 }

fetch_customer1()
{

	d_customer2.arr[0] = '\0';
	d_customer2.len=0;
	nd_cust_cd1.arr[0] = '\0';
	nd_cust_cd1.len =0;
	strcpy(nd_cust_cd1.arr,nd_cust_code1.arr);
	nd_cust_cd1.arr[nd_cust_cd1.len]= '\0';

	EXEC SQL SELECT substr(SHORT_NAME,1,45) into :d_customer2
			 FROM	AR_CUSTOMER_LANG_VW 
			 WHERE  
			 CUST_CODE =:d_cust_code1	  
			 AND  acc_entity_code =:nd_acc_entity_code
			 AND LANGUAGE_ID=:nd_lang_id;

	d_customer2.arr[d_customer2.len] = '\0';

	if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor1 Failed");
		proc_exit();
	}
 }

fetch_customer2()
{

	d_customer3.arr[0] = '\0';
	d_customer3.len=0;

	EXEC SQL SELECT SHORT_NAME into :d_customer3
			 FROM	AR_CUSTOMER_LANG_VW 
			 WHERE  
			 CUST_CODE = :d1_cust_code1
			 AND  acc_entity_code = :nd_acc_entity_code
			 AND LANGUAGE_ID=:nd_lang_id;

	d_customer3.arr[d_customer3.len] = '\0';
	
	if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer2 Cursor Failed");
		proc_exit();
	}
}

prt_line()
{
  int i;
  {
     if( strcmp(c_print_separator_line.arr,"N")!=0)
	 {
		 for (i=0;i<105;i++)
		 {
			if ( l_logo_yniflaser.arr[0] == 'Y')	
			fprintf(fp,"%c",175);
			else
			fprintf(fp,"_");		     
		 }
	 }
  } 	      
}


prt_line_uc_wide()
{
  int i;
  {
     if( strcmp(c_print_separator_line.arr,"N")!=0)
	 {
		 for (i=0;i<105;i++)
		 {
		   fprintf(fp,"_");		     
		 }
	  }
  } 	      
}

prt_line_uc_wide1()
{
  int i;
  {
     if( strcmp(c_print_separator_line.arr,"N")!=0)
	 {
		 for (i=0;i<120;i++)
		 {
		  fprintf(fp,"_");		     
		 }
	  }
  } 	      
}


prt_line_uc()
{
  int i;
  {
     if( strcmp(c_print_separator_line.arr,"N")!=0)
	 {
		 for (i=0;i<105;i++)
		 {
		   fprintf(fp,"_");		     
		 }
	  }
  } 	      
}
// added by raghava on 14/3/2008
prt_line_uc1()
{
  int i;
  {
     if( strcmp(c_print_separator_line.arr,"N")!=0)
	 {
		 for (i=0;i<96;i++)
		 {
			fprintf(fp,"_");		     
		 }
	 }
  } 	      
}
/* For Counting Lines*/
lsr_line_cnt()
{
	
	if (l_lsr != 0 && l_dmp == 0)
	{
		v_lno = v_lno  + 1;
	}
	else
	{
	   v_lno = v_lno  + 1;
	}


   if(v_lno >= MAX_LINES-1)
	{
	
	
		fprintf(fp,"\n\n");
		// fprintf(fp,"%-80.80s%-s%d\n"," ",loc_legend210.arr,page_no);  //11793
		fprintf(fp,"\f");
		page_no++;
		v_lno=0;
		fprintf(fp,"\n\n");
		v_lno=v_lno+2;

		if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
		print_report_header();
		else
		print_header_exemption();
		
		if(strcmp(nd_preprint_flag.arr,"N")==0)
		{	
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			{
			prt_line_uc();
			fprintf(fp,"\n");
			}

			if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
			fprintf(fp,"%-7.7s%44.44s %-s%-s\n"," ",loc_legend1401.arr,cur_str.arr,")");	
		
			print_header_legeds();
	
			if( strcmp(c_print_separator_line.arr,"N")!=0)
			{
				if( lcol_cnt == 1)
				prt_line_uc();
				if(lcol_cnt == 2)
				prt_line_uc_wide();
				if(lcol_cnt == 3)
				prt_line_uc_wide1();
			}
		}
		fprintf(fp,"\n");
		v_lno=v_lno+1;
		
	}
	
	
}

last_line_prt()
{	
	fprintf(fp,"\n");
	last_line_check = 0;
	rec_out = 'Y';
}

fetch_legend_value()
{
	
	loc_legend1.arr[0]		= '\0';
	loc_legend2.arr[0]		= '\0';
	loc_legend3.arr[0]		= '\0';
	loc_legend4.arr[0]		= '\0';
	loc_legend5.arr[0]		= '\0';
	loc_legend6.arr[0]		= '\0';
	loc_legend7.arr[0]		= '\0';
	loc_legend8.arr[0]		= '\0';
	loc_legend9.arr[0]		= '\0';	
	loc_legend10.arr[0]		= '\0';
	loc_legend11.arr[0]		= '\0';
	loc_legend12.arr[0]		= '\0';
	loc_legend13.arr[0]		= '\0';
	loc_legend14.arr[0]		= '\0';
	loc_legend15.arr[0]		= '\0';
	loc_legend16.arr[0]		= '\0';
	loc_legend17.arr[0]		= '\0';
	loc_legend18.arr[0]		= '\0';
	loc_legend19.arr[0]		= '\0';
	loc_legend20.arr[0]		= '\0';
	loc_legend21.arr[0]		= '\0';
	loc_legend22.arr[0]		= '\0';
	loc_legend23.arr[0]		= '\0';				
	loc_legend24.arr[0]		= '\0';
	loc_legend25.arr[0]		= '\0';
	loc_legend26.arr[0]		= '\0';
	loc_legend27.arr[0]		= '\0';
	loc_legend28.arr[0]		= '\0';	
	loc_legend29.arr[0]		= '\0';	
	loc_legend30.arr[0]		= '\0';	
	loc_legend31.arr[0]		= '\0';	
	loc_legend32.arr[0]		= '\0';	
	loc_legend33.arr[0]		= '\0';	
	loc_legend34.arr[0]		= '\0';	
	loc_legend35.arr[0]		= '\0';	
	loc_legend36.arr[0]		= '\0';	
	loc_legend37.arr[0]		= '\0';	
	loc_legend38.arr[0]		= '\0';	
	loc_legend39.arr[0]		= '\0';	
	loc_legend40.arr[0]		= '\0';	
	loc_legend41.arr[0]		= '\0';	
	loc_legend42.arr[0]		= '\0';	
	loc_legend43.arr[0]		= '\0';	
	loc_legend50.arr[0]		= '\0';
	loc_legend54.arr[0]		= '\0';
	loc_legend55.arr[0]		= '\0';	
	loc_legend56.arr[0]		= '\0';	
	loc_legend57.arr[0]		= '\0';	
	loc_legend58.arr[0]		= '\0';
	loc_legend59.arr[0]		= '\0';
	loc_legend60.arr[0]		= '\0';	
	loc_legend61.arr[0]		= '\0';	
	loc_legend62.arr[0]		= '\0';	
	loc_legend63_rc.arr[0]	= '\0';	
	loc_legend64.arr[0]		= '\0';
	loc_legend65.arr[0]		= '\0';
	loc_legend66.arr[0]		= '\0';
	loc_legend67.arr[0]		= '\0';
	legend_doc_date.arr[0]  = '\0';
	loc_legend_90.arr[0]	= '\0';
				

	loc_legend63.arr[0]		= '\0';	
	loc_legend68.arr[0]		= '\0';
	loc_legend69.arr[0]		= '\0';
	loc_legend70.arr[0]		= '\0';
	loc_legend71.arr[0]		= '\0';
	loc_legend72.arr[0]		= '\0';
	loc_legend73.arr[0]		= '\0';
	loc_legend74.arr[0]		= '\0';
	loc_legend75.arr[0]		= '\0';
	loc_legend76.arr[0]		= '\0';
	loc_legend77.arr[0]		= '\0';
	loc_legend78.arr[0]		= '\0';
	loc_legend79.arr[0]		= '\0';
	loc_legend80.arr[0]		= '\0';
	loc_legend81.arr[0]		= '\0';
	loc_legend82.arr[0]		= '\0';
	loc_legend83.arr[0]		= '\0';
	loc_legend84.arr[0]		= '\0';
	loc_legend85.arr[0]		= '\0';
    loc_legend87.arr[0]		= '\0';
	loc_legend88.arr[0]		= '\0';
	loc_legend89.arr[0]		= '\0';
	loc_legend90.arr[0]		= '\0';
	loc_legend91.arr[0]		= '\0';
	loc_legend92.arr[0]		= '\0';
	loc_legend93.arr[0]		= '\0';
	loc_legend94.arr[0]		= '\0';
	loc_legend95.arr[0]		= '\0';
	loc_legend96.arr[0]		= '\0';
	loc_legend97.arr[0]		= '\0';
	loc_legend98.arr[0]		= '\0';
	loc_legend99.arr[0]		= '\0';
	loc_legend100.arr[0]	= '\0';
	loc_legend101.arr[0]	= '\0';
	loc_legend102.arr[0]	= '\0';
	loc_legend103.arr[0]	= '\0';
	loc_legend104.arr[0]	= '\0';
	loc_legend105.arr[0]	= '\0';
	loc_legend106.arr[0]	= '\0';
	loc_legend107.arr[0]	= '\0';
	loc_legend108.arr[0]	= '\0';
	loc_legend109.arr[0]	= '\0';
	loc_legend1100.arr[0]	= '\0';
	loc_legend1110.arr[0]	= '\0';
	loc_legend1120.arr[0]	= '\0';
	loc_legend1130.arr[0]	= '\0';
	loc_legend1140.arr[0]	= '\0';
	loc_legend1160.arr[0]	= '\0';
	loc_legend1220.arr[0]	= '\0';
	loc_legend1230.arr[0]	= '\0';
	loc_legend110.arr[0]	= '\0';
	loc_legend120.arr[0]	= '\0';
	loc_legend210.arr[0]	= '\0';
	loc_legend1300.arr[0]	= '\0';
	loc_legend1310.arr[0]	= '\0';
	loc_legend1320.arr[0]	= '\0';
	loc_legend1330.arr[0]	= '\0';
	loc_legend1340.arr[0]	= '\0';
	loc_legend1350.arr[0]	= '\0';
	loc_legend1360.arr[0]	= '\0';
	loc_legend1370.arr[0]	= '\0';
	loc_legend1380.arr[0]	= '\0';
	loc_legend1390.arr[0]	= '\0';
	loc_legend1400.arr[0]	= '\0';
	loc_legend1401.arr[0]	= '\0';
	loc_legend1260.arr[0]	= '\0';
	loc_legend1270.arr[0]	= '\0';
	loc_legend1280.arr[0]	= '\0';
	loc_legend1290.arr[0]	= '\0';
	loc_legend1407.arr[0]   = '\0';
	loc_legend1411.arr[0]	= '\0';
	loc_legend1412.arr[0]	= '\0';
	loc_legend1413.arr[0]   = '\0';
	loc_legend1414.arr[0]	= '\0';
	loc_legend1444.arr[0]   = '\0';
	loc_legend1445.arr[0]   = '\0';
	loc_legend1446.arr[0]   = '\0';
	loc_legend1447.arr[0]   = '\0';
	loc_legend1448.arr[0]   = '\0';
	loc_legend1449.arr[0]	= '\0';
	loc_legend1450.arr[0]	= '\0';
	loc_legend1451.arr[0]	= '\0';
	loc_legend1452.arr[0]	= '\0';
	loc_legend1453.arr[0]	= '\0';
	loc_legend1454.arr[0]	= '\0';
	loc_legend1455.arr[0]	= '\0';
	loc_legend1456.arr[0]	= '\0';
	loc_legend1457.arr[0]	= '\0';
	loc_legend1459.arr[0]	= '\0';
	loc_legend1460.arr[0]	= '\0';
	loc_legend1461.arr[0]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1462.arr[0]	= '\0';  //Added by raghava on 01/07/2010 for UAT
    loc_legend1464.arr[0]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1465.arr[0]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1466.arr[0]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1415.arr[0]   = '\0';	 
	loc_legend1423.arr[0]	= '\0';
	loc_legend1424.arr[0]	= '\0';
	loc_legend1439.arr[0]	= '\0';
	loc_legend995.arr[0]	= '\0';
	 
	loc_legend1.len			= 0;
	loc_legend2.len			= 0;
	loc_legend3.len			= 0;
	loc_legend4.len			= 0;
	loc_legend5.len			= 0;
	loc_legend6.len			= 0;
	loc_legend7.len			= 0;
	loc_legend8.len			= 0;
	loc_legend9.len			= 0;	
	loc_legend10.len		= 0;
	loc_legend11.len		= 0;
	loc_legend12.len		= 0;
	loc_legend13.len		= 0;
	loc_legend14.len		= 0;
	loc_legend15.len		= 0;
	loc_legend16.len		= 0;
	loc_legend17.len		= 0;
	loc_legend18.len		= 0;
	loc_legend19.len		= 0;
	loc_legend20.len		= 0;
	loc_legend21.len		= 0;
	loc_legend22.len		= 0;
	loc_legend23.len		= 0;
	loc_legend24.len		= 0;
	loc_legend25.len		= 0;
	loc_legend26.len		= 0;
	loc_legend27.len		= 0;
	loc_legend28.len		= 0;
	loc_legend29.len		= 0;
	loc_legend30.len		= 0;
	loc_legend31.len		= 0;
	loc_legend32.len		= 0;
	loc_legend33.len		= 0;
	loc_legend34.len		= 0;
	loc_legend35.len		= 0;
	loc_legend36.len		= 0;
	loc_legend37.len		= 0;
	loc_legend38.len		= 0;
	loc_legend39.len		= 0;
	loc_legend40.len		= 0;
	loc_legend41.len		= 0;
	loc_legend42.len		= 0;
	loc_legend43.len		= 0;
	loc_legend50.len		= 0;
    loc_legend54.len		= 0;
	loc_legend55.len		= 0;
	loc_legend56.len		= 0;
	loc_legend57.len		= 0;
	loc_legend58.len		= 0;
	loc_legend59.len		= 0;
	loc_legend60.len		= 0;
	loc_legend61.len		= 0;
	loc_legend62.len		= 0;
	loc_legend63_rc.len		= 0;
	loc_legend64.len		= 0;
	loc_legend65.len		= 0;
	loc_legend66.len		= 0;
	loc_legend67.len		= 0;
	legend_doc_date.len		= 0;
	loc_legend_90.len		= 0;
	loc_legend68.len		= 0;
	loc_legend69.len		= 0;
	loc_legend70.len		= 0;
	loc_legend71.len		= 0;
	loc_legend72.len		= 0;
	loc_legend73.len		= 0;
	loc_legend74.len		= 0;
	loc_legend75.len		= 0;
	loc_legend76.len		= 0;
	loc_legend77.len		= 0;
	loc_legend78.len		= 0;
	loc_legend79.len		= 0;
	loc_legend80.len		= 0;
	loc_legend81.len		= 0;
	loc_legend82.len		= 0;
	loc_legend83.len		= 0;
	loc_legend84.len		= 0;
	loc_legend85.len		= 0;
	loc_legend87.len		= 0;
	loc_legend88.len		= 0;
	loc_legend89.len		= 0;
	loc_legend90.len		= 0;
	loc_legend91.len		= 0;
	loc_legend92.len		= 0;
	loc_legend93.len		= 0;
	loc_legend94.len		= 0;
	loc_legend95.len		= 0;
	loc_legend96.len		= 0;
	loc_legend97.len		= 0;
	loc_legend98.len		= 0;
	loc_legend99.len		= 0;
	loc_legend100.len		= 0;
	loc_legend101.len		= 0;
	loc_legend102.len		= 0;
	loc_legend103.len		= 0;
	loc_legend104.len		= 0;
	loc_legend105.len		= 0;
	loc_legend106.len		= 0;
	loc_legend107.len		= 0;
	loc_legend108.len		= 0;
	loc_legend109.len		= 0;
	loc_legend1100.len		= 0;
	loc_legend1110.len		= 0;
	loc_legend1120.len		= 0;
	loc_legend1130.len		= 0;
	loc_legend1140.len		= 0;
	loc_legend1160.len		= 0;
	loc_legend1220.len	    = 0;
	loc_legend1230.len		= 0;
	loc_legend110.len		= 0;
	loc_legend120.len		= 0;
	loc_legend210.len		= 0;
	loc_legend1300.len		= 0;
	loc_legend1310.len		= 0;
	loc_legend1320.len		= 0;
	loc_legend1330.len		= 0;
	loc_legend1340.len		= 0;
	loc_legend1350.len		= 0;
	loc_legend1360.len		= 0;
	loc_legend1370.len		= 0;
	loc_legend1380.len		= 0;
	loc_legend1390.len		= 0;
	loc_legend1400.len		= 0;
	loc_legend1401.len		= 0;
	loc_legend1260.len		= 0;
	loc_legend1270.len		= 0;
	loc_legend1280.len		= 0;
	loc_legend1290.len		= 0;
	loc_legend1407.len		= 0;
	loc_legend1411.len		= 0;
	loc_legend1412.len		= 0;
	loc_legend1413.len		= 0;
	loc_legend1414.len		= 0;
	loc_legend1444.len		= 0;
	loc_legend1445.len		= 0;
	loc_legend1446.len		= 0;
	loc_legend1447.len		= 0;
	loc_legend1448.len		= 0;
	loc_legend1449.len		= 0;
    loc_legend1450.len		= 0;
	loc_legend1451.len	    = 0; 
	loc_legend1452.len	    = 0; 
	loc_legend1453.len	    = 0; 
	loc_legend1454.len	    = 0; 
	loc_legend1455.len		= 0;
	loc_legend1456.len		= 0;
	loc_legend1457.len		= 0;
	loc_legend1458.len		= 0;
    loc_legend1459.len		= 0;
	loc_legend1460.len		= 0;
	loc_legend1461.len		= 0;  //Added by raghava on 01/07/2010 for UAT
	loc_legend1462.len		= 0;  //Added by raghava on 01/07/2010 for UAT
    loc_legend1464.len		= 0;  //Added by raghava on 01/07/2010 for UAT
	loc_legend1465.len		= 0;  //Added by raghava on 01/07/2010 for UAT
	loc_legend1466.len		= 0;  //Added by raghava on 01/07/2010 for UAT
	loc_legend1415.len      = 0,
	loc_legend1439.len		= 0;
	loc_legend1423.len		= 0;
	loc_legend1424.len		= 0;
	loc_legend995.len		= 0;

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend1
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_010' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend1
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_010';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend2
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_020' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend2
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_020';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 2",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend3
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_030' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend3
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_030';
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend1415
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BLRBOULS.LEGEND_130' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select 'BANK NAME' into :loc_legend1415
					from Dual;
					//where LEGEND_ID = 'RECEIPT.LEGEND_030';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 3",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend4
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_040' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend4
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_040';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 4",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend5
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_050' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend5
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_050';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 5",0,"");
	}

	if (l_lsr != 0 && l_dmp == 0)
	{
		EXEC SQL select COLUMN_VALUE
				into :loc_legend6
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_060' 
				and LANGUAGE_ID = :nd_lang_id;
	}
	else
	{
		EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend6
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_060' 
				and LANGUAGE_ID = :nd_lang_id;
		
	}

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend6
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_060';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 6",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend7
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_070' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend7
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_070';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 7",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend8
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_080' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend8
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_080';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 8",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend9
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_090' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend9
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_090';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 9",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend10
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_100' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend10
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_100';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 10",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend11
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_110' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend11
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_110';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 11",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend12
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_120' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend12
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_120';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 12",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend13
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_130' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend13
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_130';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 13",0,"");
	}


	EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/  COLUMN_VALUE
				into :loc_legend14
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_140' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend14
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_140';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 14",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend15
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_150' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend15
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_150';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 15",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend16
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_160' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend16
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_160';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 16",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend17
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_170' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend17
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_170';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 17",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend18
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_180' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend18
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_180';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 18",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend19
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_190' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend19
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_190';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 19",0,"");
	}


		EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend20
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_200' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend20
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_200';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 20",0,"");
	}




		EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend21
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_210' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend21
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_210';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 21",0,"");
	}


			EXEC SQL select 
			lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	
			/*rtrim(substr(COLUMN_VALUE,1,50))*/
				into :loc_legend22
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_220' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select /*dflt_legend_value*/
			lpad(' ',round((:l_margin_len-length(rtrim(substr(dflt_legend_value,1,50))))/2),' ')||UPPER(rtrim(substr(dflt_legend_value,1,50)))				
				into :loc_legend22
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_220';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 22",0,"");
}


EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
	into :loc_legend23
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and	TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'RECEIPT.LEGEND_230' 
	and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend23
				from sm_lang_legend
				where LEGEND_ID = 'RECEIPT.LEGEND_230';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 23",0,"");
}

EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/
		lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	
		into :loc_legend24
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_240' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select /* dflt_legend_value */
		lpad(' ',round((:l_margin_len-length(rtrim(substr(dflt_legend_value,1,50))))/2),' ')||UPPER(rtrim(substr(dflt_legend_value,1,50)))			
		into :loc_legend24
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_240';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 24",0,"");
}

EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
		into :loc_legend25
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_250' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend25
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_250';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 25",0,"");
}


EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
		into :loc_legend26
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_260' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend26
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_260';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 26",0,"");
}

EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
		into :loc_legend27
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_270' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend27
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_270';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 27",0,"");
}


EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/ COLUMN_VALUE
		into :loc_legend28
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_280' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend28
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_280';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 28",0,"");
}

					/*********----------20/09/2005-----*********/

EXEC SQL select COLUMN_VALUE
		into :loc_legend29
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_290' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend29
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_290';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 29",0,"");
}



EXEC SQL select COLUMN_VALUE
		into :loc_legend30
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_300' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend30
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_300';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 30",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend31
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_310' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend31
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_310';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 31",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend32
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_320' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend32
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_320';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 32",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend33
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_330' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend33
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_330';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 33",0,"");
}





EXEC SQL select COLUMN_VALUE
		into :loc_legend34
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_340' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend34
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_340';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 34",0,"");
}





EXEC SQL select COLUMN_VALUE
		into :loc_legend35
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_350' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend35
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_350';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 35",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend36
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_360' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend36
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_360';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 36",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend37
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_370' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend37
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_370';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 37",0,"");
}


EXEC SQL select COLUMN_VALUE
		into :loc_legend38
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_380' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend38
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_380';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 38",0,"");
}





EXEC SQL select COLUMN_VALUE
		into :loc_legend39
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_390' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend39
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_390';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 39",0,"");
}





EXEC SQL select COLUMN_VALUE
		into :loc_legend40
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_400' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend40
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_400';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 40",0,"");
}




EXEC SQL select COLUMN_VALUE
		into :loc_legend41
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_410' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend41
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_410';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 41",0,"");
}



EXEC SQL select COLUMN_VALUE
		into :loc_legend42
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_420' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend42
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_420';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 42",0,"");
}






EXEC SQL select COLUMN_VALUE
		into :loc_legend43
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_430' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend43
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_430';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 43",0,"");
}



EXEC SQL select COLUMN_VALUE
		into :loc_legend50
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_500' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend50
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_500';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 50",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend54
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_540' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend54
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_540';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 54",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend55
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_550' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend55
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_550';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 55",0,"");
}


EXEC SQL select COLUMN_VALUE
		into :loc_legend56
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_560' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend56
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_560';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 56",0,"");
}



EXEC SQL select COLUMN_VALUE
		into :loc_legend57
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_570' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend57
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_570';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 57",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend58
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_580' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend58
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_580';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 58",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend59
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_590' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend59
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_590';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 59",0,"");
}


EXEC SQL select COLUMN_VALUE
		into :loc_legend60
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_600' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend60
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_600';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 60",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend61
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_610' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend61
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_610';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 61",0,"");
}



EXEC SQL select COLUMN_VALUE
		into :loc_legend62
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_620' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend62
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_620';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 62",0,"");
}


EXEC SQL select COLUMN_VALUE
		into :loc_legend63_rc
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_630' 
		and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend63_rc
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_630';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 63",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend64
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_640' 
		and LANGUAGE_ID = :nd_lang_id;

		

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend64
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_640';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 64",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend65
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_650' 
		and LANGUAGE_ID = :nd_lang_id;

		

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend65
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_650';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 65",0,"");
}

EXEC SQL select COLUMN_VALUE
		into :loc_legend66
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_660' 
		and LANGUAGE_ID = :nd_lang_id;

		

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend66
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_660';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 66",0,"");
}


EXEC SQL select COLUMN_VALUE
		into :loc_legend67
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'RECEIPT.LEGEND_670' 
		and LANGUAGE_ID = :nd_lang_id;

		

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend67
		from sm_lang_legend
		where LEGEND_ID = 'RECEIPT.LEGEND_670';
}

if (sqlca.sqlcode < 0)
{   
	err_mesg("SELECT failed on LEGEND 67",0,"");
}

EXEC SQL select  COLUMN_VALUE 
		into :legend_doc_date
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_080' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :legend_doc_date
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_080';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 80",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
		into :loc_legend_90
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_090' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :legend_doc_date
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_090';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 90",0,"");
	}

				EXEC SQL select  COLUMN_VALUE 
					into :loc_legend110
					from SM_RECORD_TRANS_DATA a,sm_lang_legend b
					where MODULE_ID = 'SM' 
					and TABLE_ID = 'SM_LANG_LEGEND'
					and COLUMN_ID = 'DFLT_LEGEND_VALUE'
					and PK_VALUE = LEGEND_ID
					and LEGEND_ID = 'BILL_01.LEGEND_110' 
					and LANGUAGE_ID = :nd_lang_id;

				if (sqlca.sqlcode == 1403)
				{
					EXEC SQL select dflt_legend_value into :loc_legend110
								from sm_lang_legend
								where LEGEND_ID = 'BILL_01.LEGEND_110';
				}

	
	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 110",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
		into :loc_legend120
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_120' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend120
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_120';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 120",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
		into :loc_legend210
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_210' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend210
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_210';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 210",0,"");
	}
EXEC SQL select  COLUMN_VALUE 
		into :loc_legend63
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_630' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend63
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_630';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 63",0,"");
	}



			EXEC SQL select  COLUMN_VALUE 
						into :loc_legend68
						from SM_RECORD_TRANS_DATA a,sm_lang_legend b
						where MODULE_ID = 'SM' 
						and TABLE_ID = 'SM_LANG_LEGEND'
						and COLUMN_ID = 'DFLT_LEGEND_VALUE'
						and PK_VALUE = LEGEND_ID
						and LEGEND_ID = 'BILL_01.LEGEND_680' 
						and LANGUAGE_ID = :nd_lang_id;

			if (sqlca.sqlcode == 1403)
			{
				EXEC SQL select dflt_legend_value into :loc_legend68
							from sm_lang_legend
							where LEGEND_ID = 'BILL_01.LEGEND_680';
			}

	
	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 68",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend69
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_690' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend69
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_690';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 69",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend70
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_700' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend70
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_700';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 70",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend71
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_710' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend71
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_710';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 71",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend72
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_720' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend72
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_720';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 72",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend73
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_730' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend73
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_730';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 73",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend74
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_740' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend74
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_740';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 74",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend75
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_750' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend75
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_750';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 75",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend76
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_760' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend76
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_760';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 76",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend77
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_770' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend77
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_770';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 77",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend78
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_780' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend78
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_780';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 78",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend79
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_790' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend79
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_790';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 79",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend80
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_800' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend80
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_800';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 80",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend81
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_810' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend81
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_810';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 81",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend82
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_820' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend82
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_820';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 82",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend83
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_830' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend83
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_830';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 83",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend84
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_840' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend84
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_840';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 84",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend85
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_850' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend85
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_850';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 85",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend87
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_870' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend87
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_870';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 87",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend88
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_880' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend88
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_880';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 88",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend89
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_890' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend89
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_890';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 89",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend90
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_900' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend90
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_900';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 90",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend91
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_910' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend91
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_910';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 91",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend92
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_920' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend92
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_920';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 92",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend93
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_930' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend93
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_930';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 93",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend94
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_940' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend94
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_940';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 94",0,"");

	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend95
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_950' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend95
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_950';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 95",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend96
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_960' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend96
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_960';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 96",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend97
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_970' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend97
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_970';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 97",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend98
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_980' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend98
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_980';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 98",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend99
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_990' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend99
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_990';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 99",0,"");

	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend100
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1000' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend100
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1000';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 100",0,"");

	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend101
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1010' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend101
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1010';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 101",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend102
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1020' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend102
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1020';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 102",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend103
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1030' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend103
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1030';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 103",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend104
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1040' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend104
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1040';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 104",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend105
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1050' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend105
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1050';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 105",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend106
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1060' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend106
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1060';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 106",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend107
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1070' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend107
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1070';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 107",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend108
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1080' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend108
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1080';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 108",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend109
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1090' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend109
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1090';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 109",0,"");

	}
EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1100
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1100' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1100
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1100';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1100",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1110
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1110' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1110
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1110';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1110",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1120
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1120' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1120
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1120';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1120",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1130
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1130' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1130
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1130';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1130",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1140
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1140' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1140
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1140';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1140",0,"");

	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1160
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1160' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1160
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1160';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1160",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1220
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1220' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1220
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1220';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1220",0,"");

	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1230
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1230' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1230
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1230';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1230",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1300
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1300' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1300
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1300';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1300",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1310
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1310' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1310
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1310';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1310",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1320
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1320' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1320
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1320';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1320",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1330
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1330' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1330
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1330';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1330",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1340
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1340' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1340
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1340';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1340",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
			into :loc_legend1350
			from SM_RECORD_TRANS_DATA a,sm_lang_legend b
			where MODULE_ID = 'SM' 
			and TABLE_ID = 'SM_LANG_LEGEND'
			and COLUMN_ID = 'DFLT_LEGEND_VALUE'
			and PK_VALUE = LEGEND_ID
			and LEGEND_ID = 'BILL_01.LEGEND_1350' 
			and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1350
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1350';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1350",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
		into :loc_legend1360
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BILL_01.LEGEND_1360' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1360
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1360';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1360",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1370
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1370' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1370
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1370';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1370",0,"");

	}
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1380
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1380' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1380
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1380';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1380",0,"");

	}
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1390
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1390' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1390
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1390';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1390",0,"");

	}
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1400
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1400' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1400
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1400';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1400",0,"");

	}
    
	EXEC SQL select  '( ' ||COLUMN_VALUE 
	into :loc_legend1401
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1401' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select '( ' ||dflt_legend_value into :loc_legend1401
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1401';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1401",0,"");

	}
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1260
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1260' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1260
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1260';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1260",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1270
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1270' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1270
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1270';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1270",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1280
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1280' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1280
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1280';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1280",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1290
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1290' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1290
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1290';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1290",0,"");

	}
    
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1407
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1407' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1407
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1407';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1407",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1411
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1411' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1411
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1411';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1411",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1412
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1412' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1412
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1412';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1412",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1413
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1413' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1413
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1413';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1413",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1414
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1414' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1414
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1414';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1414",0,"");

	}
    
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1444
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1444' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1444
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1444';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1444",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1445
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1445' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1445
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1445';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1445",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1446
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1446' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1446
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1446';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1446",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1447
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1447' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1447
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1447';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1447",0,"");

	}
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1448
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1448' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1448
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1448';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1448",0,"");

	}
	
	
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1449
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1449' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1449
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1449';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1449",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1450
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1450' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1450
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1450';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1450",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1451
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1451' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1451
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1451';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1451",0,"");

	}
	
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1452
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1452' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1452
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1452';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1452",0,"");

	}
    
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1453
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1453' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1453
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1453';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1453",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1454
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1454' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1454
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1454';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1454",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1455
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1455' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1455
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1455';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1455",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1456
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1456' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1456
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1456';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1456",0,"");

	}
    
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1457
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1457' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1457
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1457';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1457",0,"");

	}
    
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1458
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1458' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1458
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1458';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1458",0,"");

	}

   	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1459
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1459' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1459
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1459';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1459",0,"");

	}

    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1460
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1460' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1460
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1460';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1460",0,"");

	}

	/*** The Below legends added by raghava on 01/07/2010 for UAT ***/
    
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1461
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1461' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1461
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1461';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1461",0,"");

	}

   
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1462
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1462' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1462
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1462';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1462",0,"");

	}
   
   /*** UPTO HERE(01/07/2010) ***/

	
	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1464
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1464' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1464
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1464';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1464",0,"");

	}
	
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1465
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1465' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1465
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1465';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1465",0,"");

	}
    EXEC SQL select  COLUMN_VALUE 
	into :loc_legend1466
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_1466' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1466
				 from sm_lang_legend
				 where LEGEND_ID = 'BILL_01.LEGEND_1466';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1466",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
	into :loc_legend995
	from SM_RECORD_TRANS_DATA a,sm_lang_legend b
	where MODULE_ID = 'SM' 
	and TABLE_ID = 'SM_LANG_LEGEND'
	and COLUMN_ID = 'DFLT_LEGEND_VALUE'
	and PK_VALUE = LEGEND_ID
	and LEGEND_ID = 'BILL_01.LEGEND_995' 
	and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend995
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_995';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 995",0,"");

	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend680
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_680' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend680
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_680';
	}

	
if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 680",0,"");

	}

		EXEC SQL select  COLUMN_VALUE 
				into :loc_legend690
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_690' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend690
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_690';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 690",0,"");

	}

		EXEC SQL select  COLUMN_VALUE 
				into :loc_legend700
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_700' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend700
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_700';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 700",0,"");

	}


		EXEC SQL select  COLUMN_VALUE 
				into :loc_legend701
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'RECEIPT.LEGEND_701' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend701
					from sm_lang_legend
					where LEGEND_ID = 'RECEIPT.LEGEND_701';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 701",0,"");

	}
	
		EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1423
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1423' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1423
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1423';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1423",0,"");

	}
    	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1424
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1424' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1424
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1424';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1424",0,"");

	}

		EXEC SQL select  COLUMN_VALUE 
				into :loc_legend1439
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_1439' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend1439
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_1439';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1439",0,"");

	}

	loc_legend1.arr[loc_legend1.len]		= '\0';
	loc_legend2.arr[loc_legend2.len]		= '\0';
	loc_legend3.arr[loc_legend3.len]		= '\0';
	loc_legend4.arr[loc_legend4.len]		= '\0';
	loc_legend5.arr[loc_legend5.len]		= '\0';
	loc_legend6.arr[loc_legend6.len]		= '\0';
	loc_legend7.arr[loc_legend7.len]		= '\0';
	loc_legend8.arr[loc_legend8.len]		= '\0';
	loc_legend9.arr[loc_legend9.len]		= '\0';
	loc_legend10.arr[loc_legend10.len]		= '\0';
	loc_legend11.arr[loc_legend11.len]		= '\0';
	loc_legend12.arr[loc_legend12.len]		= '\0';
	loc_legend13.arr[loc_legend13.len]		= '\0';
	loc_legend14.arr[loc_legend14.len]		= '\0';
	loc_legend15.arr[loc_legend15.len]		= '\0';
	loc_legend16.arr[loc_legend16.len]		= '\0';
	loc_legend17.arr[loc_legend17.len]		= '\0';
	loc_legend18.arr[loc_legend18.len]		= '\0';
	loc_legend19.arr[loc_legend19.len]		= '\0';
	loc_legend20.arr[loc_legend20.len]		= '\0';
	loc_legend21.arr[loc_legend21.len]		= '\0';
	loc_legend22.arr[loc_legend22.len]		= '\0';
	loc_legend23.arr[loc_legend23.len]		= '\0';

	loc_legend24.arr[loc_legend24.len]		= '\0';
	loc_legend25.arr[loc_legend25.len]		= '\0';
	loc_legend26.arr[loc_legend26.len]		= '\0';
	loc_legend27.arr[loc_legend27.len]		= '\0';
	loc_legend28.arr[loc_legend28.len]		= '\0';
									/***--------20/09/2005----***/
	loc_legend29.arr[loc_legend29.len]		= '\0';
	loc_legend30.arr[loc_legend30.len]		= '\0';
	loc_legend31.arr[loc_legend31.len]		= '\0';
	loc_legend32.arr[loc_legend32.len]		= '\0';
	loc_legend33.arr[loc_legend33.len]		= '\0';
	loc_legend34.arr[loc_legend34.len]		= '\0';
	loc_legend35.arr[loc_legend35.len]		= '\0';
	loc_legend36.arr[loc_legend36.len]		= '\0';
	loc_legend37.arr[loc_legend37.len]		= '\0';
	loc_legend38.arr[loc_legend38.len]		= '\0';
	loc_legend39.arr[loc_legend39.len]		= '\0';
	loc_legend40.arr[loc_legend40.len]		= '\0';
	loc_legend41.arr[loc_legend41.len]		= '\0';
	loc_legend42.arr[loc_legend42.len]		= '\0';
	loc_legend43.arr[loc_legend43.len]		= '\0';

	loc_legend50.arr[loc_legend50.len]		= '\0';

	loc_legend54.arr[loc_legend54.len]		= '\0';
	loc_legend55.arr[loc_legend55.len]		= '\0';
	loc_legend56.arr[loc_legend56.len]		= '\0';
	loc_legend57.arr[loc_legend57.len]		= '\0';
	loc_legend58.arr[loc_legend58.len]		= '\0';
	loc_legend59.arr[loc_legend59.len]		= '\0';
	loc_legend60.arr[loc_legend60.len]		= '\0';
	loc_legend61.arr[loc_legend61.len]		= '\0';
	loc_legend62.arr[loc_legend62.len]		= '\0';
	loc_legend63_rc.arr[loc_legend63_rc.len]= '\0';
	loc_legend64.arr[loc_legend64.len]		= '\0'; 
	loc_legend65.arr[loc_legend65.len]		= '\0';
	loc_legend66.arr[loc_legend66.len]		= '\0';
	loc_legend67.arr[loc_legend67.len]		= '\0';
	legend_doc_date.arr[legend_doc_date.len]= '\0';
	loc_legend_90.arr[loc_legend_90.len]	= '\0';


	loc_legend63.arr[loc_legend63.len]		= '\0';
	loc_legend68.arr[loc_legend68.len]		= '\0';	
	loc_legend69.arr[loc_legend69.len]		= '\0';	
	loc_legend70.arr[loc_legend70.len]		= '\0';	
	loc_legend71.arr[loc_legend71.len]		= '\0';	
	loc_legend72.arr[loc_legend72.len]		= '\0';	
	loc_legend73.arr[loc_legend73.len]		= '\0';	
	loc_legend74.arr[loc_legend74.len]		= '\0';	
	loc_legend75.arr[loc_legend75.len]		= '\0';	
	loc_legend76.arr[loc_legend76.len]		= '\0';	
	loc_legend77.arr[loc_legend77.len]		= '\0';	
	loc_legend78.arr[loc_legend78.len]		= '\0';	
	loc_legend79.arr[loc_legend79.len]		= '\0';	
	loc_legend80.arr[loc_legend80.len]		= '\0';
	loc_legend81.arr[loc_legend81.len]		= '\0';
	loc_legend82.arr[loc_legend82.len]		= '\0';
	loc_legend83.arr[loc_legend83.len]		= '\0';	
	loc_legend84.arr[loc_legend84.len]		= '\0';
	loc_legend85.arr[loc_legend85.len]		= '\0';
	loc_legend87.arr[loc_legend87.len]		= '\0';	
	loc_legend88.arr[loc_legend88.len]		= '\0';
	loc_legend89.arr[loc_legend89.len]		= '\0';
	loc_legend90.arr[loc_legend90.len]		= '\0';
	loc_legend91.arr[loc_legend91.len]		= '\0';
	loc_legend92.arr[loc_legend92.len]		= '\0';
	loc_legend93.arr[loc_legend93.len]		= '\0';
	loc_legend94.arr[loc_legend94.len]		= '\0';
	loc_legend95.arr[loc_legend95.len]		= '\0';
	loc_legend96.arr[loc_legend96.len]		= '\0';
	loc_legend97.arr[loc_legend97.len]		= '\0';
	loc_legend98.arr[loc_legend98.len]		= '\0';
	loc_legend99.arr[loc_legend99.len]		= '\0';
	loc_legend100.arr[loc_legend100.len]	= '\0';
	loc_legend101.arr[loc_legend101.len]	= '\0';
	loc_legend102.arr[loc_legend102.len]	= '\0';
	loc_legend103.arr[loc_legend103.len]	= '\0';
	loc_legend104.arr[loc_legend104.len]	= '\0';
	loc_legend105.arr[loc_legend105.len]	= '\0';
	loc_legend106.arr[loc_legend106.len]	= '\0';
	loc_legend107.arr[loc_legend107.len]	= '\0';
	loc_legend108.arr[loc_legend108.len]	= '\0';
	loc_legend109.arr[loc_legend109.len]	= '\0';
	loc_legend1100.arr[loc_legend1100.len]	= '\0';
	loc_legend680.arr[loc_legend680.len]	= '\0';	
	loc_legend690.arr[loc_legend690.len]	= '\0';	
	loc_legend700.arr[loc_legend700.len]	= '\0';
	loc_legend701.arr[loc_legend701.len]	= '\0';
	loc_legend1110.arr[loc_legend1110.len]	= '\0';
	loc_legend1120.arr[loc_legend1120.len]	= '\0';
	loc_legend1130.arr[loc_legend1130.len]	= '\0';
	loc_legend1140.arr[loc_legend1140.len]	= '\0';
	loc_legend1160.arr[loc_legend1160.len]	= '\0';
	loc_legend1220.arr[loc_legend1220.len]	= '\0';
	loc_legend1230.arr[loc_legend1230.len]	= '\0';
	loc_legend110.arr[loc_legend110.len]	= '\0';	
	loc_legend120.arr[loc_legend120.len]	= '\0';
	loc_legend210.arr[loc_legend210.len]	= '\0';	
	loc_legend1300.arr[loc_legend1300.len]	= '\0';	
	loc_legend1310.arr[loc_legend1310.len]	= '\0';	
	loc_legend1320.arr[loc_legend1320.len]	= '\0';	
	loc_legend1330.arr[loc_legend1330.len]	= '\0';	
	loc_legend1340.arr[loc_legend1340.len]	= '\0';	
	loc_legend1350.arr[loc_legend1350.len]	= '\0';
	loc_legend1360.arr[loc_legend1360.len]	= '\0';
	loc_legend1370.arr[loc_legend1370.len]	= '\0';
	loc_legend1380.arr[loc_legend1380.len]	= '\0';
	loc_legend1390.arr[loc_legend1390.len]	= '\0';
	loc_legend1400.arr[loc_legend1400.len]	= '\0';
	loc_legend1401.arr[loc_legend1401.len]  = '\0';
	loc_legend1260.arr[loc_legend1260.len]	= '\0';
	loc_legend1270.arr[loc_legend1270.len]	= '\0';
	loc_legend1280.arr[loc_legend1280.len]	= '\0';
	loc_legend1290.arr[loc_legend1290.len]	= '\0';
	loc_legend1407.arr[loc_legend1407.len]	= '\0';
	loc_legend1411.arr[loc_legend1411.len]	= '\0';
	loc_legend1412.arr[loc_legend1412.len]	= '\0';
	loc_legend1413.arr[loc_legend1413.len]	= '\0';
	loc_legend1414.arr[loc_legend1414.len]	= '\0';
	loc_legend1444.arr[loc_legend1444.len]	= '\0';
	loc_legend1445.arr[loc_legend1445.len]  = '\0';
	loc_legend1446.arr[loc_legend1446.len]	= '\0';
    loc_legend1447.arr[loc_legend1447.len]	= '\0';
	loc_legend1448.arr[loc_legend1448.len]	= '\0';
	loc_legend1449.arr[loc_legend1449.len]	= '\0';
	loc_legend1450.arr[loc_legend1450.len]	= '\0';
	loc_legend1451.arr[loc_legend1451.len]	= '\0';
	loc_legend1452.arr[loc_legend1452.len]	= '\0';
	loc_legend1453.arr[loc_legend1453.len]	= '\0';
	loc_legend1454.arr[loc_legend1454.len]	= '\0';
	loc_legend1455.arr[loc_legend1455.len]	= '\0';
	loc_legend1456.arr[loc_legend1456.len]	= '\0';
	loc_legend1457.arr[loc_legend1457.len]	= '\0';
	loc_legend1458.arr[loc_legend1458.len]	= '\0';
	loc_legend1459.arr[loc_legend1459.len]  = '\0';
	loc_legend1460.arr[loc_legend1460.len]	= '\0';
	loc_legend1461.arr[loc_legend1461.len]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1462.arr[loc_legend1462.len]	= '\0';  //Added by raghava on 01/07/2010 for UAT
	loc_legend1415.arr[loc_legend1415.len]  = '\0';
	loc_legend1423.arr[loc_legend1423.len]	= '\0';
	loc_legend1424.arr[loc_legend1424.len]	= '\0';
	loc_legend1439.arr[loc_legend1439.len]	= '\0';
	loc_legend995.arr[loc_legend995.len]	= '\0';

	

}

/***** Amount Formatted Fucntions *****/
print_formated_amt(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",str_amt);		
        if (l_lsr==0 && l_dmp!= 0)
		{
		 if(d_recpt_refund_ind.arr[0]='F')
		 fprintf(fp,"%15.15s ",str_amt);
		 else
		 fprintf(fp,"%15.15s CR",str_amt);
		}
		else 
		fprintf(fp,"%15.15s CR",str_amt);
    }
    else 
	{
        if (l_lsr==0 && l_dmp!= 0) //CORRECTION_1
        {
		 if(loc_amount ==0)
		 {
		   fprintf(fp,"%15.15s","-"); 
		 }
		 else
		 {
		  put_val(s_amt,loc_amount);         
		  format_amt(s_amt);
		  sprintf(str_amt,"%15s",s_amt);
		  fprintf(fp,"%15.15s",str_amt);
		 }        
		}
		else
		{
		 put_val(s_amt,loc_amount);         
         format_amt(s_amt);
         sprintf(str_amt,"%15s",s_amt);
         fprintf(fp,"%15.15s",str_amt);
		}
     }
 
if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	 fprintf(fp," %s",cur_str.arr);

}                        
//This for printing Additional Charge Amt for payer Bill                      
print_formated_amt1(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%9.9s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",str_amt);		
        fprintf(fp,"%9.9sCR",str_amt);
        }
    else 
	{
        if (l_lsr==0 && l_dmp!= 0) //CORRECTION_2
		{
		  if(loc_amount==0)
		  fprintf(fp,"%9.9s  ","-");
		  else
		  {
		    put_val(s_amt,loc_amount);         
            format_amt(s_amt);
            sprintf(str_amt,"%9.9s",s_amt);
            fprintf(fp,"%9.9s  ",str_amt);
		  }
		}
		else
		{
		 put_val(s_amt,loc_amount);         
         format_amt(s_amt);
         sprintf(str_amt,"%9.9s",s_amt);
         fprintf(fp,"%9.9s  ",str_amt);
		}
     }

	 if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	 fprintf(fp," %s",cur_str.arr);

} 
print_formated_amt2(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%-s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%-s",str_amt);		
        fprintf(fp,"%-sCR ",str_amt);
        }
    else 
	{
        if (l_lsr==0 && l_dmp!= 0) //CORRECTION_3
		{
		 if(loc_amount==0)
		  fprintf(fp,"%-s ","-");
		 else
		 {
		  put_val(s_amt,loc_amount);         
          format_amt(s_amt);
          sprintf(str_amt,"%-s",s_amt);
          fprintf(fp,"%-s ",str_amt);
		 }
		}
		else
		{
		 put_val(s_amt,loc_amount);         
         format_amt(s_amt);
         sprintf(str_amt,"%-s",s_amt);
         fprintf(fp,"%-s ",str_amt);
		}
     }
 
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	{   
	    
		if (l_lsr!= 0 && l_dmp== 0)
		fprintf(fp,"%c(s3B",ESC);
		if (l_lsr==0 && l_dmp!= 0)
		fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
		fprintf(fp," %s",cur_str.arr);
		if (l_lsr!= 0 && l_dmp== 0)
		fprintf(fp,"%c(s-3B",ESC);
		if (l_lsr==0 && l_dmp!= 0)
		fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
        
	}

}
print_formated_amt3(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%-s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%-s",str_amt);		
        fprintf(fp,"%-sCR ",str_amt);
        }
    else 
	{
      
		 put_val(s_amt,loc_amount);         
         format_amt(s_amt);
         sprintf(str_amt,"%-s",s_amt);
         fprintf(fp,"%-s ",str_amt);
		
     }
 
	if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	{   
	    
		if (l_lsr!= 0 && l_dmp== 0)
		fprintf(fp,"%c(s3B",ESC);
		if (l_lsr==0 && l_dmp!= 0)
		fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
		fprintf(fp," %s",cur_str.arr);
		if (l_lsr!= 0 && l_dmp== 0)
		fprintf(fp,"%c(s-3B",ESC);
		if (l_lsr==0 && l_dmp!= 0)
		fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
        
	}

}
print_formated(loc_amount)
double loc_amount;
{
    char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);
		sprintf(str_amt,"%sCR",str_amt);
		return str_amt;
 
        }
    else 
	{
        if (l_lsr==0 && l_dmp!= 0) //CORRECTION_4
		{
		  if(loc_amount == 0)
		  return '-';
		  else
		  {
			 put_val(s_amt,loc_amount);         
			 format_amt(s_amt);
			 sprintf(str_amt,"%sDR",s_amt);
			 return str_amt;
		   }
		}
		else
		{
		 put_val(s_amt,loc_amount);         
         format_amt(s_amt);
         sprintf(str_amt,"%sDR",s_amt);
	     return str_amt;
		}
     }

	 if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	 fprintf(fp," %s",cur_str.arr);
}                        

print_next_page1()
{
	int i;
	
	while(v_lno <= MAX_LINES)
	{
		//fprintf(fp,"\n");//08/03/2010
		v_lno++;
	}	

	if (l_lsr != 0 && l_dmp == 0)
	{	 
		fprintf(fp,"\n\n");
	}
	else
	{
		fprintf(fp,"\n\n\n\n");
	}

	//fprintf(fp,"%-80.80s %s %d\n"," ",loc_legend21.arr,l_bill_page_no);
	//fprintf(fp,"%80.80s %d\n",loc_legend21.arr,l_bill_page_no);

	if ( l_logo_yniflaser.arr[0] != 'Y')
	{
	  fprintf(fp,""); /* To Eject Page */ 
	
	}
    fprintf(fp,"\n");

	if (l_lsr != 0 && l_dmp == 0 )
	{
		if ( l_logo_yniflaser.arr[0] == 'Y')
		{
			fprintf(fp,"\n\n");
		}
	}
	v_lno=0;
	print_recpt();
	//print_report_header();

}

ltrim(l_str)
char *l_str;
{
   char *ptr;
   ptr = l_str;
   while (*ptr== ' ') ptr++;
   for(;*ptr!='\0';ptr++,l_str++)
    *l_str = *ptr;
   *l_str = '\0';
}

rtrim(l_str)
char *l_str;
{
  while (*l_str != '\0') *l_str++;
  l_str--;
  while (*l_str == ' ') *l_str--;
  *(l_str+1) = '\0';
}


get_bill_address()
{
	l_bill_contact_name.arr[0] = '\0';
	l_bill_contact_name.len = 0;

	l_bill_contact_name_title.arr[0] = '\0';
	l_bill_contact_name_title.len = 0;

	l_bill_long_desc.arr[0] = '\0';
	l_bill_long_desc.len = 0;

	l_bill_add1_desc.arr[0] = '\0';
	l_bill_add1_desc.len = 0;

	l_bill_add2_desc.arr[0] = '\0';
	l_bill_add2_desc.len = 0;

	l_bill_add3_desc.arr[0] = '\0';
	l_bill_add3_desc.len = 0;
	
	if(strcmp(d_bill_nature_code.arr,"A")==0)
	{
		EXEC SQL SELECT substr(contact_name,1,19),
						substr(contact_name_title,1,20),
						substr(long_name,1,40),
						substr(add1_desc,1,40),
						substr(add2_desc,1,40),
						substr(add3_desc,1,40)						
				   INTO :l_bill_contact_name,
						:l_bill_contact_name_title,
						:l_bill_long_desc,
						:l_bill_add1_desc,
						:l_bill_add2_desc,
						:l_bill_add3_desc
				   FROM ar_customer_lang_vw
				  WHERE cust_code = :dc_cust_code
				  AND   language_id=:nd_lang_id;

			   if (OERROR)
					err_mesg("SELECT failed on table AR_CUSTOMER",0,"");

	}
	else if(strcmp(d_bill_nature_code.arr,"C")==0)
	{
		EXEC SQL SELECT substr(mail_contact_name,1,19),
						substr(mail_postal_code,1,20),
						substr(ln1_mail_add,1,40),
						substr(ln2_mail_add,1,40),
						substr(ln3_mail_add,1,40),
						substr(mail_country_code,1,40)						
				   INTO :l_bill_contact_name,
						:l_bill_contact_name_title,
						:l_bill_long_desc,
						:l_bill_add1_desc,
						:l_bill_add2_desc,
						:l_bill_add3_desc
				   FROM mp_pat_other_dtls
				  WHERE patient_id = :d_patient_id;

			   if (OERROR)
					err_mesg("SELECT failed on table MP_PAT_OTHER_DTLS",0,"");
	}

	l_bill_contact_name.arr[l_bill_contact_name.len] = '\0';
	l_bill_contact_name_title.arr[l_bill_contact_name_title.len] = '\0';
	l_bill_long_desc.arr[l_bill_long_desc.len] = '\0';
	l_bill_add1_desc.arr[l_bill_add1_desc.len] = '\0';
	l_bill_add2_desc.arr[l_bill_add2_desc.len] = '\0';
	l_bill_add3_desc.arr[l_bill_add3_desc.len] = '\0';

	if(l_bill_add3_desc.len > 0)
	{
		l_bill_add3_desc_temp.arr[0] = '\0';
		l_bill_add3_desc_temp.len = 0;		

		EXEC SQL SELECT long_name
				   INTO :l_bill_add3_desc_temp
				   FROM mp_country_lang_vw
				  WHERE country_code = :l_bill_add3_desc
				  AND   language_id  = :nd_lang_id; 

		l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

		if((strcmp(l_bill_add3_desc_temp.arr,l_bill_add3_desc.arr)!=0) && (l_bill_add3_desc_temp.len > 0))
		{
			strcpy(l_bill_add3_desc.arr,l_bill_add3_desc_temp.arr);
			l_bill_add3_desc.len = strlen(l_bill_add3_desc.arr);
		}
	}
}


get_print_group_hd_desc3()
{

nd_prt_hd_desc.arr[0] = '\0';
nd_prt_hd_desc.len=0;

EXEC SQL  SELECT SHORT_DESC into :nd_prt_hd_desc 
          FROM   BL_BLNG_PRT_GRP_HDR_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE=:d_prt_grp_hdr_code
		  AND    LANGUAGE_ID     =:nd_lang_id;   


nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

 if (OERROR)
  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");

}


get_print_group_line_desc3()
{
	nd_prt_line_desc.arr[0] = '\0';
	nd_prt_line_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_line_desc SIUAT
	EXEC SQL  SELECT SHORT_DESC into :nd_prt_line_desc 
          FROM BL_BLNG_PRT_GRP_LINE_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE=:d_prt_grp_hdr_code
		  AND PRT_GRP_LINE_CODE  =:d_prt_grp_line_code
		  AND LANGUAGE_ID        =:nd_lang_id;   


nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

 if (OERROR)
  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");


}

get_print_group_hd_desc2()
{
	nd_prt_hd_desc.arr[0] = '\0';
	nd_prt_hd_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_hd_desc SIUAT
      EXEC SQL  SELECT SHORT_DESC into :nd_prt_hd_desc 
	      FROM BL_BLNG_PRT_GRP_HDR_LANG_VW
		  WHERE PRT_GRP_HDR_CODE =:nd_prt_grp_hdr_code
		  AND LANGUAGE_ID        =:nd_lang_id; 


	nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

  if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");

    //strcpy(nd_ref_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr);
    strcpy(nd_ref_prt_grp_line_code.arr,nd_prt_grp_line_code.arr);
 
}

get_print_group_line_desc2()
{
	nd_prt_line_desc.arr[0] = '\0';
	nd_prt_line_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_line_desc SIUAT 
      EXEC SQL  SELECT SHORT_DESC into :nd_prt_line_desc 
	      FROM BL_BLNG_PRT_GRP_LINE_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE   =:nd_prt_grp_hdr_code
		  AND    PRT_GRP_LINE_CODE  =:nd_prt_grp_line_code
		  AND    LANGUAGE_ID        =:nd_lang_id; 

	nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

   if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");

}


get_print_group_hd_desc()
{
	nd_prt_hd_desc.arr[0] = '\0';
	nd_prt_hd_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_hd_desc //SIUAT
      EXEC SQL  SELECT SHORT_DESC into :nd_prt_hd_desc 
	      FROM BL_BLNG_PRT_GRP_HDR_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE   =:d1_prt_grp_hdr_code
		  AND    LANGUAGE_ID        =:nd_lang_id;


	nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

    if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");

}

get_print_group_hd_desc1()
{
	nd_prt_hd_desc.arr[0] = '\0';
	nd_prt_hd_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_hd_desc 
      EXEC SQL  SELECT SHORT_DESC into :nd_prt_hd_desc   //SIUAT
	      FROM   BL_BLNG_PRT_GRP_HDR_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE   =:nd1_prt_grp_hdr_code
		  AND    LANGUAGE_ID        =:nd_lang_id;

	nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

    if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");

}

get_print_group_line_desc()
{
	nd_prt_line_desc.arr[0] = '\0';
	nd_prt_line_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_line_desc SIUAT
	EXEC SQL  SELECT SHORT_DESC into :nd_prt_line_desc 
          FROM   BL_BLNG_PRT_GRP_LINE_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE   =:d1_prt_grp_hdr_code
		  AND    PRT_GRP_LINE_CODE  =:d1_prt_grp_line_code
		  AND    LANGUAGE_ID        =:nd_lang_id;

	nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

    if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");

}


get_print_group_line_desc1()
{
	nd_prt_line_desc.arr[0] = '\0';
	nd_prt_line_desc.len=0;

	//EXEC SQL  SELECT substr(SHORT_DESC,1,20) into :nd_prt_line_desc 
      EXEC SQL  SELECT SHORT_DESC into :nd_prt_line_desc 
	      FROM   BL_BLNG_PRT_GRP_LINE_LANG_VW
		  WHERE  PRT_GRP_HDR_CODE =:nd1_prt_grp_hdr_code
		  AND    PRT_GRP_LINE_CODE=:nd1_prt_grp_line_code
          AND    LANGUAGE_ID      =:nd_lang_id;

	nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

	if (OERROR)
	  err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");

}

get_blng_serv_desc()
{


    nd_blng_desc.arr[0] = '\0';
	nd_blng_desc.len=0;
	nd_mapping_code_desc.arr[0] = '\0';
	nd_mapping_code_desc.len =0;
	
	if(d_summary_dtl_ind.arr[2]=='A')
	{
	  
	  EXEC SQL  SELECT b.MAPPING_CODE,substr(a.LONG_DESC,1,27)
			  INTO :d_mapping_code,nd_mapping_code_desc	
			  FROM BL_SERV_MAPPING_CODE a, BL_ITEMS_FOR_MAPPING_CODE b
			  WHERE a.OPERATING_FACILITY_ID= b.OPERATING_FACILITY_Id
			  AND a.MAPPING_CODE_IND       = b.MAPPING_CODE_IND
			  AND a.MAPPING_CODE           = b.MAPPING_CODE
			  AND a.MAPPING_CODE_IND	   = :d_mapping_code_ind
    		  AND b.ITEM_CODE=DECODE(:d_mapping_code_ind,'S',:d_blng_serv_code,:d_serv_item_code);

		
		if (OERROR)
	    err_mesg("SELECT failed on table BL_MAPPING_CODE",0,"");
		
		if(NODATAFOUND)
		{
		 
	
		 strcpy(d_mapping_code.arr," ");

		 EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_mapping_code_desc 
			  FROM   BL_BLNG_SERV_LANG_VW
			  WHERE  blng_serv_code   =:d_blng_serv_code
			  AND    LANGUAGE_ID      =:nd_lang_id;
		 
		}
	    
		/** the below code added for SCF-7043 **/
		if(d_mapping_code_ind.arr[0]=='S')
		{
		 
		 EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_mapping_code_desc 
			  FROM   BL_BLNG_SERV_LANG_VW
			  WHERE  blng_serv_code   =:d_blng_serv_code
			  AND    LANGUAGE_ID      =:nd_lang_id;
		}
		d_mapping_code.arr[d_mapping_code.len]			   = '\0';
		nd_mapping_code_desc.arr[nd_mapping_code_desc.len] = '\0';
	    

	}
	else
	{
		if(strcmp(d_serv_item_desc.arr,"X")==0)
		{
		

			EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_blng_desc 
				  FROM   BL_BLNG_SERV_LANG_VW
				  WHERE  blng_serv_code=:d_blng_serv_code
				  AND    LANGUAGE_ID   =:nd_lang_id;

			nd_blng_desc.arr[nd_blng_desc.len] = '\0';
		}
		else
		{
		  //strcpy(nd_blng_desc.arr,d_serv_item_desc.arr);
		  EXEC SQL SELECT :d_serv_item_desc INTO :nd_blng_desc1 FROM DUAL;
		  nd_blng_desc.arr[nd_blng_desc.len] = '\0';
		}
		if (OERROR)
			 err_mesg("SELECT failed on table BL_BLNG_SERV",0,"");
	}



}

get_blng_serv_desc1()
{
 

	nd_blng_desc1.arr[0] = '\0';
	nd_blng_desc1.len=0;
	nd1_mapping_code_desc.arr[0] = '\0';
	nd1_mapping_code_desc.len =0;
		
	if(d1_summary_dtl_ind.arr[2]=='A')
	{
	  
	 
	  EXEC SQL  SELECT b.MAPPING_CODE,substr(a.LONG_DESC,1,27)
			    INTO :d1_mapping_code,nd1_mapping_code_desc	
			    FROM BL_SERV_MAPPING_CODE a, BL_ITEMS_FOR_MAPPING_CODE b
			    WHERE a.OPERATING_FACILITY_ID= b.OPERATING_FACILITY_Id
			    AND a.MAPPING_CODE_IND       = b.MAPPING_CODE_IND
			    AND a.MAPPING_CODE           = b.MAPPING_CODE
			    AND a.MAPPING_CODE_IND	   = :d1_mapping_code_ind
    		    AND b.ITEM_CODE=DECODE(:d1_mapping_code_ind,'S',:d1_blng_serv_code,:d1_serv_item_code);

		
		if (OERROR)
	    err_mesg("SELECT failed on table BL_MAPPING_CODE",0,"");

			
		if(NODATAFOUND)
		{
		 
		 strcpy(d1_mapping_code.arr," ");

		 EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd1_mapping_code_desc 
			  FROM   BL_BLNG_SERV_LANG_VW
			  WHERE  blng_serv_code   =:d1_blng_serv_code
			  AND    LANGUAGE_ID      =:nd_lang_id;
		 
		}
	   /** the below code added for SCF-7043 **/
	   if(d1_mapping_code_ind.arr[0]=='S')
	   {
		EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd1_mapping_code_desc 
				  FROM   BL_BLNG_SERV_LANG_VW
				  WHERE  blng_serv_code   =:d1_blng_serv_code
				  AND    LANGUAGE_ID      =:nd_lang_id;
	   }
	   
	    d1_mapping_code.arr[d1_mapping_code.len]			 = '\0';
		nd1_mapping_code_desc.arr[nd1_mapping_code_desc.len] = '\0';
	    

	}
    else
	{
	    
		if(strcmp(d1_serv_item_desc.arr,"X")==0)
	    {
	
			EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_blng_desc1 
				  FROM   BL_BLNG_SERV_LANG_VW
				  WHERE  blng_serv_code   =:d1_blng_serv_code
				  AND    LANGUAGE_ID      =:nd_lang_id;

		 	nd_blng_desc1.arr[nd_blng_desc1.len] = '\0';
		}
		else
		{
		  EXEC SQL SELECT :d1_serv_item_desc INTO :nd_blng_desc1 FROM DUAL;
		  //strcpy(nd_blng_desc1.arr,d1_serv_item_desc.arr);
		  nd_blng_desc1.arr[nd_blng_desc1.len] = '\0';
		}
		if (OERROR)
	    err_mesg("SELECT failed on table BL_BLNG_SERV",0,"");
	
	


	}

}
get_blng_classification_desc()
{

	nd_blng_class_desc.arr[0] = '\0';
	nd_blng_class_desc.len	  =   0;

	EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_blng_class_desc 
          FROM   BL_SERV_CLASSIFICATION_LANG_VW
		  WHERE  SERV_CLASSIFICATION_CODE   =:d_serv_class_code
		  AND    LANGUAGE_ID				=:nd_lang_id;

	nd_blng_class_desc.arr[nd_blng_class_desc.len] = '\0';

	if (OERROR)
	  err_mesg("SELECT failed on table BL_SERV_CLASSIFICATION_LANG_VW",0,"");

}

get_blng_classification_desc1()
{

	nd_blng_class_desc1.arr[0] = '\0';
	nd_blng_class_desc1.len	   =   0;

	EXEC SQL  SELECT substr(SHORT_DESC,1,27) into :nd_blng_class_desc1 
          FROM   BL_SERV_CLASSIFICATION_LANG_VW
		  WHERE  SERV_CLASSIFICATION_CODE   =:d1_serv_class_code
		  AND    LANGUAGE_ID				=:nd_lang_id;

	nd_blng_class_desc1.arr[nd_blng_class_desc1.len] = '\0';

	if (OERROR)
	  err_mesg("SELECT failed on table BL_SERV_CLASSIFICATION_LANG_VW",0,"");

}
get_bill_address_lsr()
{   
    int cnt1 = 0;

	l_bill_contact_name_p.arr[0] = '\0';
	l_bill_contact_name_p.len = 0;

	l_bill_contact_name_title_p.arr[0] = '\0';
	l_bill_contact_name_title_p.len = 0;

	l_bill_long_desc_p.arr[0] = '\0';
	l_bill_long_desc_p.len = 0;

	l_bill_add1_desc_p.arr[0] = '\0';
	l_bill_add1_desc_p.len = 0;

	l_bill_add2_desc_p.arr[0] = '\0';
	l_bill_add2_desc_p.len = 0;

	l_bill_add3_desc_p.arr[0] = '\0';
	l_bill_add3_desc_p.len = 0;


	l_bill_contact_name_c.arr[0] = '\0';
	l_bill_contact_name_c.len = 0;

	l_bill_contact_name_title_c.arr[0] = '\0';
	l_bill_contact_name_title_c.len = 0;

	l_bill_long_desc_c.arr[0] = '\0';
	l_bill_long_desc_c.len = 0;

	l_bill_add1_desc_c.arr[0] = '\0';
	l_bill_add1_desc_c.len = 0;

	l_bill_add2_desc_c.arr[0] = '\0';
	l_bill_add2_desc_c.len = 0;

	l_bill_add3_desc_c.arr[0] = '\0';
	l_bill_add3_desc_c.len = 0;


	l_line1.arr[0] = '\0';
	l_line2.arr[0] = '\0';
	l_line3.arr[0] = '\0';
	l_line4.arr[0] = '\0';
	l_line5.arr[0] = '\0';
	l_line6.arr[0] = '\0';

	l_line1.len = 0;
	l_line2.len = 0;
	l_line3.len = 0;
	l_line4.len = 0;
	l_line5.len = 0;
	l_line6.len = 0;
	
	if(strcmp(d_bill_nature_code.arr,"A")==0)
	{
		EXEC SQL SELECT	contact_name,
					    contact_name_title,
						long_name,
						add1_desc,
						add2_desc,
						add3_desc
				   INTO 
						/*:l_bill_contact_name_c,
						:l_bill_contact_name_title_c,
						:l_bill_long_desc_c,
						:l_bill_add1_desc_c,
						:l_bill_add2_desc_c,
						:l_bill_add3_desc_c*/
					:l_line1,
					:l_line2,
					:l_line3,
					:l_line4,
					:l_line5,
					:l_line6
				   FROM ar_customer_lang_vw
				   WHERE cust_code        =:dc_cust_code
				   AND  language_id       =:nd_lang_id;   

			   if (OERROR)
					err_mesg("SELECT failed on table AR_CUSTOMER",0,"");

	l_line1.arr[l_line1.len] = '\0';
	l_line2.arr[l_line2.len] = '\0';
	l_line3.arr[l_line3.len] = '\0';
	l_line4.arr[l_line4.len] = '\0';
	l_line5.arr[l_line5.len] = '\0';
	l_line6.arr[l_line6.len] = '\0';

	if(l_line6.len > 0)
		{
			l_bill_add3_desc_temp.arr[0] = '\0';
			l_bill_add3_desc_temp.len = 0;

			EXEC SQL SELECT long_name
				 INTO :l_bill_add3_desc_temp
				 FROM  mp_country_lang_vw
				 WHERE country_code = :l_line6
				 AND  language_id       =:nd_lang_id;

			l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

			if((strcmp(l_bill_add3_desc_temp.arr,l_line6.arr)!=0)
				&& (l_bill_add3_desc_temp.len > 0))
			{
				strcpy(l_line6.arr,l_bill_add3_desc_temp.arr);
				l_line6.len = strlen(l_line6.arr);
			}
		}
	
	if (l_line1.arr[0] != '\0')
	{
		cnt1 = cnt1+1;
		strcpy(l_bill_contact_name_c.arr,l_line1.arr);
	}

	if (l_line2.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line2.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line2.arr);	
		}
	}

	if (l_line3.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line3.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line3.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line3.arr);	
		}
	}

	if (l_line4.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line4.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line4.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line4.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line4.arr);	
		}
	}

	if (l_line5.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line5.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line5.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line5.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line5.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_c.arr,l_line5.arr);	
		}
	}

	if (l_line6.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line6.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line6.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line6.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line6.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_c.arr,l_line6.arr);	
		}

		else if (cnt1 == 5)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add3_desc_c.arr,l_line6.arr);	
		}
	}
	
	l_bill_contact_name_c.len = strlen(l_bill_contact_name_c.arr);
	l_bill_contact_name_title_c.len = strlen(l_bill_contact_name_title_c.arr);
	l_bill_long_desc_c.len = strlen(l_bill_long_desc_c.arr);
	l_bill_add1_desc_c.len = strlen(l_bill_add1_desc_c.arr);
	l_bill_add2_desc_c.len = strlen(l_bill_add2_desc_c.arr);
	l_bill_add3_desc_c.len = strlen(l_bill_add3_desc_c.arr);
	
	l_bill_contact_name_c.arr[l_bill_contact_name_c.len] = '\0';
	l_bill_contact_name_title_c.arr[l_bill_contact_name_title_c.len] = '\0';
	l_bill_long_desc_c.arr[l_bill_long_desc_c.len] = '\0';
	l_bill_add1_desc_c.arr[l_bill_add1_desc_c.len] = '\0';
	l_bill_add2_desc_c.arr[l_bill_add2_desc_c.len] = '\0';
	l_bill_add3_desc_c.arr[l_bill_add3_desc_c.len] = '\0';


	}

	cnt1 = 0;

	l_line1.arr[0] = '\0';
	l_line2.arr[0] = '\0';
	l_line3.arr[0] = '\0';
	l_line4.arr[0] = '\0';
	l_line5.arr[0] = '\0';
	l_line6.arr[0] = '\0';	

	l_line1.len = 0;
	l_line2.len = 0;
	l_line3.len = 0;
	l_line4.len = 0;
	l_line5.len = 0;
	l_line6.len = 0;	

	
	EXEC SQL SELECT		mail_contact_name,								
						ln1_mail_add,
						ln2_mail_add,
						ln3_mail_add,
						mail_postal_code,
						mail_country_code
			   INTO 
						:l_line1,
						:l_line2,
						:l_line3,
						:l_line4,
						:l_line5,
						:l_line6
			   FROM mp_pat_other_dtls
			   WHERE patient_id = :d_patient_id;

			   if (OERROR)
				  err_mesg("SELECT failed on table MP_PAT_OTHER_DTLS",0,"");

	l_line1.arr[l_line1.len] = '\0';
	l_line2.arr[l_line2.len] = '\0';
	l_line3.arr[l_line3.len] = '\0';
	l_line4.arr[l_line4.len] = '\0';
	l_line5.arr[l_line5.len] = '\0';
	l_line6.arr[l_line6.len] = '\0';		

	if (l_line5.arr[0] != '\0' && loc_legend63.arr[0] != '\0')
	{
		strcat(loc_legend63.arr," ");		
		strcat(loc_legend63.arr,l_line5.arr);		

		l_line5.arr[0] = '\0';
		l_line5.len = 0;
		strcpy(l_line5.arr,loc_legend63.arr);
		l_line5.len = strlen(l_line5.arr);

	}

	if(l_line6.len > 0)   // country code
	{
		l_bill_add3_desc_temp.arr[0] = '\0';
		l_bill_add3_desc_temp.len = 0;

		EXEC SQL SELECT long_name
			 INTO :l_bill_add3_desc_temp
			 FROM mp_country_lang_vw
			 WHERE country_code =:l_line6
			 AND language_id    =:nd_lang_id;  

		l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

		if((strcmp(l_bill_add3_desc_temp.arr,l_line6.arr)!=0)
			&& (l_bill_add3_desc_temp.len > 0))
		{
			strcpy(l_line6.arr,l_bill_add3_desc_temp.arr);
			l_line6.len = strlen(l_line6.arr);
		}
	}

	if (l_line1.arr[0] != '\0')
	{
		cnt1 = cnt1+1;
		strcpy(l_bill_contact_name_p.arr,l_line1.arr);
	}

	if (l_line2.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line2.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line2.arr);	
		}
	}

	if (l_line3.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line3.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line3.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line3.arr);	
		}
	}

	if (l_line4.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line4.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line4.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line4.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line4.arr);	
		}
	}

	if (l_line5.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line5.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line5.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line5.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line5.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_p.arr,l_line5.arr);	
		}
	}

	if (l_line6.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line6.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line6.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line6.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line6.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_p.arr,l_line6.arr);	
		}

		else if (cnt1 == 5)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add3_desc_p.arr,l_line6.arr);	
		}
	}
	
	
	l_bill_contact_name_p.len = strlen(l_bill_contact_name_p.arr);
	l_bill_contact_name_title_p.len = strlen(l_bill_contact_name_title_p.arr);
	l_bill_long_desc_p.len = strlen(l_bill_long_desc_p.arr);
	l_bill_add1_desc_p.len = strlen(l_bill_add1_desc_p.arr);
	l_bill_add2_desc_p.len = strlen(l_bill_add2_desc_p.arr);
	l_bill_add3_desc_p.len = strlen(l_bill_add3_desc_p.arr);

	l_bill_contact_name_p.arr[l_bill_contact_name_p.len] = '\0';
	l_bill_contact_name_title_p.arr[l_bill_contact_name_title_p.len] = '\0';
	l_bill_long_desc_p.arr[l_bill_long_desc_p.len] = '\0';
	l_bill_add1_desc_p.arr[l_bill_add1_desc_p.len] = '\0';
	l_bill_add2_desc_p.arr[l_bill_add2_desc_p.len] = '\0';
	l_bill_add3_desc_p.arr[l_bill_add3_desc_p.len] = '\0';
		
}

print_formated_amt_varstr(loc_amount_varstr,loc_amount)
char loc_amount_varstr[100];
double loc_amount;
{
    char s_amt[30], str_amt[30], fstr_amt[30];    

    if(loc_amount < 0)
	{
        put_val(loc_amount_varstr,-loc_amount);        
        format_amt(loc_amount_varstr);                
		ltrim (loc_amount_varstr);		
		rtrim (loc_amount_varstr);		
		strcpy(fstr_amt,"(-)");
		strcat(fstr_amt,loc_amount_varstr);		
		ltrim (fstr_amt);		
		rtrim (fstr_amt);
		sprintf(loc_amount_varstr,"%s",fstr_amt);		  
     }
    else 
	{
        put_val(loc_amount_varstr,loc_amount);         	
		format_amt(loc_amount_varstr);		
		ltrim (loc_amount_varstr);		
		rtrim (loc_amount_varstr);		
     }

}                        
/*** Amount Formatted Function ****/
print_formated_amt_total(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",fstr_amt);	
        fprintf(fp,"%15.15s CR",str_amt);
    }
    else if(loc_amount > 0)
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%15s",s_amt);
        fprintf(fp,"%15.15s DR",str_amt);
    }
	else if(loc_amount==0)
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%15.15s",s_amt);
        fprintf(fp,"%15.15s",str_amt);
	 }

	 if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
	 fprintf(fp," %s",cur_str.arr);

}

print_cust_header()
{
	get_discount_count();

	if (ccnt==1)
	{
		fetch_cust_cur();
		if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
		{
			if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend84.arr);
			else
			fprintf(fp," \n%-25.25s %-20s %18s ",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr);
		lsr_line_cnt();
		}

		if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
		{
		fprintf(fp," \n%-25.25s %-20s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr);
		lsr_line_cnt();
		}
		if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
		{
			if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp," \n%-25.25s %-20s %18s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend84.arr,loc_legend69.arr);
			else
			fprintf(fp," \n%-25.25s %-20s %18s  %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend69.arr);
		lsr_line_cnt();
		}

		if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
		{
		fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend70.arr,loc_legend68.arr,loc_legend69.arr);
		lsr_line_cnt();
		}
		fprintf(fp,"\n");
		lsr_line_cnt();
		if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		if( strcmp(c_print_separator_line.arr,"N")!=0)
		prt_line_uc();

		if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
		if( strcmp(c_print_separator_line.arr,"N")!=0)
		prt_line_uc_wide();

	}
  }


get_column_count_cust()
{
	if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
	lcol_cnt =1;

	if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
	lcol_cnt =1;

	if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
	lcol_cnt =2;

	if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
	lcol_cnt =1;
	}

get_column_count_pat()
{
	
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	lcol_cnt =1;

	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	lcol_cnt =2;

	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)  
	lcol_cnt =1;
    
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)  
	lcol_cnt =1;

	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	lcol_cnt =2;

	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	lcol_cnt =1;

	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	lcol_cnt =3;

	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	lcol_cnt =2;

	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
    lcol_cnt =2;

	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
	lcol_cnt =2;

	if (strcmp(c_bill_net_payable_ind.arr,"R")==0  &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
    lcol_cnt =2;

	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
    lcol_cnt =3;

	if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
    lcol_cnt =3;
	
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
    lcol_cnt =3;

}

get_legends_cnt()
{

	if( (strcmp(c_gross_net_amt_ind.arr,"X")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || 
	    strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) ||
		(strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
      )
   	    
	legend_cnt=1;
	else
	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
	legend_cnt=2;
	else
	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"N")==0) 
	legend_cnt=3;
    else
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
	legend_cnt=4;
    else
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
	legend_cnt=5;
	else
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
	legend_cnt=6;
	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0  &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	legend_cnt=7;
	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	legend_cnt=8;
	else	
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	legend_cnt=9;
	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	legend_cnt=10;

    /*sprintf(temp,"%d",legend_cnt);
	disp_message(ERR_MESG,temp);*/
}

print_header_legeds()
{
     

      get_discount_count();
	  get_addlcharge_count();
	  
	   if (l_lsr!= 0 && l_dmp== 0) 
	   print_bold();
	   if (l_lsr== 0 && l_dmp!= 0)
	   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/

	   if(strcmp(nd_preprint_flag.arr,"N")==0)
		{
		//if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		//fprintf(fp,"%-34s      %17s  %17s",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);

		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
		fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr," "," "," ");
		//fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr," "," "," ");
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
		{
		 //disp_message(ERR_MESG,"1");
		 if(strcmp(d_bill_format.arr,"B")== 0 && d_recpt_refund_ind.arr[0]=='F')
		 //fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend100.arr," "," ");
		 fprintf(fp,"%-10.10s%-24.24s %21.21s(%s) %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend100.arr,cur_str.arr," "," ");
		 //fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend100.arr," "," ");
		 else
		 fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend69.arr," "," ");
		 //fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend69.arr," "," ");
	    }

		if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0
		&& strcmp(c_addl_charge_amt_ind.arr,"C")!=0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0)
		fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr," ");
		//fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr," ");
	   
		if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0
		&& strcmp(c_addl_charge_amt_ind.arr,"C")==0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0)
		{
			if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
			fprintf(fp,"%-10.10s%-24.24s %15.15s%17.17s  %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend1230.arr,loc_legend68.arr,loc_legend69.arr," ");
			//fprintf(fp,"%-34.34s %15.15s%17.17s  %17.17s  %17.17s ",loc_legend110.arr,loc_legend1230.arr,loc_legend68.arr,loc_legend69.arr," ");
			else
			fprintf(fp,"%-10.10s%-24.24s %15.15s%  %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr," ");
			//fprintf(fp,"%-34.34s %15.15s%  %17.17s  %17.17s ",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr," ");
		}
	    
		if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0
		   && strcmp(c_bill_net_payable_ind.arr,"R")==0) 
		 {
			if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr);
			//fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr);
			else
			fprintf(fp,"%-10.10s%-24.24s %21.21s   %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr);
			//fprintf(fp,"%-34.34s %21.21s   %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr);
		}
		
		if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0
		   && strcmp(c_bill_net_payable_ind.arr,"R")!=0) 
		 {
			if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend69.arr);
			//fprintf(fp,"%-34.34s %21.21s %17.17s %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend69.arr);
			else
			fprintf(fp,"%-10.10s%-24.24s %21.21s  %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend69.arr);
			//fprintf(fp,"%-34.34s %21.21s  %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend69.arr);
		}
		
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
		 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0 && strcmp(c_addl_charge_amt_ind.arr,"C")==0) 
		 {
			if((l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 ))
			fprintf(fp,"%-10.10s%-24.24s %15.15s%17.17s  %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend1230.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %15.15s%17.17s  %17.17s  %17.17s ",loc_legend110.arr,loc_legend1230.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
			else
			fprintf(fp,"%-10.10s%-24.24s %17.17s  %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %17.17s  %17.17s  %17.17s ",loc_legend110.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
		}
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) 
		&& strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0 && strcmp(c_addl_charge_amt_ind.arr,"C")!=0) 
		fprintf(fp,"%-10.10s%-24.24s %21.21s  %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
		//fprintf(fp,"%-34.34s %21.21s  %17.17s  %17.17s ",loc_legend110.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
	
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		{
		 if (l_lsr!= 0 && l_dmp== 0)
		 fprintf(fp,"%-10.10s%-24.24s      %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		 //fprintf(fp,"%-34.34s      %17.17s  %17.17s",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		 /** The below code added by raghava for walk-thru issue for siriraj **/
		 if (l_lsr== 0 && l_dmp!= 0)
		 fprintf(fp,"%-10.10s%-24.24s      %17.17s  %-40.40s"," ",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
		 //fprintf(fp,"%-34.34s      %17.17s  %-40.40s",loc_legend110.arr,loc_legend82.arr,loc_legend83.arr);
        }	
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"N")==0) 
		fprintf(fp,"%-10.10s%-24.24s      %17.17s  "," ",loc_legend110.arr,loc_legend82.arr);
		//fprintf(fp,"%-34.34s      %17.17s  ",loc_legend110.arr,loc_legend82.arr);
		else
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s %17.17s  %17.17s "," ",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
		//fprintf(fp,"%-34.34s %21.21s %17.17s %17.17s  %17.17s ",loc_legend110.arr,loc_legend68.arr,loc_legend69.arr,loc_legend82.arr,loc_legend83.arr);
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
		fprintf(fp,"%-10.10s%-24.24s     %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr);
		//fprintf(fp,"%-34.34s     %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr);
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		fprintf(fp,"%-10.10s%-24.24s     %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend83.arr," ");
		//fprintf(fp,"%-34.34s     %17.17s  %17.17s",loc_legend110.arr,loc_legend83.arr," ");
		else
		if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
		fprintf(fp,"%-10.10s%-24.24s     %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend82.arr," ");
		//fprintf(fp,"%-34.34s     %17.17s  %17.17s",loc_legend110.arr,loc_legend82.arr," ");
		else
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		fprintf(fp,"%-10.10s%-24.24s      %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend83.arr);
		//fprintf(fp,"%-34.34s      %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend83.arr);
        else
		if (strcmp(c_bill_net_payable_ind.arr,"R")==0  &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 & strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0)
		fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
		//fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
	 	else 
		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		{
			if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s %17.17s %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %21.21s %17.17s %17.17s %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			else
			fprintf(fp,"%-10.10s%-24.24s %21.21s  %17.17s %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %21.21s  %17.17s %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
		}
		else
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0)
		{
		fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s  %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
		//fprintf(fp,"%-34.34s %21.21s %17.17s  %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend82.arr,loc_legend83.arr);
		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0)
		{
			if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for IN9051
			fprintf(fp,"%-10.10s%-24.24s %21.21s %17.17s %17.17s %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %21.21s %17.17s %17.17s %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend84.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			else
			fprintf(fp,"%-10.10s%-24.24s %21.21s  %17.17s %17.17s %17.17s"," ",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
			//fprintf(fp,"%-34.34s %21.21s  %17.17s %17.17s %17.17s",loc_legend110.arr,loc_legend68.arr,loc_legend87.arr,loc_legend82.arr,loc_legend83.arr);
		}
		}
		if (l_lsr== 0 && l_dmp!= 0)
	    fprintf(fp,"%cF",ESC); 		          /* To Set Bold For Dotmatrix*/
        fprintf(fp,"\n");
		if(strcmp(nd_pgm_id.arr,"BLREXMAD")==0)
		 {
			if(strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_reim_amt_ind.arr,"N")==0 && strcmp(c_non_reim_amt_ind.arr,"N")==0)
			fprintf(fp," %-9.9s %-24.24s     %17.17s \n"," ",loc_legend110.arr,loc_legend68.arr);	
		 }

		if (l_lsr!= 0 && l_dmp== 0) 
		Release_bold();

		
}
check_report_format()
{
	//Modified by Harish 
	//Date - 06/11/2003 Point # 1 - modification document.
	//----------------------------------------------------------

    d_summary_yn = '\0';
	l_dflt_bill_print_in_summ_yn.arr[0] = '\0';

	EXEC SQL SELECT NVL(DFLT_BILL_PRINT_IN_SUMM_YN,'N')
			   INTO l_dflt_bill_print_in_summ_yn 
	           FROM bl_parameters
			  WHERE operating_facility_id = :nd_facility_id;

	l_dflt_bill_print_in_summ_yn.arr[l_dflt_bill_print_in_summ_yn.len] = '\0';
	//First preference given to front end Summary parameter.	
	if(strcmp(l_dflt_bill_print_in_summ_yn.arr,"Y")==0)
	{
		d_summary_yn='Y';
	}
	else
	{
		EXEC SQL SELECT NVL(SUMMARY_YN,'N')
				   INTO :d_summary_yn
				   FROM BL_SUM_DET_PRINT
				  WHERE BLNG_GRP_ID       = :dc_blng_grp_id
    				AND PRT_GRP_HDR_CODE  = :d1_prt_grp_hdr_code
					AND operating_facility_id = :nd_facility_id;       	

			if (sqlca.sqlcode == 1403 )
			{
				     EXEC SQL SELECT NVL(summary_yn,'N')
							    INTO :d_summary_yn
							    FROM bl_sum_det_print
							    WHERE blng_grp_id           = '**'
    						 	AND prt_grp_hdr_code      = :d1_prt_grp_hdr_code
								AND operating_facility_id = :nd_facility_id;

					 if (sqlca.sqlcode == 1403 )
						d_summary_yn='Y';
			}
	}

	//If condition will be considered only in reprint options.
	if(strcmp(l_detail_report_flag.arr,"Y")==0)
	{
			EXEC SQL SELECT NVL(SUMMARY_YN,'N')
					   INTO :d_summary_yn
					   FROM BL_SUM_DET_PRINT
					  WHERE BLNG_GRP_ID       = :dc_blng_grp_id
    					AND PRT_GRP_HDR_CODE  = :d1_prt_grp_hdr_code
						AND operating_facility_id = :nd_facility_id;       	

			if (sqlca.sqlcode == 1403 )
			{
				     EXEC SQL SELECT NVL(summary_yn,'N')
							    INTO :d_summary_yn
							    FROM bl_sum_det_print
							    WHERE blng_grp_id           = '**'
    						 	AND prt_grp_hdr_code      = :d1_prt_grp_hdr_code
								AND operating_facility_id = :nd_facility_id;

					 if (sqlca.sqlcode == 1403 )
							d_summary_yn='Y';
			}
	}
}

/* Added by Raghava.S for Thai date conversion on 06/07/2007 */

get_local_date()
{
	
	EXEC SQL EXECUTE

	DECLARE

	//t_date  date;--Leap Year Changes for SCF 9445  by sarvinder
	t_date  varchar2(20);
	
	BEGIN
		/*get_locale_date.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY'),:nd_lang_id,t_date); --Leap Year Changes for SCF 9445  by sarvinder*/
	   get_locale_date_2t.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY'),:nd_lang_id,t_date,'DD Mon.YYYY');
		 
		 //:nd_loc_date:= to_char(t_date,'DD Mon.YYYY');--Leap Year Changes for SCF 9445  by sarvinder
		   :nd_loc_date:= t_date;

	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed1",0,"");

//:nd_loc_date:= to_char(t_date,'DD/MM/YYYY');
}

get_local_date1()
{
	
	EXEC SQL EXECUTE

	DECLARE

	//t_date  date;--Leap Year Changes for SCF 9445  by sarvinder
	t_date  varchar2(20);
	print_date    varchar2(20);//--Leap Year Changes for SCF 9445  by sarvinder
	BEGIN
	  //get_locale_date.convert_to_locale_date(to_date(:nd_temp_date1,'DD/MM/YYYY HH24:MI'),:nd_lang_id,t_date);--Leap Year Changes for SCF 9445  by sarvinder
	 get_locale_date_2t.convert_to_locale_date(to_date(:nd_temp_date1,'DD/MM/YYYY HH24:MI'),:nd_lang_id,t_date,'DD/MM/YYYY HH24:MI');
		 //:nd_loc_date1:= to_char(t_date,'DD/MM/YYYY HH24:MI');--Leap Year Changes for SCF 9445  by sarvinder
		   :nd_loc_date1:= t_date;
	//--Leap Year Changes for SCF 9445  by sarvinder
	Get_locale_date_2t.convert_to_locale_date(to_date(to_char(sysdate,'DD/MM/YYYY HH24:MI'),'DD/MM/YYYY HH24:MI'),:nd_lang_id,PRINT_DATE,'DD/MM/YYYY HH24:MI');	
		   :nd_sys_date :=PRINT_DATE;
	//--Leap Year Changes for SCF 9445  by sarvinder	   
	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed2",0,"");


}

get_local_date3()
{
	
	EXEC SQL EXECUTE

	DECLARE

	//t_date  date;--Leap Year Changes for SCF 9445  by sarvinder
	t_date  varchar2(20);
	
	BEGIN
	  //get_locale_date.convert_to_locale_date(to_date(:nd_temp_date1,'DD/MM/YYYY HH12:MI AM'),:nd_lang_id,t_date);--Leap Year Changes for SCF 9445  by sarvinder
     get_locale_date_2t.convert_to_locale_date(to_date(:nd_temp_date1,'DD/MM/YYYY HH12:MI AM'),:nd_lang_id,t_date,'DD/MM/YYYY HH12:MI AM');
		//:nd_loc_date1:= to_char(t_date,'DD/MM/YYYY HH12:MI AM');
		  :nd_loc_date1:= t_date;

	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed3",0,"");


}

get_local_date4()
{
	
	EXEC SQL EXECUTE

	DECLARE

	//t_date  date;--Leap Year Changes for SCF 9445  by sarvinder
	t_date  varchar2(20);
	
	BEGIN
	  //get_locale_date.convert_to_locale_date(to_date(:nd_temp_date1,'dd/mm/yyyy HH24:MI:SS'),:nd_lang_id,t_date);--Leap Year Changes for SCF 9445  by sarvinder
     get_locale_date_2t.convert_to_locale_date(to_date(:nd_temp_date1,'dd/mm/yyyy HH24:MI:SS'),:nd_lang_id,t_date,'DD/MM/YYYY HH24:MI:SS'); 
		 //:nd_loc_date1:= to_char(t_date,'DD/MM/YYYY HH24:MI:SS');
		   :nd_loc_date1:= t_date;
	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed4",0,"");


}

get_local_date2()
{
	
	EXEC SQL EXECUTE

	DECLARE

	//t_date  date;--Leap Year Changes for SCF 9445  by sarvinder
	t_date  varchar2(20);
	
	BEGIN
	  //get_locale_date.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY'),:nd_lang_id,t_date);--Leap Year Changes for SCF 9445  by sarvinder
     get_locale_date_2t.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY'),:nd_lang_id,t_date,'DD/MM/YYYY'); 
		 //:nd_loc_date:= to_char(t_date,'DD/MM/YYYY');
		   :nd_loc_date:= t_date;

	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed5",0,"");


}

/*---06/07/2007----*/

init_date_temp_var()
{
nd_temp_date.arr[0] =  '\0';
nd_temp_date1.arr[0]=  '\0';
nd_loc_date1.arr[0] =  '\0';
nd_loc_date.arr[0]  =  '\0';
date_convert.arr[0] =  '\0';

nd_temp_date.len = 0;
nd_loc_date.len  = 0;
date_convert.len = 0;
nd_temp_date1.len= 0;
nd_loc_date1.len  =0;

}

/*---06/07/2007----*/

fun_change_loc_date()
{

strcpy(nd_temp_date.arr,date_convert.arr);
nd_temp_date.len = strlen(nd_temp_date.arr);

get_local_date();
nd_loc_date.arr[nd_loc_date.len]='\0';

}

fun_change_loc_date1()
{
strcpy(nd_temp_date1.arr,date_convert.arr);
nd_temp_date1.len = strlen(nd_temp_date1.arr);

get_local_date1();

nd_loc_date1.arr[nd_loc_date1.len]='\0';
date_convert.arr[date_convert.len]='\0';//--Leap Year Changes for SCF 9445  by sarvinder
}


fun_change_loc_date3()
{

strcpy(nd_temp_date1.arr,date_convert.arr);
nd_temp_date1.len = strlen(nd_temp_date1.arr);

get_local_date3();
nd_loc_date1.arr[nd_loc_date1.len]='\0';

}
fun_change_loc_date4()
{

strcpy(nd_temp_date1.arr,date_convert.arr);
nd_temp_date1.len = strlen(nd_temp_date1.arr);

get_local_date4();
nd_loc_date1.arr[nd_loc_date1.len]='\0';

}



fun_change_loc_date2()
{

strcpy(nd_temp_date.arr,date_convert.arr);
nd_temp_date.len = strlen(nd_temp_date.arr);

get_local_date2();
nd_loc_date.arr[nd_loc_date.len]='\0';

}
fetch_bill_foramt()
{
 
p_gross_net_amt_ind.arr[0]				= '\0';              
p_serv_disc_on_gross_ind.arr[0]			= '\0';            
p_all_oth_adj_amt_row_ind.arr[0]		= '\0';           
p_bill_disc_sep_row_yn.arr[0]			= '\0';              
p_bill_adj_sep_row_yn.arr[0]			= '\0';               
p_bill_exm_sep_row_yn.arr[0]			= '\0';               
p_bill_wo_sep_row_yn.arr[0]				= '\0';                
p_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
p_patient_amt_print_row_ind.arr[0]		= '\0';         
p_bill_net_payable_ind.arr[0]			= '\0';              
c_gross_net_amt_ind.arr[0]				= '\0';                 
c_serv_disc_on_gross_ind.arr[0]			= '\0';            
c_all_oth_adj_amt_ind.arr[0]			= '\0';               
c_bill_disc_sep_row_yn.arr[0]			= '\0';              
c_bill_adj_sep_row_yn.arr[0]			= '\0';               
c_bill_exm_sep_row_yn.arr[0]			= '\0';               
c_bill_wo_sep_row_yn.arr[0]				= '\0';                
c_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
c_bill_subsidized_amt_ind.arr[0]		= '\0';           
c_bill_net_payable_ind.arr[0]			= '\0';              
status.arr[0]							= '\0'; 
p_print_zero_adcharg_column_yn.arr[0]	= '\0';
p_print_zero_disc_column_yn.arr[0]		= '\0';
p_print_zero_other_adj_yn.arr[0]		= '\0';
c_print_zero_adcharg_column_yn.arr[0]	= '\0';
c_print_zero_disc_column_yn.arr[0]		= '\0';
c_print_zero_other_adj_yn.arr[0]		= '\0';                             


 EXEC SQL SELECT         
			P_GROSS_NET_AMT_IND,              
			P_SERV_DISC_ON_GROSS_IND,         
			P_ALL_OTH_ADJ_AMT_ROW_IND,        
			P_BILL_DISC_SEP_ROW_YN,           
			P_BILL_ADJ_SEP_ROW_YN,            
			P_BILL_EXM_SEP_ROW_YN,            
			P_BILL_WO_SEP_ROW_YN,             
			P_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			P_PATIENT_AMT_PRINT_ROW_IND,      
			P_BILL_NET_PAYABLE_IND, 
			P_PRINT_ZERO_ADCHARG_COLUMN_YN,
			P_PRINT_ZERO_DISC_COLUMN_YN,
			P_PRINT_ZERO_OTHER_ADJ_YN ,         
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND,         
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
			C_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			C_BILL_SUBSIDIZED_AMT_IND,        
			C_BILL_NET_PAYABLE_IND,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
			C_PRINT_ZERO_DISC_COLUMN_YN,
			C_PRINT_ZERO_OTHER_ADJ_YN ,                    
			STATUS                           
  INTO       
			:p_gross_net_amt_ind,              
			:p_serv_disc_on_gross_ind,         
			:p_all_oth_adj_amt_row_ind,        
			:p_bill_disc_sep_row_yn,           
			:p_bill_adj_sep_row_yn,            
			:p_bill_exm_sep_row_yn,            
			:p_bill_wo_sep_row_yn,             
			:p_oth_payers_amt_print_row_ind,   
			:p_patient_amt_print_row_ind,      
			:p_bill_net_payable_ind,
			:p_print_zero_adcharg_column_yn,
			:p_print_zero_disc_column_yn,
			:p_print_zero_other_adj_yn,           
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_oth_payers_amt_print_row_ind,   
			:c_bill_subsidized_amt_ind,        
			:c_bill_net_payable_ind,
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_disc_column_yn,
			:c_print_zero_other_adj_yn,                   
			:status   
   FROM
   BL_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id;

 if (OERROR)
        err_mesg("SELECT failed on table BL_BILL_PRINT_FORMAT",0,"");

   if (NODATAFOUND)
   {
		sprintf(msg_str_var,"Payer Format Setup Not Available for this Payer Code: %s",
				d_cust_code.arr);
	    disp_message(ERR_MESG,msg_str_var);
		l_online_print_yn.arr[0]='N';
		//err_mesg(msg_str_var,0,""); //13838
   }


p_gross_net_amt_ind.arr[p_gross_net_amt_ind.len]						= '\0';              
p_serv_disc_on_gross_ind.arr[p_serv_disc_on_gross_ind.len]				= '\0';            
p_all_oth_adj_amt_row_ind.arr[p_all_oth_adj_amt_row_ind.len]			= '\0';           
p_bill_disc_sep_row_yn.arr[p_bill_disc_sep_row_yn.len]					= '\0';              
p_bill_adj_sep_row_yn.arr[p_bill_adj_sep_row_yn.len]					= '\0';               
p_bill_exm_sep_row_yn.arr[p_bill_exm_sep_row_yn.len]					= '\0';               
p_bill_wo_sep_row_yn.arr[p_bill_wo_sep_row_yn.len]						= '\0';                
p_oth_payers_amt_print_row_ind.arr[p_oth_payers_amt_print_row_ind.len]	= '\0';      
p_patient_amt_print_row_ind.arr[p_patient_amt_print_row_ind.len]		= '\0';         
p_bill_net_payable_ind.arr[p_bill_net_payable_ind.len]					= '\0';              
c_gross_net_amt_ind.arr[c_gross_net_amt_ind.len]						= '\0';                 
c_serv_disc_on_gross_ind.arr[c_serv_disc_on_gross_ind.len]				= '\0';            
c_all_oth_adj_amt_ind.arr[c_all_oth_adj_amt_ind.len]					= '\0';               
c_bill_disc_sep_row_yn.arr[c_bill_disc_sep_row_yn.len]					= '\0';              
c_bill_adj_sep_row_yn.arr[c_bill_adj_sep_row_yn.len]					= '\0';               
c_bill_exm_sep_row_yn.arr[c_bill_exm_sep_row_yn.len]					= '\0';               
c_bill_wo_sep_row_yn.arr[c_bill_wo_sep_row_yn.len]						= '\0';                
c_oth_payers_amt_print_row_ind.arr[c_oth_payers_amt_print_row_ind.len]	= '\0';      
c_bill_subsidized_amt_ind.arr[c_bill_subsidized_amt_ind.len]			= '\0';           
c_bill_net_payable_ind.arr[c_bill_net_payable_ind.len]					= '\0';              
status.arr[status.len]													= '\0'; 
p_print_zero_adcharg_column_yn.arr[p_print_zero_adcharg_column_yn.len]	= '\0';
p_print_zero_disc_column_yn.arr[p_print_zero_disc_column_yn.len]		= '\0';
p_print_zero_other_adj_yn.arr[p_print_zero_other_adj_yn.len]			= '\0';
c_print_zero_adcharg_column_yn.arr[c_print_zero_adcharg_column_yn.len]	= '\0';
c_print_zero_disc_column_yn.arr[c_print_zero_disc_column_yn.len]		= '\0';
c_print_zero_other_adj_yn.arr[c_print_zero_other_adj_yn.len]			= '\0';                              

}

fetch_bill_foramt_payer()
{
 
p_gross_net_amt_ind.arr[0]				= '\0';              
p_serv_disc_on_gross_ind.arr[0]			= '\0';            
p_all_oth_adj_amt_row_ind.arr[0]		= '\0';           
p_bill_disc_sep_row_yn.arr[0]			= '\0';              
p_bill_adj_sep_row_yn.arr[0]			= '\0';               
p_bill_exm_sep_row_yn.arr[0]			= '\0';               
p_bill_wo_sep_row_yn.arr[0]				= '\0';                
p_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
p_patient_amt_print_row_ind.arr[0]		= '\0';         
p_bill_net_payable_ind.arr[0]			= '\0'; 
p_print_zero_adcharg_column_yn.arr[0]	= '\0'; 
p_print_zero_disc_column_yn.arr[0]		= '\0'; 
p_print_zero_other_adj_yn.arr[0]		= '\0';             
status.arr[0]							= '\0';                              


 EXEC SQL SELECT         
			P_GROSS_NET_AMT_IND,              
			P_SERV_DISC_ON_GROSS_IND,         
			P_ALL_OTH_ADJ_AMT_ROW_IND,        
			P_BILL_DISC_SEP_ROW_YN,           
			P_BILL_ADJ_SEP_ROW_YN,            
			P_BILL_EXM_SEP_ROW_YN,            
			P_BILL_WO_SEP_ROW_YN,             
			P_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			P_PATIENT_AMT_PRINT_ROW_IND,      
			P_BILL_NET_PAYABLE_IND,
			P_PRINT_ZERO_ADCHARG_COLUMN_YN,
			P_PRINT_ZERO_DISC_COLUMN_YN,
			P_PRINT_ZERO_OTHER_ADJ_YN ,          
			STATUS                           
  INTO       
			:p_gross_net_amt_ind,              
			:p_serv_disc_on_gross_ind,         
			:p_all_oth_adj_amt_row_ind,        
			:p_bill_disc_sep_row_yn,           
			:p_bill_adj_sep_row_yn,            
			:p_bill_exm_sep_row_yn,            
			:p_bill_wo_sep_row_yn,             
			:p_oth_payers_amt_print_row_ind,   
			:p_patient_amt_print_row_ind,      
			:p_bill_net_payable_ind,  
			:p_print_zero_adcharg_column_yn,
			:p_print_zero_disc_column_yn,
			:p_print_zero_other_adj_yn ,        
			:status   
   FROM
   BL_BILL_PRINT_PAYER_FORMAT
   WHERE 
   OPERATING_FACILITY_ID=:nd_facility_id
   AND PAYER_CODE=:d_cust_code;

 if (OERROR)
        err_mesg("SELECT failed on table BL_BILL_PRINT_PAYER_FORMAT",0,"");

   if (NODATAFOUND)
        fetch_bill_foramt();


p_gross_net_amt_ind.arr[p_gross_net_amt_ind.len]						= '\0';              
p_serv_disc_on_gross_ind.arr[p_serv_disc_on_gross_ind.len]				= '\0';            
p_all_oth_adj_amt_row_ind.arr[p_all_oth_adj_amt_row_ind.len]			= '\0';           
p_bill_disc_sep_row_yn.arr[p_bill_disc_sep_row_yn.len]					= '\0';              
p_bill_adj_sep_row_yn.arr[p_bill_adj_sep_row_yn.len]					= '\0';               
p_bill_exm_sep_row_yn.arr[p_bill_exm_sep_row_yn.len]					= '\0';               
p_bill_wo_sep_row_yn.arr[p_bill_wo_sep_row_yn.len]						= '\0';                
p_oth_payers_amt_print_row_ind.arr[p_oth_payers_amt_print_row_ind.len]	= '\0';      
p_patient_amt_print_row_ind.arr[p_patient_amt_print_row_ind.len]		= '\0';         
p_bill_net_payable_ind.arr[p_bill_net_payable_ind.len]					= '\0';              
status.arr[status.len]													= '\0'; 
p_print_zero_adcharg_column_yn.arr[p_print_zero_adcharg_column_yn.len]		= '\0';
p_print_zero_disc_column_yn.arr[p_print_zero_disc_column_yn.len]			= '\0';
p_print_zero_other_adj_yn.arr[p_print_zero_other_adj_yn.len]				= '\0';                            

}

fetch_single_bill_foramt_bg()
{
     
c_gross_net_amt_ind.arr[0]				= '\0';                 
c_serv_disc_on_gross_ind.arr[0]			= '\0';            
c_reim_amt_ind.arr[0]		        	= '\0';               
c_non_reim_amt_ind.arr[0]				= '\0';
c_all_oth_adj_amt_ind.arr[0]			= '\0';  
c_bill_disc_sep_row_yn.arr[0]			= '\0';              
c_bill_adj_sep_row_yn.arr[0]			= '\0';               
c_bill_exm_sep_row_yn.arr[0]			= '\0';               
c_bill_wo_sep_row_yn.arr[0]				= '\0';                
c_bill_net_payable_ind.arr[0]			= '\0';              
status.arr[0]							= '\0';                              
print_legend_yn.arr[0]					= '\0';                              
print_legend_dtl_rcpt.arr[0]			= '\0';   
c_addl_charge_amt_ind.arr[0]			= '\0';                           
c_print_zero_adcharg_column_yn.arr[0]	= '\0';
c_print_zero_disc_column_yn.arr[0]		= '\0';
c_print_zero_other_adj_yn.arr[0]		= '\0';
c_serv_desc_sep_line_yn.arr[0]			= '\0';
c_print_zero_net_amt_serv_yn.arr[0]		= '\0';
c_print_separator_line.arr[0]		    = '\0';


 EXEC SQL SELECT         
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND, 
			C_REIM_AMT_IND,
			C_NON_REIM_AMT_IND,        
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
		    C_BILL_NET_PAYABLE_IND,                     
			STATUS,
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT,
			C_ADDL_CHARGE_AMT_IND,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
			C_PRINT_ZERO_DISC_COLUMN_YN,
			C_PRINT_ZERO_OTHER_ADJ_YN,
			C_SERV_DESC_SEP_LINE_YN,
			C_PRINT_ZERO_NET_AMT_SERV_YN,
			nvl(C_PRINT_SEPARATOR_LINE,'N')                           
  INTO       
			    
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,
			:c_reim_amt_ind,
			:c_non_reim_amt_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_bill_net_payable_ind,                   
			:status,
			:print_legend_yn,
            :print_legend_dtl_rcpt,
			:c_addl_charge_amt_ind,
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_disc_column_yn,
			:c_print_zero_other_adj_yn,
			:c_serv_desc_sep_line_yn,
			:c_print_zero_net_amt_serv_yn,
			:c_print_separator_line
   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   //AND  bill_rcpt_ind='R'
   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
   AND   ( (:l_con_rcpt_yn='Y'						//06/01/2010
			and :d3_bill_doc_type_code Is Null 
			and :l_no_of_blng_grp>1
			and  BLNG_GRP_ID    =:l_con_rcpt_blng_grp
		   )
          or
		  (BLNG_GRP_ID =:d1_blng_grp_id) 
         )
   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);
   //AND   BLNG_GRP_ID          =:dc_blng_grp_id;
   if(NODATAFOUND)
   {
     
	   EXEC SQL SELECT         
				C_GROSS_NET_AMT_IND,              
				C_SERV_DISC_ON_GROSS_IND, 
				C_REIM_AMT_IND,
				C_NON_REIM_AMT_IND,        
				C_ALL_OTH_ADJ_AMT_IND,            
				C_BILL_DISC_SEP_ROW_YN,           
				C_BILL_ADJ_SEP_ROW_YN,            
				C_BILL_EXM_SEP_ROW_YN,            
				C_BILL_WO_SEP_ROW_YN,             
				C_BILL_NET_PAYABLE_IND,                     
				STATUS,
				PRINT_LEGEND_YN,
				PRINT_LEGEND_DTL_RCPT,
				C_ADDL_CHARGE_AMT_IND,
				C_PRINT_ZERO_ADCHARG_COLUMN_YN,
				C_PRINT_ZERO_DISC_COLUMN_YN,
				C_PRINT_ZERO_OTHER_ADJ_YN,
				C_SERV_DESC_SEP_LINE_YN,
				C_PRINT_ZERO_NET_AMT_SERV_YN,
				nvl(C_PRINT_SEPARATOR_LINE,'N')                             
	  INTO       
					
				:c_gross_net_amt_ind,              
				:c_serv_disc_on_gross_ind,
				:c_reim_amt_ind,
				:c_non_reim_amt_ind,         
				:c_all_oth_adj_amt_ind,            
				:c_bill_disc_sep_row_yn,           
				:c_bill_adj_sep_row_yn,            
				:c_bill_exm_sep_row_yn,            
				:c_bill_wo_sep_row_yn,             
				:c_bill_net_payable_ind,                   
				:status,
				:print_legend_yn,
				:print_legend_dtl_rcpt,
				:c_addl_charge_amt_ind,
				:c_print_zero_adcharg_column_yn,
				:c_print_zero_disc_column_yn,
				:c_print_zero_other_adj_yn,
				:c_serv_desc_sep_line_yn,
				:c_print_zero_net_amt_serv_yn,
				:c_print_separator_line
   
	   FROM
	   BL_CASH_BILL_PRINT_FORMAT
	   WHERE OPERATING_FACILITY_ID=:nd_facility_id
	   //and bill_rcpt_ind='R'
	  and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
	   AND ( (:l_con_rcpt_yn='Y'							//06/01/2010
			and :d3_bill_doc_type_code Is Null 
			and :l_no_of_blng_grp>1
			and  BLNG_GRP_ID  ='**'
		   )
           or
		   (BLNG_GRP_ID =:d1_blng_grp_id) 
          )
	   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
	   //AND   BLNG_GRP_ID          =:dc_blng_grp_id;
   }
   
   if (OERROR)
        err_mesg("SELECT failed on table BL_CASH_BILL_PRINT_FORMAT",0,"");

   if(NODATAFOUND)
   {

   EXEC SQL SELECT         
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND, 
			C_REIM_AMT_IND,
			C_NON_REIM_AMT_IND,        
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
		    C_BILL_NET_PAYABLE_IND,                     
			STATUS,
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT,
			C_ADDL_CHARGE_AMT_IND ,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
			C_PRINT_ZERO_DISC_COLUMN_YN,
			C_PRINT_ZERO_OTHER_ADJ_YN,
			C_SERV_DESC_SEP_LINE_YN,
			C_PRINT_ZERO_NET_AMT_SERV_YN,
			nvl(C_PRINT_SEPARATOR_LINE,'N')
			                             
  INTO       
			    
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,
			:c_reim_amt_ind,
			:c_non_reim_amt_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_bill_net_payable_ind,                   
			:status,
			:print_legend_yn,
            :print_legend_dtl_rcpt,
			:c_addl_charge_amt_ind ,
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_disc_column_yn,
			:c_print_zero_other_adj_yn,
			:c_serv_desc_sep_line_yn,
			:c_print_zero_net_amt_serv_yn,
			:c_print_separator_line   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   //and bill_rcpt_ind='R'
   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
   AND   BLNG_GRP_ID          ='**'
   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);
    
   if(NODATAFOUND)
   {
	   EXEC SQL SELECT         
				C_GROSS_NET_AMT_IND,              
				C_SERV_DISC_ON_GROSS_IND, 
				C_REIM_AMT_IND,
				C_NON_REIM_AMT_IND,        
				C_ALL_OTH_ADJ_AMT_IND,            
				C_BILL_DISC_SEP_ROW_YN,           
				C_BILL_ADJ_SEP_ROW_YN,            
				C_BILL_EXM_SEP_ROW_YN,            
				C_BILL_WO_SEP_ROW_YN,             
				C_BILL_NET_PAYABLE_IND,                     
				STATUS,
				PRINT_LEGEND_YN,
				PRINT_LEGEND_DTL_RCPT,
				C_ADDL_CHARGE_AMT_IND ,
				C_PRINT_ZERO_ADCHARG_COLUMN_YN,
				C_PRINT_ZERO_DISC_COLUMN_YN,
				C_PRINT_ZERO_OTHER_ADJ_YN,
				C_SERV_DESC_SEP_LINE_YN,
				C_PRINT_ZERO_NET_AMT_SERV_YN,
				nvl(C_PRINT_SEPARATOR_LINE,'N')
											 
	  INTO       
					
				:c_gross_net_amt_ind,              
				:c_serv_disc_on_gross_ind,
				:c_reim_amt_ind,
				:c_non_reim_amt_ind,         
				:c_all_oth_adj_amt_ind,            
				:c_bill_disc_sep_row_yn,           
				:c_bill_adj_sep_row_yn,            
				:c_bill_exm_sep_row_yn,            
				:c_bill_wo_sep_row_yn,             
				:c_bill_net_payable_ind,                   
				:status,
				:print_legend_yn,
				:print_legend_dtl_rcpt,
				:c_addl_charge_amt_ind ,
				:c_print_zero_adcharg_column_yn,
				:c_print_zero_disc_column_yn,
				:c_print_zero_other_adj_yn,
				:c_serv_desc_sep_line_yn,
				:c_print_zero_net_amt_serv_yn,
				:c_print_separator_line  
	   FROM
	   BL_CASH_BILL_PRINT_FORMAT
	   WHERE OPERATING_FACILITY_ID=:nd_facility_id
	   //and bill_rcpt_ind='R'
	   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
	   AND   BLNG_GRP_ID          ='**'
	   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
   
   
   	 if(NODATAFOUND)
	 {
    
		sprintf(msg_str_var,"Receipt Format Setup Not Available for this Billing Group: %s",
				d1_blng_grp_id.arr);
		//err_mesg(msg_str_var,0,""); //in13838
			disp_message(ERR_MESG,msg_str_var);
			proc_exit(0);
		
		
	  }

   }	 
	 


  }
/*** The below code added by raghava for Getting Bill Refund Format for time being for siriraj format but
 some setup required ****/       
if(strcmp(d_bill_format.arr,"B")== 0 && d_recpt_refund_ind.arr[0]=='F')
{
  Exec Sql Select 'X','N','N','N','D','N','N',
                  'N','N','C','D','N','N','N',
				  'N','N'
                  
           Into    
				:c_gross_net_amt_ind,              
				:c_serv_disc_on_gross_ind,
				:c_reim_amt_ind,
				:c_non_reim_amt_ind,         
				:c_all_oth_adj_amt_ind,            
				:c_bill_disc_sep_row_yn,           
				:c_bill_adj_sep_row_yn,            
				:c_bill_exm_sep_row_yn,            
				:c_bill_wo_sep_row_yn,             
				:c_bill_net_payable_ind,                   
				:c_addl_charge_amt_ind ,
				:c_print_zero_adcharg_column_yn,
				:c_print_zero_disc_column_yn,
				:c_print_zero_other_adj_yn,
				:c_serv_desc_sep_line_yn,
				:c_print_zero_net_amt_serv_yn
			
				   
           From
		   Dual;
}
 /*** upto here ***/          
c_gross_net_amt_ind.arr[c_gross_net_amt_ind.len]						= '\0';                 
c_serv_disc_on_gross_ind.arr[c_serv_disc_on_gross_ind.len]				= '\0'; 
c_reim_amt_ind.arr[c_reim_amt_ind.len]									= '\0';
c_non_reim_amt_ind.arr[c_non_reim_amt_ind.len]							= '\0';           
c_all_oth_adj_amt_ind.arr[c_all_oth_adj_amt_ind.len]					= '\0';               
c_bill_disc_sep_row_yn.arr[c_bill_disc_sep_row_yn.len]					= '\0';              
c_bill_adj_sep_row_yn.arr[c_bill_adj_sep_row_yn.len]					= '\0';               
c_bill_exm_sep_row_yn.arr[c_bill_exm_sep_row_yn.len]					= '\0';               
c_bill_wo_sep_row_yn.arr[c_bill_wo_sep_row_yn.len]						= '\0';                
c_bill_net_payable_ind.arr[c_bill_net_payable_ind.len]					= '\0';              
status.arr[status.len]													= '\0';                              
print_legend_yn.arr[print_legend_yn.len]								= '\0';                              
print_legend_dtl_rcpt.arr[print_legend_dtl_rcpt.len]					= '\0';  
c_addl_charge_amt_ind.arr[c_addl_charge_amt_ind.len]					= '\0';
c_print_zero_adcharg_column_yn.arr[c_print_zero_adcharg_column_yn.len]	= '\0';
c_print_zero_disc_column_yn.arr[c_print_zero_disc_column_yn.len]		= '\0';
c_print_zero_other_adj_yn.arr[c_print_zero_other_adj_yn.len]			= '\0';
c_serv_desc_sep_line_yn.arr[c_serv_desc_sep_line_yn.len]				= '\0';
c_print_zero_net_amt_serv_yn.arr[c_print_zero_net_amt_serv_yn.len]		= '\0';
c_print_separator_line.arr[c_print_separator_line.len]					= '\0';
}

fetch_receipt_setup(v_mode)
int v_mode; 
{
  
  if(v_mode==1)  //Deposit
  {

	print_legend_yn.arr[0]					= '\0';                              
	print_legend_dtl_rcpt.arr[0]			= '\0';   
	//c_print_separator_line.arr[0]		    = '\0';
  
  EXEC SQL SELECT         
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT
			--nvl(C_PRINT_SEPARATOR_LINE,'N')
			                             
  INTO       
		    :print_legend_yn,
            :print_legend_dtl_rcpt
			--:c_print_separator_line   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   //and bill_rcpt_ind='R'
   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
   AND   BLNG_GRP_ID          ='**'
   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);


    if(NODATAFOUND)
	 {
   
   	   EXEC SQL SELECT         
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT
			--nvl(C_PRINT_SEPARATOR_LINE,'N')
			                             
	  INTO       
			:print_legend_yn,
			:print_legend_dtl_rcpt
			--:c_print_separator_line   
	   FROM
	   BL_CASH_BILL_PRINT_FORMAT
	   WHERE OPERATING_FACILITY_ID=:nd_facility_id
	   //and bill_rcpt_ind='R'
	   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
	   AND   BLNG_GRP_ID          ='**'
	   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
	   
	
	
	  if(NODATAFOUND)	
	  {
		sprintf(msg_str_var,"Receipt Format Setup Not Available");
		disp_message(ERR_MESG,msg_str_var);
		proc_exit(0);
	  }	
		
	  }


	print_legend_yn.arr[print_legend_yn.len]								= '\0';                              
	print_legend_dtl_rcpt.arr[print_legend_dtl_rcpt.len]					= '\0';  
	//c_print_separator_line.arr[c_print_separator_line.len]				= '\0';
 }
 if(v_mode==2)  //Invoice
 {
  	print_legend_yn.arr[0]					= '\0';                              
	print_legend_dtl_rcpt.arr[0]			= '\0';   
	c_print_separator_line.arr[0]		    = '\0';
  
  EXEC SQL SELECT         
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT,
			nvl(C_PRINT_SEPARATOR_LINE,'N')
			                             
  INTO       
		    :print_legend_yn,
            :print_legend_dtl_rcpt,
			:c_print_separator_line   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   //and bill_rcpt_ind='R'
   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
   AND   BLNG_GRP_ID          ='**'
   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);


    if(NODATAFOUND)
	 {
    
		 EXEC SQL SELECT         
			PRINT_LEGEND_YN,
			PRINT_LEGEND_DTL_RCPT,
			nvl(C_PRINT_SEPARATOR_LINE,'N')
			                             
	  INTO       
			:print_legend_yn,
			:print_legend_dtl_rcpt,
			:c_print_separator_line   
	   FROM
	   BL_CASH_BILL_PRINT_FORMAT
	   WHERE OPERATING_FACILITY_ID=:nd_facility_id
	   //and bill_rcpt_ind='R'
	   and ((:nd_pgm_id='BLRRCCOU' and bill_rcpt_ind='R') or (:nd_pgm_id='BLREXMAD' and bill_rcpt_ind='E')) //added by vani
	   AND   BLNG_GRP_ID          ='**'
	   AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
		
	
		
	  if(NODATAFOUND)	
	  {
		sprintf(msg_str_var,"Receipt Format Setup Not Available");
		disp_message(ERR_MESG,msg_str_var);
		proc_exit(0);
	  }	
		
		
	  }


	print_legend_yn.arr[print_legend_yn.len]								= '\0';                              
	print_legend_dtl_rcpt.arr[print_legend_dtl_rcpt.len]					= '\0';  
	c_print_separator_line.arr[c_print_separator_line.len]				    = '\0';
 
 }
   if(print_legend_yn.arr[0]=='Y')
   nd_preprint_flag.arr[0]='N';
   else
   nd_preprint_flag.arr[0]='Y';
			
}



/*fetch_legend_value1()
{
	for(i=1;i<=900;i++)
	{
		l_pk_value.arr[0] = '\0';
     
		EXEC SQL SELECT LTRIM(RTRIM('BILL_01.LEGEND_'||LTRIM(RTRIM(TO_CHAR(:i,'009')))))
		           INTO :l_pk_value
				   FROM dual;

		l_pk_value.arr[l_pk_value.len]	= '\0';
		l_translated_value.arr[0]		= '\0';

		EXEC SQL EXECUTE
		BEGIN
			blcommon.get_local_lang_desc(:nd_facility,
										'SM',
										'SM_LANG_LEGEND',
										'DFLT_LEGEND_VALUE',
										:l_pk_value,
										:l_translated_value,
										:nd_lang_id);

      

		END;
		END-EXEC;
       
		l_translated_value.arr[l_translated_value.len] = '\0';
	
		strcpy(loc_legend[i],l_translated_value.arr);
		
}
}*/


print_report_header()
{
	int i=0;
	int len1 = 0;

/*** PRINTING DEPOSIT HEADER ****/ 
if(print_deposit_header_flag)
{

	if(nd_option.arr[0]=='A')
	if(strcmp(d_print_yn.arr,"Y")==0)
	{
	  if (l_lsr!= 0 && l_dmp== 0)	
	  {
		  fprintf(fp,"%c&a4L",ESC); 	/* To Set the Left margin */
		  fprintf(fp,"%c(s10H",ESC);	
		  fprintf(fp,"%c(s3B",ESC); 
		  fprintf(fp,"%-68.68s%-10.10s\n"," ",loc_legend19.arr);
		  fprintf(fp,"%c(s-3B",ESC);
	  }
	  if (l_lsr== 0 && l_dmp!= 0)	
	  {
	     fprintf(fp,"%-68.68s"," ");
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"%cW1",ESC); 		      /* To Set doble width For Dotmatrix*/ 
		// fprintf(fp,"%cw1",ESC); 		      /* To Set double height For Dotmatrix*/ 
		 fprintf(fp,"%-10.10s",loc_legend19.arr);
		 //fprintf(fp,"%cw0",ESC); 		      /* To Set double height For Dotmatrix*/ 
		 fprintf(fp,"%cW0",ESC); 		      /* To Set doble width  For Dotmatrix*/ 
		 fprintf(fp,"%cF",ESC);				  /* To Set Realse the Bold For Dotmatrix*/
		 fprintf(fp,"\n");
	  }
	}
	line_no = line_no + 1;
	/*
	fprintf(fp,"%-50.50s\n",nd_hosp_name.arr);
	line_no = line_no + 1;
	fprintf(fp,"%-s : %-50.50s\n",loc_legend101.arr,nd_tel.arr);
	line_no = line_no + 1;
	fprintf(fp,"%-s : %-50.50s",loc_legend102.arr,nd_fax.arr);
	*/

    /*
	if (l_lsr!= 0 && l_dmp== 0)
	{
		fprintf(fp,"%c(s10H",ESC);	 						 // TO SET FONT SIZE
		fprintf(fp,"%c(s3B",ESC);  	                         // To set Bold style 
		prt_space();
		fun_centre(nd_hosp_name.arr,75);
		fprintf(fp,"%s\n",nd_hosp_name.arr);
		prt_space();	
		fprintf(fp,"%c(s-3B",ESC);
		fprintf(fp,"%c(s14H",ESC);
		//fprintf(fp,"%-35.35s%-s : %-s  %-s : %-s\n"," ",loc_legend101.arr,nd_tel.arr,loc_legend102.arr,nd_fax.arr); //commnted by vani bcoz of making center
		st_tel_fax.arr[0]= '\0';
		strcat(st_tel_fax.arr,loc_legend101.arr);
		strcat(st_tel_fax.arr,nd_tel.arr);
		strcat(st_tel_fax.arr,"  ");
		strcat(st_tel_fax.arr,loc_legend102.arr);
		strcat(st_tel_fax.arr,nd_fax.arr);
		fun_centre(st_tel_fax.arr,105);
		fprintf(fp,"%s\n",st_tel_fax.arr);
		line_no = line_no + 3; 
	
	}  
	*/   //commnted for 11793 



    //if (l_lsr== 0 && l_dmp!= 0)  ///11793
	//{
	//	prt_space();


	   if (l_lsr!= 0 && l_dmp== 0) 
	   { 
		fprintf(fp,"%c(s-3B",ESC);
		fprintf(fp,"%c(s14H",ESC);
		
		//fprintf(fp,"%s\n",nd_hosp_name.arr); //11793

		/****117793****/
		if (nd_ln1_add.arr[0]!='\0')
		 {
			fprintf(fp,"%-30.30s\n",nd_ln1_add.arr); 
		 }
		
		if (nd_ln2_add.arr[0]!='\0')
		 {
			fprintf(fp,"%-30.30s\n",nd_ln2_add.arr); 
		 }

		 if (nd_ln3_add.arr[0]!='\0')
		 {
			fprintf(fp,"%-30.30s\n",nd_ln3_add.arr); 
		 }

		 if (nd_zip_code.arr[0]!='\0')
		 {
			fprintf(fp,"%-30.30s\n",nd_zip_code.arr); 
		 }
		//prt_space();	
		//fprintf(fp,"%-s : %-s %-s : %-s\n",loc_legend101.arr,nd_tel.arr,loc_legend102.arr,nd_fax.arr); //11793
		

		if(d_receipt_date.arr[0]!='\0')
		{
		 init_date_temp_var();
		 strcpy(date_convert.arr,d_receipt_date.arr);
		 fun_change_loc_date1();
		 //fun_change_loc_date2(); //COMMNTED BY VAN
		 //strcpy(d_receipt_date.arr,nd_loc_date1.arr);
		 strcpy(d_receipt_date_nd.arr,nd_loc_date1.arr);//changed by sarvinder for SCF-9456
        }
		 /*
		 if(nd_sys_date.arr[0]!='\0')
		{
		 init_date_temp_var();
		 strcpy(date_convert.arr,nd_sys_date.arr);
		 fun_change_loc_date1();
		 strcpy(nd_sys_date.arr,nd_loc_date1.arr);
        }*/
		
		fprintf(fp,"%-5.5s : %-30.30s  %-30.30s",loc_legend101.arr,nd_tel.arr," ");  //11793 by vani
		fprintf(fp,"%c(s3B",ESC);
		//fprintf(fp,"%-10.10s: %-s/%s\n",loc_legend106.arr,d_doc_type_code1.arr,d_doc_number1.arr);  //11793 by vani
		fprintf(fp,"%-10.10s: ",loc_legend106.arr);
		   get_org_deposit();
		if(d5_org_dep_code.arr[0]!='\0')
		  fprintf(fp," %-s\n",d5_org_dep_code.arr);
		  else
		  fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);

		fprintf(fp,"%c(s-3B",ESC);
		fprintf(fp,"%-5.5s : %-30.30s  %-30.30s",loc_legend102.arr,nd_fax.arr," ");  //11793 by vani
		fprintf(fp,"%c(s3B",ESC);
		//fprintf(fp,"%-10.10s: %s\n",loc_legend3.arr,d_receipt_date.arr);  //11793 by vani
		fprintf(fp,"%-10.10s: %s\n",loc_legend3.arr,d_receipt_date_nd.arr);//changed by sarvinder for SCF-9456
		fprintf(fp,"%c(s-3B",ESC);
		
	  }
	  else
	  { 
	  	  
	  	if(d_receipt_date.arr[0]!='\0')
		{
		 init_date_temp_var();
		 strcpy(date_convert.arr,d_receipt_date.arr);
		 fun_change_loc_date1();
		 //fun_change_loc_date2(); //COMMNTED BY VAN
		 //strcpy(d_receipt_date.arr,nd_loc_date1.arr);
		 strcpy(d_receipt_date_nd.arr,nd_loc_date1.arr);//changed by sarvinder for SCF-9456
        }
		 
		 /** The below code Added by raghava at BKK on 15/03/2010 ***/
		  fprintf(fp,"%-67.67s",nd_hosp_name.arr);
		 
		  /** the below code  added for SCF-7239 **/

          l_hig_len=0;
		  len_leg=0;
		  l_hig_len=strlen(loc_legend995.arr);
		  if(l_hig_len<strlen(loc_legend2.arr))
		  l_hig_len=strlen(loc_legend2.arr);
		  else if(l_hig_len<strlen(loc_legend3.arr))
		  l_hig_len=strlen(loc_legend3.arr);
		  else if(l_hig_len<strlen(loc_legend106.arr))
		  l_hig_len=strlen(loc_legend106.arr);
		
  
		  /** upto **/
		 
		 
		 	/*** Cash Counter ****/
			  len_desc = strlen(nd_counter_name.arr);
			  while(r_ctrdesc < len_desc)
			  {	
				split_text(nd_counter_name.arr,30,cl_string_desc,&r_ctrdesc);
				if(l_ctr==1)
				{
				  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
				  //fprintf(fp,"%-12.12s : ",loc_legend995.arr); scf-7238
				  fprintf(fp,"%-s",loc_legend995.arr);
				  len_leg=strlen(loc_legend995.arr);
				  while(len_leg<l_hig_len)
				  {
				   fprintf(fp," ");
				   len_leg++;
				  }
				  fprintf(fp," : ");
				  len_leg=0;
				  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
				  fprintf(fp,"%-30.30s ",cl_string_desc);
				}
				else
				{
				 
				 //fprintf(fp,"%-70.70s %-12.12s   %-30.30s "," "," ",cl_string_desc);
				 fprintf(fp,"%-70.70s "," ");
				 for(i=1;i<=(l_hig_len+3);i++)
				 {
				  fprintf(fp," ");
				 }
				 fprintf(fp,"   %-30.30s ",cl_string_desc);
				}
				strcpy(cl_string_desc,"");  
				fprintf(fp,"\n");line_no = line_no + 1;
				l_ctr++;
			  } 
			  r_ctrdesc=0;
			  len_leg=0;
			  l_ctr=1;									
		 
		
		/** upto here 15/03/2010 ***/
		
		nd_tel_fax.arr[0]='\0';
		nd_tel_fax.len=0;

		Exec Sql Select :loc_legend101||':'||:nd_tel||' '||:loc_legend102||':'||:nd_fax
		         Into  :nd_tel_fax
				 from   Dual;
		
		nd_tel_fax.arr[nd_tel_fax.len]='\0';

		//fprintf(fp,"%s\n",nd_hosp_add.arr);
		//fprintf(fp,"%-67.67s",nd_tel_fax.arr);

		  fprintf(fp,"%-67.67s",nd_hosp_add.arr);
		  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix/
		  if(d_oth_receipt_amt>=0)
		  {
		   //fprintf(fp,"%-10.10s: ",loc_legend106.arr); scf-7238
		   fprintf(fp,"%-s",loc_legend106.arr);
		   len_leg=strlen(loc_legend106.arr);
		   while(len_leg<l_hig_len)
		   {
		    fprintf(fp," ");
		    len_leg++;
		   }
		   fprintf(fp," : ");
		   len_leg=0;

		   get_org_deposit();
		  }
		  else
		  fprintf(fp,"%-10.10s: ",loc_legend1449.arr);
		  fprintf(fp,"%cF",ESC); 		          //To Set Release the Bold For Dotmatrix/
		  if(d5_org_dep_code.arr[0]!='\0')
		  fprintf(fp," %-s\n",d5_org_dep_code.arr);
		  else
		  fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
		  fprintf(fp,"%-67.67s",nd_hosp_add1.arr);
		  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
		  //fprintf(fp,"%-10.10s: ",loc_legend3.arr); scf-7238
		  fprintf(fp,"%-s",loc_legend3.arr);
		  len_leg=strlen(loc_legend3.arr);
		   while(len_leg<l_hig_len)
		   {
		    fprintf(fp," ");
		    len_leg++;
		   }
		   fprintf(fp," : ");
		   len_leg=0;
		  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
		  //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
		  fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
          fprintf(fp,"\n");line_no = line_no + 2;
		 
		 /*
		  len_desc = strlen(nd_hosp_add.arr);
		  while(r_ctrdesc < len_desc)
		  {	
			split_text(nd_hosp_add.arr,58,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			{
			  fprintf(fp,"%-60.60s %-6.6s",cl_string_desc," ");
			  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix
			  if(d_oth_receipt_amt>=0)
			  fprintf(fp,"%-10.10s: ",loc_legend106.arr);
			  else
			  fprintf(fp,"%-10.10s: ",loc_legend1449.arr);
			  fprintf(fp,"%cF",ESC); 		          //To Set Release the Bold For Dotmatrix
			  fprintf(fp," %-s/%-s",d_doc_type_code1.arr,d_doc_number1.arr);
			}
			else
			if(l_ctr==2)
			{
		
			 fprintf(fp,"%-60.60s %-6.6s",cl_string_desc," ");
			 fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			 fprintf(fp,"%-10.10s: ",loc_legend3.arr);
			 fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			 //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			 fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			}
			else
			fprintf(fp,"%-60.60s %-10.10s",cl_string_desc," ");
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");line_no = line_no + 1;
			l_ctr++;
		  } 
		  r_ctrdesc=0;
		  
		  if(l_ctr==1)
			{
			  fprintf(fp,"%-60.60s %-6.6s",cl_string_desc," ");
			  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			  if(d_oth_receipt_amt>=0)
			  fprintf(fp,"%-10.10s: ",loc_legend106.arr);
			  else
			  fprintf(fp,"%-10.10s: ",loc_legend1449.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  fprintf(fp," %-s/%-s",d_doc_type_code1.arr,d_doc_number1.arr);
			  fprintf(fp,"\n");line_no = line_no + 1;
         	
			  fprintf(fp,"%-60.60s %-6.6s",cl_string_desc," ");
			  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			  fprintf(fp,"%-10.10s: ",loc_legend3.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			  fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			  fprintf(fp,"\n");line_no = line_no + 1;
			}
           if(l_ctr==2)
		   {
		    
			 fprintf(fp,"%-60.60s %-6.6s",cl_string_desc," ");
			 fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix
			 fprintf(fp,"%-10.10s: ",loc_legend3.arr);
			 fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			 //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			 fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			 fprintf(fp,"\n");line_no = line_no + 1;
		   }
		
		*/
		
		
		//fprintf(fp,"%-5.5s : %-30.30s  %-30.30s",loc_legend101.arr,nd_tel.arr," ");  //11793 by vani
		/*
		fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
		fprintf(fp,"%-10.10s: ",loc_legend106.arr);
		fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
		fprintf(fp,"%-s/%s\n",d_doc_type_code1.arr,d_doc_number1.arr);  //11793 by vani
		*/
		//fprintf(fp,"%-5.5s : %-30.30s  %-30.30s",loc_legend102.arr,nd_fax.arr," ");  //11793 by vani
		/*
		fprintf(fp,"%-5.5s   %-30.30s  %-30.30s"," "," "," ");  //11793 by vani
		fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
		fprintf(fp,"%-10.10s: ",loc_legend3.arr,d2_doc_date.arr);  //11793 by vani
		fprintf(fp,"%cF",ESC); 		         // To Set Release the Bold For Dotmatrix
		fprintf(fp,"%s\n",d2_doc_date.arr);  //11793 by vani
		*/
	  }

		line_no = line_no + 3;

//	}

	prt_space();
	/* COMMNTED BY VANI
	fprintf(fp,"%20.20s:",loc_legend106.arr);	    
	fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
	line_no = line_no + 1;
	

	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr== 0 && l_dmp!= 0)
    fprintf(fp,"%cE",ESC); 		          
	fprintf(fp,"%-50.50s%28.28s:"," ",loc_legend3.arr);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
    if (l_lsr== 0 && l_dmp!= 0)
    fprintf(fp,"%cF",ESC); 		         

	fprintf(fp,"%-s\n\n",d2_doc_date.arr);
	line_no = line_no + 2; UPTO HERE */



    if (l_lsr!= 0 && l_dmp== 0)
	{
		fprintf(fp,"%c(s10H",ESC);	
		fprintf(fp,"%c(s3B",ESC);
		if (d_oth_receipt_amt>=0)
		{
		fun_centre(loc_legend97.arr,75);
		//print_underline();
		fprintf(fp,"%s\n",loc_legend97.arr);  
		//Release_underline();
		}
		else
		{
		fun_centre(loc_legend1350.arr,75);
		//print_underline();
		fprintf(fp,"%s\n",loc_legend1350.arr);
		//Release_underline();
		}
	}
	if (l_lsr== 0 && l_dmp!= 0)
	{
	    if (d_oth_receipt_amt>=0)
		{
		 fun_centre(loc_legend97.arr,100);
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"%s",loc_legend97.arr);
		 fprintf(fp,"%cF",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"\n");
		 //fprintf(fp,"%43.43s\n",loc_legend97.arr);
		}
		else
		{
		 fun_centre(loc_legend1350.arr,100);
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"%s",loc_legend1350.arr);
		 fprintf(fp,"%cF",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"\n");
		 //fprintf(fp,"%43.43s\n",loc_legend1350.arr);
		}
	}
	//fprintf(fp,"%-48.48s%-12.12s\n"," ",loc_legend97.arr);
	line_no = line_no + 1;
	if (l_lsr!= 0 && l_dmp== 0)
	{
		fprintf(fp,"%c(s-3B",ESC);
		fprintf(fp,"%c(s14H",ESC);
	}

	//strcat(nd_use_in_hosp1.arr,"Use in");

	if (l_lsr!= 0 && l_dmp== 0)
	{
	 fun_centre(nd_use_in_hosp.arr,100);
	 fprintf(fp,"%s\n",nd_use_in_hosp.arr); 
	}
	if (l_lsr== 0 && l_dmp!= 0)
	{
     fun_centre(loc_legend1455.arr,100);
	 fprintf(fp,"%s\n",loc_legend1455.arr);
	} 
	  
	if (l_lsr== 0 && l_dmp!= 0)
	{
	 //fun_centre(nd_medical_faclt.arr,100);
	 fun_centre(loc_legend1456.arr,100);
	 fprintf(fp,"%s\n",loc_legend1456.arr); //For Only Siriraj added by raghav at BKK on 15/03/2010
	}
	
	//fprintf(fp,"%-35.35s%-100.100s\n"," ",nd_use_in_hosp.arr); //For Only Brunei
	//fprintf(fp,"%-30.30s%-28.28s\n"," ",loc_legend107.arr);    //For Only Siriraj  //11793
	line_no = line_no + 1;

  /*  
    prt_space();
    fprintf(fp,"%-56.56s"," ");
	fprintf(fp,"%20.20s:",loc_legend106.arr);	    
	fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
	line_no = line_no + 1;
	if(d2_doc_date.arr[0]!='\0')
	{
	  init_date_temp_var();
	  strcpy(date_convert.arr,d2_doc_date.arr);
	  fun_change_loc_date3();
	  //fun_change_loc_date2(); //COMMNTED BY VANI REGARDING 11793
	  strcpy(d2_doc_date.arr,nd_loc_date1.arr);
	  
	 }


	fprintf(fp,"%-50.50s%28.28s:"," ",loc_legend3.arr);
	fprintf(fp,"%-s\n\n",d2_doc_date.arr);
	line_no = line_no + 2;
  */  


	get_patient_name();
	

	if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
	{
	 if (l_lsr!= 0 && l_dmp== 0)
	 {
	 fprintf(fp,"%c(s3B",ESC); //11793
	 fprintf(fp,"%-23.23s ",loc_legend98.arr);  //RECEIVED DEPOSIT FROM SHOULD BE BOLD
	 fprintf(fp,"%c(s-3B",ESC); //11793
	 fprintf(fp,"%-39.39s ",d_patient_name.arr);
	 fprintf(fp,"%c(s3B",ESC); //11793				 
     fprintf(fp,"%-3.3s:",loc_legend103.arr);  //HN SHOULD BE BOLD
	 fprintf(fp,"%c(s-3B",ESC); //11793  
	 fprintf(fp,"%-10.10s ",d1_patient_id.arr);
	 fprintf(fp,"%c(s3B",ESC); //11793
	 fprintf(fp,"%-3.3s:",loc_legend104.arr);
	 fprintf(fp,"%c(s-3B",ESC); //11793
	 fprintf(fp,"%s/%-8.8s\n",d2_episode_type.arr,d2_episode_id.arr);
	 }
	 else
	 {
	 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	 if (d_oth_receipt_amt>=0)
	 fprintf(fp,"%-22.22s ",loc_legend98.arr); 
	 else
	 fprintf(fp,"%-22.22s ",loc_legend1458.arr); 
	 fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
	 fprintf(fp,"%-39.39s ",d_patient_name.arr);
	 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	 fprintf(fp,"%-3.3s:",loc_legend103.arr);  
	 fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
	 fprintf(fp,"%-10.10s ",d1_patient_id.arr);
	 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	 fprintf(fp,"%-15.15s:",loc_legend1457.arr);
	 fprintf(fp,"%cF",ESC); 		          /* To Set Release the Bold For Dotmatrix*/
	 fprintf(fp,"%s/%-8.8s\n",d2_episode_type.arr,d2_episode_id.arr);
	 }
	
	}
	else
	{
	 if (l_lsr!= 0 && l_dmp== 0)
	 {
	  if (strcmp(d2_episode_type.arr,"R")==0)
	  fprintf(fp,"%-23.23s %-39.39s  %-3.3s: %-10.10s %-3.3s: %s\n",loc_legend98.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend104.arr,d2_episode_type.arr);
	  else
	  fprintf(fp,"%-23.23s %-39.39s  %-3.3s: %-10.10s %-3.3s: %s/%-8.8s/%-s\n",loc_legend98.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend104.arr,d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);
	 }
	 else
	 {
	 
	  if (d_oth_receipt_amt>=0)
	  {
	   if (strcmp(d2_episode_type.arr,"R")==0)
	   fprintf(fp,"%-22.22s %-39.39s%-3.3s: %-10.10s %-15.15s: %s\n",loc_legend98.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend1457.arr,d2_episode_type.arr);
	   else
	   fprintf(fp,"%-22.22s %-39.39s%-3.3s: %-10.10s %-15.15s: %s/%-8.8s/%-s\n",loc_legend98.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend1457.arr,d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);
	  }
	  else
	  {
	   if (strcmp(d2_episode_type.arr,"R")==0)
	   fprintf(fp,"%-22.22s %-39.39s%-3.3s: %-10.10s %-15.15s: %s\n",loc_legend1458.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend1457.arr,d2_episode_type.arr);
	   else
	   fprintf(fp,"%-22.22s %-39.39s%-3.3s: %-10.10s %-15.15s: %s/%-8.8s/%-s\n",loc_legend1458.arr,d_patient_name.arr,
					loc_legend103.arr,d1_patient_id.arr,loc_legend1457.arr,d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);

	  }
	 }
	}
	

	 line_no = line_no + 1;
	 if(d_date_of_birth.arr[0]!='\0')
	 {
	  init_date_temp_var();
	  strcpy(date_convert.arr,d_date_of_birth.arr);
	  fun_change_loc_date2();
	  strcpy(d_date_of_birth.arr,nd_loc_date.arr);
	 }

    //fprintf(fp," %-6.6s/%-10.10s   : %-s/%-33.33s%3.3s: %-s",loc_legend680.arr,loc_legend1411.arr,d_date_of_birth.arr,d_gender_desc.arr,loc_legend104.arr,d2_episode_id.arr);  //11793
	if(d_org_dept.arr[0]!='\0')
	fprintf(fp,"\n %-10.10s: %-s\n",loc_legend690.arr,d_org_dept.arr);
	//else
	//fprintf(fp,"\n");
	line_no = line_no +1;

 return 1;			
}
/*** UPTO HERE PRINTING DEPOSIT HEADER ****/
else
{   
    //if(nd_option.arr[0]=='A') commented by raghava on 04/10/2010 for SCF-5413
	if(strcmp(d_print_yn.arr,"Y")==0)
	{
	  if (l_lsr!= 0 && l_dmp== 0)
	  {
		  fprintf(fp,"%c(s10H",ESC);	
		  fprintf(fp,"%c(s3B",ESC); 	                         /* To set Bold style */
		  fprintf(fp,"%-68.68s%-10.10s\n"," ",loc_legend19.arr);
		  fprintf(fp,"%c(s-3B",ESC);	                         /* To release bold style */
	  }
	  /**** The Below Code added by raghava at BKK ***/
	  if (l_lsr == 0 && l_dmp!= 0)
	  {
		  l_rcpt_page_no++;
		  fprintf(fp,"%-80.80s%-s%d\n"," ",loc_legend210.arr,l_rcpt_page_no);
		  fprintf(fp,"%-80.80s"," ");
		  fprintf(fp,"%cE",ESC); 		      /* To Set Bold For Dotmatrix*/ 
		  fprintf(fp,"%cW1",ESC); 		      /* To Set doble width  For Dotmatrix*/ 
		  //fprintf(fp,"%cw1",ESC); 		  /* To Set double height For Dotmatrix*/ 
		  fprintf(fp,"%-s",loc_legend19.arr);
		  //fprintf(fp,"%cw0",ESC); 		  /* To Release double height For Dotmatrix*/ 
		  fprintf(fp,"%cW0",ESC); 		      /* To Release doble width  For Dotmatrix*/ 
		  fprintf(fp,"%cF",ESC); 		      /* To Set Realse the Bold For Dotmatrix*/
		  fprintf(fp,"\n");

	  }
     /**** added by raghava at BKK on 21/01/2010***/
	}

	//prt_space_hdr();
	get_token_code(); //scf-7238
	if(strcmp(nd_preprint_flag.arr,"N")==0)
 	{
	  if (l_lsr!= 0 && l_dmp== 0)
	  {
		  fprintf(fp,"%c(s10H",ESC);	
		  fprintf(fp,"%c(s3B",ESC);  	                         /* To set Bold style */
		  prt_space();
		  fun_centre(nd_hosp_name.arr,80);
		  fprintf(fp,"%s\n",nd_hosp_name.arr);
		  prt_space();	
		  fprintf(fp,"%c(s-3B",ESC);  /*blod release*/
		  fprintf(fp,"%c(s14H",ESC);
		  //fprintf(fp,"%-35.35s%-s : %-s  %-s : %-s\n"," ",loc_legend101.arr,nd_tel.arr,loc_legend102.arr,nd_fax.arr); //Commented by vani regarding making center
		  st_tel_fax.arr[0]= '\0';
		  strcat(st_tel_fax.arr,loc_legend101.arr);
		  strcat(st_tel_fax.arr,":");
		  strcat(st_tel_fax.arr,nd_tel.arr);
		  strcat(st_tel_fax.arr,"  ");
		  strcat(st_tel_fax.arr,loc_legend102.arr);
		  strcat(st_tel_fax.arr,":");
		  strcat(st_tel_fax.arr,nd_fax.arr);
		  fun_centre(st_tel_fax.arr,110);
		  fprintf(fp,"%s\n",st_tel_fax.arr);
		  fprintf(fp,"%c(s10H",ESC);	
		  fprintf(fp,"%c(s3B",ESC); 
		  if (d_oth_receipt_amt>=0)
		  {
		    if(nd_option.arr[0]=='A')
			{
			fun_centre(loc_legend20.arr,75);
			print_underline();
			fprintf(fp,"%s\n\n",loc_legend20.arr);
			Release_underline();
			fprintf(fp,"%c(s-3B",ESC); 
			//fprintf(fp,"%40.40s\n\n",loc_legend20.arr);
			}
			if(nd_detail_type_yn.arr[0]=='Y')
		    fprintf(fp,"%45.45s",loc_legend1120.arr);
		    /** the below code added by raghava on 30/07/2010 for UAT ***/
		    if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
		    fprintf(fp,"(%-s)",loc_legend1465.arr);
		    else
		    fprintf(fp,"(%-s)",loc_legend1464.arr);
		    /** upto raghava on 30/07/2010 for UAT ***/
		  }
		  else
		  {
		   	if(nd_option.arr[0]=='A')
		    {
			 get_blng_grp_desc();
			 fun_centre(loc_legend1380.arr,100);
			 print_underline();
			 fprintf(fp,"%s\n",loc_legend1380.arr);
			 Release_underline();
			 fprintf(fp,"%c(s-3B",ESC);
			 fprintf(fp,"%c(s14H",ESC); 
			 fprintf(fp,"%-12.12s%20.20s : %-45.45s\n\n","",loc_legend1390.arr,d_blng_grp_desc.arr);
			}
		    if(nd_detail_type_yn.arr[0]=='Y')
		    {
			 fprintf(fp,"%c(s-3B",ESC);
			 fprintf(fp,"%c(s14H",ESC); 
			 fprintf(fp,"%45.45s",loc_legend1400.arr);
			 /** the below code added by raghava on 30/07/2010 for UAT ***/
			  if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
			  fprintf(fp,"(%-s)",loc_legend1465.arr);
			  else
			  fprintf(fp,"(%-s)",loc_legend1464.arr);
			 /** upto raghava on 30/07/2010 for UAT ***/
			}
		  }
		  fprintf(fp,"\n");
		  line_no = line_no + 2;
	  }
	  if (l_lsr== 0 && l_dmp!= 0)
	  {
		 //prt_space();
		 //prt_space();	
		 //fprintf(fp,"%-35.35s%-s : %-s  %-s : %-s\n"," ",loc_legend101.arr,nd_tel.arr,loc_legend102.arr,nd_fax.arr);
		 if(d_oth_receipt_amt>=0)
		 {
			  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			  if(nd_option.arr[0]=='A')
			  {
			   fun_centre(loc_legend20.arr,100);
			   fprintf(fp,"%s",loc_legend20.arr);
			  }
			  if(nd_detail_type_yn.arr[0]=='Y')
			  {
			   fun_centre(loc_legend1120.arr,100);
			   fprintf(fp,"%s",loc_legend1120.arr);
			   
			   /** the below code added by raghava on 30/07/2010 for UAT ***/
			   if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
	           fprintf(fp,"(%-s)",loc_legend1465.arr);
	           else
			   fprintf(fp,"(%-s)",loc_legend1464.arr);
			   /** upto raghava on 30/07/2010 for UAT ***/
			   
			  }
			  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
			  
			  fprintf(fp,"\n");
	
		 }
		 else
		 {
			  if(nd_option.arr[0]=='A')
			  {
			   get_blng_grp_desc();
			   fprintf(fp,"%cE",ESC); 		              /* To Set Bold For Dotmatrix*/
			   fun_centre(loc_legend1380.arr,100);
			   fprintf(fp,"%s",loc_legend1380.arr);
			   fprintf(fp,"%cF",ESC); 		              /* To Set Realse the Bold For Dotmatrix*/
			   fprintf(fp,"\n\n");
			   
			   
			   //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			   //fprintf(fp,"%-12.12s%20.20s : s\n\n","",loc_legend1390.arr);
			   //fprintf(fp,"%-45.45s\n\n",d_blng_grp_desc.arr);
			   //fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix
			  }
			  if(nd_detail_type_yn.arr[0]=='Y')
			  {
			   fprintf(fp,"%cE",ESC); 		              /* To Set Bold For Dotmatrix*/
			   fun_centre(loc_legend1400.arr,100);
			   fprintf(fp,"%s",loc_legend1400.arr);
			   /** the below code added by raghava on 30/07/2010 for UAT ***/
			   if ((strcmp(d_ref_episode_type.arr,"I")==0||strcmp(d_ref_episode_type.arr,"D")==0))
	           fprintf(fp,"(%-s)",loc_legend1465.arr);
	           else
			   fprintf(fp,"(%-s)",loc_legend1464.arr);
			   /** upto raghava on 30/07/2010 for UAT ***/
			   
			   fprintf(fp,"%cF",ESC); 		              /* To Set Realse the Bold For Dotmatrix*/
			   fprintf(fp,"\n");
			 
			  }
		 }
		  line_no = line_no + 2;
		  
		  fprintf(fp,"%-70.70s ",nd_hosp_name.arr);
		  /** the below code  added for SCF-7239 **/

          l_hig_len=0;
		  len_leg=0;
		  l_hig_len=strlen(loc_legend995.arr);
		  if(l_hig_len<strlen(loc_legend2.arr))
		  l_hig_len=strlen(loc_legend2.arr);
		  else if(l_hig_len<strlen(loc_legend3.arr))
		  l_hig_len=strlen(loc_legend3.arr);
		  else if(d_token_string.arr[0]!='\0')
		  { 
		   if(l_hig_len<strlen(loc_legend1439.arr))
		   l_hig_len=strlen(loc_legend1439.arr);
		  }
  
		  /** upto **/
		  //if(nd_option.arr[0]=='A') raghava on 29072010
		  if(nd_option.arr[0]=='A' || nd_detail_type_yn.arr[0]=='Y') //raghava on 29072010
		  {
				/*** Cash Counter ****/
			  len_desc = strlen(nd_counter_name.arr);
			  while(r_ctrdesc < len_desc)
			  {	
				split_text(nd_counter_name.arr,30,cl_string_desc,&r_ctrdesc);
				if(l_ctr==1)
				{
				  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
				  fprintf(fp,"%-s",loc_legend995.arr); //SCF-7238
                  len_leg=strlen(loc_legend995.arr);
				  while(len_leg<l_hig_len)
				  {
				   fprintf(fp," ");
				   len_leg++;
				  }
				  fprintf(fp," : ");
				  len_leg=0;
				  //upto SCF-7238

				  //fprintf(fp,"%-12.12s : ",loc_legend995.arr); SCF-7238
				  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
				  fprintf(fp,"%-30.30s ",cl_string_desc);
				}
				else
				{
				 fprintf(fp,"%-70.70s "," ");//SCF-7238
				 for(i=1;i<=(l_hig_len+3);i++)
				 {
				  fprintf(fp," ");
				 }
				 fprintf(fp,"   %-30.30s ",cl_string_desc);//SCF-7238
				 //fprintf(fp,"%-70.70s %-12.12s   %-30.30s "," "," ",cl_string_desc);SCF-7238
				}
				strcpy(cl_string_desc,"");  
				fprintf(fp,"\n");line_no = line_no + 1;
				l_ctr++;
			  } 
			  r_ctrdesc=0;
			  len_leg=0;
			  l_ctr=1;									
		  }
	  }
	 
    }

	if (l_lsr!= 0 && l_dmp== 0)	
	{		
		fprintf(fp,"%c(s14H",ESC); 
		fprintf(fp,"%-50.50s"," ");
	}
	/* commented by raghava on 29/07/2010 for UAT
	if (l_lsr== 0 && l_dmp!= 0)	
	{
	    if(nd_detail_type_yn.arr[0]=='Y')
		fprintf(fp,"%-50.50s"," ");
	}
 
   if(nd_detail_type_yn.arr[0]=='Y')
   {
     if(strcmp(nd_preprint_flag.arr,"N")==0)
	 fprintf(fp,"\n%-15.15s%-24.24s %-17.17s",loc_legend1100.arr," "," ");
	 //fprintf(fp,"\n%-15.15s%-24.24s %-17.17s",loc_legend1100.arr," ",loc_legend1120.arr);
	 else
	 fprintf(fp,"\n%-15.15s%-24.24s %-17.17s"," "," "," ");
	 line_no = line_no + 1;
     
   }*/
   if(d2_doc_date.arr[0]!='\0')
   {
	  init_date_temp_var();
	  strcpy(date_convert.arr,d2_doc_date.arr);
	  fun_change_loc_date3();
	  //fun_change_loc_date2(); //COMMNTED BY VANI REGARDING 11793
	  strcpy(d2_doc_date.arr,nd_loc_date1.arr);
   }
   if (l_lsr==0 && l_dmp!= 0)	
   {
     init_date_temp_var();
	 strcpy(date_convert.arr,d_receipt_date.arr);
	 fun_change_loc_date1();
	 //fun_change_loc_date2(); //COMMNTED BY VAN
	 //strcpy(d_receipt_date.arr,nd_loc_date1.arr);
	 strcpy(d_receipt_date_nd.arr,nd_loc_date1.arr);//changed by sarvinder for SCF-9456
   }


   if(strcmp(nd_preprint_flag.arr,"N")==0)
   {
		 if (l_lsr!=0 && l_dmp== 0)	
		 {
			
			  if(nd_detail_type_yn.arr[0]=='Y') //raghava on 29072010
			  {
				  
				  prt_space();
				  fprintf(fp,"%-17.17s "," ");
				  /*** Cash Counter ****/
				  len_desc = strlen(nd_counter_name.arr);
				  while(r_ctrdesc < len_desc)
				  {	
					split_text(nd_counter_name.arr,30,cl_string_desc,&r_ctrdesc);
					if(l_ctr==1)
					{
					  fprintf(fp,"%c(s3B",ESC);		          /* To Set Bold For Dotmatrix*/
					  fprintf(fp,"%-12.12s : ",loc_legend995.arr);
					  fprintf(fp,"%c(s-3B",ESC);             /* To Set Realse the Bold For Dotmatrix*/
					  fprintf(fp,"%-30.30s ",cl_string_desc);
					}
					else
					fprintf(fp,"%-70.70s %-12.12s   %-30.30s "," "," ",cl_string_desc);
					strcpy(cl_string_desc,"");  
					fprintf(fp,"\n");line_no = line_no + 1;
					l_ctr++;
				  } 
				  r_ctrdesc=0;
				  l_ctr=1;									
			      fprintf(fp,"%67s "," ");
			  }
			
			
			if(l_logo_yniflaser.arr[0] == 'Y')
			{
				prt_space();
				fprintf(fp,"%c(s3B",ESC);
				if(d_oth_receipt_amt>=0)
				fprintf(fp,"%-s:",loc_legend2.arr);
				else
				fprintf(fp,"%-s:",loc_legend1449.arr);
				fprintf(fp,"%c(s-3B",ESC);
				fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
				fprintf(fp,"%67s "," ");
				fprintf(fp,"%c(s3B",ESC);
				fprintf(fp,"%4.4s : ",loc_legend3.arr); //added by vani
				fprintf(fp,"%c(s-3B",ESC);
				fprintf(fp,"%-s\n",d2_doc_date.arr);  //added by vani
			
			}
			else
			{	
				prt_space();
				fprintf(fp,"%c(s3B",ESC);
				if(d_oth_receipt_amt>=0)
				fprintf(fp,"%-s:",loc_legend2.arr);	
				else
				fprintf(fp,"%-s:",loc_legend1449.arr);	
				fprintf(fp,"%c(s-3B",ESC);		     
				fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
				fprintf(fp,"%67s "," ");
				fprintf(fp,"%c(s3B",ESC);
				fprintf(fp,"%4.4s : ",loc_legend3.arr); //added by vani
				fprintf(fp,"%c(s-3B",ESC);
				fprintf(fp,"%-s\n",d2_doc_date.arr);  //added by vani
			
			}
		
			line_no = line_no + 1;
	   }
	   if (l_lsr==0 && l_dmp!= 0)
	   {
         //if(nd_option.arr[0]=='A') raghava 29/07/2010 for UAT
		 if(nd_option.arr[0]=='A' || nd_detail_type_yn.arr[0]=='Y') //raghava on 29/07/2010
		 {
	      fprintf(fp,"%-70.70s ",nd_hosp_add.arr," ");
		  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix/
		  if(d_oth_receipt_amt>=0)
		  {
		   //fprintf(fp,"%-10.10s: ",loc_legend2.arr); scf-7238
		   fprintf(fp,"%-s",loc_legend2.arr);
		   len_leg=strlen(loc_legend2.arr);
		   while(len_leg<l_hig_len)
		   {
		    fprintf(fp," ");
		    len_leg++;
		   }
		   fprintf(fp," : ");
		   len_leg=0;
		   
		  }
		  else
		  {
		   //fprintf(fp,"%-10.10s: ",loc_legend1449.arr);
		   fprintf(fp,"%-s",loc_legend1449.arr);
		   len_leg=strlen(loc_legend1449.arr);
		   while(len_leg<l_hig_len)
		   {
		    fprintf(fp," ");
		    len_leg++;
		   }
		   fprintf(fp," : ");
		   len_leg=0;
		  }

		  fprintf(fp,"%cF",ESC); 		          //To Set Release the Bold For Dotmatrix/
		  fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
		  fprintf(fp,"%-70.70s ",nd_hosp_add1.arr);
		  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
		  //fprintf(fp,"%-10.10s: ",loc_legend3.arr); 
		  fprintf(fp,"%-s",loc_legend3.arr);  //scf-7238
		  len_leg=strlen(loc_legend3.arr);
		   while(len_leg<l_hig_len)
		   {
		    fprintf(fp," ");
		    len_leg++;
		   }
		   fprintf(fp," : ");
		   len_leg=0;
		  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
		  //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
		  fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
          fprintf(fp,"\n");line_no = line_no + 2;
		}

	  }
	 
	 
	 //**** The Below code added by raghava at BKK on 21/01/2010 ****/
	  /*
	  if (l_lsr==0 && l_dmp!= 0)
	  {

		if(nd_option.arr[0]=='A')
		{
		  len_desc = strlen(nd_hosp_add.arr);
		  while(r_ctrdesc < len_desc)
		  {	
			split_text(nd_hosp_add.arr,70,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			{
			  fprintf(fp,"%-70.70s %-13.13s",cl_string_desc," ");
			  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix
			  if(d_oth_receipt_amt>=0)
			  fprintf(fp,"%-20.20s: ",loc_legend2.arr);
			  else
			  fprintf(fp,"%-20.20s:",loc_legend1449.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  fprintf(fp," %-s/%-s",d_doc_type_code1.arr,d_doc_number1.arr);
			}
			else
			if(l_ctr==2)
			{
		
			 fprintf(fp,"%-70.70s ",cl_string_desc);
			 fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			 fprintf(fp,"%-10.10s : ",loc_legend3.arr);
			 fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			 //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			 fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			}
			else
			fprintf(fp,"%-70.70s %-13.13s",cl_string_desc," ");
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");line_no = line_no + 1;
			l_ctr++;
		  } 
		  r_ctrdesc=0;
		  
		  if(l_ctr==1)
			{
			  fprintf(fp,"%-70.70s %-13.13s",cl_string_desc," ");
			  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix
			  if(d_oth_receipt_amt>=0)
			  fprintf(fp,"%-20.20s: ",loc_legend2.arr);
			  else
			  fprintf(fp,"%-20.20s:",loc_legend1449.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  fprintf(fp," %-s/%-s",d_doc_type_code1.arr,d_doc_number1.arr);
			  fprintf(fp,"\n");line_no = line_no + 1;
         	
			  fprintf(fp,"%-70.70s ",cl_string_desc);
			  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			  fprintf(fp,"%-10.-10s : ",loc_legend3.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			  fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			  fprintf(fp,"\n");line_no = line_no + 1;
			}
           if(l_ctr==2)
		   {
		    
			  fprintf(fp,"%-70.70s ",cl_string_desc);
			  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			  fprintf(fp,"%-10.10s : ",loc_legend3.arr);
			  fprintf(fp,"%cF",ESC); 		          // To Set Release the Bold For Dotmatrix
			  //fprintf(fp,"%-s %-s",d_receipt_date.arr,loc_legend1424.arr);
			  fprintf(fp,"%-s %-s",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
			  fprintf(fp,"\n");line_no = line_no + 1;
		   }
		
		  l_ctr=1;
		}
	  }	
	  */
	 /**** UPTO Here *****/	



  }

 else
 {
   

	if(l_lsr!=0 && l_dmp== 0)
	{
	 fprintf(fp,"%28s "," ");
	 fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
	 fprintf(fp,"%67s "," ");
	 fprintf(fp,"%-s\n",d2_doc_date.arr);
	 line_no = line_no + 1;
	}
	if (l_lsr==0 && l_dmp!= 0) 
	{
	 fprintf(fp,"%28.28s "," ");
	 if(strcmp(d_receipt_nature_code.arr,"AR")!=0)						 //10/01/2010 for CRF-561								
	 if(nd_option.arr[0]=='A' || nd_detail_type_yn.arr[0]=='Y') //raghava on 29072010									         //10/01/2010 for CRF-561								
	 {
	  //fprintf(fp," %-s\n",nd_counter_name.arr);						     //10/01/2010 for CRF-561
	  //fprintf(fp,"%77.77s  "," ");	
	  //line_no = line_no + 1;
	  
	  len_desc = strlen(nd_counter_name.arr);
	  while(r_ctrdesc < len_desc)
	  {	
		split_text(nd_counter_name.arr,25,cl_string_desc,&r_ctrdesc);
		if(l_ctr==1)
		{
		  fprintf(fp,"%-48.48s   "," ");
		  fprintf(fp,"%-25.25s ",cl_string_desc);
		}
		else
		fprintf(fp,"%-70.70s %-12.12s   %-25.25s "," "," ",cl_string_desc);
		strcpy(cl_string_desc,"");  
		fprintf(fp,"\n");line_no = line_no + 1;
		l_ctr++;
	  } 
	  r_ctrdesc=0;
	  l_ctr=1;	
	  										     //10/01/2010 for CRF-561
	 }
	 fprintf(fp,"%77.77s  "," ");
	 fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);
	 line_no = line_no + 1;
	}
   
    //if(nd_option.arr[0]=='A')  raghava on 29072010 
	if(nd_option.arr[0]=='A' || nd_detail_type_yn.arr[0]=='Y') //raghava on 29072010									        
	{
	 fprintf(fp,"%77.77s   "," ");
	 //fprintf(fp,"%-s %-s\n",d_receipt_date.arr,loc_legend1424.arr);
	 fprintf(fp,"%-s %-s\n",d_receipt_date_nd.arr,loc_legend1424.arr);//changed by sarvinder for SCF-9456
	 //fprintf(fp,"%-s\n",d2_doc_date.arr);
	}
 
 }
 /* commented by raghava on 30/07/2010 for UAT 
 if(nd_detail_type_yn.arr[0]=='Y')
 {
 	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 fprintf(fp,"%-20.20s",loc_legend1110.arr);
	 else
	 fprintf(fp,"%-20.20s   "," ");
	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 fprintf(fp,"%59.59s : ",loc_legend3.arr);
	 else
	 fprintf(fp,"%59.59s     "," ");
	 fprintf(fp,"%-s\n",d2_doc_date.arr);
 }
 upto 30/07/2010 for UAT */

line_no = line_no + 1;

//get_token_code(); scf-7238
//if(nd_detail_type_yn.arr[0]=='Y')
if (l_lsr!=0 && l_dmp== 0) 
{
	if(d_token_string.arr[0]!='\0')
	{
		if(strcmp(nd_preprint_flag.arr,"N")==0)
		fprintf(fp," %77.77s  ",loc_legend61.arr);
		else
		fprintf(fp," %77.77s  "," ");
		fprintf(fp,"%-2s",d_token_string.arr);
		fprintf(fp,"\n");
		line_no = line_no +1;
	}
}

get_patient_name();

/*** Invoice Header Part *****/ 

if(strcmp(d_receipt_nature_code.arr,"AR")==0 && nd_pmnt_ref_num.arr[0]!='\0')
{

	get_payer_name();
	if(d_customer_name.arr[0]!='\0')
	{
	 
	 //fetch_customer(); Commented by raghava for CRF-521 instead of long_name printing detail_desc
	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 {
	  if (l_lsr!= 0 && l_dmp== 0)
	  fprintf(fp,"%c(s3B",ESC);				  /* To Set Bold For Laser*/
	  if (l_lsr== 0 && l_dmp!= 0)
      fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	  fprintf(fp," %-15.15s: ",loc_legend16.arr);
	  if (l_lsr!= 0 && l_dmp== 0)
	  fprintf(fp,"%c(s-3B",ESC);			  /* To Set Bold For Laser*/
	  if (l_lsr== 0 && l_dmp!= 0)
	  fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	 }
	 else
	 fprintf(fp," %-15.15s  "," ");
	 fprintf(fp,"%-s",d_customer_name.arr);	 
	 /*if(l_payer_name_exsts==0) 
	 fprintf(fp,"(%-s)",d2_customer_code.arr);	 */
         line_no = line_no +1;	
	}
	else
	{
 
	   //Below Code Added by Raghava on 28/10/2009 for IN13922
		get_detail_desc_for_cust();
		len_desc = strlen(l_detail_desc.arr);
		while(r_ctrdesc < len_desc)
		{	
			split_text(l_detail_desc.arr,44,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			{

			 if(strcmp(nd_preprint_flag.arr,"N")==0)
			 {
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s3B",ESC);				  /* To Set Bold For Laser*/
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			  fprintf(fp," %-15.15s: ",loc_legend16.arr);
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s-3B",ESC);			  /* To Set Bold For Laser*/
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
			  fprintf(fp,"%-s",cl_string_desc);
			  /*
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s3B",ESC);				  // To Set Bold For Laser
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
			  fprintf(fp,"      %-10.10s: ",loc_legend1160.arr);
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s-3B",ESC);			  // To Set Bold For Laser
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cF",ESC); 		          // To Release Bold For Dotmatrix
			  */
			 }
			 else
			 {
			  fprintf(fp," %-20.20s: %-s"," ",cl_string_desc);
			 }
			 fprintf(fp,"(%-s)",d2_customer_code.arr);
			 
			}
			else
			fprintf(fp," %-20.20s  %-s"," ",cl_string_desc);
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");line_no = line_no +1;
			l_ctr++;
		} 
		r_ctrdesc=0;
		l_ctr=1;
		// upto 28/10/2009 for IN13922
	}
 
	if(d_receipt_by_inv_yn.arr[0]=='Y')
	{
	 if(d_print_patient_dtl_yn.arr[0]=='Y')
	 { 
	  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
	  fprintf(fp," %-s :%-s %-s   ",loc_legend103.arr,d_inv_patient.arr,d_inv_pat_name.arr);
      fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/
	  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
	  fprintf(fp,"%-s: ",loc_legend1457.arr);
	  fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/

	  if ((strcmp(d_ref_episode_type.arr,"I")==0||strcmp(d_ref_episode_type.arr,"D")==0))
	  {
		fprintf(fp,"%-1.1s/%-8.8s\n",d_ref_episode_type.arr,d_ref_episode_id.arr);
	  }
	  if ((strcmp(d_ref_episode_type.arr,"O")==0||strcmp(d_ref_episode_type.arr,"E")==0))
	   {
		fprintf(fp,"%-1.1s/%-8.8s/%-s\n",d_ref_episode_type.arr,d_ref_episode_id.arr,d_ref_visit_id.arr);
	   }
	  if (strcmp(d_ref_episode_type.arr,"R")==0)
	   {
		fprintf(fp,"%-1.1s\n",d_ref_episode_type.arr);
	   }
 
		line_no = line_no +1;
	 }
	}
	
	

}
else
if(strcmp(d_receipt_nature_code.arr,"AR")==0)
{

	/*
	fetch_customer();
    if(strcmp(nd_preprint_flag.arr,"N")==0)
	fprintf(fp," %-20.20s: ",loc_legend16.arr);
	else
	fprintf(fp," %-20.20s  "," ");
	fprintf(fp,"%-44.44s",d_customer_name.arr);
	 Commented by raghava for CRF-521 instead of long_name printing detail_desc*/

	//Below Code Added by Raghava on 28/10/2009 for IN13922
	get_detail_desc_for_cust();
	len_desc = strlen(l_detail_desc.arr);
	while(r_ctrdesc < len_desc)
	{	
		split_text(l_detail_desc.arr,44,cl_string_desc,&r_ctrdesc);
		if(l_ctr==1)
		{
		 if(strcmp(nd_preprint_flag.arr,"N")==0)
		 {
		      if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s3B",ESC);				  /* To Set Bold For Laser*/
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
			  fprintf(fp," %-15.15s: ",loc_legend16.arr);
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s-3B",ESC);			  /* To Set Bold For Laser*/
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
			  fprintf(fp,"%-s",cl_string_desc);
			  /*
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s3B",ESC);				  // To Set Bold For Laser
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cE",ESC); 		          //To Set Bold For Dotmatrix
			  fprintf(fp,"    %-15.15s: ",loc_legend1160.arr);
			  if (l_lsr!= 0 && l_dmp== 0)
			  fprintf(fp,"%c(s-3B",ESC);			  //To Set Bold For Laser
			  if (l_lsr== 0 && l_dmp!= 0)
			  fprintf(fp,"%cF",ESC); 		          // To Release Bold For Dotmatrix
			  */
		 }
		 else
		 {
		  fprintf(fp," %-20.20s: %-s"," ",cl_string_desc);
		 }
		 fprintf(fp,"(%-s)",d2_customer_code.arr);
		 
		}
		else
		fprintf(fp," %-20.20s  %-s"," ",cl_string_desc);
		strcpy(cl_string_desc,"");  
		fprintf(fp,"\n");lsr_line_cnt();
		l_ctr++;
	} 
	r_ctrdesc=0;
	l_ctr=1;
  // upto 28/10/2009 for IN13922

    if(d_receipt_by_inv_yn.arr[0]=='Y')
	{
	 if(d_print_patient_dtl_yn.arr[0]=='Y')
	 {
	  fprintf(fp,"%cE",ESC); 		          // To Set Bold For Dotmatrix
	  fprintf(fp," %-s :%-s %-s   ",loc_legend103.arr,d_inv_patient.arr,d_inv_pat_name.arr);
      fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/
	  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
	  fprintf(fp,"%-s: ",loc_legend1457.arr);
	  fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/

	  if ((strcmp(d_ref_episode_type.arr,"I")==0||strcmp(d_ref_episode_type.arr,"D")==0))
	  {
		fprintf(fp,"%-1.1s/%-8.8s\n",d_ref_episode_type.arr,d_ref_episode_id.arr);
	  }
	  if ((strcmp(d_ref_episode_type.arr,"O")==0||strcmp(d_ref_episode_type.arr,"E")==0))
	   {
		fprintf(fp,"%-1.1s/%-8.8s/%-s\n",d_ref_episode_type.arr,d_ref_episode_id.arr,d_ref_visit_id.arr);
	   }
	  if (strcmp(d_ref_episode_type.arr,"R")==0)
	   {
		fprintf(fp,"%-1.1s\n",d_ref_episode_type.arr);
	   }
 
		line_no = line_no +1;
	 }
	}
  
}

else
{

//BANGKOK
	
	if(strcmp(nd_preprint_flag.arr,"N")==0)
	{
		 if (l_lsr==0 && l_dmp!= 0)  //added by vani 
		 {
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		 fprintf(fp,"%-s: ",loc_legend9.arr); //scf-7238
		 //fprintf(fp,"%-15.15s: ",loc_legend9.arr); //scf-7238
		 fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
		 }
		
		if (l_lsr!=0 && l_dmp== 0)  //added by vani 
		 {
		 fprintf(fp,"%c(s3B",ESC); 		          /* To Set Bold For */
		 fprintf(fp,"%-15.15s: ",loc_legend9.arr);
		 fprintf(fp,"%c(s-3B",ESC);		          /* To Release Bold For */
		 }

	}
	else
	fprintf(fp,"%-15.15s  "," ");
	len_leg=0;//SCF-7238
    pat_len=0;//SCF-7238
	if(nd_detail_type_yn.arr[0]=='Y')				     //raghava on 30/07/2010 for UAT
	{
	 len_leg=69-(strlen(loc_legend9.arr)+2);
	 strncpy(c1_pat_name.arr,d_patient_name.arr,len_leg);
	 pat_len=strlen(c1_pat_name.arr);
	 while(pat_len<len_leg)
	 {
	  strcat(c1_pat_name.arr," ");
	  pat_len++;
	 }
     c1_pat_name.len=strlen(c1_pat_name.arr);
	 fprintf(fp,"%-s",c1_pat_name.arr);
	 //fprintf(fp,"%-52.52s",d_patient_name.arr); scf-7238 //raghava on 30/07/2010 for UAT
	}
	else										        //raghava on 30/07/2010 for UAT
    {
	 len_leg=52-(strlen(loc_legend9.arr)+2);
	 strncpy(c1_pat_name.arr,d_patient_name.arr,len_leg);
	 pat_len=strlen(c1_pat_name.arr);
	 while(pat_len<len_leg)
	 {
	  strcat(c1_pat_name.arr," ");
	  pat_len++;
	 }
     c1_pat_name.len=strlen(c1_pat_name.arr);
	 fprintf(fp,"%-s",c1_pat_name.arr);
	 //fprintf(fp,"%-35.35s",d_patient_name.arr); //scf-7238
	}
    len_leg=0;//SCF-7238
    pat_len=0;//SCF-7238

	/**** The below code added by raghava on 10/01/2010 for CRF-561	***/ 
	if (l_lsr==0 && l_dmp!= 0) 
	{
	 if(nd_option.arr[0]=='A')
	 {
	  if(strcmp(nd_preprint_flag.arr,"Y")==0)
	  {

	   fprintf(fp,"%-3.3s%-8.8s"," ",d1_patient_id.arr);
	   //fprintf(fp,"%26.26s "," ");
	   //fprintf(fp,"%-35.35s",d_location.arr);
		  
	  }
	  else
	  {
	   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	   fprintf(fp,"%-2.2s: ",loc_legend103.arr);
	   fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	   fprintf(fp,"%-8.8s",d1_patient_id.arr);
	   //fprintf(fp,"%28.28s "," ");
	   //fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	   //fprintf(fp,"%-8.8s: ",loc_legend1407.arr);
	   //fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	   /*
	   get_location();
	   if(d_location.arr[0]!='\0')
	   {
		 fprintf(fp,"%-35.35s",d_location.arr);
	   }*/
	  }
	  //fprintf(fp,"\n");line_no = line_no +1;
	 } 
	 
    }
   /**** upto here	***/


	if (l_lsr==0 && l_dmp!= 0) 
	{ 
	 if(nd_option.arr[0]=='A')
	 {
	  if(strcmp(nd_preprint_flag.arr,"Y")==0)
	  {
	    fprintf(fp,"%-7.7s"," ");
		if(d_token_string.arr[0]!='\0')
		{
		 //fprintf(fp,"%-10.10s  "," ");//scf-7238
	      for(i=1;i<l_hig_len;i++)
		  {
		   fprintf(fp," ");
		   len_leg++;
		  }
	    
		 len_desc = strlen(d_token_string.arr);
		 while(r_ctrdesc < len_desc)
		{	
			split_text(d_token_string.arr,30,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			{
			  fprintf(fp,"%-30.30s",cl_string_desc);
	 		}
			else
			fprintf(fp,"%-70.70s%-30.30s"," ",cl_string_desc);
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");lsr_line_cnt();
			l_ctr++;
		} 
		r_ctrdesc=0;
		l_ctr=1;
		 
		 //fprintf(fp,"%-s",d_token_string.arr);
		 //fprintf(fp,"\n");
		}
		else
		fprintf(fp,"\n");
		line_no = line_no +1;
	  
	  }
	  else
	  {
	    if(d_token_string.arr[0]!='\0')
		{
		 fprintf(fp,"%-7.7s"," ");
		 fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	     //fprintf(fp,"%-13.13s: ",loc_legend1439.arr); scf-7238
		 fprintf(fp,"%-s",loc_legend1439.arr); //scf-7238
		 len_leg=0;
		 len_leg=strlen(loc_legend1439.arr);
		  while(len_leg<l_hig_len)
		  {
		   fprintf(fp," ");
		   len_leg++;
		  }
		  fprintf(fp," : ");
		  len_leg=0;

	     fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	     
		len_desc = strlen(d_token_string.arr);
		while(r_ctrdesc < len_desc)
		{	
			split_text(d_token_string.arr,30,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			{
			  fprintf(fp,"%-30.30s",cl_string_desc);
	 		}
			else
			fprintf(fp,"%-70.70s%-40.40s"," ",cl_string_desc);
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");lsr_line_cnt();
			l_ctr++;
		} 
		r_ctrdesc=0;
		len_leg=0;
		l_ctr=1;
		 
		 //fprintf(fp,"%-s",d_token_string.arr);
		 //fprintf(fp,"\n");
		}
		else
		fprintf(fp,"\n");
		line_no = line_no +1;
	  }
	 }
	/*** Print Encounter Id ****/
    
	if(strcmp(d_receipt_nature_code.arr,"AR")!=0)
    {
	  		
		if(nd_detail_type_yn.arr[0]=='Y')
		{
		     if(strcmp(nd_preprint_flag.arr,"N")==0)
			 {
				 fprintf(fp,"%cE",ESC); 		      //To Set the Bold For Dotmatrix
				 fprintf(fp,"%-2.2s: ",loc_legend103.arr);
				 fprintf(fp,"%cF",ESC); 		      //To Set the Bold For Dotmatrix
			 }
			 else
			 fprintf(fp,"%-2.2s  "," "); 
			 fprintf(fp,"%-s\n",d1_patient_id.arr);
			 line_no = line_no +1;
		}
		else
		{
			if(d3_bill_doc_type_code.arr[0]!='\0')
			{
			 if(strcmp(nd_preprint_flag.arr,"N")==0)
			 {
				 fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
				 fprintf(fp,"%-s: ",loc_legend1457.arr); //ICN-323
				 //fprintf(fp,"%-15.15s: ",loc_legend1457.arr); ICN-323
				 fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/
			 }
			 else
			 fprintf(fp,"%-15.15s  "," "); 
			  if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
			  {
				fprintf(fp,"%-1.1s/%-8.8s\n",d2_episode_type.arr,d2_episode_id.arr);
			  }
			  if ((strcmp(d2_episode_type.arr,"O")==0||strcmp(d2_episode_type.arr,"E")==0))
			   {
				fprintf(fp,"%-1.1s/%-8.8s/%-s\n",d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);
			   }
			  if (strcmp(d2_episode_type.arr,"R")==0)
			   {
				fprintf(fp,"%-1.1s\n",d2_episode_type.arr);
			   }
 
			line_no = line_no +1;

			}
			else
			{
				get_encounter_id(1);
				if(strcmp(nd_preprint_flag.arr,"N")==0)
				{
				 fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
				 fprintf(fp,"%-s: ",loc_legend1457.arr);//ICN-323
				 //fprintf(fp,"%-15.15s: ",loc_legend1457.arr);ICN-323
				 fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/
				}
				else
				fprintf(fp,"%-15.15s  "," ");
				fprintf(fp,"%-s\n",nd_encounter_id.arr);
				line_no = line_no +1; 
     
			}
	      }
	   }
	}
/*** added by raghava on 02/08/2010 ****/
   if (l_lsr!=0 && l_dmp== 0)
   {
   	/*** Print Encounter Id ****/
    
	if(strcmp(d_receipt_nature_code.arr,"AR")!=0)
    {
	  		
		if(nd_detail_type_yn.arr[0]=='Y')
		{
		     if(strcmp(nd_preprint_flag.arr,"N")==0)
			 {
				 fprintf(fp,"%c(s3B",ESC);		      //To Set the Bold For Dotmatrix
				 fprintf(fp,"%-2.2s: ",loc_legend103.arr);
				 fprintf(fp,"%c(s-3B",ESC); 		  //To Release the Bold For Dotmatrix
			 }
			 else
			 fprintf(fp,"%-2.2s  "," "); 
			 fprintf(fp,"%-s\n",d1_patient_id.arr);
			 line_no = line_no +1;
		
	     }
	   }
     }
}

//if(nd_detail_type_yn.arr[0]=='Y')
//fprintf(fp,"%-7.7s"," ");
if(strcmp(d_receipt_nature_code.arr,"AR")==0)
{

	/*if(strcmp(nd_preprint_flag.arr,"N")==0)
	fprintf(fp," %-10.10s: ",loc_legend1160.arr);	
	else
	fprintf(fp," %-10.10s  "," ");
	fprintf(fp,"%-s",d2_customer_code.arr);        Commented By raghava on 29/10/2009 for CRF-521  */
	fprintf(fp,"(%-s)",d2_customer_code.arr);	

}
else
{
	
	 if(nd_detail_type_yn.arr[0]=='Y')				//added by raghava at BKK for CRF-561
	 {	
	  if(strcmp(nd_preprint_flag.arr,"N")==0)
	  fprintf(fp," %7.7s: ",loc_legend103.arr);	 
	  else
	  fprintf(fp," %7.7s  "," ");
	  fprintf(fp,"%-s",d1_patient_id.arr);
	 }  
    
    
	 if(d_date_of_birth.arr[0]!='\0')
	 {
	  init_date_temp_var();
	  strcpy(date_convert.arr,d_date_of_birth.arr);
	  fun_change_loc_date2();
	  strcpy(d_date_of_birth.arr,nd_loc_date.arr);
	 }

	 
	 if((l_lsr!=0 && l_dmp== 0) && nd_option.arr[0]=='A')  //added by raghava at BKK for CRF-561
	 if(strcmp(nd_preprint_flag.arr,"N")==0)
	 {
	  
	  fprintf(fp,"%c(s3B",ESC);
	  fprintf(fp," %7.7s: ",loc_legend103.arr); //added by vani regarding 18896
	  fprintf(fp,"%c(s-3B",ESC);
	  fprintf(fp,"%-s",d1_patient_id.arr);
	  fprintf(fp,"%c(s3B",ESC);
	  fprintf(fp," %5.5s: ",loc_legend104.arr);
	  fprintf(fp,"%c(s-3B",ESC);

	  /* commented by raghava on 10/01/2010 for CRF-561
	  else
	  fprintf(fp," %5.5s "," ");
      */

	 if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
	  {
	    fprintf(fp,"%-1.1s/%-8.8s\n",d2_episode_type.arr,d2_episode_id.arr);
	  }
	  if ((strcmp(d2_episode_type.arr,"O")==0||strcmp(d2_episode_type.arr,"E")==0))
	   {
		fprintf(fp,"%-1.1s/%-8.8s/%-s\n",d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);
	   }
	  if (strcmp(d2_episode_type.arr,"R")==0)
	   {
		fprintf(fp,"%-1.1s\n",d2_episode_type.arr);
	   }

      }
	  else  //else part added by vani regarding 18896
	  {
		  fprintf(fp," %7.7s "," ");
		  fprintf(fp,"%-s",d1_patient_id.arr);
		  fprintf(fp," %5.5s "," ");
		  
		 if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
		  {
			fprintf(fp,"%-1.1s/%-8.8s\n",d2_episode_type.arr,d2_episode_id.arr);
		  }
		  if ((strcmp(d2_episode_type.arr,"O")==0||strcmp(d2_episode_type.arr,"E")==0))
		   {
			fprintf(fp,"%-1.1s/%-8.8s/%-s\n",d2_episode_type.arr,d2_episode_id.arr,d2_visit_id.arr);
		   }
		  if (strcmp(d2_episode_type.arr,"R")==0)
		   {
			fprintf(fp,"%-1.1s\n",d2_episode_type.arr);
		   }
		
	  }

    //Added by vani for Printing Organization & Dept
		
	 /* if(strcmp(nd_preprint_flag.arr,"N")==0)
	    fprintf(fp," %-6.6s/%-10.10s   : %-s/%-33.33s%3.3s: %-s",loc_legend680.arr,loc_legend1411.arr,d_date_of_birth.arr,d_gender_desc.arr,loc_legend104.arr,d2_episode_id.arr);
	  else
		fprintf(fp," %-17.17s     %-s"," ",d_date_of_birth.arr);*/  //11793
	   
	   if(d_org_dept.arr[0]!='\0')
	   {
		if((nd_detail_type_yn.arr[0]=='Y')||(l_lsr!=0 && l_dmp== 0))  //added by raghava at BKK for CRF-561
		{
		 if(strcmp(nd_preprint_flag.arr,"N")==0)
		 fprintf(fp,"\n %-10.10s: %-s\n",loc_legend690.arr,d_org_dept.arr);
		 else
		 fprintf(fp,"\n %-10.10s  %-s\n"," ",d_org_dept.arr);
		 line_no = line_no +1;
		}
	   }

			
}
line_no = line_no +1;

/*** Printing Ward and Admission Date ***/
if(nd_detail_type_yn.arr[0]=='Y')
{
 
 get_ward_desc();
 get_adm_dis_date();

if(dc_admn_date.arr[0]!='\0')
{
	init_date_temp_var();
	strcpy(date_convert.arr,dc_admn_date.arr);
	fun_change_loc_date2();
	strcpy(dc_admn_date.arr,date_convert.arr);
}
if(d_dis_date.arr[0]!='\0')
{
	init_date_temp_var();
	strcpy(date_convert.arr,d_dis_date.arr);
	fun_change_loc_date2();
	strcpy(d_dis_date.arr,date_convert.arr);
}
if(strcmp(nd_preprint_flag.arr,"N")==0)
{

	if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
	{
		if (l_lsr==0 && l_dmp!= 0) 
		{
		  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
          fprintf(fp,"%-30.30s:  ",loc_legend1140.arr);
		  fprintf(fp,"%cF",ESC); 		      /* To Release the Bold For Dotmatrix*/
		}
		else
		{
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-30.30s:  ",loc_legend1140.arr);
		 fprintf(fp,"%c(s-3B",ESC);
		}


		fprintf(fp,"%-10.10s - %-10.10s %-13.13s ",dc_admn_date.arr,d_dis_date.arr," ");


		if (l_lsr==0 && l_dmp!= 0) 
		{
		  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
		  fprintf(fp,"%-10.10s: ",loc_legend104.arr);
		  fprintf(fp,"%cF",ESC); 		      /* To Release the Bold For Dotmatrix*/
		}
		else
        {
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-10.10s: ",loc_legend104.arr);
		 fprintf(fp,"%c(s-3B",ESC);
		}
		fprintf(fp,"%-s/%-8.8s\n",d1_episode_type.arr,d1_episode_id.arr);

		if (l_lsr==0 && l_dmp!= 0) 
		{
		  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
		  fprintf(fp,"%-20.20s:  ",loc_legend1130.arr);
		  fprintf(fp,"%cF",ESC); 		      /* To Release the Bold For Dotmatrix*/
		}
		else
		{
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-20.20s:  ",loc_legend1130.arr);
		 fprintf(fp,"%c(s-3B",ESC);
	    }	
		fprintf(fp,"%-40.40s\n",d_ward_code_desc.arr);
		line_no = line_no +2;
	}
	else
	{
		if (l_lsr==0 && l_dmp!= 0) 
		{
		  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
		  fprintf(fp,"%-30.30s:  ",loc_legend1140.arr);
		  fprintf(fp,"%cF",ESC); 		      /* To Release the Bold For Dotmatrix*/
		}
		else
		{
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-30.30s:  ",loc_legend1140.arr);
		 fprintf(fp,"%c(s-3B",ESC);
		}
		fprintf(fp,"%-10.10s - %-10.10s %-13.13 ",dc_admn_date.arr,dc_admn_date.arr," ");
		
		if (l_lsr==0 && l_dmp!= 0) 
		{
		  fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
		  fprintf(fp,"%-10.10s: ",loc_legend104.arr);
		  fprintf(fp,"%cF",ESC); 		      /* To Release the Bold For Dotmatrix*/
		}
		else
		{
		 fprintf(fp,"%c(s3B",ESC);
		 fprintf(fp,"%-10.10s: ",loc_legend104.arr);
		 fprintf(fp,"%c(s-3B",ESC);
		}
		fprintf(fp,"%-s/%-8.8s/%-s\n",d1_episode_type.arr,d1_episode_id.arr,d1_visit_id.arr);
		
		line_no = line_no +1;
	}
}
else
{
	if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
	{
		fprintf(fp,"%-20.20s  %-10.10s - %-10.10s %-25.25s %-2.2s %-s/%-8.8s\n"," ",dc_admn_date.arr,d_dis_date.arr," "," ",d1_episode_type.arr,d1_episode_id.arr);
		fprintf(fp,"%-20.20s  %-40.40s\n"," ",d_ward_code_desc.arr);
		line_no = line_no +2;
	}
	else
	{
		fprintf(fp,"%-20.20s  %-10.10s - %-10.10s %-25.25s %-2.2s %-s/%-8.8s/%-s\n"," ",dc_admn_date.arr,dc_admn_date.arr," "," ",d1_episode_type.arr,d1_episode_id.arr,d1_visit_id.arr);
		line_no = line_no +1;
	}
}

}

}//else end

//fprintf(fp,"\n");

v_lno=line_no;
line_no=0;


}
get_org_deposit()
{
      declare_ref_cur();
      open_ref_cur(); 
      while(fetch_ref_cur())
      {
       if(strcmp(d5_ref_dep_doc_type_code.arr,"\0")!=0 && strcmp(d5_ref_dep_doc_number.arr,"\0")!=0)
	   {	
	
	    EXEC SQL EXECUTE
		BEGIN
		 :d_org_dep_code:=BLCOMMON.GET_ORG_DOC(:nd_facility_id,
			    :d5_ref_dep_doc_type_code,
				:d5_ref_dep_doc_number,
				:d5_ref_dep_doc_srno,
				:d_org_dep_doc_type_code,
				:d_org_dep_doc_number,
				:d_org_dep_doc_srno);
		END;
		END-EXEC;
	     

		
	
       }
      }
      close_ref_cur();
      d5_org_dep_code.arr[0]='\0';
      d5_org_dep_code.len=0;
      exec sql select substr(:d_org_dep_code,1,instr(:d_org_dep_code,'/',1,2)-1) 
			   into :d5_org_dep_code 
			   from dual;

      d5_org_dep_code.arr[d5_org_dep_code.len]='\0';
}
/* This function for getting Token String*/
get_token_code()
{

	d_token_string.arr[0]='\0';
	d_token_string.len=0;
  if (l_lsr != 0 && l_dmp == 0)
  {
  	EXEC SQL EXECUTE
	BEGIN

	:d_token_string:=bltvsbil.BL_GET_TOKEN_NUMBER_STRING(
		:nd_facility_id,
		:d2_bill_doc_type_code,
		:d2_bill_doc_num,
		:nd_lang_id);

	END;
	END-EXEC;
   }
   if(l_lsr == 0 && l_dmp != 0) 
   {
    EXEC SQL EXECUTE
	DECLARE
	 cursor DISP_TOKEN IS
	        select distinct b.short_desc||'/'||a.token_serial_no  token_code
			--b.short_desc||'/'||a.token_series_code||'/'||a.token_serial_no token_code
			from BL_PATIENT_CHARGES_FOLIO A,ph_disp_locn_lang_vw B
			where BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
			and   BILL_DOC_NUM       = :d2_bill_doc_num
			and   a.OPERATING_FACILITY_ID	= b.facility_id 
		    and   a.DISP_LOCN_CODE	= b.DISP_LOCN_CODE
			and   a.token_series_code is not null
            and   b.language_id=:nd_lang_id;
	 V_token_no_string Varchar2(4000);
	 V_token_no_string1 varchar2(4000);
	
	BEGIN
	 OPEN DISP_TOKEN;
	 Loop
		fetch DISP_TOKEN into V_token_no_string1;
		exit when DISP_TOKEN%notfound ;
		if V_token_no_string is not null then
			V_token_no_string := V_token_no_string ||':'||v_token_no_string1;
		Else
			V_token_no_string := v_token_no_string1;
		End if;
	 End loop;
	 Close DISP_TOKEN;
	 If V_token_no_string Is Not Null Then
      :d_token_string:=V_token_no_string;
	 End If;
	END;
	END-EXEC;
   }
  

	d_token_string.arr[d_token_string.len]='\0';

}
/***** The below code added by raghava at BKK for CRF-561 *********/
get_location()
{

d_location.arr[0]='\0';
d_location.len=0;
d_locn_code.arr[0]='\0';
d_locn_code.len=0;

EXEC SQL Select Decode(Upper(LOCN_TYPE),'CLINIC',LOCN_TYPE||': '||LOCN_DESC,
					  LOCN_TYPE||': '||LOCN_DESC||'/'||CUR_BED_NUM),LOCN_CODE
		Into  :d_location,:d_locn_code
		From BL_ENCOUNTER_FOR_QRY_VW
		Where FACILITY_ID=:nd_facility_id 
		And   PATIENT_ID=:d1_patient_id
		And   UPPER(LANGUAGE_ID) = UPPER(:nd_lang_id)
		And  (:d1_episode_type ='R' or (:d1_episode_type <> 'R' and EPISODE_ID=:d1_episode_id))
		And  (:d1_episode_type in ('R','I','D') or (:d1_episode_type in ('O','E') and VISIT_ID=:d1_visit_id));
 
	if (OERROR)
		err_mesg("SELECT failed on table BL_ENCOUNTER_FOR_QRY_VW",0,"");

	d_location.arr[d_location.len]='\0';
	d_locn_code.arr[d_locn_code.len]='\0';


}
/***** upto here *********/
/**** Added by Raghava For CRF-521 *******/
get_detail_desc_for_cust()
{

		l_detail_desc.arr[0]='\0';
		l_detail_desc.len=0;
  EXEC SQL SELECT	NVL(DETAIL_DESC,LONG_NAME)
		            INTO 
				    l_detail_desc
		FROM  ar_customer_lang_vw
		WHERE cust_code = :d2_customer_code
		AND   acc_entity_code = :nd_acc_entity_code
		AND   language_id = :nd_lang_id;  

		  if (OERROR)
		   err_mesg("SELECT failed on table ar_customer_lang_vw",0,"");

   l_detail_desc.arr[l_detail_desc.len] = '\0';
}    
get_encounter_id(call_mode)
{
  
  nd_encounter_id.arr[0]='\0';
  nd_encounter_id.len=0;

  EXEC SQL EXECUTE
  DECLARE
   CURSOR C_ENC IS
        SELECT DISTINCT a.EPISODE_TYPE,a.EPISODE_ID,a.VISIT_ID
		FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
		WHERE a.operating_facility_id=:nd_facility_id
		AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
		AND b.BILL_DOC_NUM = a.DOC_NUM
		AND b.DOC_TYPE_CODE  =:d_doc_type_code1
		AND b.DOC_NUMBER=:d_doc_number1;

  CURSOR C_ENC_1 IS
       	SELECT  DISTINCT EPISODE_TYPE,EPISODE_ID,VISIT_ID											 
				 FROM bl_bill_adj_dtl
				 WHERE operating_facility_id=:nd_facility_id
				 and  DOC_TYPE_CODE  =:d_doc_type_code1
				 AND DOC_NUM=:d_doc_number1;
				

  LV_ENCOUNTER_ID VARCHAR2(2000);
  lv_cnt Number:=1;
  BEGIN
  If :call_mode=1 Then
 
	  FOR I IN C_ENC LOOP
		If I.EPISODE_TYPE In('I','D') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE||'/'||I.EPISODE_ID;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE||'/'||I.EPISODE_ID;
		 End If;
		End If;
		If I.EPISODE_TYPE In('O','E') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE||'/'||I.EPISODE_ID||'/'||I.VISIT_ID;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE||'/'||I.EPISODE_ID||'/'||I.VISIT_ID;
		 End If;
		End If;
		If I.EPISODE_TYPE In('R') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE;
		 End If;
		End If;
   
	   lv_cnt:=lv_cnt+1;
	   END LOOP;
	  :nd_encounter_id:=LV_ENCOUNTER_ID;
  End If;
  If :call_mode=2 Then
    
	  FOR I IN C_ENC_1 LOOP
		If I.EPISODE_TYPE In('I','D') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE||'/'||I.EPISODE_ID;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE||'/'||I.EPISODE_ID;
		 End If;
		End If;
		If I.EPISODE_TYPE In('O','E') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE||'/'||I.EPISODE_ID||'/'||I.VISIT_ID;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE||'/'||I.EPISODE_ID||'/'||I.VISIT_ID;
		 End If;
		End If;
		If I.EPISODE_TYPE In('R') Then
		 If lv_cnt=1 Then
		  LV_ENCOUNTER_ID:=I.EPISODE_TYPE;
		 Else
		  LV_ENCOUNTER_ID:=LV_ENCOUNTER_ID||','||I.EPISODE_TYPE;
		 End If;
		End If;
   
	   lv_cnt:=lv_cnt+1;
	   END LOOP;
	  :nd_encounter_id:=LV_ENCOUNTER_ID;
  End If;
  END;
  END-EXEC;

  nd_encounter_id.arr[nd_encounter_id.len]='\0';
}
get_patient_name()
{
		
		
		if(strlen(d1_patient_id.arr) != 0) 
			{ 
				d_patient_name.arr[0]			= '\0';
				d_patient_name_loc_lang.arr[0]  = '\0';
				nd_nationality.arr[0]			= '\0';
				d_nric_no.arr[0]				= '\0';
				d_date_of_birth.arr[0]			= '\0';
				d_org_dept.arr[0]				= '\0';
				d_gender.arr[0]					= '\0';
				d_gender_desc.arr[0]='\0';
				nd_patient_name.arr[0]			='\0';
					
				d_patient_name.len			 = 0;
				d_patient_name_loc_lang.len  = 0;
				nd_nationality.len			 = 0;
				d_nric_no.len				 = 0;
				d_date_of_birth.len			 = 0;
				d_org_dept.len				 = 0;
				d_gender.len				 = 0;
				d_gender_desc.len			 = 0;
				nd_patient_name.len			 = 0;

				EXEC SQL SELECT decode(:nd_lang_id,'en',SHORT_NAME,SHORT_NAME_loc_lang),
						        substr(decode(:nd_lang_id,'en',SHORT_NAME,SHORT_NAME_loc_lang),1,40),
	       						NATIONALITY_CODE,
								NATIONAL_ID_NUM,
								to_char(DATE_OF_BIRTH,'dd/mm/yyyy'),
								BLCOMMON.get_pat_EmpOrgDept(:d1_patient_id,:nd_lang_id),
								sex
						   INTO :d_patient_name,
						        :nd_patient_name,
								:nd_nationality,
								:d_nric_no,
								:d_date_of_birth,
								:d_org_dept,
								:d_gender
						   FROM MP_PATIENT_MAST
						  WHERE PATIENT_ID = :d1_patient_id;

				 if(OERROR)
				 {   
					err_mesg("SELECT failed on table MP_PATIENT_MAST",0,"");
				 }

				 d_patient_name.arr[d_patient_name.len]						= '\0';
				 d_patient_name_loc_lang.arr[d_patient_name_loc_lang.len]   = '\0';
				 nd_nationality.arr[nd_nationality.len]						= '\0';
				 d_nric_no.arr[d_nric_no.len]								= '\0';
				 d_date_of_birth.arr[d_date_of_birth.len]					= '\0';
				 d_org_dept.arr[d_org_dept.len]								= '\0';
				 d_gender.arr[d_gender.len]									= '\0';
				 nd_patient_name.arr[nd_patient_name.len]				    = '\0';

				if(d_gender.arr[0]=='M')
				strcpy(d_gender_desc.arr,loc_legend1412.arr);
				else
				if(d_gender.arr[0]=='F')
				strcpy(d_gender_desc.arr,loc_legend1413.arr);
				else
				strcpy(d_gender_desc.arr,loc_legend1414.arr);
			}

			
			d_receipt_desc.arr[0]	= '\0';
			d_acc_int_code.arr[0]	= '\0';
			d_ac_code.arr[0]		= '\0';

			d_receipt_desc.len  = 0;
			d_acc_int_code.len  = 0;
			d_ac_code.len		= 0;

			EXEC SQL select long_desc, 
							receipt_acc_int_code 
					   INTO :d_receipt_desc, 
							:d_acc_int_code
					   FROM BL_RECEIPT_TYPE_LANG_VW
					   WHERE RECEIPT_TYPE_CODE = :d_receipt_type
					   AND   LANGUAGE_ID=:nd_lang_id;

			d_receipt_desc.arr[d_receipt_desc.len]	= '\0';
			d_acc_int_code.arr[d_acc_int_code.len]	= '\0';

			EXEC SQL SELECT MAIN_ACC1_CODE||' '||MAIN_ACC2_CODE||' '||
							DEPT_CODE||' '||SUBLEDGER_GROUP_CODE||' '||
							SUBLEDGER_LINE_CODE||' '||PRODUCT_GROUP_CODE||' '||
							PRODUCT_LINE_CODE      
					   INTO :d_ac_code
					   FROM BL_GL_ACCOUNT
					  WHERE ACC_INT_CODE =:d_acc_int_code;

			d_ac_code.arr[d_ac_code.len]	= '\0';

			//get_left_margin_rec();
			//get_hosp_name();

 }
get_blng_grp_desc()
{
 	d_blng_grp_desc.arr[0]= '\0';
	d_blng_grp_desc.len=0;

	EXEC SQL SELECT LONG_DESC 
			 INTO d_blng_grp_desc
			 FROM BL_BLNG_GRP_LANG_VW
			 WHERE BLNG_GRP_ID = :d1_blng_grp_id
			 AND  LANGUAGE_ID = :nd_lang_id;


		 if(OERROR)
		 {   
			err_mesg("SELECT failed on table BL_BLNG_GRP_LANG_VW",0,"");
		 }	
		 
  d_blng_grp_desc.arr[d_blng_grp_desc.len]	= '\0';	 		    

}

/* This function for getting ward description*/
get_ward_desc()
{

d_ward_code_desc.arr[0]			= '\0';
d_ward_code_desc.len			= 0;

EXEC SQL SELECT SHORT_DESC 
         INTO  :d_ward_code_desc
		 FROM  IP_NURSING_UNIT_LANG_VW
		 WHERE NURSING_UNIT_CODE = :d_ward_code
		 AND   LANGUAGE_ID	= :nd_lang_id;

	if(OERROR)
	 {   
		err_mesg("SELECT failed on table IP_NURSING_UNIT_LANG_VW",0,"");
	 }

d_ward_code_desc.arr[d_ward_code_desc.len]	= '\0';

}

/* This function for getting admission and discharge date*/
get_adm_dis_date()
{
 
 
 dc_admn_date.arr[dc_admn_date.len]='\0';
 d_dis_date.arr[d_dis_date.len]    ='\0';
 dc_admn_date.len=0;
 d_dis_date.len  =0;
 
   EXEC SQL  Select TO_CHAR(ADM_VISIT_DATE,'DD/MM/YYYY')ADM_VISIT_DATE,
		   TO_CHAR(DISCHARGE_DATE_TIME,'DD/MM/YYYY')DISCHARGE_DATE_TIME
		   INTO
		   :dc_admn_date,
		   :d_dis_date
           FROM BL_ENCOUNTER_FOR_QRY_VW
           WHERE
		   FACILITY_ID		= :nd_facility_id
		   AND nvl(LANGUAGE_ID,:nd_lang_id) = :nd_lang_id
		   AND EPISODE_TYPE = :d1_episode_type
		   AND ( :d1_episode_type ='R' or (:d1_episode_type not in ('R') and episode_id= :d1_episode_id))
		   AND ( :d1_episode_type in ('R','I','D') or (:d1_episode_type in ('O','E') and VISIT_ID=:d1_visit_id));

if (OERROR) 
	{	
	err_mesg("SELECT failed on table FROM BL_ENCOUNTER_FOR_QRY_VW",0,"");
	}
     dc_admn_date.arr[dc_admn_date.len] ='\0';
	 d_dis_date.arr[d_dis_date.len]	    ='\0';
	 

}

get_left_margin()
{

	if (l_lsr != 0 && l_dmp == 0)
	  {
		if (l_logo_yniflaser.arr[0] == 'Y')			    
			l_margin_len = 40;				
		else
			l_margin_len = 27;
			

	  }
}

get_left_margin_rec()
{

	if (l_lsr != 0 && l_dmp == 0)
	  {
		if (l_logo_yniflaser.arr[0] == 'Y')			    
			l_margin_len = 40;				
		else
			l_margin_len = 55;

	  }
}

get_param_for_three_tier()
{
	
	three_tier =1;

	d_doc_type_code.arr[0]    = '\0';
	l_to_doc_type_code.arr[0] = '\0';
	d_doc_number.arr[0]       = '\0'; 
	l_to_doc_type_num.arr[0]  = '\0';
	l_online_print_yn.arr[0] = '\0';
	l_episode_type.arr[0] = '\0';
	d_row_id.arr[0]			='\0';

	nd_logo_pgm_id.arr[0]	= '\0';
	nd_logo_pgm_id.len	= 0;

	nd_reprint_yn.arr[0] = '\0';
	nd_reprint_yn.len = 0;

	curr_date.arr[0] = '\0';
	curr_date.len = 0;
	d_row_id.len=0;

    nd_sys_date.arr[0]='\0';
	nd_sys_date.len=0;

	EXEC SQL SELECT ROWID,
				    param1, 
					param2, 
					param3, 
					param4, 
					NVL(param30,'N'),
					param9,
					nvl(param10,'N'),					
					param28,
					to_char(sysdate,'DD/MM/YYYY HH24:MI:SS'),
					to_char(sysdate,'DD/MM/YYYY HH24:MI')
			   INTO	:d_row_id,
					:d_doc_type_code,
					:d_doc_number ,
					:l_to_doc_type_code,
					:l_to_doc_type_num,
					:l_online_print_yn,
					:l_episode_type,
					:nd_reprint_yn,
					:nd_logo_pgm_id,
					:curr_date,
					:nd_sys_date
			   FROM sy_prog_param
			  WHERE pgm_id     = 'BLRRECPT'
	            AND PGM_DATE   = :nd_pgm_date 
	            AND SESSION_ID = :nd_session_id
				AND ROWNUM=1;


	if (sqlca.sqlcode == 1403)
	{
		l_tier_arch=2;
		strcpy(l_online_print_yn.arr,"Y");
		l_online_print_yn.len = strlen(l_online_print_yn.arr);
	}

	if(OERROR)
		err_mesg("SELECT failed on SY_PROG_PARAM",0,"");

	d_doc_type_code.arr[d_doc_type_code.len]		= '\0';
	l_to_doc_type_code.arr[l_to_doc_type_code.len]	= '\0';
	d_doc_number.arr[d_doc_number.len]				= '\0'; 
	l_to_doc_type_num.arr[l_to_doc_type_num.len]	= '\0';
	l_online_print_yn.arr[l_online_print_yn.len]	= '\0';
    l_episode_type.arr[l_episode_type.len]			='\0';
	nd_reprint_yn.arr[nd_reprint_yn.len]			= '\0';
	nd_logo_pgm_id.arr[nd_logo_pgm_id.len]			= '\0';
	curr_date.arr[curr_date.len]					= '\0';
	nd_sys_date.arr[nd_sys_date.len]			    = '\0';
    d_row_id.arr[d_row_id.len]						='\0';
 

	if (l_tier_arch!=2)
		l_tier_arch=3; 

	//sprintf(l_mesg,"1 - %s     2 - %s     3 - %s     4 - %s      30 - %s",d_doc_type_code.arr,d_doc_number.arr,l_to_doc_type_code.arr,l_to_doc_type_num.arr,l_online_print_yn.arr);
	//disp_message(ERR_MESG,l_mesg);

	EXEC SQL DELETE 
	         FROM sy_prog_param
			 WHERE pgm_id     = 'BLRRECPT'
	         AND PGM_DATE   = :nd_pgm_date
	         AND SESSION_ID = :nd_session_id
			 AND ROWID		= :d_row_id;

    EXEC SQL COMMIT; 
}


print_recpt()
{
   char out_str[10][133];
   char s_amt[20];
   int  length_str[10];
   int  l_no_of_deposit=0;
   int  i = 0,no_of_lines = 0;
   char epi_visit[14];
  

   line_no = 0;


   //Added by MRAMESH. Date : 31-dec-1997
   cur_str.arr[0]   = '\0';
   cur_str.len      =  0;   
   sub_cur_str.arr[0]   = '\0';
   sub_cur_str.len      = 0;

   exec sql select base_currency,
                   base_currency_dec 
            into :cur_str,
		   :sub_cur_str
  	    from sy_acc_entity_lang_vw
	    where acc_entity_id = :nd_facility_id
		and language_id =:nd_lang_id;

   if(sqlca.sqlcode == 1403)
   { 
	    err_mesg("No base currency in table SY_ACC_ENTITY",0,"");
   }
   
   if (sqlca.sqlcode < 0)
   {   
	    err_mesg("SELECT failed on table  SY_ACC_ENTITY",0,"");
   }
   
   cur_str.arr[cur_str.len]  = '\0';
   sub_cur_str.arr[sub_cur_str.len] = '\0';


   if (l_lsr != 0 && l_dmp == 0)
    {
	if ( l_logo_yniflaser.arr[0] != 'Y')
	  {
		 if(l_no_of_page > 1)
		 fprintf(fp,"\n");
		//line_no = line_no + 1;
	  }
    }
    else
    {
	if(l_no_of_page > 1)
	{
		fprintf(fp,"\n");
		//line_no = line_no + 1;
	}
    }

   if (l_lsr != 0 && l_dmp == 0)
	{	
	   
	   if ( l_logo_yniflaser.arr[0] != 'Y')
	   {
	      //fprintf(fp,"%c&d0D",ESC);   /* set Underline mode      */
	      fprintf(fp,"%c(s11H",ESC);  /* To set the font size	  */
	   }
	    
	      prt_space();	
	      //fprintf(fp,"%-s",loc_legend20.arr); 
		      	      
	     
	   if ( l_logo_yniflaser.arr[0] != 'Y')
	   {
	      fprintf(fp,"%c(s14H",ESC); /* To set the font size	  */
	      //fprintf(fp,"%c&d@",ESC); 	 /* release underline mode    */
	   }

	     /* len1 = 19 - loc_legend20.len;

	     if (len1 > 0)
	     {
	         for (i=0;i<len1;i++)
		 {
		     fprintf(fp,"%-s"," ");		     
		 }
	      }	      
		*/

		fprintf(fp,"\n");

		
		if (l_lsr!= 0 && l_dmp== 0)
		{
	   if ( l_logo_yniflaser.arr[0] != 'Y')
		{
			fprintf(fp,"%c(s8H",ESC);	
			fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */	      
		}
		}

		//prt_space_hdr();
		//fprintf(fp,"%-50.50s\n",loc_legend24.arr);
		//prt_space_hdr();
		//fprintf(fp,"%-50.50s\n",loc_legend22.arr);
		fprintf(fp,"\n");
		/*prt_space_hdr();
		fprintf(fp,"%-50.50s",nd_hosp_name1.arr);

		line_no = line_no + 1;*/



	    //if ( l_logo_yniflaser.arr[0] != 'Y')
		//	fprintf(fp,"%c(s12H",ESC);	

	}
	

  //print_report_header();

}
  
open_files()
{
   
   if (LOGO_DIR.arr[0] != '\0') 
	strcpy(filename,LOGO_DIR.arr);
   else 
	strcpy(filename,WORKING_DIR);
   
  
   if(strcmp(nd_pgm_id.arr,"BLREXMAD")!=0)
   {
		   if(l_tier_arch==2)
		   {	
			   
			   if ( strcmp(d_receipt_nature_code.arr,"BI")==0 || strcmp(d_receipt_nature_code.arr,"DC")==0 ||strcmp(d_receipt_nature_code.arr,"IN")==0 )
			   {
				  
				   if((nd_detail_type_yn.arr[0]=='Y') )
				   {
					 strcat(filename,"blrrcdtl.lis");
					 strcpy(pfilename,"blrrcdtl.lis");
					 }
				   else
				   {
				   
					l_receipt_cnt=l_receipt_cnt+1;
					strcat(filename,"blrrccou.lis");
					strcpy(pfilename,"blrrccou.lis");
					flag=l_receipt_cnt;
			
				   }
			   }
			   else
			   if(strcmp(d_receipt_nature_code.arr,"AR")==0)
			   {
				   l_invoice_cnt=l_invoice_cnt+1;
				   strcat(filename,"blrinvrc.lis");
				   strcpy(pfilename,"blrinvrc.lis");
				   flag=l_invoice_cnt;
			   }
			   else
			   {
				 
				l_depos_cnt=l_depos_cnt+1;
				strcat(filename,"blrdepos.lis");
				strcpy(pfilename,"blrdepos.lis");
				flag=l_depos_cnt;
			   }
		   }
		   else if(l_tier_arch==3)
		   {
				
				strcat(filename,l_file_name.arr);
		   }   
	}
	else
	{
	 if(strcmp(nd_reportid.arr,"BLR0014E")==0)
	 {
	 l_exmp_cnt=l_exmp_cnt+1;
	 strcat(filename,"BLR0014E.lis");
	 flag=l_exmp_cnt;
	 }

	 if(strcmp(nd_reportid.arr,"BLR0014C")==0)
	 {
	 l_exmp_can_cnt=l_exmp_can_cnt+1;
	 strcat(filename,"BLR0014C.lis");
	 flag=l_exmp_can_cnt;
	 }


	}
   
   strcpy(OUTPUT_FILE_NAME,filename );

   

  
   if(flag>1)
   {
     
	 if ((fp = fopen(filename,"a")) == NULL)
	   {
			err_mesg("Error while opening output file",0,"");
			proc_exit();
	   }
	   

   }
   else
   {
	   if ((fp = fopen(filename,"w")) == NULL)
	   {
			
			err_mesg("Error while opening output file",0,"");
			proc_exit();
	   }
	   else
	   {
	   
	    filecount=filecount+1;  //11793 receipt and deposit both files has to be print
		strcpy(l_filename[filecount],filename); //11793
		
	   }
   }
   
}


get_hosp_name()
{
   
   nd_hosp_name.arr[0]  ='\0';
   nd_hosp_name.len     =  0;            
   nd_hosp_name1.arr[0] ='\0';
   nd_hosp_name1.len    =  0;    
   curr_date.arr[0]     ='\0';
   curr_date.len        =  0; 
   nd_tel.arr[0]	    ='\0';
   nd_tel.len		    =  0;
   nd_fax.arr[0]	    ='\0';
   nd_fax.len		    =  0;
   nd_use_in_hosp.arr[0]='\0';
   nd_use_in_hosp.len	=  0;
   
   nd_medical_faclt.arr[0]='\0';
   nd_medical_faclt.len=0;

   nd_hosp_add.arr[0] = '\0';
   nd_hosp_add.len    = 0;
   nd_hosp_add1.arr[0] = '\0';
   nd_hosp_add1.len    = 0;
 
   nd_acc_entity_code.arr[0] ='\0';
   nd_acc_entity_code.len    =  0;   
   
   nd_sys_date.arr[0]='\0';
   nd_sys_date.len=0;
   /*****117793*******/
   nd_ln1_add.arr[0] ='\0';
   nd_ln1_add.len    =  0;   
   nd_ln2_add.arr[0] ='\0';
   nd_ln2_add.len    =  0;   
   nd_ln3_add.arr[0] ='\0';
   nd_ln3_add.len    =  0;   
   nd_zip_code.arr[0] ='\0'; 
   nd_zip_code.len    =  0;   
   
   nd_addr_line1.arr[0] ='\0';
   nd_addr_line2.arr[0] ='\0';
   nd_addr_line3.arr[0] ='\0';
   nd_addr_line4.arr[0] ='\0';
   nd_area_desc.arr[0] ='\0';
   nd_town_desc.arr[0] ='\0';
   nd_region_desc.arr[0]   ='\0';
   nd_postal_desc.arr[0]='\0';
   
   nd_addr_line1.len=0;
   nd_addr_line2.len=0;
   nd_addr_line3.len=0;
   nd_addr_line4.len=0;
   nd_area_desc.len=0;
   nd_town_desc.len=0;
   nd_region_desc.len=0;
   nd_postal_desc.len=0;

   d_addr_line1_prompt.arr[0] = '\0';
   d_addr_line1_prompt.len    = 0;
   d_addr_line2_prompt.arr[0] = '\0';
   d_addr_line2_prompt.len    = 0;
   d_addr_line3_prompt.arr[0] = '\0';
   d_addr_line3_prompt.len    = 0;
   d_addr_line4_prompt.arr[0] = '\0';
   d_addr_line4_prompt.len    = 0;
   d_res_area_prompt.arr[0] = '\0';
   d_res_area_prompt.len    = 0;
   d_res_town_prompt.arr[0] = '\0';
   d_res_town_prompt.len    = 0;
   d_postal_code_prompt.arr[0] = '\0';
   d_postal_code_prompt.len    = 0;
   d_region_prompt.arr[0] = '\0';
   d_region_prompt.len    = 0;
   
   /****upto here***/

    EXEC SQL SELECT acc_entity_code,
					acc_entity_name,
					no_of_decimal, 
					--lpad(' ',round((46-length(ACC_ENTITY_NAME))/2),' ')||UPPER(ACC_ENTITY_NAME) ,
					UPPER(ACC_ENTITY_NAME),
					lpad(' ',round((:l_margin_len-length(ACC_ENTITY_NAME))/2),' ')||UPPER(ACC_ENTITY_NAME),
					to_char(sysdate,'dd/mm/yyyy HH24:MI:SS'),
					to_char(sysdate,'dd/mm/yyyy HH24:MI'),
					TEL_NUM,
					FAX_NUM,
					:loc_legend1444||' '||INITCAP(LOWER(ACC_ENTITY_NAME))||' '||:loc_legend1445,
					INITCAP(LOWER(ACC_ENTITY_NAME))||','||:loc_legend1446,
					LN1_ADD,
					LN2_ADD,
					LN3_ADD,
					ZIP_CODE
					--LN1_ADD||nvl2(LN1_ADD,',','')||LN2_ADD||nvl2(LN2_ADD,',','')||
                    --LN3_ADD||nvl2(LN3_ADD,',','')||:loc_legend101||':'||TEL_NUM
					--LN1_ADD||nvl(LN1_ADD,'')||nvl(LN2_ADD,'')||LN3_ADD||','||:loc_legend101||':'||TEL_NUM
		INTO		:nd_acc_entity_code,
					:nd_facility_name,
					:nd_no_of_decimal,
					:nd_hosp_name,
					:nd_hosp_name1,
					:curr_date,
					:nd_sys_date,
					:nd_tel,
					:nd_fax,
					:nd_use_in_hosp,
					:nd_medical_faclt,
					:nd_ln1_add,
					:nd_ln2_add,
					:nd_ln3_add,
					:nd_zip_code
					--nd_hosp_add
    FROM sy_acc_entity_lang_vw
    WHERE acc_entity_id = :nd_facility_id
	AND   LANGUAGE_ID   = :nd_lang_id;

    
     EXEC SQL select  ADDR_LINE1_PROMPT,
					 ADDR_LINE2_PROMPT,
					 ADDR_LINE3_PROMPT,
					 ADDR_LINE4_PROMPT,
					 RES_AREA_PROMPT,
					 RES_TOWN_PROMPT,
					 POSTAL_CODE_PROMPT,
					 REGION_PROMPT
			 into    :d_addr_line1_prompt,
					 :d_addr_line2_prompt,
					 :d_addr_line3_prompt,
					 :d_addr_line4_prompt,
					 :d_res_area_prompt,
					 :d_res_town_prompt,
					 :d_postal_code_prompt,
					 :d_region_prompt
	         from    SM_SITE_PARAM_LANG
             where upper(language_id)=upper(:nd_lang_id);
	
	if (OERROR)
	{ 
	 disp_message (ERR_MESG,"Select failed in SM_SITE_PARAM_LANG");
	 proc_exit();
	}


   	EXEC SQL select 
	Decode(:nd_lang_id,'en',ADDR_LINE1,nvl(ADDR_LINE1_LOC_LANG,ADDR_LINE1)),
	Decode(:nd_lang_id,'en',ADDR_LINE2,nvl(ADDR_LINE2_LOC_LANG,ADDR_LINE2)),
	Decode(:nd_lang_id,'en',ADDR_LINE3,nvl(ADDR_LINE3_LOC_LANG,ADDR_LINE3)),
	Decode(:nd_lang_id,'en',ADDR_LINE4,nvl(ADDR_LINE4_LOC_LANG,ADDR_LINE4)),
	e.SHORT_DESC AREA_CODE,d.SHORT_DESC TWN_CODE,f.SHORT_DESC REGION_CODE,
	g.SHORT_DESC,a.TEL_NO1
	into :nd_addr_line1,nd_addr_line2,nd_addr_line3,nd_addr_line4,
	     nd_area_desc,nd_town_desc,:nd_region_desc,:nd_postal_desc,:nd_tel
	from SM_FACILITY_PARAM_LANG_VW A,mp_res_town_lang_vw D,
	mp_res_area_lang_vw E,mp_region_lang_vw F,
	mp_postal_code_lang_vw G
	where FACILITY_ID=:nd_facility_id
	and a.RES_AREA_CODE =e.RES_AREA_CODE
	and a.RES_TOWN_CODE=d.RES_TOWN_CODE
	and a.REGION_CODE=f.REGION_CODE
	and a.ADDR_POSTAL_CODE=g.POSTAL_CODE
	and upper(a.language_id)=upper(:nd_lang_id)
	and upper(d.language_id)=upper(:nd_lang_id)
	and upper(f.language_id)=upper(:nd_lang_id)
	and upper(e.language_id)=upper(:nd_lang_id)
	and upper(g.language_id)=upper(:nd_lang_id);
   

	if (OERROR)
    {
         err_mesg("SELECT failed on cursor SY_ACC_ENTITY",0,"");
    }
    nd_acc_entity_code.arr[nd_acc_entity_code.len] ='\0';
	nd_facility_name.arr[nd_facility_name.len]     ='\0';
    nd_hosp_name.arr[nd_hosp_name.len]             ='\0';
    nd_hosp_name1.arr[nd_hosp_name1.len]           ='\0';
	curr_date.arr[curr_date.len]                   ='\0';
	nd_use_in_hosp.arr[nd_use_in_hosp.len]		   ='\0';
	nd_medical_faclt.arr[nd_medical_faclt.len]     ='\0';
	//nd_hosp_add.arr[nd_hosp_add.len]			   ='\0';
	nd_addr_line1.arr[nd_addr_line1.len]		   ='\0';
	nd_addr_line2.arr[nd_addr_line2.len]		   ='\0';
	nd_addr_line3.arr[nd_addr_line3.len]		   ='\0';
	nd_addr_line4.arr[nd_addr_line4.len]		   ='\0';
	nd_area_desc.arr[nd_area_desc.len]		       ='\0';
	nd_town_desc.arr[nd_town_desc.len]		       ='\0';
	nd_region_desc.arr[nd_region_desc.len]	       ='\0';
	nd_postal_desc.arr[nd_postal_desc.len]	       ='\0';
    d_addr_line1_prompt.arr[d_addr_line1_prompt.len]= '\0';
	d_addr_line2_prompt.arr[d_addr_line2_prompt.len]= '\0';
	d_addr_line3_prompt.arr[d_addr_line3_prompt.len]= '\0';
	d_addr_line4_prompt.arr[d_addr_line4_prompt.len]= '\0';
	d_res_area_prompt.arr[d_res_area_prompt.len]= '\0';
	d_res_town_prompt.arr[d_res_town_prompt.len]= '\0';
	d_postal_code_prompt.arr[d_postal_code_prompt.len]= '\0';
	d_region_prompt.arr[d_region_prompt.len]= '\0';
    nd_sys_date.arr[nd_sys_date.len]='\0';

	if(nd_addr_line1.arr[0]!='\0')
	{
		//if(d_addr_line1_prompt.arr[0]!='\0')
		//{
		 strcat(nd_hosp_add.arr,loc_legend1451.arr);
		 strcat(nd_hosp_add.arr," ");
		//}
	 
	 strcat(nd_hosp_add.arr,nd_addr_line1.arr);
	 strcat(nd_hosp_add.arr," ");
	}
	if(nd_addr_line2.arr[0]!='\0')
	{
	 	if(d_addr_line2_prompt.arr[0]!='\0')
		{
		 strcat(nd_hosp_add.arr,d_addr_line2_prompt.arr);
		 strcat(nd_hosp_add.arr," ");
		}
	 strcat(nd_hosp_add.arr,nd_addr_line2.arr);
	 strcat(nd_hosp_add.arr," ");
	}
	if(nd_addr_line3.arr[0]!='\0')
	{
	 
	 	if(d_addr_line3_prompt.arr[0]!='\0')
		{
		 strcat(nd_hosp_add.arr,d_addr_line3_prompt.arr);
		 strcat(nd_hosp_add.arr," ");
		}
	 strcat(nd_hosp_add.arr,nd_addr_line3.arr);
	 strcat(nd_hosp_add.arr," ");
	}
	if(nd_addr_line4.arr[0]!='\0')
	{
	 	//if(d_addr_line4_prompt.arr[0]!='\0')
		//{
		 strcat(nd_hosp_add.arr,loc_legend1461.arr);
		 strcat(nd_hosp_add.arr," ");
		//}
	 
	 strcat(nd_hosp_add.arr,nd_addr_line4.arr);
	 strcat(nd_hosp_add.arr," ");
	}
	
	if(nd_town_desc.arr[0]!='\0')
	{
	 	//if(d_res_town_prompt.arr[0]!='\0')
		//{
		 strcat(nd_hosp_add.arr,loc_legend1462.arr);
		 strcat(nd_hosp_add.arr," ");
		//}
	 
	 strcat(nd_hosp_add.arr,nd_town_desc.arr);
	 strcat(nd_hosp_add.arr," ");
	} 
	if(nd_area_desc.arr[0]!='\0')
	{
	 	//if(d_res_area_prompt.arr[0]!='\0')
		//{
		 strcat(nd_hosp_add.arr,loc_legend1454.arr);
		 strcat(nd_hosp_add.arr," ");
		//}
	 
     strcat(nd_hosp_add.arr,nd_area_desc.arr);
	 strcat(nd_hosp_add.arr," ");
	} 
	

	if(nd_region_desc.arr[0]!='\0')
	{
	 	/*
		if(d_region_prompt.arr[0]!='\0')
		{
		 strcat(nd_hosp_add1.arr,d_region_prompt.arr);
		 strcat(nd_hosp_add1.arr," ");
		}*/

	 //strcat(nd_hosp_add1.arr," ");
	 strcat(nd_hosp_add1.arr,nd_region_desc.arr);
	 strcat(nd_hosp_add1.arr," ");
	} 
	if(nd_postal_desc.arr[0]!='\0')
	{
	 strcat(nd_hosp_add1.arr,nd_postal_desc.arr);
	 strcat(nd_hosp_add1.arr," ");
	} 
	if(nd_tel.arr[0]!='\0')
	{
	  strcat(nd_hosp_add1.arr,loc_legend101.arr);
	  strcat(nd_hosp_add1.arr,".");
	  strcat(nd_hosp_add1.arr," ");
	  strcat(nd_hosp_add1.arr,nd_tel.arr);
	}
    nd_hosp_add1.arr[strlen(nd_hosp_add1.arr)]='\0';

	  
}
get_exemption_instr_print_text()
{

	sub_print_text.arr[0] ='\0';
	sub_print_text1.arr[0]='\0';
	sub_print_text.len    =  0;
	sub_print_text1.len   =  0;

	EXEC SQL SELECT substr(decode(:nd_lang_id,'en',EXEMPTION_PRINT_TEXT,EXEMPTION_PRINT_TEXT_OTH_LANG),1,70)
			 INTO  :sub_print_text
			 FROM   BL_PARAMETERS
			 WHERE  OPERATING_FACILITY_ID=:nd_facility_id;  

	EXEC SQL SELECT substr(decode(:nd_lang_id,'en',INST_PRINT_TEXT,INST_PRINT_TEXT_OTH_LANG),1,70)
			 INTO  :sub_print_text1
			 FROM   BL_PARAMETERS
			 WHERE  OPERATING_FACILITY_ID=:nd_facility_id; 
			 
	if (OERROR)
        err_mesg("SELECT failed on cursor SY_ACC_ENTITY",0,"");
    
	if (NODATAFOUND)
		err_mesg("No Record found in BL_PARAMETERS",0,"");
	
	 
	sub_print_text.arr[sub_print_text.len] = '\0';
	sub_print_text1.arr[sub_print_text1.len] = '\0'; 

}
chk_instr_rec_exists()
{
  nd_inst_rcpt_yn.arr[0]='\0';
  nd_inst_rcpt_yn.len=0;
  
  EXEC SQL select count(*)
		  into  l_instr_rec
		  from BL_REC_REF_TEMP
		  where SESSION_ID = :nd_session_id
		  and PGM_DATE  = :nd_pgm_date;

 if(l_instr_rec>0)
 EXEC SQL select 'Y' into :nd_inst_rcpt_yn from dual;
 else
 EXEC SQL select 'N' into :nd_inst_rcpt_yn from dual;


 if (OERROR)
      err_mesg("SELECT failed on cursor SY_ACC_ENTITY",0,"");

  nd_inst_rcpt_yn.arr[nd_inst_rcpt_yn.len]='\0';
} 

get_episode_type_desc()
{

   nd_episode_type.arr[0]='\0';
   nd_episode_type.len   =  0;

     
   if ((strcmp(d2_episode_type.arr,"I")==0||strcmp(d2_episode_type.arr,"D")==0))
    strcpy(nd_episode_type.arr,"IP");
   else
   if ((strcmp(d2_episode_type.arr,"O")==0)||(strcmp(d2_episode_type.arr,"E")==0))
    strcpy(nd_episode_type.arr,"OP");
   else
    strcpy(nd_episode_type.arr,"EX");

}
get_counter_location()
{


 nd_counter_name.arr[0]='\0';
 nd_counter_name.len=0;

 EXEC SQL EXECUTE
 DECLARE
  l_BLDNG_CODE Bl_Cash_Counter.BLDNG_CODE%TYPE;
  l_FLOOR_CODE Bl_Cash_Counter.BLDNG_CODE%TYPE;
  l_blnd_Short_Desc  varchar2(300);
  l_floor_Short_Desc varchar2(300);
  l_cntr_name        varchar2(300);
 BEGIN
  Begin	
	Select BLDNG_CODE, FLOOR_CODE
	Into  l_BLDNG_CODE,l_FLOOR_CODE
	From  Bl_Cash_Counter 
	Where operating_facility_id=:nd_facility_id
	And   Cash_Counter_Code=:d_cash_counter_code;
  Exception
   When Others Then null;
  End;
    Begin	
	Select SHORT_DESC
	Into  l_cntr_name
	From  Bl_Cash_Counter_Lang_Vw 
	Where operating_facility_id=:nd_facility_id
	And   Cash_Counter_Code=:d_cash_counter_code
	And   Upper(language_Id)=Upper(:nd_lang_id);
	
	
  Exception
   When Others Then null;
  End;
  If l_BLDNG_CODE Is Not Null Then
   Begin
 	Select Short_Desc
 	Into l_blnd_Short_Desc
 	From AM_BLDNG_LANG_VW
 	Where operating_facility_id=:nd_facility_id
 	And   Upper(language_Id)=Upper(:nd_lang_id)
 	And   BLDNG_CODE=l_BLDNG_CODE;
   Exception
	When Others Then null;
   End;
  End If; 
  If l_FLOOR_CODE Is Not Null Then
	Begin
	 Select SHORT_DESC
	 Into l_floor_Short_Desc
	 From AM_BLDNG_FLOOR_LANG_VW
	 Where operating_facility_id=:nd_facility_id
	 And   Upper(LANGUAGE_ID)=Upper(:nd_lang_id)
	 And   BLDNG_CODE=l_BLDNG_CODE
	 And   FLOOR_CODE=l_FLOOR_CODE;
	 
	 
	Exception
	  When Others Then null;
	End;
  End If;

 If l_blnd_Short_Desc Is Not Null And l_floor_Short_Desc Is Not Null Then
 	:nd_counter_name:=l_cntr_name||','||l_blnd_Short_Desc||l_floor_Short_Desc;
 End If;
 
 If l_blnd_Short_Desc Is Not Null And l_floor_Short_Desc Is Null Then
 	 :nd_counter_name:=l_cntr_name||','||l_blnd_Short_Desc;
 End If;
 
  If l_blnd_Short_Desc Is  Null And l_floor_Short_Desc Is Null Then
 	:nd_counter_name:=l_cntr_name;
 End If;
    
 END;
 END-EXEC;

 	//if (OERROR)
        //err_mesg("SELECT failed on get_counter_location Function",0,"");
		nd_counter_name.arr[nd_counter_name.len]='\0';
		

}
get_print_type()
{

			
	EXEC SQL EXECUTE
	DECLARE
		l_sys_mesg_id VARCHAR2(10);
		l_err_level VARCHAR2(10);
		l_err_text VARCHAR2(1000);
		l_document_value blcommon.rectype_Tab;
		l_format_type VARCHAR2(200);
		l_report_tool_ind VARCHAR2(1);
	BEGIN

		blcommon.get_doc_print_format_Tab(
     			:nd_facility_id,
				:nd_reportid,
				l_document_value,
				l_sys_mesg_id,
				l_err_level,
				l_err_text);	

		FOR i IN l_document_value.FIRST..l_document_value.LAST LOOP
			if  l_document_value(i).id = 'FORMAT_TYPE' then
				l_format_type := l_document_value(i).value;
			end if;				
			
			if l_document_value(i).id = 'REPORT_TOOL_IND' then 
				l_report_tool_ind := l_document_value(i).value;
			end if;		 	
		END LOOP;		

		if l_format_type = 'DMP_PREPRINTED' then
			:l_dmp := 1;
			:l_lsr := 0;
			:nd_preprint_flag:='Y';
				
		elsif l_format_type in('LASER_WITH_LOGO','LASER_WITHOUT_LOGO') then
		    
			:l_dmp := 0;
			:l_lsr := 1;
			:nd_preprint_flag:='N';
			
		else
			
			:l_dmp := 0;
			:l_lsr := 0;
			:nd_preprint_flag:='N';
			
		end if;

		if :l_dmp = 0 and :l_lsr = 0 then

			APPPRINT.GET_ROUTING_PRINTERS(
			 :nd_ws_no,
			 :nd_facility_id,
			 'BL',
			 :nd_reportid,
			 'O',
			 ' ',
			 :l_printer_ids,
			 :l_printer_names,
			 :l_printer_types ,
			 :l_queue_names,
			 :l_no_of_copies,
			 :l_errortext);		 

			 :l_dmp := NVL(instr(:l_printer_types,'D'),0);
			 :l_lsr := NVL(instr(:l_printer_types,'S'),0);			 

			 if :l_dmp != 0 and :l_lsr != 0 then 
			    :l_dmp := 0;
			    --if there is a laser, then output format will be laser
			 end if;

			 if :l_dmp = 0 and :l_lsr = 0 then 
			    :l_lsr := 1;
			    --Default is Laser Format
			 end if;			 
		end if;
	END;
	END-EXEC;

	if ( l_errortext.arr[0] != '\0')
	{
		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;
	}

   
}

sql_connect()
{
  
  EXEC SQL CONNECT :uid_pwd;
  if (sqlca.sqlcode < 0)
      return(-1);
  return(0);
}

prt_space()
{
	if (l_lsr != 0 && l_dmp == 0 && l_logo_yniflaser.arr[0] == 'Y')
	{
		fprintf(fp,"               ");
	}
}


prt_space_hdr()
{
	if (l_lsr != 0 && l_dmp == 0 && l_logo_yniflaser.arr[0] == 'Y')
	{
		fprintf(fp,"                      ");
	}
}
fun_amt_in_words()
{
 	amt_in_words.arr[0]='\0';
	amt_in_words.len=0;
	
	amt_in_words_Sep.arr[0]='\0';
	amt_in_words_Sep.len=0;

	EXEC SQL EXECUTE
	BEGIN		
	:no_of_lines:=bl_spell_number.print_in_words
						(:nd_facility_id||'|'||:nd_lang_id,
						 abs(nvl(:d_oth_receipt_amt,0)),
						  70,
						 :cur_str,
						 :sub_cur_str,
						 :nd_no_of_decimal,
						 :amt_in_words,
						 :amt_in_words_Sep1);
  	END;
	END-EXEC;
	amt_in_words.arr[amt_in_words.len]='\0';
	amt_in_words_Sep1.arr[amt_in_words_Sep1.len]='\0';

EXEC SQL SELECT LTRIM(:amt_in_words_Sep1)
		 INTO :amt_in_words_Sep
		 FROM DUAL;

EXEC SQL SELECT REPLACE(:amt_in_words_Sep1,'~',CHR(10)||'                              ') 
		 INTO :amt_in_words_Sep
		 FROM DUAL;
	amt_in_words_Sep.arr[amt_in_words_Sep.len]='\0';

}
/*--------replicate a print character and changing the font hight  -----*/

replicate(printchar,no_of_times)
int printchar;
int no_of_times;
{
int i;
    for (i = 0; i < no_of_times; i++)
	    
	    fprintf(fp,"%c",printchar);
	   	          
  	return;
}

/*  ------end of replicate prg    ------*/
print_box()
{int i,j;

	replicate(tlc,1);
	replicate(hl,28);
	replicate(trc,1);
	fprintf(fp,"\n");
	v_lno++;
	
	for (i = 0;i < 3;i++)
	{	replicate(vl,1);
		for (j = 0;j < 28; j++) fprintf(fp," ");
		replicate(vl,1);
		fprintf(fp,"\n");  
		v_lno++;
	}
	replicate(blc,1);
	replicate(hl,28);
	replicate(brc,1);
	fprintf(fp,"%c(s12H",ESC);
	fprintf(fp,"\n");
	v_lno++;
}


fun_centre(v_text,v_size)
{
	int l_length,i;

	l_length=strlen(v_text);


	for (i=0;i<(v_size-l_length)/2;i++)
	{

		fprintf(fp," ");
	}
 
}
fun_centre_sign(v_text,v_size)
{
int l_length,i,l_size;

l_length=strlen(v_text)/2;
l_size=v_size/2;

 if(l_size>l_length)
 {
	for (i=0;i<(l_size-l_length);i++)
	{
	 fprintf(fp," ");
	}
 }
}

print_bold_underline()
{
	fprintf(fp,"%c(s12H",ESC);	/*SIZE*/
	fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style  */
	fprintf(fp,"%c&d0D",ESC);   /* set Underline mode */
}
Release_bold_underline()
{
	fprintf(fp,"%c(s14H",ESC); 
	fprintf(fp,"%c&d@",ESC); 
	fprintf(fp,"%c(s-3B",ESC);
}

print_underline()
{
	fprintf(fp,"%c&d0D",ESC);   /* set Underline mode */
}
Release_underline()
{
	
	fprintf(fp,"%c&d@",ESC); 
	
}

print_bold()
{

	fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style  */
	
}
Release_bold()
{
	fprintf(fp,"%c(s-3B",ESC);
}

get_Receipt_Format()
{
	EXEC SQL select RECEIPT_FORMAT_IND,SLMT_MODE_WISE_RCPT_YN
				 into :nd_receipt_format_id,:nd_slmt_mode_yn
				from bl_parameters
				where operating_facility_id=:nd_facility_id;

}

declare_cur()
{  

    /*EXEC SQL DECLARE BL_RECEIPT_FORMAT_CUR CURSOR FOR 
		SELECT	
				PARAM1,
				PARAM2,
				PARAM3,
				PARAM4,
				PARAM12,
				'Y'
				FROM SY_PROG_PARAM
				WHERE   PGM_ID   IN('BLRCOUPN','BLRRPREC','BLRPRREC') AND
						 SESSION_ID = :nd_session_id
						AND PGM_DATE  = :nd_pgm_date;*/

			

	 EXEC SQL DECLARE BL_RECEIPT_FORMAT_CUR CURSOR FOR
	   SELECT RECPT_REFUND_IND,'Y'  FROM BL_RECEIPT_REFUND_HDR
	   WHERE DOC_TYPE_CODE BETWEEN :d_doc_type_code AND :l_to_doc_type_code
	    AND DOC_NUMBER BETWEEN :d_doc_number AND :l_to_doc_type_num;
		
		

		if (OERROR)
			err_mesg("SELECT failed on table SY_PROG_PARAM",0,"");
  
}


open_cur() 
{

	EXEC SQL OPEN BL_RECEIPT_FORMAT_CUR;
    if (OERROR)
         err_mesg("OPEN failed on cursor BL_RECEIPT_FORMAT_CUR",0,"");
}

close_cur() 
{
    EXEC SQL DELETE SY_PROG_PARAM
					    WHERE 
						PGM_ID   IN('BLRCOUPN','BLRRPREC','BLRPRREC')	AND
						 SESSION_ID = :nd_session_id
						AND PGM_DATE  = :nd_pgm_date;

    if (OERROR)
        err_mesg("DELETE failed on table SY_PROG_PARAM",0,"");
   

	EXEC SQL CLOSE BL_RECEIPT_FORMAT_CUR;
    
}
delete_temp_data()
{
     EXEC SQL DELETE BL_REC_REF_TEMP
			  WHERE  SESSION_ID = :nd_session_id
			  AND PGM_DATE  = :nd_pgm_date;

    if (OERROR)
        err_mesg("DELETE failed on table BL_REC_REF_TEMP",0,"");

    EXEC SQL COMMIT; 
}

print_body()
{
  
  //fetch_cur();

  declare_receipt_main_cur();

  while(fetch_receipt_main_cur())
   {
	open_files();
	

	bold_st = 0;
	font_st = 0;
	uline_st= 1;

    fetch_dtl();
	
	
    print_head();
	

   	if (bl_body_line_01.arr[0] != '\0')
      {
		print_line(bl_body_line_01.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }

	if (bl_body_line_02.arr[0] != '\0')
      {
		print_line(bl_body_line_02.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_03.arr[0] != '\0')
      {
		print_line(bl_body_line_03.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_04.arr[0] != '\0')
      {
		print_line(bl_body_line_04.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_05.arr[0] != '\0')
      {
		print_line(bl_body_line_05.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_06.arr[0] != '\0')
      {
		print_line(bl_body_line_06.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_07.arr[0] != '\0')
      {
		print_line(bl_body_line_07.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_08.arr[0] != '\0')
      {
		print_line(bl_body_line_08.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_09.arr[0] != '\0')
      {
		print_line(bl_body_line_09.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_10.arr[0] != '\0')
      {
		print_line(bl_body_line_10.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_11.arr[0] != '\0')
      {
		print_line(bl_body_line_11.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_12.arr[0] != '\0')
      {
		print_line(bl_body_line_12.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_13.arr[0] != '\0')
      {
		print_line(bl_body_line_13.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_14.arr[0] != '\0')
      {
		print_line(bl_body_line_14.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_15.arr[0] != '\0')
      {
		print_line(bl_body_line_15.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_16.arr[0] != '\0')
      {
		print_line(bl_body_line_16.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_17.arr[0] != '\0')
      {
		print_line(bl_body_line_17.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_18.arr[0] != '\0')
      {
		print_line(bl_body_line_18.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_19.arr[0] != '\0')
      {
		print_line(bl_body_line_19.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_body_line_20.arr[0] != '\0')
      {
		print_line(bl_body_line_20.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	
	if (bl_footer_line_01.arr[0] != '\0')
      {
		print_line(bl_footer_line_01.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_02.arr[0] != '\0')
      {
		print_line(bl_footer_line_02.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_03.arr[0] != '\0')
      {
		print_line(bl_footer_line_03.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_04.arr[0] != '\0')
      {
		print_line(bl_footer_line_04.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_05.arr[0] != '\0')
      {
		print_line(bl_footer_line_05.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_06.arr[0] != '\0')
      {
		print_line(bl_footer_line_06.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_07.arr[0] != '\0')
      {
		print_line(bl_footer_line_07.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_08.arr[0] != '\0')
      {
		print_line(bl_footer_line_08.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_09.arr[0] != '\0')
      {
		print_line(bl_footer_line_09.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_10.arr[0] != '\0')
      {
		print_line(bl_footer_line_10.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }


	/* Scrum Changes Starts crf-23 */
   if (strcmp(cCheck.arr,"Y") == 0) 
	fprintf(fp,"Note: ** In Receipt Reference denotes that receipt has been generated for multiple specialities");
   if (strcmp(cCheck1.arr,"Y") == 0) 
	fprintf(fp,"Note: ** In Receipt Reference denotes that receipt has been generated for multiple settlement modes");
	/* Scrum Changes Ends crf-23*/

   //fprintf(fp,"\f"); //14732
   pctr = 1;
   line_ctr = 2;
   
   fprintf(fp,""); /* To Eject Page */  //14732

   fclose(fp); //14732


	nd_bill_doc_code.arr[0]	='\0';
	nd_bill_doc_code.len	=0;
	nd_bill_doc_num.arr[0]	='\0';
	nd_bill_doc_num.len		=0;

	
	EXEC SQL UPDATE BL_RECEIPT_REFUND_HDR
	SET PRINT_FLAG = 'Y'
	WHERE DOC_TYPE_CODE=:d_doc_type_code1
	AND DOC_NUMBER=:d_doc_number1;
	
	if (OERROR)
		err_mesg("update failed on table BL_RECEIPT_REFUND_HDR",0,"");

	/****IN15170*** starts here****/

	EXEC SQL SELECT bill_doc_type_code,bill_doc_number
	into :nd_bill_doc_code,:nd_bill_doc_num
	from BL_RECEIPT_REFUND_HDR
	WHERE DOC_TYPE_CODE=:d_doc_type_code1
	and DOC_NUMBER=:d_doc_number1;

	if (OERROR)
		err_mesg("Select failed on table BL_RECEIPT_REFUND_HDR",0,"");

	
	nd_bill_doc_code.arr[nd_bill_doc_code.len]	='\0';
	nd_bill_doc_num.arr[nd_bill_doc_num.len]	='\0';

	
	EXEC SQL UPDATE BL_BILL_HDR set BILL_PRINT_FLAG='Y'
	where doc_type_Code=:nd_bill_doc_code
	and doc_num=:nd_bill_doc_num;

		if (OERROR)
		err_mesg("update failed on table BL_BILL_HDR",0,"");

	/****IN15170*** Ends here****/

	EXEC SQL COMMIT; 

	
  
 }	  /* end of while loop  */

	close_receipt_main_cur();
 
}     /* end of procedure   */


print_line(line_var) varchar line_var[101];

{
	dup_var.arr[0] = '\0';
	dup_var.len = 0;
    pos_var  = 0;
	pos_var1 = 0;
	pos_var2 = 0;
	print_upto = 0;
	lv_var  = 1;
	i = 0;
	
	strcpy(dup_var.arr,line_var);
	dup_var.len = strlen(dup_var.arr);
	var_length = strlen(dup_var.arr);
	pos_var = char_position(dup_var.arr,"+",1);
    sprintf(st_var,"%d",var_length);
    

	while(i < var_length)
	{ 
	if (pos_var == 0)
	{
    pos_length = var_length - i + 2;

	put_string(dup_var.arr,i,pos_length);
	
	strcpy(str_var.arr,ls_str.arr);

	str_var.len= strlen(str_var.arr);
	
	check_splch(str_var.arr);
	pos_var1 = 0;
	pos_var2 = 0;
	i = var_length;
	}

	if (pos_var != 0 && pos_var1 == 0)
	{	    
	pos_var1 = pos_var;

	pos_length = pos_var1-print_upto-1;	

    put_string(dup_var.arr,print_upto+1,pos_length);
    strcpy(str_var.arr,ls_str.arr);
	str_var.len = strlen(str_var.arr);
	check_splch(str_var.arr);

    print_upto = pos_var1 - 1;
	i = pos_var1+1;
    

	pos_var2 = char_position(dup_var.arr,"+",i);

     if (pos_var2 == 0)
	 {
	  pos_length = var_length - pos_var1 + 1;
      put_string(dup_var.arr,pos_var1,pos_length);
      strcpy(str_var.arr,ls_str.arr);
	  str_var.len = strlen(str_var.arr);

	  check_splch(str_var.arr);
	  print_upto = var_length+1;
	  i = var_length+1;
     }

    }

    if (pos_var2 != 0)
	{
    nd_column_val.arr[0] = '\0';
	nd_column_val.len = 0;
	column_var.arr[0] = '\0';
	column_var.len = 0;
	tab_name.arr[0] = '\0';
	tab_name.len = 0;

sql_stmt1.arr[0] = '\0';
sql_stmt1.len = 0;
sql_stmt2.arr[0] = '\0';
sql_stmt2.len = 0;

	pos_length = pos_var2 - pos_var1 - 1;

    column_var.arr[0] = '\0';
	column_var.len = 0;
	
	 put_string(dup_var.arr,pos_var1+1,pos_length);
     strcpy(column_var.arr,ls_str.arr);
	 column_var.len = strlen(column_var.arr);
	 date_yn = chk_date_yn(column_var.arr);
	 
	  EXEC SQL SELECT  decode(:date_yn,0,'select to_char(ltrim('|| LET_MAPPED_COL_NAME || ')) from '|| LET_MAPPED_TABLE_NAME ||' WHERE ',
										 'select to_char('|| LET_MAPPED_COL_NAME || ',''DD/MM/YYYY'') from '|| LET_MAPPED_TABLE_NAME ||' WHERE '),LET_MAPPED_TABLE_NAME
					into  :sql_stmt1,tab_name
                    FROM BL_RECEIPT_MAPPING_COL
                    WHERE LET_COLUMN_ID = :column_var
					AND APPL_TRX_IND = 'R';

	len = strlen(sql_stmt1.arr);
		sql_stmt1.arr[sql_stmt1.len]  ='\0';


    tab_name.arr[tab_name.len] = '\0';
	

	if(strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDR") == 0 || strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDRDTL_VW") == 0) 
	{
    
	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_doc_type_code1.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUMBER) =");
	strcat(sql_stmt2.arr,d_doc_number1.arr);
	if((strcmp(column_var.arr,"CASHIER_NAME")==0))
	{
		strcat(sql_stmt2.arr," AND ROWNUM=1");
	}
      
	}


	if(strcmp(tab_name.arr,"MP_PATIENT_MAST") == 0 || strcmp(tab_name.arr,"MP_PATIENT") == 0)
	{ 
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); ;
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
   
	}
	
	if(strcmp(tab_name.arr,"MP_REGION") == 0) 
	{
	if(strcmp(column_var.arr,"MAIL_REGION_NAME")==0)
	{
	strcpy(sql_stmt2.arr, "REGION_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_REGION_CODE.arr);
	strcat(sql_stmt2.arr,"'");
	}
	else
	{
	strcpy(sql_stmt2.arr, "REGION_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_REGION_CODE1.arr);
	strcat(sql_stmt2.arr,"'");
	 }
    
	}
	
	if(strcmp(tab_name.arr,"SY_ACC_ENTITY") == 0) 
	{
	strcpy(sql_stmt2.arr, "ACC_ENTITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	

	if(strcmp(tab_name.arr,"MP_PAT_OTHER_DTLS") == 0) 
	{
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}


    if(strcmp(tab_name.arr,"MP_RES_AREA") == 0) 
	{
	if(strcmp(column_var.arr,"MAIL_AREA_NAME")==0)
	{
	strcpy(sql_stmt2.arr, "RES_AREA_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_AREA_CODE.arr);
	strcat(sql_stmt2.arr,"'");
	}
	else
	{
	strcpy(sql_stmt2.arr, "RES_AREA_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_AREA_CODE1.arr);
	strcat(sql_stmt2.arr,"'");	
	 }
    
	}

	if(strcmp(tab_name.arr,"MP_RES_TOWN") == 0) 
	{
	if(strcmp(column_var.arr,"MAIL_TOWN_NAME")==0)
	{
	strcpy(sql_stmt2.arr, "RES_TOWN_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_TOWN_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    }
	else
	{
	strcpy(sql_stmt2.arr, "RES_TOWN_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_TOWN_CODE1.arr);
	strcat(sql_stmt2.arr,"'");
	 }
	}
	
	
	if(strcmp(tab_name.arr,"SM_FACILITY_PARAM") == 0) 
	{
    strcpy(sql_stmt2.arr, "FACILITY_ID = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	}

		/*******scrum -crf-23*******/
	if(strcmp(tab_name.arr,"BL_REC_REF_SPLTY_VW") == 0 ) 
	{
   	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_doc_type_code1.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUMBER) =");
	strcat(sql_stmt2.arr,d_doc_number1.arr);
   	strcat(sql_stmt2.arr, " and OPERATING_FACILITY_ID = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
 	}

	 if(strcmp(tab_name.arr,"BL_REC_REF_SETT_MODE_VW") == 0 ) 
	{
    strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_doc_type_code1.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUMBER) =");
	strcat(sql_stmt2.arr,d_doc_number1.arr);
   	strcat(sql_stmt2.arr, " and OPERATING_FACILITY_ID = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
 	}

  /*********crf-23 end*********/


	strcpy(sql_stmt,sql_stmt1.arr);

	strcat(sql_stmt,sql_stmt2.arr); 


EXEC SQL EXECUTE
	BEGIN
	 EXECUTE IMMEDIATE :sql_stmt INTO :nd_column_val;
	END;
END-EXEC;

nd_column_val.arr[nd_column_val.len]  ='\0';

fun_Pad_desc_with_spl_char_yn();


/* Scrum Changes Starts crf-23 */
if ((strcmp(tab_name.arr,"BL_REC_REF_SPLTY_VW") == 0 )  &&  (strcmp(nd_column_val.arr,"**") == 0))
{
strcpy(cCheck.arr,"Y");
}
if ((strcmp(tab_name.arr,"BL_REC_REF_SETT_MODE_VW") == 0 )  &&  (strcmp(nd_column_val.arr,"**") == 0))
{
strcpy(cCheck1.arr,"Y");
}

/* Scrum Changes Ends crf-23 */

sprintf(st_var,"%d",sqlca.sqlcode);


 	if (OERROR)
	 {
		 
			  column_var.arr[0] = '\0';
			  column_var.len = 0;
			  pos_length = pos_var2 - pos_var1 + 1;
			  put_string(dup_var.arr,pos_var1,pos_length);
			  strcpy(column_var.arr,ls_str.arr);
			  column_var.len = strlen(column_var.arr);
		
		if (strcmp(column_var.arr,"+PAT_PREFIX+")==0 && strcmp(st_var,"-1405")==0) 
			{
			  strcpy(nd_column_val.arr," ");
			  fprintf(fp,"%s",nd_column_val.arr);
			}
				
		  
		   /* if (strcmp(column_var.arr,"+VISIT_ID+")==0 && strcmp(st_var,"-1405")==0)
			{ 
			 strcpy(nd_column_val.arr,"1");
			 fprintf(fp,"%-s",nd_column_val.arr);
			
			 }*/ 
			 
		
		/***added for IN14946***/
		if (strcmp(column_var.arr,"+BANK_NAME+")==0 && strcmp(st_var,"-1405")==0)
			{ 
				 EXEC SQL select SUBSTR(Bank_Name,1,30) into :nd_bank_name 
					 from bl_bank_name_lang_vw a,bl_receipt_refund_hdrdtl_vw b
					where a.bank_code=b.bank_code
					and b.doc_type_code=:d_doc_type_code1
					and b.doc_number=:d_doc_number1
					AND a.language_id=:nd_lang_id;
				
				 EXEC SQL select SUBSTR(Bank_branch,1,30) into :nd_column_val 
					 from bl_bank_name_lang_vw a,bl_receipt_refund_hdrdtl_vw b
					where a.bank_code=b.bank_code
					and b.doc_type_code=:d_doc_type_code1
					and b.doc_number=:d_doc_number1
					AND a.language_id=:nd_lang_id;


				if (strcmp(nd_bank_name.arr,"\0")!=0 && strcmp(nd_column_val.arr,"\0")!=0 )
				 {
					strcat(nd_bank_name.arr,",");
					strcat(nd_bank_name.arr,nd_column_val.arr);
					strcpy(nd_column_val.arr,nd_bank_name.arr);
				}
				else
				{
					if (strcmp(nd_bank_name.arr,"\0")!=0 && strcmp(nd_column_val.arr,"\0")==0)
					strcpy(nd_column_val.arr,nd_bank_name.arr);	
			    
				}

				 fprintf(fp,"%-s",nd_column_val.arr);
			
			 }

	  /***end of IN14946***/
	  
	  	 	

		  if((strcmp(st_var,"-1405")!=0))
		  {
			fprintf(fp,"%s",column_var.arr);
		  }
		  
		  	  
	 }
    else 
	   {
			nd_column_val.arr[nd_column_val.len] = '\0';

				exec sql select base_currency,
                   base_currency_dec 
					 into :cur_str,
					 :sub_cur_str
  					from sy_acc_entity_lang_vw
					where acc_entity_id = :nd_facility_id
				      and language_id =:nd_lang_id;
		
		
		
		if (strcmp(column_var.arr,"PAYER_NAME")==0)
		{
			
			EXEC SQL SELECT RPAD(SUBSTR(:nd_column_val,1,30),30,'.') INTO :nd_column_val  FROM DUAL;
			
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}
				
			nd_column_val.arr[nd_column_val.len] = '\0';
			

		}
		

		if (strcmp(column_var.arr,"PATIENT_NAME")==0)
		{
			
			nd_patient_id_loc.arr[0] = '\0';
			nd_patient_id_loc_desc.arr[0] ='\0';

			nd_patient_id_loc.len	= 0;
			nd_patient_id_loc_desc.len	= 0;
			
			nd_column_val.arr[0]  ='\0';
			nd_column_val.len	  =0;
		
			EXEC SQL select patient_id  into :nd_patient_id_loc 
					 from bl_receipt_refund_hdr 
					 where doc_type_code=:d_doc_type_code1
					  and doc_number=:d_doc_number1;

			nd_patient_id_loc.arr[nd_patient_id_loc.len] = '\0';
		
			EXEC SQL select decode(:nd_lang_id,'en',short_name,SHORT_NAME_LOC_LANG)  into :nd_patient_id_loc_desc 
					 from mp_patient_mast
					 where patient_id=:nd_patient_id_loc;
			
			nd_patient_id_loc_desc.arr[nd_patient_id_loc_desc.len] = '\0';

			EXEC SQL SELECT RPAD(SUBSTR(:nd_patient_id_loc_desc,1,30),30,'.') INTO :nd_column_val  FROM DUAL;

				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}
				
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			}


		if (strcmp(column_var.arr,"HOSP_NAME")==0)
			 {
				nd_column_val.arr[0]  ='\0';
				nd_column_val.len	  =0;

				EXEC SQL select  ACC_ENTITY_NAME
								into
								:nd_column_val
							   from sy_acc_entity_lang_vw
							   where acc_entity_id = :nd_facility_id
							   and	  language_id   = :nd_lang_id;
				
								
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}		
			
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			 }


			 if (strcmp(column_var.arr,"ADD_LINE1")==0)
			 {
				nd_column_val.arr[0]  ='\0';
				nd_column_val.len	  =0;

				EXEC SQL select  ADDR_LINE1
								into :nd_column_val
							   from sm_facility_param_lang_vw
							   where facility_id = :nd_facility_id
							   and	  language_id   = :nd_lang_id;
												
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}		
			
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			 }


			 if (strcmp(column_var.arr,"ADD_LINE2")==0)
			 {
				nd_column_val.arr[0]  ='\0';
				nd_column_val.len	  =0;

				EXEC SQL select  ADDR_LINE2
								into :nd_column_val
							   from sm_facility_param_lang_vw
							   where facility_id = :nd_facility_id
							   and	  language_id   = :nd_lang_id;

								
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}		
			
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			 }
			
			if (strcmp(column_var.arr,"ADD_LINE3")==0)
			 {
				nd_column_val.arr[0]  ='\0';
				nd_column_val.len	  =0;

				EXEC SQL select  ADDR_LINE3
								into
								:nd_column_val
							   from sm_facility_param_lang_vw
							   where facility_id = :nd_facility_id
							   and	  language_id   = :nd_lang_id;
							
								
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}		
			
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			 }


			 if (strcmp(column_var.arr,"ADDR_LINE4")==0)
			 {
				nd_column_val.arr[0]  ='\0';
				nd_column_val.len	  =0;

				EXEC SQL select  ADDR_LINE4
								into
								:nd_column_val
							   from sm_facility_param_lang_vw
							   where facility_id = :nd_facility_id
							   and	  language_id   = :nd_lang_id;

								
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
					nd_column_val.arr[nd_column_val.len] = '\0';
					nd_desc_with_spl_chr.arr[0] = '\0';
					nd_desc_with_spl_chr.len	=	0;
					fun_Pad_desc_with_spl_char(nd_column_val.arr);
					fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					nd_column_val.arr[0] = '\0';
					nd_column_val.len	=0;	
				}		
			
				nd_column_val.arr[nd_column_val.len] = '\0';
				
			 }
		
		
		if (strcmp(column_var.arr,"EPISODE_ID")==0 && strcmp(st_var,"-1405")!=0)
		{
		  nd_episode.arr[0]='\0';
		  nd_episode.len=0;
		  fprintf(fp,"/");
		  strcpy(nd_episode.arr,nd_column_val.arr);

		 }
		if (strcmp(column_var.arr,"VISIT_ID")==0 && strcmp(st_var,"-1405")!=0)
		 { 
			if (strcmp(nd_episode.arr,"\0")!=0 )
			fprintf(fp,"/");	
					
		 }


		/***added for IN14946***/
		if (strcmp(column_var.arr,"BANK_NAME")==0 )
			{ 
			
			EXEC SQL select substr(Bank_Name,1,30) into :nd_bank_name 
				 from bl_bank_name_lang_vw a,bl_receipt_refund_hdrdtl_vw b
			    where a.bank_code=b.bank_code
				and b.doc_type_code=:d_doc_type_code1
				and b.doc_number=:d_doc_number1
				AND a.language_id=:nd_lang_id;

			

			EXEC SQL select substr(Bank_branch,1,30) into :nd_column_val 
				 from bl_bank_name_lang_vw a,bl_receipt_refund_hdrdtl_vw b
			    where a.bank_code=b.bank_code
				and b.doc_type_code=:d_doc_type_code1
				and b.doc_number=:d_doc_number1
				AND a.language_id=:nd_lang_id;
		

			if (strcmp(nd_bank_name.arr,"\0")!=0 && strcmp(nd_column_val.arr,"\0")!=0)
			 {
				
				strcat(nd_bank_name.arr,",");
				strcat(nd_bank_name.arr,nd_column_val.arr);
				strcpy(nd_column_val.arr,nd_bank_name.arr);
			  }
			  else
			  {
				if (strcmp(nd_bank_name.arr,"\0")!=0 && strcmp(nd_column_val.arr,"\0")==0)
				strcpy(nd_column_val.arr,nd_bank_name.arr);	
			    
			  }
						if(strcmp(nd_pad_req_yn.arr,"Y")==0)
						{
							nd_column_val.arr[nd_column_val.len] = '\0';
							nd_desc_with_spl_chr.arr[0] = '\0';
							nd_desc_with_spl_chr.len	=	0;
							
							fun_Pad_desc_with_spl_char(nd_column_val.arr);
							fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
							nd_column_val.arr[0] = '\0';
							nd_column_val.len	=0;
						}	

			  nd_column_val.arr[nd_column_val.len] = '\0';
					 			
		 }

	  /***end of IN14946***/


		
	
		if (strcmp(column_var.arr,"PATIENT_ID")==0)
		{
			
			EXEC SQL SELECT RPAD(SUBSTR(:nd_column_val,1,20),20,'.') INTO :nd_column_val  FROM DUAL;

			nd_column_val.arr[nd_column_val.len] = '\0';
				
			
		}

		
		if (strcmp(column_var.arr,"RCPT_AMT_IN_WORDS")==0)
		{
		fun_amt_in_words1();

			if(strcmp(nd_pad_req_yn.arr,"Y")==0)
			{
			nd_desc_with_spl_chr.arr[0] = '\0';
			nd_desc_with_spl_chr.len	=	0;

			fun_Pad_desc_with_spl_char(amt_in_words_Sep.arr);
			fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
			}
			else
			fprintf(fp,"%s",amt_in_words_Sep.arr);
		}
		
		if (strcmp(column_var.arr,"CASHIER_NAME")==0)
		{
			
			
				nd_cashier_name.arr[0]='\0';
				nd_cashier_name.len	  =0; 

  

			  EXEC SQL SELECT DISTINCT APPL_USER_NAME
			  INTO  :nd_cashier_name
			  FROM   SM_APPL_USER_LANG 
			  WHERE  APPL_USER_ID=:nd_column_val
			  AND	 LANGUAGE_ID  =:nd_lang_id;
  

				 if (OERROR)
					  { 
						disp_message (ERR_MESG,"SELECT FAILED FROM SM_APPL_USER TABLE");
					  }
 
				nd_cashier_name.arr[nd_cashier_name.len]='\0';
					
		
				if(strcmp(nd_pad_req_yn.arr,"Y")==0)
				{
				nd_desc_with_spl_chr.arr[0] = '\0';
				nd_desc_with_spl_chr.len	=	0;

				fun_Pad_desc_with_spl_char(nd_cashier_name.arr);
				fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
				}
				else
				fprintf(fp,"%-s",nd_cashier_name.arr);  	 
			}
		 
			if (strcmp(column_var.arr,"RCPT_AMT")==0)
			 {
				EXEC SQL select to_number(:nd_column_val) into nd_rcpt_amt from dual;
				print_formated_amt2(nd_rcpt_amt);

			 }
			 				
		   
			if (strcmp(column_var.arr,"PAYMENT_DETAILS")==0) // && strcmp(nd_slmt_mode_yn.arr,"Y")!=0) 
			{
			
				declare_payment_type_det();
				open_payment_cur(); 
			while(fetch_payment_det_cur())
			{
    					
					if(strcmp(nd_pad_req_yn.arr,"Y")==0)
					{
						nd_desc_with_spl_chr.arr[0] = '\0';
						nd_desc_with_spl_chr.len	=	0;
						
						fun_Pad_desc_with_spl_char(d_settlement_desc.arr);
						fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
					}
					else
					fprintf(fp,"\n      %-30.25s",d_settlement_desc.arr);

				 fprintf(fp," %-s ",cur_str.arr);			                 
				 print_formated_amt1(d_pay_amt);

				if (strcmp(d_cash_slmt_flag.arr,"Y")!=0 || strcmp(d_cashier_cheque_yn.arr,"Y")==0 ) 
				 {
	    
				  if(d_slmt_doc_ref_date.arr[0]!='\0')
				  {
					init_date_temp_var();
					strcpy(date_convert.arr,d_slmt_doc_ref_date.arr);
					fun_change_loc_date2();
					strcpy(d_slmt_doc_ref_date.arr,nd_loc_date.arr);
				  }
					//fprintf(fp,"%-2.2s: %-25.25s %-4.4s: %-10.10s ",loc_legend106.arr,d_rcpt_rfnd_id_no.arr,loc_legend3.arr,d_slmt_doc_ref_date.arr);

					fprintf(fp,"\n      \t%-2.2s: %-20.20s %-4.4s: %-10.10s",loc_legend106.arr,d_slmnt_doc_ref.arr,loc_legend3.arr,d_slmt_doc_ref_date.arr);
					
				  d_bank_name.arr[0] = '\0';
				  d_bank_name.len =0;
         						
				 if (strcmp(d_cash_slmt_flag.arr,"A")!=0) 
				 {
					  EXEC SQL SELECT BANK_NAME 
					  INTO :d_bank_name 
					  FROM BL_BANK_NAME_LANG_VW
					  WHERE bank_code=:d_bank_code
					  AND language_id=:nd_lang_id;
                  }
				  else
				  {
					  EXEC SQL SELECT NAME 
					  INTO :d_bank_name 
					  FROM BL_BANK_CREDIT_COMPANY_LANG_VW
					  WHERE CODE=:d_bank_code
					  AND   BANK_CREDIT_COMPANY_IND='C'
					  AND language_id=:nd_lang_id;
				  }
					
				 d_bank_name.arr[d_bank_name.len] =0;
					
						
					if(strcmp(nd_pad_req_yn.arr,"Y")==0)
					{
						nd_desc_with_spl_chr.arr[0] = '\0';
						nd_desc_with_spl_chr.len	=	0;
						
						fun_Pad_desc_with_spl_char(loc_legend1415.arr);
						fprintf(fp,",%-9.9s:",nd_desc_with_spl_chr.arr);
						fun_Pad_desc_with_spl_char(d_bank_name.arr);
						fprintf(fp,"%-30.30s ",nd_desc_with_spl_chr.arr);
					}
					else
					 fprintf(fp,", %-9.9s:%-30.30s ",loc_legend1415.arr,d_bank_name.arr);
				 //fprintf(fp,", %-30.30s ",d_bank_name.arr);
				 
				  }
				  else
				  {
					fprintf(fp,"\n      \t%-30.30s ",d_slmnt_doc_ref.arr);
				  }

			 }// while end brces	

		close_payment_cur();

		}
   
		//else  //multimode
		//	{
				 if(strcmp(column_var.arr,"RCPT_NATURE_DESC")==0)
				 {
				  EXEC SQL SELECT LONG_DESC INTO :d_rcpt_nat_desc
						   FROM BL_RECEIPT_NATURE_LANG_VW
						   WHERE RECPT_NATURE_CODE = :nd_column_val
						   AND LANGUAGE_ID       = :nd_lang_id; 
                      
								
						if(strcmp(nd_pad_req_yn.arr,"Y")==0)
						{
							nd_desc_with_spl_chr.arr[0] = '\0';
							nd_desc_with_spl_chr.len	=	0;
							
							fun_Pad_desc_with_spl_char(d_rcpt_nat_desc.arr);
							fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
						}
						else
						fprintf(fp,"%-30.30s",d_rcpt_nat_desc.arr);
				 }
				 
     	//	}
	

		if (strcmp(column_var.arr,"RCPT_AMT")!=0 && strcmp(column_var.arr,"RCPT_NATURE_DESC")!=0
		 && strcmp(column_var.arr,"PAYMENT_DETAILS")!=0 && strcmp(column_var.arr,"RCPT_AMT_IN_WORDS")!=0
		 && strcmp(column_var.arr,"CASHIER_NAME")!=0 )
		
		  fprintf(fp,"%-s",nd_column_val.arr);
				
	
	
	}


	
	print_upto = pos_var2;
	i = pos_var2+1;  
	
    pos_var1 = 0;
	pos_var2 = 0;

	pos_var = char_position(dup_var.arr,"+",i);
    }
   } 
} 

check_splch(str_var1)
char str_var1[101];
{
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 lc_str_val.arr[0]	='\0';
 lc_str_val.len		= 0;
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 
 ctr = 1;
 print_upto_c = 0;
 strcpy(lc_str_val.arr,str_var1);
 lc_str_val.len = strlen(lc_str_val.arr);
 len_lc_str_val = strlen(lc_str_val.arr);

 while(ctr <= len_lc_str_val)
 {
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 
 
 spchar_pos = chk_esc_pos(lc_str_val.arr,ctr);
 
 spchar_pos1 = chk_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0  && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 1;
   }

 spchar_pos1 = chk_cp_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 2;
   }

 
 spchar_pos1 = chk_tab_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 3;
   }

 spchar_pos1 = chk_bold_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 4;
   }

 spchar_pos1 = chk_font_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 5;
   }

spchar_pos1 = chk_line_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 6;
   }

spchar_pos1 = chk_uline_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 7;
   }


 if (spchar_pos == 0)   
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 prt_len = len_lc_str_val - print_upto_c ;

 put_string(lc_str_val.arr,print_upto_c + 1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);

 lc_str_var.len=strlen(lc_str_var.arr);

 //fprintf(fp,"%s",lc_str_var.arr);

	
	fun_Pad_desc_with_spl_char_yn();
		
	if(strcmp(nd_pad_req_yn.arr,"Y")==0)
	{
		nd_desc_with_spl_chr.arr[0] = '\0';
		nd_desc_with_spl_chr.len	=	0;
		
		fun_Pad_desc_with_spl_char(lc_str_var.arr);
		fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
	}
	else
	fprintf(fp,"%s",lc_str_var.arr);

 ctr = len_lc_str_val+1;
 print_upto_c = len_lc_str_val;
 }
 else
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;

 prt_len = spchar_pos - print_upto_c -1;
 
 put_string(lc_str_val.arr,print_upto_c+1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);
 lc_str_var.len = strlen(lc_str_var.arr);

  //fprintf(fp,"%s",lc_str_var.arr);

	fun_Pad_desc_with_spl_char_yn();

  if(strcmp(nd_pad_req_yn.arr,"Y")==0)
	{
		nd_desc_with_spl_chr.arr[0] = '\0';
		nd_desc_with_spl_chr.len	=	0;
		
		fun_Pad_desc_with_spl_char(lc_str_var.arr);
		fprintf(fp,"%s",nd_desc_with_spl_chr.arr);
	}
	else
	fprintf(fp,"%s",lc_str_var.arr);

  
  if (spchar_type == 1)
  {
  fprintf(fp,"\n");
  line_ctr++;
  }

  if (spchar_type == 2)
  {
  fprintf(fp,"\n");
  line_ctr++;
  }

  if (spchar_type == 3)
  fprintf(fp,"        ");

  if (spchar_type == 4)
  {
	if (bold_st)
	{
	fprintf(fp,"%c(s-3B",ESC); /* release bold style */
	bold_st = 0;
	}
    else
	{
	fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 			*/
	bold_st = 1;
	}
  }

  if (spchar_type == 5)
  {
	if (font_st)
	{
	fprintf(fp,"%c(s10H",ESC); 	/* To set the font 			*/
	font_st = 0;
	}
    else
	{
	fprintf(fp,"%c(s8H",ESC); 	/* To set the font 			*/
	font_st = 1;
	}
  }
if (spchar_type == 6)
  {
	prt_line_uc_wide1();
  }

  if (spchar_type == 7)
  {
	if (uline_st)
	{
	
	fprintf (fp,"%c&d0D",ESC); 	/* To set the underline 			*/
	uline_st = 0;
	}
    else
	{
	fprintf (fp,"%c&d@",ESC); 	/* To set the underline 			*/
	uline_st = 1;
	}
  }

  ctr = spchar_pos+2;
  print_upto_c = spchar_pos+1;
  }  
 }
}

int chk_tab_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\t',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_nwln_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;

splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\n',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_cp_nwln_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;

splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\N',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_bold_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\b',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_font_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\f',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_line_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\l',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_uline_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\u',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}
int chk_esc_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_date_yn(str_var2)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'DATE',1)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

check_page_end(l_lead_lines, l_print_flag)
int l_lead_lines;
int	l_print_flag;
{
	if(l_print_flag==1)
		l_lead_lines=l_lead_lines+10;

	if((line_ctr+l_lead_lines)> 55) 
	{
		fprintf(fp,"%-70s %s %d\n"," ","Contd...",++pctr);
		fprintf(fp,"\f");
		fprintf(fp,"%-45s Page : %d\n\n"," ",pctr);
		line_ctr = 2;
		print_head();
	}
}

int char_position(ls_var,lc_var,ld_var)
char ls_var[101];
char lc_var[3];
int ld_var;
{
 ls_str_var.arr[0] = '\0';
 ls_str_var.len = 0;

 ls_char_var.arr[0] = '\0';
 ls_char_var.len = 0;

 strcpy(ls_str_var.arr,ls_var);
 strcpy(ls_char_var.arr,lc_var);

 ls_str_var.len = strlen(ls_str_var.arr);
 ls_char_var.len = strlen(ls_char_var.arr);

  
 EXEC SQL select instr(:ls_str_var,:ls_char_var,:ld_var)
	         into :char_pos
			 from dual;
 
 if (OERROR)
        err_mesg("SELECT failed on table DUAL",0,"");

 
 ld_var = 0;
 return(char_pos);
}

fetch_dtl()
{
bl_reminder_format_id.arr[0]	= '\0';
bl_report_title_text.arr[0]		= '\0';

bl_header_line_01.arr[0]		= '\0';
bl_header_line_02.arr[0]		= '\0';
bl_header_line_03.arr[0]		= '\0';
bl_header_line_04.arr[0]		= '\0';
bl_header_line_05.arr[0]		= '\0';
bl_header_line_06.arr[0]		= '\0';
bl_header_line_07.arr[0]		= '\0';
bl_header_line_08.arr[0]		= '\0';
bl_header_line_09.arr[0]		= '\0';
bl_header_line_10.arr[0]		= '\0';
bl_body_line_01.arr[0]			= '\0';
bl_body_line_02.arr[0]			= '\0';
bl_body_line_03.arr[0]			= '\0';
bl_body_line_04.arr[0]			= '\0';
bl_body_line_05.arr[0]			= '\0';
bl_body_line_06.arr[0]			= '\0';
bl_body_line_07.arr[0]			= '\0';
bl_body_line_08.arr[0]			= '\0';
bl_body_line_09.arr[0]			= '\0';
bl_body_line_10.arr[0]			= '\0';
bl_body_line_11.arr[0]			= '\0';
bl_body_line_12.arr[0]			= '\0';
bl_body_line_13.arr[0]			= '\0';
bl_body_line_14.arr[0]			= '\0';
bl_body_line_15.arr[0]			= '\0';
bl_body_line_16.arr[0]			= '\0';
bl_body_line_17.arr[0]			= '\0';
bl_body_line_18.arr[0]			= '\0';
bl_body_line_19.arr[0]			= '\0';
bl_body_line_20.arr[0]			= '\0';
bl_footer_line_01.arr[0]		= '\0';
bl_footer_line_02.arr[0]		= '\0';
bl_footer_line_03.arr[0]		= '\0';
bl_footer_line_04.arr[0]		= '\0';
bl_footer_line_05.arr[0]		= '\0';
bl_footer_line_06.arr[0]		= '\0';
bl_footer_line_07.arr[0]		= '\0';
bl_footer_line_08.arr[0]		= '\0';
bl_footer_line_09.arr[0]		= '\0';
bl_footer_line_10.arr[0]		= '\0';
str_var.arr[0]                  = '\0';				
nd_patient_id.arr[0]			= '\0';
nd_cust_code.arr[0]				= '\0';
b1_original_text.arr[0]			='\0';
b1_copy_text.arr[0]				='\0';
b1_original_text.len			=0;
b1_copy_text.len				=0;	
bl_report_title_text.len= 0;
bl_header_line_01.len	= 0;
bl_header_line_02.len	= 0;
bl_header_line_03.len	= 0;
bl_header_line_04.len	= 0;
bl_header_line_05.len	= 0;
bl_header_line_06.len	= 0;
bl_header_line_07.len	= 0;
bl_header_line_08.len	= 0;
bl_header_line_09.len	= 0;
bl_header_line_10.len	= 0;
bl_body_line_01.len		= 0;
bl_body_line_02.len		= 0;
bl_body_line_03.len		= 0;
bl_body_line_04.len		= 0;
bl_body_line_05.len		= 0;
bl_body_line_06.len		= 0;
bl_body_line_07.len		= 0;
bl_body_line_08.len		= 0;
bl_body_line_09.len		= 0;
bl_body_line_10.len		= 0;
bl_body_line_11.len		= 0;
bl_body_line_12.len		= 0;
bl_body_line_13.len		= 0;
bl_body_line_14.len		= 0;
bl_body_line_15.len		= 0;
bl_body_line_16.len		= 0;
bl_body_line_17.len		= 0;
bl_body_line_18.len		= 0;
bl_body_line_19.len		= 0;
bl_body_line_20.len		= 0;
bl_footer_line_01.len	= 0;
bl_footer_line_02.len	= 0;
bl_footer_line_03.len	= 0;
bl_footer_line_04.len	= 0;
bl_footer_line_05.len	= 0;
bl_footer_line_06.len	= 0;
bl_footer_line_07.len	= 0;
bl_footer_line_08.len	= 0;
bl_footer_line_09.len	= 0;
bl_footer_line_10.len	= 0;
str_var.len				= 0;
nd_patient_id.len		= 0;
nd_cust_code.len		= 0; 

		EXEC SQL SELECT	A.PATIENT_ID,B.REGION_CODE,B.RES_AREA_CODE,B.RES_TOWN_CODE
				INTO :nd_patient_id,
					 :nd_REGION_CODE,
					 :nd_RES_AREA_CODE,
					 :nd_RES_TOWN_CODE
			FROM BL_RECEIPT_REFUND_HDR A,MP_PATIENT B
            WHERE A.PATIENT_ID=B.PATIENT_ID
			AND DOC_TYPE_CODE = :d_doc_type_code1
            AND DOC_NUMBER = :d_doc_number1;
		
				EXEC SQL SELECT REGION_CODE,RES_AREA_CODE,RES_TOWN_CODE
				into :nd_REGION_CODE1,:nd_RES_AREA_CODE1,:nd_RES_TOWN_CODE1
				from sm_facility_param
				where FACILITY_ID=:nd_facility_id;

		if (OERROR)
			err_mesg("SELECT failed on table BL_RECEIPT_REFUND_HDR",0,"");

     if (strcmp(nd_slmt_mode_yn.arr,"Y")==0)
	 {
        
		EXEC SQL SELECT
		B.CASH_SLMT_FLAG
		INTO :nd_CASH_SLMT_FLAG
		FROM BL_RECEIPT_REFUND_DTL A,BL_SLMT_TYPE_LANG_VW B 
		WHERE 
		A.OPERATING_FACILITY_ID = :nd_facility_id
		AND a.DOC_TYPE_CODE=:d_doc_type_code1
		AND a.DOC_NUMBER=:d_doc_number1
		AND A.SLMT_TYPE_CODE=B.SLMT_TYPE_CODE
	    AND UPPER(B.LANGUAGE_ID)=UPPER(:nd_lang_id) 
		AND B.acc_entity_code in (select acc_entity_code 
		                           from sy_acc_entity
		                           where acc_entity_id = :nd_facility_id
		                           )
		order by A.PAYER_NAME;


		if (OERROR)
			err_mesg("SELECT failed on table BL_RECEIPT_REFUND_DTL",0,"");
	

       
       EXEC SQL SELECT ORIGINAL_TEXT,COPY_TEXT,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE1,'B',CHEQUE_PMNT_HEADER_LINE1,'A',CC_PMNT_HEADER_LINE1,OTHERS_PMNT_HEADER_LINE1) header_line_01,
	                   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE2,'B',CHEQUE_PMNT_HEADER_LINE2,'A',CC_PMNT_HEADER_LINE2,OTHERS_PMNT_HEADER_LINE2) header_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE3,'B',CHEQUE_PMNT_HEADER_LINE3,'A',CC_PMNT_HEADER_LINE3,OTHERS_PMNT_HEADER_LINE3) header_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE4,'B',CHEQUE_PMNT_HEADER_LINE4,'A',CC_PMNT_HEADER_LINE4,OTHERS_PMNT_HEADER_LINE4) header_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE5,'B',CHEQUE_PMNT_HEADER_LINE5,'A',CC_PMNT_HEADER_LINE5,OTHERS_PMNT_HEADER_LINE5) header_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE6,'B',CHEQUE_PMNT_HEADER_LINE6,'A',CC_PMNT_HEADER_LINE6,OTHERS_PMNT_HEADER_LINE6) header_line_06,
					   
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE1,'B',CHEQUE_PMNT_BODY_LINE1,'A',CC_PMNT_BODY_LINE1,OTHERS_PMNT_BODY_LINE1) body_line_01,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE2,'B',CHEQUE_PMNT_BODY_LINE2,'A',CC_PMNT_BODY_LINE2,OTHERS_PMNT_BODY_LINE2) body_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE3,'B',CHEQUE_PMNT_BODY_LINE3,'A',CC_PMNT_BODY_LINE3,OTHERS_PMNT_BODY_LINE3) body_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE4,'B',CHEQUE_PMNT_BODY_LINE4,'A',CC_PMNT_BODY_LINE4,OTHERS_PMNT_BODY_LINE4) body_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE5,'B',CHEQUE_PMNT_BODY_LINE5,'A',CC_PMNT_BODY_LINE5,OTHERS_PMNT_BODY_LINE5) body_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE6,'B',CHEQUE_PMNT_BODY_LINE6,'A',CC_PMNT_BODY_LINE6,OTHERS_PMNT_BODY_LINE6) body_line_06,

					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE1,'B',CHEQUE_PMNT_FOOTER_LINE1,'A',CC_PMNT_FOOTER_LINE1,OTHERS_PMNT_FOOTER_LINE1) footer_line_01,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE2,'B',CHEQUE_PMNT_FOOTER_LINE2,'A',CC_PMNT_FOOTER_LINE2,OTHERS_PMNT_FOOTER_LINE2) footer_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE3,'B',CHEQUE_PMNT_FOOTER_LINE3,'A',CC_PMNT_FOOTER_LINE3,OTHERS_PMNT_FOOTER_LINE3) footer_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE4,'B',CHEQUE_PMNT_FOOTER_LINE4,'A',CC_PMNT_FOOTER_LINE4,OTHERS_PMNT_FOOTER_LINE4) footer_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE5,'B',CHEQUE_PMNT_FOOTER_LINE5,'A',CC_PMNT_FOOTER_LINE5,OTHERS_PMNT_FOOTER_LINE5) footer_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE6,'B',CHEQUE_PMNT_FOOTER_LINE6,'A',CC_PMNT_FOOTER_LINE6,OTHERS_PMNT_FOOTER_LINE6) footer_line_06

	            into :b1_original_text,
					 :b1_copy_text,
					 :bl_header_line_01,
				     :bl_header_line_02,
					 :bl_header_line_03,
					 :bl_header_line_04,
					 :bl_header_line_05,
					 :bl_header_line_06,
					 :bl_body_line_01,
                     :bl_body_line_02,
				     :bl_body_line_03,
					 :bl_body_line_04,
					 :bl_body_line_05,
					 :bl_body_line_06,
					 :bl_footer_line_01,
					 :bl_footer_line_02,
					 :bl_footer_line_03,
					 :bl_footer_line_04,
					 :bl_footer_line_05,
					 :bl_footer_line_06
                FROM BL_CASH_BILL_PRINT_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id
				and bill_rcpt_ind='R'
				AND   RCPT_RFND_IND=:l_rcpt_rfnd_ind
				AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);

     if(NODATAFOUND)
	 {
	 
	   EXEC SQL SELECT ORIGINAL_TEXT,COPY_TEXT,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE1,'B',CHEQUE_PMNT_HEADER_LINE1,'A',CC_PMNT_HEADER_LINE1,OTHERS_PMNT_HEADER_LINE1) header_line_01,
	                   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE2,'B',CHEQUE_PMNT_HEADER_LINE2,'A',CC_PMNT_HEADER_LINE2,OTHERS_PMNT_HEADER_LINE2) header_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE3,'B',CHEQUE_PMNT_HEADER_LINE3,'A',CC_PMNT_HEADER_LINE3,OTHERS_PMNT_HEADER_LINE3) header_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE4,'B',CHEQUE_PMNT_HEADER_LINE4,'A',CC_PMNT_HEADER_LINE4,OTHERS_PMNT_HEADER_LINE4) header_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE5,'B',CHEQUE_PMNT_HEADER_LINE5,'A',CC_PMNT_HEADER_LINE5,OTHERS_PMNT_HEADER_LINE5) header_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_HEADER_LINE6,'B',CHEQUE_PMNT_HEADER_LINE6,'A',CC_PMNT_HEADER_LINE6,OTHERS_PMNT_HEADER_LINE6) header_line_06,
					   
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE1,'B',CHEQUE_PMNT_BODY_LINE1,'A',CC_PMNT_BODY_LINE1,OTHERS_PMNT_BODY_LINE1) body_line_01,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE2,'B',CHEQUE_PMNT_BODY_LINE2,'A',CC_PMNT_BODY_LINE2,OTHERS_PMNT_BODY_LINE2) body_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE3,'B',CHEQUE_PMNT_BODY_LINE3,'A',CC_PMNT_BODY_LINE3,OTHERS_PMNT_BODY_LINE3) body_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE4,'B',CHEQUE_PMNT_BODY_LINE4,'A',CC_PMNT_BODY_LINE4,OTHERS_PMNT_BODY_LINE4) body_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE5,'B',CHEQUE_PMNT_BODY_LINE5,'A',CC_PMNT_BODY_LINE5,OTHERS_PMNT_BODY_LINE5) body_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_BODY_LINE6,'B',CHEQUE_PMNT_BODY_LINE6,'A',CC_PMNT_BODY_LINE6,OTHERS_PMNT_BODY_LINE6) body_line_06,

					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE1,'B',CHEQUE_PMNT_FOOTER_LINE1,'A',CC_PMNT_FOOTER_LINE1,OTHERS_PMNT_FOOTER_LINE1) footer_line_01,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE2,'B',CHEQUE_PMNT_FOOTER_LINE2,'A',CC_PMNT_FOOTER_LINE2,OTHERS_PMNT_FOOTER_LINE2) footer_line_02,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE3,'B',CHEQUE_PMNT_FOOTER_LINE3,'A',CC_PMNT_FOOTER_LINE3,OTHERS_PMNT_FOOTER_LINE3) footer_line_03,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE4,'B',CHEQUE_PMNT_FOOTER_LINE4,'A',CC_PMNT_FOOTER_LINE4,OTHERS_PMNT_FOOTER_LINE4) footer_line_04,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE5,'B',CHEQUE_PMNT_FOOTER_LINE5,'A',CC_PMNT_FOOTER_LINE5,OTHERS_PMNT_FOOTER_LINE5) footer_line_05,
					   DECODE(:nd_CASH_SLMT_FLAG,'Y',CASH_PMNT_FOOTER_LINE6,'B',CHEQUE_PMNT_FOOTER_LINE6,'A',CC_PMNT_FOOTER_LINE6,OTHERS_PMNT_FOOTER_LINE6) footer_line_06

	            into :b1_original_text,
					 :b1_copy_text,
					 :bl_header_line_01,
				     :bl_header_line_02,
					 :bl_header_line_03,
					 :bl_header_line_04,
					 :bl_header_line_05,
					 :bl_header_line_06,
					 :bl_body_line_01,
                     :bl_body_line_02,
				     :bl_body_line_03,
					 :bl_body_line_04,
					 :bl_body_line_05,
					 :bl_body_line_06,
					 :bl_footer_line_01,
					 :bl_footer_line_02,
					 :bl_footer_line_03,
					 :bl_footer_line_04,
					 :bl_footer_line_05,
					 :bl_footer_line_06
                FROM BL_CASH_BILL_PRINT_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id
				and bill_rcpt_ind='R'
				AND   RCPT_RFND_IND=:l_rcpt_rfnd_ind
				AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
	   
	   if (NODATAFOUND)
		 {		
			    /***changed on 21/01/2010***/
				if(strcmp(l_rcpt_rfnd_ind.arr,"F")==0)
				disp_message(ERR_MESG,"Refund Format Setup Not Found, Cannot Print");
				if(strcmp(l_rcpt_rfnd_ind.arr,"R")==0)
				disp_message(ERR_MESG,"Receipt Format Setup Not Found, Cannot Print");
				l_online_print_yn.arr[0]='N';
				 return;
				//err_mesg("Setup Not Found, Cannot Print.",0,"");//IN13838

				/***UPTO HERE***/
				
		 }

	  
	  }
	 
		
         if (OERROR)
            err_mesg("SELECT failed on cursor BL_CASH_BILL_PRINT_FORMAT",0,"");
	}

	else
	{
	
       EXEC SQL SELECT ORIGINAL_TEXT,COPY_TEXT,
						SINGLE_RCPT_HEADER_LINE1,
						SINGLE_RCPT_HEADER_LINE2,
						SINGLE_RCPT_HEADER_LINE3, 
						SINGLE_RCPT_HEADER_LINE4,
						SINGLE_RCPT_HEADER_LINE5,
						SINGLE_RCPT_HEADER_LINE6,
						SINGLE_RCPT_BODY_LINE1, 
						SINGLE_RCPT_BODY_LINE2,
						SINGLE_RCPT_BODY_LINE3,
						SINGLE_RCPT_BODY_LINE4,
						SINGLE_RCPT_BODY_LINE5,
						SINGLE_RCPT_BODY_LINE6, 
						SINGLE_RCPT_FOOTER_LINE1,
						SINGLE_RCPT_FOOTER_LINE2,
						SINGLE_RCPT_FOOTER_LINE3,
						SINGLE_RCPT_FOOTER_LINE4,
						SINGLE_RCPT_FOOTER_LINE5,
						SINGLE_RCPT_FOOTER_LINE6
	            into :b1_original_text,
					 :b1_copy_text,
					 :bl_header_line_01,
				     :bl_header_line_02,
					 :bl_header_line_03,
					 :bl_header_line_04,
					 :bl_header_line_05,
					 :bl_header_line_06,
					 :bl_body_line_01,
                     :bl_body_line_02,
				     :bl_body_line_03,
					 :bl_body_line_04,
					 :bl_body_line_05,
					 :bl_body_line_06,
					 :bl_footer_line_01,
					 :bl_footer_line_02,
					 :bl_footer_line_03,
					 :bl_footer_line_04,
					 :bl_footer_line_05,
					 :bl_footer_line_06
                FROM BL_CASH_BILL_PRINT_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id
				and bill_rcpt_ind='R'
				AND RCPT_RFND_IND=:l_rcpt_rfnd_ind
				AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER(:nd_lang_id);

    if (NODATAFOUND)
	{
	 
	 EXEC SQL SELECT ORIGINAL_TEXT,COPY_TEXT,
						SINGLE_RCPT_HEADER_LINE1,
						SINGLE_RCPT_HEADER_LINE2,
						SINGLE_RCPT_HEADER_LINE3, 
						SINGLE_RCPT_HEADER_LINE4,
						SINGLE_RCPT_HEADER_LINE5,
						SINGLE_RCPT_HEADER_LINE6,
						SINGLE_RCPT_BODY_LINE1, 
						SINGLE_RCPT_BODY_LINE2,
						SINGLE_RCPT_BODY_LINE3,
						SINGLE_RCPT_BODY_LINE4,
						SINGLE_RCPT_BODY_LINE5,
						SINGLE_RCPT_BODY_LINE6, 
						SINGLE_RCPT_FOOTER_LINE1,
						SINGLE_RCPT_FOOTER_LINE2,
						SINGLE_RCPT_FOOTER_LINE3,
						SINGLE_RCPT_FOOTER_LINE4,
						SINGLE_RCPT_FOOTER_LINE5,
						SINGLE_RCPT_FOOTER_LINE6
	            into :b1_original_text,
					 :b1_copy_text,
					 :bl_header_line_01,
				     :bl_header_line_02,
					 :bl_header_line_03,
					 :bl_header_line_04,
					 :bl_header_line_05,
					 :bl_header_line_06,
					 :bl_body_line_01,
                     :bl_body_line_02,
				     :bl_body_line_03,
					 :bl_body_line_04,
					 :bl_body_line_05,
					 :bl_body_line_06,
					 :bl_footer_line_01,
					 :bl_footer_line_02,
					 :bl_footer_line_03,
					 :bl_footer_line_04,
					 :bl_footer_line_05,
					 :bl_footer_line_06
                FROM BL_CASH_BILL_PRINT_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id
				and bill_rcpt_ind='R'
				AND RCPT_RFND_IND=:l_rcpt_rfnd_ind
				AND   UPPER(NVL(LANGUAGE_ID,'en'))=UPPER('en');
	
	 if (NODATAFOUND)
	 {
            //err_mesg("Setup Not Found, Cannot Print.",0,"");
			disp_message(ERR_MESG,"Setup Not Found, Cannot Print");
			l_online_print_yn.arr[0]='N';
	 }

    } 
	   if (OERROR)
            err_mesg("SELECT failed on cursor BL_CASH_BILL_PRINT_FORMAT",0,"");

	}
			
bl_report_title_text.arr[bl_report_title_text.len]	= '\0';
b1_original_text.arr[b1_original_text.len]			='\0';
b1_copy_text.arr[b1_copy_text.len]					='\0';
bl_header_line_01.arr[bl_header_line_01.len]		= '\0';
bl_header_line_02.arr[bl_header_line_02.len]		= '\0';
bl_header_line_03.arr[bl_header_line_03.len]		= '\0';
bl_header_line_04.arr[bl_header_line_04.len]		= '\0';
bl_header_line_05.arr[bl_header_line_05.len]		= '\0';
bl_header_line_06.arr[bl_header_line_06.len]		= '\0';
bl_header_line_07.arr[bl_header_line_07.len]		= '\0';
bl_header_line_08.arr[bl_header_line_08.len]		= '\0';
bl_header_line_09.arr[bl_header_line_09.len]		= '\0';
bl_header_line_10.arr[bl_header_line_10.len]		= '\0';
bl_body_line_01.arr[bl_body_line_01.len]			= '\0';
bl_body_line_02.arr[bl_body_line_02.len]			= '\0';
bl_body_line_03.arr[bl_body_line_03.len]			= '\0';
bl_body_line_04.arr[bl_body_line_04.len]			= '\0';
bl_body_line_05.arr[bl_body_line_05.len]			= '\0';
bl_body_line_06.arr[bl_body_line_06.len]			= '\0';
bl_body_line_07.arr[bl_body_line_07.len]			= '\0';
bl_body_line_08.arr[bl_body_line_08.len]			= '\0';
bl_body_line_09.arr[bl_body_line_09.len]			= '\0';
bl_body_line_10.arr[bl_body_line_10.len]			= '\0';
bl_body_line_11.arr[bl_body_line_11.len]			= '\0';
bl_body_line_12.arr[bl_body_line_12.len]			= '\0';
bl_body_line_13.arr[bl_body_line_13.len]			= '\0';
bl_body_line_14.arr[bl_body_line_14.len]			= '\0';
bl_body_line_15.arr[bl_body_line_15.len]			= '\0';
bl_body_line_16.arr[bl_body_line_16.len]			= '\0';
bl_body_line_17.arr[bl_body_line_17.len]			= '\0';
bl_body_line_18.arr[bl_body_line_18.len]			= '\0';
bl_body_line_19.arr[bl_body_line_19.len]			= '\0';
bl_body_line_20.arr[bl_body_line_20.len]			= '\0';
bl_footer_line_01.arr[bl_footer_line_01.len]		= '\0';
bl_footer_line_02.arr[bl_footer_line_02.len]		= '\0';
bl_footer_line_03.arr[bl_footer_line_03.len]		= '\0';
bl_footer_line_04.arr[bl_footer_line_04.len]		= '\0';
bl_footer_line_05.arr[bl_footer_line_05.len]		= '\0';
bl_footer_line_06.arr[bl_footer_line_06.len]		= '\0';
bl_footer_line_07.arr[bl_footer_line_07.len]		= '\0';
bl_footer_line_08.arr[bl_footer_line_08.len]		= '\0';
bl_footer_line_09.arr[bl_footer_line_09.len]		= '\0';
bl_footer_line_10.arr[bl_footer_line_10.len]		= '\0';
nd_patient_id.arr[nd_patient_id.len]				= '\0';
nd_cust_code.arr[nd_cust_code.len]					= '\0'; 

	
}

print_head()
{
    
	   
   /*****added for IN14945*******/
    if (strcmp(nd_print_falg.arr,"N")==0)
	{
		if (b1_original_text.arr[0]!='\0')
		 {
		print_line(b1_original_text.arr); 
		fprintf(fp,"\n");
		line_ctr++;
		 }
		 	
	}
	else
	{

		if (b1_copy_text.arr[0]!='\0')
		 {
		print_line(b1_copy_text.arr); 
		fprintf(fp,"\n");
		line_ctr++;
		 }

	}
	

	/******end of IN14945*****/




	
	if (bl_header_line_01.arr[0] != '\0')
      {
		print_line(bl_header_line_01.arr); 
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_02.arr[0] != '\0')
      {
		
		
		print_line(bl_header_line_02.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_03.arr[0] != '\0')
      {
		print_line(bl_header_line_03.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_04.arr[0] != '\0')
      {
		print_line(bl_header_line_04.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_05.arr[0] != '\0')
      {
		print_line(bl_header_line_05.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_06.arr[0] != '\0')
      {
		print_line(bl_header_line_06.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_07.arr[0] != '\0')
      {
		print_line(bl_header_line_07.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_08.arr[0] != '\0')
      {
		print_line(bl_header_line_08.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_09.arr[0] != '\0')
      {
		print_line(bl_header_line_09.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bl_header_line_10.arr[0] != '\0')
      {
		print_line(bl_header_line_10.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
    
	if (bl_report_title_text.arr[0] != '\0')
      {
        fprintf(fp,"%c(s3B",ESC); 
		
  		print_line(bl_report_title_text.arr);
		
		fprintf(fp,"%c(s-3B",ESC); /* release bold style */
		fprintf(fp,"\n\n");
		
		line_ctr++;
		
		line_ctr++;
		
       }
}

fetch_cur()
{
    char temp_var[50]="\0";
	nd_reminder_format_id.arr[0]	= '\0';
	//nd_doc_type_code.arr[0]			= '\0';
//	nd_doc_num.arr[0]				= '\0';
	nd_reminder_no.arr[0]			= '\0';
	
	nd_reminder_format_id.len	= 0;
//	nd_doc_type_code.len		= 0;
//	nd_doc_num.len				= 0;
	nd_reminder_no.len			= 0;
	
	

     EXEC SQL FETCH BL_RECEIPT_FORMAT_CUR 
				 INTO	 //:nd_doc_type_code,
					    //:nd_doc_num,
						//:l_to_doc_type_code,
				    	//	:l_to_doc_type_num,
						:l_rcpt_rfnd_ind,
						:l_online_print_yn;



	 if (OERROR)
         err_mesg("FETCH failed on cursor BL_REM_LET_FORMAT_CUR",0,"");



      
	    	nd_reminder_format_id.arr[nd_reminder_format_id.len]= '\0';
			nd_doc_type_code.arr[nd_doc_type_code.len]			= '\0';
			nd_doc_num.arr[nd_doc_num.len]						= '\0';
			nd_reminder_no.arr[nd_reminder_no.len]				= '\0';


    return(LAST_ROW?0:1);
}



declare_receipt_main_cur()
{
   

	if(nd_pmnt_ref_num.arr[0]!='\0')
	{

		/*disp_message(ERR_MESG,nd_facility_id.arr);
		disp_message(ERR_MESG,nd_pmnt_ref_num.arr);
		disp_message(ERR_MESG,nd_function_id.arr);
		disp_message(ERR_MESG,nd_session_id.arr);
		disp_message(ERR_MESG,nd_pgm_date.arr);*/
			
		EXEC SQL DECLARE BL_RECEIPT_MAIN1 CURSOR FOR
			SELECT A.DOC_TYPE_CODE,
				   A.DOC_NUMBER,
				   A.RECPT_NATURE_CODE,
				   A.RECPT_REFUND_IND,
				   NVL(A.PRINT_FLAG,'N'),
				   'Y'
			FROM bl_receipt_refund_hdr A
			WHERE A.operating_facility_id=:nd_facility_id
			AND A.DOC_TYPE_CODE||'/'||A.DOC_NUMBER IN
					(
					SELECT B.SLMT_DOC_TYPE_CODE||'/'||B.SLMT_DOC_NUM
					FROM BL_CUST_PAYMENT_REF_DTL B
					WHERE B.OPERATING_FACILITY_ID=:nd_facility_id
					AND B.PMNT_REF_NUM = :nd_pmnt_ref_num
					)
			And ( (NVL(:nd_function_id,'X')='BL_REPRINT_RCPT_FOR_PMNT_DOC'
					And Exists (Select 'X' From SY_PROG_PARAM C
								Where  C.Operating_Facility_Id = :nd_facility_id
								   And C.PGM_ID='BLTCANPR'
								   And C.SESSION_ID = :nd_session_id
								   And C.PGM_DATE = :nd_pgm_date
								   And C.PARAM1 = A.DOC_TYPE_CODE
								   And C.PARAM2 = A.DOC_NUMBER)
				   )
				  OR (NVL(:nd_function_id,'X')!='BL_REPRINT_RCPT_FOR_PMNT_DOC' )
				 );

		}
		else
		{

	
			EXEC SQL DECLARE BL_RECEIPT_MAIN CURSOR FOR
						select doc_type_code,
						doc_number,
						RECPT_NATURE_CODE,
						RECPT_REFUND_IND,
						NVL(PRINT_FLAG,'N'),
						'Y'
						from bl_receipt_refund_hdr
						where doc_type_code between :d_doc_type_code 
											and nvl(:l_to_doc_type_code,:d_doc_type_code)
						and doc_number between  :d_doc_number 
									   and nvl(:l_to_doc_type_num,:d_doc_number);
		}

	

	if(OERROR)
	{ 
		err_mesg("DECLARE FAILED IN BL_RECEIPT_MAIN",0,"");
	}
	
	
	
	if(nd_pmnt_ref_num.arr[0]!='\0')
		EXEC SQL OPEN BL_RECEIPT_MAIN1;
	else
		EXEC SQL OPEN BL_RECEIPT_MAIN;
}

fetch_receipt_main_cur()
{
  
	d_doc_type_code1.arr[0]='\0';
	nd_print_falg.arr[0]='\0';
	d_doc_type_code1.len=0;
	d_doc_number1.arr[0]='\0';
	d_doc_number1.len=0;
	d_receipt_nature_code.arr[0]='\0';
	d_receipt_nature_code.len=0;
	
	
	if(nd_pmnt_ref_num.arr[0]!='\0')
	{
			EXEC SQL FETCH BL_RECEIPT_MAIN1 
			 into  :d_doc_type_code1,
			 :d_doc_number1,
			 :d_receipt_nature_code,
			 :l_rcpt_rfnd_ind,
			 :nd_print_falg,
			 :l_online_print_yn;
	}
	else
	{
		EXEC SQL FETCH BL_RECEIPT_MAIN 
			 into  :d_doc_type_code1,
			 :d_doc_number1,
			 :d_receipt_nature_code,
			 :l_rcpt_rfnd_ind,
			 :nd_print_falg,
			 :l_online_print_yn;
	}

	

	if(NODATAFOUND)
	{
	   return 0;
	}
	

	if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN BL_RECEIPT_MAIN",0,"");
		proc_exit();
	}

	nd_print_falg.arr[nd_print_falg.len]				 ='\0';
	d_doc_type_code1.arr[d_doc_type_code1.len]			 ='\0';
	d_doc_number1.arr[d_doc_number1.len]				 ='\0';	
	d_receipt_nature_code.arr[d_receipt_nature_code.len] ='\0';

/*
strcpy(d_doc_type_code1.arr,d_doc_type_code1.arr);
strcpy(d_doc_number1.arr,d_doc_number1.arr);
strcpy(d_receipt_nature_code.arr,d_receipt_nature_code.arr);
*/



}

close_receipt_main_cur()
{
	if(nd_pmnt_ref_num.arr[0]!='\0')
		EXEC SQL CLOSE BL_RECEIPT_MAIN1;
	else
		EXEC SQL CLOSE BL_RECEIPT_MAIN;
    
}

fun_amt_in_words1()
{
 	amt_in_words.arr[0]='\0';
	amt_in_words.len=0;
	
	amt_in_words_Sep.arr[0]='\0';
	amt_in_words_Sep.len=0;

	EXEC SQL EXECUTE
	BEGIN		
	:no_of_lines:=bl_spell_number.print_in_words
						(:nd_facility_id||'|'||:nd_lang_id,
						 abs(nvl(:nd_column_val,0)),
						  70,
						 :cur_str,
						 :sub_cur_str,
						 :nd_no_of_decimal,
						 :amt_in_words,
						 :amt_in_words_Sep1);
  	END;
	END-EXEC;
	amt_in_words.arr[amt_in_words.len]='\0';
	amt_in_words_Sep1.arr[amt_in_words_Sep1.len]='\0';

EXEC SQL SELECT REPLACE(:amt_in_words_Sep1,'~',CHR(10)||'                              ') 
		 INTO :amt_in_words_Sep
		 FROM DUAL;
	amt_in_words_Sep.arr[amt_in_words_Sep.len]='\0';
}


fun_amt_in_words2()
{
 	amt_in_words.arr[0]='\0';
	amt_in_words.len=0;
	
	amt_in_words_Sep.arr[0]='\0';
	amt_in_words_Sep.len=0;

	EXEC SQL EXECUTE
	BEGIN		
	:no_of_lines:=bl_spell_number.print_in_words
						(:nd_facility_id||'|'||:nd_lang_id,
						 abs(nvl(:l_exm_bill_amt,0)),
						  70,
						 :cur_str,
						 :sub_cur_str,
						 :nd_no_of_decimal,
						 :amt_in_words,
						 :amt_in_words_Sep1);
  	END;
	END-EXEC;
	amt_in_words.arr[amt_in_words.len]='\0';
	amt_in_words_Sep1.arr[amt_in_words_Sep1.len]='\0';

EXEC SQL SELECT REPLACE(:amt_in_words_Sep1,'~',CHR(10)||'                              ') 
		 INTO :amt_in_words_Sep
		 FROM DUAL;
	amt_in_words_Sep.arr[amt_in_words_Sep.len]='\0';
}
get_discount_count()  //added for IN9051
{

l_discount_count=0;

EXEC SQL SELECT  count(*) into  l_discount_count
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND UPD_NET_CHARGE_AMT <>0
	AND EPISODE_TYPE = :d_episode_type
	AND ((((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and 
			 (
				(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
				OR 
				(:d_episode_type = 'R')
			 )
	     and (
				(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
				OR
				(:d_episode_type IN ('I','D','R'))
	         )
		 )
        or
		(:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
       )
	AND PATIENT_ID = :d_patient_id
    and (trx_status is null 

                or (trx_status ='C' and  
						
					  (	(REV_ADJ_TRX_IND='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 
                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						/* the below code added by raghava on 23/09/2010 for UAT */
						or
                        (REV_ADJ_TRX_IND IS NULL and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) not in 
                         (Select NVL(SOURCE_DOC_REF,'XXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,9999) from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						/* upto here */
						
						or (  ((:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and :l_sum_bill_amt=0)
						    or(((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and :d1_bill_amt=0)
						   )
					  )
					) 

                     //or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) Commented by raghava on 04/10/2010 for UAT
                    //    not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from  Commented by raghava on 04/10/2010 for UAT
					or (REV_ADJ_TRX_IND ='B' and (nvl(SOURCE_DOC_REF,'XXXXXXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,99999999)) 
                        not in (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 		bl_patient_charges_folio 
								where OPERATING_FACILITY_ID = :nd_facility_id 
								and patient_id=:d_patient_id           
								and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								   )
							   )

        ))
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND ( (((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))     
		   AND B.BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
	       AND B.BILL_DOC_NUM =:d2_bill_doc_num
		  )
		 OR(  (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and 
		      (B.BILL_DOC_TYPE_CODE,B.BILL_DOC_NUM) In
		      (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
				FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
				WHERE a.operating_facility_id=:nd_facility_id
				AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
				AND b.BILL_DOC_NUM = a.DOC_NUM
				AND b.DOC_TYPE_CODE  =:d_doc_type_code1
				AND b.DOC_NUMBER=:d_doc_number1	
			  )
		   )
		)
	 );

		
}

get_addlcharge_count()  //added for IN9051
{

l_addlcharge_count=0;

EXEC SQL SELECT  count(*) into  l_addlcharge_count
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND UPD_NET_CHARGE_AMT <>0
	AND EPISODE_TYPE = :d_episode_type
	AND ((((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and 
			 (
				(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
				OR 
				(:d_episode_type = 'R')
			 )
	     and (
				(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
				OR
				(:d_episode_type IN ('I','D','R'))
	         )
		 )
        or
		(:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
       )
	AND PATIENT_ID = :d_patient_id
    and (trx_status is null 

                or (trx_status ='C' and  
						
					  (	(REV_ADJ_TRX_IND='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 
                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						 /* the below code added by raghava on 23/09/2010 for UAT */
						or
                        (REV_ADJ_TRX_IND IS NULL and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) not in 
                         (Select NVL(SOURCE_DOC_REF,'XXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,9999) from 
                          bl_patient_charges_folio 
						  where OPERATING_FACILITY_ID = :nd_facility_id
						  and patient_id=:d_patient_id      
						  and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								 )
						 )
						)
						/* upto here */
						or (  ((:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and :l_sum_bill_amt=0)
						    or(((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N')) and :d1_bill_amt=0)
						   )
					  )
					) 

                     //or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) Commented by raghava on 04/10/2010 for UAT
                    //    not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from  Commented by raghava on 04/10/2010 for UAT
					or (REV_ADJ_TRX_IND ='B' and (nvl(SOURCE_DOC_REF,'XXXXXXXX'),NVL(SOURCE_DOC_REF_LINE_NUM,99999999)) 
                        not in (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 								bl_patient_charges_folio 
								where OPERATING_FACILITY_ID = :nd_facility_id 
								and patient_id=:d_patient_id           
								and ( ( (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y')
									    and (bill_doc_type_code,bill_doc_num) In
									     (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
											FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
											WHERE a.operating_facility_id=:nd_facility_id
											AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
											AND b.BILL_DOC_NUM = a.DOC_NUM
											AND b.DOC_TYPE_CODE  =:d_doc_type_code1
											AND b.DOC_NUMBER=:d_doc_number1	
										  )
									   )
								    or( ((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))
									     and bill_doc_type_code =:d2_bill_doc_type_code
								         and bill_doc_num =  :d2_bill_doc_num 
									   )
								   )
							   )

        ))
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND ( (((:d3_bill_doc_type_code Is Not Null) or (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='N'))     
		   AND B.BILL_DOC_TYPE_CODE = :d2_bill_doc_type_code
	       AND B.BILL_DOC_NUM =:d2_bill_doc_num
		  )
		 OR(  (:d3_bill_doc_type_code Is Null and :l_con_rcpt_yn='Y') and 
		      (B.BILL_DOC_TYPE_CODE,B.BILL_DOC_NUM) In
		      (	SELECT DISTINCT a.DOC_TYPE_CODE,a.DOC_NUM
				FROM bl_bill_hdr a,bl_bills_for_cons_receipt b
				WHERE a.operating_facility_id=:nd_facility_id
				AND b.BILL_DOC_TYPE_CODE = a.DOC_TYPE_CODE
				AND b.BILL_DOC_NUM = a.DOC_NUM
				AND b.DOC_TYPE_CODE  =:d_doc_type_code1
				AND b.DOC_NUMBER=:d_doc_number1	
			  )
		   )
		)
	 );



	
}


fun_Pad_desc_with_spl_char_yn()
{
nd_pad_req_yn.arr[0]		='\0';
nd_pad_req_yn.len			=	0;
nd_print_option.arr[0]		= '\0';	
nd_print_option.len			=	0;		


	if ( strcmp(nd_lang_id.arr,"ar")==0 || strcmp(nd_lang_id.arr,"th")==0)
	{
		fun_get_batch_filename();

		if( strcmp(nd_batch_filename.arr,"LOCAL")==0) 
			{
				nd_pad_req_yn.arr[0]='Y';
				nd_print_option.arr[0]='N';	
			}
		
		else
			{
				nd_pad_req_yn.arr[0]='N';
				//nd_print_option.arr[0]='R';	
			}	 
		
		
		nd_pad_req_yn.len=strlen(nd_pad_req_yn.arr);
		nd_print_option.len=strlen(nd_print_option.arr);

		nd_pad_req_yn.arr[nd_pad_req_yn.len]	 = '\0';
		nd_print_option.arr[nd_print_option.len] = '\0';
		
	}


}

payer_adjust_receipt_yn()
{
	d_payer_adjust_yn.arr[0] = '\0';
	d_payer_adjust_yn.len	 = 0;

	EXEC SQL select PAYER_ADJ_AMT_RECEIPT_YN
			 into :d_payer_adjust_yn 
			 from bl_receipt_refund_hdr 
			 where OPERATING_FACILITY_ID=:nd_facility_id
			 and  DOC_TYPE_CODE=:d_doc_type_code1
			 and  DOC_NUMBER=:d_doc_number1;


						
	d_payer_adjust_yn.arr[d_payer_adjust_yn.len] = '\0';

}

fun_get_batch_filename()
{
	nd_batch_filename.arr[0] = '\0';
	nd_batch_filename,len	= 0;
	


	EXEC SQL select batch_file_name 				
			 into :nd_batch_filename
			 from sm_report
			 where report_id=:nd_reportid;

	nd_batch_filename.arr[nd_batch_filename.len] = '\0';
	
	  

}

fun_Pad_desc_with_spl_char(orig_string)
char orig_string[101];
{
	

	orig_desc_string.arr[0]		= '\0';
	orig_desc_string.len		=	0;
	nd_desc_with_spl_chr.arr[0]	= '\0';
	nd_desc_with_spl_chr.len	= 0;
	nd_length_of_string=0;

	strcpy(orig_desc_string.arr,orig_string);
		
	orig_desc_string.len	= strlen(orig_desc_string.arr);
	orig_desc_string.arr[orig_desc_string.len] = '\0';
		
	EXEC SQL select length(:orig_desc_string)+1 into :nd_length_of_string from dual;

					
	EXEC SQL select rpad(:orig_desc_string,:nd_length_of_string,chr(20))
				into :nd_desc_with_spl_chr from dual;
	
		
		nd_desc_with_spl_chr.arr[nd_desc_with_spl_chr.len] = '\0';


	
}


get_param_for_Exemption()
{
	
	d_doc_type_code.arr[0]    = '\0';
	l_to_doc_type_code.arr[0] = '\0';
	d_doc_number.arr[0]       = '\0'; 
	l_to_doc_type_num.arr[0]  = '\0';
	l_online_print_yn.arr[0] = '\0';
	l_episode_type.arr[0] = '\0';
	d_row_id.arr[0]			='\0';
	nd_user_id.arr[0]		='\0';
	nd_status.arr[0]		='\0';

	nd_logo_pgm_id.arr[0]	= '\0';
	nd_logo_pgm_id.len	= 0;

	nd_reprint_yn.arr[0] = '\0';
	nd_reprint_yn.len = 0;
	nd_status.len=0;

	curr_date.arr[0] = '\0';
	curr_date.len = 0;
	nd_fm_doc_date.arr[0] = '\0';
	nd_fm_doc_date.len = 0;
	nd_to_doc_date.arr[0] = '\0';
	nd_to_doc_date.len = 0;
	nd_pgm_id.arr[0] = '\0';
	nd_pgm_id.len = 0;
	d_row_id.len=0;
	nd_user_id.len=0;




	EXEC SQL SELECT param5, 
					param6, 
					param9, 
					param7, 
					'Y',
					nvl(param10,'N'),					
					to_char(sysdate,'DD/MM/YYYY HH24:MI'),
					param2,
					param3,
					param4,
					pgm_id,
					param11,
					param12
			   INTO	:d_doc_type_code,
					:d_doc_number ,
					:l_to_doc_type_code,
					:l_to_doc_type_num,
					:l_online_print_yn,
					:nd_reprint_yn,
					:curr_date,
					:nd_reason_code,
					:nd_fm_doc_date,
					:nd_to_doc_date,
					:nd_pgm_id,
					:nd_user_id,
					:nd_status		
			   FROM sy_prog_param
			  WHERE pgm_id     = 'BLREXMAD'
	            AND PGM_DATE   = :nd_pgm_date 
	            AND SESSION_ID = :nd_session_id;
				



	if(OERROR)
		err_mesg("SELECT failed on SY_PROG_PARAM",0,"");

	d_doc_type_code.arr[d_doc_type_code.len]		= '\0';
	l_to_doc_type_code.arr[l_to_doc_type_code.len]	= '\0';
	d_doc_number.arr[d_doc_number.len]				= '\0'; 
	l_to_doc_type_num.arr[l_to_doc_type_num.len]	= '\0';
	l_online_print_yn.arr[l_online_print_yn.len]	= '\0';
    l_episode_type.arr[l_episode_type.len]			='\0';
	nd_reprint_yn.arr[nd_reprint_yn.len]			= '\0';
	nd_logo_pgm_id.arr[nd_logo_pgm_id.len]			= '\0';
	curr_date.arr[curr_date.len]					= '\0';
	nd_fm_doc_date.arr[nd_fm_doc_date.len]					= '\0';
	nd_to_doc_date.arr[nd_to_doc_date.len]					= '\0';
	nd_pgm_id.arr[nd_pgm_id.len]					= '\0';
    d_row_id.arr[d_row_id.len]						='\0';
	nd_user_id.arr[nd_user_id.len]					='\0';
	nd_status.arr[nd_status.len]					='\0';

	
	EXEC SQL DELETE 
	         FROM sy_prog_param
			 WHERE pgm_id     = 'BLREXMAD'
	         AND PGM_DATE   = :nd_pgm_date
	         AND SESSION_ID = :nd_session_id;
			 

    EXEC SQL COMMIT; 
}


fetch_legend_value1()
{
	loc_legend68.arr[0]	= '\0';
	loc_legend110.arr[0]	= '\0';

	loc_legend68.len	=0;
	loc_legend110.len	=0;

	for(i=1;i<=100;i++)
	{
		l_pk_value.arr[0] = '\0';

		EXEC SQL SELECT LTRIM(RTRIM('BLR0014E.LEGEND_'||LTRIM(RTRIM(TO_CHAR(:i,'009')))))
		           INTO :l_pk_value
				   FROM dual;

		l_pk_value.arr[l_pk_value.len]	= '\0';
		l_translated_value.arr[0]		= '\0';

		EXEC SQL EXECUTE
		BEGIN
			blcommon.get_local_lang_desc(:nd_facility_id,
										'SM',
										'SM_LANG_LEGEND',
										'DFLT_LEGEND_VALUE',
										:l_pk_value,
										:l_translated_value,
										:nd_lang_id);
		END;
		END-EXEC;

		l_translated_value.arr[l_translated_value.len] = '\0';
		
		strcpy(loc_legend[i],l_translated_value.arr);

	}




	EXEC SQL select  COLUMN_VALUE 
		into :loc_legend68
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BLR0014E.LEGEND_0680' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
	EXEC SQL select dflt_legend_value into :loc_legend68
	from sm_lang_legend
	where LEGEND_ID = 'BLR0014E.LEGEND_0680';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on BLR0014E.LEGEND_0680",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
			into :loc_legend110
			from SM_RECORD_TRANS_DATA a,sm_lang_legend b
			where MODULE_ID = 'SM' 
			and TABLE_ID = 'SM_LANG_LEGEND'
			and COLUMN_ID = 'DFLT_LEGEND_VALUE'
			and PK_VALUE = LEGEND_ID
			and LEGEND_ID = 'BLR0014E.LEGEND_110' 
			and LANGUAGE_ID = :nd_lang_id;

		if (sqlca.sqlcode == 1403)
		{
		EXEC SQL select dflt_legend_value into :loc_legend110
		from sm_lang_legend
		where LEGEND_ID = 'BLR0014E.LEGEND_110';
		}

			if (sqlca.sqlcode < 0)
				{   
					err_mesg("SELECT failed on BLR0014E LEGEND 110",0,"");
				}


	loc_legend68.arr[loc_legend68.len]		= '\0';
	loc_legend110.arr[loc_legend110.len]	= '\0';

}

fetch_legend_value2()
{

	loc_legend68.arr[0]	= '\0';
	loc_legend68.len	=0;
	
	EXEC SQL select  COLUMN_VALUE 
		into :loc_legend68
		from SM_RECORD_TRANS_DATA a,sm_lang_legend b
		where MODULE_ID = 'SM' 
		and TABLE_ID = 'SM_LANG_LEGEND'
		and COLUMN_ID = 'DFLT_LEGEND_VALUE'
		and PK_VALUE = LEGEND_ID
		and LEGEND_ID = 'BLR0014E.LEGEND_008' 
		and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
	EXEC SQL select dflt_legend_value into :loc_legend68
	from sm_lang_legend
	where LEGEND_ID = 'BLR0014E.LEGEND_008';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on BLR0014E.LEGEND_0680",0,"");
	}


	loc_legend68.arr[loc_legend68.len]		= '\0';
}

print_header_exemption()
{
	
	
	get_encounter_id(2);
	
	nd_ln4_add.arr[0] = '\0';
	nd_ln4_add.len	  = 0;
	
	if(strcmp(d_print_yn.arr,"Y")==0)
	 {
	  fprintf(fp,"%-65.65s "," ");
	  if (l_lsr!= 0 && l_dmp== 0)
	  {
		fprintf(fp,"%c(s10H",ESC);	 						 // TO SET FONT SIZE
	 	fprintf(fp,"%c(s3B",ESC);  
	  }
	  if (l_lsr== 0 && l_dmp!= 0)
	  {
	   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	   fprintf(fp,"%cW1",ESC); 		          /* To Set doble width For Dotmatrix*/
	  }
		fprintf(fp,"%s",loc_legend[2]);
	  if (l_lsr!= 0 && l_dmp== 0)
	  {
	   	fprintf(fp,"%c(s-3B",ESC);
		fprintf(fp,"%c(s14H",ESC);
	  }
	  if (l_lsr==0 && l_dmp!= 0)
	  {
	   fprintf(fp,"%cW0",ESC); 		      /* To Set doble width For Dotmatrix*/
	   fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	  }
	  fprintf(fp,"\n");
	 }
     if (l_lsr!= 0 && l_dmp== 0)
     {	
	  fprintf(fp,"%c(s10H",ESC);	 						 // TO SET FONT SIZE
	  fprintf(fp,"%c(s3B",ESC); 
     }

	if(strcmp(nd_reportid.arr,"BLR0014E")==0)
	{
	 if (l_lsr!= 0 && l_dmp== 0)
	 fun_centre(loc_legend[1],80);
	 if (l_lsr== 0 && l_dmp!= 0)
	 {
	  fun_centre(loc_legend[1],105);
	  fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
	 }
	 fprintf(fp,"%s",loc_legend[1]);
	 if (l_lsr== 0 && l_dmp!= 0)
	 fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	 fprintf(fp,"\n");
	}
	if(strcmp(nd_reportid.arr,"BLR0014C")==0)
	{
		if (l_lsr!= 0 && l_dmp== 0)
		fun_centre(loc_legend[11],80);
		if (l_lsr== 0 && l_dmp!= 0)
		{
		 fun_centre(loc_legend[11],105);
		 fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
		}
		fprintf(fp,"%s",loc_legend[11]);
		if (l_lsr== 0 && l_dmp!= 0)
		fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
		fprintf(fp,"\n");
	}

   if (l_lsr!= 0 && l_dmp== 0)
   {
	fprintf(fp,"%c(s-3B",ESC);
	fprintf(fp,"%c(s14H",ESC);
   }
   
   //fprintf(fp,"\n%-67.67s\n",nd_facility_name.arr); SCF-6444
   fprintf(fp,"\n%-67.67s",nd_facility_name.arr);     //SCF-6444
   if (l_lsr== 0 && l_dmp!= 0)  //added for IN20825
   {
	   /*** Cash Counter ****/
	  len_desc = strlen(nd_counter_name.arr);	  
	  while(r_ctrdesc < len_desc)
	  {	
		split_text(nd_counter_name.arr,30,cl_string_desc,&r_ctrdesc);
		if(l_ctr==1)
		{
		  fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
		  fprintf(fp,"%-12.12s : ",loc_legend995.arr);
		  fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
		  fprintf(fp,"%-30.30s ",cl_string_desc);
		}
		else
		fprintf(fp,"%-70.70s %-12.12s   %-30.30s "," "," ",cl_string_desc);
		strcpy(cl_string_desc,"");  
		fprintf(fp,"\n");line_no = line_no + 1;
		l_ctr++;
	  } 
	  r_ctrdesc=0;
	  l_ctr=1;	
	  if(nd_counter_name.arr[0]=='\0')
	  {
	   fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	   fprintf(fp,"%-12.12s   ",loc_legend995.arr);
	   fprintf(fp,"%cF",ESC); 		          /* To Set Realse the Bold For Dotmatrix*/
	   fprintf(fp,"\n");
	   line_no = line_no + 1;
	  }

   }

  fprintf(fp,"%-67.67s",nd_hosp_add.arr);
   
    if (l_lsr!= 0 && l_dmp== 0)
   	fprintf(fp,"%c(s3B",ESC); 

	if (l_lsr==0 && l_dmp!= 0)
    fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/

	fprintf(fp,"%-8.8s",loc_legend[3]);

	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);

    if (l_lsr==0 && l_dmp!= 0)
    fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/


	fprintf(fp," %-s/%-s\n",d_doc_type_code1.arr,d_doc_number1.arr);


	if(strcmp(nd_ln1_add.arr,"\0")!=0)
	{
		sprintf(st_var,"%-17.17s",nd_ln1_add.arr);
		strcat(nd_ln4_add.arr,st_var);
	}
	
	if(strcmp(nd_ln2_add.arr,"\0")!=0)
	{
		if(strcmp(nd_ln2_add.arr,"\0")!=0)
		 strcat(nd_ln4_add.arr,",");

		sprintf(st_var,"%-16.16s",nd_ln2_add.arr);
		strcat(nd_ln4_add.arr,st_var);
	}
	
	if(strcmp(nd_ln3_add.arr,"\0")!=0)
	{
		if(strcmp(nd_ln2_add.arr,"\0")!=0 || strcmp(nd_ln1_add.arr,"\0")!=0)
		 strcat(nd_ln4_add.arr,",");

		sprintf(st_var,"%-15.15s",nd_ln3_add.arr);
		strcat(nd_ln4_add.arr,st_var);
	}
	
	if(strcmp(nd_tel.arr,"\0")!=0)
	{
		if(strcmp(nd_ln3_add.arr,"\0")!=0 || strcmp(nd_ln2_add.arr,"\0")!=0 || strcmp(nd_ln1_add.arr,"\0")!=0 )
		 strcat(nd_ln4_add.arr,",");

		sprintf(st_var,"%-14.14s",nd_tel.arr);
		strcat(nd_ln4_add.arr,st_var);
	}

	nd_ln4_add.len	= strlen(nd_ln4_add.arr);
	nd_ln4_add.arr[nd_ln4_add.len] = '\0';

	
	//fprintf(fp,"%-62.62s  ",nd_ln4_add.arr);
	fprintf(fp,"%-67.67s",nd_hosp_add1.arr);
	
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC); 
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	fprintf(fp,"%-8.8s:",loc_legend[4]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC); 
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/

	
	if(d_receipt_date.arr[0]!='\0')
	{
	 init_date_temp_var();
	 strcpy(date_convert.arr,d_receipt_date.arr);
	 fun_change_loc_date1();
	 //fun_change_loc_date2(); //COMMNTED BY VANI
	 //strcpy(d_receipt_date.arr,nd_loc_date1.arr);
	 strcpy(d_receipt_date_nd.arr,nd_loc_date1.arr);//changed by sarvinder for SCF-9456
    }
	
	//fprintf(fp,"%-s %-s\n",d_receipt_date.arr,loc_legend[9]);
	fprintf(fp,"%-s %-s\n",d_receipt_date_nd.arr,loc_legend[9]);//changed by sarvinder for SCF-9456

	//fprintf(fp,"%-5.5s %-13.13s %-12.12s %12.12s %-13.13s %8.8s %s %s\n\n"," ",nd_ln1_add.arr,nd_ln2_add.arr,nd_ln3_add.arr,nd_tel.arr,loc_legend[4],curr_date.arr,loc_legend[9]); 
	
	get_patient_name1();

	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	fprintf(fp,"%-14.14s",loc_legend[5]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC); 
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/

	fprintf(fp,"%-50.50s",d_patient_name.arr);
    if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
    fprintf(fp,"%cE",ESC); 		          /* To Set Bold For Dotmatrix*/
	fprintf(fp,"%-3.3s:",loc_legend[6]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	fprintf(fp," %-20.20s\n",d2_patient_id.arr);

	if (l_lsr!= 0 && l_dmp== 0)
	printf(fp,"%c(s3B",ESC);

	if (l_lsr==0 && l_dmp!= 0)
	{
	fprintf(fp,"%cE",ESC); 		      /* To Set the Bold For Dotmatrix*/
	fprintf(fp,"%-15.15s: ",loc_legend1457.arr);
	}

	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);

	if (l_lsr==0 && l_dmp!= 0)
	{
	fprintf(fp,"%cF",ESC); 		      /* To Set the Bold For Dotmatrix*/
    fprintf(fp,"%-s\n",nd_encounter_id.arr);
	}

	

}


get_patient_name1()
{
		
		
		if(strlen(d2_patient_id.arr) != 0) 
			{ 
				d_patient_name.arr[0]			= '\0';
				d_patient_name_loc_lang.arr[0]  = '\0';
				nd_nationality.arr[0]			= '\0';
				d_nric_no.arr[0]				= '\0';
				d_date_of_birth.arr[0]			= '\0';
				d_org_dept.arr[0]				= '\0';
				d_gender.arr[0]					= '\0';
				d_gender_desc.arr[0]='\0';
					
				d_patient_name.len			 = 0;
				d_patient_name_loc_lang.len  = 0;
				nd_nationality.len			 = 0;
				d_nric_no.len				 = 0;
				d_date_of_birth.len			 = 0;
				d_org_dept.len				 = 0;
				d_gender.len				 = 0;
				d_gender_desc.len			 = 0;

				EXEC SQL SELECT decode(:nd_lang_id,'en',SHORT_NAME,SHORT_NAME_loc_lang),
	       						NATIONALITY_CODE,
								NATIONAL_ID_NUM,
								to_char(DATE_OF_BIRTH,'dd/mm/yyyy'),
								BLCOMMON.get_pat_EmpOrgDept(:d2_patient_id,:nd_lang_id),
								sex
						   INTO :d_patient_name,
								:nd_nationality,
								:d_nric_no,
								:d_date_of_birth,
								:d_org_dept,
								:d_gender
						   FROM MP_PATIENT_MAST
						  WHERE PATIENT_ID = :d2_patient_id;

				 if(OERROR)
				 {   
					err_mesg("SELECT failed on table MP_PATIENT_MAST",0,"");
				 }

				 d_patient_name.arr[d_patient_name.len]						= '\0';
				 d_patient_name_loc_lang.arr[d_patient_name_loc_lang.len]   = '\0';
				 nd_nationality.arr[nd_nationality.len]						= '\0';
				 d_nric_no.arr[d_nric_no.len]								= '\0';
				 d_date_of_birth.arr[d_date_of_birth.len]					= '\0';
				 d_org_dept.arr[d_org_dept.len]								= '\0';
				 d_gender.arr[d_gender.len]									= '\0';

				if(d_gender.arr[0]=='M')
				strcpy(d_gender_desc.arr,loc_legend1412.arr);
				else
				if(d_gender.arr[0]=='F')
				strcpy(d_gender_desc.arr,loc_legend1413.arr);
				else
				strcpy(d_gender_desc.arr,loc_legend1414.arr);
			}

			
			

 }

 Print_footer()
 {

	//fprintf(fp,"\n");
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
	fprintf(fp,"%-29.29s	%-19.19s ",loc_legend[12]," ");
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/
	print_formated_amt2(l_exm_bill_amt);
	
	fprintf(fp,"\n%-22.22s	%-27.27s "," "," ");
	fun_amt_in_words2();
	fprintf(fp,"%s ","(");
	fprintf(fp," %s",amt_in_words_Sep.arr);
	fprintf(fp,"%s",")");

	if(strcmp(nd_reportid.arr,"BLR0014C")==0)
	{
	get_reason_desc();

	fprintf(fp,"\n\n");
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
 	fprintf(fp,"%-26.26s ",loc_legend[15]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/

	fprintf(fp,"%s",d_reason_desc.arr);

    fprintf(fp,"\n");
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cE",ESC); 		          /* To Release Bold For Dotmatrix*/
	fprintf(fp,"%-26.26s ",loc_legend[16]);
	if (l_lsr!= 0 && l_dmp== 0)
	fprintf(fp,"%c(s-3B",ESC);
	if (l_lsr==0 && l_dmp!= 0)
	fprintf(fp,"%cF",ESC); 		          /* To Release Bold For Dotmatrix*/

	fprintf(fp,"%s",d_exm_reason_remarks.arr);
	}


	
 }

 count_no_of_records()
 {
	l_count_no_of_docs=0;

	
		EXEC SQL Select  count(*) into l_count_no_of_docs						   
				from BL_BILL_ADJ_HDR A
				where a.operating_facility_id=:nd_facility_id
				and a.doc_type_code BETWEEN :d_doc_type_code
				AND NVL(:l_to_doc_type_code,:d_doc_type_code)
				and a.DOC_NUM BETWEEN    :d_doc_number 
				AND NVL(:l_to_doc_type_num, :d_doc_number)
				and to_date(to_char(a.doc_date,'DD/MM/YYYY'),'DD/MM/YYYY') between to_date(:nd_fm_doc_date,'DD/MM/YYYY') and  to_date(:nd_to_doc_date,'DD/MM/YYYY')
				and A.reason_code=nvl(:nd_actual_reason,A.reason_code)
				and nvl(CANCELLED_YN,'N')=:nd_status;
}

get_reason_desc()
{
	EXEC SQL select ACTION_REASON_DESC into :d_reason_desc
	         from bl_action_reason_lang_vw
			 where ACTION_REASON_CODE=:d_reason
			 and LANGUAGE_ID=:nd_lang_id;
}


get_prepare_by()
{

  nd_user_name.arr[0]='\0';
  nd_user_name.len	  =0; 
  nd_print_user_name.arr[0]='\0';
  nd_print_user_name.len=0;
  

  EXEC SQL SELECT DISTINCT APPL_USER_NAME
  INTO  :nd_user_name
  FROM   SM_APPL_USER_LANG 
  WHERE  APPL_USER_ID=:nd_user_id
  AND	 LANGUAGE_ID  =:nd_lang_id;
  


 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }
 
  nd_user_name.arr[nd_user_name.len]='\0';

  strcpy(nd_print_user_name.arr,"(");
  strcat(nd_print_user_name.arr,nd_user_name.arr);
  strcat(nd_print_user_name.arr,")");
  
  nd_print_user_name.len=strlen(nd_print_user_name.arr);
  nd_print_user_name.arr[nd_print_user_name.len]='\0';

     
}


get_cashier_designation1()
{
 
 
 nd_cahier_position.arr[0] ='\0';
 nd_cahier_position.len	   = 0;


 EXEC SQL EXECUTE
    
	DECLARE
    nd_func_role  VARCHAR2(3);
	
	BEGIN
		
			SELECT long_desc 
			INTO :nd_cahier_position
			FROM sm_appl_user_lang_vw a,am_other_staff b,am_other_staff_type_lang_vw C
			WHERE a.appl_user_id=:d_added_by_id
			AND b.OTHER_STAFF_ID = a.FUNC_ROLE_ID
			AND c.OTHER_STAFF_TYPE = b.OTHER_STAFF_TYPE
			AND c.language_id=:nd_lang_id
			AND a.language_id=:nd_lang_id;

	


	END;

END-EXEC;
 
    
    nd_cahier_position.arr[nd_cahier_position.len]='\0';

	
 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }

 
}

get_uesr_position()
{
 
 
 nd_user_position.arr[0] ='\0';
 nd_user_position.len	   = 0;


 EXEC SQL EXECUTE
    
	DECLARE
    nd_func_role  VARCHAR2(3);
	
	BEGIN
			SELECT long_desc 
			INTO :nd_user_position
			FROM sm_appl_user_lang_vw a,am_other_staff b,am_other_staff_type_lang_vw C
			WHERE a.appl_user_id=:nd_user_id
			AND b.OTHER_STAFF_ID = a.FUNC_ROLE_ID
			AND c.OTHER_STAFF_TYPE = b.OTHER_STAFF_TYPE
			AND c.language_id=:nd_lang_id
			AND a.language_id=:nd_lang_id;

	END;

END-EXEC;
 
    
    nd_user_position.arr[nd_user_position.len]='\0';

 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }

 
}


declare_exm_footer()
{

	EXEC SQL DECLARE Exemption_Bills_cursor1 CURSOR FOR
				SELECT  ADJ_DOC_TYPE_CODE, ADJ_DOC_NUM,to_char(BILL_OUT_AMT_BEF_ADJ_EXM),
				EPISODE_TYPE,
				EPISODE_ID,
				VISIT_ID											 
				FROM bl_bill_adj_dtl
				WHERE operating_facility_id=:nd_facility_id
				and  DOC_TYPE_CODE  =:d_doc_type_code1
				AND DOC_NUM=:d_doc_number1
				order by ADJ_DOC_TYPE_CODE,ADJ_DOC_NUM;



				if (OERROR)
				{ 
				disp_message (ERR_MESG,"Declare Exemption_Bills_cursor1 failed");
				proc_exit();
				}


}


open_exm_footer()
{
		
		
		EXEC SQL OPEN Exemption_Bills_cursor1;

		if (OERROR) 
			{ 
				disp_message (ERR_MESG,"Open bills_receipt_cursor1 failed");
				proc_exit();
			}
			
		
}


fetch_exm_footer()
{

	d_exm_bill_code.arr[0]='\0';
	d_exm_bill_num.arr[0]='\0';
	//d_exm_bill_out_amt.arr[0]='\0';
	d_exm_episode_type.arr[0]='\0';	
	d_exm_episode_id.arr[0]='\0';			
	d_exm_visit_id.arr[0]='\0';

	d_exm_bill_code.len	=0;
	d_exm_bill_num.len	=0;
	//d_exm_bill_out_amt.len	=0;
	d_exm_episode_type.len	=0;		
	d_exm_episode_id.len	=0;			
	d_exm_visit_id.len	=0;
	
	
	EXEC SQL FETCH Exemption_bills_cursor1 INTO 
					d_exm_bill_code,
					d_exm_bill_num,
					d_exm_bill_out_amt,
					d_exm_episode_type,		
					d_exm_episode_id,			
					d_exm_visit_id;


	  if(NODATAFOUND)
		{
		   return 0;
		}

	if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN Exemption_bills_cursor1",0,"");
		proc_exit();
	}


	d_exm_bill_code.arr[d_exm_bill_code.len] ='\0';
	d_exm_bill_num.arr[d_exm_bill_num.len] ='\0';
	//d_exm_bill_out_amt.arr[d_exm_bill_out_amt.len] ='\0';
	d_exm_episode_type.arr[d_exm_episode_type.len] ='\0';		
	d_exm_episode_id.arr[d_exm_episode_id.len] ='\0';			
	d_exm_visit_id.arr[d_exm_visit_id.len] ='\0';

	return 1;
}

close_exm_footer()
{
		
		EXEC SQL CLOSE Exemption_bills_cursor1;

		if (OERROR) 
		{
		disp_message (ERR_MESG,"Close bills_receipt_cursor failed");
		proc_exit();
		}

}


print_route_exits()
{

l_exits_print_route=0;

	if(strcmp(nd_reportid.arr,"BLR0014C")==0)	
	{
		EXEC SQL select count(*) into l_exits_print_route
				 from SM_PRINT_ROUTING
				 where module_id='BL'
				 and report_id='BLR0014C';
	} 

	if(strcmp(nd_reportid.arr,"BLR0014E")==0)	
	{
		EXEC SQL select count(*) into l_exits_print_route
				 from SM_PRINT_ROUTING
				 where module_id='BL'
				 and report_id='BLR0014E';
	}
}

