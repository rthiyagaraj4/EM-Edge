/************************************************************************/
/************************************************************************/
/* PROGRAM NAME          :	BLRVSBL1.PC									*/
/* AUTHOR                :	K.SARAVANAN									*/
/* DATE WRITTEN          :	14-AUG-2003									*/
/* DATE MODIFIED         :												*/
/* CALLED FROM           :												*/
/*                                                                      */
/* FUNCTION              :	TO PRINT CASH BILL CUM RECEIPT,				*/
/*				PRINT_VISIT_BILL, PRINT_VISIT_BILL_NO_DISC,				*/
/*				PRINT VISIT BILL - NO SETTLEMENT DTLS,					*/
/*																		*/
/* REPORTS				 : PRINT BILL-CUM RECEIPT,PRINT BILL			*/
/*						   PRINT PACKAGE BILL,PRINT DISCOUNT DOCUMENT	*/ 
/************************************************************************/
/* UPGRADED TO 4.1 */
  
#include <stdio.h>     
#include <string.h> 
#include <process.h>      
#include <bl.h>  

#define OERROR (sqlca.sqlcode < 0)

#define NODATAFOUND sqlca.sqlcode == 1403
#define RESOURCE_BUSY (sqlca.sqlcode == -54)

#define INIT_MESG "Bill Printing in progress"
#define ONLINE_PRINTING 1
#define DEBUG  1
#define maxlines 11
#define LEGEND 1
#define LENGTH_WORDS 80 
#define ERR_MESG  4
#define ESC     0x1B

EXEC SQL BEGIN DECLARE SECTION;
		
VARCHAR nd_fm_doc_type		[31],
		trx_type 			[2],
		uid_pwd      		[132],		
		nd_episode_id 		[9],
		nd_visit_id 		[5],
		nd_fm_doc_num		[31],
		nd_to_doc_type		[31],  
		nd_to_doc_num		[31],
		nd_fm_doc_date		[12],
		nd_fm_doc_date1		[12],
		d_cashfacility_id	[3],
		nd_to_doc_date		[31],
		nd_facility_name	[500],
		nd_acc_name			[31],
		nd_facility			[31],
		p_cash_counter		[7],
		p_document_id		[31],
		p_shift				[2],
		nd_pgm_date			[13],
		nd_session_id		[16],
		nd_mpd_id			[40],
		nd_ws_no			[40],
		l_printer_ids		[1000],
		l_printer_names		[1000],
		l_printer_types		[1000],
	    l_queue_names		[1000],
	    l_no_of_copies		[1000],
	    l_errortext			[1000],
		l_logo_yniflaser	[1000],
		LOGO_DIR			[1000],
	    l_logo_name			[1000],
		l_errorlevel		[10],
		l_sysmessageid		[10],		
		currency			[16],
		sub_cur  			[10],
		nn_cc_code			[3],
		nd_curr_date		[20],
		nd_curr_date_t		[20],
		nd_curr_date1_t		[20],
		nd_curr_date1		[12],
		nn_shift_id			[2],
		nn_cc_id			[31],
		nn_cc_name			[16],
		nd_user				[41],
		nd_calling_pgm_id	[10],
		l_nd_calling_pgm_id	[10],
		nd_logo_pgm_id		[1000],
		bill_title			[40],
		nd_printed			[2],
		nd_bill_format_id	[2],
		d_folio_batch_id   [100],
		d1_folio_batch_id   [100],
		d_serv_code			[20],
		language_id			[3];

VARCHAR		
		d_trx_doc_ref			[61],
		d_trx_doc_ref_line_num	[9],
		d_trx_doc_ref_seq_num	[5],
		d_cust_code				[25],
		nd_cust_code			[25],
		d_blng_serv_code		[31],
		nd_blng_serv_code		[31],
		d_mapping_code_ind		[3],
		d_mapping_code			[12],
		d_serv_anal_grp	    	[31],
		nd_serv_anal_grp		[31],
		d_serv_item_code		[61],
		d_serv_item_desc		[61],
		d_payer_serv_grp_hdr	[7],
		d_payer_serv_grp_line	[7],
		d_prt_grp_hdr_code		[7],
		d_prt_grp_line_code		[7],
		d_bill_doc_type_code	[18],
		d_bill_doc_num			[9],
		nd_bill_doc_type_code	[18],		 //crf-659
		nd_bill_doc_num			[9],		 //crf-659
		nd_bill_doc_type_code1	[18],		 //crf-659
		nd_bill_doc_num1		[9],		 //crf-659
		nd_bill_doc_type_code2	[18],		 //crf-659
		nd_bill_doc_num2		[9],		 //crf-659
		d_ent_item_grp_code		[13],
		d_payer_item_grp_code	[7],
		d_print_seq				[5],
		d_summary_dtl_ind		[3],
		d_package_trx_yn		[2],
		nd_package_trx_yn		[2],
		nd_summary_dtl_ind		[3],
		d_episode_type			[2],
		d_episode_id			[9],
		nd_episode				[9],
		d_visit_id				[5],	
		d_patient_id			[61],
		d_date_of_birth			[31],
		d_gender				[2],
		d_gender_desc			[100],
		d_encounter_id			[13],
		d_cust_code1			[25],
		d1_doc_type				[25],
	    d1_doc_number			[50],
		d1_doc_date				[20],
		d1_doc_date1			[20],
		d1_doc_type_num			[100],
		nd_mpi_id				[40],
		d_int_bill_prv_doc_type_code[25],
		d_int_bill_prv_doc_number[50],

		nd_cust_code1			[25],
		nd_cust_cd1				[25],
		nd_prt_grp_hdr_code		[7],
		nd_prt_grp_line_code	[7],
		nd_ref_prt_grp_hdr_code [7],
		nd_ref_prt_grp_line_code [7],
		nd_prt_hd_desc			 [46],
		d_prev_grp_desc			 [100],	
		nd_prt_line_desc		 [46],
		nd_blng_desc			 [81],
		d_Policy_type_code		 [21],
		l_Policy_type_desc		 [300],
		alt_id_type				 [5],
		alt_id_no			     [30],
		patient_name			 [100],
		l_alt_id_type_desc		 [300],
		nd_blng_desc1			 [61],
		nd_mapping_code_desc	 [46],
		nd1_mapping_code_desc	 [46],
		d_customer			     [46],
		d_customer1			     [46],
		d_customer2			     [46],
		d_customer3			     [46],
		nd_cust_nm				 [46],
		cur_str					[8],
		sub_cur_str				[8],
		d_bank_name				[60],
		d_bank_code				[25],

		leg_cust				 [70];

		VARCHAR l_mpi_id[50];
		VARCHAR l_blng_grp[5];
		VARCHAR l_pakage_yn[2];

VARCHAR	  d_trade_name	[100],
		  d_batch_name  [100],
		  d_exp_dt		[20],
		  d_loc_code	[100];

VARCHAR	
		p_err_level				[10],
		p_sys_message_id		[10],
		p_error_text			[200],
		ar_cust					[46];
	 
VARCHAR	
		d1_trx_doc_ref			[61],
		d1_trx_doc_ref_line_num	[9],
		d1_trx_doc_ref_seq_num	[5],
		d_copy_cust_code		[10],
		d1_cust_code			[25],
		nd1_cust_code			[25],
		nd1_doc_type			[20],
		nd1_doc_num				[20],
		d1_blng_serv_code		[31],
		d1_mapping_code_ind		[3],
		d1_mapping_code			[12],
		nd1_blng_serv_code		[31],
		nd2_blng_serv_code		[31],
		d1_serv_anal_grp		[31],
		nd1_serv_anal_grp		[31],
		nd2_serv_anal_grp		[31],
		d1_serv_item_code		[61],
		d1_serv_item_desc		[61],
		d1_payer_serv_grp_hdr	[7],
		d1_payer_serv_grp_line	[7],
		d1_prt_grp_hdr_code		[7],
		d1_prt_grp_line_code	[7],
		d1_bill_doc_type_code	[18],
		d1_bill_doc_num			[9],
		d1_ent_item_grp_code	[13],
		d1_payer_item_grp_code	[7],
		d1_print_seq			[5],
		d1_summary_dtl_ind		[3],
		d1_package_trx_yn		[2],
		nd1_package_trx_yn		[2],
		nd1_summary_dtl_ind		[3],
		nd2_summary_dtl_ind		[3],
		d1_episode_type			[2],
		d1_episode_id			[9],
		d1_visit_id				[5],	
		d1_patient_id			[61],
		d1_encounter_id			[13],
		d1_cust_code1			[25],
		nd1_cust_code1			[25],
		dp_cust_code			[25],
		nd1_prt_grp_hdr_code	[7],
		nd1_prt_grp_line_code	[7],
		nd1_payer_serv_grp_hdr	[30],
		nd_payer_serv_grp_hdr	[30],
		nd1_payer_serv_grp_line	[30],
		nd_payer_serv_grp_line	[30],
        d_adm_rec_flag			[2],
		d_acct_seq_no			[4],
		nd1_trx_doc_ref			[61],
		nd1_trx_doc_ref_line_num[61],
		nd_trx_doc_ref			[61],
		l_only_print_discount   [2], //added by vani
		nd_trx_doc_ref_line_num[61];


VARCHAR p_gross_net_amt_ind				[4],              
		p_serv_disc_on_gross_ind		[4],        
		p_all_oth_adj_amt_row_ind		[4],     
		p_bill_disc_sep_row_yn			[4],     
		p_bill_adj_sep_row_yn			[4],     
		p_bill_exm_sep_row_yn			[4],     
		p_bill_wo_sep_row_yn			[4],     
		p_oth_payers_amt_print_row_ind  [4], 
		p_patient_amt_print_row_ind		[4],   
		p_bill_net_payable_ind			[4], 
		p_addl_charge_amt_ind			[4],
		p_excl_addl_charge_yn			[4],
		p_servdate_in_dtlformat_yn		[2],
		p_disc_amt_in_dtl_yn			[2],  
		c_gross_net_amt_ind				[4],   
		c_serv_disc_on_gross_ind		[4], 
		c_reim_amt_ind					[4],
		c_non_reim_amt_ind				[4],  
		c_all_oth_adj_amt_ind			[4],   
		c_bill_disc_sep_row_yn			[4],   
		c_bill_adj_sep_row_yn			[4],   
		c_bill_exm_sep_row_yn			[4],   
		c_bill_wo_sep_row_yn			[4],   
		c_oth_payers_amt_print_row_ind	[4],  
		c_bill_subsidized_amt_ind		[4],  
		c_bill_net_payable_ind			[4],  
		c_addl_charge_amt_ind			[4],
		c_excl_addl_charge_yn			[4],
		c_servdate_in_dtlformat_yn		[2],
		c_disc_amt_in_dtl_yn			[2],
		status							[4],
		c_print_serv_date_with_time_yn  [2],
		c_print_zero_other_adj_yn		[2],	
		c_print_zero_disc_column_yn		[2],	
		c_qty_in_dtlformat_yn			[2],
		c_rate_in_dtlformat_yn			[2],		
		p_print_serv_date_with_time_yn	[2],
		p_print_zero_other_adj_yn		[2],	
		p_print_zero_disc_column_yn		[2],
		p_qty_in_dtlformat_yn			[2],	
		p_rate_in_dtlformat_yn			[2],
		p_print_zero_adcharg_column_yn	[2],
		p_bill_addl_id_in_ftr_yn		[2],
		p_serv_desc_sep_line_yn			[2],
		c_serv_desc_sep_line_yn			[2],
		c_print_zero_adcharg_column_yn  [2],
		c_print_zero_subsid_column_yn	[2];

varchar		original_text					[101],   //for crf-659
			copy_text						[101],
			bill_title_line1				[101],	
			bill_title_line2				[101],
			bill_title_line3				[101],
			bill_title_line4				[101],	
		    op_cash_bill_title_w_rcpt		[101],
			op_cash_bill_title_w_rfnd		[101],	
			op_cash_bill_title_wo_rcpt		[101],	
			op_credit_bill_title			[101],	
			ip_cash_bill_title_w_rcpt		[101],
			ip_cash_bill_title_w_rfnd		[101],	
			ip_cash_bill_title_wo_rcpt		[101],	
			ip_credit_bill_title			[101],		
			cash_bill_title_addl_line		[101],	
			cash_bill_title_w_rcpt			[101],
			credit_bill_title_addl_line		[101],
			 bl_header_line_01					[101],
			 bl_header_line_02					[101],
			 bl_header_line_03					[101],
			 bl_header_line_04					[101],
			 bl_header_line_05					[101],
			 bl_header_line_06					[101],
			 bl_header_line_07					[101],
			 bl_header_line_08					[101],
			 bl_header_line_09					[101],
			 bl_header_line_10					[101],
			 bl_header_line_11					[101],
			 bl_header_line_12					[101],
			 bl_header_line_13					[101],
			 bl_header_line_14					[101],
			 bl_footer_line_01					[101],
			 bl_footer_line_02					[101],
			 bl_footer_line_03					[101],
			 bl_footer_line_04					[101],
			 bill_credit_footer_line1			[101],	
			 bill_credit_footer_line2			[101],
			 bill_credit_footer_line3			[101],
			 bill_credit_footer_line4			[101],
			 bill_ins_footer_line1				[101],
			 bill_ins_footer_line2				[101],
			 bill_ins_footer_line3				[101],
			 bill_ins_footer_line4				[101],
			 column_var							[101],
			 cr_addl_id_in_ftr_yn				[2],
			 print_ins_addl_id_in_ftr_yn		[2],
			 ip_cr_addl_id_in_ftr_yn			[2],
			 ip_ins_addl_id_in_ftr_yn			[2],
			nd_column_val					[1000],
			str_var1						[101],
			str_var2						[101],
			line_var						[101],
			dup_var							[101],
			lc_str_val						[101],
			lc_str_var						[101],
			tab_name						[31],
			ls_str_var						[101],
			lc_var							[3],
			ls_char_var						[3],
			ls_str							[101],
			ls_var							[101],
			d_doc_type_code1				[30],
			d_doc_number1					[30],
			nd_patient_id					[25],
			nd_REGION_CODE					[100],
			nd_RES_AREA_CODE				[100],
			nd_RES_TOWN_CODE				[100],
			nd_slmt_mode_yn					[2],
			d_cash_slmt_flag				[10],
			nd_counter_bldg					[10],
			loc_legend106					[500],
			d_receipt_refund_ind			[2],
			d_rcpt_rfnd_id_no				[20],
			d_slmnt_doc_ref					[50],
			d_cash_counter					[5],
			str_has_to_print				[8000],
			nd_adm_doctor					[50],
			nd_adm_doctor1					[50],
			nd_canceled_date				[20],
			lc_splch_var					[101];
			



	int	ln_age_year,d_rcpt_cnt;   
	
	char d_grp_code	[10],d_line_code [10];           
	

	char	sql_stmt             [5000]; 			
 varchar    sql_stmt1            [1000],
			sql_stmt2            [1000];

int date_yn = 0,line_ctr = 0;
int splch_pos,st_pos,spchar_type,bold_st = 0,font_st = 0,uline_st=1;
int spchar_pos = 0,spchar_pos1,ctr;
int i,bl_doc_srl_no,pos_var,pos_var1,pos_var2,print_upto,pos_length,var_length;
int l_pos,lv_var,j,len_lc_str_val,prt_len,print_upto_c,ld_var,char_pos;
int ld_pos,ld_length,len=0;


int    lctr = 0,pctr = 1,nvalid = 0,ncancel = 0;
int    first = 1,l_grp_pkg_inside_cnt,l_pat_inside_pkg_disc,l_pay_inside_pkg_disc;

int		d_trade_posi ,
		d_batch_posi,
		d_exp_dt_posi,
		d_loc_posi,
		d_qty_posi,
		d_qty;

double  d_bill_amt				=0,
		nd_rcpt_amt				=0,
		d_settled_amt			=0;
		
double  d_pay_amt				=0;

double  p_gross_amt		=0,
	    p_disc_amt		=0,
		p_net_amt		=0,
		nd_oth_payer_amt=0,
		nd_tot_oth_payer_amt=0,
		nd_tot_disc_amount=0,
		nd_tot_net_reimbursable_amt=0,
		nd_gnd_tot_net_reimbursable_amt=0;

double	nd_pat_net_charge_amt	=0,
		p_pat_gross_amt			=0,
		p_pat_disc_amt			=0,
		p_pat_net_amt			=0,
		d1_upd_net_charge_amt	=0,
		d1_upd_gross_charge_amt	=0,
		d1_upd_disc_amt			=0,
		nd_tot_pat_net_charge_amt=0,
		nd_rounded_amt			=0,
		nd_net_pay_amt_after_rounded=0,
		p_tot_pat_gross_amt		=0,
		p_tot_pat_net_amt		=0,
		nd_subdiv_amt			=0,
		nd_tot_subdiv_amt		=0,
		nd_pat_gross_amt		=0,
		nd_pat_net_amt1			=0,
		nd_pat_disc_amt			=0,
		nd_pat_gross_amt1		=0,
		nd_pat_gross_amt2		=0,
		nd_pat_net_amt2			=0,
		nd_pat_disc_amt1		=0,
		nd_pat_addl_charge_amt	=0,
		nd_pat_tot_addl_charge_amt=0,
		amount=0;

long    d_cust_code2;

char    v_c_billed_serv;

double	d_upd_gross_charge_amt=0,
		d_upd_disc_amt=0,
		d_upd_net_charge_amt=0,
		d_bill_tot_exmpt_amt=0,
		nd_upd_gross_charge_amt=0,
		nd_upd_net_charge_amt=0,
		nd_total_addl_charge_by_service=0,
		tot_upd_gross_charge_amt=0,
		tot_upd_net_charge_amt=0,
		pat_upd_gross_charge_amt=0,
		pat_upd_net_charge_amt=0,
		oth_p_upd_gross_charge_amt=0,
		oth_p_upd_net_charge_amt=0,
		tot_upd_disc_amt=0,
		nd_upd_disc_amt=0,
		oth_p_upd_disc_amt=0,
		pat_upd_disc_amt=0,
		nd_net_payable=0,
		d_net_reimbursable_amt=0,
		d_addl_charge_amt_in_charge=0,
		d_package_seq_no=0,
		d_rate=0,
		d_charge_discount=0,
        d_bill_discount=0,
        d_fund_adjustment=0,
        d_tot_disc=0,
		d1_charge_discount=0,
		d1_bill_discount=0,
		d1_fund_adjustment=0,
		d1_tot_disc=0,
		d1_addl_charge_amt_in_charge=0,
		d1_package_seq_no=0,
     	d1_rate=0,
		nd_tot_rate=0,
		nd1_tot_rate=0,
		nd_grd_tot_rate=0,
		nd1_grd_tot_rate=0,
		nd_total_addl_charge=0,
		nd_gnd_tot_net_non_reimbursable_amt=0,
		nd_net_non_reimbursable_amt=0,
		nd_tot_non_reimbursable_amt=0,
		nd_tot_pat_disc_amt		=0,
		nd_pat_net_amt=0,
		nd_serv_charge_discount=0,
		nd_serv_bill_discount=0,
		nd_serv_fund_adjustment=0,
		nd_serv_tot_disc=0,
		nd1_serv_charge_discount=0,
		nd1_serv_bill_discount=0,
		nd1_serv_fund_adjustment=0,
		nd1_serv_tot_disc=0,
		nd_tot_serv_charge_discount=0,
		nd_tot_serv_bill_discount=0,
		nd_tot_serv_fund_adjustment=0,
		nd_tot_serv_tot_disc=0,
		nd1_tot_serv_charge_discount=0,
		nd1_tot_serv_bill_discount=0,
		nd1_tot_serv_fund_adjustment=0,
		nd1_tot_serv_tot_disc=0,
/** added by raghava on 20/06/2009 ***/
		nd_inside_pkg_gross_amt=0,
		nd_inside_pkg_net_amt=0,
		nd_inside_pkg_amtpayable_amt=0,
		nd_inside_pkg_disc_amt=0,
		nd_inside_pkg_addchrg_amt=0;


int     d_serv_qty=0,
        d1_serv_qty=0,
		nd_tot_serv_qty=0,
		nd1_tot_serv_qty=0,
		nd_grd_tot_serv_qty=0,
		l_discount_count=0,
		l_addlcharge_count=0,
		l_subsidized_amt =0,
		l_gross_disc_amt=0,
		l_aviled_outside_pkg=0,
		l_pat_net_amt=0,
		nd1_grd_tot_serv_qty=0;

		
 
double 	nd_net_total=0,
		nd_gross_total=0,
		nd_disc_total=0,nd_othp_payer_amt=0,
		nd_tot_othp_payer_amt=0,
		p_tot_pat_disc_amt=0;


int     ccnt=0,
		ccnt1=0,
		rcnt=0,
		oth_cnt=0,
		k=1,i=0,p=1,
		othp_cnt=0,
		lcol_cnt=0,
		l_no_of_clumns=0;

VARCHAR		dc_doc_type_code		[18],
			d_no					[17],
			d_doc_date				[11],
			dc_episode_id			[9],
			dc_epi_id				[9],
			dc_visit_id				[5],
			dc_admn_date			[17],
			dc_physician_id			[16],
			dc_blng_grp_id			[5],
			d_added_by_id			[100],
			dc_patient_id			[21],
			d_org_dept				[100],
			dc_cust_code			[9],
			dc_bill_type_code		[3],
			dc_clinic_code			[5],
			dc_bill_print_flag		[2], 
			dc_credit_doc_ref_desc  [51],
			dc_short_name			[81],
			dc_short_name1			[81],
			dc_short_name2			[81],
			dc_short_name3			[81],
			dc_short_name_loc_lang  [81], 
			dc_date_of_birth		[11],
			dc_sex					[10],
			dc_full_name			[61],
			dc_long_name			[61],
			dc_long_desc			[105],
			dc_blng_grp_desc		[105],
			dc_short_desc			[51],
			dc_ind					[10],
			dc_mpi_id				[100],
			dc_credit_doc_ref_date  [11],
			dc_policy_type_code     [21] ,  
			dc_policy_number        [31],
			dc_policy_expiry_date   [11],
			d1_doc_type_code		[7],
			//d1_prt_grp_hdr_code   [3],
			//d1_prt_grp_line_code  [3],
			d1_long_desc 			[105],
			d1_long_desc1			[105],
			d1_mpi_id				[47],
			d2_doc_type_code		[7],
			d2_doc_date				[11],
			d2_mpi_ind				[2],
			d2_mpi_id				[47],
			d2_short_name			[16],
			d3_doc_type_code		[7],
			d3_patient_id			[21],
			d3_episode_id			[9],
			d4_doc_type_code		[7],
			d4_patient_id			[21],
			d4_episode_id			[9],

			d_bill_trx_type_code	[41],
			d_bill_nature_code		[2],
			d_nationality_num		[21],
			d_doc_num				[9],
			d2_doc_num				[9],
			d3_doc_num				[20],
			d4_doc_num				[20],
			dc_tot_dep_paid_amt		[21],
			last_recpt_doc_type_code[7],
			last_recpt_doc_num		[9],
			slmt_short_desc			[41],
			slmt_doc_ref_desc		[41],
			slmt_doc_ref_date	    [11],
			slmt_remarks			[31],
			temp					[10],
			d_service_code			[11],
			d_service_date			[20],
			d_service_date1			[20],
			nd_service_date			[20],
			nd_service_date1		[20],
			d_service_desc			[41],
			d_dis_date				[17],
			l_dflt_bill_print_in_summ_yn[5],
			nd_cust					[25],

			l_line1[50],
			l_line2[50],
			l_line3[50],
			l_line4[50],
			l_line5[50],
			l_line6[50],
			l_line7[50],

			l_bill_contact_name[50],

			l_bill_contact_name_p[50],
			l_bill_contact_name_p1[50],
			l_bill_contact_name_p2[50],

			l_bill_contact_name_c[50],
			l_bill_contact_name_c1[50],
			l_bill_contact_name_c2[50],

			l_bill_contact_name_title[50],
			l_bill_contact_name_title_p[50],
			l_bill_contact_name_title_p1[50],
			l_bill_contact_name_title_p2[50],

			l_bill_contact_name_title_c[50],
			l_bill_contact_name_title_c1[50],
			l_bill_contact_name_title_c2[50],

			
			l_bill_long_desc[40],

			l_bill_long_desc_p[40],
			l_bill_long_desc_p1[40],
			l_bill_long_desc_p2[40],

			l_bill_long_desc_c[40],
			l_bill_long_desc_c1[40],
			l_bill_long_desc_c2[40],

			l_bill_add1_desc[40],

			l_bill_add1_desc_p[40],
			l_bill_add1_desc_p1[40],
			l_bill_add1_desc_p2[40],

			l_bill_add1_desc_c[40],
			l_bill_add1_desc_c1[40],
			l_bill_add1_desc_c2[40],

			l_bill_add2_desc[40],

			l_bill_add2_desc_p[40],
			l_bill_add2_desc_p1[40],
			l_bill_add2_desc_p2[40],

			l_bill_add2_desc_c[40],
			l_bill_add2_desc_c1[40],
			l_bill_add2_desc_c2[40],

			l_bill_add3_desc[40],

			l_bill_add3_desc_p[40],
			l_bill_add3_desc_p1[40],
			l_bill_add3_desc_p2[40],

			l_bill_add3_desc_c[40],
			l_bill_add3_desc_c1[40],
			l_bill_add3_desc_c2[40],

			l_bill_add3_desc_temp[40],
			l_episode_settlement_ind[4],
			l_episode_cust_code[10],
			l_nric_number[25],
			l_gl_holder_name[181],
			l_gl_holder_name1[181],
			l_gl_holder_name2[181],
			l_gl_ic[1000],
			l_pat_reln_with_gl_holder[90],
			l_pat_reln_with_gl_holder1[90],
			l_pat_reln_with_gl_holder2[90],
			l_detail_report_flag[3],
			l_print_without_disc_func[4],
			l_no_settlement_details[5],
			l_credit_doc_ref_desc[90],
			l_credit_doc_ref_desc1[90],
			l_credit_doc_ref_desc2[90],
			l_coverage_title[500],
			nd_acc_entity_code[5],
			nd_facility_id[3];

VARCHAR	nd_blng_grp			[31],
		nd_nationality		[16],
		nd_cash_counter		[16],
		nd_base_rate_qty	[20];	

VARCHAR	d_bill_type_desc[31],
		d_remarks_1[61],
		d_remarks_2[61],
		d_remarks_3[61],
		d_remarks_4[61],
		d_remarks_5[61],
		d_remarks_6[61],
		d_remarks_7[61],
		ar[10];


		
VARCHAR	nd_file_name [50],
		nd_temp_file_name [50],
		nd_hosp_name[1000],
		nd_add		[1000],
		nd_add_ln	[1000],
		nd_add_ln1	[1000],
		nd_add_ln2	[1000],
		nd_add_ln3	[1000],
	    nd_tel_fax	[1000],
		nd_telfax	[1000],
		nd_lang_id	[4],
		nd_hosp_add	[2000],
		loc_legend1	[201],
		loc_legend2	[201],
		loc_legend3	[201],
		loc_legend4	[201],
		loc_legend5	[201],
		loc_legend6	[201],
		loc_legend7	[201],
		loc_legend8	[201],
		loc_legend9	[201],
		loc_legend10[201],
		loc_legend11[201],
		loc_legend12[201],
		loc_legend13[201],
		loc_legend14[201],
		loc_legend15[201],
		loc_legend16[201],
		loc_legend17[201],
		loc_legend18[201],
		loc_legend19[201],
		loc_legend20[201],
		loc_legend21[201],
		loc_legend22[201],
		loc_legend23[201],
		loc_legend24[201],
		loc_legend25[201],
		loc_legend26[201],
		loc_legend27[201],
		loc_legend28[201],
		loc_legend29[201],
		loc_legend30[201],
		loc_legend31[201],
		loc_legend32[201],
		loc_legend33[201],
		loc_legend34[201],
		loc_legend35[201],
		loc_legend36[201],
		loc_legend37[201],
		loc_legend38[201],
					/*----22/09/2005----*/
		loc_legend39[201],
		loc_legend40[201],
		loc_legend41[201],
		loc_legend42[201],
		loc_legend43[201],
		loc_legend44[201],
		loc_legend45[201],
		loc_legend46[201],
		loc_legend47[201],
		loc_legend48[201],
		loc_legend49[201],
		loc_legend50[201],
		loc_legend51[201],
		loc_legend52[201],
		loc_legend53[201],
		loc_legend54[201],
		loc_legend55[201],
		loc_legend56[201],
		loc_legend57[201],
		loc_legend58[201],
		loc_legend59[201],
		loc_legend60[201],
		loc_legend61[201],
		loc_legend62[201],
		loc_legend63[201],
		loc_legend68[201],
		loc_legend69[201],
		loc_legend70[201],
		loc_legend71[201],
		loc_legend72[201],
		loc_legend73[201],
		loc_legend74[201],
		loc_legend75[201],
		loc_legend76[201],
		loc_legend77[201],
		loc_legend78[201],
		loc_legend79[201],
		loc_legend80[201],
		loc_legend81[201],
		loc_legend82[201],
		loc_legend83[201],
		loc_legend84[201],
		loc_legend85[201],
		l_translated_value	[201],
		l_pk_value			[100];		
		
	   /*------Up To here------*/
	  
      /*-------Added 06/07/2007-------*/

VARCHAR nd_temp_date		[20],
		nd_loc_date			[20],
		nd_temp_date1		[12],
		nd_loc_date1		[12],
		date_convert		[20],
		nd_doc_type			[50],
		nd_doc_num			[50],
		print_disc_flag		[2],
		nd_cashier_name		[500],
		nd_cahier_position  [500];

/****** Added The following variables on 29/09/2009 for Package CRF-203 ******/

VARCHAR p_pkg_amt_str	    [200],
		p_pkg_dep_amt_str	[500],
		p_pkg_dep_str	    [200],
		p_pkg_seq_num_str   [200],
		temp_pkg_amt_str	[200],
		temp_pkg_dep_str	[200],
		temp_pkg_seq_num_str[200],
		nd_package_code		[10],
		nd_package_desc		[100],
		l_pkg_seq_num		[50],
		p_no_of_pkgs		[50],
		nd_round_flag		[2];

/******** Added on 1/5/2009 for Medicity ********/
VARCHAR	d_rcpt_doc_type_code[10],
		d_rcpt_doc_num[12],
		d_rcpt_doc_srno[3],
		d_settlement_type_code[7],
		d_settlement_desc	  [46],
		d_slmt_doc_ref_date   [20],
		d_rcpt_doc_type_num   [500];



VARCHAR	amt_in_words	  [2000],
		amt_in_words_Sep  [2000],
		amt_in_words_Sep1 [2000];

VARCHAR d_attend_practitioner_id[20],
        d_admit_practitioner_id[20],
		nd_pract_id[20],
		pract_name[500],
        pract_name_1[500],
		d_location[500],
		d_locn_code[15];

VARCHAR l_bill_num  [100],
		l_bill_num_temp [100],
	    l_pat_bill_num[100],
		l_cust_code [10];

// Added by raghava for CRF-521

VARCHAR  l_detail_desc	[500];
int      len_desc=0,r_ctrdesc=0,l_ctr=1;
char     cl_string_desc[500];
//   for CRF-521

int     no_of_lines1;

double  d_rcpt_amt=0;



/******** UP TO Here ********/

char    p_pkg_seq_num       [1500][201],
		p_pkg_amt			[1500][201],
		p_pkg_dep_amt		[1500][201];
	

int     l_pkg_len,l_lcnt=0,p_cnt=0;
double  l_pkg_amt=0,
		l_pkg_dep_amt=0,l_pkg_dep_exist=0;

   
/****** on 29/09/2009 for Package CRF-203 ******/

					
char nd_reprint_yn, discount_print_yn, sett_print_yn, l_include_refund;
char print_y, rec_out, grp_out, sec_box_out;
		
char    filename[300],l_filename[300][300];
char	l_mesg[300];
char	a_filename[300];
char    str_var ='\0';
char    d_summary_yn,nd_episode_type, nd_lang_ind, nd_online_print_yn,l_print_option;

long    d_age, max_lines = 11;

int     l_lno = 0;

int     l_bill_print_opt_for_disc_print,
		cnt				= 0;
int	    l_page_no	= 0,l_fst_bill= 0,
		l_dmp			= 0, 
		l_lsr			= 0,
		l_margin_len	= 30,
		l_bill_page_no  = 0,
		l_bill_page_no_frmt2  = 0,
		l_main_hdr		= 1;
int     l_billpage_no	= 0,l_disc_page_no= 0; //27/06/2009 bangkok

int r_ctr = 0,l_len=0;
		
double		d_serv_disc_amt			= 0,
			d1_man_disc_amt			= 0,
			d1_overall_disc_amt		= 0,
			d_bill_tot_outst_amt	= 0,
			d1_tot_adjust_amt		= 0,
			nd1_tot_adjust_amt		= 0,
			d1_bill_tot_exmpt_amt	= 0,
			d1_tot_write_off_amt	= 0,
			d1_bill_amt			    = 0,
			d_overall_disc_amt		= 0,
			d_prepay_adj_amt		= 0,
			d_deposit_adj_amt		= 0,
			d_bill_paid_amt			= 0,
			d_pmnt_diff_adj_amt		= 0,
			l_rounding_amt			= 0,
			tot_amt					= 0,
			d_gross_amt				= 0,
			d_tot_bus_man_disc_amt	= 0,
			d_deposit_amt			= 0,
			d_tot_paid_amt			= 0,
			d1_gross_amt			= 0,
			grp_gross_amt			= 0,
			l_disc_grp_gross_amt,
			l_disc_grp_disc_amt,
			less_disc				= 0,
			vst_amt					= 0,
			p_vst_ded				= 0,
			nd_bill_amt				= 0,
			d2_bill_tot_amt			= 0,
			vd_sub_total_amt		= 0,
			net_total				= 0,
			d_deposit_doc_num		= 0,
			dcp_outst_amt			= 0,
			out_adj_amt				= 0,
			balance_due				= 0,
			bill_outst_amt			= 0,
			d4_doc_amt				= 0,
			d3_doc_amt				= 0,
			d1_net_amt				= 0,
			bill_paid_amt			= 0,
			d_service_amt			= 0,
			d_service_net			= 0,
			d_service_disc			= 0,
			nd_tot_spl_agency_amt	= 0,
			nd_spl_agency_amt		= 0,
			d_service_amt_tot		= 0,
			deposit_tot				= 0,
			bi_tot					= 0,
			amt_payable				= 0,
			l_bill_line_pr_gp_disc_amt	= 0,
			l_bill_rounding_amt			= 0,
			l_bill_tot_adjust_amt		= 0,
			l_bill_tot_exempt_amt		= 0,
			l_bill_tot_write_off_amt	= 0,
			less_billed_amt;

char	l_bill_tot_adjust_amt_str[100];
char	l_bill_tot_exempt_amt_str[100];
char	l_bill_tot_write_off_amt_str[100];
char	l_less_amt_str[1000],l_less_ins_amt_str[1000],l_less_ins_amt_dtl[1000]; 

char   ar_cust_amt[45][30];	
char   ar_amt[30][30];	 
char   loc_legend[1500][201];
char   bill_code[20][20]; //FOR CRF-659

char st_var[50]; 

char p_command_buf[500];

int			lv_Spawn_ret;

int				hl		 = 196,
				vl		 = 179,
				tlc		 = 218,
				trc		 = 191,
				blc		 = 192,
				brc		 = 217,
				vlti	 = 195,
				vrti	 = 180,
				htti	 = 194,
				hbti	 = 193,
				plus	 = 197;

	long 	ccount			= 0,
			glcheck			= 1,
			gcount			= 0,
			rcheck			= 0,
			last_line_check = 0,
			d_service_qty,
			d_base_rate,
			d_base_qty;

int mcount		= 0, 
	nd_decimal  = 0,
	l_tit_len	= 0,
	l_next_page,end_of_report,
    l_disc_cnt=0,
	l_billr_cnt=0,l_discr_cnt=0,
	flag=0,l_loop_cnt=1,z=0,l=0;

double nd_payable_amt;
EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE SQLCA.H;
EXEC SQL INCLUDE SQLDA.H;
#include <winproc.h>

char string_var[200], font_wide_on[200], font_wide_off[200], buf[200];

int v_lno = 0,  v_pno = 0,l_cnt;  

FILE *fp, *fp1;
CHAR nd_str[1000];

char put_string(ls_var,ld_pos,ld_length)
char ls_var[101];
int ld_pos,ld_length;
{
 ls_str_var.arr[0] = '\0';
 ls_str_var.len = 0;

 strcpy(ls_str_var.arr,ls_var);
 ls_str_var.len = strlen(ls_str_var.arr);

 EXEC SQL select substr(:ls_str_var,:ld_pos,:ld_length)
	         into :ls_str
			 from dual;

 ls_str.arr[ls_str.len] = '\0';

 if (OERROR)
        err_mesg("SELECT failed on table DUAL",0,"");

 return(ls_str.arr);
 
}



/* Main Part */

void proc_main(argc,argv)
char *argv[];
int argc;
{
	if (argc < 6)
	{    
		disp_message (ERR_MESG,"Usage : blrvsbl1 username/pwd@connect_string session_id pgm_date facility_id calling_pgm_id [filename]\n");
		proc_exit();
	}

	
	strcpy(uid_pwd.arr,argv[1]);
	uid_pwd.len = strlen(uid_pwd.arr);

	nd_session_id.len = 0;
	nd_session_id.arr[nd_session_id.len] = '\0';

	strcpy(nd_session_id.arr,argv[2]);
	nd_session_id.len = strlen(nd_session_id.arr);
	nd_session_id.arr[nd_session_id.len] = '\0'; 

	nd_pgm_date.len = 0;
	nd_pgm_date.arr[nd_pgm_date.len] = '\0';
	
	strcpy(nd_pgm_date.arr,argv[3]);
	nd_pgm_date.len = strlen(nd_pgm_date.arr);
	nd_pgm_date.arr[nd_pgm_date.len] = '\0';
	
	strcpy(nd_facility_id.arr,argv[4]);
	nd_facility_id.len = strlen(nd_facility_id.arr);
	nd_facility_id.arr[nd_facility_id.len] = '\0';

	strcpy(nd_calling_pgm_id.arr,argv[5]);		
	nd_calling_pgm_id.len = strlen(nd_calling_pgm_id.arr);	
	nd_calling_pgm_id.arr[nd_calling_pgm_id.len] = '\0';
	    

	//strcpy(nd_calling_pgm_id.arr,"BLRDISCN");
	if(argc > 6) 
	{
	 strcpy(nd_file_name.arr,argv[6]);
	 strcpy(nd_temp_file_name.arr,argv[6]);
	 strcpy(l_nd_calling_pgm_id.arr,nd_calling_pgm_id.arr);
	 l_nd_calling_pgm_id.len = strlen(l_nd_calling_pgm_id.arr);	
	 l_nd_calling_pgm_id.arr[l_nd_calling_pgm_id.len] = '\0';
	}
	else 
	{
	 strcpy(l_nd_calling_pgm_id.arr,nd_calling_pgm_id.arr);
	 l_nd_calling_pgm_id.len = strlen(l_nd_calling_pgm_id.arr);	
	 l_nd_calling_pgm_id.arr[l_nd_calling_pgm_id.len] = '\0';
	 strcpy(nd_file_name.arr,"blrcanbl.lis");
	 strcpy(nd_temp_file_name.arr,"blrcanbl.lis");

    }
	nd_file_name.len = strlen(nd_file_name.arr);
	nd_file_name.arr[nd_file_name.len] = '\0';

	
	nd_fm_doc_type.arr[0]    = '\0';
	nd_fm_doc_num.arr[0]     = '\0';
	nd_fm_doc_date.arr[0]    = '\0';
	nd_to_doc_type.arr[0]    = '\0';
	nd_to_doc_num.arr[0]     = '\0';
	nd_to_doc_date.arr[0]    = '\0';
	trx_type.arr[0]			 = '\0';

	nd_fm_doc_type.len       = 0;
	nd_fm_doc_num.len        = 0;
	nd_fm_doc_date.len       = 0;
	nd_to_doc_type.len       = 0;
	nd_to_doc_num.len        = 0;
	nd_to_doc_date.len       = 0;
	trx_type.len	   	     = 0;
	
	
   EXEC SQL CONNECT :uid_pwd;
  
	
  if(OERROR)
   {
	disp_message (ORA_MESG,"Error in connecting to Oracle\n");
	if (uid_pwd.len == 0)
	disp_message (ERR_MESG,"Null oracle uid/pwd\n\n\n");
	proc_exit();
   }
	
	
	set_meduser_role();
	
	strcpy(nd_lang_id.arr,l_language_id.arr);
    nd_lang_id.len = l_language_id.len;


	fetch_sy_prog_param();
	

	fetch_bill_format();


	get_print_routing();
	

	l_logo_yniflaser.arr[0] = 'N';

	get_left_margin();

	//prepare_file();

 
   nd_hosp_name.arr[0] = '\0';
   nd_hosp_name.len = 0;            

   nd_acc_entity_code.arr[0] = '\0';
   nd_acc_entity_code.len = 0;

   nd_add_ln1.arr[0] = '\0';
   nd_add_ln1.len = 0;
   
   nd_add_ln2.arr[0] = '\0';
   nd_add_ln2.len = 0;

   nd_add_ln3.arr[0] = '\0';
   nd_add_ln3.len = 0;

   nd_tel_fax.arr[0] = '\0';
   nd_tel_fax.len = 0;

   nd_hosp_add.arr[0] = '\0';
   nd_hosp_add.len    = 0;

   if (l_lsr != 0 && l_dmp == 0)
   {	
		if ( l_logo_yniflaser.arr[0] == 'Y')	
		{
		max_lines = 40; //58;  //25
		}
		else
		{
		max_lines = 56; //38; //56;  //25
		}

		l_print_option = 'L';
   }
   else
   {
		max_lines = 11;
   }  


   EXEC SQL select  acc_entity_code,
					lpad(' ',round((:l_margin_len-length(rtrim(substr(UPPER(ACC_ENTITY_NAME),1,50))))/2),' ')||UPPER(rtrim(substr(UPPER(ACC_ENTITY_NAME),1,50))),
					LN1_ADD,LN2_ADD,LN3_ADD,
					'Tel:'||TEL_NUM ||'  Fax:'||FAX_NUM,        
					LN1_ADD||','||LN2_ADD||','||LN3_ADD||','||'Tel:'||TEL_NUM
            into
					:nd_acc_entity_code ,
					:nd_hosp_name,
					:nd_add_ln1,:nd_add_ln2,:nd_add_ln3,
					:nd_tel_fax,
					:nd_hosp_add
	    from sy_acc_entity_lang_vw
	    where acc_entity_id = :nd_facility_id
		and	  language_id   = :nd_lang_id;
		

	if (OERROR)
	{ 
	disp_message (ERR_MESG,"Select failed in SY_ACC_ENTITY");
	proc_exit();
	}


	nd_acc_entity_code.arr[nd_acc_entity_code.len]  = '\0';
	nd_hosp_name.arr[nd_hosp_name.len]			    = '\0';
	nd_add_ln1.arr[nd_add_ln1.len]					= '\0';
	nd_add_ln2.arr[nd_add_ln2.len]					= '\0';
	nd_add_ln3.arr[nd_add_ln3.len]					= '\0';
	nd_tel_fax.arr[nd_tel_fax.len]					= '\0';
    nd_hosp_add.arr[nd_hosp_add.len]				= '\0';
	nd_add_ln.arr[0]								= '\0';
	nd_add_ln.len									= 0;
	
	if (nd_add_ln1.arr[0] != '\0')
	{
		strcpy(nd_add_ln.arr,nd_add_ln1.arr);
		nd_add_ln.len = strlen(nd_add_ln.arr);
	}

	if (nd_add_ln1.arr[0] == '\0' && nd_add_ln2.arr[0] != '\0')
	{
		strcpy(nd_add_ln.arr,nd_add_ln2.arr);
		nd_add_ln.len = strlen(nd_add_ln.arr);
	}
	else if (nd_add_ln1.arr[0] != '\0' && nd_add_ln2.arr[0] != '\0')
	{
		strcat(nd_add_ln.arr,", ");
		nd_add_ln.len = strlen(nd_add_ln.arr);

		strcat(nd_add_ln.arr,nd_add_ln2.arr);
		nd_add_ln.len = strlen(nd_add_ln.arr);
	}

	if (nd_add_ln1.arr[0] == '\0' && nd_add_ln2.arr[0] == '\0' && nd_add_ln3.arr[0] != '\0')
	{
		strcpy(nd_add_ln.arr,nd_add_ln2.arr);
		nd_add_ln.len = strlen(nd_add_ln.arr);
	}
	else if ((nd_add_ln1.arr[0] != '\0' || nd_add_ln2.arr[0] != '\0') && 
				nd_add_ln3.arr[0] != '\0')
	{
		strcat(nd_add_ln.arr,", ");
		nd_add_ln.len = strlen(nd_add_ln.arr);

		strcat(nd_add_ln.arr,nd_add_ln3.arr);
		nd_add_ln.len = strlen(nd_add_ln.arr);
	}

	if (l_lsr != 0 && l_dmp == 0)
	{
	    if ( l_logo_yniflaser.arr[0] == 'Y')	
	    l_tit_len = 0;
	    else
		l_tit_len = 32;
	}

 
	nd_add.arr[0] = '\0';
	nd_add.len = 0;

	EXEC SQL SELECT lpad(' ',round((:l_margin_len+:l_tit_len-length(rtrim(:nd_add_ln)))/2),' ')||UPPER(rtrim(:nd_add_ln))
	into :nd_add from dual;

	nd_add.arr[nd_add.len] = '\0';


	nd_telfax.arr[0] = '\0';
	nd_telfax.len = 0;
	

	EXEC SQL SELECT lpad(' ',round((:l_margin_len+:l_tit_len-length(rtrim(:nd_tel_fax)))/2),' ')||UPPER(rtrim(:nd_tel_fax))
	into :nd_telfax from dual;

	nd_telfax.arr[nd_telfax.len] = '\0';

//---Declare Cursors---


declare_master_cur(); 

open_master_cur();

nd_tot_spl_agency_amt = 0;

get_print_net_gross();

while(fetch_master_cur())
 {

 
  l_fst_bill++;

  /*if(d1_man_disc_amt!=0 || d1_overall_disc_amt!=0 || d_pmnt_diff_adj_amt!=0 ||d_serv_disc_amt!=0)
  { 
    if (strcmp(l_only_print_discount.arr,"Y")==0)
    l_loop_cnt=1;
    if (strcmp(l_only_print_discount.arr,"N")==0)
    l_loop_cnt=2;
  }  
  else*/
  l_loop_cnt=1;


  strcpy(nd_calling_pgm_id.arr,l_nd_calling_pgm_id.arr);

  for(z=1;z<=l_loop_cnt;z++) 
  {
 
	 /*if (strcmp(l_only_print_discount.arr,"Y")==0) //added by vani REGARDING IN11662
	 strcpy(nd_calling_pgm_id.arr,"BLRDISCN");
  

	 if (strcmp(l_only_print_discount.arr,"N")==0)  
	 {  

	   if(z==2) 
	   strcpy(nd_calling_pgm_id.arr,"BLRDISCN");
	 }
*/

	 prepare_file();
 	

	 //c_servdate_in_dtlformat_yn.arr[0]='Y';
	 //p_servdate_in_dtlformat_yn.arr[0]='Y';
		

		
		get_adm_rec_flag();
		get_cashier_name();
	    get_cashier_designation();
		init_all_variables();
		get_closed_packages();
		l_disc_cnt=l_disc_cnt+1;
		
	/*	 if (l_lsr != 0 && l_dmp == 0)  //vani commented blank page is printing because of this
		{			
			l_main_hdr = 1;	
			if ( l_logo_yniflaser.arr[0] != 'Y')
			 {
			   if(l_fst_bill>1)
			   {
				//27/06/2009 bangkok

				 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
				 {
				   if (l_disc_page_no > 0)
					 {
					 	l_disc_page_no = 0;
						fprintf(fp,"\n");
						fprintf(fp,"");
						fprintf(fp,"\n");
						
					 }
				 }
				 else
				 {
					 if (l_billpage_no > 0)
					 {
						l_billpage_no = 0;
						fprintf(fp,"\n");
						fprintf(fp,"");
						fprintf(fp,"\n");
						
					 }
				}
			   }
			   //upto here 27/06/2009 bangkok
			   else
			   {
			    //l_page_no = 0;     //27/06/2009 bangkok	
			    l_billpage_no = 0;   //27/06/2009 bangkok
				l_disc_page_no = 0;  //27/06/2009 bangkok
			   }	
			 }
		}
		else
		{
			if ( l_logo_yniflaser.arr[0] != 'Y')
			 {
			
				if(l_fst_bill>1)
				{
				 if (l_page_no > 0)
				 {
					l_page_no = 0;
					fprintf(fp,"\n");
					fprintf(fp,"");
					fprintf(fp,"\n");
					
				 }
				}
				else
				l_page_no = 0;
				
			 }
		}
          */
	
		/*nd_lang_id.arr[0] = '\0';
		 nd_lang_id.len = 0;
  
		EXEC SQL EXECUTE
		BEGIN
			blcommon.get_language_ind_id(
				:nd_facility_id,
				:d_patient_id,
				:nd_lang_ind,
				:nd_lang_id);
		END;
		END-EXEC;
 		nd_lang_id.arr[strlen(nd_lang_id.arr)] = '\0';*/

		//fetch_legend_value();
		
		
		fetch_legend_value1();

		declare_grp_hdr_cur();
		
		if (l_lsr != 0 && l_dmp == 0)
		{
				get_bill_address_lsr();

				if ( l_logo_yniflaser.arr[0] != 'Y')
				{
				fprintf(fp,"%c&a2L",ESC); 	/* To Set the Left margin */
				fprintf(fp,"%c(s14H",ESC); 	/* To set the font size	  */
				fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */	      
				}
		}
		else
		{
			//get_bill_address();
			get_bill_address_lsr();
			fprintf(fp,"%cg",ESC); 	       /* To Set compressed mode */
		}


			nd_tot_disc_amount=d1_man_disc_amt+d1_overall_disc_amt;
			open_grp_hdr_cur();

/***********************************************************/
/*if (strcmp(d_bill_nature_code.arr,"C")==0)
  {


		EXEC SQL select 'Y' into :v_c_billed_serv
  		   from bl_patient_charges_folio a
		   where cust_code is not null 
		       and 
			exists (select 'x' TRX_DOC_REF,TRX_DOC_REF_LINE_NUM
         from bl_patient_charges_folio b
         where b.TRX_DOC_REF = a.TRX_DOC_REF
		 and   b.operating_facility_id=a.operating_facility_id
		 and   b.operating_facility_id=:nd_facility_id
         and   b.TRX_DOC_REF_LINE_NUM = a.TRX_DOC_REF_LINE_NUM
         and   b.bill_doc_type_code = :d1_doc_type
         and   b.bill_doc_num=:d1_doc_number)
		 and rownum=1;

		if (OERROR)
		{	
		disp_message(ERR_MESG,"Select bl_patient_charges_folio Failed");
		proc_exit();
		}

  }  b/z instead of v_c_billed_serv we are using adm_rec_flag */

/***********************************************************/

		 print_report_head();
		l_next_page=2;
        ccnt=0;
		nd_summary_dtl_ind.arr[0]='\0';  
		nd_prt_grp_hdr_code.arr[0]='\0';
		nd_prt_grp_line_code.arr[0]='\0';
		nd_cust_code1.arr[0]='\0';
			
		/***** This code added for printing package bill if it is there ****/


		/*EXEC SQL select to_char(sysdate,'DD/MM/YYYY HH24:MI')
							into  :nd_canceled_date from dual;   */
		nd_cashier_name.arr[0]='\0';  
		nd_canceled_date.arr[0]='\0';  
				
		nd_canceled_date.len = 0;
		nd_cashier_name.len = 0;

		EXEC SQL SELECT to_char(modified_date,'DD/MM/YYYY HH24:MI'), bill_amt, MODIFIED_BY_ID 
			into :nd_canceled_date, :nd_bill_amt, :nd_cashier_name FROM bl_bill_hdr 
				WHERE doc_type_code = :d1_doc_type AND doc_num = :d1_doc_number;
		
		nd_cashier_name.arr[nd_cashier_name.len]='\0';
		nd_canceled_date.arr[nd_canceled_date.len]='\0';

		fprintf(fp," %80s  ","_________________________________________________________________________________________________________");		
		fprintf(fp,"\n");
		fprintf(fp,"%-s","C A N C E L L E D By ");
		fprintf(fp," %s  ",nd_cashier_name.arr);
		fprintf(fp,"%-s"," On ");
		fprintf(fp," %s  ",nd_canceled_date.arr);
		print_formated_amt(nd_bill_amt);
		/*fprintf(fp," %s  ",nd_bill_amt.arr);*/
		fprintf(fp,"\n");		
		fprintf(fp," %80s  ","_________________________________________________________________________________________________________");		
		fprintf(fp,"\n");		
		fprintf(fp,"\n");		
		

		
		print_sign_designation();

 

 /* THIS ELSE CONDITION WILL EXECUTE IF THE PATIENT DOES NOT HAVE CUSTOMER */


 
 		if (l_lsr != 0 && l_dmp == 0 )
		{
			l_main_hdr = 0;
			fprintf(fp,"\n");
			v_lno = v_lno+1;	
			if (v_lno > max_lines) print_next_page1();
		}
		else
		{
			while(v_lno <= max_lines)
			{
				fprintf(fp,"\n");
				v_lno++;
			}
		}

	/*	if (l_lsr != 0 && l_dmp == 0 )
		{
			fprintf(fp,"%-50.50s ",loc_legend[130]," ");
		}
		else
		{
			fprintf(fp,"%20.20s %30s",loc_legend[130]," ");
		}

       */

	/***** This function will call discount document Pro*C file and print *****/
	 //if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
	 //print_discount_document();


fflush(fp);
fclose(fp);

   } //End Loop
  
 
 } // END WHILE


delete_sy_prog();

//close_cust_cur();

 
	if ( l_logo_yniflaser.arr[0] != 'Y')
	{
	
	fprintf(fp,"");   /* Page break  */
	}

	if (l_lsr != 0 && l_dmp == 0)
	{
	     if ( l_logo_yniflaser.arr[0] != 'Y')
	     {
		  fprintf(fp,"%cE",ESC);  /* To Reset Printer */			
	     }
	}

//fflush(fp);  commented on 13/5/2008
//fclose(fp);  commented on 13/5/2008


	
	if (strcmp(nd_calling_pgm_id.arr,"BLTBILVT") == 0 )
	{	
		strcpy(nd_calling_pgm_id.arr,"BLRBILVT");
		nd_calling_pgm_id.arr[nd_calling_pgm_id.len] = '\0';
	}
 
			/*sprintf(nd_str,"[%s] [%s] [%s] [%s] [%s] ", uid_pwd.arr,nd_session_id.arr,
								d_cashfacility_id.arr, nd_calling_pgm_id.arr,
							filename);
			disp_message(ERR_MESG,nd_str);*/


	 
	if (nd_online_print_yn == 'Y')
	{
		if (l_logo_yniflaser.arr[0] != 'Y')
		{
	
		  if(l_discr_cnt>0)
	      l_loop_cnt=2; 
	      else
          l_loop_cnt=1; 
				

		     for(l=1;l<=l_loop_cnt;l++)
		     {				
				
				if (strcmp(l_only_print_discount.arr,"Y")==0) //ADDED BY VANI REGARDING IN11662
				l=2;

				strcpy(nd_calling_pgm_id.arr,l_nd_calling_pgm_id.arr);
				
				
						
				PrintDocument(uid_pwd.arr,		    //char	*PUidPwd;
						nd_session_id.arr,	        //char	*PSessionID;
						d_cashfacility_id.arr,		//char	*PFacilityID;
						"BL",						//char	*PModuleID;
						nd_calling_pgm_id.arr,		//char	*PDocumentID;
						l_filename[l],
						//filename,					//char	*POnlinePrintFileNames;
						"O",						//char	*PLocationTypes;
						" ",						//char	*PLocationCodes;
						1,							//int		PNumOfCopies;
						1,							//int		PPageFrom;
			
						9999);						//int		PPageTo;);
		        
		        
		     }	  
			 
			 	 
		declare_bill_temp_cur();
		open_bill_temp_cur();
		while(fetch_bill_temp())
		{
		 update_bill_print_flag();
		}
		close_bill_temp_cur();
			
		}
	}
	else
	{
		if (l_lsr != 0 && l_dmp == 0 && l_logo_yniflaser.arr[0] == 'Y')
		{		

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;			

		EXEC SQL EXECUTE
		DECLARE
			l_print_status BOOLEAN;
		BEGIN		
	
			 
			APPPRINT.SUBMIT_ORACLE_REPORT
				 (:nd_ws_no,
				  :d_cashfacility_id,
				  'BL',
				  :nd_logo_pgm_id,
				  'P', --p_report_option
				  '',  --p_outputfile_format
				  '',  --p_outputfile_name
				  'O',
				  ' ', --p_location_code
				  NULL, --:l_printer_names,
				  NULL,
				  NULL, --p_page_from
				  NULL, --p_page_to
				  NULL, --p_print_mode
				  'P_FILE_NAME='||:nd_file_name||'+'||'P_LOGO_NAME='||:l_logo_name, --p_param_list
				  l_print_status, --OUT BOOLEAN,
				 :l_errortext);			  
		
		END;
		END-EXEC;

		if (l_errortext.arr[0] != '\0')
		{
			disp_message(ERR_MESG,l_errortext.arr);			
			proc_exit(0);
			
		}
	

	     }
	}


	return 1;
}


print_discount_document()
{

 	 if(l_disc_cnt==1)
	 {

		/***** For Calling Another Pro*C Program ******/

		sprintf(p_command_buf, "BLRDISCN %s %s %s %s %s",
				uid_pwd.arr,nd_session_id.arr,nd_pgm_date.arr,nd_facility_id.arr,"BLRDISCN");
   
	   //WinExec(p_command_buf,SW_SHOWNORMAL);

		lv_Spawn_ret = _spawnlp(_P_WAIT,"BLRDISCN",p_command_buf,NULL);
 
	 }
}

declare_bill_temp_cur()
{
  	EXEC SQL DECLARE BILL_TEMP_CUR CURSOR FOR
	SELECT DOC_TYPE_CODE,DOC_NUM 
	FROM BL_BILL_PRINT_TEMP
	WHERE OPERATING_FACILITY_ID  =:nd_facility_id
	AND SESSION_ID				 =:nd_session_id;


    if (OERROR)
		{ 
			disp_message (ERR_MESG,"declare failed FROM BL_BILL_PRINT_TEMP TABLE");
			proc_exit();
		}
	  	
}

open_bill_temp_cur()
{ 
		EXEC SQL OPEN BILL_TEMP_CUR;

		if (OERROR) 
		{ 
		disp_message (ERR_MESG,"Open BILL_TEMP_CUR cursor failed");
		proc_exit();
		}
	return;
}

fetch_bill_temp()
{
  	nd_doc_type.arr[0]='\0';
	nd_doc_num.arr[0]='\0';
	nd_doc_type.len=0;
	nd_doc_num.len=0;

  EXEC SQL FETCH BILL_TEMP_CUR
   INTO :nd_doc_type,
		:nd_doc_num;

	if(OERROR)
	{ 
		disp_message(ERR_MESG,"FETCH FAILED IN BILL_TEMP_CUR");
		
	}

	if(NODATAFOUND)
	{
		return 0;
	}

	nd_doc_type.arr[nd_doc_type.len]='\0';
    nd_doc_type.arr[nd_doc_type.len]='\0';

   return 1;
 
}

declare_receipt_cur()
{
  	
	EXEC SQL DECLARE RECEIPT_CUR CURSOR FOR
		select doc_type_code,doc_Number
		from BL_RECEIPT_REFUND_HDR 
		where Bill_doc_type_code=:nd_doc_type
		and bill_doc_number=:nd_doc_num;

    if (OERROR)
		{ 
			disp_message (ERR_MESG,"declare failed FROM BL_RECEIPT_REFUND_HDR TABLE");
			proc_exit();
		}
	  	
}
open_receipt_cur()
{ 
		EXEC SQL OPEN RECEIPT_CUR;

		if (OERROR) 
		{ 
		disp_message (ERR_MESG,"Open RECEIPT_CUR cursor failed");
		proc_exit();
		}
	return;
}
fetch_receipt_cur()
{
 	d_rcpt_doc_type_code.arr[0]		='\0';
	d_rcpt_doc_num.arr[0]			='\0';
	d_rcpt_doc_srno.arr[0]			='\0';
	

	d_rcpt_doc_type_code.len = 0;
	d_rcpt_doc_num.len		 = 0;
	d_rcpt_doc_srno.len		 = 0;
	
	
	
  EXEC SQL FETCH RECEIPT_CUR
   INTO :d_rcpt_doc_type_code,
		:d_rcpt_doc_num;
		

	//	sprintf(st_var,"%d",sqlca.sqlcode);
	//	disp_message(ERR_MESG,st_var);



	if(NODATAFOUND)
	{
		return 0;
	}


	if(OERROR)
	{ 
		disp_message(ERR_MESG,"FETCH FAILED IN RECEIPT_CUR");
		
	}



	d_rcpt_doc_type_code.arr[d_rcpt_doc_type_code.len]	= '\0'; 
	d_rcpt_doc_num.arr[d_rcpt_doc_num.len]				= '\0'; 
	d_rcpt_doc_srno.arr[d_rcpt_doc_srno.len]			= '\0'; 
	


   return 1;
 
}
update_bill_print_flag()
{
			
				EXEC SQL UPDATE BL_BILL_HDR SET
							BILL_PRINT_FLAG='Y' 
							WHERE DOC_TYPE_CODE=:nd_doc_type
							and DOC_NUM=:nd_doc_num;

					EXEC SQL COMMIT; 

   
			if(l_no_settlement_details.arr[0]=='R' || 
				( strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS3")==0||strcmp(nd_calling_pgm_id.arr,"BLRUCDS3")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0))
				{  	
								  	  			
							declare_receipt_cur();
							open_receipt_cur();
							while(fetch_receipt_cur())
							{
							 
								EXEC SQL UPDATE BL_RECEIPT_REFUND_HDR SET
										PRINT_FLAG='Y' 
										WHERE DOC_TYPE_CODE=:d_rcpt_doc_type_code
										AND DOC_NUMBER=:d_rcpt_doc_num;

								 EXEC SQL COMMIT; 
						    }

							close_receipt_cur();
						
					
				 }		 

	return 1;
		
}


close_bill_temp_cur()
{ 
	EXEC SQL CLOSE BILL_TEMP_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close BILL_TEMP_CUR failed");
	proc_exit();
	}
	return;
}

close_receipt_cur()
{ 
	EXEC SQL CLOSE RECEIPT_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close RECEIPT_CUR failed");
	proc_exit();
	}
	return;
}
declare_master_cur()
{


	EXEC SQL DECLARE HEADER_CUR CURSOR FOR
		SELECT a.DOC_TYPE_CODE,a.DOC_NUM,a.DOC_DATE,
		a.DOC_TYPE_CODE ||'/'||LTRIM(TO_CHAR(a.DOC_NUM)),
		--a.DOC_TYPE_CODE ||'/'||LTRIM(TO_CHAR(a.DOC_NUM,'00000009')),
		a.EPISODE_TYPE,
		a.EPISODE_ID,
		a.VISIT_ID,
		a.PATIENT_ID,
		a.ENCOUNTER_ID,
		a.CUST_CODE,
		A.POLICY_TYPE_CODE,
		a.BILL_PRINT_FLAG,
		NVL(a.PREPAY_ADJ_AMT,0)+NVL(a.DEPOSIT_ADJ_AMT,0)+NVL(a.SPL_AGENCY_DEP_ADJ_AMT,0)Deposit_Adjusted,
		a.MAN_DISC_AMT,
		a.OVERALL_DISC_AMT,
		a.BILL_TOT_OUTST_AMT,
		nvl(a.BILL_TOT_ADJUST_AMT,0)+nvl(PMNT_DIFF_ADJ_AMT,0),   //added by vani
		a.BILL_TOT_EXEMPT_AMT,
		a.BILL_TOT_WRITE_OFF_AMT,
		a.BILL_NATURE_CODE,a. ACCT_SEQ_NO,
		a.INT_BILL_PRV_DOC_TYPE_CODE,
		a.INT_BILL_PRV_DOC_NUMBER,
		a.BLNG_GRP_ID,
		NVL(a.BILL_PAID_AMT,0),
		a.ADDED_BY_ID,
		a.PMNT_DIFF_ADJ_AMT,
		a.SERV_DISC_AMT,
		a.CASH_COUNTER_CODE,
		nvl(a.BILL_AMT,0) BILL_AMT,
		a.ALT_ID_TYPE,    
		a.ALT_ID_NO,      
		a.PATIENT_NAME           
		FROM BL_BILL_HDR a, BL_BILL_PRINT_TEMP b
		WHERE a.OPERATING_FACILITY_ID = :nd_facility_id
	    AND a.DOC_TYPE_CODE = b.DOC_TYPE_CODE 
		AND a.DOC_NUM       = b.DOC_NUM
		AND b.SESSION_ID    = :nd_session_id
		ORDER	BY 1,2;


		if (OERROR)
		{ 
			disp_message (ERR_MESG,"Declare Master Cursor failed");
			proc_exit();
		}
	
	return;
}


open_master_cur()
	{ 
		EXEC SQL OPEN HEADER_CUR;

		if (OERROR) 
		{ 
		disp_message (ERR_MESG,"Open HEADER_CUR cursor failed");
		proc_exit();
		}
	return;
	}

fetch_master_cur()
{

	d1_doc_type.arr[0]		='\0';
	d1_doc_number.arr[0]	='\0';
	d1_doc_date.arr[0]		='\0';
	d1_doc_type_num.arr[0]	='\0';
	d_episode_type.arr[0]	='\0';
	d_episode_type.len		= 0;
	d_episode_id.arr[0]		='\0';
	d_episode_id.len		= 0;
	d_visit_id.arr[0]		='\0';
	d_visit_id.len			= 0;
	d_patient_id.arr[0]		='\0';
	d_patient_id.len		= 0;
	d_encounter_id.arr[0]	='\0';
	d_encounter_id.len		= 0;
	d_cust_code.arr[0]		='\0';
	dc_bill_print_flag.arr[0] ='\0';
	d_bill_nature_code.arr[0] ='\0';
	d_acct_seq_no.arr[0]	  ='\0';
	d_int_bill_prv_doc_type_code.arr[0]='\0';
	d_int_bill_prv_doc_number.arr[0]   ='\0';
	d_bill_nature_code.len  = 0;
	dc_bill_print_flag.len  = 0;
	d_cust_code.len			= 0;
	d1_doc_type.len			= 0;
	d1_doc_number.len		= 0;
	d1_doc_type_num.len		= 0;
	d_acct_seq_no.len		= 0;
	d_int_bill_prv_doc_type_code.len=0;
	d_int_bill_prv_doc_number.len	=0;
	dc_blng_grp_id.arr[0]   ='\0';
	dc_blng_grp_id.len		=  0;
	d_added_by_id.arr[0]	= '\0';
	d_added_by_id.len		=  0;
	d_Policy_type_code.arr[0]	= '\0';
	d_Policy_type_code.len		=   0;
	alt_id_type.arr[0]			= '\0';
	alt_id_type.len				=   0;
	alt_id_no.arr[0]			= '\0';
	alt_id_no.len				=   0;
	patient_name.arr[0]			= '\0';
	patient_name.len			=   0;



EXEC SQL FETCH HEADER_CUR INTO 
	d1_doc_type,
    d1_doc_number,
	d1_doc_date,
    d1_doc_type_num,
	d_episode_type,
	d_episode_id,
	d_visit_id,
	d_patient_id,
	d_encounter_id,
	d_cust_code,
	d_Policy_type_code,
	dc_bill_print_flag,
	d_deposit_adj_amt,
	d1_man_disc_amt,
	d1_overall_disc_amt,
	d_bill_tot_outst_amt,
	d1_tot_adjust_amt,
	d1_bill_tot_exmpt_amt,
	d1_tot_write_off_amt,
	d_bill_nature_code,
	d_acct_seq_no,
	d_int_bill_prv_doc_type_code,
	d_int_bill_prv_doc_number,
	dc_blng_grp_id,
	d_bill_paid_amt,
	d_added_by_id,
	d_pmnt_diff_adj_amt,
	d_serv_disc_amt,
	d_cash_counter,
	d1_bill_amt,
	alt_id_type,
    alt_id_no,
    patient_name;

		
	if(OERROR)
	{ 
		disp_message(ERR_MESG,"FETCH FAILED IN HEADER_CUR");
		proc_exit();
	}

	if(NODATAFOUND)
	{
		return 0;
	}

	d_episode_type.arr[d_episode_type.len] = '\0';
	d_episode_id.arr[d_episode_id.len] = '\0';	
	d_visit_id.arr[d_visit_id.len] = '\0';	
	d_patient_id.arr[d_patient_id.len] = '\0';	
	d_encounter_id.arr[d_encounter_id.len] = '\0';	
	d_cust_code.arr[d_cust_code.len] = '\0';
	dc_bill_print_flag.arr[dc_bill_print_flag.len] = '\0';	
	d_bill_nature_code.arr[d_bill_nature_code.len] = '\0';
	d1_doc_type.arr[d1_doc_type.len]='\0';
	d1_doc_number.arr[d1_doc_number.len]='\0';
	d1_doc_date.arr[d1_doc_date.len]='\0';
	d1_doc_type_num.arr[d1_doc_type_num.len]='\0';
	d_acct_seq_no.arr[d_acct_seq_no.len]='\0';
	d_int_bill_prv_doc_type_code.arr[d_int_bill_prv_doc_type_code.len]='\0';
	d_int_bill_prv_doc_number.arr[d_int_bill_prv_doc_number.len]='\0';
	dc_blng_grp_id.arr[dc_blng_grp_id.len]='\0';
	d_added_by_id.arr[d_added_by_id.len]='\0';
	d_Policy_type_code.arr[d_Policy_type_code.len]='\0';
	alt_id_type.arr[alt_id_type.len]='\0';
	alt_id_no.arr[alt_id_no.len]='\0';
	patient_name.arr[patient_name.len]='\0';

	return 1;
}



close_master_cur()
{ 
	EXEC SQL CLOSE HEADER_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close bl_bill_print_temp_cur failed");
	proc_exit();
	}
	return;
}


declare_grp_hdr_cur()
{
  
   EXEC SQL DECLARE BL_BILL_GRP_HDR_LINE_CUR CURSOR FOR
	SELECT TRX_DOC_REF,
	TRX_DOC_REF_LINE_NUM,
	TRX_DOC_REF_SEQ_NUM, 
	CUST_CODE,
	A.BLNG_SERV_CODE,
	TO_CHAR(A.SERVICE_DATE,'DD/MM/YYYY HH24:MI'),
	DECODE(module_id,'PH','M','ST','M','MM','M','S') MAPPING_CODE_IND,
	SERV_ANAL_GRP1||SERV_ANAL_GRP2,
	SERV_ITEM_CODE, 
	DECODE(module_id,'PH',NVL(SERV_ITEM_DESC_OTH_LANG,SERV_ITEM_DESC),'X'),
	PAYER_SERV_GRP_HDR,
	PAYER_SERV_GRP_LINE,
	A.PRT_GRP_HDR_CODE,
	A.PRT_GRP_LINE_CODE,
	BILL_DOC_TYPE_CODE,
	BILL_DOC_NUM,
	ENT_ITEM_GRP_CODE,
	PAYER_ITEM_GRP_CODE,
	BLCORE.GET_PAYER_DOC_PRINT_SEQ(OPERATING_FACILITY_ID, 
	EPISODE_TYPE,
	CUST_CODE, 
	CUST_GROUP_CODE,
	PAYER_SERV_GRP_HDR, 
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE) PRINT_SEQ,
	DECODE(:l_detail_report_flag ,'Y','DLS',
	nvl(BLCORE.GET_BILL_FORMAT_IND(OPERATING_FACILITY_ID,
	CUST_GROUP_CODE,
	CUST_CODE,
	BLNG_GRP_ID,
	EPISODE_TYPE,
	PAYER_SERV_GRP_HDR, 
	PAYER_SERV_GRP_LINE, 
	A.PRT_GRP_HDR_CODE, 
	A.PRT_GRP_LINE_CODE,
	ENT_ITEM_GRP_CODE, 
	PAYER_ITEM_GRP_CODE),'SGN')) SUMMARY_DTL_IND,
	UPD_GROSS_CHARGE_AMT,
	UPD_DISC_AMT,
	UPD_NET_CHARGE_AMT,
	NET_REIMBURSABLE_AMT,
	ADDL_CHARGE_AMT_IN_CHARGE,
	NVL(PACKAGE_TRX_YN,'N'),
	PACKAGE_SEQ_NO,
	A.BASE_RATE/A.BASE_QTY RATE,
	A.SERV_QTY,
	NVL(A.UPD_DISC_AMT,0) CHARGE_DISCOUNT,
	NVL(A.BILL_LEVEL_DISC_DSTRBTN_AMT,0)+NVL(A.LINE_LEVEL_DISC_DSTRBTN_AMT,0) BILL_DISCOUNT,
	NVL(A.BILL_LEVEL_POL_ADJ_DSTRBTN_AMT,0) FUND_ADJUSTMENT,
    NVL(A.UPD_DISC_AMT,0)+NVL(A.BILL_LEVEL_DISC_DSTRBTN_AMT,0)+NVL(A.LINE_LEVEL_DISC_DSTRBTN_AMT,0)+NVL(A.BILL_LEVEL_POL_ADJ_DSTRBTN_AMT,0) TOT_DISC,
	BATCH_ID
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	/*
	AND 
	(
			nvl(trx_status,'N')<>'C' 
			or
			(
			nvl(trx_status,'N')='C' and 
			A.bill_doc_type_code =:d1_doc_type
			AND A.BILL_DOC_NUM =  :d1_doc_number
			and 
			  ( 
				  ( 
				(ORIG_DOC_REF, ORIG_DOC_REF_LINE_NUM,ORIG_DOC_REF_SEQ_NUM) in
				( select
				  trx_doc_ref,trx_doc_ref_line_num ,TRX_DOC_REF_SEQ_NUM
				  from bl_patient_charges_folio where trx_status = 'C'           		
				  and operating_facility_id = :nd_facility_id
				  and patient_id =:d_patient_id
				  and 
				   (
					   (:d_episode_type IN('O','E')
					   and episode_id = NVL(:d_episode_id,EPISODE_ID)
					   and visit_id   = NVL(:d_visit_id,VISIT_ID))
					   OR(:d_episode_type IN('I','D')
					   and episode_id = NVL(:d_episode_id,EPISODE_ID))
					) 
				AND bill_doc_type_code||BILL_DOC_NUM<> A.bill_doc_type_code||A.BILL_DOC_NUM) 
				   )  
			  ) 
			)
	)
	*/ // from here added by ravi kiran bcoz of cancelled service not to be printed
	and (trx_status is null 

                or (trx_status ='C' and  
				       
					   
					   ( (NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                         (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                         bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                         patient_id=:d_patient_id         and 

						 bill_doc_type_code =:d1_doc_type			//added by vani

                         and bill_doc_num =  :d1_doc_number)
						)
					   or (:d1_bill_amt=0)
					   )
			
				   )		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		//added by vani

                        and bill_doc_num =  :d1_doc_number )	//added by vani

                        //A.bill_doc_type_code =:d1_bill_doc_type_code//commented by vani

                        //AND A.BILL_DOC_NUM =  :d1_bill_doc_num) //commented by vani

        ))   //upto here ravi added
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	--AND NVL(PACKAGE_SEQ_NO,0)=0
    --AND NVL(PACKAGE_TRX_YN,'N')='N'
	ORDER BY CUST_CODE, PAYER_ITEM_GRP_CODE, ENT_ITEM_GRP_CODE,
	DECODE(PAYER_SERV_GRP_HDR,NULL, A.PRT_GRP_HDR_CODE, PAYER_SERV_GRP_HDR), 
	PRINT_SEQ , SUMMARY_DTL_IND, 
	DECODE(PAYER_SERV_GRP_LINE, NULL,A.PRT_GRP_LINE_CODE, PAYER_SERV_GRP_LINE);


	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Failed to Declare Group Header Cursor");
		proc_exit;
	}
	
	return;
}

open_grp_hdr_cur()
{
	EXEC SQL OPEN BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open Cursor Group Header Failed");
		proc_exit();
	}
	return;
}

close_grp_hdr_cur()
{ 
	EXEC SQL CLOSE BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{
	disp_message (ERR_MESG,"Close BL_BILL_GRP_HDR_LINE_CUR failed");
	proc_exit();
	}
	return;
}

fetch_grp_hdr_cur()
{
	d_trx_doc_ref.arr[0]			= '\0';
	d_trx_doc_ref_line_num.arr[0]	= '\0';
	d_trx_doc_ref_seq_num.arr[0]	= '\0';
	d_cust_code1.arr[0]				= '\0';
	d_blng_serv_code.arr[0]			= '\0';
	d_service_date.arr[0]			= '\0';
	d_mapping_code_ind.arr[0]		= '\0';
	d_serv_anal_grp.arr[0]			= '\0';
	d_serv_item_code.arr[0]			= '\0';
	d_serv_item_desc.arr[0]			= '\0';
	d_payer_serv_grp_hdr.arr[0]		= '\0';
	d_payer_serv_grp_line.arr[0]	= '\0';
	d_prt_grp_hdr_code.arr[0]		= '\0';
	d_prt_grp_line_code.arr[0]		= '\0';
	d_bill_doc_type_code.arr[0]		= '\0';
	d_bill_doc_num.arr[0]			= '\0';
	d_ent_item_grp_code.arr[0]		= '\0';
	d_payer_item_grp_code.arr[0]	= '\0';
	d_summary_dtl_ind.arr[0]		= '\0';
	d_package_trx_yn.arr[0]			= '\0';
	d_folio_batch_id.arr[0]			= '\0';
	
	

	d_trx_doc_ref.len			= 0;
	d_trx_doc_ref_line_num.len	= 0;
	d_trx_doc_ref_seq_num.len	= 0;
	d_cust_code1.len			= 0;
	d_blng_serv_code.len		= 0;
	d_service_date.len			= 0;
	d_mapping_code_ind.len		= 0;
	d_serv_anal_grp.len			= 0;
	d_serv_item_code.len		= 0; 
	d_serv_item_desc.len	    = 0;
	d_payer_serv_grp_hdr.len	= 0;
	d_payer_serv_grp_line.len	= 0;
	d_prt_grp_hdr_code.len		= 0;
	d_prt_grp_line_code.len		= 0;
	d_bill_doc_type_code.len	= 0;
	d_bill_doc_num.len			= 0;
	d_ent_item_grp_code.len		= 0;
	d_payer_item_grp_code.len	= 0;
	d_summary_dtl_ind.len		= 0;
	d_package_trx_yn.len		= 0;
	d_folio_batch_id.len		= 0;

	EXEC SQL FETCH BL_BILL_GRP_HDR_LINE_CUR INTO	
		:d_trx_doc_ref,
		:d_trx_doc_ref_line_num,
		:d_trx_doc_ref_seq_num,
		:d_cust_code1,
		:d_blng_serv_code,
		:d_service_date,
		:d_mapping_code_ind,
		:d_serv_anal_grp,
		:d_serv_item_code,
		:d_serv_item_desc,
		:d_payer_serv_grp_hdr,
		:d_payer_serv_grp_line,
		:d_prt_grp_hdr_code,
		:d_prt_grp_line_code,
		:d_bill_doc_type_code,
		:d_bill_doc_num,
		:d_ent_item_grp_code,
		:d_payer_item_grp_code,
		:d_print_seq,
		:d_summary_dtl_ind,
		:d_upd_gross_charge_amt,
		:d_upd_disc_amt,
		:d_upd_net_charge_amt,
		:d_net_reimbursable_amt,
		:d_addl_charge_amt_in_charge,
		:d_package_trx_yn,
		:d_package_seq_no,
		:d_rate,
		:d_serv_qty,
		:d_charge_discount,
		:d_bill_discount,
		:d_fund_adjustment,
		:d_tot_disc,
		:d_folio_batch_id;
	          
	if (OERROR)
	{ 
		disp_message(ERR_MESG,"Fetch Group Header Cursor Failed");
		proc_exit();
	}

    if(NODATAFOUND)
	{
   		return 0;
	}

	d_trx_doc_ref.arr[d_trx_doc_ref.len]					= '\0';
	d_trx_doc_ref_line_num.arr[d_trx_doc_ref_line_num.len]	= '\0';
	d_trx_doc_ref_seq_num.arr[d_trx_doc_ref_seq_num.len]	= '\0';
	d_cust_code1.arr[d_cust_code1.len]						= '\0';
	d_blng_serv_code.arr[d_blng_serv_code.len]				= '\0';
	d_mapping_code_ind.arr[d_mapping_code_ind.len]			= '\0';
	d_serv_anal_grp.arr[d_serv_anal_grp.len]				= '\0';
	d_serv_item_code.arr[d_serv_item_code.len]				= '\0';
	d_serv_item_desc.arr[d_serv_item_desc.len]				= '\0';
	d_payer_serv_grp_hdr.arr[d_payer_serv_grp_hdr.len]		= '\0';
	d_payer_serv_grp_line.arr[d_payer_serv_grp_line.len]	= '\0';
	d_prt_grp_hdr_code.arr[d_prt_grp_hdr_code.len]			= '\0';
	d_prt_grp_line_code.arr[d_prt_grp_line_code.len]		= '\0';
	d_bill_doc_type_code.arr[d_bill_doc_type_code.len]		= '\0';
	d_bill_doc_num.arr[d_bill_doc_num.len]					= '\0';
	d_ent_item_grp_code.arr[d_ent_item_grp_code.len]		= '\0';
	d_payer_item_grp_code.arr[d_payer_item_grp_code.len]	= '\0';
    d_summary_dtl_ind.arr[d_summary_dtl_ind.len]			= '\0';
	d_package_trx_yn.arr[d_package_trx_yn.len]				= '\0';
	d_folio_batch_id.arr[d_folio_batch_id.len]				= '\0';

	


if (strcmp(p_print_serv_date_with_time_yn.arr,"N")==0)
{	
	d_service_date1.arr[0]='\0';
	
	EXEC SQL select to_char(to_date(:d_service_date,'DD/MM/YYYY HH24:MI'),'DD/MM/YYYY')
							into  :d_service_date1 from dual;

    strcpy(d_service_date.arr,d_service_date1.arr);

	if(d_service_date.arr[0]!='\0')
				{
				  init_date_temp_var();
				  strcpy(date_convert.arr,d_service_date.arr);
				  fun_change_loc_date();
				  strcpy(d_service_date.arr,nd_loc_date1.arr);
				 				  
				 }

}
else
{

	if(d_service_date.arr[0]!='\0')
				{
				  init_date_temp_var();
				  strcpy(date_convert.arr,d_service_date.arr);
				  fun_change_loc_date1();
				  strcpy(d_service_date.arr,date_convert.arr);
			
				 }

}



	return 1;
}


open_patient_cur()
{	
	EXEC SQL OPEN BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open Cursor Group Header Failed");
		proc_exit();
	}
	return;
}


close_patient_cur()
{ 
	EXEC SQL CLOSE BL_BILL_GRP_HDR_LINE_CUR;
	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close BL_BILL_GRP_HDR_LINE_CUR failed");
		proc_exit();
	}
	return;
}

fetch_patient_cur()
{
	d1_trx_doc_ref.arr[0]			= '\0';
	d1_trx_doc_ref_line_num.arr[0]	= '\0';
	d1_trx_doc_ref_seq_num.arr[0]	= '\0';
	d1_cust_code1.arr[0]			= '\0';
	d1_blng_serv_code.arr[0]		= '\0';
	nd_service_date.arr[0]			= '\0';
	d1_mapping_code_ind.arr[0]		= '\0';
	d1_serv_anal_grp.arr[0]			= '\0';
	d1_serv_item_code.arr[0]		= '\0';
	d1_serv_item_desc.arr[0]		= '\0';
	d1_payer_serv_grp_hdr.arr[0]	= '\0';
	d1_payer_serv_grp_line.arr[0]	= '\0';
	d1_prt_grp_hdr_code.arr[0]		= '\0';
	d1_prt_grp_line_code.arr[0]		= '\0';
	d1_bill_doc_type_code.arr[0]	= '\0';
	d1_bill_doc_num.arr[0]			= '\0';
	d1_ent_item_grp_code.arr[0]		= '\0';
	d1_payer_item_grp_code.arr[0]	= '\0';
	d1_summary_dtl_ind.arr[0]		= '\0';
	d1_package_trx_yn.arr[0]		= '\0';
	d1_folio_batch_id.arr[0]		= '\0';


	d1_trx_doc_ref.len			= 0;
	d1_trx_doc_ref_line_num.len = 0;
	d1_trx_doc_ref_seq_num.len	= 0;
	d1_cust_code1.len			= 0;
	d1_blng_serv_code.len		= 0;
	nd_service_date.len				= 0;
	d1_mapping_code_ind.len		= 0;
	d1_serv_anal_grp.len		= 0;
	d1_serv_item_code.len		= 0; 
	d1_serv_item_desc.len		= 0;
	d1_payer_serv_grp_hdr.len	= 0;
	d1_payer_serv_grp_line.len	= 0;
	d1_prt_grp_hdr_code.len		= 0;
	d1_prt_grp_line_code.len	= 0;
	d1_bill_doc_type_code.len	= 0;
	d1_bill_doc_num.len			= 0;
	d1_ent_item_grp_code.len	= 0;
	d1_payer_item_grp_code.len	= 0;
	d1_summary_dtl_ind.len		= 0;
	d1_package_trx_yn.len		= 0;
	d1_folio_batch_id.len		= 0;


	EXEC SQL FETCH BL_BILL_GRP_HDR_LINE_CUR INTO	
		:d1_trx_doc_ref,
		:d1_trx_doc_ref_line_num,
		:d1_trx_doc_ref_seq_num,
		:d1_cust_code1,
		:d1_blng_serv_code,
		:nd_service_date,
		:d1_mapping_code_ind,
		:d1_serv_anal_grp,
		:d1_serv_item_code,
		:d1_serv_item_desc,
		:d1_payer_serv_grp_hdr,
		:d1_payer_serv_grp_line,
		:d1_prt_grp_hdr_code,
		:d1_prt_grp_line_code,
		:d1_bill_doc_type_code,
		:d1_bill_doc_num,
		:d1_ent_item_grp_code,
		:d1_payer_item_grp_code,
		:d1_print_seq,
		:d1_summary_dtl_ind,
		:d1_upd_gross_charge_amt,
		:d1_upd_disc_amt,
		:d1_upd_net_charge_amt,
		:d_net_reimbursable_amt,
		:d1_addl_charge_amt_in_charge,
		:d1_package_trx_yn,
		:d1_package_seq_no,
		:d1_rate,
		:d1_serv_qty,
		:d1_charge_discount,
		:d1_bill_discount,
		:d1_fund_adjustment,
		:d1_tot_disc,
		:d1_folio_batch_id;
  
	
	if (OERROR)
	{ 
		disp_message(ERR_MESG,"Fetch Group Header Cursor Failed");
		proc_exit();
	}

    if(NODATAFOUND)
	{
   				
		return 0;
	}


	d1_trx_doc_ref.arr[d1_trx_doc_ref.len]					= '\0';
	d1_trx_doc_ref_line_num.arr[d1_trx_doc_ref_line_num.len]= '\0';
	d1_trx_doc_ref_seq_num.arr[d1_trx_doc_ref_seq_num.len]	= '\0';
	d1_cust_code1.arr[d1_cust_code1.len]					= '\0';
	d1_blng_serv_code.arr[d1_blng_serv_code.len]			= '\0';
	d1_mapping_code_ind.arr[d1_mapping_code_ind.len]		= '\0';
	d1_serv_anal_grp.arr[d1_serv_anal_grp.len]				= '\0';
	d1_serv_item_code.arr[d1_serv_item_code.len]			= '\0';
	d1_serv_item_desc.arr[d1_serv_item_desc.len]			= '\0';
	d1_payer_serv_grp_hdr.arr[d1_payer_serv_grp_hdr.len]	= '\0';
	d1_payer_serv_grp_line.arr[d1_payer_serv_grp_line.len]	= '\0';
	d1_prt_grp_hdr_code.arr[d1_prt_grp_hdr_code.len]		= '\0';
	d1_prt_grp_line_code.arr[d1_prt_grp_line_code.len]		= '\0';
	d1_bill_doc_type_code.arr[d1_bill_doc_type_code.len]	= '\0';
	d1_bill_doc_num.arr[d1_bill_doc_num.len]				= '\0';
	d1_ent_item_grp_code.arr[d1_ent_item_grp_code.len]		= '\0';
	d1_payer_item_grp_code.arr[d1_payer_item_grp_code.len]	= '\0';
    d1_summary_dtl_ind.arr[d1_summary_dtl_ind.len]			= '\0';
	d1_package_trx_yn.arr[d1_package_trx_yn.len]			= '\0';
	d1_folio_batch_id.arr[d1_folio_batch_id.len]			= '\0';



if (strcmp(c_print_serv_date_with_time_yn.arr,"N")==0)
{	
	
	EXEC SQL  select to_char(to_date(:nd_service_date,'DD/MM/YYYY HH24:MI'),'DD/MM/YYYY')
							into  :nd_service_date1 from dual;
	
    strcpy(nd_service_date.arr,nd_service_date1.arr);

	if(nd_service_date.arr[0]!='\0')
				{
				  init_date_temp_var();
				  strcpy(date_convert.arr,nd_service_date.arr);
				  fun_change_loc_date();
				  strcpy(nd_service_date.arr,nd_loc_date1.arr);
							  
				 }

	
}
else
{
	
	if(nd_service_date.arr[0]!='\0')
				{
				  init_date_temp_var();
				  strcpy(date_convert.arr,nd_service_date.arr);
				  fun_change_loc_date1();
				  strcpy(nd_service_date.arr,date_convert.arr);
				 				
				 }

}


  	return 1;
}

get_adm_rec_flag()
{


  d_adm_rec_flag.arr[d_adm_rec_flag.len]='\0';
  d_adm_rec_flag.len=0;


 EXEC SQL Select b.ADM_REC_FLAG  
		INTO :d_adm_rec_flag  
		from BL_ENCOUNTER_PAYER_PRIORITY a,bl_blng_grp b
		where OPERATING_FACILITY_ID =:nd_facility_id
		and a.patient_id =:d_patient_id
		and a.EPISODE_TYPE = :d_episode_type
		and ((:d_episode_type in ('O','E','I','D') and EPISODE_ID   =:d_episode_id) or :d_episode_type ='R')
		and ((:d_episode_type in ('O','E') and VISIT_ID =:d_visit_id ) or (:d_episode_type in ('R','I','D')))
		and a.ACCT_SEQ_NO  = :d_acct_seq_no
		and priority	 = 1
		and a.blng_grp_id = b.blng_grp_id;

	if (OERROR) 
	{	
	  disp_message (ERR_MESG,"Failed to Declare Group Header Cursor");
	}
     d_adm_rec_flag.arr[d_adm_rec_flag.len]='\0';

}
/* Intialize the all the variables*/
init_all_variables()
{
	nd_oth_payer_amt=0;
	nd_gross_total =0; 
	p_tot_pat_net_amt=0;
	p_tot_pat_gross_amt=0;
	nd_gnd_tot_net_reimbursable_amt=0;
	nd_tot_pat_net_charge_amt=0;
	nd_rounded_amt=0;
	nd_net_pay_amt_after_rounded=0;
	nd_tot_pat_disc_amt=0;
	nd_gnd_tot_net_non_reimbursable_amt=0;
	nd_pat_net_amt=0;
	nd_tot_pat_disc_amt=0;
	nd_pat_gross_amt=0;
	nd_pat_net_amt1=0;
	nd_pat_disc_amt=0;
	nd_pat_gross_amt1=0;
	nd_pat_net_amt2=0;
	nd_pat_disc_amt1=0;
	nd_tot_net_reimbursable_amt=0;
	nd_tot_non_reimbursable_amt=0;
	nd_pat_net_charge_amt=0;
	nd_pat_addl_charge_amt=0;
	nd_pat_tot_addl_charge_amt=0;
	nd_upd_net_charge_amt=0;
	nd_tot_rate=0,
	nd1_tot_rate=0,
	nd_tot_serv_qty=0,
	nd1_tot_serv_qty=0,
	nd_grd_tot_rate=0,
	nd1_grd_tot_rate=0,
	nd_grd_tot_serv_qty=0,
	nd1_grd_tot_serv_qty=0,
	nd_total_addl_charge_by_service=0;
	nd_net_payable=0;
	nd_net_total=0;
	nd_tot_oth_payer_amt=0;
	nd_total_addl_charge=0;
	pat_upd_net_charge_amt=0;
	nd_serv_charge_discount=0;
	nd_serv_bill_discount=0;
	nd_serv_fund_adjustment=0;
	nd_serv_tot_disc=0;
	nd_tot_serv_charge_discount=0;
	nd_tot_serv_bill_discount=0;
	nd_tot_serv_fund_adjustment=0;
	nd_tot_serv_tot_disc=0;
	nd1_serv_charge_discount=0;
	nd1_serv_bill_discount=0;
	nd1_serv_fund_adjustment=0;
	nd1_serv_tot_disc=0;
	nd1_tot_serv_charge_discount=0;
	nd1_tot_serv_bill_discount=0;
	nd1_tot_serv_fund_adjustment=0;
	nd1_tot_serv_tot_disc=0;
    amount=0;
	nd1_tot_adjust_amt=0;
	v_pno = 1;
	l_cnt=0;
	ccnt1=0;
	l_bill_page_no = 0;
	l_bill_page_no_frmt2=0;
	nd_othp_payer_amt=0;
	othp_cnt=0;
	oth_cnt=0;
	k=1;
	l_no_of_clumns =0;
	v_lno=0;
	line_ctr=0;
	l_pkg_dep_exist=0;


}

/* THIS FUNCTION WILL PRINT THE PAYER BILL */

print_prt_grp_hdr()
 { 
		
		fetch_bill_format_payer();/* This Function will fetch the Payer Setup Records */
		if (ccnt1==1)
		{
			//fetch_cust_cur();
			
			get_payer_bill_header();
	
		}

	    /* This one Calculating the Patient Amounts */
       
	    if (strcmp(d_cust_code1.arr,"\0")==0)
	    {  
		 
	
     	   get_pat_bill_num(); //Getting Patient Bill Number

		   pat_upd_gross_charge_amt=pat_upd_gross_charge_amt+d_upd_gross_charge_amt;
		   pat_upd_net_charge_amt=pat_upd_net_charge_amt+d_upd_net_charge_amt;
		   pat_upd_disc_amt=pat_upd_disc_amt+d_upd_disc_amt;

		 
	    }
	  /* This one Calculating the Payer Amounts */
	  else
	   {
		  

		  if (strcmp(d_cust_code1.arr,d_cust_code.arr)==0)
		  {	
					//disp_message(ERR_MESG,"count");
					//sprintf(st_var,"%d",ccnt);
					 //disp_message(ERR_MESG,st_var);
				  /*****************summary****************/
		
			   
			   if(d_summary_dtl_ind.arr[0] == 'S')  
				{
					
				   if( ccnt==1)
				   {
						 
						 get_print_group_hd_desc3(); 
						 get_print_group_line_desc3();
						 //get_blng_serv_desc();
											
						
					  if( d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					  {
					  
						if(nd_summary_dtl_ind.arr[0] == 'D')
						{
							if(d_summary_dtl_ind.arr[1] == 'L')  
							{ 
							  if (l_lsr != 0 && l_dmp == 0)
							  {
							  if( l_logo_yniflaser.arr[0] != 'Y')
							  {
							  print_bold_underline();
							  fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
							  Release_bold_underline();
							  fprintf(fp,"\n");
							  }
							  }
								
							  if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							  {
								  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"%-11.11s %s  \n"," ",nd_prt_line_desc.arr," ");
									  fprintf(fp,"%-11.11s %-36.36s  "," "," "," ");
									  }
									  else
									  {
										fprintf(fp,"%-11.11s %-36.36s  "," ",nd_prt_line_desc.arr," ");
									  }
								  }
								  else
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"%-11.11s %s  \n"," ",nd_prt_line_desc.arr," ");
									  fprintf(fp,"%-11.11s %-20.20s  "," "," "," ");
									  }
									  else
									  {
									  fprintf(fp,"%-11.11s %-20.20s  "," ",nd_prt_line_desc.arr," ");
									  }
								  }
							  }
							  else
							  {
								  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								  {
								  fprintf(fp,"%-11.11s %-s    \n"," ",nd_prt_line_desc.arr);
								  fprintf(fp,"%-11.11s %-22.22s    "," "," ");
								  }
								  else
								  {
								  fprintf(fp,"%-11.11s %-22.22s    "," ",nd_prt_line_desc.arr);
								  }
							  }
							
							//fprintf(fp,"%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
							//fprintf(fp,"%-23.23s    %-23.23s",nd_prt_line_desc.arr," ");	
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s / %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	//uncommneted by vani
							//fprintf(fp,"\n%-s / %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	//uncommneted by vani
							}
							else
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
							   if( l_logo_yniflaser.arr[0] != 'Y')
								{
								print_bold_underline();
								fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								Release_bold_underline();
								fprintf(fp,"\n");
								}
								}
							
							 if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							 {
							 
								 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								 {
									 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
									 fprintf(fp,"%-11.11s %s   \n"," ",nd_prt_hd_desc.arr," ");
									 fprintf(fp,"%-11.11s %-36.36s   "," "," "," ");
									 }
									 else
									 {
									  fprintf(fp,"%-11.11s %-36.36s   "," ",nd_prt_hd_desc.arr," ");
									 }
								 }
								 else
								 {
									 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
									 fprintf(fp,"%-11.11s %s   \n"," ",nd_prt_hd_desc.arr," ");
									 fprintf(fp,"%-11.11s %-20.20s   "," "," "," ");
									 }
									 else
									 {
									 fprintf(fp,"%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr," ");
									 }
								 }
							 }
							 else
							 {
							  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
							  {
							  fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);
							  fprintf(fp,"%-11.11s %-26.26s    "," "," ");
							  }
							  else
							  fprintf(fp,"%-11.11s %-26.26s    "," ",nd_prt_hd_desc.arr);

							 }
							//fprintf(fp,"%-23.23s   %-23.23s",nd_prt_hd_desc.arr," ");	
							}
												   
						}
						else
						{
							if(d_summary_dtl_ind.arr[1] == 'L') 
							{ 
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								 print_bold_underline();
								 fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
								 Release_bold_underline();
								}
								}
							
							   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							   {
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									   fprintf(fp,"%-11.11s %-36.36s   "," "," ");
									   }
									   else
										printf(fp,"%-11.11s %-36.36s   "," ",nd_prt_line_desc.arr);
								   }
								   else
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									   fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_line_desc.arr);

								   }
							   }
							   else
							   {
							    if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								{
								fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
								fprintf(fp,"%-11.11s %-26.26s    "," "," ");
								}
								else
								fprintf(fp,"\n%-11.11s %s    "," ",nd_prt_line_desc.arr);  
							   }
							
							//fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
							//fprintf(fp,"\n%-23.23s    %-23.23s",nd_prt_line_desc.arr," ");	
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s -  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
							//fprintf(fp,"\n%-s /  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	 
							}
							else  
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								
								 print_bold_underline();
								 fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								 Release_bold_underline();
								}
								}
							
							   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							   {
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n %-11.11s%s   \n"," ",nd_prt_hd_desc.arr);
									   fprintf(fp," %-11.11s%-36.36s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n %-11.11s%-36.36s   "," ",nd_prt_hd_desc.arr);

								   }
								   else
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n %-11.11s%s   \n"," ",nd_prt_hd_desc.arr);
									   fprintf(fp," %-11.11s%-20.20s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n %-11.11s%-20.20s   "," ",nd_prt_hd_desc.arr);

								   }
							   }
							   else
							   {
								   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								   {
								   fprintf(fp,"\n %-11.11s%s    \n"," ",nd_prt_hd_desc.arr); 
								   fprintf(fp," %-11.11s%-26.26s    "," "," "); 
								   }
								   else
								   fprintf(fp,"\n %-11.11s%-26.26s    "," ",nd_prt_hd_desc.arr);

							   }
							  //fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_hd_desc.arr);
							
							} 
							lsr_line_cnt();
						}
					
					  }	
						//fprintf(fp," %-10.10s %-20.20s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
						
				/********added by vani*********/
			  if( d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0)
			  {	
			 		strcpy(d_grp_code,d_prt_grp_hdr_code.arr);
					get_grp_pkg_outside_cnt1(d_grp_code);
					if (l_grp_pkg_inside_cnt!=0)
					{  
						if(nd_summary_dtl_ind.arr[0] == 'D')
						{
							if(d_summary_dtl_ind.arr[1] == 'L')  
							{ 
							  if (l_lsr != 0 && l_dmp == 0)
							  {
							  if( l_logo_yniflaser.arr[0] != 'Y')
							  {
							  print_bold_underline();
							  fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
							  Release_bold_underline();
							  fprintf(fp,"\n");
							  }
							  }
								
							  if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							  {	
								  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"%-11.11s %-s   \n"," ",nd_prt_line_desc.arr);
									  fprintf(fp,"%-11.11s %-36.36s   "," "," ");
									  }
									  else
									  fprintf(fp,"%-11.11s %-36.36s   "," ",nd_prt_line_desc.arr);

								  }
								  else
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									  fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									  }
									  else
									  fprintf(fp,"%-11.11s %-20.20s   "," ",nd_prt_line_desc.arr);

								  }
							  }
							  else
							  {
								  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								  {
								  fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
								  fprintf(fp,"%-11.11s %-26.26s    "," "," ");
								  }
								  else
								  fprintf(fp,"%-11.11s %-26.26s    "," ",nd_prt_line_desc.arr);

							  }
							
							//fprintf(fp,"%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
							//fprintf(fp,"%-23.23s    %-23.23s",nd_prt_line_desc.arr," ");	
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s / %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	//uncommneted by vani
							//fprintf(fp,"\n%-s / %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	//uncommneted by vani
							}
							else
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
							   if( l_logo_yniflaser.arr[0] != 'Y')
								{
								print_bold_underline();
								fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								Release_bold_underline();
								fprintf(fp,"\n");
								}
								}
					
							 if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							 {
								 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								 {
									 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
									 fprintf(fp,"%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
									 fprintf(fp,"%-11.11s %-36.36s   "," "," ");
									 }
									 else
									 fprintf(fp,"%-11.11s %-36.36s   "," ",nd_prt_hd_desc.arr);
								 }
								 else
								 {
									 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
									 fprintf(fp,"%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
									 fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									 }
									 else
									 fprintf(fp,"%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr);

								 }
							 }
							 else
							 {
								 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								 {
								 fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);
								 fprintf(fp,"%-11.11s %-26.26s    "," "," ");
								 }
								 else
								 fprintf(fp,"%-11.11s %-26.26s   "," ",nd_prt_hd_desc.arr);

							 }
							//fprintf(fp,"%-23.23s   %-23.23s",nd_prt_hd_desc.arr," ");	
							}
												   
						}
						else
						{
							if(d_summary_dtl_ind.arr[1] == 'L') 
							{ 
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								 print_bold_underline();
								 fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
								 Release_bold_underline();
								}
								}
						
							   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							   {
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									   fprintf(fp,"%-11.11s %-36.36s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n%-11.11s %-36.36s   "," ",nd_prt_line_desc.arr);

								   }
								   else
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									   fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_line_desc.arr);

								   }
							   }
							   else
							   {
								   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								   {
								   fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
								   fprintf(fp,"%-11.11s %-26.26s    "," "," ");
								   }
								   else
								   fprintf(fp,"\n%-11.11s %-26.26s    "," ",nd_prt_line_desc.arr);

							   }
							
							//fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
							//fprintf(fp,"\n%-23.23s    %-23.23s",nd_prt_line_desc.arr," ");	
							//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							//fprintf(fp,"\n%-23.23s -  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
							//fprintf(fp,"\n%-s /  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	 
							}
							else  
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								
								 print_bold_underline();
								 fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								 Release_bold_underline();
								}
								}
								
							   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							   {
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n %-11.11s%s   \n"," ",nd_prt_hd_desc.arr);
									   fprintf(fp," %-11.11s%-20.20s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n %-11.11s%-20.20s   "," ",nd_prt_hd_desc.arr);

								   }
								   else
								   {
									   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									   {
									   fprintf(fp,"\n %-11.11s%s   \n"," ",nd_prt_hd_desc.arr);
									   fprintf(fp," %-11.11s%-20.20s   "," "," ");
									   }
									   else
									   fprintf(fp,"\n %-11.11s%-20.20s   "," ",nd_prt_hd_desc.arr);

								   }
							   }
							   else
							   {
								   if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								   {
								   fprintf(fp,"\n %-11.11s%s    \n"," ",nd_prt_hd_desc.arr); 
								   fprintf(fp," %-11.11s%-26.26s    "," "," "); 
								   }
								   else
								   fprintf(fp,"\n %-11.11s%-26.26s    "," ",nd_prt_hd_desc.arr); 

							   }
							  //fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_hd_desc.arr);
							
							} 
							lsr_line_cnt();
						}

					}

			   } 
			/*********upto here********/																
						get_gross_net_amt1();
						
						nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;			
						//nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
						nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Total(Net Amt)	
						nd_pat_disc_amt1=nd_pat_disc_amt1+d_upd_disc_amt; //total service discount
						//nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount

						nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; //total service AmtPayable
						nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				  //total AmtPayable
					
					    nd_total_addl_charge_by_service = nd_total_addl_charge_by_service+d_addl_charge_amt_in_charge; //Total Additional Charge By Service
					    nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge;						   //Total Additional Charge
						
										
						if(d_package_trx_yn.arr[0] == 'Y'  && l_pkg_len!=0)  // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{
						
						 nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_gross_amt;
						 nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_net_amt;
						 nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d_upd_net_charge_amt;
						 nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d_upd_disc_amt;
						 nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d_addl_charge_amt_in_charge;
						}
						
						/*******For CRF-440(Discount Document Report)*******/

						nd_serv_tot_disc=nd_serv_tot_disc+d_tot_disc;						//Service Wise Total Discount
						nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;				//Grand Total Discount

						nd_serv_charge_discount=nd_serv_charge_discount+d_charge_discount;		 //Service Wise Total Charge Discount
						nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount

						nd_serv_bill_discount=nd_serv_bill_discount+d_bill_discount;			//Service Wise Total Bill Discount
						nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount

						nd_serv_fund_adjustment=nd_serv_fund_adjustment+d_fund_adjustment;		//Service Wise Total Fund(policy) Discount
						nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount

						/*******CRF-440 *******/
												
						end_of_report=1;


					   }
					  else
					  if(d_summary_dtl_ind.arr[1] == 'L')
					   {
					    							
						  if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)==0 && strcmp(d_prt_grp_line_code.arr,nd_prt_grp_line_code.arr)==0
						  && strcmp(d_payer_serv_grp_hdr.arr,nd_payer_serv_grp_hdr.arr)==0 && strcmp(d_payer_serv_grp_line.arr,nd_payer_serv_grp_line.arr)==0)
						  {

					   		nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; //total service AmtPayable
							nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				  //total AmtPayable	
																		
							nd_total_addl_charge_by_service = nd_total_addl_charge_by_service+d_addl_charge_amt_in_charge; //Total Additional Charge By Service
					        nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge;						   //Total Additional Charge
							
							/*******For CRF-440(Discount Document Report)*******/

							nd_serv_tot_disc=nd_serv_tot_disc+d_tot_disc;							    //Service Wise Total Discount
							nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;					    //Grand Total Discount

							nd_serv_charge_discount=nd_serv_charge_discount+d_charge_discount;			//Service Wise Total Charge Discount
							nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount

							nd_serv_bill_discount=nd_serv_bill_discount+d_bill_discount;				//Service Wise Total Bill Discount
							nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount

							nd_serv_fund_adjustment=nd_serv_fund_adjustment+d_fund_adjustment;			//Service Wise Total Fund(policy) Discount
							nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount

							/*******CRF-440 *******/
							
							
							
							get_gross_net_amt1();
												
							nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
							nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
							nd_pat_disc_amt1=nd_pat_disc_amt1+d_upd_disc_amt; //total service discount

							//nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
							
							if(d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
							{
							
							 nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_gross_amt;
							 nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_net_amt;
							 nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d_upd_net_charge_amt;
							 nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d_upd_disc_amt;
							 nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d_addl_charge_amt_in_charge;
							}
									 				
							end_of_report=1;
						  }
						 else
						  {

							 nd_net_total=nd_net_total+nd_pat_net_amt2;
							 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
							 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;
							 							 
					         if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 {
							  if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0) //changed from R to C by vani
							  {
								get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
								print_formated_amt1(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt);
							  }
							  else
							  {
							   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0 || (strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N'))
							   fprintf(fp,"%-11.11s"," ");
							  }
							 }

							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							 {
							  if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
							  {
							  
							  print_formated_amt(nd_pat_gross_amt1-nd_inside_pkg_gross_amt);
							  }
							 }
							 
							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							 {
							  if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
							  print_formated_amt(nd_pat_net_amt2-nd_inside_pkg_net_amt);
							 }	
							
							
							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 {
							  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function				
							  {
							   if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							   {
							    if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
							    print_formated_amt(nd_pat_disc_amt1-nd_inside_pkg_disc_amt);
							   }
							  }
							  
							  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)	
							  {
							      if(p_disc_amt_in_dtl_yn.arr[0]=='N')
								  {
								   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   fprintf(fp,"%-9.9s"," ");
								   print_formated_amt(nd_serv_tot_disc);
								  }
								  else
								  {
									print_formated_amt(nd_serv_charge_discount);
									print_formated_amt(nd_serv_bill_discount);
									print_formated_amt(nd_serv_fund_adjustment);
								  }

							  }
							 
							 }
							 
							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							 {
							  if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
							  print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-nd_total_addl_charge_by_service);
							  else
							  {
							   if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
							   print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_inside_pkg_amtpayable_amt-nd_inside_pkg_addchrg_amt));
							  }
							 }
							 //fprintf(fp,"\n");commented on 20/3/2008 for removing space b/w records
							 
							 nd_pat_gross_amt1=0;
							 nd_pat_net_amt2=0;
							 nd_pat_disc_amt1=0;
							 nd_upd_net_charge_amt=0;
							 nd_total_addl_charge_by_service=0;
							 nd_serv_charge_discount=0;
							 nd_serv_bill_discount=0;
							 nd_serv_fund_adjustment=0;
							 nd_serv_tot_disc=0;
							 nd_inside_pkg_gross_amt=0;
							 nd_inside_pkg_net_amt=0;
							 nd_inside_pkg_amtpayable_amt=0;
							 nd_inside_pkg_disc_amt=0;
							 nd_inside_pkg_addchrg_amt=0;
							
							 get_print_group_hd_desc3();
							 get_print_group_line_desc3();
							 //Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
							 //fprintf(fp,"\n%-23.23s -  %-23.23s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
							 
							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if (l_lsr != 0 && l_dmp == 0)
							 {
							 if( l_logo_yniflaser.arr[0] != 'Y')
							 {
							 
							  print_bold_underline();
							  fprintf(fp,"\n%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
							  Release_bold_underline();
							 }
							 }
				
					/*********added by vani **********/
					if (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) 
						{
							strcpy(d_grp_code,d_prt_grp_hdr_code.arr);
								get_grp_pkg_outside_cnt1(d_grp_code);
							if (l_grp_pkg_inside_cnt!=0)
							{
							if (l_lsr != 0 && l_dmp == 0)
							 {
							 if( l_logo_yniflaser.arr[0] != 'Y')
							 {
							 
							  print_bold_underline();
							  fprintf(fp,"\n%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
							  Release_bold_underline();
							 }
							 }
							}
						}
						
						/********upto here********/
							
							 if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							 {
								  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									  fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									  }
									  else
									  fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_line_desc.arr);

								  }
								  else
								  {
									  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									  {
									  fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_line_desc.arr);
									  fprintf(fp,"%-11.11s %-20.20s   "," "," ");
									  }
									  else
									  fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_line_desc.arr);

								  }
							  }
							 else 
							 {
								 if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								 {
								 fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_line_desc.arr);//RAGHAVA
								 fprintf(fp,"%-11.11s %-26.26s    "," "," ");//RAGHAVA
								 }
								 else
								 fprintf(fp,"\n%-11.11s %-26.26s    "," ",nd_prt_line_desc.arr);//RAGHAVA

							 }

							 //fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
							 lsr_line_cnt();

							 nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;    //total service AmtPayable
							 nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				  //total AmtPayable	

							 nd_total_addl_charge_by_service = nd_total_addl_charge_by_service+d_addl_charge_amt_in_charge; //Total Additional Charge By Service
					         nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge;						   //Total Additional Charge
								
							 
							/*******For CRF-440(Discount Document Report)*******/

							nd_serv_tot_disc=nd_serv_tot_disc+d_tot_disc;					//Service Wise Total Discount
							nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;				//Grand Total Discount

							nd_serv_charge_discount=nd_serv_charge_discount+d_charge_discount;		 //Service Wise Total Charge Discount
							nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount

							nd_serv_bill_discount=nd_serv_bill_discount+d_bill_discount;			//Service Wise Total Bill Discount
							nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount

							nd_serv_fund_adjustment=nd_serv_fund_adjustment+d_fund_adjustment;		//Service Wise Total Fund(policy) Discount
							nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount

							/*******CRF-440 *******/	
											 
							 get_gross_net_amt1();
							 
							 nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
							 nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		   //total service Net	
						     nd_pat_disc_amt1=nd_pat_disc_amt1+d_upd_disc_amt; //total service discount
							 //nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	   //total service discount
							
							if(d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
							{
							 
							 nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_gross_amt;
							 nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_net_amt;
							 nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d_upd_net_charge_amt;
							 nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d_upd_disc_amt;
							 nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d_addl_charge_amt_in_charge;
							}
							
							end_of_report=1;
						  }
						  
						   
					  }
						
					else
					  {
					    							
						 if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)==0 && strcmp(d_payer_serv_grp_hdr.arr,nd_payer_serv_grp_hdr.arr)==0) 
						  {

					   		nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt; //total service AmtPayable
							nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				  //total AmtPayable	
																
							nd_total_addl_charge_by_service = nd_total_addl_charge_by_service+d_addl_charge_amt_in_charge; //Total Additional Charge By Service
					        nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge;						   //Total Additional Charge
							
							
							/*******For CRF-440(Discount Document Report)*******/

							nd_serv_tot_disc=nd_serv_tot_disc+d_tot_disc;					//Service Wise Total Discount
							nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;				//Grand Total Discount

							nd_serv_charge_discount=nd_serv_charge_discount+d_charge_discount;		 //Service Wise Total Charge Discount
							nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount

							nd_serv_bill_discount=nd_serv_bill_discount+d_bill_discount;			//Service Wise Total Bill Discount
							nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount

							nd_serv_fund_adjustment=nd_serv_fund_adjustment+d_fund_adjustment;		//Service Wise Total Fund(policy) Discount
							nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount

							/*******CRF-440 *******/

							get_gross_net_amt1();
												
							nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;  //total service gross
							nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;		  //total service Net	
						    nd_pat_disc_amt1=nd_pat_disc_amt1+d_upd_disc_amt; //total service discount
							//nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	  //total service discount
						
							if(d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
							{
							 
							 nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_gross_amt;
							 nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_net_amt;
							 nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d_upd_net_charge_amt;
							 nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d_upd_disc_amt;
							 nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d_addl_charge_amt_in_charge;
							}
									 				
							end_of_report=1;
						  }
						 else
						  {
						
							 nd_net_total=nd_net_total+nd_pat_net_amt2;
							 nd_gross_total=nd_gross_total+nd_pat_gross_amt1+nd_pat_gross_amt2;
							 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;
							 
					         if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 {
							  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							  {
							   if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0)  //chnged from R to C by vani
							   {
								get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
								print_formated_amt1(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt);
							   }
							   else
							   fprintf(fp,"%-11.11s"," ");
							    
							  }
							  
							   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N')
						       fprintf(fp,"%-11.11s"," ");
			
							 }
						
						
							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							 {
							  if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
							  {
							   
							  print_formated_amt(nd_pat_gross_amt1-nd_inside_pkg_gross_amt);
							  }
							 }

							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							 {
							  if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
							  print_formated_amt(nd_pat_net_amt2-nd_inside_pkg_net_amt);
						     }

							 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							 {
							  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function				
							  {
								get_discount_count();
							   if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							   {
							    if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
							    print_formated_amt(nd_pat_disc_amt1-nd_inside_pkg_disc_amt);
							   }
							  }
							  
							  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)	
							  {
							      if(p_disc_amt_in_dtl_yn.arr[0]=='N')
								  {
							       if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
								   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
								   fprintf(fp,"%-9.9s"," ");
								   print_formated_amt(nd_serv_tot_disc);
								  }
								  else
								  {
									print_formated_amt(nd_serv_charge_discount);
									print_formated_amt(nd_serv_bill_discount);
									print_formated_amt(nd_serv_fund_adjustment);
								  }

							  }
							 
							 }
							
					        if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
							 print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt));
							 else
							 {
							  if(strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
							  print_formated_amt(nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt);
							 }
							 //fprintf(fp,"\n");commented on 20/3/2008 for removing space b/w records
							}
							 nd_pat_gross_amt1=0;
							 nd_pat_net_amt2=0;
							 nd_pat_disc_amt1=0;
							 nd_upd_net_charge_amt=0;
							 nd_total_addl_charge_by_service=0;
							 nd_serv_charge_discount=0;
							 nd_serv_bill_discount=0;
							 nd_serv_fund_adjustment=0;
							 nd_serv_tot_disc=0;
							 nd_inside_pkg_gross_amt=0;
							 nd_inside_pkg_net_amt=0;
							 nd_inside_pkg_amtpayable_amt=0;
							 nd_inside_pkg_disc_amt=0;
							 nd_inside_pkg_addchrg_amt=0;
													 
							
							 get_print_group_hd_desc3();
							 get_print_group_line_desc3();

							
							if( nd_package_trx_yn.arr[0] == 'N'|| (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')    //added by vani
								{
							
								 print_bold_underline();
								 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
								 Release_bold_underline(); 
								 
								}
								}
							
								if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
								{
									if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
									{
										if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
										{
										fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
										fprintf(fp,"%-11.11s %-20.20s   "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr);

									}
									else
									{
										if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
										{
										fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
										fprintf(fp,"%-11.11s %-20.20s   "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr);

									}
								}
								else
								{
									if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
									{
									fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);//RAGHAVA
									fprintf(fp,"%-11.11s %-26.26s    "," "," ");//RAGHAVA
									}
									else
									fprintf(fp,"\n%-11.11s %-26.26s    "," ",nd_prt_hd_desc.arr);//RAGHAVA

								}
								 //fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_hd_desc.arr);
								 //fprintf(fp,"\n%-23.23s    %-23.23s",nd_prt_hd_desc.arr," ");	
								 lsr_line_cnt();
							}  

						/********added by vani*********/
						if (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0)
							{
								strcpy(d_grp_code,d_prt_grp_hdr_code.arr);
								get_grp_pkg_outside_cnt1(d_grp_code);

								if (l_grp_pkg_inside_cnt!=0)
								{
									if (l_lsr != 0 && l_dmp == 0)
										{
										if( l_logo_yniflaser.arr[0] != 'Y')   
										{
									
										 print_bold_underline();
										 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
										 Release_bold_underline(); 
										 
										}
										}
										
										if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
										{
											if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
												{
												fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s %-20.20s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr);

											}
											else
											{
												if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
												{
												fprintf(fp,"\n%-11.11s %s   \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s %-20.20s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s %-20.20s   "," ",nd_prt_hd_desc.arr);

											}
										}
										else
										{
											if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
											{
											fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);//RAGHAVA
											fprintf(fp,"%-11.11s %-26.26s    "," "," ");//RAGHAVA
											}
											else
											fprintf(fp,"\n%-11.11s %-26.26s    "," ",nd_prt_hd_desc.arr);//RAGHAVA

										}
										 //fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_hd_desc.arr);
										 //fprintf(fp,"\n%-23.23s    %-23.23s",nd_prt_hd_desc.arr," ");	
										 lsr_line_cnt();
									}  

								
							}
	
							/********upto here****/

							 nd_upd_net_charge_amt=nd_upd_net_charge_amt+d_upd_net_charge_amt;    //total service AmtPayable
							 nd_net_payable=nd_net_payable+d_upd_net_charge_amt;				  //total AmtPayable	

							 nd_total_addl_charge_by_service = nd_total_addl_charge_by_service+d_addl_charge_amt_in_charge; //Total Additional Charge By Service
					         nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge;						   //Total Additional Charge
							
							/*******For CRF-440(Discount Document Report)*******/

							nd_serv_tot_disc=nd_serv_tot_disc+d_tot_disc;							//Service Wise Total Discount
							nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;					//Grand Total Discount

							nd_serv_charge_discount=nd_serv_charge_discount+d_charge_discount;			//Service Wise Total Charge Discount
							nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount

							nd_serv_bill_discount=nd_serv_bill_discount+d_bill_discount;				//Service Wise Total Bill Discount
							nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount

							nd_serv_fund_adjustment=nd_serv_fund_adjustment+d_fund_adjustment;			//Service Wise Total Fund(policy) Discount
							nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount

							/*******CRF-440 *******/

							 get_gross_net_amt1();
							 
							 nd_pat_gross_amt1=nd_pat_gross_amt1+p_gross_amt;		//total service gross
							 nd_pat_net_amt2=nd_pat_net_amt2+p_net_amt;				//total service Net	
						     nd_pat_disc_amt1=nd_pat_disc_amt1+d_upd_disc_amt;		//total service discount
							 //nd_pat_disc_amt1=nd_pat_disc_amt1+p_disc_amt;	    //total service discount

							if(d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
							{
							
							  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_gross_amt;
							  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_net_amt;
							  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d_upd_net_charge_amt;
							  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+nd_pat_disc_amt1;
							  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d_addl_charge_amt_in_charge;
							}
							
							 end_of_report=1;
						  }
						  
						   
					  }
						
			   }//summary end
					
						
			else
			   {
			

				 if(strcmp(d_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr)!=0 || strcmp(d_prt_grp_line_code.arr,nd_prt_grp_line_code.arr)!=0)
				 {
					
			
					if(nd_summary_dtl_ind.arr[0]=='S')
					{
				
						//nd_upd_net_charge_amt=0;
						nd_net_total=nd_net_total+nd_pat_net_amt2;
						nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
						nd_disc_total=nd_disc_total+nd_pat_disc_amt1;
						
					  	if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					    {
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0)  //changed from R to C by vani
							 {
								get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
					  		  print_formated_amt1(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt);
							  }
							 else
							 fprintf(fp,"%-11.11s"," ");
							 
							}
							
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N')
							fprintf(fp,"%-11.11s"," ");
						
						}
						
						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						{
						 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
						 {
						 
						 print_formated_amt(nd_pat_gross_amt1-nd_inside_pkg_gross_amt);
						 }
					    }

						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						{
						 if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt2-nd_inside_pkg_net_amt);
						}
													
						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
						 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
						 {
						  get_discount_count();
						  if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							{
						   if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
						   print_formated_amt(nd_pat_disc_amt1-nd_inside_pkg_disc_amt);
						  }
						 }

						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
						 {
						   if(p_disc_amt_in_dtl_yn.arr[0]=='N')
						   {
						    if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
						    fprintf(fp,"%-9.9s"," ");
							print_formated_amt(nd_serv_tot_disc);
						   }
						   else
						   {
							print_formated_amt(nd_serv_charge_discount);
							print_formated_amt(nd_serv_bill_discount);
							print_formated_amt(nd_serv_fund_adjustment);
						   }
						 }
					
						}
						
					   if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					   {
					    if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
						 print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt));
						else
						if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					     print_formated_amt(nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt);
					   }
					
						nd_upd_net_charge_amt=0;
						nd_total_addl_charge_by_service=0;
						nd_serv_charge_discount=0;
						nd_serv_bill_discount=0;
						nd_serv_fund_adjustment=0;
						nd_serv_tot_disc=0;
						nd_inside_pkg_gross_amt=0;
						nd_inside_pkg_net_amt=0;
						nd_inside_pkg_amtpayable_amt=0;
						nd_inside_pkg_disc_amt=0;
						nd_inside_pkg_addchrg_amt=0;

					}

					 get_print_group_hd_desc3();
					 get_print_group_line_desc3();
					 get_blng_serv_desc();
					 //added by raghava on 18/03/2008
					 
					 if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					 if(nd_summary_dtl_ind.arr[0] == 'S')
					 {
					  fprintf(fp,"\n");
					  lsr_line_cnt();
					 }
					
					 /*Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e don't print the detail title description)	
					  fprintf(fp,"\n%-s/%-20s \n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
					  Up to here*/

					//lsr_line_cnt();lsr_line_cnt();
					//fprintf(fp,"\n%-2s-%-3s\n",d_prt_grp_hdr_code.arr,d_prt_grp_line_code.arr);
					//fprintf(fp,"\n%-s/%-3s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
				
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					if (l_lsr != 0 && l_dmp == 0)
					{
					if( l_logo_yniflaser.arr[0] != 'Y')
					{
				
					 print_bold_underline();
					 fprintf(fp,"%-s/%-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); //by vani
					 lsr_line_cnt();
					 Release_bold_underline();
					}
					}
					
					/********aded by vani***********/

					if (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0)  
						{													
								strcpy(d_grp_code,d_prt_grp_hdr_code.arr);
								get_grp_pkg_outside_cnt1(d_grp_code);

								if (l_grp_pkg_inside_cnt!=0)
								{
									if (l_lsr != 0 && l_dmp == 0)
									   {
									   if( l_logo_yniflaser.arr[0] != 'Y')
										{
										  print_bold_underline();
										  fprintf(fp,"\n%-s/%-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
										  lsr_line_cnt();
										  Release_bold_underline();
										}
										}
								 }

						}

						/********upto here*******/
					

									
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					{
						
						if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
						{
					
							if (d_summary_dtl_ind.arr[2] == 'S') 
							{
							//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
							  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
							  {
							  fprintf(fp," %-10.10s %s \n",d_blng_serv_code.arr,nd_blng_desc.arr);   //,d_serv_item_code.arr);
							  fprintf(fp," %-10.10s %-14.14s "," "," ");   //,d_serv_item_code.arr);
							  }
							  else
							  fprintf(fp," %-10.10s %-14.14s ",d_blng_serv_code.arr,nd_blng_desc.arr);   //,d_serv_item_code.arr);

							 }
							if (d_summary_dtl_ind.arr[2] == 'A') 
							{
								if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								{
								fprintf(fp," %-10.10s %s \n",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);
								fprintf(fp," %-10.10s %-14.14s "," "," "); //,d_serv_item_code.arr);
								}
								else
								fprintf(fp," %-10.10s %-14.14s ",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);


							}
							//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);
							//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_serv_anal_grp.arr,nd_blng_desc.arr,d_serv_item_code.arr);
						}
						else
						{
						
							 if (d_summary_dtl_ind.arr[2] == 'S') 
							 {
								  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								  {
								  fprintf(fp," %-10.10s %s\n",d_blng_serv_code.arr,nd_blng_desc.arr);		//,d_serv_item_code.arr);
								  fprintf(fp," %-10.10s %-30.30s"," "," ");		//,d_serv_item_code.arr);
								  }
								  else
								  fprintf(fp," %-10.10s %-30.30s",d_blng_serv_code.arr,nd_blng_desc.arr);		//,d_serv_item_code.arr);

							  }
							 if (d_summary_dtl_ind.arr[2] == 'A') 
							 {
								  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								  {
								  fprintf(fp," %-10.10s %s\n",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);
								  fprintf(fp," %-10.10s %-30.30s"," "," "); //,d_serv_item_code.arr);
								  }
								  else
								  fprintf(fp," %-10.10s %-30.30s",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);

							  }
						
						}
					}

				  }
				  else
				  {
					
					if(nd_summary_dtl_ind.arr[0]=='S')
					{
					

						//nd_upd_net_charge_amt=0;
						nd_net_total=nd_net_total+nd_pat_net_amt2;
						nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
						nd_disc_total=nd_disc_total+nd_pat_disc_amt1;
						
					    if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0) //changed from  R to C by vani
							 {
							 get_addlcharge_count();
							 if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
							 print_formated_amt1(nd_total_addl_charge_by_service-(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt));
							 }
							 else
							 fprintf(fp,"%-11.11s"," ");
							 
							}

							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N')
							fprintf(fp,"%-11.11s"," ");

						}
						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						{
						 if(strcmp(p_gross_net_amt_ind.arr,"G")==0)
						 {
						
						 print_formated_amt(nd_pat_gross_amt1-nd_inside_pkg_gross_amt);
						 }
						}
						
						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						{
						 if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
						 print_formated_amt(nd_pat_net_amt2-nd_inside_pkg_net_amt);
						}
					
						if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						{
						 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
						 {
						  get_discount_count();
						 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
						 {
						  if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
						  print_formated_amt(nd_pat_disc_amt1-nd_inside_pkg_disc_amt);
						  }
						 }

						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
						 {
						   if(p_disc_amt_in_dtl_yn.arr[0]=='N')
						   {
							if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
							fprintf(fp,"%-9.9s"," ");
							print_formated_amt(nd_serv_tot_disc);
						   }
						   else
						   {
							print_formated_amt(nd_serv_charge_discount);
							print_formated_amt(nd_serv_bill_discount);
							print_formated_amt(nd_serv_fund_adjustment);
						   }
						 }
					
						}
					    	
					   if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					   { 
						if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
					    print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-nd_total_addl_charge_by_service);
						else
					    {
						 if(strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
						 print_formated_amt(nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt);
						}
					   }
						nd_upd_net_charge_amt=0;
						nd_total_addl_charge_by_service=0;
						nd_serv_charge_discount=0;
						nd_serv_bill_discount=0;
						nd_serv_fund_adjustment=0;
						nd_serv_tot_disc=0;
						nd_inside_pkg_gross_amt=0;
						nd_inside_pkg_net_amt=0;
						nd_inside_pkg_amtpayable_amt=0;
						nd_inside_pkg_disc_amt=0;
						nd_inside_pkg_addchrg_amt=0;
					}

					get_blng_serv_desc();
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					{
						
						if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
						{
							if (d_summary_dtl_ind.arr[2] == 'S') 
							{
							//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_blng_serv_code.arr,nd_blng_desc.arr,d_serv_item_code.arr);
							  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
							  {
							  fprintf(fp," %-10.10s %s\n",d_blng_serv_code.arr,nd_blng_desc.arr);  //,d_serv_item_code.arr);
							  fprintf(fp," %-10.10s %-14.14s "," "," ");  //,d_serv_item_code.arr);
							  }
							  else
							  fprintf(fp," %-10.10s %-14.14s",d_blng_serv_code.arr,nd_blng_desc.arr);  //,d_serv_item_code.arr);

							 }
							if (d_summary_dtl_ind.arr[2] == 'A') 
							{
							  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
							  {
							  fprintf(fp," %-10.10s %s \n",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);
							  fprintf(fp," %-10.10s %-14.14s "," "," "); //,d_serv_item_code.arr);
							  }
							  else
							  fprintf(fp," %-10.10s %-14.14s ",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);

							 }
						//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_mapping_code.arr,nd_mapping_code_desc.arr,d_serv_item_code.arr);
						//fprintf(fp," %-12.12s %-18.18s %-17.17s",d_serv_anal_grp.arr,nd_blng_desc.arr,d_serv_item_code.arr);
						}
						else
						{
						
							if (d_summary_dtl_ind.arr[2] == 'S') 
							{
							  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
							  {
							  fprintf(fp," %-10.10s %s \n",d_blng_serv_code.arr,nd_blng_desc.arr); //,d_serv_item_code.arr);
							  fprintf(fp," %-10.10s %-30.30s "," "," "); //,d_serv_item_code.arr);
							  }
							  else
							  fprintf(fp," %-10.10s %-30.30s ",d_blng_serv_code.arr,nd_blng_desc.arr); //,d_serv_item_code.arr);

							 }
							if (d_summary_dtl_ind.arr[2] == 'A') 
							{
								  if (strcmp(p_serv_desc_sep_line_yn.arr,"Y")==0)
								  {
								  fprintf(fp," %-10.10s %s \n",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);
								  fprintf(fp," %-10.10s %-30.30s "," "," "); //,d_serv_item_code.arr);
								  }
								  else
								  fprintf(fp," %-10.10s %-30.30s ",d_mapping_code.arr,nd_mapping_code_desc.arr); //,d_serv_item_code.arr);

							 }
						
						}
					}
									
				  }
								
					get_gross_net_amt1();

					nd_net_total=nd_net_total+p_net_amt;
					nd_gross_total=nd_gross_total+p_gross_amt;
					nd_disc_total=nd_disc_total+d_upd_disc_amt;
					//nd_disc_total=nd_disc_total+p_disc_amt;
								
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					{
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						{
							if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0)  //changed by vani from R to C
							{
								get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
								print_formated_amt1(d_addl_charge_amt_in_charge);
							}
							
							else
							{
								if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
								{
								 fprintf(fp,"%-16.16s",d_service_date.arr);  //addded by vani for printing service date
								 print_formated_qty(d_serv_qty);
								 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0) //for - crf-659
								 print_formated_amt(d_rate);
								}
								else
							    fprintf(fp,"%-11.11s"," "); 
								
								
							}
						}
						if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
						{
							if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
							{
							 fprintf(fp,"%-16.16s",d_service_date.arr);  //addded by vani for printing service date
							 print_formated_qty(d_serv_qty);
							 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0) //for - crf-659
							 print_formated_amt(d_rate);
							}
							else
							{
							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N')
							 fprintf(fp,"%-11.11s"," "); 
							}
					
						}
					
					}
					
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					{
					 if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
					 {
					 
					 print_formated_amt(p_gross_amt);
					 }
					}
					
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					{
					 if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
					 print_formated_amt(p_net_amt);
					}

					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					{
					 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
					 {
					 get_discount_count();
					 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
					 {
					  if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
					  print_formated_amt(d_upd_disc_amt);
					  }
					 }

					 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
					 {
					   if(p_disc_amt_in_dtl_yn.arr[0]=='N')
					   {
					    //if (strcmp(p_servdate_in_dtlformat_yn.arr,"N")==0)
						print_formated_amt(d_tot_disc);
					   }
					   else
					   {
					    print_formated_amt(d_charge_discount);
					    print_formated_amt(d_bill_discount);
					    print_formated_amt(d_fund_adjustment);
					   }
					 }

					}
					
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					{
					 if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
					  print_formated_amt(d_upd_net_charge_amt-d_addl_charge_amt_in_charge);
				
					 else
					 {
					  if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
					  print_formated_amt(d_upd_net_charge_amt);
					 }
					}
					
					nd_total_addl_charge=nd_total_addl_charge+d_addl_charge_amt_in_charge; //Total Additional Charge For Detail Part
					nd_net_payable=nd_net_payable+d_upd_net_charge_amt;					   //Total Amt Paybale For Detail Part
				
					nd_tot_serv_tot_disc=nd_tot_serv_tot_disc+d_tot_disc;				//Grand Total Discount
					nd_tot_serv_charge_discount=nd_tot_serv_charge_discount+d_charge_discount;	//Grand Total Charge Discount
					nd_tot_serv_bill_discount=nd_tot_serv_bill_discount+d_bill_discount;		//Grand Total Bill Discount
					nd_tot_serv_fund_adjustment=nd_tot_serv_fund_adjustment+d_fund_adjustment;	//Grand Total Fund(policy) Discount
					
					
					if(d_package_trx_yn.arr[0] == 'N' || (d_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					 fprintf(fp,"\n");
					 lsr_line_cnt();

					ccnt=0;
					nd_pat_gross_amt1=0;
					nd_pat_net_amt2=0;
					nd_pat_disc_amt1=0;
					nd_upd_net_charge_amt=0;
					nd_total_addl_charge_by_service=0;
					nd_serv_charge_discount=0;
					nd_serv_bill_discount=0;
					nd_serv_fund_adjustment=0;
					nd_serv_tot_disc=0;
					end_of_report=0;
				 }
				
				/*** added by vani for printing PH Batch Details*******/
				if(strcmp(d_mapping_code_ind.arr,"M")==0 && strcmp(d_folio_batch_id.arr,"\0")!=0)
				{
				if(d_summary_dtl_ind.arr[0] == 'D') 
				get_ph_batch_details();
				}
				/*********End of Batch Id*******/
		  
			   strcpy(nd_prt_grp_hdr_code.arr,d_prt_grp_hdr_code.arr);
			   strcpy(nd_prt_grp_line_code.arr,d_prt_grp_line_code.arr);
			   strcpy(nd_payer_serv_grp_hdr.arr,d_payer_serv_grp_hdr.arr);
			   strcpy(nd_payer_serv_grp_line.arr,d_payer_serv_grp_line.arr);
			   strcpy(nd_blng_serv_code.arr,d_blng_serv_code.arr); //ADDED AT 29/10/2007
			   strcpy(nd_serv_anal_grp.arr,d_serv_anal_grp.arr); 
			   strcpy(nd_summary_dtl_ind.arr,d_summary_dtl_ind.arr);
			   strcpy(nd_package_trx_yn.arr,d_package_trx_yn.arr);
		  
		  
		  }
		 else
			{  					
				 oth_cnt=oth_cnt+1;
				 if (strcmp(d_cust_code1.arr,nd_cust_code1.arr)==0)
				 {
				   
				   nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
				   nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;

				 }
				 else
				 {

					if (oth_cnt==1)
					{					
					  nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
					  nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;
				
					}
					else
					{
					  //nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;

						/*** Below Code Added for CRF-659 ***/
						l_cust_code.arr[0] ='\0';
						l_cust_code.len = 0;
						strcpy(l_cust_code.arr,nd_cust_code1.arr);
						l_cust_code.len=strlen(nd_cust_code1.arr);
						l_cust_code.arr[l_cust_code.len]='\0';
						get_bill_num(2);
						strcpy(bill_code[k],l_bill_num_temp.arr);       
						/*** Up To Here ***/
						
						strcpy(ar_cust_amt[k],nd_cust_nm.arr);
						put_val(ar_amt[k],nd_oth_payer_amt); 
						format_amt(ar_amt[k]);
						sprintf(st_var,"%d",k);
							
						nd_oth_payer_amt=0;
						nd_oth_payer_amt=nd_oth_payer_amt+d_upd_net_charge_amt;
						nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+d_upd_net_charge_amt;
						k=k+1;

					}
					
				 }
				 
				ccnt=0;
				nd_cust_code1.arr[0] ='\0';
				nd_cust_code1.len = 0;
				l_bill_num_temp.arr[0]='\0';
			    l_bill_num_temp.len=0;
				strcpy(nd_cust_code1.arr,d_cust_code1.arr);

				fetch_customer1();
				strcpy(nd_cust_nm.arr,d_customer2.arr);

			    /*** Below Code Added for CRF-659 ***/
			    strcpy(l_cust_code.arr,d_cust_code1.arr);
			    l_cust_code.len=strlen(d_cust_code1.arr);
			    l_cust_code.arr[l_cust_code.len]='\0';
			    
							
				get_bill_num(2);
			   //disp_message(ERR_MESG,l_bill_num.arr);
			    strcpy(bill_code[0],l_bill_num.arr); 
				strcpy(l_bill_num_temp.arr,l_bill_num.arr); 
			   //disp_message(ERR_MESG,l_bill_num_temp.arr);
			    /*** Up To Here ***/

			  //nd_cust_code1.arr[nd_cust_code1.len]='\0';


		   }
		   
		  //strcpy(nd_cust_code1.arr,d_cust_code1.arr);
	   
	   /*
	   strcpy(nd_prt_grp_hdr_code.arr,d_prt_grp_hdr_code.arr);
	   strcpy(nd_prt_grp_line_code.arr,d_prt_grp_line_code.arr);
	   strcpy(nd_payer_serv_grp_hdr.arr,d_payer_serv_grp_hdr.arr);
	   strcpy(nd_payer_serv_grp_line.arr,d_payer_serv_grp_line.arr);
	   strcpy(nd_blng_serv_code.arr,d_blng_serv_code.arr); //ADDED AT 29/10/2007
	   strcpy(nd_serv_anal_grp.arr,d_serv_anal_grp.arr); 
	   strcpy(nd_summary_dtl_ind.arr,d_summary_dtl_ind.arr);
	   strcpy(nd_package_trx_yn.arr,d_package_trx_yn.arr);
	   */

	}


}
/* THIS FUNCTION WILL PRINT PATIENT BILL WITH  SUBSIDIZED AMT */

print_patient_hdr()
 {


	 if (strcmp(d1_cust_code1.arr,"\0")==0)
	  {

		 if (d1_summary_dtl_ind.arr[0] == 'S')  
		  {
			
			  //sprintf(st_var,"%d",ccnt);
			  //disp_message(ERR_MESG,st_var);
				if( ccnt==1)
				 {
                       
						get_print_group_hd_desc();  
						get_print_group_line_desc();
						//get_blng_serv_desc1();

					 if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					  {	
						if(nd2_summary_dtl_ind.arr[0] == 'D')
					    {
						    
							if(d1_summary_dtl_ind.arr[1] == 'L') 
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								print_bold_underline();
								fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
								Release_bold_underline();
								fprintf(fp,"\n");
								}
								}
						
								if(l_no_of_clumns ==5)
								{
									
									if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
									{
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
										fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s %-61.61s    "," "," ");
										}
										else
										fprintf(fp,"%-11.11s %-61.61s    "," ",nd_prt_line_desc.arr);
									}
									else
									{
										if (strcmp(c_addl_charge_amt_ind.arr,"C")==0)
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
											fprintf(fp,"%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
											fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
											}
											else
											fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_line_desc.arr);
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
											fprintf(fp,"%-11.11s  %34.34s   \n"," ",nd_prt_line_desc.arr);
											fprintf(fp,"%-11.11s  %-34.34s   "," ",nd_prt_line_desc.arr);
											}
											else
											fprintf(fp,"%-11.11s  %-34.34s   "," ",nd_prt_line_desc.arr);
										}
									}
								}
								else
								{
								if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
								{
								  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
								  {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"%-11.11s%s\n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s%-50.50s"," "," ");	
									}
									else
									fprintf(fp,"%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
								  }
								  else
								  {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
										fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
									}
									else
									fprintf(fp,"%-11.11s   %-29.29s  "," ",nd_prt_line_desc.arr);
								  }
								}
								else
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
									}
									else
									fprintf(fp,"%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
								}
								}
								//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
								//fprintf(fp,"%-19.19s / %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
								
							}
							else
							{
							
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								print_bold_underline();
								fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								Release_bold_underline();
								fprintf(fp,"\n");
								}
								}
								else
								{
								
							    fprintf(fp,"%-s\n",nd_prt_hd_desc.arr);
								}
							
								if(l_no_of_clumns ==5)
								{
								
								  if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
								  {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);
										fprintf(fp,"%-11.11s %-61.61s    "," "," ");
									}
									else
									fprintf(fp,"%-11.11s %-61.61s    "," ",nd_prt_hd_desc.arr);
								  }
								  else
								  {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
										fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
									}
									else
									fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
								  }
								}
								else
								{
										
								  if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
								  {
									  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
									  {
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
											fprintf(fp,"%-11.11s%-50.50s"," "," ");
										}
										else
										fprintf(fp,"%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
									  }
									  else
									  {
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
											fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
										}
										else
										fprintf(fp,"%-11.11s   %-29.29s  "," ",nd_prt_hd_desc.arr);
									  }
								  }
								  else
								  {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
										fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
									}
									else
									fprintf(fp,"%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
								  }

								}
							   //fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
							}
						}
						else
						{
							if(d1_summary_dtl_ind.arr[1] == 'L') 
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								print_bold_underline();
								fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
								Release_bold_underline();
								}
								}
														
								if(l_no_of_clumns ==5)
								{
									if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
									{
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
											fprintf(fp,"%-11.11s  %-61.61s   "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s  %-61.61s   "," ",nd_prt_line_desc.arr);
										//fprintf(fp,"\n%-11.11s  %-37.37s   "," ",nd_prt_line_desc.arr);
									}
									else
									{
										if (strcmp(c_addl_charge_amt_ind.arr,"C")==0)
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_line_desc.arr);
											 }
											else
											fprintf(fp,"\n%-11.11s  %-23.23s   "," "," ");
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s  %-26.26s   "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s  %-26.26s   "," ",nd_prt_line_desc.arr); 
										}
									}
								
								}
								else
								{
									if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
									{
										if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s%-50.50s"," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-29.29s  "," ",nd_prt_line_desc.arr);
										}
									}
									else
									{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
									}
								}
								//fprintf(fp,"\n%-19.19s    %-19.19s",nd_prt_line_desc.arr," ");
								//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
								//fprintf(fp,"\n%-19.19s / %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
								
							}
							else
							{
								if (l_lsr != 0 && l_dmp == 0)
								{
								if( l_logo_yniflaser.arr[0] != 'Y')
								{
								
								print_bold_underline();
								fprintf(fp,"%-s",nd_prt_hd_desc.arr);
								Release_bold_underline();
								//fprintf(fp,"\n");
								}
								}
									
								if(l_no_of_clumns ==5)
								{								 
									if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
									{
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
											fprintf(fp,"%-11.11s  %-61.61s   "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s  %-61.61s   "," ",nd_prt_hd_desc.arr);
										//fprintf(fp,"\n%-11.11s  %-37.37s   "," ",nd_prt_hd_desc.arr);
									}
									else
									{
										
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
											fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
										}
										else
										fprintf(fp,"\n%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
									}
								
								}
								else
								{
									if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
									{
										if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s%-50.50s"," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
											}
											fprintf(fp,"\n%-11.11s   %-29.29s  "," ",nd_prt_hd_desc.arr);
										}
									}
									else
									{
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
											fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
									}
									
									lsr_line_cnt();
									//fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
									
								}
							}
						
						 }
					   }

					/*******added by vani**********/
					if(d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) 
					 {
							strcpy(d_grp_code,d1_prt_grp_hdr_code.arr);
							get_grp_pkg_outside_cnt(d_grp_code);
							if (l_grp_pkg_inside_cnt!=0)
							{
									if(nd2_summary_dtl_ind.arr[0] == 'D')
								{
									
									if(d1_summary_dtl_ind.arr[1] == 'L') 
									{
										if (l_lsr != 0 && l_dmp == 0)
										{
										if( l_logo_yniflaser.arr[0] != 'Y')
										{
										print_bold_underline();
										fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
										Release_bold_underline();
										fprintf(fp,"\n");
										}
										}
								
										if(l_no_of_clumns ==5)
										{
											
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s %-61.61s    "," "," ");
												}
												else
												fprintf(fp,"%-11.11s %-61.61s    "," ",nd_prt_line_desc.arr);
											}
											else
											{
												if (strcmp(c_addl_charge_amt_ind.arr,"C")==0)
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
													}
													else
													fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_line_desc.arr);
												}
												else
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s  %-34.34s   "," ",nd_prt_line_desc.arr);
													}
													else
													fprintf(fp,"%-11.11s  %-34.34s   "," ",nd_prt_line_desc.arr);
												}
											}
										}
										else
										{
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
											{
												if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"%-11.11s%s\n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s%-50.50s"," "," ");
													}
													else
													fprintf(fp,"%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
												}
												else
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
													}
													else
													fprintf(fp,"%-11.11s   %-29.29s  "," ",nd_prt_line_desc.arr);
												}
											}
										else
										  {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s   %-26.26s  "," "," ");	
												}
												else
												fprintf(fp,"%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
										  }
										}
										//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
										//fprintf(fp,"%-19.19s / %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
										
									}
									else
									{
									
										if (l_lsr != 0 && l_dmp == 0)
										{
										if( l_logo_yniflaser.arr[0] != 'Y')
										{
										print_bold_underline();
										fprintf(fp,"%-s",nd_prt_hd_desc.arr);
										Release_bold_underline();
										fprintf(fp,"\n");
										}
										}
										else
										{
										
										fprintf(fp,"%-s\n",nd_prt_hd_desc.arr);
										}
									
										if(l_no_of_clumns ==5)
										{
										
										  if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
										  {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s %s    \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s %-61.61s    "," "," ");
												}
												else
												 fprintf(fp,"%-11.11s %-61.61s    "," ",nd_prt_hd_desc.arr);
										  }
										  else
										  {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
												}
												else
												fprintf(fp,"%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
										  }
										}
										else
										{
												
										  if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										  {
											  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											  {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s%-50.50s"," "," ");
												}
												else
												fprintf(fp,"%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
											  }
											  else
											  {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
												}
												else
												fprintf(fp,"%-11.11s   %-29.29s  "," ",nd_prt_hd_desc.arr);
											  }
										  }
										  else
										  {
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
											}
											else
											fprintf(fp,"%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
										   }

										}
									   //fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
									}
								}
								else
								{
									if(d1_summary_dtl_ind.arr[1] == 'L') 
									{
										if (l_lsr != 0 && l_dmp == 0)
										{
										if( l_logo_yniflaser.arr[0] != 'Y')
										{
										print_bold_underline();
										fprintf(fp,"%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
										Release_bold_underline();
										}
										}
																
										if(l_no_of_clumns ==5)
										{
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s  %-61.61s   "," "," ");	
												}
												else
												fprintf(fp,"\n%-11.11s  %-61.61s   "," ",nd_prt_line_desc.arr);
												//fprintf(fp,"\n%-11.11s  %-37.37s   "," ",nd_prt_line_desc.arr);
											}
											else
											{
												if (strcmp(c_addl_charge_amt_ind.arr,"C")==0)
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s  %-23.23s   "," ",nd_prt_line_desc.arr);
												}
												else
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s  %-26.26s   "," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s  %-26.26s   "," ",nd_prt_line_desc.arr);
												}
											}
										
										}
										else
										{
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
											{
												if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s%-50.50s"," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
												}
												else
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
														fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
												 }
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
											}
										}
										//fprintf(fp,"\n%-19.19s    %-19.19s",nd_prt_line_desc.arr," ");
										//Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
										//fprintf(fp,"\n%-19.19s / %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
										
									}
									else
									{
										if (l_lsr != 0 && l_dmp == 0)
										{
										if( l_logo_yniflaser.arr[0] != 'Y')
										{
										
										print_bold_underline();
										fprintf(fp,"%-s",nd_prt_hd_desc.arr);
										Release_bold_underline();
										//fprintf(fp,"\n");
										}
										}
											
										if(l_no_of_clumns ==5)
										{								 
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{	
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-61.61s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s  %-61.61s   "," ",nd_prt_hd_desc.arr);
												//fprntf(fp,"\n%-11.11s  %-37.37s   "," ",nd_prt_hd_desc.arr);
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
											}
										
										}
										else
										{
											if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
											{
												if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
														fprintf(fp,"%-11.11s%-50.50s"," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
												}
												else
												{
													if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
													{
														fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
														fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
													}
													else
													fprintf(fp,"\n%-11.11s   %-29.29s  "," ",nd_prt_hd_desc.arr);
												}
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
											}
											//fprintf(fp,"\n%-19.19s    %-19.19s",nd_prt_hd_desc.arr," ");	
											lsr_line_cnt();
											//fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
											
										}
									}
								
								 }


									}
					
					  }

					  /********upto here*********/

						get_gross_net_amt();

					 									
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						//nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;        total service discount
						nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;         //total service discount

						nd1_tot_serv_qty=nd1_tot_serv_qty+d1_serv_qty;        //Total Rate by Service wise
						nd1_grd_tot_serv_qty=nd1_grd_tot_serv_qty+d1_serv_qty;  //Grand Total Rate by Service wise
						
						nd1_tot_rate=nd1_tot_rate+d1_rate;          //Total Rate by Service wise
						nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise
						
						nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;        //total Addl Charge by service
						nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Addl Charge Amt
						
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;         //total service Amtpayble 
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt; //total Amtpayble 
						
						
						if(d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{  
						
						  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_pat_gross_amt;
						  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_pat_net_amt;
						  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d1_upd_net_charge_amt;
						  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d1_upd_disc_amt;
						  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d1_addl_charge_amt_in_charge;
						  sprintf(st_var,"%d",nd_inside_pkg_disc_amt);
						
						}
						
						/******* For CRF-440(Discount Document Report)********/

						nd1_serv_tot_disc=nd1_serv_tot_disc+d1_tot_disc;								//Service Wise Total Discount
						nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount

						nd1_serv_charge_discount=nd1_serv_charge_discount+d1_charge_discount;			//Service Wise Total Charge Discount
						nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount

						nd1_serv_bill_discount=nd1_serv_bill_discount+d1_bill_discount;					//Service Wise Total Bill Discount
						nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount

						nd1_serv_fund_adjustment=nd1_serv_fund_adjustment+d1_fund_adjustment;			//Service Wise Total Fund(policy) Discount
						nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount
												
						/********CRF-440 ***************/						
							
						end_of_report=1;	
					
				  }
				 else
				 if (d1_summary_dtl_ind.arr[1] == 'L') 
				  {
			
					
					  if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0
					  && strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0 && strcmp(d1_payer_serv_grp_line.arr,nd1_payer_serv_grp_line.arr)==0)
					   {
						
						 nd1_tot_serv_qty=nd1_tot_serv_qty+d1_serv_qty;        //Total Rate by Service wise
						 nd1_grd_tot_serv_qty=nd1_grd_tot_serv_qty+d1_serv_qty;  //Grand Total Rate by Service wise
												 
						 nd1_tot_rate=nd1_tot_rate+d1_rate;          //Total Rate by Service wise
						 nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise
						 
						 nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;        //total Addl Charge by service
						 nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Addl Charge Amt
											 
						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;
																	
					     
						/******* For CRF-440(Discount Document Report)********/

						nd1_serv_tot_disc=nd1_serv_tot_disc+d1_tot_disc;								//Service Wise Total Discount
						nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount

						nd1_serv_charge_discount=nd1_serv_charge_discount+d1_charge_discount;			//Service Wise Total Charge Discount
						nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount

						nd1_serv_bill_discount=nd1_serv_bill_discount+d1_bill_discount;					//Service Wise Total Bill Discount
						nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount

						nd1_serv_fund_adjustment=nd1_serv_fund_adjustment+d1_fund_adjustment;			//Service Wise Total Fund(policy) Discount
						nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount
												
						/********CRF-440 ***************/						
					
						 
						 get_gross_net_amt();
															 
						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 //nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          total service discount
						 nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;          //total service discount
						
						
						if(d_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{
						 
						  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_pat_gross_amt;
						  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_pat_net_amt;
						  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d1_upd_net_charge_amt;
						  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d1_upd_disc_amt;
						  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d1_addl_charge_amt_in_charge;
						}
						
																						
						 end_of_report=1; 
					   }
					  else
					   {

						 p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
					     p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
					     p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
						 
											 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						  if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						  {
							get_addlcharge_count();
							if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
							print_formated_amt2(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt);
						  }
						 }
				
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						  { 
						   if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						   {
						       print_formated_amt(nd_pat_gross_amt-nd_inside_pkg_gross_amt);
						   }
						  }
					
												 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						  {
						   if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						     print_formated_amt(nd_pat_net_amt1-nd_inside_pkg_net_amt);
						  }	
					
						 nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
						 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 {
							 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
							 {
							  get_discount_count();
							   if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							   {
							   if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
							   print_formated_amt(nd_pat_disc_amt-nd_inside_pkg_disc_amt);
							  }
							 }

							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
							 {
							  if(c_disc_amt_in_dtl_yn.arr[0]=='N')
							  {
							   if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
							   fprintf(fp,"%-18.18s"," ");
							   if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							   if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
							   fprintf(fp,"%-9.9s"," ");
							   print_formated_amt(nd1_serv_tot_disc);
							  }
							  else
							  {
							    print_formated_amt(nd1_serv_charge_discount);
								print_formated_amt(nd1_serv_bill_discount);
								print_formated_amt(nd1_serv_fund_adjustment);
							  }
							 }
						 }
						
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						  
						   if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0) 
						   {
							print_formated_amt((nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt)); // Amt Payble
						   }
						   else
						   {
						    if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						    print_formated_amt(nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt); // Amt Payble
						   }	
						  
						 }
						 
						 nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

					     if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						   if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
						   {
							get_subsidized_amt();
							if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
							print_formated_amt(nd_subdiv_amt);
						   }
					     }
						 
						 
						 //fprintf(fp,"\n"); commneted on 20/3/2008 for removing space b/w records


						 nd_pat_gross_amt=0;
						 nd_pat_net_amt1=0;
						 nd_pat_net_charge_amt=0;
						 nd_pat_addl_charge_amt=0;
						 nd1_serv_charge_discount=0;
						 nd1_serv_bill_discount=0;
						 nd1_serv_fund_adjustment=0;
						 nd1_serv_tot_disc=0;
						 nd1_tot_rate=0;
						 nd1_tot_serv_qty=0;
						 nd_subdiv_amt=0;
						 nd_inside_pkg_gross_amt=0;
						 nd_inside_pkg_net_amt=0;
						 nd_inside_pkg_amtpayable_amt=0;
						 nd_inside_pkg_disc_amt=0;
						 nd_inside_pkg_addchrg_amt=0;
					 	 						 
						 get_print_group_hd_desc();
						 get_print_group_line_desc();
						 
						 //Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e just print the printline description)	
						 //fprintf(fp,"\n%-19.19s -  %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	 
						 if (l_lsr != 0 && l_dmp == 0)
						 {
						  if( l_logo_yniflaser.arr[0] != 'Y')
						  {
							print_bold_underline();
							fprintf(fp,"\n%-s/%-s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
						    Release_bold_underline();
						  }
						
						}

						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 {
							 if(l_no_of_clumns ==5)
							 {
								 if ((strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0  && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)||strcmp(c_addl_charge_amt_ind.arr,"C")==0)
								 {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)	
									{
										fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s %-61.61s    "," "," ");
									}
									else		    					
									fprintf(fp,"\n%-11.11s %-61.61s    "," ",nd_prt_line_desc.arr);
									//fprintf(fp,"\n%-11.11s %-37.37s    "," ",nd_prt_line_desc.arr);
								 }
								 else
								 {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s   %-34.34s  "," "," ");
									}	
									else
									fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
								 }
							 }
							 else
							 {
								 if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
								 {
									 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
									 {
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_line_desc.arr);
											fprintf(fp,"%-11.11s%-50.50s"," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
									 }
									 else
									 {
										if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
										{
											fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
											fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
										}
										else
										fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
									 }
								 }
								 else
								 {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
										fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
									}
									else
									fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
								 }
								 lsr_line_cnt();
							 }
						 }

						/***********added by vani*********/
						if (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) 
						{
							
							strcpy(d_grp_code,d1_prt_grp_hdr_code.arr);
								get_grp_pkg_outside_cnt(d_grp_code);

								if (l_grp_pkg_inside_cnt!=0)
								{
									if(l_no_of_clumns ==5)
									 {
										 if ((strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 && strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0 )||strcmp(c_addl_charge_amt_ind.arr,"C")==0)
										 {
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s %s    \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s %-61.61s    "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s %-61.61s    "," ",nd_prt_line_desc.arr);
										 }
										 else
										 {
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s   %-34.34s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-34.34s  "," ",nd_prt_line_desc.arr);
										 }
									 }
									 else
									 {
										 if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										 {
											 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											 {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s%-50.50s"," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_line_desc.arr);
											 }
											 else
											 {
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
													fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s   %-29.29s  "," ",nd_prt_line_desc.arr);
											 }
										 }
										 else
										 {
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_line_desc.arr);
												fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_line_desc.arr);
										 }
										 lsr_line_cnt();
									 }

								}
						}
						
						/********upto here********/

						 //get_blng_serv_desc1();
						 //fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);

						 get_gross_net_amt();

						 nd1_tot_serv_qty=nd1_tot_serv_qty+d1_serv_qty;        //Total Rate by Service wise
						 nd1_grd_tot_serv_qty=nd1_grd_tot_serv_qty+d1_serv_qty;  //Grand Total Rate by Service wise
						
						 
						 nd1_tot_rate=nd1_tot_rate+d1_rate;          //Total Rate by Service wise
						 nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise

						 nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;        //total Addl Charge by service
						 nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Addl Charge Amt
								
						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;

						/******* For CRF-440(Discount Document Report)********/

						nd1_serv_tot_disc=nd1_serv_tot_disc+d1_tot_disc;								//Service Wise Total Discount
						nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount

						nd1_serv_charge_discount=nd1_serv_charge_discount+d1_charge_discount;			//Service Wise Total Charge Discount
						nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount

						nd1_serv_bill_discount=nd1_serv_bill_discount+d1_bill_discount;					//Service Wise Total Bill Discount
						nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount

						nd1_serv_fund_adjustment=nd1_serv_fund_adjustment+d1_fund_adjustment;			//Service Wise Total Fund(policy) Discount
						nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount
												
						/********CRF-440 ***************/						
							
											 
						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 //nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;        //total service discount	
						 nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;         //total service discount	
						
						if(d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{
						  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_pat_gross_amt;
						  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_pat_net_amt;
						  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d1_upd_net_charge_amt;
						  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d1_upd_disc_amt;
						  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d1_addl_charge_amt_in_charge;
						}
						
						
						 end_of_report=1;

					}

										   					    
				}

			  else
			  	{
														  
					  if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0) 
					   {
						
						 nd1_tot_serv_qty=nd1_tot_serv_qty+d1_serv_qty;        //Total Rate by Service wise
						 nd1_grd_tot_serv_qty=nd1_grd_tot_serv_qty+d1_serv_qty;  //Grand Total Rate by Service wise
						
						 nd1_tot_rate=nd1_tot_rate+d1_rate;          //Total Rate by Service wise
						 nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise
						 
						 nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;        //total Addl Charge by service
						 nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Addl Charge Amt
								
						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;
																	
					     
						 /******* For CRF-440(Discount Document Report)********/

						nd1_serv_tot_disc=nd1_serv_tot_disc+d1_tot_disc;								//Service Wise Total Discount
						nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount

						nd1_serv_charge_discount=nd1_serv_charge_discount+d1_charge_discount;			//Service Wise Total Charge Discount
						nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount

						nd1_serv_bill_discount=nd1_serv_bill_discount+d1_bill_discount;					//Service Wise Total Bill Discount
						nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount

						nd1_serv_fund_adjustment=nd1_serv_fund_adjustment+d1_fund_adjustment;			//Service Wise Total Fund(policy) Discount
						nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount
												
						/********CRF-440 ***************/						
							
					
						 get_gross_net_amt();
															 
						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 //nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          //total service discount
						 nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;          //total service discount
												
					 
										 
						 
						if(d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{
						
						  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_pat_gross_amt;
						  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_pat_net_amt;
						  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d1_upd_net_charge_amt;
						  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d1_upd_disc_amt;
						  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d1_addl_charge_amt_in_charge;
						}
						
						
						 end_of_report=1; 
					   }
					  else
					   {

						 p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
					     p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
					     p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
						 
												 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						   if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						   {
						    get_addlcharge_count();
							if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
						    print_formated_amt2(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt);
						   }
						 }
					
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						  if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						  {
						  
						  print_formated_amt(nd_pat_gross_amt-nd_inside_pkg_gross_amt);
						  }
					     }
												 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
					     if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						   if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						     print_formated_amt(nd_pat_net_amt1-nd_inside_pkg_net_amt);
						 }
					

						 nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
						 
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 {
							 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
							 {
							  get_discount_count();
							   if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							   {
							   if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
							   print_formated_amt(nd_pat_disc_amt-nd_inside_pkg_disc_amt);
							  }
							 }

							 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
							 {
							   if(c_disc_amt_in_dtl_yn.arr[0]=='N')
							   {
							    if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
								fprintf(fp,"%-18.18s"," ");
							    if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
								if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
								fprintf(fp,"%-9.9s"," ");
								print_formated_amt(nd1_serv_tot_disc);
							 							
							   }
							   else
							   {
							    print_formated_amt(nd1_serv_charge_discount);
								print_formated_amt(nd1_serv_bill_discount);
								print_formated_amt(nd1_serv_fund_adjustment);

							   }

							 }
						 }
						 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						  if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0) 
						    print_formated_amt((nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt)); // Amt Payble
						
						  else
						  {
						   if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						   print_formated_amt(nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt); // Amt Payble
						  }
					     }
						 nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

					     if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						 {
						   if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
						   {
							get_subsidized_amt();
							if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
							print_formated_amt(nd_subdiv_amt);
						   }
						 }
						
						 
						 //fprintf(fp,"\n"); commneted on 20/3/2008 for removing space b/w records

						 nd_pat_gross_amt=0;
						 nd_pat_net_amt1=0;
						 nd_pat_disc_amt=0;
						 nd_pat_net_charge_amt=0;
						 nd_pat_addl_charge_amt=0;
						 nd1_serv_charge_discount=0;
						 nd1_serv_bill_discount=0;
						 nd1_serv_fund_adjustment=0;
						 nd1_serv_tot_disc=0;
						 nd1_tot_rate=0;
						 nd1_tot_serv_qty=0;
						 nd_subdiv_amt=0;
						 nd_inside_pkg_gross_amt=0;
						 nd_inside_pkg_net_amt=0;
						 nd_inside_pkg_amtpayable_amt=0;
						 nd_inside_pkg_disc_amt=0;
						 nd_inside_pkg_addchrg_amt=0;
					 	 												 
						 get_print_group_hd_desc();
						 get_print_group_line_desc();  
								
						 		
						 
						 //disp_message(ERR_MESG,nd_prt_hd_desc.arr);  // some packge issue exits
						 //disp_message(ERR_MESG,d1_blng_serv_code.arr);
						 //disp_message(ERR_MESG,d1_package_trx_yn.arr);
						 
						 
						 if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
						  {
							 	  
								  if(l_no_of_clumns ==5)
									 {
									   if (l_lsr != 0 && l_dmp == 0)
									   {
									   if( l_logo_yniflaser.arr[0] != 'Y')
										{
										
											 print_bold_underline();
											 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
											 Release_bold_underline();
											 //fprintf(fp,"\n");
										}
										}
												
											
										if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										{
											if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr); 
													fprintf(fp,"%-11.11s%-50.50s"," "," "); 
												}
												else
												fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr); 
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-26.26s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s  %-26.26s   "," ",nd_prt_hd_desc.arr);
											}
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
										}
									 }
									 else
									 {
									   if (l_lsr != 0 && l_dmp == 0)
									   {
										if( l_logo_yniflaser.arr[0] != 'Y')
										{	
										
											 print_bold_underline();
											 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
											 Release_bold_underline();
											 //fprintf(fp,"\n");
										}
										}
													   
										if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										{
											if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s%-50.50s"," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s   %-29.29s  "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s   %-29.29s  "," ",nd_prt_hd_desc.arr);
											}
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
										}

									 }
									 lsr_line_cnt();
														 
						 }
				
				
					/**********added by vani*********/
				if (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0)
				{
						strcpy(d_grp_code,d1_prt_grp_hdr_code.arr);

						get_grp_pkg_outside_cnt(d_grp_code);

						if (l_grp_pkg_inside_cnt!=0)
							  {
								 if(l_no_of_clumns ==5)
									 {
									   if (l_lsr != 0 && l_dmp == 0)
									   {
									   if( l_logo_yniflaser.arr[0] != 'Y')
										{
										
											 print_bold_underline();
											 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
											 Release_bold_underline();
											 //fprintf(fp,"\n");
										}
										}
												
											
										if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										{
											if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr); 
													fprintf(fp,"%-11.11s%-50.50s"," "," "); 
												}
												else
												fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr); 
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-26.26s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s  %-26.26s   "," ",nd_prt_hd_desc.arr);
											}
										}
										else
										{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s  %s   \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s  %-23.23s   "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s  %-23.23s   "," ",nd_prt_hd_desc.arr);
										}
									 }
									 else
									 {
									   if (l_lsr != 0 && l_dmp == 0)
									   {
										if( l_logo_yniflaser.arr[0] != 'Y')
										{	
										
											 print_bold_underline();
											 fprintf(fp,"\n%-s",nd_prt_hd_desc.arr);
											 Release_bold_underline();
											 //fprintf(fp,"\n");
										}
										}
													   
										if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0 )
										{
											if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s%s\n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s%-50.50s"," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s%-50.50s"," ",nd_prt_hd_desc.arr);
											}
											else
											{
												if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
												{
													fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
													fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
												}
												else
												fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
											}
										}
										else
										{
											if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
											{
												fprintf(fp,"\n%-11.11s   %s  \n"," ",nd_prt_hd_desc.arr);
												fprintf(fp,"%-11.11s   %-26.26s  "," "," ");
											}
											else
											fprintf(fp,"\n%-11.11s   %-26.26s  "," ",nd_prt_hd_desc.arr);
										}

									 }
									 lsr_line_cnt();
								}
						 
					}

				/*******upto here*******/


						 //get_blng_serv_desc1();
						 //fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);

						 get_gross_net_amt();

						 nd1_tot_serv_qty=nd1_tot_serv_qty+d1_serv_qty;        //Total Rate by Service wise
						 nd1_grd_tot_serv_qty=nd1_grd_tot_serv_qty+d1_serv_qty;  //Grand Total Rate by Service wise
						
						 
						 nd1_tot_rate=nd1_tot_rate+d1_rate;          //Total Rate by Service wise
						 nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise

						 nd_pat_addl_charge_amt=nd_pat_addl_charge_amt+d1_addl_charge_amt_in_charge;        //total Addl Charge by service
						 nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge; //Total Addl Charge Amt
			
						 nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						 nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;

						 
						 /******* For CRF-440(Discount Document Report)********/

						nd1_serv_tot_disc=nd1_serv_tot_disc+d1_tot_disc;								//Service Wise Total Discount
						nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount

						nd1_serv_charge_discount=nd1_serv_charge_discount+d1_charge_discount;			//Service Wise Total Charge Discount
						nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount

						nd1_serv_bill_discount=nd1_serv_bill_discount+d1_bill_discount;					//Service Wise Total Bill Discount
						nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount

						nd1_serv_fund_adjustment=nd1_serv_fund_adjustment+d1_fund_adjustment;			//Service Wise Total Fund(policy) Discount
						nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount
												
						/********CRF-440 ***************/						
							
						 
						 nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;       //total service gross
						 nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;           //total service net
						 //nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;          //total service discount	
						 nd_pat_disc_amt=nd_pat_disc_amt+d1_upd_disc_amt;          //total service discount	
						 
											 
						if(d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0) // l_pkg_len==0 (to) l_pkg_len!=0  changed by vani 
						{
						  nd_inside_pkg_gross_amt=nd_inside_pkg_gross_amt+p_pat_gross_amt;
						  nd_inside_pkg_net_amt=nd_inside_pkg_net_amt+p_pat_net_amt;
						  nd_inside_pkg_amtpayable_amt=nd_inside_pkg_amtpayable_amt+d1_upd_net_charge_amt;
						  nd_inside_pkg_disc_amt=nd_inside_pkg_disc_amt+d1_upd_disc_amt;
						  nd_inside_pkg_addchrg_amt=nd_inside_pkg_addchrg_amt+d1_addl_charge_amt_in_charge;
						}
				

						 end_of_report=1;

					}

										   					    
				}


			}//summary end

	      else
           {		
                
				if (strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)!=0 || strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)!=0)
				{
					
						if (nd2_summary_dtl_ind.arr[0] == 'S')  
						{
							
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
							p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;    //total  discount
										    					
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) ) 
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
			                 if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							 {
								 get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
								print_formated_amt2(nd_pat_addl_charge_amt);
							 }
							 //print_formated_amt2(d1_addl_charge_amt_in_charge-nd_inside_pkg_addchrg_amt);
							}
							//else rag
							//if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							//fprintf(fp,"%11.11s"," ");  //added by vani for printing service date for patient
			
														
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{

							 if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							 {
							 
							 print_formated_amt(nd_pat_gross_amt-nd_inside_pkg_gross_amt);
							 }
							}
													 
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							 print_formated_amt(nd_pat_net_amt1-nd_inside_pkg_net_amt);
						    }
							
							//if(nd_pat_net_amt1>=0)
							//nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
							//els]e
							nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
													
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							{
								if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
								{
								 get_discount_count();
							    if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
							    {
								  if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
								  print_formated_amt(nd_pat_disc_amt-nd_inside_pkg_disc_amt);
								 }
								}

								if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
								{
								  if(c_disc_amt_in_dtl_yn.arr[0]=='N')
								  {
								   if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
								   fprintf(fp,"%-18.18s"," ");
								   if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
								   if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
								   fprintf(fp,"%-9.9s"," ");
								   print_formated_amt(nd1_serv_tot_disc);
								  }
								  else
								  {
								    print_formated_amt(nd1_serv_charge_discount);
									print_formated_amt(nd1_serv_bill_discount);
									print_formated_amt(nd1_serv_fund_adjustment);
								  }
								}
							}
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						    if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0) 
							  print_formated_amt((nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt));
						
						 	 else
							 {
							  if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
						      print_formated_amt(nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt);
							 }
						    }
							
							nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

						   if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						   {
						    if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
							{
								get_subsidized_amt();
								if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
								print_formated_amt(nd_subdiv_amt);
							}
						   }
							  
						}
						nd_ref_prt_grp_hdr_code.arr[nd_ref_prt_grp_hdr_code.len] ='\0';
					   
						get_print_group_hd_desc();
						get_print_group_line_desc();
						get_blng_serv_desc1();

						//added by raghava on 18/03/2008
						if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						if(nd2_summary_dtl_ind.arr[0] == 'S')
						{
						 fprintf(fp,"\n");
						 lsr_line_cnt();
						}
										
					   /*Commented by raghava on 18/03/2008  as per requirement of CRF-105(i.e don't print the detail title description)	
					   
                       fprintf(fp,"\n%-19.19s / ",nd_prt_hd_desc.arr);
					   fprintf(fp," %-20.20s\n",nd_prt_line_desc.arr);
					   lsr_line_cnt();lsr_line_cnt(); Upto here*/

					   //fprintf(fp,"\n%-25s/%-45s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
					   //fprintf(fp,"\n%-s/%-45s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); 
					  
					   if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
					   if (l_lsr != 0 && l_dmp == 0)
					   {
					   if( l_logo_yniflaser.arr[0] != 'Y')
						{
						  print_bold_underline();
						  fprintf(fp,"\n%-s/%-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr); //uncommented by vani
						  lsr_line_cnt();
						  Release_bold_underline();
					    }
						}
							
							/*****added by vani********/
						if (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len!=0)  
						{													
								strcpy(d_grp_code,d1_prt_grp_hdr_code.arr);
								get_grp_pkg_outside_cnt(d_grp_code);

								if (l_grp_pkg_inside_cnt!=0)
								{
									if (l_lsr != 0 && l_dmp == 0)
									   {
									   if( l_logo_yniflaser.arr[0] != 'Y')
										{
										  print_bold_underline();
										  fprintf(fp,"\n%-s/%-s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);
										  lsr_line_cnt();
										  Release_bold_underline();
										}
										}
								 }

						}

						/********upto here*******/

						/* This If Condition for checking if any additional charge is there 
						then it will print the below format otherwise else format*/

						if(d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						if(l_no_of_clumns ==5)
						{
						    if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							{
								if (d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if (d1_summary_dtl_ind.arr[2] == 'A') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								}
							 }
							 else
							 {
								 if (d1_summary_dtl_ind.arr[2] == 'S') 
								 {
									 if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									 {
										fprintf(fp," %-11.11s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-11.11s %-25.25s "," "," "); //,d1_serv_item_code.arr);
									 }
									 else
									 fprintf(fp," %-11.11s %-25.25s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								 }
								 if (d1_summary_dtl_ind.arr[2] == 'A') 
								 {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-11.11s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-11.11s %-25.25s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-11.11s %-25.25s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								  }
							 }
							
						}
						else
						{
							if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							{
								if(d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if(d1_summary_dtl_ind.arr[2] == 'A') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								}
							}
							else
							{
								if(d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-12.12s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-12.12s %-27.27s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-12.12s %-27.27s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if(d1_summary_dtl_ind.arr[2] == 'A')
								{ 
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-12.12s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-12.12s %-27.27s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-12.12s %-27.27s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
									//fprintf(fp," %-12.12s %-18.18s %-9.9s",d1_serv_anal_grp.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
								}

							}

							
						}

						
				}
				else
				{
						if (nd2_summary_dtl_ind.arr[0] == 'S')  
						{
							
							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
							p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
										    					
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							  if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							  {	
								get_addlcharge_count();
								if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
								print_formated_amt2(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt);
							  }
							  //print_formated_amt2(d1_addl_charge_amt_in_charge);
							}
							//else rag
							//if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							//fprintf(fp,"%11.11s"," ");  //added by vani for printing service date for patient
			
							
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							 {
							
							 print_formated_amt(nd_pat_gross_amt-nd_inside_pkg_gross_amt);
							 }
							}
													 
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							 print_formated_amt(nd_pat_net_amt1-nd_inside_pkg_net_amt);
							}
							
							//if(nd_pat_net_amt1>=0)
							//nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
							//else
							nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
													
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							{
								if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
								{
								 get_discount_count();
								if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
								{
								  if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
								  print_formated_amt(nd_pat_disc_amt);
								 }
								}
								if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
								{
								  if(c_disc_amt_in_dtl_yn.arr[0]=='N')
								  {
								   if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
								   fprintf(fp,"%-18.18s"," ");
								   if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
								   if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
								   fprintf(fp,"%-9.9s"," ");
								   print_formated_amt(nd1_serv_tot_disc);
								  }
								  else
								  {
								    print_formated_amt(nd1_serv_charge_discount);
									print_formated_amt(nd1_serv_bill_discount);
									print_formated_amt(nd1_serv_fund_adjustment);
								  }

								}
									
							}
							if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
							if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
							{
							 if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
							  print_formated_amt((nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt));
						
							 else
							 {
							  if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
							  print_formated_amt(nd_pat_net_charge_amt-nd_inside_pkg_amtpayable_amt);
							 }
							}
							nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

						   if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
						   {
							if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
							{
								get_subsidized_amt();
								if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
								print_formated_amt(nd_subdiv_amt);
							}
						   }
							  
						}

						get_blng_serv_desc1();
					    /* This If Condition for checking if any additional charge is there 
						then it will print the below format otherwise else format*/
						
					    if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
						if(l_no_of_clumns ==5)
						{
							if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							{
								if (d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if (d1_summary_dtl_ind.arr[2] == 'A') 	
								{					
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								}
							}
							else
							{
							
								if (d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-11.11s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-11.11s %-25.25s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-11.11s %-25.25s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if (d1_summary_dtl_ind.arr[2] == 'A') 	
								{					
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-11.11s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-11.11s %-25.25s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-11.11s %-25.25s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								}
							}

							
						}
						else
						{	
							
							if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
							{
								if (d1_summary_dtl_ind.arr[2] == 'S') 
							    {
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr );  //,d1_serv_item_code.arr); 
										fprintf(fp," %-10.10s %-13.13s "," "," " );  //,d1_serv_item_code.arr); 
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_blng_serv_code.arr,nd_blng_desc1.arr );  //,d1_serv_item_code.arr); 
								 }
								if (d1_summary_dtl_ind.arr[2] == 'A') 
								{						
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-10.10s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr);  //,d1_serv_item_code.arr);
										fprintf(fp," %-10.10s %-13.13s "," "," ");  //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-10.10s %-13.13s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr);  //,d1_serv_item_code.arr);
									//fprintf(fp," %-12.12s %-18.18s %-9.9s",d1_serv_anal_grp.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
								}
							}
							else
							{
							
								if (d1_summary_dtl_ind.arr[2] == 'S') 
								{
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-12.12s %s \n",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-12.12s %-27.27s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-12.12s %-27.27s ",d1_blng_serv_code.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
								}
								if (d1_summary_dtl_ind.arr[2] == 'A') 	
								{					
									if (strcmp(c_serv_desc_sep_line_yn.arr,"Y")==0)
									{
										fprintf(fp," %-12.12s %s \n",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
										fprintf(fp," %-12.12s %-27.27s "," "," "); //,d1_serv_item_code.arr);
									}
									else
									fprintf(fp," %-12.12s %-27.27s ",d1_mapping_code.arr,nd1_mapping_code_desc.arr); //,d1_serv_item_code.arr);
								}
							}
							
						}

				}
			

				get_gross_net_amt();
				
				p_tot_pat_gross_amt=p_tot_pat_gross_amt+p_pat_gross_amt;
				p_tot_pat_net_amt=p_tot_pat_net_amt+p_pat_net_amt;
				//p_tot_pat_disc_amt=p_tot_pat_disc_amt+p_pat_disc_amt;
				p_tot_pat_disc_amt=p_tot_pat_disc_amt+d1_upd_disc_amt;
				
				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				{
					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
					{
						if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
						{
							get_addlcharge_count();
						 if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
						 print_formated_amt2(d1_addl_charge_amt_in_charge);
						}
					
						else
						if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
						{
						  fprintf(fp,"%16.16s",nd_service_date.arr);  //added by vani for printing service date for patient
						  print_formated_qty(d1_serv_qty);
						  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
						  print_formated_amt(d1_rate);
						} 
					
					}

					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
					{
					    if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
						{
						  fprintf(fp,"%16.16s",nd_service_date.arr);  //added by vani for printing service date for patient
						  print_formated_qty(d1_serv_qty);
						  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
						  print_formated_amt(d1_rate);
						} 
					}
				}

				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
				{
				 if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
				 {
				
				 print_formated_amt(p_pat_gross_amt);
				 }
				}
					
				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
				{
				 if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
				 print_formated_amt(p_pat_net_amt);
				 
				}				 
				 //if(d1_upd_net_charge_amt>=0)
				 //nd_subdiv_amt=p_pat_net_amt-d1_upd_net_charge_amt;

				 nd_subdiv_amt=p_pat_net_amt-d1_upd_net_charge_amt;
				
				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				{
					if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
					{
					 get_discount_count();
					 if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
					 {
					  if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
					  print_formated_amt(d1_upd_disc_amt);
					 }
					}
					if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
					{
					 if(c_disc_amt_in_dtl_yn.arr[0]=='N')
					 {
					  if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
					  fprintf(fp,"%-18.18s"," ");
					  print_formated_amt(d1_tot_disc);
					 }
					 else
					 {
					  print_formated_amt(d1_charge_discount);
					  print_formated_amt(d1_bill_discount);
					  print_formated_amt(d1_fund_adjustment);
					 }
					}

				}
				
				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			    if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
				{
				 if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
				  print_formated_amt(d1_upd_net_charge_amt-d1_addl_charge_amt_in_charge);
			
				 else
				 {
				  if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
				  print_formated_amt(d1_upd_net_charge_amt);
					  
				 }
                }

			    /*
				if(d1_upd_net_charge_amt>=0)
				{
				nd_subdiv_amt=p_pat_gross_amt-d1_upd_net_charge_amt;
				}
				else
				{
				nd_subdiv_amt=p_pat_gross_amt+d1_upd_net_charge_amt;
				}
			   */
				nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt;

				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
				{
				 if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
				 {
					get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					print_formated_amt(nd_subdiv_amt);
				 }
			    }

				nd1_grd_tot_rate=nd1_grd_tot_rate+d1_rate;  //Grand Total Rate by Service wise
				
				nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;	
				nd_pat_tot_addl_charge_amt=nd_pat_tot_addl_charge_amt+d1_addl_charge_amt_in_charge;			
				

				nd1_tot_serv_tot_disc=nd1_tot_serv_tot_disc+d1_tot_disc;						//Grand Total Discount
				nd1_tot_serv_charge_discount=nd1_tot_serv_charge_discount+d1_charge_discount;	//Grand Total Charge Discount
				nd1_tot_serv_bill_discount=nd1_tot_serv_bill_discount+d1_bill_discount;			//Grand Total Bill Discount
				nd1_tot_serv_fund_adjustment=nd1_tot_serv_fund_adjustment+d1_fund_adjustment;	//Grand Total Fund(policy) Discount

				if( d1_package_trx_yn.arr[0] == 'N' || (d1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
				{
				  fprintf(fp,"\n");
				  lsr_line_cnt();
				}


				/*** added by vani for printing PH Batch Details*******/
				
				if(strcmp(d1_mapping_code_ind.arr,"M")==0 && strcmp(d1_folio_batch_id.arr,"\0")!=0)
				{
				
				if(d1_summary_dtl_ind.arr[0] == 'D') 
				get_payer_batch_details();
				}

				/*********End of Batch Id*******/
			
				nd_pat_gross_amt=0;
				nd_pat_net_amt1=0;
				nd_pat_disc_amt=0;
				nd_subdiv_amt=0;
				nd_pat_net_charge_amt=0;
				nd_pat_addl_charge_amt=0;
				nd1_serv_tot_disc=0;
				nd1_serv_charge_discount=0;
				nd1_serv_bill_discount=0;
				nd1_serv_fund_adjustment=0;
				nd1_tot_rate=0;
				nd1_tot_serv_qty=0;
				nd_inside_pkg_gross_amt=0;
				 nd_inside_pkg_net_amt=0;
				 nd_inside_pkg_amtpayable_amt=0;
				 nd_inside_pkg_disc_amt=0;
				 nd_inside_pkg_addchrg_amt=0;
				end_of_report=0;
				ccnt=0;

             }
     strcpy(nd1_prt_grp_hdr_code.arr,d1_prt_grp_hdr_code.arr);
     strcpy(nd1_prt_grp_line_code.arr,d1_prt_grp_line_code.arr);
     strcpy(nd1_payer_serv_grp_hdr.arr,d1_payer_serv_grp_hdr.arr);
     strcpy(nd1_payer_serv_grp_line.arr,d1_payer_serv_grp_line.arr);
	 strcpy(nd2_blng_serv_code.arr,d1_blng_serv_code.arr); //ADDED AT 29/10/2007
	 strcpy(nd2_serv_anal_grp.arr,d1_serv_anal_grp.arr); 
	 strcpy(nd2_summary_dtl_ind.arr,d1_summary_dtl_ind.arr);
	 strcpy(nd1_package_trx_yn.arr,d1_package_trx_yn.arr);

	
  }

 else
 {
			 ccnt=0;
			 othp_cnt=othp_cnt+1;
	
			 if (strcmp(d1_cust_code1.arr,nd_cust_code1.arr)==0)
			 {
			  
			   nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
			   //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;
			   nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
			 }
			 else
			 {

				if (othp_cnt==1)
				{					
				 
				  nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
				  nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
				  //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;
				}
				else
				{
				
				  //nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+nd_othp_payer_amt;
              	 
					strcpy(ar_cust_amt[p],nd_cust_nm.arr); 

					/*** Below Code Added for CRF-659 ***/
					l_cust_code.arr[0] ='\0';
			        l_cust_code.len = 0;
		            strcpy(l_cust_code.arr,nd_cust_code1.arr);
					l_cust_code.len=strlen(nd_cust_code1.arr);
		            l_cust_code.arr[l_cust_code.len]='\0';
					get_bill_num(1);
					strcpy(bill_code[p],l_bill_num_temp.arr); 
					/*** Up To Here ***/
					
							
					put_val(ar_amt[p],nd_othp_payer_amt); 
					format_amt(ar_amt[p]);
					nd_othp_payer_amt=0;
					nd_othp_payer_amt=nd_othp_payer_amt+d1_upd_net_charge_amt;
					nd_tot_othp_payer_amt=nd_tot_othp_payer_amt+d1_upd_net_charge_amt;
					p=p+1;
				
				}
				
			 }
			 
			  nd_cust_code1.arr[0] ='\0';
			  nd_cust_code1.len = 0;
			  l_cust_code.arr[0] ='\0';
			  l_cust_code.len = 0;
		      l_bill_num_temp.arr[0]='\0';
			  l_bill_num_temp.len=0;
			  
			  strcpy(nd_cust_code1.arr,d1_cust_code1.arr);
			  fetch_customer2();
		      strcpy(nd_cust_nm.arr,d_customer3.arr);
			  /*** Below Code Added for CRF-659 ***/
			  strcpy(l_cust_code.arr,d1_cust_code1.arr);
			  l_cust_code.len=strlen(d1_cust_code1.arr);
		      l_cust_code.arr[l_cust_code.len]='\0';
		      get_bill_num(1);
			  strcpy(bill_code[0],l_bill_num.arr); 
		      strcpy(l_bill_num_temp.arr,l_bill_num.arr); 
			  
			  /*** Up To Here ***/
			
             //nd_cust_code1.arr[nd_cust_code1.len] ='\0';


  }




} //END OF print_patient_hdr

/* THIS FUNCTION WILL PRINT THE PURE CASH BILL */

print_cash_patient_hdr()
 { 
   
	if(strcmp(d1_cust_code1.arr,"\0")!=0)
	{
	  ccnt=0;
    } 

	if(strcmp(d1_cust_code1.arr,"\0")==0)
	  {
             
		   if(d1_summary_dtl_ind.arr[0]=='S') 
			  {  
                 	 
			      if(ccnt==1)
				    {
					   					
						get_print_group_hd_desc();
						get_print_group_line_desc();
						//get_blng_serv_desc1();
											
						fprintf(fp,"\n%-19.19s / %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						lsr_line_cnt();
					
						//fprintf(fp," %-10.10s %-19.19s %-9.9s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
								   
					    get_gross_net_amt();
					
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;  //total service gross
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;		//total service net
						nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;		//total service discount
											
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;				//total Net Amt
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;			//total service Reimbursable Amt
						nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;                
						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;    //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt; //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt

						//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
					
						
						end_of_report=1;

			        }

					else
					{

					  if(strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)==0 && strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)==0
				      && strcmp(d1_payer_serv_grp_hdr.arr,nd1_payer_serv_grp_hdr.arr)==0 && strcmp(d1_payer_serv_grp_line.arr,nd1_payer_serv_grp_line.arr)==0)
				      {
					   
																	
						get_gross_net_amt();						
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;	//total service gross
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;		//total service net
						nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;		//total service discount

						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;			   //total Net Amt
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;		   //total service Reimbursable Amt
						nd_net_non_reimbursable_amt=p_pat_net_amt-d_net_reimbursable_amt; 
						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;//total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
						//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; 
															
						
									
						end_of_report=1;

					  }

					   else
					   {
					   						
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;	//total gross Amt
						p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;		//total net Amt
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;	//total discount Amt
																											
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						{
						
						print_formated_amt(nd_pat_gross_amt);
						}
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(nd_pat_net_amt1);
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
						print_formated_amt(nd_pat_disc_amt);

						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
						{
						nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt1);					//Net Amount for summary services
						}
						else
						{
						nd_pat_net_amt1= nd_pat_net_amt1;
						}

						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_net_reimbursable_amt);		//printing the Reimbursable Amt

						//nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
						//nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;   //total service Non Reimbursable Amt
		
						fprintf(fp," ");
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_non_reimbursable_amt);        //printing the Non Reimbursable Amt
						
						//print_formated_amt(nd_net_non_reimbursable_amt);		//printing the Non Reimbursable Amt
						
						
						nd_pat_gross_amt=0;
						nd_pat_net_amt1=0;
						nd_pat_disc_amt=0;
						nd_tot_net_reimbursable_amt=0;
						nd_tot_non_reimbursable_amt=0;
						//nd_net_non_reimbursable_amt=0;
						nd_pat_net_charge_amt=0;

						get_print_group_hd_desc();
						get_print_group_line_desc();
						fprintf(fp,"\n%-19.19s -  %-19.19s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	
						lsr_line_cnt();

						get_gross_net_amt();
					
						nd_pat_gross_amt=nd_pat_gross_amt+p_pat_gross_amt;  //total service gross
						nd_pat_net_amt1=nd_pat_net_amt1+p_pat_net_amt;		//total service net
						nd_pat_disc_amt=nd_pat_disc_amt+p_pat_disc_amt;		//total service discount
											
						nd_pat_net_charge_amt=nd_pat_net_charge_amt+d1_upd_net_charge_amt;  
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt;							//total Net Amt
						nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;						//total service Reimbursable Amt
						nd_net_non_reimbursable_amt=p_pat_net_amt-d_net_reimbursable_amt;							//total servicewise Non Reimbursable Amt
						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+ nd_net_non_reimbursable_amt;                //total service Non Reimbursable Amt
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;				 //total Reimbursable Amt
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt

						//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt; //total Non Reimbursable Amt
											
						

						end_of_report=1;
					

					   }
				
			
				   }
				 
			   d_net_reimbursable_amt=0;

			}
			
		
        else
           {    
			    
				if (strcmp(d1_prt_grp_hdr_code.arr,nd1_prt_grp_hdr_code.arr)!=0 || strcmp(d1_prt_grp_line_code.arr,nd1_prt_grp_line_code.arr)!=0)
				 {
				        nd_tot_non_reimbursable_amt=0;    
						if (nd1_summary_dtl_ind.arr[0]=='S')
						{
                          
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;	//total gross Amt
						p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;		//total net Amt
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;	//total discount Amt
																											
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						{
						
						print_formated_amt(nd_pat_gross_amt);
						}
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(nd_pat_net_amt1);
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
						print_formated_amt(nd_pat_disc_amt);

						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
						{
						nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt1);					//Net Amount for summary services
						}
						else
						{
						nd_pat_net_amt1= nd_pat_net_amt1;
						}

						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_net_reimbursable_amt);		//printing the Reimbursable Amt

						nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;
						fprintf(fp," ");
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_non_reimbursable_amt);
						//print_formated_amt(nd_net_non_reimbursable_amt);		//printing the Non Reimbursable Amt
						
						}

						nd_ref_prt_grp_hdr_code.arr[nd_ref_prt_grp_hdr_code.len] ='\0';
					  	get_print_group_hd_desc();
    					get_print_group_line_desc();
						get_blng_serv_desc1();
					    
						//fprintf(fp,"\n%-s%6s",nd_prt_hd_desc.arr," ");
					    //fprintf(fp," %-20s\n",nd_prt_line_desc.arr);
						fprintf(fp,"\n%-19.19s -  %-19.19s\n",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);	

					    lsr_line_cnt();lsr_line_cnt();

						//fprintf(fp,"\n%-45s-%-45s",nd_prt_hd_desc.arr,nd_prt_line_desc.arr);

						//fprintf(fp,"\n%-2s-%-3s\n",d1_prt_grp_hdr_code.arr,d1_prt_grp_line_code.arr);
     										
					     
						 //fprintf(fp," %-10.10s %-20.20s %-8.8s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						 fprintf(fp," %-12.12s %-26.26s  ",d1_serv_anal_grp.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);
	                    
				
				}
				else
				{	
						if (nd1_summary_dtl_ind.arr[0]=='S')
						{

							p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;	//total gross Amt
							p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;		//total net Amt
							nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+nd_pat_disc_amt;	//total discount Amt
																												
							if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
							{
							
							print_formated_amt(nd_pat_gross_amt);
							}
							if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
							print_formated_amt(nd_pat_net_amt1);
							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
							print_formated_amt(nd_pat_disc_amt);

							if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
							{
							nd_pat_net_amt1=nd_pat_gross_amt-nd_pat_disc_amt;
							print_formated_amt(nd_pat_net_amt1);					//Net Amount for summary services
							}
							else
							{
							nd_pat_net_amt1= nd_pat_net_amt1;
							}

							if (strcmp(c_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_net_reimbursable_amt);		//printing the Reimbursable Amt

							nd_net_non_reimbursable_amt=nd_pat_net_amt1-nd_tot_net_reimbursable_amt;
							nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;

							fprintf(fp," ");
							if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
							print_formated_amt(nd_tot_non_reimbursable_amt);
							//print_formated_amt(nd_net_non_reimbursable_amt);		//printing the Non Reimbursable Amt
							
						}
						
						get_blng_serv_desc1();
						//fprintf(fp," %-10.10s %-20.20s %-8.8s ",d1_blng_serv_code.arr,nd_blng_desc1.arr,d1_serv_item_code.arr);
						fprintf(fp," %-12.12s %-26.26s  ",d1_serv_anal_grp.arr,nd_blng_desc1.arr); //,d1_serv_item_code.arr);

				 }
			
				
						nd_tot_non_reimbursable_amt=0;
						get_gross_net_amt();
					
						p_tot_pat_gross_amt=p_tot_pat_gross_amt+p_pat_gross_amt;
						p_tot_pat_net_amt=p_tot_pat_net_amt+p_pat_net_amt;
			    					
						if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
						{
						print_formated_amt(p_pat_gross_amt);  
						}     //Gross
						if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
						print_formated_amt(p_pat_net_amt);		   // Net
						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)   
						print_formated_amt(p_pat_disc_amt);

						if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0) 
						{
						nd_pat_net_amt=p_pat_gross_amt-p_pat_disc_amt;
						print_formated_amt(nd_pat_net_amt); //Net Amount
						}
						else
						{
						nd_pat_net_amt=	p_pat_net_amt;
						}
              			
						if (strcmp(c_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(d_net_reimbursable_amt);    //Reimbursable Amt
						
						fprintf(fp," ");
						nd_net_non_reimbursable_amt=nd_pat_net_amt-d_net_reimbursable_amt;
						nd_tot_non_reimbursable_amt=nd_tot_non_reimbursable_amt+nd_net_non_reimbursable_amt;
						
						if (strcmp(c_non_reim_amt_ind.arr,"Y")==0)
						print_formated_amt(nd_tot_non_reimbursable_amt);//Non Reimbursable Amt
						
						//print_formated_amt(nd_net_non_reimbursable_amt);//Non Reimbursable Amt
               			//print_formated_amt(d1_upd_net_charge_amt);				
												
						nd_tot_pat_disc_amt=nd_tot_pat_disc_amt+p_pat_disc_amt;//raghava
						nd_tot_pat_net_charge_amt=nd_tot_pat_net_charge_amt+d1_upd_net_charge_amt; //Net payable
						//nd_tot_net_reimbursable_amt=nd_tot_net_reimbursable_amt+d_net_reimbursable_amt;	
						nd_gnd_tot_net_reimbursable_amt=nd_gnd_tot_net_reimbursable_amt+d_net_reimbursable_amt;
						nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_tot_non_reimbursable_amt; //total Non Reimbursable Amt

						//nd_gnd_tot_net_non_reimbursable_amt=nd_gnd_tot_net_non_reimbursable_amt+nd_net_non_reimbursable_amt;//raghava			
						
						fprintf(fp,"\n");
						lsr_line_cnt();
						
						ccnt=0;
						nd_pat_gross_amt=0;
						nd_pat_net_amt1=0;
						nd_pat_disc_amt=0;
						nd_tot_net_reimbursable_amt=0;
						//nd_net_non_reimbursable_amt=0;
						nd_tot_non_reimbursable_amt=0;
						nd_pat_net_charge_amt=0;
						d_net_reimbursable_amt=0; //ADDED AT 05/11/07
						end_of_report=0;


             }
		  strcpy(nd1_prt_grp_hdr_code.arr,d1_prt_grp_hdr_code.arr);
		  strcpy(nd1_prt_grp_line_code.arr,d1_prt_grp_line_code.arr);
		  strcpy(nd1_payer_serv_grp_hdr.arr,d1_payer_serv_grp_hdr.arr);
		  strcpy(nd1_payer_serv_grp_line.arr,d1_payer_serv_grp_line.arr);
		  strcpy(nd1_blng_serv_code.arr,d1_blng_serv_code.arr); //ADDED AT 29/10/2007
		  strcpy(nd1_serv_anal_grp.arr,d1_serv_anal_grp.arr); 
		  strcpy(nd1_summary_dtl_ind.arr,d1_summary_dtl_ind.arr);
  }


} //end of print_cash_patient_hdr
print_sponsor_patient_hdr()
{

	    get_column_count_cust();
		
        print_report_head();
		l_next_page=2;
        ccnt=0;
		nd_summary_dtl_ind.arr[0]='\0';
		nd_prt_grp_hdr_code.arr[0]='\0';
		nd_prt_grp_line_code.arr[0]='\0';
		nd_cust_code1.arr[0]='\0';

		/***** This code added for printing package bill if it is there ****/
		/*if(l_pkg_len!=0)
		{
		 print_package_dtls(); 
		}


		while(fetch_grp_hdr_cur())
		{ 	
		 		 	
		 ccnt = ccnt + 1;
		 ccnt1 = ccnt1 + 1;		
		//open_cust_cur();
		//print_cust_header();
		 print_prt_grp_hdr();		
		}*/

       if(end_of_report)
		{
		  	 
			 /* This commented stmts for displaying float values*/ 

			 /*sprintf(st_var,"%f",nd_pat_net_amt2);
			 disp_message(ERR_MESG,st_var);*/
         
			 nd_net_total=nd_net_total+nd_pat_net_amt2;
			 nd_gross_total=nd_gross_total+nd_pat_gross_amt1;
			 nd_disc_total=nd_disc_total+nd_pat_disc_amt1;
			 
			 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			 {
				 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
				 {
				  if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"C")==0) 
				  {
				   get_addlcharge_count();
				   if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
				   print_formated_amt1(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt);
				  }
				  else
				  fprintf(fp,"%11.11s"," ");
				  
		         }

			  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0 && p_disc_amt_in_dtl_yn.arr[0]=='N')
              fprintf(fp,"%11.11s"," ");

				 
			 }

			 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
			 {
			  if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
			  {
			   
			  print_formated_amt(nd_pat_gross_amt1-nd_inside_pkg_gross_amt);
			  }
			 }

			 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
			 {
			  if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
			  print_formated_amt(nd_pat_net_amt2-nd_inside_pkg_net_amt);
			 }

			 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			 {
			  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
			  {
			  get_discount_count();
			 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
				{
			   if (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
			   print_formated_amt(nd_pat_disc_amt1-nd_inside_pkg_disc_amt);
			   }
			  }

			 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
			  {
				  if(p_disc_amt_in_dtl_yn.arr[0]=='N')
				  {
				   //if (strcmp(p_servdate_in_dtlformat_yn.arr,"N")==0)
				   //fprintf(fp,"%-18.18s"," ");
				   if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0) //for - crf-659
				   fprintf(fp,"%-9.9s"," ");
				   print_formated_amt(nd_serv_tot_disc);
				   
				  }
				  else
				  {
					print_formated_amt(nd_serv_charge_discount);
					print_formated_amt(nd_serv_bill_discount);
					print_formated_amt(nd_serv_fund_adjustment);
				  }

			  }
			 }

			 if( nd_package_trx_yn.arr[0] == 'N' || (nd_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
			 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
			 {
			  if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_addl_charge_amt_ind.arr,"R")==0)
			  print_formated_amt((nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt)-(nd_total_addl_charge_by_service-nd_inside_pkg_addchrg_amt));
			  else
			  {
			   if (strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0)
			   print_formated_amt(nd_upd_net_charge_amt-nd_inside_pkg_amtpayable_amt);
			  }
			 }
				
		}
      
      
		//if(end_of_report)
		fprintf(fp,"\n");lsr_line_cnt();
	
		if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		prt_line_uc();
		if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
		prt_line_uc_wide();
		fprintf(fp,"\n");lsr_line_cnt();

  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
  { 
		
		get_cnt_remain_space(3);
		if((l_lcnt+5)<=max_lines-v_lno)
		{
		  if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
		  {
		  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
		   fprintf(fp,"%-62.62s",loc_legend[680]);
		   else
			fprintf(fp,"%-46.46s",loc_legend[680]);
		   }
		   else
			fprintf(fp,"%-53.53s",loc_legend[680]);
		}
		else
		{
		  while(v_lno<=max_lines)
		  {
			fprintf(fp,"\n");
			v_lno++;
		  }
		  lsr_line_cnt();

		  if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
		  {
		  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
		  fprintf(fp,"%-62.62s",loc_legend[680]);
		  else
		  fprintf(fp,"%-46.46s",loc_legend[680]);
		  }
		  else
		  fprintf(fp,"%-53.53s",loc_legend[680]);
		
		}

		if (strcmp(p_gross_net_amt_ind.arr,"G")==0)
		{
		get_pay_inside_pkg_disc();
		print_formated_amt(nd_gross_total-l_pay_inside_pkg_disc);
		}
		if (strcmp(p_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(nd_net_total);
		fprintf(fp,"\n");lsr_line_cnt();

		if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
		{
			if (strcmp(p_serv_disc_on_gross_ind.arr,"R")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)   
			{
			  if(nd_disc_total!=0)
			  {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[710]);
				else
				fprintf(fp," %-44.44s",loc_legend[710]);
				}
				else
				fprintf(fp," %-52.52s",loc_legend[710]);
				print_formated_amt(nd_disc_total);
				fprintf(fp,"\n");lsr_line_cnt();
			  }			
			}
		}

       
  /* THIS IS FOR DISPLAYING OF OTHER PAYER AMOUNT DEPENDING ON SETUP*/

    
	   if(strcmp(d_customer2.arr,"\0")!=0)
	   {
		
		 if (strcmp(p_oth_payers_amt_print_row_ind.arr,"R")==0)
		  {
	   			 
			if(k<=1) 
			{
            
				if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{
					//test fetch_customer1();
					strcpy(leg_cust.arr,strcat(loc_legend[730]," "));
					// test strcpy(leg_cust.arr,strcat(leg_cust.arr,nd_cust_code1.arr));
					strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer2.arr));
					
					if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-49.49s",leg_cust.arr);
					else
					fprintf(fp," %-41.41s",leg_cust.arr);
					}
					else
					fprintf(fp," %-49.49s",leg_cust.arr);

					leg_cust.arr[0] = '\0';
					//fprintf(fp,"%-14s %-35s %-s %-s"," ",loc_legend[730],nd_cust_code1.arr,d_customer.arr);
					//print_formated_amt(nd_oth_payer_amt);
					put_val(ar_amt[0],nd_oth_payer_amt); 
					nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;
					format_amt(ar_amt[0]);
					fprintf(fp,"%15s %-20s",ar_amt[0],bill_code[0]);
				}
			}

		   else
		   {    
			   
	   			if(strcmp(nd_cust_code1.arr,"\0")!=0)
				{	
				
					// test fetch_customer1();
					strcpy(leg_cust.arr,strcat(loc_legend[730]," "));
					// test strcpy(leg_cust.arr,strcat(leg_cust.arr,nd_cust_code1.arr));
					strcpy(leg_cust.arr,strcat(leg_cust.arr,d_customer2.arr));
					
					if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-49.49s",leg_cust.arr);
					else
					fprintf(fp," %-41.41s",leg_cust.arr);
					}
					else
					fprintf(fp," %-49.49s",leg_cust.arr);

					leg_cust.arr[0] = '\0';
					//fprintf(fp,"%-14s %-35s %-s %-s"," ",loc_legend[730],nd_cust_code1.arr,d_customer.arr);
					put_val(ar_amt[0],nd_oth_payer_amt); 
					nd_tot_oth_payer_amt=nd_tot_oth_payer_amt+nd_oth_payer_amt;
					format_amt(ar_amt[0]);
					fprintf(fp,"%15s %-20s",ar_amt[0],bill_code[0]);
				}

	
				for (i=1;i<k;i++) 
				{
				 
				strcpy(ar_cust.arr,	ar_cust_amt[i]);
				fprintf(fp,"\n");lsr_line_cnt();
				if(strcmp(ar_cust_amt[i],"\0")!=0)
				{
					 //fetch_customer2();
					strcpy(leg_cust.arr,strcat(loc_legend[730]," "));
					strcpy(leg_cust.arr,strcat(leg_cust.arr,ar_cust.arr));
					if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-62.62s",leg_cust.arr);
					else
					fprintf(fp," %-44.44s",leg_cust.arr);
					}
					else
					fprintf(fp," %-49.49s",leg_cust.arr);
					leg_cust.arr[0] = '\0';
					//fprintf(fp,"%-14s %-35s %-s"," ",loc_legend[730],d_customer.arr);
					//fprintf(fp,"\n%s",ar_cust.arr);
					fprintf(fp,"%15s %-20s",ar_amt[i],bill_code[i]);
					
				} 
			  }
			}
		}
		 fprintf(fp,"\n");lsr_line_cnt();
	  }
	   
		if (strcmp(p_oth_payers_amt_print_row_ind.arr,"S")==0)
		{
		
		  if(nd_tot_oth_payer_amt!=0)
		  {
			if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," %-62.62s ",loc_legend[810]);
			else
			fprintf(fp," %-44.44s ",loc_legend[810]);
			}
			else
			fprintf(fp," %-52.52s ",loc_legend[810]);

			print_formated_amt(nd_tot_oth_payer_amt);
		    fprintf(fp,"\n");lsr_line_cnt();
		  }	

		}
		
		if (strcmp(p_patient_amt_print_row_ind.arr,"R")==0)
		{

		
		     l_cust_code.arr[0] ='\0';

		 //get_bill_num(2);

		 //if(pat_upd_net_charge_amt!=0) //always it has to print
		  //{
		    if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," %-61.61s",loc_legend[760]);
			else
			fprintf(fp," %-45.45s",loc_legend[760]);
			}
			else
			fprintf(fp," %-52.52s",loc_legend[760]);

			print_formated_amt(pat_upd_net_charge_amt);
			fprintf(fp,"%-s",l_bill_num.arr);

			fprintf(fp,"\n");lsr_line_cnt();
		  //}		
		}

		
		
		if (strcmp(p_addl_charge_amt_ind.arr,"R")==0)
		{
		  if(nd_total_addl_charge!=0)
		  {
			  if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			  {
			  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			  fprintf(fp,"%-62.62s",loc_legend[1230]);
			  else
			  fprintf(fp,"%-45.45s",loc_legend[1230]);
			  }
			  else
			  fprintf(fp,"%-53.53s",loc_legend[1230]);
			  print_formated_amt(nd_total_addl_charge);
			  fprintf(fp,"\n");lsr_line_cnt();
		  }
		}

		if (strcmp(p_bill_net_payable_ind.arr,"R")==0  || strcmp(p_bill_net_payable_ind.arr,"B")==0)
		{
	
			if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," %-61.61s",loc_legend[740]);
			else
			fprintf(fp," %-45.45s",loc_legend[740]);
			}
			else
			fprintf(fp,"%-53.53s",loc_legend[740]);

			print_formated_amt(nd_net_payable);
			fprintf(fp,"\n");lsr_line_cnt();
			get_rounded_amt(nd_net_payable);
			if(nd_rounded_amt!=0)
			{
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-62.62s",loc_legend[1240]);
				else
				fprintf(fp,"%-45.45s",loc_legend[1240]);
				}
				else
				fprintf(fp,"%-53.53s",loc_legend[1240]);
				print_formated_amt(nd_rounded_amt);
				fprintf(fp,"\n");lsr_line_cnt();
				fprintf(fp,"%-53.53s",loc_legend[1250]);
				print_formated_amt(nd_net_pay_amt_after_rounded);
				fprintf(fp,"\n");lsr_line_cnt();
			}
		
		   /*
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0)
			{
			 fprintf(fp,"%-53.53s",loc_legend[1150]);
			 print_formated_amt(d_bill_paid_amt);
			 fprintf(fp,"\n");lsr_line_cnt();
			}
		   */
		}
		
      	/***** added on 30/09/2008 for printing package deposit if it is there ********/ 

		if(l_pkg_len!=0)
		{
		
		   /*** added below code by raghava for SCF-92 ***/

			for(i=1;i<=l_pkg_len;i++)
			{
			  l_pkg_dep_amt=atoi(p_pkg_dep_amt[i]);
			  if(l_pkg_dep_amt!=0)
			  {
			   l_pkg_dep_exist=1; 
			   break;
			  }
			}
		   /*** upto here ***/	
		   if(l_pkg_dep_exist==1)
		   {
			   	
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-62.62s",loc_legend[1260]);
				else
				fprintf(fp,"%-45.45s",loc_legend[1260]);
				}
				else
				fprintf(fp,"%-52.52s",loc_legend[1260]);
				fprintf(fp,"\n");lsr_line_cnt(); 
				for(i=1;i<=l_pkg_len;i++)
				{
					l_pkg_dep_amt=atoi(p_pkg_dep_amt[i]);	//atoi function will convert string to double
					if(l_pkg_dep_amt!=0)	
					{
						if((l_no_of_clumns ==5) || strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
						{
						 if((strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)&&(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)) //for - crf-659
						 fprintf(fp,"       %-31.31s : %-18.18s",loc_legend[1290],p_pkg_seq_num[i]);
						 else
						 fprintf(fp,"       %-21.21s : %-18.18s",loc_legend[1290],p_pkg_seq_num[i]);
						}
						 print_formated_amt(l_pkg_dep_amt);
						 fprintf(fp,"\n"); //lsr_line_cnt(); 
					}
				}
			   
			}
		  }

		
		
      /****** Printing the Bill Adjustments Amts as Saparate Row******/

       if(strcmp(p_all_oth_adj_amt_row_ind.arr,"R")==0)  
	   {
         if ((d1_tot_adjust_amt!=0)||(strcmp(p_print_zero_other_adj_yn.arr,"Y")==0)) //for crf-659
		 {
		  if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
		  {
		  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
		  fprintf(fp," %-61.61s",loc_legend[780]);
		  else
		  fprintf(fp," %-45.45s",loc_legend[780]);
		  }
		  else
		  fprintf(fp," %-52.52s",loc_legend[780]);
          print_formated_amt(d1_tot_adjust_amt);
		  fprintf(fp,"\n");lsr_line_cnt();
		 }

   		  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
		  {
			if(nd_tot_disc_amount!=0)
			{
			  if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			  {
			  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			  fprintf(fp," %-62.62s",loc_legend[790]);
			  else
				fprintf(fp," %-44.44s",loc_legend[790]);
			  }
			  else
			  fprintf(fp," %-49.49s",loc_legend[790]);
			  print_formated_amt(nd_tot_disc_amount);
			  fprintf(fp,"\n");lsr_line_cnt();
			}
		  }

		  if(d1_bill_tot_exmpt_amt!=0)
		  {
		   if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
		   {
		   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
		   fprintf(fp," %-62.62s",loc_legend[720]);
		   else
		   fprintf(fp," %-45.45s",loc_legend[720]);
		   }
		   else
		   fprintf(fp," %-49.49s",loc_legend[720]);
           print_formated_amt(d1_bill_tot_exmpt_amt);
		   fprintf(fp,"\n");lsr_line_cnt();
		  }

		  if(d1_tot_write_off_amt!=0)
		  {
		   if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
		   {
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
		   fprintf(fp," %-62.62s",loc_legend[800]);
		   else
		   fprintf(fp," %-45.45s",loc_legend[800]);
		   }
		   else
		   fprintf(fp," %-49.49s",loc_legend[800]);
		   print_formated_amt(d1_tot_write_off_amt);
		   fprintf(fp,"\n");lsr_line_cnt();
		  }
       }

	/****** Printing the Bill Adjustments Amts as Summarized Row******/
		

       if (strcmp(p_all_oth_adj_amt_row_ind.arr,"S")==0)  
	   {
	  
		  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
		  {
			   if(d1_tot_adjust_amt!=0 || nd_tot_disc_amount!=0 || d1_bill_tot_exmpt_amt!=0 || d1_tot_write_off_amt!=0)
			   {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[850]);
				else
				fprintf(fp," %-45.45s",loc_legend[850]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[850]);
				print_formated_amt(d1_tot_adjust_amt+nd_tot_disc_amount+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
				fprintf(fp,"\n");lsr_line_cnt();
			   }
		  }
		  /**** Discount Not printing when program is calling from No-Discount Funstions ****/
		  else
		  {
			   if(d1_tot_adjust_amt!=0 ||d1_bill_tot_exmpt_amt!=0 || d1_tot_write_off_amt!=0)
			   {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-63.63s",loc_legend[850]);
				else
				fprintf(fp," %-45.45s",loc_legend[850]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[850]);
				print_formated_amt(d1_tot_adjust_amt+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
				fprintf(fp,"\n");lsr_line_cnt();
			   }
		  }
		   
		   /*
		   if (strcmp(p_bill_adj_sep_row_yn.arr,"Y")==0 || strcmp(p_bill_disc_sep_row_yn.arr,"Y")==0||
			   strcmp(p_bill_exm_sep_row_yn.arr,"Y")==0 || strcmp(p_bill_wo_sep_row_yn.arr,"Y")==0 )
		   {
			   fprintf(fp," %-49.49s",loc_legend[850]);
			   if (strcmp(p_bill_adj_sep_row_yn.arr,"Y")==0)
			   {
			    if(d1_tot_adjust_amt!=0)
				nd1_tot_adjust_amt=nd1_tot_adjust_amt+d1_tot_adjust_amt;
			   }
			   
			   if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			   if (strcmp(p_bill_disc_sep_row_yn.arr,"Y")==0)
			   {
			    if(nd_tot_disc_amount!=0)
				nd1_tot_adjust_amt=nd1_tot_adjust_amt+nd_tot_disc_amount;
			   }
			   if (strcmp(p_bill_disc_sep_row_yn.arr,"Y")==0)
			   {
			     if(d1_bill_tot_exmpt_amt!=0)
				 nd1_tot_adjust_amt=nd1_tot_adjust_amt+d1_bill_tot_exmpt_amt;
			   }
			   if (strcmp(p_bill_wo_sep_row_yn.arr,"Y")==0)
			   {
			     if(d1_tot_write_off_amt!=0)
				 nd1_tot_adjust_amt=nd1_tot_adjust_amt+d1_tot_write_off_amt;
			   }
			   fprintf(fp,"\n");lsr_line_cnt();
		
          
		   }
		   */
		  
		  
		   if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
		   if (strcmp(p_bill_disc_sep_row_yn.arr,"Y")==0)
			{
			  if(nd_tot_disc_amount!=0)
			  { 
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[790]);
				else
				fprintf(fp," %-45.45s",loc_legend[790]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[790]);
				print_formated_amt(nd_tot_disc_amount);
				fprintf(fp,"\n");lsr_line_cnt();
			   }
			}

			if (strcmp(p_bill_adj_sep_row_yn.arr,"Y")==0)
			{
			  if((d1_tot_adjust_amt!=0)|| (strcmp(p_print_zero_other_adj_yn.arr,"Y")==0)) //for crf-659
			  {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-61.61s",loc_legend[780]);
				else
				fprintf(fp," %-45.45s",loc_legend[780]);
				}
				else
				fprintf(fp," %-52.52s",loc_legend[780]);
				print_formated_amt(d1_tot_adjust_amt);
				fprintf(fp,"\n");lsr_line_cnt();
			  }	
			  
			}


			if (strcmp(p_bill_exm_sep_row_yn.arr,"Y")==0)
			{
			  if(d1_bill_tot_exmpt_amt!=0)
			  {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[720]);
				else
				fprintf(fp," %-45.45s",loc_legend[720]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[720]);
				print_formated_amt(d1_bill_tot_exmpt_amt);
				fprintf(fp,"\n");lsr_line_cnt();
			  }
			}

			if (strcmp(p_bill_wo_sep_row_yn.arr,"Y")==0)
			{
			  if(d1_tot_write_off_amt!=0)
			  {
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[800]);
				else
				fprintf(fp," %-45.45s",loc_legend[800]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[800]);
				print_formated_amt(d1_tot_write_off_amt);
				fprintf(fp,"\n");lsr_line_cnt();
              }
			}
         }
	 
		
		if(strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS2")==0|| strcmp(nd_calling_pgm_id.arr,"BLRIPDS3")==0|| strcmp(nd_calling_pgm_id.arr,"BLRUCDS3")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0 || 
		strcmp(l_no_settlement_details.arr,"R")==0 || strcmp(l_no_settlement_details.arr,"N")==0)
		{
			/***** Printing Deposit Amt as Row *****/
			if(d_deposit_adj_amt!=0)
			{
				if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-62.62s",loc_legend[880]);
				else
				fprintf(fp," %-45.45s",loc_legend[880]);
				}
				else
				fprintf(fp," %-49.49s",loc_legend[880]);
				print_formated_amt(d_deposit_adj_amt);
				fprintf(fp,"\n");lsr_line_cnt();
			}
			/***** Printing Bill Paid Amt as Row *****/
			if(d_bill_paid_amt!=0)
			{
				 if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				 {
				 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				 fprintf(fp," %-62.62s",loc_legend[1150]);
				 else
				 fprintf(fp," %-45.45s",loc_legend[1150]);
				 }
				 else
				 fprintf(fp," %-49.49s",loc_legend[1150]);
				 print_formated_amt(d_bill_paid_amt);
				 fprintf(fp,"\n");lsr_line_cnt();
			}
		
			/***** Printing Outstanding Amt as Row *****/
			
			//if(d_bill_tot_outst_amt!=0)
		//	{
				
				if((strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)) //for - crf-659
				{
				if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-61.61s",loc_legend[890],nd_curr_date_t.arr);
				else
				fprintf(fp," %-45.45s",loc_legend[890],nd_curr_date_t.arr);
				}
				else
				fprintf(fp," %-35.35s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
			
				print_formated_amt(d_bill_tot_outst_amt);
				fprintf(fp,"\n");lsr_line_cnt();
		//	}
			
		}
	  
	  
	  if(nd_net_pay_amt_after_rounded!=0)
	  {
	   amount=nd_net_pay_amt_after_rounded;
	   print_amt_in_words();
	  }
	  else
      {
	   amount=nd_net_payable;
	   print_amt_in_words();
	  }	
	   /***** Upto here *****/
	
	}
	else
	{
       		if(p_disc_amt_in_dtl_yn.arr[0]=='N' && p_servdate_in_dtlformat_yn.arr[0]=='Y') //for - crf-659)
			{
			 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			 fprintf(fp,"%-62.62s",loc_legend[680]);
			 else
			 fprintf(fp,"%-44.44s",loc_legend[680]);
			 print_formated_amt(nd_tot_serv_tot_disc);
			}
			else
			if (p_disc_amt_in_dtl_yn.arr[0]=='N' && p_servdate_in_dtlformat_yn.arr[0]=='N') 
			{
			 fprintf(fp,"%-53.53s",loc_legend[680]);
			 print_formated_amt(nd_tot_serv_tot_disc);
			 amount=nd_tot_serv_tot_disc;
			 print_amt_in_words();
			}
			else
			{
			 fprintf(fp,"%-42.42s"," ");
			 print_formated_amt(nd_tot_serv_charge_discount);
			 print_formated_amt(nd_tot_serv_bill_discount);
			 print_formated_amt(nd_tot_serv_fund_adjustment);
			 fprintf(fp,"\n");lsr_line_cnt();
			 fprintf(fp,"%-42.42s",loc_legend[680]);
			 print_formated_amt(nd_tot_serv_charge_discount+nd_tot_serv_bill_discount+nd_tot_serv_fund_adjustment);
			 amount=nd_tot_serv_charge_discount+nd_tot_serv_bill_discount+nd_tot_serv_fund_adjustment;
			 print_amt_in_words();

			}

	}
	    //print_footer(); //commented as per the Kuila sir instruction
		close_grp_hdr_cur();
				
	    print_sign_designation();
         /**** Below code added by raghava on 15/10/2009 for CRF-518(siriraj) *****/
		 print_alter_id_num('C');
		/*****  CRF-518(siriraj) *****/	
		if (strcmp(nd_bill_format_id.arr,"1")==0)
		if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
		{
		  fprintf(fp,"\n%-64.64s %-s  %-s %-s\n"," ",loc_legend[1425],nd_curr_date_t.arr,loc_legend[1424]);
		}
		if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0) //IN13383	
		print_footer1();
		


}

print_package_dtls()
{
	//l_pkg_seq_num.arr[0]='\0';
	//l_pkg_seq_num.len=0;
	for(i=1;i<=l_pkg_len;i++)
	{

		strcpy(l_pkg_seq_num.arr,p_pkg_seq_num[i]);
		l_pkg_seq_num.len = strlen(p_pkg_seq_num[i]);
		l_pkg_seq_num.arr[l_pkg_seq_num.len] = '\0';
		get_pkg_name();
		fprintf(fp," %-30.30s  (%-21.21s : %s)",nd_package_desc.arr,loc_legend[1290],p_pkg_seq_num[i]);
		l_pkg_amt=atoi(p_pkg_amt[i]);	//atoi function will convert string to diuble
		print_formated_amt(l_pkg_amt);
		fprintf(fp,"\n");lsr_line_cnt();
		
	
	}

	if(l_next_page=3)
	{
		//fprintf(fp,"\n");lsr_line_cnt();
		if( lcol_cnt == 1)
		prt_line_uc();
		if(lcol_cnt == 2)
		prt_line_uc_wide();
		if(lcol_cnt == 3)
		prt_line_uc_wide1();
		if(lcol_cnt == 5 || lcol_cnt == 6)
		prt_line_uc_wide2();
		fprintf(fp,"\n");lsr_line_cnt();
		get_aviled_outside_pkg();
		if (l_aviled_outside_pkg!=0 )
		{
 	    fprintf(fp," %-50.50s",loc_legend[1270]);
		}
		fprintf(fp,"\n");lsr_line_cnt();
		if( lcol_cnt == 1)
		prt_line_uc();
		if(lcol_cnt == 2)
		prt_line_uc_wide();
		if(lcol_cnt == 3)
		prt_line_uc_wide1();
		if(lcol_cnt == 5 || lcol_cnt == 6)
		prt_line_uc_wide2();
		fprintf(fp,"\n");lsr_line_cnt();
	}
	else
	{
	
		fprintf(fp,"\n");lsr_line_cnt();
		prt_line_uc();
		fprintf(fp,"\n"); lsr_line_cnt();
		get_aviled_outside_pkg();
		if (l_aviled_outside_pkg!=0 )
		{
 	    fprintf(fp," %-50.50s",loc_legend[1270]);
		}
		fprintf(fp,"\n");lsr_line_cnt();
		prt_line_uc();
		fprintf(fp,"\n"); lsr_line_cnt();
	}

}


fun_print_end_of_report()
{
  	
	if(end_of_report)
	 {
								 
		 p_tot_pat_gross_amt=p_tot_pat_gross_amt+nd_pat_gross_amt;  //total  gross
		 p_tot_pat_net_amt=p_tot_pat_net_amt+nd_pat_net_amt1;       //total  net
		 p_tot_pat_disc_amt=p_tot_pat_disc_amt+nd_pat_disc_amt;     //total  discount
		
		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )									    					
		 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
		 {
		  if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)  
		  {
		   get_addlcharge_count();
		   if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
		   print_formated_amt2(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt);
		  }
		  //print_formated_amt2(d1_addl_charge_amt_in_charge);
		 }
		 
		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
		 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
		 {
		  if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		  {
		  
		  print_formated_amt(nd_pat_gross_amt-nd_inside_pkg_gross_amt);
		  }
		 }								 
		 
		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
		 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
		 {
		  if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		  print_formated_amt(nd_pat_net_amt1-nd_inside_pkg_net_amt);
		 }				
		 //if(nd_pat_net_amt1>=0)
		 //nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;
		 //else
		 nd_subdiv_amt=nd_pat_net_amt1-nd_pat_net_charge_amt;

		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
		 {
			 if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0 && strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
			 {
			 get_discount_count();
			   if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
			   {
			  if (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
			  print_formated_amt(nd_pat_disc_amt-nd_inside_pkg_disc_amt);
			  }
			 }

			 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
			 {
			  if(c_disc_amt_in_dtl_yn.arr[0]=='N')
			  {
			   if (strcmp(c_servdate_in_dtlformat_yn.arr,"N")==0)
			   fprintf(fp,"%-18.18s"," ");
			   if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			   if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			   fprintf(fp,"%-9.9s"," ");
			   print_formated_amt(nd1_serv_tot_disc);
			   
			  }
			  else
			  {
			    print_formated_amt(nd1_serv_charge_discount);
				print_formated_amt(nd1_serv_bill_discount);
				print_formated_amt(nd1_serv_fund_adjustment);
			  }

			 }
		 
		 }


		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
		 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
		 {
		  if((strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0) && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		  {
		 
	      print_formated_amt((nd_pat_net_charge_amt-nd_inside_pkg_net_amt)-(nd_pat_addl_charge_amt-nd_inside_pkg_addchrg_amt));
		  }
		  else
		  {
		   if (strcmp(c_bill_net_payable_ind.arr,"C")==0 || strcmp(c_bill_net_payable_ind.arr,"B")==0)
		   {
		   print_formated_amt(nd_pat_net_charge_amt-nd_inside_pkg_net_amt);
		   }
		  }
		 }			
		
		 nd_tot_subdiv_amt=nd_tot_subdiv_amt+nd_subdiv_amt; //total Subsidized Amt

		 if( nd1_package_trx_yn.arr[0] == 'N' || (nd1_package_trx_yn.arr[0] == 'Y' && l_pkg_len==0) )
		 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
		 {
		  if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)
		  {
			get_subsidized_amt();
			if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
			print_formated_amt(nd_subdiv_amt);
		  }
		 }										                    
	 }

		//if(end_of_report)
		fprintf(fp,"\n");lsr_line_cnt();
				
		if(lcol_cnt == 1)
		prt_line_uc();
		if( lcol_cnt == 2)
		prt_line_uc_wide();
		if( lcol_cnt == 3)
		prt_line_uc_wide1();
		if( lcol_cnt == 5 || lcol_cnt == 6)
		prt_line_uc_wide2();

		//prt_line_uc();
		fprintf(fp,"\n");lsr_line_cnt();
		/*if(l_no_of_clumns ==5)
		fprintf(fp,"%-53.53s",loc_legend[680]);
		else
		if(l_no_of_clumns ==6)
		fprintf(fp,"%-56.56s",loc_legend[680]);
		else
		fprintf(fp,"%-42.42s",loc_legend[680]);*/
	
   if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
   {

	   get_cnt_remain_space(1);
	/* Here l_lcnt+5 Meaning 'l_lcnt' for how many line for footer part and '5' for Signature*/ 	

		if((l_lcnt+5)<=max_lines-v_lno)  //added by vani    
		{
		  if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		  {
		  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
		  fprintf(fp,"%-61.61s",loc_legend[680]);
		  else
		  fprintf(fp,"%-45.45s",loc_legend[680]);
		  }
		  else
		  {
			if(l_no_of_clumns ==5)
			fprintf(fp,"%-53.53s",loc_legend[680]);
			else
			if(l_no_of_clumns ==6)
			fprintf(fp,"%-56.56s",loc_legend[680]);
			else
			fprintf(fp,"%-42.42s",loc_legend[680]);
		 } 
		}
		else
		{
			
			while(v_lno<=max_lines)
			  {
				fprintf(fp,"\n");
				v_lno++;
			  }
			  lsr_line_cnt();
			
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp,"%-61.61s",loc_legend[680]);
			else
			fprintf(fp,"%-45.45s",loc_legend[680]);
			}
			else
			{
				if(l_no_of_clumns ==5)
				fprintf(fp,"%-53.53s",loc_legend[680]);
				else
				if(l_no_of_clumns ==6)
				fprintf(fp,"%-56.56s",loc_legend[680]);
				else
				fprintf(fp,"%-42.42s",loc_legend[680]);
			}
		}
		

		if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
		{
		get_pat_inside_pkg_disc();
		print_formated_amt(p_tot_pat_gross_amt-l_pat_inside_pkg_disc);
		}
		if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
		print_formated_amt(p_tot_pat_net_amt);
		fprintf(fp,"\n");  //lsr_line_cnt();
	
	    /*
		if(strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_bill_net_payable_ind.arr,"R")!=0 )
	    fprintf(fp,"%18.18s"," ");
	    if(strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 )
	    fprintf(fp,"%18.18s"," ");
		 Commented on 25/3/2008 for proper printing */

	   //if(strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_bill_net_payable_ind.arr,"R")==0 )
       //fprintf(fp,"%18.18s"," ");
   
		if( strcmp(c_bill_subsidized_amt_ind.arr,"R")==0)
		{
		 if(nd_tot_subdiv_amt!=0)
		 {
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp,"\n%-61.61s ",loc_legend[750]);
			else
			fprintf(fp,"\n%-45.45s ",loc_legend[750]);
			}
			else
			{
			 if(l_no_of_clumns ==5)
			 fprintf(fp,"\n%-52.52s ",loc_legend[750]);
			 else
			 if(l_no_of_clumns ==6)
			 fprintf(fp,"\n%-55.55s ",loc_legend[750]);
			 else
			 fprintf(fp,"\n%-41.41s ",loc_legend[750]);
			}
			 print_formated_amt(nd_tot_subdiv_amt);
			fprintf(fp,"\n"); //lsr_line_cnt();
		 }
		}
		if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0)
		{
		 if(nd_tot_subdiv_amt!=0)
		 {
			
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp,"\n%-61.61s ",loc_legend[750]);
			else
			fprintf(fp,"\n%-45.45s ",loc_legend[750]);
			}
			else
			{
			 if(l_no_of_clumns ==5)
			 fprintf(fp,"\n%-52.52s ",loc_legend[750]);
			 else
			 if(l_no_of_clumns ==6)
			 fprintf(fp,"\n%-55.55s ",loc_legend[750]);
			 else
			 fprintf(fp,"\n%-41.41s ",loc_legend[750]);
			 print_formated_amt(nd_tot_subdiv_amt);
			 fprintf(fp,"\n"); //lsr_line_cnt();
		   }
		 }
		}
		if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
		{
		 if (strcmp(c_serv_disc_on_gross_ind.arr,"R")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
		 {
		   if(p_tot_pat_disc_amt!=0)
		   {	
			
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," %-61.61s",loc_legend[710]);
			else
			fprintf(fp," %-45.45s",loc_legend[710]);
			}
			else
			{
			 if(l_no_of_clumns ==5)
		     fprintf(fp," %-52.52s",loc_legend[710]);
			 else
			 if(l_no_of_clumns ==6)
			 fprintf(fp," %-55.55s",loc_legend[710]);
			 else
			 fprintf(fp," %-41.41s",loc_legend[710]);
			}
			 print_formated_amt(p_tot_pat_disc_amt);
			 fprintf(fp,"\n"); //lsr_line_cnt();

		   }
		 }
		}
		
  		
			/**********************************************/

			/***** Printing Additional Charge Amt as Row *****/
			if(strcmp(c_addl_charge_amt_ind.arr,"R")==0)
			{			
			  if(nd_pat_tot_addl_charge_amt!=0)
			  {
				  if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				  {
				  if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				  fprintf(fp,"%-61.61s",loc_legend[1230]);
				  else
				  fprintf(fp,"%-45.45s",loc_legend[1230]);
				  }
				  else
				  { 
				  if(l_no_of_clumns ==5)
				  fprintf(fp,"%-53.53s",loc_legend[1230]);
				  else
				  fprintf(fp,"%-42.42s",loc_legend[1230]);
				  }

				  print_formated_amt(nd_pat_tot_addl_charge_amt);
				  fprintf(fp,"\n"); //lsr_line_cnt();lsr_line_cnt();
				 
			  }
			
		    }
			
			if( strcmp(c_bill_net_payable_ind.arr,"B")==0 || strcmp(c_bill_net_payable_ind.arr,"R")==0)
			{
				
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-61.61s",loc_legend[740]);
				else
				fprintf(fp,"%-45.45s",loc_legend[740]);
				}
				else
				{
				 if(l_no_of_clumns ==5)
			     fprintf(fp,"%-53.53s",loc_legend[740]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp,"%-56.56s",loc_legend[740]);
				 else
				 fprintf(fp,"%-42.42s",loc_legend[740]);
				}
				print_formated_amt(nd_tot_pat_net_charge_amt);
				fprintf(fp,"\n");lsr_line_cnt();
				get_rounded_amt(nd_tot_pat_net_charge_amt);

			   if(nd_rounded_amt!=0)
			   {
				/***** It will print the rounded amt *****/
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-61.61s",loc_legend[1240]);
				else
				fprintf(fp,"%-45.45s",loc_legend[1240]);
				}
				else
				{
				 if(l_no_of_clumns ==5)
				 fprintf(fp,"%-53.53s",loc_legend[1240]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp,"%-56.56s",loc_legend[1240]);
			     else
				 fprintf(fp,"%-42.42s",loc_legend[1240]);
				}
				print_formated_amt(nd_rounded_amt);
				fprintf(fp,"\n");lsr_line_cnt();

				/***** It Will Print the after rounded amt of Net Payable Amt ********/ 
			 	if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-61.61s",loc_legend[1250]);
				else
				fprintf(fp,"%-45.45s",loc_legend[1250]);
				}
				else
				{
				 if(l_no_of_clumns ==5)
				 fprintf(fp,"%-53.53s",loc_legend[1250]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp,"%-56.56s",loc_legend[1250]);
				 else
				 fprintf(fp,"%-42.42s",loc_legend[1250]);
				}
				print_formated_amt(nd_net_pay_amt_after_rounded);
				fprintf(fp,"\n"); //lsr_line_cnt(); 
               }

			 }
				 
				/***** upto here ********/

				/***** added on 30/09/2008 for printing package deposit if it is there ********/ 

				if(l_pkg_len!=0)
				{
					
					/*** added below code by raghava for SCF-92 ***/

					for(i=1;i<=l_pkg_len;i++)
					{
					  l_pkg_dep_amt=atoi(p_pkg_dep_amt[i]);
					  if(l_pkg_dep_amt!=0)
					  {
					   l_pkg_dep_exist=1; 
					   break;
					  }
					}
				   /*** upto here ***/
					
				  if(l_pkg_dep_exist==1)
				  {  	
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp,"%-61.61s",loc_legend[1260]);
					else
					fprintf(fp,"%-46.46s",loc_legend[1260]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp,"%-52.52s",loc_legend[1260]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp,"%-56.56s",loc_legend[1260]);
					 else
					 fprintf(fp,"%-42.42s",loc_legend[1260]);
					}
					fprintf(fp,"\n");lsr_line_cnt(); 
					for(i=1;i<=l_pkg_len;i++)
					{
					   l_pkg_dep_amt=atoi(p_pkg_dep_amt[i]); //atoi function will convert string to double
                       if(l_pkg_dep_amt!=0)
					   {
					  
							if((strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0) &&(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0))
							fprintf(fp,"       %-30.30s : %-18.18s",loc_legend[1290],p_pkg_seq_num[i]);
							else
							{
							 if(l_no_of_clumns ==5)
							 fprintf(fp,"       %-21.21s : %-18.18s",loc_legend[1290],p_pkg_seq_num[i]);
							 else
							 if(l_no_of_clumns ==6)
				    		 fprintf(fp,"       %-21.21s : %-21.21s",loc_legend[1290],p_pkg_seq_num[i]);
							 else
							 fprintf(fp,"       %-21.21s : %-11.11s",loc_legend[1290],p_pkg_seq_num[i]);
							}
								
							print_formated_amt(l_pkg_dep_amt);
							fprintf(fp,"\n"); //lsr_line_cnt();
						} 
					}

				  }
				}

					
			
			/************* IT PRINTS THE BILL ADJUSTMENTS **************/

			/****** Bill Adjustments As Saparate Row ******/
	
			if (strcmp(c_all_oth_adj_amt_ind.arr,"R")==0)  
			{
			    if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
				{
				 if(nd_tot_disc_amount!=0)
				 {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[790]);
					else
					fprintf(fp," %-45.45s",loc_legend[790]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
				     fprintf(fp," %-52.52s",loc_legend[790]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[790]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[790]);
					}
					print_formated_amt(nd_tot_disc_amount);
					fprintf(fp,"\n"); //lsr_line_cnt();
				 }
				}
				
			  if((d1_tot_adjust_amt!=0)||(strcmp(c_print_zero_other_adj_yn.arr,"Y")==0))
			  {	
				
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-60.60s",loc_legend[780]);
				else
				fprintf(fp," %-44.44s",loc_legend[780]);
				}
				else
			    {
				 if(l_no_of_clumns ==5)
			     fprintf(fp," %-52.52s",loc_legend[780]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp," %-55.55s",loc_legend[780]);
				 else
				 fprintf(fp," %-41.41s",loc_legend[780]);
				}
				print_formated_amt(d1_tot_adjust_amt);
				fprintf(fp,"\n"); //lsr_line_cnt();
			  }

			  if(d1_bill_tot_exmpt_amt!=0)
			  {
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-61.61s",loc_legend[720]);
				else
				fprintf(fp," %-45.45s",loc_legend[720]);
				}
				else
				{
				 if(l_no_of_clumns ==5)
			     fprintf(fp," %-52.52s",loc_legend[720]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp," %-55.55s",loc_legend[720]);
				 else
				 fprintf(fp," %-41.41s",loc_legend[720]);
				}
				print_formated_amt(d1_bill_tot_exmpt_amt);
				fprintf(fp,"\n"); //lsr_line_cnt();
			  }
			
			  if(d1_tot_write_off_amt!=0)
			  {
				
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp," %-61.61s",loc_legend[800]);
				else
				fprintf(fp," %-45.45s",loc_legend[800]);
				}
				else
				{
				 if(l_no_of_clumns ==5)
			     fprintf(fp," %-52.52s",loc_legend[800]);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp," %-55.55s",loc_legend[800]);
				 else
				 fprintf(fp," %-41.41s",loc_legend[800]);
				}
				print_formated_amt(d1_tot_write_off_amt);
				fprintf(fp,"\n"); //lsr_line_cnt();
              }
			}

			/****** Bill Adjustments As Summerized row ******/
			if (strcmp(c_all_oth_adj_amt_ind.arr,"S")==0)  
		     {
               
			   if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			   {	
				   if(d1_tot_adjust_amt!=0 || nd_tot_disc_amount!=0||d1_bill_tot_exmpt_amt!=0||d1_tot_write_off_amt!=0)
				   {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[850]);
					else
					fprintf(fp," %-44.44s",loc_legend[850]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[850]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[850]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[850]);
					}
					print_formated_amt(d1_tot_adjust_amt+nd_tot_disc_amount+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
					fprintf(fp,"\n"); //lsr_line_cnt();
				   }
                }
				/**** Discount amount not printing from No Discount Fundtions ****/
				else
				{
				   if(d1_tot_adjust_amt!=0 ||d1_bill_tot_exmpt_amt!=0||d1_tot_write_off_amt!=0)
				   {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[850]);
					else
					fprintf(fp," %-44.44s",loc_legend[850]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[850]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[850]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[850]);
					}
					print_formated_amt(d1_tot_adjust_amt+d1_bill_tot_exmpt_amt+d1_tot_write_off_amt);
					fprintf(fp,"\n"); //lsr_line_cnt();
				   }
				
				}
			   if (strcmp(c_bill_adj_sep_row_yn.arr,"Y")==0)
			    {
				  if((d1_tot_adjust_amt!=0)|| (strcmp(c_print_zero_other_adj_yn.arr,"Y")==0)) //for crf-659
				  {
				 	if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[780]);
					else
					fprintf(fp," %-44.44s",loc_legend[780]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[780]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[780]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[780]);
					}
					print_formated_amt(d1_tot_adjust_amt);
					fprintf(fp,"\n"); //lsr_line_cnt();
				  }
				  
				}
			 
			   if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			   {
				 if (strcmp(c_bill_disc_sep_row_yn.arr,"Y")==0)
				 {
				   if(nd_tot_disc_amount!=0)
				   {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[790]);
					else
					fprintf(fp," %-45.45s",loc_legend[790]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[790]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[790]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[790]);
					}
					print_formated_amt(nd_tot_disc_amount);
					fprintf(fp,"\n"); //lsr_line_cnt();
				   }			
				 }
			   }
			 
			 	if (strcmp(c_bill_exm_sep_row_yn.arr,"Y")==0)
			    {
                 if(d1_bill_tot_exmpt_amt!=0)
				 {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[720]);
					else
					fprintf(fp," %-45.45s",loc_legend[720]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[720]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[720]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[720]);
					}
					print_formated_amt(d1_bill_tot_exmpt_amt);
					fprintf(fp,"\n"); //lsr_line_cnt();
				 }
				}
			 
			    if (strcmp(c_bill_wo_sep_row_yn.arr,"Y")==0)
			    {
				  if(d1_tot_write_off_amt!=0)
				  {
					if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp," %-61.61s",loc_legend[800]);
					else
					fprintf(fp," %-45.45s",loc_legend[800]);
					}
					else
					{
					 if(l_no_of_clumns ==5)
					 fprintf(fp," %-52.52s",loc_legend[800]);
					 else
					 if(l_no_of_clumns ==6)
					 fprintf(fp," %-55.55s",loc_legend[800]);
					 else
					 fprintf(fp," %-41.41s",loc_legend[800]);
					}
					print_formated_amt(d1_tot_write_off_amt);
					fprintf(fp,"\n"); //lsr_line_cnt();
				  }
				}
			 
			 }
	
	
		if(strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS3")==0||strcmp(nd_calling_pgm_id.arr,"BLRIPDS2")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS3")==0 ||strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0
		 || strcmp(l_no_settlement_details.arr,"R")==0 || strcmp(l_no_settlement_details.arr,"N")==0)
		{
		    	
			/****** Deposit Printing ******/
			if(d_deposit_adj_amt!=0)
			{
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp,"%-61.61s",loc_legend[880]);
			else
			fprintf(fp,"%-45.45s",loc_legend[880]);
			}
			else
			{
			 if(l_no_of_clumns ==5)
			 fprintf(fp,"%-53.53s",loc_legend[880]);
			 else
			 if(l_no_of_clumns ==6)
			 fprintf(fp,"%-56.56s",loc_legend[880]);
			 else
			 fprintf(fp,"%-42.42s",loc_legend[880]);
			}
			print_formated_amt(d_deposit_adj_amt);
			fprintf(fp,"\n"); //lsr_line_cnt();
			}
			
			/****** Bill Paid Amt Printing ******/
		   if(d_bill_paid_amt!=0)
		   {
			if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
            {
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			   fprintf(fp,"%-62.62s\n",loc_legend[1150]);
			   else
				fprintf(fp,"%-44.44s\n",loc_legend[1150]);
			   print_payment_dtls();
				
			   fprintf(fp,"%-48.48s"," ");
			}
			else
			{
				if(l_no_of_clumns ==5)
				{
				  fprintf(fp,"%-53.53s\n",loc_legend[1150]);
				  print_payment_dtls();
				  fprintf(fp,"%-53.53s"," ");
				}
				else
				if(l_no_of_clumns ==6)
				{
				 fprintf(fp,"%-56.56s\n",loc_legend[1150]);
				 print_payment_dtls();
				 fprintf(fp,"%-56.56s"," ");
				}
				else
				{
				 fprintf(fp,"%-42.42s\n",loc_legend[1150]);
				 print_payment_dtls();
				 fprintf(fp,"%-42.42s"," ");
				}
			}
			print_formated_amt(d_bill_paid_amt);
			fprintf(fp,"\n"); //lsr_line_cnt();
		   }
		   	
		    /****** Outstanding Amt  Printing ******/
			
		   //if(d_bill_tot_outst_amt!=0)
		  // {
					
				if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				fprintf(fp,"%-31.31s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
				else
				fprintf(fp,"%-31.31s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
				}
				else
				{
				 if(l_no_of_clumns ==5)
				 fprintf(fp,"%-36.36s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
				 else
				 if(l_no_of_clumns ==6)
				 fprintf(fp,"%-39.39s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
				 else
				 fprintf(fp,"%-25.25s %-16.16s",loc_legend[890],nd_curr_date_t.arr);
				}
				
				print_formated_amt(d_bill_tot_outst_amt);
			   }	
			

       // }
        
	  if(nd_net_pay_amt_after_rounded!=0)
	  {
	   amount=nd_net_pay_amt_after_rounded;
	   print_amt_in_words();
	  }
	  else
      {
	   amount=nd_tot_pat_net_charge_amt;
	   print_amt_in_words();
	  }	
	 } 
	 /**** Discount Document *****/
	 else
	 {
		
	     get_cnt_remain_space(1);
	  /* Here l_lcnt+5 Meaning 'l_lcnt' for how many line for footer part and '5' for Signature */ 	

		if((l_lcnt+5)<=(max_lines-v_lno))  
		{
			
			if(c_disc_amt_in_dtl_yn.arr[0]=='N' && c_servdate_in_dtlformat_yn.arr[0]=='Y')
			{
			 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			 fprintf(fp,"%-62.62s",loc_legend[680]);
			 else
			 fprintf(fp,"%-45.45s",loc_legend[680]);
			 print_formated_amt(nd1_tot_serv_tot_disc);
			}
			else
			if(c_disc_amt_in_dtl_yn.arr[0]=='N' && c_servdate_in_dtlformat_yn.arr[0]=='N')
			{
			 fprintf(fp,"%-60.60s",loc_legend[680]);
			 print_formated_amt(nd1_tot_serv_tot_disc);
			 amount=nd1_tot_serv_tot_disc;
			 print_amt_in_words();
			}
			else
			{
			 fprintf(fp,"%-42.42s"," ");
			 print_formated_amt(nd1_tot_serv_charge_discount);
			 print_formated_amt(nd1_tot_serv_bill_discount);
			 print_formated_amt(nd1_tot_serv_fund_adjustment);
			 fprintf(fp,"\n");lsr_line_cnt();
			 fprintf(fp,"%-42.42s",loc_legend[680]);
			 print_formated_amt(nd1_tot_serv_charge_discount+nd1_tot_serv_bill_discount+nd1_tot_serv_fund_adjustment);
			 amount=nd1_tot_serv_charge_discount+nd1_tot_serv_bill_discount+nd1_tot_serv_fund_adjustment;
			 print_amt_in_words();

			}
		}
		else
		{
			
			 while(v_lno<=max_lines)
			  {
				fprintf(fp,"\n");
				v_lno++;
			  }
			lsr_line_cnt();
			if(c_disc_amt_in_dtl_yn.arr[0]=='N')
			{
			 fprintf(fp,"%-60.60s",loc_legend[680]);
			 print_formated_amt(nd1_tot_serv_tot_disc);
			 amount=nd1_tot_serv_tot_disc;
			 print_amt_in_words();
			}
			else
			{
			 fprintf(fp,"%-42.42s"," ");
			 print_formated_amt(nd1_tot_serv_charge_discount);
			 print_formated_amt(nd1_tot_serv_bill_discount);
			 print_formated_amt(nd1_tot_serv_fund_adjustment);
			 fprintf(fp,"\n");lsr_line_cnt();
			 fprintf(fp,"%-42.42s",loc_legend[680]);
			 print_formated_amt(nd1_tot_serv_charge_discount+nd1_tot_serv_bill_discount+nd1_tot_serv_fund_adjustment);
			 amount=nd1_tot_serv_charge_discount+nd1_tot_serv_bill_discount+nd1_tot_serv_fund_adjustment;
			 print_amt_in_words();

			}
		}

	 }

		print_sign_designation();
		if (strcmp(nd_bill_format_id.arr,"1")==0)
		if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
		{
		  fprintf(fp,"\n%-64.64s %-s  %-s %-s\n"," ",loc_legend[1425],nd_curr_date_t.arr,loc_legend[1424]);
		}
		if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0) //IN13383
		print_footer1();
		

}
print_payment_dtls()
{

    declare_payment_type_det();
	open_payment_cur();
 
   while(fetch_payment_det_cur())
   {
	  
	if(d_slmt_doc_ref_date.arr[0]!='\0')
	{
	  init_date_temp_var();
	  strcpy(date_convert.arr,d_slmt_doc_ref_date.arr);
	  fun_change_loc_date();
	  strcpy(d_slmt_doc_ref_date.arr,nd_loc_date1.arr);
	 }
	  
	  if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
	  {
		  if(strcmp(c_addl_charge_amt_ind.arr,"C")==0 || strcmp(c_addl_charge_amt_ind.arr,"B")==0 )
		  {
		  get_addlcharge_count();
		  if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
		  fprintf(fp,"%-25.25s %-10.10s (%-14.14s)",d_rcpt_doc_type_num.arr,d_slmt_doc_ref_date.arr,d_settlement_desc.arr);
		  else
		  fprintf(fp,"%-25.25s %-10.10s (%-9.9s)",d_rcpt_doc_type_num.arr,d_slmt_doc_ref_date.arr,d_settlement_desc.arr);
		  }
		  else
		  fprintf(fp,"%-25.25s %-10.10s (%-9.9s)",d_rcpt_doc_type_num.arr,d_slmt_doc_ref_date.arr,d_settlement_desc.arr);
	  }
	  else
	  if(l_no_of_clumns ==6)
	  {
	   fprintf(fp,"%-29.29s %-10.10s (%-9.9s)",d_rcpt_doc_type_num.arr,d_slmt_doc_ref_date.arr,d_settlement_desc.arr);
	  }
	  else
	  {
	    fprintf(fp,"%-15.15s %-10.10s (%-13.13s)",d_rcpt_doc_type_num.arr,d_slmt_doc_ref_date.arr,d_settlement_desc.arr);
	  }
	  
	  print_formated_amt(d_rcpt_amt);
      
     fprintf(fp,"\n");
	 lsr_line_cnt();
   }
	close_payment_cur();

}
print_amt_in_words()
{
      fun_amt_in_words();
	  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
	  fprintf(fp,"\n\n%-20.20s : %-s",loc_legend[1403],amt_in_words_Sep.arr);
	  else
	  fprintf(fp,"\n\n%-s(%-s)    (%-s)",loc_legend[1000],loc_legend[1423],amt_in_words_Sep.arr);
	  fprintf(fp,"\n\n");
	  lsr_line_cnt();lsr_line_cnt();
}
fun_amt_in_words()
{
 	amt_in_words.arr[0]='\0';
	amt_in_words.len=0;
	
	amt_in_words_Sep.arr[0]='\0';
	amt_in_words_Sep.len=0;
						 //abs(nvl(:nd_tot_pat_net_charge_amt,0)),
	EXEC SQL EXECUTE
	BEGIN		
	:no_of_lines1:=bl_spell_number.print_in_words
						(:nd_facility_id,
						  abs(nvl(:amount,0)),
						  70,
						 :currency,
						 :sub_cur,
						 :nd_decimal,
						 :amt_in_words,
						 :amt_in_words_Sep1);
  	END;
	END-EXEC;
	amt_in_words.arr[amt_in_words.len]='\0';
	amt_in_words_Sep1.arr[amt_in_words_Sep1.len]='\0';

if(amount!=0)
{

	EXEC SQL SELECT REPLACE(:amt_in_words_Sep1,'~',CHR(10)||'                              ') 
			 INTO :amt_in_words_Sep
			 FROM DUAL;
}
else
{
  	EXEC SQL SELECT :amt_in_words
			 INTO :amt_in_words_Sep
			 FROM DUAL;
}
	amt_in_words_Sep.arr[amt_in_words_Sep.len]='\0';

}
declare_payment_type_det()
{
 
 EXEC SQL DECLARE PAYMENT_CUR CURSOR FOR
			Select DOC_TYPE_CODE||'/'||DOC_NUMBER||'/'||DOC_SRNO,
			DOC_DATE,DOC_AMT,A.SLMT_TYPE_CODE,b.SHORT_DESC        
			from bl_receipt_refund_dtl_vw A,BL_SLMT_TYPE B
			Where operating_facility_id = :nd_facility_id
			and a.SLMT_TYPE_CODE=b.SLMT_TYPE_CODE
			and patient_id = :d_patient_id
			and RECPT_NATURE_CODE in ('BI','DC','IN')
			and nvl(CANCELLED_IND,'N')='N'
			and ((BILL_DOC_TYPE_CODE = :d1_doc_type and BILL_DOC_NUMBER = :d1_doc_number) OR
			((DOC_TYPE_CODE, DOC_NUMBER,DOC_SRNO) In ( select ORG_DOC_TYPE_CODE,  ORG_DOC_NUM ,ORG_DOC_SRNO from bl_patient_ledger 
			Where operating_facility_id = :nd_facility_id
			and AD_PR_ADJ_BILL_DOC_TYPE = :d1_doc_type and AD_PR_ADJ_BILL_DOC_NUM = :d1_doc_number)));

	if (OERROR) 
	{
		disp_message (ERR_MESG,"Failed to Declare Pyament Type Cursor");
		proc_exit;
	}
	
	return;
}
open_payment_cur()
{ 
	EXEC SQL OPEN PAYMENT_CUR;

	if (OERROR) 
	{	
		disp_message (ERR_MESG,"Open payment_det_cur cursor failed");
		proc_exit();
	}
	return;
}
fetch_payment_det_cur()
{

	d_rcpt_doc_type_num.arr[0]		= '\0';
	d_slmt_doc_ref_date.arr[0]		= '\0';
	d_settlement_type_code.arr[0]   = '\0'; 
	d_settlement_desc.arr[0]		= '\0';
	
	

	d_rcpt_doc_type_num.len		= 0;
	d_slmt_doc_ref_date.len		= 0;
	d_settlement_type_code.len	= 0;
	d_settlement_desc.len		= 0;
	
	

	EXEC SQL FETCH PAYMENT_CUR INTO 
	  d_rcpt_doc_type_num,
	  d_slmt_doc_ref_date,
	  d_rcpt_amt,
	  d_settlement_type_code,
	  d_settlement_desc;


	d_rcpt_doc_type_num.arr[d_rcpt_doc_type_num.len]	    = '\0'; 
	d_slmt_doc_ref_date.arr[d_slmt_doc_ref_date.len]		= '\0';
	d_settlement_type_code.arr[d_settlement_type_code.len]	= '\0';
	d_settlement_desc.arr[d_settlement_desc.len]			= '\0';
	


  if(NODATAFOUND)
	{
		return 0;
	}
  

  if(OERROR)
	{ 
		err_mesg("FETCH FAILED IN PAYMENT_CUR",0,"");
		proc_exit();
	}

    return 1;

}
close_payment_cur()
{ 
	EXEC SQL CLOSE PAYMENT_CUR;
	if (OERROR) 
	{
		disp_message (ERR_MESG,"Close header cursor failed");
		proc_exit();
	}
	return;
}
get_cnt_remain_space(int cnt)
{

if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
{ 
 if (cnt==1 || cnt==2 || cnt==3)
 {
	if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
	 l_lcnt++;
	else
	if(l_no_of_clumns ==6)
	 l_lcnt++;
	else
	l_lcnt++;

	if (strcmp(c_gross_net_amt_ind.arr,"G")==0)
	l_lcnt++;
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0)
	l_lcnt++;

	 if (cnt==1 || cnt==2)
	 { 
		if( strcmp(c_bill_subsidized_amt_ind.arr,"R")==0)
		{
		 if(nd_tot_subdiv_amt!=0)
		 {
			if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			l_lcnt++;
			else
			if(l_no_of_clumns ==6)
			l_lcnt++;
			else
			l_lcnt++;
		 }
		}

		if( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0)
		{
		 if(nd_tot_subdiv_amt!=0)
		 {
			if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			l_lcnt++;
			else
			if(l_no_of_clumns ==6)
			l_lcnt++;
			else
			l_lcnt++;
		 }
		}

	 }

	if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
	{
	 if (strcmp(c_serv_disc_on_gross_ind.arr,"R")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0)   
	 {
	   if(p_tot_pat_disc_amt!=0)
	   {	
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	   }
	 }
	}

 if (cnt==2)
 {
   if(strcmp(c_oth_payers_amt_print_row_ind.arr,"R")==0)
	{
       	if(p<=1) 
	{
	  if(strcmp(nd_cust_code1.arr,"\0")!=0)
	  {
	     if(l_no_of_clumns ==5 || l_no_of_clumns ==6|| strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
	      l_lcnt++;
	     else
	      l_lcnt++;
				
	  }

	}
	else
	{
	  if(strcmp(nd_cust_code1.arr,"\0")!=0)
	  {
		if(l_no_of_clumns ==5 || l_no_of_clumns ==6|| strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		l_lcnt++;
				  
	  }
	for (i=1;i<=p;++i)
	{
	 if(strcmp(ar_cust_amt[i],"\0")!=0)
	 l_lcnt=l_lcnt+1;
	}
	 l_lcnt=l_lcnt+1;
	}

   }
	
 }	
	
	if(strcmp(c_addl_charge_amt_ind.arr,"R")==0)
	{

	  if(nd_pat_tot_addl_charge_amt!=0)
	  {
	  if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
	  l_lcnt++;
	  else
	  l_lcnt++;
	  }

	}

	if( strcmp(c_bill_net_payable_ind.arr,"B")==0 || strcmp(c_bill_net_payable_ind.arr,"R")==0)
	{
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;

	   if(nd_rounded_amt!=0)
	   {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;

		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	   }

	 }

	if(l_pkg_len!=0)
	{
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
		for(i=1;i<=l_pkg_len;i++)
		{
			if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			l_lcnt++;
			else
			if(l_no_of_clumns ==6)
			l_lcnt++;
			else
			l_lcnt++;
		}
	}

	if (strcmp(c_all_oth_adj_amt_ind.arr,"R")==0)  
	{
	  if((d1_tot_adjust_amt!=0)||(strcmp(c_print_zero_other_adj_yn.arr,"Y")==0))
	  {	
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	  }

		if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
		{
		 if(nd_tot_disc_amount!=0)
		 {
			if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			l_lcnt++;
			else
			if(l_no_of_clumns ==6)
			l_lcnt++;
			else
			l_lcnt++;
		 }
		}
		
	  if(d1_bill_tot_exmpt_amt!=0)
	  {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	  }

	  if(d1_tot_write_off_amt!=0)
	  {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	  }
	}


	if (strcmp(c_all_oth_adj_amt_ind.arr,"S")==0)  
	{
	  if(d1_tot_adjust_amt!=0 || nd_tot_disc_amount!=0||d1_bill_tot_exmpt_amt!=0||d1_tot_write_off_amt!=0)
	   {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	   }

      if (strcmp(c_bill_adj_sep_row_yn.arr,"Y")==0)
	  {
	   if((d1_tot_adjust_amt!=0)|| (strcmp(c_print_zero_other_adj_yn.arr,"Y")==0)) //for crf-659
	   l_lcnt++;
	   
	  }
	  if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
	  {
	   if (strcmp(c_bill_disc_sep_row_yn.arr,"Y")==0)
	   {
	    if(nd_tot_disc_amount!=0)
	    l_lcnt++;
	   }
	  }
	
	 if (strcmp(c_bill_exm_sep_row_yn.arr,"Y")==0)
	 {
	  if(d1_bill_tot_exmpt_amt!=0)
	  l_lcnt++;
	 }
	
	 if (strcmp(c_bill_wo_sep_row_yn.arr,"Y")==0)
	 {
	  if(d1_tot_write_off_amt!=0)
	  l_lcnt++;
	 }
	}

	if(strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0)
	{
   		if(d_deposit_adj_amt!=0)
		{
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
		}
	
	   if(d_bill_paid_amt!=0)
	   {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	   }
		
	   if(d_bill_tot_outst_amt!=0)
	   {
		if((l_no_of_clumns ==5) || strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
		l_lcnt++;
		else
		if(l_no_of_clumns ==6)
		l_lcnt++;
		else
		l_lcnt++;
	   }	
		

	  }
  }

 }
 else
 {
  	if(c_disc_amt_in_dtl_yn.arr[0]=='N')
	l_lcnt=l_lcnt+7;
	else
	l_lcnt=l_lcnt+8;
 }

}
print_bold_underline()
{
	fprintf(fp,"%c(s12H",ESC);
	fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style  */
	fprintf(fp,"%c&d0D",ESC);   /* set Underline mode */
}
Release_bold_underline()
{
	fprintf(fp,"%c(s14H",ESC); 
	fprintf(fp,"%c&d@",ESC); 
	fprintf(fp,"%c(s-3B",ESC);
}
/* THIS FUNCTION FOR GETTING GROSS,NET,DISCOUNT AMT */
get_gross_net_amt()
{
  
  EXEC SQL EXECUTE
				BEGIN
				BLCOMMON.GET_SERV_TOT_AMT_BY_TRX(
				:nd_facility_id,
				:d1_trx_doc_ref,
				:d1_trx_doc_ref_line_num,
				:p_pat_gross_amt,
				:p_pat_disc_amt,
				:p_pat_net_amt,
				:p_err_level,
				:p_sys_message_id,
				:p_error_text);
                 
				if :p_sys_message_id is not null then
				:p_err_level := '10';
				:p_error_text := blcommon.get_error_text(:p_sys_message_id);
				end if;

				END;
				END-EXEC;

			if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
				{
					disp_message(ERR_MESG,p_error_text.arr);
					proc_exit(0);
				}

				p_err_level.arr[0] = '\0';
				p_err_level.len = 0;

				p_sys_message_id.arr[0] = '\0';
				p_sys_message_id.len = 0;

				p_error_text.arr[0] = '\0';
				p_error_text.len = 0;


}
get_gross_net_amt1()
{
	
	EXEC SQL EXECUTE
				BEGIN
				BLCOMMON.GET_SERV_TOT_AMT_BY_TRX(
				:nd_facility_id,
				:d_trx_doc_ref,
				:d_trx_doc_ref_line_num,
				:p_gross_amt,
				:p_disc_amt,
				:p_net_amt,
				:p_err_level,
				:p_sys_message_id,
				:p_error_text);

				if :p_sys_message_id is not null then
				:p_err_level := '10';
				:p_error_text := blcommon.get_error_text(:p_sys_message_id);
				end if;

				END;
				END-EXEC;

				if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
				{
				proc_exit(0);
				}

				p_err_level.arr[0] = '\0';
				p_err_level.len = 0;

				p_sys_message_id.arr[0] = '\0';
				p_sys_message_id.len = 0;

				p_error_text.arr[0] = '\0';
				p_error_text.len = 0;


}
get_closed_packages()
{

  	p_pkg_seq_num_str.arr[0] ='\0';
	p_pkg_seq_num_str.len	 =  0;
	p_pkg_amt_str.arr[0]	 ='\0';
	p_pkg_amt_str.len		 =  0;
	p_pkg_dep_str.arr[0]	 ='\0';
	p_pkg_dep_str.len		 =  0;

	temp_pkg_seq_num_str.arr[0] ='\0';
	temp_pkg_seq_num_str.len	 =  0;
	temp_pkg_amt_str.arr[0]	 ='\0';
	temp_pkg_amt_str.len		 =  0;
	temp_pkg_dep_str.arr[0]	 ='\0';
	temp_pkg_dep_str.len		 =  0;



  EXEC SQL EXECUTE
		
		   BEGIN

			 BL_PROC_FOR_EXT_SERVICE_MP.CLOSED_PKG_BILL_LIST(
			:nd_facility_id,
			:d_patient_id,
			:d1_doc_type,
			:d1_doc_number,
		    :p_pkg_seq_num_str,
			:p_pkg_amt_str,
			:p_pkg_dep_amt_str,
			:p_pkg_dep_str,
			:p_err_level,
			:p_sys_message_id,
			:p_error_text);

			
			if :p_sys_message_id is not null then
			:p_err_level := '10';
			:p_error_text := blcommon.get_error_text(:p_sys_message_id);
			end if;
			
			
			END;
			END-EXEC;
	
	
			if (strcmp(p_err_level.arr,"10") == 0 && p_error_text.arr[0] != '\0')
			{
			 proc_exit(0);
			}

			p_err_level.arr[0] = '\0';
			p_err_level.len = 0;

			p_sys_message_id.arr[0] = '\0';
			p_sys_message_id.len = 0;

			p_error_text.arr[0] = '\0';
			p_error_text.len = 0;

			p_pkg_seq_num_str.arr[p_pkg_seq_num_str.len]='\0';
			p_pkg_amt_str.arr[p_pkg_amt_str.len]='\0';
			p_pkg_dep_str.arr[p_pkg_dep_str.len]='\0';

			strcpy(temp_pkg_seq_num_str.arr,p_pkg_seq_num_str.arr);
			strcpy(temp_pkg_amt_str.arr,p_pkg_amt_str.arr);
			strcpy(temp_pkg_dep_str.arr,p_pkg_dep_str.arr);

			
			temp_pkg_seq_num_str.len = strlen(temp_pkg_seq_num_str.arr);
			temp_pkg_seq_num_str.arr[temp_pkg_seq_num_str.len] = '\0';

			temp_pkg_amt_str.len = strlen(temp_pkg_amt_str.arr);
			temp_pkg_amt_str.arr[temp_pkg_amt_str.len] = '\0';

			temp_pkg_dep_str.len = strlen(temp_pkg_dep_str.arr);
			temp_pkg_dep_str.arr[temp_pkg_dep_str.len] = '\0';

			p_pkg_seq_num_str.arr[0]='\0';
			p_pkg_amt_str.arr[0]='\0';
			p_pkg_dep_str.arr[0]='\0';
			

			if (temp_pkg_seq_num_str.arr[0] != '\0')
			{
				
				  EXEC SQL SELECT length(:temp_pkg_seq_num_str)-length(replace(:temp_pkg_seq_num_str,',',null)) + 1
						   INTO :l_pkg_len
						   FROM DUAL;   //PACKAGE LENGTH 
				
				//sprintf(st_var,"%d",l_pkg_len);
				//disp_message(ERR_MESG,st_var);
		
				  for(i=1;i<=l_pkg_len;i++)
				  {
					  
					  
					  
					  EXEC SQL SELECT SUBSTR(:temp_pkg_seq_num_str,1,INSTR(:temp_pkg_seq_num_str,',')-1),
									  SUBSTR(:temp_pkg_amt_str,1,INSTR(:temp_pkg_amt_str,',')-1),
									  SUBSTR(:temp_pkg_dep_str,1,INSTR(:temp_pkg_dep_str,',')-1)
							   INTO   :p_pkg_seq_num_str,
									  :p_pkg_amt_str,
									  :p_pkg_dep_str
								FROM DUAL;

					 

					  EXEC SQL SELECT  rtrim(SUBSTR(:temp_pkg_seq_num_str,INSTR(:temp_pkg_seq_num_str,',')+1)),
									   rtrim(SUBSTR(:temp_pkg_amt_str,INSTR(:temp_pkg_amt_str,',')+1)),
									   rtrim(SUBSTR(:temp_pkg_dep_str,INSTR(:temp_pkg_dep_str,',')+1))
							   INTO   :temp_pkg_seq_num_str,
									  :temp_pkg_amt_str,
									  :temp_pkg_dep_str
								FROM DUAL;

						
						p_pkg_seq_num_str.arr[p_pkg_seq_num_str.len]='\0';
						p_pkg_amt_str.arr[p_pkg_amt_str.len]='\0';
						p_pkg_dep_str.arr[p_pkg_dep_str.len]='\0';
						
						strcpy(p_pkg_seq_num[i],p_pkg_seq_num_str.arr);
						strcpy(p_pkg_amt[i],p_pkg_amt_str.arr);
						strcpy(p_pkg_dep_amt[i],p_pkg_dep_str.arr);
					
						temp_pkg_seq_num_str.arr[temp_pkg_seq_num_str.len]='\0';
						temp_pkg_amt_str.arr[temp_pkg_amt_str.len]='\0';
						temp_pkg_dep_str.arr[temp_pkg_dep_str.len]='\0';
											
						
				   }
					
						
						strcpy(p_pkg_seq_num[l_pkg_len],temp_pkg_seq_num_str.arr);
						strcpy(p_pkg_amt[l_pkg_len],temp_pkg_amt_str.arr);
						strcpy(p_pkg_dep_amt[l_pkg_len],temp_pkg_dep_str.arr);

		        }


}			


get_cashier_name()
{

  nd_cashier_name.arr[0]='\0';
  nd_cashier_name.len	  =0; 

  

  EXEC SQL SELECT DISTINCT APPL_USER_NAME
  INTO  :nd_cashier_name
  FROM   SM_APPL_USER_LANG 
  WHERE  APPL_USER_ID=:d_added_by_id
  AND	 LANGUAGE_ID  =:nd_lang_id;
  


 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }
 
  nd_cashier_name.arr[nd_cashier_name.len]='\0';
   
}

/* Getting designation of cashier */

get_cashier_designation()
{
 
 
 nd_cahier_position.arr[0] ='\0';
 nd_cahier_position.len	   = 0;


 EXEC SQL EXECUTE
    
	DECLARE
    nd_func_role  VARCHAR2(3);
	
	BEGIN
		
		SELECT FUNC_ROLE 
		INTO nd_func_role
        FROM SM_APPL_USER_LANG_VW 
		WHERE  APPL_USER_ID=:d_added_by_id
        AND	 LANGUAGE_ID  =:nd_lang_id;

		IF nd_func_role='O' THEN

		SELECT long_desc 
		INTO :nd_cahier_position
		FROM sm_appl_user_lang_vw a,am_other_staff b,am_other_staff_type_lang_vw C
		WHERE a.appl_user_id=:d_added_by_id
		AND a.FUNC_ROLE='O'
		AND b.OTHER_STAFF_ID = a.FUNC_ROLE_ID
		AND c.OTHER_STAFF_TYPE = b.OTHER_STAFF_TYPE
		AND c.language_id=:nd_lang_id
		AND a.language_id=:nd_lang_id;

		END IF;



	END;

END-EXEC;
 
    
    nd_cahier_position.arr[nd_cahier_position.len]='\0';

 if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM SM_APPL_USER TABLE");
	  }

 
}
get_pkg_name()
{

  nd_package_code.arr[0]='\0';
  nd_package_code.len	  =0; 


  EXEC SQL SELECT DISTINCT PRICE_CLASS_CODE
  INTO  :nd_package_code
  FROM   BL_PATIENT_PACKAGE_HDR 
  WHERE  OPERATING_FACILITY_ID=:nd_facility_id
  AND	 PATIENT_ID  =:d_patient_id
  AND    PACKAGE_SEQ_NO=:l_pkg_seq_num;
  

 
   if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_PATIENT_PACKAGE_HDR TABLE");
	  }
 
    nd_package_code.arr[nd_package_code.len]='\0';

	if(nd_package_code.arr[0]!='\0')
	{
    
	  get_package_desc();

	} 

}
get_package_desc()
{
  nd_package_desc.arr[0]='\0';
  nd_package_desc.len	  =0; 


  EXEC SQL SELECT LONG_DESC
  INTO  :nd_package_desc
  FROM   BL_PRICE_CLASS_LANG_VW 
  WHERE  OPERATING_FACILITY_ID=:nd_facility_id
  AND	 LANGUAGE_ID  =:nd_lang_id
  AND    PRICE_CLASS_CODE=:nd_package_code;
  


   if (OERROR)
	  { 
		disp_message (ERR_MESG,"FETCH FAILED FROM BL_PRICE_CLASS_LANG_VW TABLE");
	  }
 
  nd_package_desc.arr[nd_package_desc.len]='\0';



}
print_alter_id_num(char pat_type)
{

  if(strcmp(nd_bill_format_id.arr,"1")==0)
  {
    if(strcmp(p_bill_addl_id_in_ftr_yn.arr,"Y")==0)
    {
	 if (strcmp(alt_id_no.arr,"\0")!=0)
      {
		 get_alter_type_desc();
		 
		 fprintf(fp,"\n%-s: %-s",l_alt_id_type_desc.arr,alt_id_no.arr);
		 lsr_line_cnt();
		 lsr_line_cnt();

      }
     if(strcmp(patient_name.arr,"\0")!=0)
	 {
	   fprintf(fp,"\n%-s: %-s\n",loc_legend[100],patient_name.arr);
	   lsr_line_cnt();
	   lsr_line_cnt();
	 }
     else
	 fprintf(fp,"\n");lsr_line_cnt();
	}
  }
  
  else
  {
    if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
	{
	 if((pat_type=='I' && (print_ins_addl_id_in_ftr_yn.arr[0]='Y'))||(pat_type =='C' && (print_ins_addl_id_in_ftr_yn.arr[0]='Y')))
 	 {
	  if (strcmp(alt_id_no.arr,"\0")!=0)
	   {
	     get_alter_type_desc();
		 
		 fprintf(fp,"\n%-s: %-s",l_alt_id_type_desc.arr,alt_id_no.arr);
		 lsr_line_cnt();
		 lsr_line_cnt();
	   } 
	   if(strcmp(patient_name.arr,"\0")!=0)
	   {
	     if (l_lsr != 0 && l_dmp == 0)
		 fprintf(fp,"\n%-s: %-s\n",loc_legend[100],patient_name.arr);
	     else
		 fprintf(fp,"\n%-12.12s: %-s\n"," ",patient_name.arr);
		 lsr_line_cnt();
	     lsr_line_cnt();
	   }
	   else
	   fprintf(fp,"\n");lsr_line_cnt();
	 }
	}
	else
	{
	  if((pat_type=='I' && (ip_ins_addl_id_in_ftr_yn.arr[0]='Y'))||(pat_type =='C' && (ip_cr_addl_id_in_ftr_yn.arr[0]='Y')))
      { 
	   if (strcmp(alt_id_no.arr,"\0")!=0)
	   {
	     get_alter_type_desc();
		 
		 fprintf(fp,"\n%-s: %-s",l_alt_id_type_desc.arr,alt_id_no.arr);
		 lsr_line_cnt();
		 lsr_line_cnt();
	   } 
	   if(strcmp(patient_name.arr,"\0")!=0)
	   {
	     
		 if (l_lsr != 0 && l_dmp == 0)
		 fprintf(fp,"\n%-s: %-s\n",loc_legend[100],patient_name.arr);
		 else
		 fprintf(fp,"\n%-12.12s: %-s\n"," ",patient_name.arr);
	     lsr_line_cnt();
	     lsr_line_cnt();
	   }
	   else
	   fprintf(fp,"\n");lsr_line_cnt();
	  }
	  
	}
  } 
  
} 
get_alter_type_desc()
{
		l_alt_id_type_desc.arr[0] ='\0';
		l_alt_id_type_desc.len=0;

		if (strcmp(alt_id_type.arr,"****")==0)  /***added by vani for crf-518 *****/
		{
			EXEC SQL select decode(ACCEPT_NATIONAL_ID_NO_YN,'Y',NAT_ID_PROMPT,'')
					INTO  l_alt_id_type_desc
					FROM MP_PARAM;

			if(OERROR)
			{ 
			disp_message (ERR_MESG,"FETCH FAILED FROM MP_PARAM TABLE");
			}
		}
		else 
		{
			EXEC SQL SELECT SHORT_DESC
              INTO  l_alt_id_type_desc
              FROM  MP_ALTERNATE_ID_TYPE_LANG_VW
              WHERE Upper(LANGUAGE_ID)=Upper(:nd_lang_id)
              AND   ALT_ID_TYPE=:alt_id_type;
		

			if(OERROR)
			{ 
			disp_message (ERR_MESG,"FETCH FAILED FROM MP_ALTERNATE_ID_TYPE_LANG_VW TABLE");
			}
	    }

 
		 l_alt_id_type_desc.arr[l_alt_id_type_desc.len]='\0';
}
print_sign_designation()
{
  
 get_bill_format();

 if (strcmp(nd_bill_format_id.arr,"1")==0)
 {

	  fprintf(fp,"\n\n");lsr_line_cnt();lsr_line_cnt();
	  fprintf(fp,"%-37.37s %23.23s----------------------------\n"," ",loc_legend[1170]);
	  lsr_line_cnt();

	  if (l_lsr != 0 && l_dmp == 0)
	   {
	   if( l_logo_yniflaser.arr[0] != 'Y')
		fprintf(fp,"%-51.51s %-s :"," ",loc_legend[1180]); //Prepared By legend Has Moved Down by vani and only for laser printer it has to be print
		}

	  lsr_line_cnt();
	  if (l_lsr != 0 && l_dmp == 0)
	   {
	  fprintf(fp,"(%-s%-s\n",nd_cashier_name.arr,")");
	  }
	  else
	  {
	  fprintf(fp,"(%-60s.60s%-s\n",nd_cashier_name.arr,")");
	  }
	  lsr_line_cnt();
	  
	  if (strcmp(nd_cahier_position.arr,"\0")!=0)
	  {
	  fprintf(fp," %50.50s %-9.9s %-60.60s\n"," ",loc_legend[1190],nd_cahier_position.arr);
	  lsr_line_cnt();
	  }
	  /*
	  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
	  {
		fprintf(fp,"\n%-64.64s %-s  %-s %-s\n"," ",loc_legend[1425],nd_curr_date_t.arr,loc_legend[1424]);
	  }
	  */
	}
  else 
    {
	fprintf(fp,"\n");
	print_bill_footer();
	if (d_cust_code.arr[0]!='\0')
	{
	 if (d_Policy_type_code.arr[0]!='\0')
	 print_ins_bill_footer();
	 else
	 print_credit_bill_footer();
	 
	}

	 }
  
}

get_logo_dtl()
{
	
	  l_logo_yniflaser.arr[0] = 'N';

	  l_errorlevel.arr[0] = '\0';
	  l_errorlevel.len = 0;

	  l_sysmessageid.arr[0] = '\0';
	  l_sysmessageid.len = 0;

	  l_errortext.arr[0] = '\0';
	  l_errortext.len = 0;
			

	   if (l_lsr != 0 && l_dmp == 0)
	   {
		EXEC SQL EXECUTE	
		BEGIN					
			
			BLOPIN.GET_PRINT_SETUP_COL_VALUE(
				:nd_facility_id,
				'BLRVSBL1',
				'PRINT_LOGO_YN_IF_LASER',
				:l_logo_yniflaser,
				:l_errorlevel,
				:l_sysmessageid,
				:l_errortext) ;
				
			:l_logo_yniflaser := nvl(:l_logo_yniflaser,'N');

			if  :l_sysmessageid is not null then
				:l_errorlevel := '10';
				:l_errortext := blcommon.get_error_text(:l_sysmessageid);
			end if;

		END;
		END-EXEC;

		if (strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
		{
			disp_message(ERR_MESG,l_errortext.arr);
			proc_exit(0);
		}

		l_errorlevel.arr[0] = '\0';
		l_errorlevel.len = 0;

		l_sysmessageid.arr[0] = '\0';
		l_sysmessageid.len = 0;

		l_errortext.arr[0] = '\0';
		l_errortext.len = 0;
	
		
		if (l_logo_yniflaser.arr[0] == 'Y')
		{
			EXEC SQL EXECUTE	
			BEGIN				
				BLOPIN.GET_PRINT_SETUP_COL_VALUE(
					:nd_facility_id,
					'BLRBILLO',
					'LOGO_NAME',
					:l_logo_name,
					:l_errorlevel,
					:l_sysmessageid,
					:l_errortext) ;
				

				if :l_sysmessageid is not null then
					:l_errorlevel := '10';
					:l_errortext := blcommon.get_error_text(:l_sysmessageid);
				end if;

			END;
			END-EXEC;
			if (strcmp(l_errorlevel.arr,"10") == 0 && l_errortext.arr[0] != '\0')
			{
				disp_message(ERR_MESG,l_errortext.arr);
				proc_exit(0);
			}

			LOGO_DIR.arr[0] = '\0';
			LOGO_DIR.len = 0;

		       l_errorlevel.arr[0] = '\0';
		       l_errorlevel.len = 0;

		       l_sysmessageid.arr[0] = '\0';
		       l_sysmessageid.len = 0;

		       l_errortext.arr[0] = '\0';
		       l_errortext.len = 0;	

			if (nd_online_print_yn == 'N')
			{			
				EXEC SQL EXECUTE	
				BEGIN				
					WORKSTATION.GET_WS_PARAM(
						:nd_ws_no,				
						'BLLOGODIR',
						:LOGO_DIR,
						:l_errortext);			
					if :l_errortext is not null then 
						:l_errortext	:= 'BLLOGODIR:'||:l_errortext;
					end if;

				END;
				END-EXEC;
				if (l_errortext.arr[0] != '\0')
				{
					disp_message(ERR_MESG,l_errortext.arr);
					proc_exit(0);
				}		
			}
		}
	    }
   }

get_print_routing()
{
	EXEC SQL EXECUTE
	DECLARE
		l_sys_mesg_id VARCHAR2(10);
		l_err_level VARCHAR2(10);
		l_err_text VARCHAR2(1000);
		l_document_value blcommon.rectype_Tab;
		l_format_type VARCHAR2(200);
		l_report_tool_ind VARCHAR2(1);
	BEGIN
	
		blcommon.get_doc_print_format_Tab(
     			:nd_facility_id,
			:nd_calling_pgm_id,
			l_document_value,
			l_sys_mesg_id,
			l_err_level,
			l_err_text);						

		FOR i IN l_document_value.FIRST..l_document_value.LAST LOOP
			if  l_document_value(i).id = 'FORMAT_TYPE' then
				l_format_type := l_document_value(i).value;
			end if;				
			
			if l_document_value(i).id = 'REPORT_TOOL_IND' then 
				l_report_tool_ind := l_document_value(i).value;
			end if;		 	

			if l_document_value(i).id = 'INCL_PRV_RFND_AMT_IN_TOT_OUTST' then 
				:l_include_refund := NVL(l_document_value(i).value,'N');
			end if;		 			
		END LOOP;		

		if l_format_type = 'DMP_PREPRINTED' then
			:l_dmp := 1;
			:l_lsr := 0;
		elsif l_format_type in('LASER_WITH_LOGO','LASER_WITHOUT_LOGO') then
			:l_dmp := 0;
			:l_lsr := 1;
		else
			:l_dmp := 0;
			:l_lsr := 0;
		end if;
		
		if :l_dmp = 0 and :l_lsr = 0 then

			APPPRINT.GET_ROUTING_PRINTERS(
			 :nd_ws_no,
			 :d_cashfacility_id,
			 'BL',
			 :nd_calling_pgm_id,
			 'O',
			 ' ',
			 :l_printer_ids,
			 :l_printer_names,
			 :l_printer_types, 
			 :l_queue_names,
			 :l_no_of_copies,
			 :l_errortext);

			 :l_dmp := NVL(instr(:l_printer_types,'D'),0);
			 :l_lsr := NVL(instr(:l_printer_types,'S'),0);			 

			 if :l_dmp != 0 and :l_lsr != 0 then 
			    :l_dmp := 0;
			    --if there is a laser setup, then output format will be laser
			 end if;	

			 if :l_dmp = 0 and :l_lsr = 0 then 
			    :l_lsr := 1;
			    --Default is Laser Format
			 end if;	 		 
		end if;

END;
END-EXEC;

		if ( l_errortext.arr[0] != '\0')
		{
			l_errortext.arr[0] = '\0';
			l_errortext.len = 0;
		}

}

get_print_net_gross()
{
	//Modified by Harish against the instructions from Mr. Kuila 
	//Date - 06/11/2003 Point # 18 - Customization document.
	l_bill_print_opt_for_disc_print=0;
	
	EXEC SQL SELECT bill_print_opt_for_disc_print
	           INTO :l_bill_print_opt_for_disc_print
	           FROM bl_parameters
			  WHERE operating_facility_id = :nd_facility_id;

   if (OERROR)
        err_mesg("SELECT failed on table BL_PARAMETERS",0,"");

   if (NODATAFOUND)
        err_mesg("No Record found in BL_PARAMETERS",0,"");

	//This option will be used while the bill is printed form 
	//Print Visit Bill - No Discount option.
	if(strcmp(l_print_without_disc_func.arr,"1")==0)
	{
		l_bill_print_opt_for_disc_print=3;
	}
}


/* Procedure Part */

fetch_sy_prog_param()
{


   l_detail_report_flag.arr[0]      = '\0';
   l_print_without_disc_func.arr[0] = '\0';
   l_no_settlement_details.arr[0]   = '\0';  
   l_only_print_discount.arr[0]		= '\0'; 
   nd_ws_no.arr[0]                  = '\0';
   nd_ws_no.len                     = 0;
   nd_logo_pgm_id.arr[0]	        = '\0';
   nd_logo_pgm_id.len	            = 0;
   
   
   
   EXEC SQL SELECT  OPERATING_FACILITY_ID,PARAM1,NVL(PARAM2,0),PARAM3,
					NVL(PARAM4,99999999), PARAM5,PARAM6,PARAM7,PARAM8,
					'Y',NVL(PARAM10,'N'),PARAM20,PARAM21,
					NVL(PARAM22,operating_facility_id), NVL(PARAM30,'Y'),
					PARAM14, PARAM15, PARAM24,    --NVL(PARAM25,'N'),
					PARAM29,
					PARAM28,
					nvl(PARAM11,'N')  //added by vani 
             INTO  :nd_facility_id,:nd_fm_doc_type,:nd_fm_doc_num,
                   :nd_to_doc_type,:nd_to_doc_num, 
   				   :nd_fm_doc_date,:nd_to_doc_date,
   				   :trx_type,:nd_reprint_yn,:discount_print_yn, 
				   :sett_print_yn,:p_cash_counter,:p_shift,
				   :d_cashfacility_id, :nd_online_print_yn,
				   :l_detail_report_flag, :l_print_without_disc_func,
				   :l_no_settlement_details,
				   :nd_ws_no,
				   :nd_logo_pgm_id,
				   :l_only_print_discount
              FROM SY_PROG_PARAM
              WHERE PGM_ID     = 'BLRCANBL'
              AND SESSION_ID = :nd_session_id
			  AND PGM_DATE   = :nd_pgm_date;
              
   if (OERROR)
        err_mesg("SELECT failed on table SY_PROG_PARAM",0,"");

   
   if (NODATAFOUND)
        err_mesg("No Record found in SY_PROG_PARAM",0,"");


   nd_facility_id.arr[nd_facility_id.len]				= '\0';
   nd_fm_doc_type.arr[nd_fm_doc_type.len]				= '\0';
   nd_fm_doc_num.arr[nd_fm_doc_num.len]					= '\0';
   nd_to_doc_type.arr[nd_to_doc_type.len]				= '\0';
   nd_to_doc_num.arr[nd_to_doc_num.len]					= '\0';
   nd_fm_doc_date.arr[nd_fm_doc_date.len]				= '\0';
   nd_to_doc_date.arr[nd_to_doc_date.len]				= '\0';
   d_cashfacility_id.arr[d_cashfacility_id.len]			= '\0';
   p_cash_counter.arr[p_cash_counter.len]				= '\0';
   p_shift.arr[p_shift.len]  							= '\0';
   trx_type.arr[trx_type.len]	  						= '\0';
   l_detail_report_flag.arr[l_detail_report_flag.len]	= '\0';
   l_print_without_disc_func.arr[l_print_without_disc_func.len]	= '\0';
   l_no_settlement_details.arr[l_no_settlement_details.len] = '\0';
   nd_ws_no.arr[nd_ws_no.len] = '\0';
   nd_logo_pgm_id.arr[nd_logo_pgm_id.len]		= '\0';

   	
	strcpy(g_facility_id,nd_facility_id.arr);



}

fetch_bill_format()
{

p_gross_net_amt_ind.arr[0]				= '\0';              
p_serv_disc_on_gross_ind.arr[0]			= '\0';            
p_all_oth_adj_amt_row_ind.arr[0]		= '\0';           
p_bill_disc_sep_row_yn.arr[0]			= '\0';              
p_bill_adj_sep_row_yn.arr[0]			= '\0';               
p_bill_exm_sep_row_yn.arr[0]			= '\0';               
p_bill_wo_sep_row_yn.arr[0]				= '\0';                
p_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
p_patient_amt_print_row_ind.arr[0]		= '\0';         
p_bill_net_payable_ind.arr[0]			= '\0'; 
p_addl_charge_amt_ind .arr[0]			= '\0';
p_excl_addl_charge_yn.arr[0]			= '\0';  
p_servdate_in_dtlformat_yn.arr[0]		= '\0'; 
p_disc_amt_in_dtl_yn.arr[0]				= '\0';            
c_gross_net_amt_ind.arr[0]				= '\0';                 
c_serv_disc_on_gross_ind.arr[0]			= '\0';            
c_all_oth_adj_amt_ind.arr[0]			= '\0';               
c_bill_disc_sep_row_yn.arr[0]			= '\0';              
c_bill_adj_sep_row_yn.arr[0]			= '\0';               
c_bill_exm_sep_row_yn.arr[0]			= '\0';               
c_bill_wo_sep_row_yn.arr[0]				= '\0';                
c_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
c_bill_subsidized_amt_ind.arr[0]		= '\0';           
c_bill_net_payable_ind.arr[0]			= '\0'; 
c_addl_charge_amt_ind.arr[0]			= '\0';
c_excl_addl_charge_yn.arr[0]			= '\0'; 
c_servdate_in_dtlformat_yn.arr[0]		= '\0'; 
c_disc_amt_in_dtl_yn.arr[0]				= '\0';
p_print_zero_disc_column_yn.arr[0]		= '\0'; 
c_print_zero_disc_column_yn.arr[0]		= '\0'; 
p_print_zero_adcharg_column_yn.arr[0]	= '\0';
c_print_zero_adcharg_column_yn.arr[0]	= '\0';  
c_print_zero_subsid_column_yn.arr[0]	= '\0';  
p_bill_addl_id_in_ftr_yn.arr[0]			= '\0';     
p_serv_desc_sep_line_yn.arr[0]			= '\0'; 
c_serv_desc_sep_line_yn.arr[0]			= '\0';    
status.arr[0]							= '\0';    
                          


 EXEC SQL SELECT         
			P_GROSS_NET_AMT_IND,              
			P_SERV_DISC_ON_GROSS_IND,         
			P_ALL_OTH_ADJ_AMT_ROW_IND,        
			P_BILL_DISC_SEP_ROW_YN,           
			P_BILL_ADJ_SEP_ROW_YN,            
			P_BILL_EXM_SEP_ROW_YN,            
			P_BILL_WO_SEP_ROW_YN,             
			P_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			P_PATIENT_AMT_PRINT_ROW_IND,      
			P_BILL_NET_PAYABLE_IND,
			P_ADDL_CHARGE_AMT_IND,
			P_EXCL_ADDL_CHARGE_YN,
			P_SERVDATE_IN_DTLFORMAT_YN, 
			P_DISC_AMT_IN_DTL_YN,           
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND,         
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
			C_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			C_BILL_SUBSIDIZED_AMT_IND,        
			C_BILL_NET_PAYABLE_IND, 
			C_ADDL_CHARGE_AMT_IND,
			C_EXCL_ADDL_CHARGE_YN,  
			C_SERVDATE_IN_DTLFORMAT_YN,
			C_DISC_AMT_IN_DTL_YN,                    
			STATUS,
			C_PRINT_SERV_DATE_WITH_TIME_YN,
			C_PRINT_ZERO_OTHER_ADJ_YN,	
			C_PRINT_ZERO_DISC_COLUMN_YN,	
			C_QTY_IN_DTLFORMAT_YN,
			C_RATE_IN_DTLFORMAT_YN,		
			P_PRINT_SERV_DATE_WITH_TIME_YN,
			P_PRINT_ZERO_OTHER_ADJ_YN,	
			P_PRINT_ZERO_DISC_COLUMN_YN,
			P_QTY_IN_DTLFORMAT_YN,
			P_RATE_IN_DTLFORMAT_YN,
			P_PRINT_ZERO_ADCHARG_COLUMN_YN,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
			c_print_zero_subsid_column_yn,
			P_BILL_ADDL_ID_IN_FTR_YN,
			P_SERV_DESC_SEP_LINE_YN,
			C_SERV_DESC_SEP_LINE_YN		

			                        
  INTO       
			:p_gross_net_amt_ind,              
			:p_serv_disc_on_gross_ind,         
			:p_all_oth_adj_amt_row_ind,        
			:p_bill_disc_sep_row_yn,           
			:p_bill_adj_sep_row_yn,            
			:p_bill_exm_sep_row_yn,            
			:p_bill_wo_sep_row_yn,             
			:p_oth_payers_amt_print_row_ind,   
			:p_patient_amt_print_row_ind,      
			:p_bill_net_payable_ind,
			:p_addl_charge_amt_ind,
			:p_excl_addl_charge_yn, 
			:p_servdate_in_dtlformat_yn, 
			:p_disc_amt_in_dtl_yn,         
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_oth_payers_amt_print_row_ind,   
			:c_bill_subsidized_amt_ind,        
			:c_bill_net_payable_ind,
			:c_addl_charge_amt_ind,
			:c_excl_addl_charge_yn, 
			:c_servdate_in_dtlformat_yn, 
			:c_disc_amt_in_dtl_yn,                 
			:status,
			:c_print_serv_date_with_time_yn,
			:c_print_zero_other_adj_yn,	
			:c_print_zero_disc_column_yn,	
			:c_qty_in_dtlformat_yn,
			:c_rate_in_dtlformat_yn,		
			:p_print_serv_date_with_time_yn,
			:p_print_zero_other_adj_yn,	
			:p_print_zero_disc_column_yn,
			:p_qty_in_dtlformat_yn,
			:p_rate_in_dtlformat_yn,
			:p_print_zero_adcharg_column_yn,
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_subsid_column_yn,
			:p_bill_addl_id_in_ftr_yn,
			:p_serv_desc_sep_line_yn,
			:c_serv_desc_sep_line_yn	
			
 
   FROM
   BL_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id;

   
 	//c_servdate_in_dtlformat_yn.arr[0]='Y';  //only medicity
	//p_servdate_in_dtlformat_yn.arr[0]='Y';  //only medicity 
 
 if (OERROR)
        err_mesg("SELECT failed on table BL_BILL_PRINT_FORMAT",0,"");

   if (NODATAFOUND)
        err_mesg("No Record found in BL_BILL_PRINT_FORMAT",0,"");


p_gross_net_amt_ind.arr[p_gross_net_amt_ind.len]						= '\0';              
p_serv_disc_on_gross_ind.arr[p_serv_disc_on_gross_ind.len]				= '\0';            
p_all_oth_adj_amt_row_ind.arr[p_all_oth_adj_amt_row_ind.len]			= '\0';           
p_bill_disc_sep_row_yn.arr[p_bill_disc_sep_row_yn.len]					= '\0';              
p_bill_adj_sep_row_yn.arr[p_bill_adj_sep_row_yn.len]					= '\0';               
p_bill_exm_sep_row_yn.arr[p_bill_exm_sep_row_yn.len]					= '\0';               
p_bill_wo_sep_row_yn.arr[p_bill_wo_sep_row_yn.len]						= '\0';                
p_oth_payers_amt_print_row_ind.arr[p_oth_payers_amt_print_row_ind.len]	= '\0';      
p_patient_amt_print_row_ind.arr[p_patient_amt_print_row_ind.len]		= '\0';         
p_bill_net_payable_ind.arr[p_bill_net_payable_ind.len]					= '\0';              
p_addl_charge_amt_ind.arr[p_addl_charge_amt_ind.len]					= '\0';              
p_excl_addl_charge_yn.arr[p_excl_addl_charge_yn.len]					= '\0';              
p_servdate_in_dtlformat_yn.arr[p_servdate_in_dtlformat_yn.len]			= '\0';              
p_disc_amt_in_dtl_yn.arr[p_disc_amt_in_dtl_yn.len]						= '\0';  
c_gross_net_amt_ind.arr[c_gross_net_amt_ind.len]						= '\0';                 
c_serv_disc_on_gross_ind.arr[c_serv_disc_on_gross_ind.len]				= '\0';            
c_all_oth_adj_amt_ind.arr[c_all_oth_adj_amt_ind.len]					= '\0';               
c_bill_disc_sep_row_yn.arr[c_bill_disc_sep_row_yn.len]					= '\0';              
c_bill_adj_sep_row_yn.arr[c_bill_adj_sep_row_yn.len]					= '\0';               
c_bill_exm_sep_row_yn.arr[c_bill_exm_sep_row_yn.len]					= '\0';               
c_bill_wo_sep_row_yn.arr[c_bill_wo_sep_row_yn.len]						= '\0';                
c_oth_payers_amt_print_row_ind.arr[c_oth_payers_amt_print_row_ind.len]	= '\0';      
c_bill_subsidized_amt_ind.arr[c_bill_subsidized_amt_ind.len]			= '\0';           
c_bill_net_payable_ind.arr[c_bill_net_payable_ind.len]					= '\0';              
c_addl_charge_amt_ind.arr[c_addl_charge_amt_ind.len]					= '\0';              
c_excl_addl_charge_yn.arr[c_excl_addl_charge_yn.len]					= '\0';              
c_servdate_in_dtlformat_yn.arr[c_servdate_in_dtlformat_yn.len]			= '\0'; 
c_disc_amt_in_dtl_yn.arr[c_disc_amt_in_dtl_yn.len]						= '\0'; 
p_print_zero_adcharg_column_yn.arr[p_print_zero_adcharg_column_yn.len]	= '\0'; 
c_print_zero_adcharg_column_yn.arr[c_print_zero_adcharg_column_yn.len]	= '\0'; 
c_print_zero_subsid_column_yn.arr[c_print_zero_subsid_column_yn.len]	= '\0'; 
p_bill_addl_id_in_ftr_yn.arr[p_bill_addl_id_in_ftr_yn.len]				= '\0';
p_serv_desc_sep_line_yn.arr[p_serv_desc_sep_line_yn.len]				= '\0';
c_serv_desc_sep_line_yn.arr[c_serv_desc_sep_line_yn.len]				= '\0';
status.arr[status.len]													= '\0';                              

}

/* This Function will fetch the Payer Setup Records */
fetch_bill_format_payer()
{

p_gross_net_amt_ind.arr[0]				= '\0';              
p_serv_disc_on_gross_ind.arr[0]			= '\0';            
p_all_oth_adj_amt_row_ind.arr[0]		= '\0';           
p_bill_disc_sep_row_yn.arr[0]			= '\0';              
p_bill_adj_sep_row_yn.arr[0]			= '\0';               
p_bill_exm_sep_row_yn.arr[0]			= '\0';               
p_bill_wo_sep_row_yn.arr[0]				= '\0';                
p_oth_payers_amt_print_row_ind.arr[0]	= '\0';      
p_patient_amt_print_row_ind.arr[0]		= '\0';         
p_bill_net_payable_ind.arr[0]			= '\0'; 
p_addl_charge_amt_ind.arr[0]			= '\0';
p_excl_addl_charge_yn.arr[0]			= '\0';             
p_servdate_in_dtlformat_yn.arr[0]		= '\0'; 
p_disc_amt_in_dtl_yn.arr[0]				= '\0'; 
p_print_zero_disc_column_yn.arr[0]		= '\0'; 
p_print_zero_adcharg_column_yn.arr[0]	= '\0';
p_serv_desc_sep_line_yn.arr[0]			= '\0';
p_bill_addl_id_in_ftr_yn.arr[0]			= '\0';
status.arr[0]							= '\0'; 
                          


 EXEC SQL SELECT         
			P_GROSS_NET_AMT_IND,              
			P_SERV_DISC_ON_GROSS_IND,         
			P_ALL_OTH_ADJ_AMT_ROW_IND,        
			P_BILL_DISC_SEP_ROW_YN,           
			P_BILL_ADJ_SEP_ROW_YN,            
			P_BILL_EXM_SEP_ROW_YN,            
			P_BILL_WO_SEP_ROW_YN,             
			P_OTH_PAYERS_AMT_PRINT_ROW_IND,   
			P_PATIENT_AMT_PRINT_ROW_IND,      
			P_BILL_NET_PAYABLE_IND,
			P_ADDL_CHARGE_AMT_IND,
			P_EXCL_ADDL_CHARGE_YN,  
			P_SERVDATE_IN_DTLFORMAT_YN,   
			P_DISC_AMT_IN_DTL_YN,         
			STATUS,
			P_PRINT_SERV_DATE_WITH_TIME_YN,
			P_PRINT_ZERO_OTHER_ADJ_YN,	
			P_PRINT_ZERO_DISC_COLUMN_YN,
			P_QTY_IN_DTLFORMAT_YN,	
		    P_RATE_IN_DTLFORMAT_YN,
			P_PRINT_ZERO_ADCHARG_COLUMN_YN,
			P_SERV_DESC_SEP_LINE_YN,
			P_BILL_ADDL_ID_IN_FTR_YN
	                      
		INTO       
			:p_gross_net_amt_ind,              
			:p_serv_disc_on_gross_ind,         
			:p_all_oth_adj_amt_row_ind,        
			:p_bill_disc_sep_row_yn,           
			:p_bill_adj_sep_row_yn,            
			:p_bill_exm_sep_row_yn,            
			:p_bill_wo_sep_row_yn,             
			:p_oth_payers_amt_print_row_ind,   
			:p_patient_amt_print_row_ind,      
			:p_bill_net_payable_ind, 
			:p_addl_charge_amt_ind,
			:p_excl_addl_charge_yn, 
			:p_servdate_in_dtlformat_yn,            
			:p_disc_amt_in_dtl_yn,
			:status,
			:p_print_serv_date_with_time_yn,
			:p_print_zero_other_adj_yn,	
			:p_print_zero_disc_column_yn,
			:p_qty_in_dtlformat_yn,	
			:p_rate_in_dtlformat_yn,
			:p_print_zero_adcharg_column_yn,
			:p_serv_desc_sep_line_yn,
			:p_bill_addl_id_in_ftr_yn
			
		
   FROM
   BL_BILL_PRINT_PAYER_FORMAT
   WHERE 
   OPERATING_FACILITY_ID=:nd_facility_id
   AND PAYER_CODE=:d_cust_code;

 //p_servdate_in_dtlformat_yn.arr[0]='Y';  
 
 if (OERROR)
        err_mesg("SELECT failed on table BL_BILL_PRINT_PAYER_FORMAT",0,"");

 if (NODATAFOUND)
        fetch_bill_format();
 
 
p_gross_net_amt_ind.arr[p_gross_net_amt_ind.len]						= '\0';              
p_serv_disc_on_gross_ind.arr[p_serv_disc_on_gross_ind.len]				= '\0';            
p_all_oth_adj_amt_row_ind.arr[p_all_oth_adj_amt_row_ind.len]			= '\0';           
p_bill_disc_sep_row_yn.arr[p_bill_disc_sep_row_yn.len]					= '\0';              
p_bill_adj_sep_row_yn.arr[p_bill_adj_sep_row_yn.len]					= '\0';               
p_bill_exm_sep_row_yn.arr[p_bill_exm_sep_row_yn.len]					= '\0';               
p_bill_wo_sep_row_yn.arr[p_bill_wo_sep_row_yn.len]						= '\0';                
p_oth_payers_amt_print_row_ind.arr[p_oth_payers_amt_print_row_ind.len]	= '\0';      
p_patient_amt_print_row_ind.arr[p_patient_amt_print_row_ind.len]		= '\0';         
p_bill_net_payable_ind.arr[p_bill_net_payable_ind.len]					= '\0';  
p_addl_charge_amt_ind.arr[p_addl_charge_amt_ind.len]					= '\0';              
p_excl_addl_charge_yn.arr[p_excl_addl_charge_yn.len]					= '\0';            
p_servdate_in_dtlformat_yn.arr[p_servdate_in_dtlformat_yn.len]			= '\0';            
p_disc_amt_in_dtl_yn.arr[p_disc_amt_in_dtl_yn.len]						= '\0';            
p_print_zero_disc_column_yn.arr[p_print_zero_disc_column_yn.len]		= '\0'; 
p_print_zero_adcharg_column_yn.arr[p_print_zero_adcharg_column_yn.len]	= '\0'; 
p_serv_desc_sep_line_yn.arr[p_serv_desc_sep_line_yn.len]				= '\0';
p_bill_addl_id_in_ftr_yn.arr[p_bill_addl_id_in_ftr_yn.len]				= '\0';
status.arr[status.len]													= '\0';                              

}

fetch_single_bill_format_bg()
{
     
c_gross_net_amt_ind.arr[0]				= '\0';                 
c_serv_disc_on_gross_ind.arr[0]			= '\0';            
c_reim_amt_ind.arr[0]		        	= '\0';               
c_non_reim_amt_ind.arr[0]				= '\0';
c_all_oth_adj_amt_ind.arr[0]			= '\0';  
c_bill_disc_sep_row_yn.arr[0]			= '\0';              
c_bill_adj_sep_row_yn.arr[0]			= '\0';               
c_bill_exm_sep_row_yn.arr[0]			= '\0';               
c_bill_wo_sep_row_yn.arr[0]				= '\0';                
c_bill_net_payable_ind.arr[0]			= '\0'; 
c_print_zero_adcharg_column_yn.arr[0]	= '\0';    
c_print_zero_disc_column_yn.arr[0]	    = '\0';
c_print_zero_other_adj_yn.arr[0]	    = '\0';  
c_serv_desc_sep_line_yn.arr[0]			= '\0';       
status.arr[0]							= '\0';                              


 EXEC SQL SELECT         
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND, 
			C_REIM_AMT_IND,
			C_NON_REIM_AMT_IND,        
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
		    C_BILL_NET_PAYABLE_IND,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
		    C_PRINT_ZERO_DISC_COLUMN_YN,
		    C_PRINT_ZERO_OTHER_ADJ_YN, 
			C_SERV_DESC_SEP_LINE_YN,                    
			STATUS                           
  INTO       
			    
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,
			:c_reim_amt_ind,
			:c_non_reim_amt_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_bill_net_payable_ind,  
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_disc_column_yn,
			:c_print_zero_other_adj_yn,
			:c_serv_desc_sep_line_yn,                 
			:status   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   AND   BLNG_GRP_ID          =:dc_blng_grp_id;
   

 if (OERROR)
        err_mesg("SELECT failed on table BL_CASH_BILL_PRINT_FORMAT",0,"");

 if (NODATAFOUND)
   {

   EXEC SQL SELECT         
			C_GROSS_NET_AMT_IND,              
			C_SERV_DISC_ON_GROSS_IND, 
			C_REIM_AMT_IND,
			C_NON_REIM_AMT_IND,        
			C_ALL_OTH_ADJ_AMT_IND,            
			C_BILL_DISC_SEP_ROW_YN,           
			C_BILL_ADJ_SEP_ROW_YN,            
			C_BILL_EXM_SEP_ROW_YN,            
			C_BILL_WO_SEP_ROW_YN,             
		    C_BILL_NET_PAYABLE_IND,
			C_PRINT_ZERO_ADCHARG_COLUMN_YN,
		    C_PRINT_ZERO_DISC_COLUMN_YN,
		    C_PRINT_ZERO_OTHER_ADJ_YN,
			C_SERV_DESC_SEP_LINE_YN,                       
			STATUS                           
  INTO       
			    
			:c_gross_net_amt_ind,              
			:c_serv_disc_on_gross_ind,
			:c_reim_amt_ind,
			:c_non_reim_amt_ind,         
			:c_all_oth_adj_amt_ind,            
			:c_bill_disc_sep_row_yn,           
			:c_bill_adj_sep_row_yn,            
			:c_bill_exm_sep_row_yn,            
			:c_bill_wo_sep_row_yn,             
			:c_bill_net_payable_ind, 
			:c_print_zero_adcharg_column_yn,
			:c_print_zero_disc_column_yn,
			:c_print_zero_other_adj_yn,  
			:c_serv_desc_sep_line_yn,                   
			:status   
   FROM
   BL_CASH_BILL_PRINT_FORMAT
   WHERE OPERATING_FACILITY_ID=:nd_facility_id
   AND   BLNG_GRP_ID          ='**';
    
   }
       
 if (NODATAFOUND)
        err_mesg("No Record found in BL_CASH_BILL_PRINT_FORMAT",0,"");
		
           
c_gross_net_amt_ind.arr[c_gross_net_amt_ind.len]						= '\0';                 
c_serv_disc_on_gross_ind.arr[c_serv_disc_on_gross_ind.len]				= '\0'; 
c_reim_amt_ind.arr[c_reim_amt_ind.len]									= '\0';
c_non_reim_amt_ind.arr[c_non_reim_amt_ind.len]							= '\0';           
c_all_oth_adj_amt_ind.arr[c_all_oth_adj_amt_ind.len]					= '\0';               
c_bill_disc_sep_row_yn.arr[c_bill_disc_sep_row_yn.len]					= '\0';              
c_bill_adj_sep_row_yn.arr[c_bill_adj_sep_row_yn.len]					= '\0';               
c_bill_exm_sep_row_yn.arr[c_bill_exm_sep_row_yn.len]					= '\0';               
c_bill_wo_sep_row_yn.arr[c_bill_wo_sep_row_yn.len]						= '\0';                
c_bill_net_payable_ind.arr[c_bill_net_payable_ind.len]					= '\0';  
c_print_zero_adcharg_column_yn.arr[c_print_zero_adcharg_column_yn.len]	= '\0'; 
c_print_zero_disc_column_yn.arr[c_print_zero_disc_column_yn.len]		= '\0'; 
c_print_zero_other_adj_yn.arr[c_print_zero_other_adj_yn.len]			= '\0';  
c_serv_desc_sep_line_yn.arr[c_serv_desc_sep_line_yn.len]				= '\0';           
status.arr[status.len]													= '\0';                              

}

prepare_file()
{
	if (LOGO_DIR.arr[0] != '\0') 
		strcpy(filename,LOGO_DIR.arr);
	else 
		strcpy(filename,WORKING_DIR);

	 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
	 {
			
		 l_billr_cnt=l_billr_cnt+1;
		 //strcpy(nd_file_name.arr,"blrcanbl.lis");
		 strcpy(nd_file_name.arr,nd_temp_file_name.arr);
		 flag=l_billr_cnt;
		 strcpy(l_filename[1],WORKING_DIR);
		 strcat(l_filename[1],nd_temp_file_name.arr);
		 
		 
	 }
	 /**** This LIS for Discount Document Report ****/
	 else
	 {
	 	 
		 l_discr_cnt=l_discr_cnt+1;
		 strcpy(nd_file_name.arr,"blrdiscn.lis");
		 flag=l_discr_cnt;
		 strcpy(l_filename[2],WORKING_DIR);
		 strcat(l_filename[2],nd_file_name.arr);

	 }
	
	
	  strcat(filename,nd_file_name.arr);
	  strcpy (OUTPUT_FILE_NAME, filename);
  
	  
	  if(flag>1)
	  { 
		  if ((fp = fopen(filename,"a")) == NULL)
		   {
				err_mesg("Error while opening output file",0,"");
				proc_exit();
		   }
		   else
		   {
		   
		  // if (p_cnt==0)
		  // {
		 
		   	fprintf(fp,"");
			fprintf(fp,"\n"); 
			p_cnt=p_cnt+1;
		//	}
			}

	  } 
	  else
	  {
		   if((fp = fopen(filename,"w")) == NULL)
			{ 		
				err_mesg(ERR_MESG,"Error Opening Output File");
				proc_exit();
			}
	  }
		return;
}


declare_cust_cur()
{
    EXEC SQL DECLARE BL_BILL_HDR_CUST_CUR CURSOR FOR
        SELECT SHORT_NAME
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d_cust_code1
	 AND  acc_entity_code = :nd_acc_entity_code
	 AND LANGUAGE_ID=:nd_lang_id;

if (OERROR) 
	{	
		disp_message (ERR_MESG,"Failed to Declare customer cursor");
		proc_exit;
	}
return;
}


fetch_cust_cur()
{
d2_short_name.arr[0] = '\0';
d2_short_name.len=0;
 EXEC SQL SELECT SHORT_NAME into :d2_short_name
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d_cust_code1
	 AND  acc_entity_code = :nd_acc_entity_code
	 AND LANGUAGE_ID=:nd_lang_id;

d2_short_name.arr[d2_short_name.len] = '\0';
if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Cust Cursor Failed");
		proc_exit();
	}
  }

/*
open_cust_cur()
{
	EXEC SQL OPEN BL_BILL_HDR_CUST_CUR;

	if (OERROR) 
	{	
		disp_message(ERR_MESG,"Open Customer Cursor Failed");
		proc_exit();
	}

	return;
}


fetch_cust_cur()
{
	d2_short_name.arr[0] = '\0';
	d2_short_name.len = 0;

	EXEC SQL FETCH BL_BILL_HDR_CUST_CUR INTO	
			:d2_short_name;

	if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor Failed");
		proc_exit();
	}

	if(NODATAFOUND)
	{
   		return 0;
	}

	d2_short_name.arr[d2_short_name.len] = '\0';

	return 1;
}



close_cust_cur()
{
	EXEC SQL CLOSE BL_BILL_HDR_CUST_CUR;
}	
*/

fetch_customer()
{
d_customer1.arr[0] = '\0';
d_customer1.len=0;
 EXEC SQL SELECT LONG_NAME into :d_customer1
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d_cust_code
	 AND  acc_entity_code = :nd_acc_entity_code
	 AND LANGUAGE_ID=:nd_lang_id;

d_customer1.arr[d_customer1.len] = '\0';
if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor0 Failed");
		proc_exit();
	}
  }

fetch_customer1()
{

d_customer2.arr[0] = '\0';
d_customer2.len=0;

nd_cust_cd1.arr[0] = '\0';
nd_cust_cd1.len =0;
strcpy(nd_cust_cd1.arr,nd_cust_code1.arr);
nd_cust_cd1.arr[nd_cust_cd1.len]= '\0';


EXEC SQL SELECT substr(LONG_NAME,1,45) into :d_customer2
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE =:d_cust_code1	  
	 AND  acc_entity_code =:nd_acc_entity_code
	 AND LANGUAGE_ID=:nd_lang_id;

d_customer2.arr[d_customer2.len] = '\0';
if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer Cursor1 Failed");
		proc_exit();
	}
  }

fetch_customer2()
{
d_customer3.arr[0] = '\0';
d_customer3.len=0;
 EXEC SQL SELECT LONG_NAME into :d_customer3
	 FROM	AR_CUSTOMER_LANG_VW 
	 WHERE  
	 CUST_CODE = :d1_cust_code1
	AND  acc_entity_code = :nd_acc_entity_code
   AND LANGUAGE_ID=:nd_lang_id;

d_customer3.arr[d_customer3.len] = '\0';
if (OERROR)
	{	
		disp_message(ERR_MESG,"Fetch Customer2 Cursor Failed");
		proc_exit();
	}
  }

print_report_head()
{	
	int len1 = 0, i = 0;
	v_lno = 0;	

	//l_page_no++; commented at 27/06/2009 bangkok
	//l_bill_page_no++;

	get_bill_format();

  if (strcmp(nd_bill_format_id.arr,"1")==0)
   {

	currency.arr[0] = '\0';
	sub_cur.arr[0]  = '\0';
	currency.len = 0;
	sub_cur.len = 0;
	nd_acc_name.arr[0] = '\0';
	nd_acc_name.len = 0;
	nd_decimal = 0;

	EXEC SQL SELECT base_currency,
			base_currency_dec,
			acc_entity_name||', ',
			accounting_name,
			no_of_decimal 
	INTO    :currency,
			:sub_cur,
			:nd_facility_name ,
			:nd_acc_name,
			:nd_decimal
	FROM SY_ACC_ENTITY_LANG_VW
	WHERE acc_entity_id = :d_cashfacility_id
	AND LANGUAGE_ID=:nd_lang_id;

	if (OERROR) 
	{ 
		disp_message (ERR_MESG,"SELECT FACILITY STATEMENT FAILED");
		proc_exit();
	}

	currency.arr[currency.len] = '\0';
	sub_cur.arr[sub_cur.len] = '\0';
	nd_facility_name.arr[nd_facility_name.len] = '\0';
	nd_acc_name.arr[nd_acc_name.len] = '\0';

	 EXEC SQL SELECT acc_entity_name 
		 INTO :nd_facility
		 FROM SY_ACC_ENTITY_LANG_VW
		 WHERE acc_entity_id = :nd_facility_id
		 AND LANGUAGE_ID=:nd_lang_id;

	nd_facility.arr[nd_facility.len] = '\0';
	nd_curr_date.arr[0] = '\0';
	nd_curr_date.len = 0;

	EXEC SQL SELECT TO_CHAR(SYSDATE,'dd/mm/yyyy') 
		 INTO :nd_curr_date
		 FROM dual;
	nd_curr_date.arr[nd_curr_date.len] = '\0';

	if(nd_curr_date.arr[0]!='\0')
	{
	  init_date_temp_var();
	  strcpy(date_convert.arr,nd_curr_date.arr);
	  fun_change_loc_date();
	  strcpy(nd_curr_date1.arr,nd_loc_date1.arr);
	 }

/***** Medicity******/

	nd_curr_date_t.arr[0] = '\0';
	nd_curr_date_t.len = 0;

	EXEC SQL SELECT TO_CHAR(SYSDATE,'dd/mm/yyyy hh24:mi') 
		 INTO :nd_curr_date_t
		 FROM dual;
	nd_curr_date_t.arr[nd_curr_date_t.len] = '\0';

	if(nd_curr_date_t.arr[0]!='\0')
	{
		init_date_temp_var();
		strcpy(date_convert.arr,nd_curr_date_t.arr);
		fun_change_loc_date1();
		strcpy(nd_curr_date_t.arr,date_convert.arr);

	 }	

nd_curr_date_t.arr[nd_curr_date_t.len]='\0';
/***** Medicity******/	   
	get_gl_holder_name_nric();
    get_patient_name();
	get_adm_dis_date();

	bill_title.arr[0] = '\0';
	bill_title.len = 0;

	if (dc_ind.arr[0] == 'P')
		strcpy(bill_title.arr,loc_legend[320]);
	else if (dc_ind.arr[0] == 'I')
		strcpy(bill_title.arr,loc_legend[330]);
	else
		strcpy(bill_title.arr," ");

       bill_title.len = strlen(bill_title.arr); 

 /**** Added on 6/5/2009 for Printing the Header part for Discount Document Report *****/

 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
 {
    
	   l_disc_page_no++; //27/06/2009 bangkok

	   /** Laser Printer Format **/

	   if (l_lsr != 0 && l_dmp == 0)
	   {
	  	   if( l_logo_yniflaser.arr[0] != 'Y')
	       {
		
				strcat(nd_facility_name.arr,loc_legend[1417]);

				fprintf(fp,"%c(s10H",ESC);	
				fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
				if(l_no_settlement_details.arr[0]!='R' || l_no_settlement_details.arr[0]=='\0')
				{
				 if(strcmp(dc_bill_print_flag.arr,"Y") == 0)
				 fprintf(fp,"\n%-68.68s%-10.10s\n"," ",loc_legend[190]);
				 lsr_line_cnt();
				}
				fun_centre(loc_legend[1415],80);
				fprintf(fp,"%s\n",loc_legend[1415]);
				lsr_line_cnt();
				fprintf(fp,"%c(s-3B",ESC);	   /* To release bold style   */

				if(d_bill_nature_code.arr[0] == 'A')
				{
				 l_coverage_title.arr[0]='\0';
				 l_coverage_title.len=0;

				 strcpy(l_coverage_title.arr,loc_legend[1416]);
				 strcat(l_coverage_title.arr,": ");
				 get_policy_desc();
				 if (l_Policy_type_desc.arr[0] !='\0')
				 {
				  
				 strcat(l_coverage_title.arr,l_Policy_type_desc.arr);
				 }
				 else
				 strcat(l_coverage_title.arr,l_bill_long_desc_c.arr);
			
				 fprintf(fp,"%c(s14H",ESC);
				 fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
				 fun_centre(l_coverage_title.arr,113);
				 fprintf(fp,"%s\n\n",l_coverage_title.arr);
				 lsr_line_cnt();lsr_line_cnt();
				 fprintf(fp,"%c(s-3B",ESC);	   /* To release bold style   */
				}

				else
				{
				
					if (d_cust_code.arr[0]=='\0')
					{
					strcpy(l_coverage_title.arr,loc_legend[1416]);
					strcat(l_coverage_title.arr,": ");
					strcat(l_coverage_title.arr,loc_legend[1426]);

					 fprintf(fp,"%c(s14H",ESC);
					 fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
					 fun_centre(l_coverage_title.arr,105);
					 fprintf(fp,"%s\n\n",l_coverage_title.arr);
					 lsr_line_cnt();lsr_line_cnt();
					 fprintf(fp,"%c(s-3B",ESC);	   /* To release bold style   */
					}
				}
				fprintf(fp,"%c(s14H",ESC);
				fprintf(fp,"%-70.70s %-s: %-s\n",nd_facility_name.arr,loc_legend[1418],d1_doc_type_num.arr);
	   			fprintf(fp,"%-70.70s %-s: %-s %-s\n",nd_hosp_add.arr,loc_legend[1419],nd_curr_date_t.arr,loc_legend[1424]);
				lsr_line_cnt();lsr_line_cnt();
				fprintf(fp,"\n\n");
				lsr_line_cnt();lsr_line_cnt();
				fprintf(fp,"%-17.17s: %-51.51s ",loc_legend[100],dc_short_name.arr);
				fprintf(fp,"%-s: %-25.25s \n",loc_legend[1030],d_patient_id.arr); 
				lsr_line_cnt();
			
			
			   if (l_lsr != 0 && l_dmp == 0)
			   {
				  if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
				  prt_line_uc();
				  if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
				  prt_line_uc_wide();

				  if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 1)
				  prt_line_uc();
				  if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 2)
				  prt_line_uc_wide();
				  if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 3)
				  prt_line_uc_wide1();
				  if(strcmp(d_cust_code.arr,"\0")==0 && (lcol_cnt == 6 || lcol_cnt == 5))
				  prt_line_uc_wide2();
	
				  fprintf(fp,"\n");
				  lsr_line_cnt();
				  if (l_main_hdr == 0)
				  {
					// no need to print Subhdr 
				  }
				  else
				  {
					
					//fprintf(fp,"%6s %-20.20s %5s %-20.20s        %8.8s \n"," ",loc_legend[110]," "," ",currency.arr);		
					fprintf(fp,"%6s %-20.20s %5s %-20.20s (%s %s)\n  "," "," "," "," ",loc_legend[1401],currency.arr);		
					//fprintf(fp,"%-35s %21s %17s %17.17s\n",loc_legend[770],loc_legend[680],loc_legend[820],loc_legend[830]);
					lsr_line_cnt();
					l_cnt=l_cnt+1;

				  }
			    }
				
				if (l_lsr != 0 && l_dmp == 0)
				{
					l_main_hdr = 1;
				}
				else
				{
					v_lno = 0;
				}	
			
		    }
	   }
	   /** Dotmatrix Printer Format **/
	   else
	   {
	     	strcat(nd_facility_name.arr,loc_legend[1417]);
			if(l_no_settlement_details.arr[0]!='R' || l_no_settlement_details.arr[0]=='\0')
			{
		 	 if(strcmp(dc_bill_print_flag.arr,"Y") == 0)
			 fprintf(fp,"%-68.68s%-10.10s\n"," ",loc_legend[190]);
			 lsr_line_cnt();
			}
			fun_centre(loc_legend[1415],80);
			fprintf(fp,"%s\n",loc_legend[1415]);
			lsr_line_cnt();

			if(d_bill_nature_code.arr[0] == 'A')
			{
				 l_coverage_title.arr[0]='\0';
				 l_coverage_title.len=0;

				 strcpy(l_coverage_title.arr,loc_legend[1416]);
				 strcat(l_coverage_title.arr,": ");

				 get_policy_desc();

				 if (l_Policy_type_desc.arr[0]!='\0')
				 {
				
				 strcat(l_coverage_title.arr,l_Policy_type_desc.arr);
				 }
				 else
				 {
				 
				 strcat(l_coverage_title.arr,l_bill_long_desc_c.arr);
				}

			
				 fprintf(fp,"%c(s14H",ESC);
				 fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
				 fun_centre(l_coverage_title.arr,113);
				 fprintf(fp,"%s\n\n",l_coverage_title.arr);
				 lsr_line_cnt();lsr_line_cnt();
				 printf(fp,"%c(s-3B",ESC);	   /* To release bold style   */
			
			}
			else
			{
			 if (d_cust_code.arr[0]=='\0')
			 {
			 strcpy(l_coverage_title.arr,loc_legend[1416]);
			 strcat(l_coverage_title.arr,": ");
			 strcat(l_coverage_title.arr,loc_legend[1426]);

			 fprintf(fp,"%c(s14H",ESC);
			 fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
			 fun_centre(l_coverage_title.arr,105);
			 fprintf(fp,"%s\n\n",l_coverage_title.arr);
			 lsr_line_cnt();lsr_line_cnt();
			 fprintf(fp,"%c(s-3B",ESC);	   /* To release bold style   */
			}
			}

			fprintf(fp,"%-70.70s %-s: %-s\n",nd_facility_name.arr,loc_legend[1418],d1_doc_type_num.arr);
	   		fprintf(fp,"%-70.70s %-s: %-s \n",nd_hosp_add.arr,loc_legend[1419],nd_curr_date_t.arr);
			lsr_line_cnt();lsr_line_cnt();
			fprintf(fp,"\n\n");
			lsr_line_cnt();lsr_line_cnt();
			fprintf(fp,"%-17.17s: %-51.51s ",loc_legend[100],dc_short_name.arr);
			fprintf(fp,"%-s: %-25.25s \n",loc_legend[1030],d_patient_id.arr); 
			lsr_line_cnt();

			prt_line_uc();
		    fprintf(fp,"\n");lsr_line_cnt();
			if (l_lsr != 0 && l_dmp == 0)
			{
				l_main_hdr = 1;
			}
			else
			{
				v_lno = 0;
			}
	   }

 }
 else
 {
   l_billpage_no++; //27/06/2009 bangkok

	if (l_lsr != 0 && l_dmp == 0)
	{	 

	   if( l_logo_yniflaser.arr[0] != 'Y')
	    {
		   fprintf(fp,"%c(s10H",ESC);	
		   fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
	    }

		//fprintf(fp,"%-80.80s\n",loc_legend[380]);		
		//lsr_line_cnt();

		//fprintf(fp,"%-80.80s\n",loc_legend[370]);
		//lsr_line_cnt();

          if(l_no_settlement_details.arr[0]!='R' || l_no_settlement_details.arr[0]=='\0')
		  {
		   if(strcmp(dc_bill_print_flag.arr,"Y") == 0)
		   fprintf(fp,"%-68.68s%-10.10s\n"," ",loc_legend[190]);
          }
		  fun_centre(nd_hosp_name.arr,60);
		  fprintf(fp,"%s\n",nd_hosp_name.arr);
		  lsr_line_cnt();
		  fprintf(fp,"%c(s-3B",ESC);	/* To release bold style   */
		  lsr_line_cnt(); 
		
		if (l_lsr != 0 && l_dmp == 0)
		{
	    if ( l_logo_yniflaser.arr[0] != 'Y')
		fprintf(fp,"%c(s14H",ESC);	
		}	

		//fprintf(fp,"%-80.80s\n",nd_add.arr);
		//lsr_line_cnt();
		
		fun_centre(nd_telfax.arr,80);
		fprintf(fp,"%s\n",nd_telfax.arr);
		lsr_line_cnt();
		
	    if (l_lsr != 0 && l_dmp == 0)
		{
		 if( l_logo_yniflaser.arr[0] != 'Y')
	     {
		   fprintf(fp,"%c(s10H",ESC);
		   fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 	  */
		  	   			
	     }
		}


		
		if(l_no_settlement_details.arr[0]=='R' || 
		( strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS3")==0||strcmp(nd_calling_pgm_id.arr,"BLRUCDS3")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0
          && strcmp(d_bill_nature_code.arr,"C")==0) )
		{
			
		  if(d_bill_paid_amt!=0)
		  {
		   fun_centre(loc_legend[1404],80);
		   fprintf(fp,"%c&d0D",ESC); /* set Underline mode */
		   fprintf(fp,"%s\n",loc_legend[1404]);
		   fprintf(fp,"%c&d@",ESC); /* release Underline mode */
		   lsr_line_cnt();		
		   fprintf(fp,"%c(s-3B",ESC);	/* To release bold style  */  
		  }
		  else
		  {
			fun_centre(loc_legend[300],80);
			fprintf(fp,"%c&d0D",ESC); /* set Underline mode */
			fprintf(fp,"%s\n",loc_legend[300]);
			fprintf(fp,"%c&d@",ESC); /* release Underline mode */
			lsr_line_cnt();		
			fprintf(fp,"%c(s-3B",ESC);	/* To release bold style  */  
		
		  }  
      
		  
		}
		else
		{
			fun_centre(loc_legend[300],80);
			fprintf(fp,"%c&d0D",ESC); /* set Underline mode */
			fprintf(fp,"%s\n",loc_legend[300]);
			fprintf(fp,"%c&d@",ESC); /* release Underline mode */
			lsr_line_cnt();		
			fprintf(fp,"%c(s-3B",ESC);	/* To release bold style  */  
		
		}  
      

		fprintf(fp,"%-80.80s\n",bill_title.arr);
	    lsr_line_cnt();

		if (l_lsr != 0 && l_dmp == 0)
		{
        if(l_logo_yniflaser.arr[0] != 'Y')
	    {
		  fprintf(fp,"%c(s14H",ESC);	      	      
	    }
		}	      
	   
		fprintf(fp,"%-s: %-s ",loc_legend[70],d1_doc_type_num.arr);
		//fprintf(fp,"%-s: %-s/%-s ",loc_legend[70],nd_fm_doc_type.arr,nd_fm_doc_num.arr); 
	    
	   if(d1_doc_date.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d1_doc_date.arr);
		  fun_change_loc_date();
		  strcpy(d1_doc_date1.arr,nd_loc_date1.arr);
		}
		
		fprintf(fp,"%-s: %-s      ",loc_legend[80],d1_doc_date1.arr);
			
	    if (nd_reprint_yn == 'Y')
	    {
		
			if(l_no_settlement_details.arr[0]!='R' || l_no_settlement_details.arr[0]=='\0')
			{
				if (strcmp(dc_bill_print_flag.arr,"Y") == 0)
				{			
					if (l_lsr != 0 && l_dmp == 0)
					{				
					  fprintf(fp,"%35.35s: %-s ",loc_legend[290],nd_curr_date1.arr);
					  fprintf(fp,"\n");
					  lsr_line_cnt();
					}
					else
					{			
					  fprintf(fp,"%35.35s: %-s ",loc_legend[290],nd_curr_date1.arr);
					  fprintf(fp,"\n");
					  lsr_line_cnt();
					}		     
				}
				else
				{
					fprintf(fp,"\n");
					lsr_line_cnt();
				}
			}
	    }
	
		if(d_int_bill_prv_doc_type_code.arr[0]!='\0') //added at 31/07/07 
		{
		  fprintf(fp,"%89.89s: ",loc_legend[860]);
		  fprintf(fp,"%-s/%-s\n ",d_int_bill_prv_doc_type_code.arr,d_int_bill_prv_doc_number.arr);
        }

	    else
	    {	
			fprintf(fp,"\n");
			lsr_line_cnt();
	    }


	
	    fprintf(fp,"%-45.45s",loc_legend[560]);
	    fprintf(fp,"%-45.45s\n",loc_legend[570]);	    
	    lsr_line_cnt();

	   if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		prt_line_uc();
	   if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
	    prt_line_uc_wide();

		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 1)
		prt_line_uc();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 2)
		prt_line_uc_wide();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 3)
		prt_line_uc_wide1();
		if(strcmp(d_cust_code.arr,"\0")==0 && (lcol_cnt == 6||lcol_cnt == 5))
		prt_line_uc_wide2();

	    //prt_line();
	    fprintf(fp,"\n");    
	    lsr_line_cnt();	    
	    

	    dc_short_name1.arr[i] = '\0';
	    dc_short_name1.len = 0;	    

	    dc_short_name2.arr[0] = '\0';
	    dc_short_name2.len = 0;	    

	    dc_short_name3.arr[0] = '\0';
	    dc_short_name3.len = 0;	    

	    r_ctr = 0;   
	    if (dc_short_name.len >0)	
        split_text(dc_short_name.arr,25,dc_short_name1.arr,&r_ctr);	 
	    if (dc_short_name.len >25)
	    split_text(dc_short_name.arr,25,dc_short_name2.arr,&r_ctr);
	    if (dc_short_name.len >50)
	    split_text(dc_short_name.arr,25,dc_short_name3.arr,&r_ctr);	    
	    
	    
	    l_gl_holder_name1.arr[0] = '\0';
	    l_gl_holder_name1.len = 0;

	    l_gl_holder_name2.arr[0] = '\0';
	    l_gl_holder_name2.len = 0;	    


        r_ctr = 0; 
	    if(l_gl_holder_name.len > 0)
	    split_text(l_gl_holder_name.arr,25,l_gl_holder_name1.arr,&r_ctr);	    
	    if(l_gl_holder_name.len > 25)
	    split_text(l_gl_holder_name.arr,25,l_gl_holder_name2.arr,&r_ctr);	    
	    
		//printing Patient Name 1st line

		if(strcmp(d_bill_nature_code.arr,"C")==0)
			if (l_lsr != 0 && l_dmp == 0)
			{
			if (l_logo_yniflaser.arr[0] != 'Y')			    
			{
				fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style */
				fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[100],dc_short_name1.arr);
				fprintf(fp,"%c(s-3B",ESC); 	/* To set Bold style */
			}
			}
			else
			fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[100],dc_short_name1.arr);
		else
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[100],dc_short_name1.arr);

		fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[571],l_gl_holder_name1.arr);
	    //fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[10],l_gl_holder_name1.arr);
	    lsr_line_cnt();
	    

	    if (dc_short_name2.arr[0] != '\0' || l_gl_holder_name2.arr[0] != '\0')
	    {
		  fprintf(fp,"%-17.17s  %-25.25s ","",dc_short_name2.arr);
	      fprintf(fp,"%-18.18s  %-25.25s\n","",l_gl_holder_name2.arr);
	      lsr_line_cnt();
	    }
		

	    if (dc_short_name3.arr[0] != '\0')
	    {
		  fprintf(fp,"%-17.17s  %-25.25s ","",dc_short_name3.arr);
	      fprintf(fp,"\n");
	      lsr_line_cnt();
	    }
	    
        //printing Patient Details 2nd line
      if(l_nric_number.arr[0]!='\0' || l_gl_ic.arr[0]!='\0')		
	   { 
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[560],l_nric_number.arr);   
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[580],l_gl_ic.arr);   
	    lsr_line_cnt();	
	   }
	 
      
	  if(l_bill_contact_name_p.arr[0]!='\0' || l_credit_doc_ref_desc.arr[0]!='\0' 
	     || l_bill_contact_name_title_p.arr[0]!='\0')
	   {
	    fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[590],l_bill_contact_name_p.arr);	    
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[600],l_credit_doc_ref_desc.arr);
	    lsr_line_cnt();
	   }
	   
	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_contact_name_title_p.arr); 
		   	    	    
	  if(l_bill_contact_name_title_c.arr[0]!='\0' || l_bill_long_desc_p.arr[0]!='\0' ||
	     l_bill_long_desc_c.arr[0]!='\0' || l_bill_add1_desc_p.arr[0]!='\0' ||
		 l_bill_add1_desc_c.arr[0]!='\0' || l_bill_add2_desc_p.arr[0]!='\0' ||
		 l_bill_add2_desc_c.arr[0]!='\0' || l_bill_add3_desc_p.arr[0]!='\0' ||
		 l_bill_add3_desc_p.arr[0]!='\0' || l_bill_add3_desc_c.arr[0]!='\0')
	   {  
	    
		fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[610],l_bill_contact_name_title_c.arr);   
	    lsr_line_cnt();
      
	   		
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_long_desc_p.arr);	        
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_long_desc_c.arr);
	    lsr_line_cnt();

	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add1_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add1_desc_c.arr);
	    lsr_line_cnt();
	   

	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add2_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add2_desc_c.arr);
	    lsr_line_cnt();
		
	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add3_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add3_desc_c.arr);	    
	    lsr_line_cnt();

	  }
	  else
	  fprintf(fp,"\n");
	  if (l_pat_reln_with_gl_holder.arr[0] != '\0')
	  {

        l_pat_reln_with_gl_holder1.arr[0] = '\0';
		l_pat_reln_with_gl_holder1.len = 0;

		r_ctr = 0; 
		if(l_pat_reln_with_gl_holder.len > 0)
		split_text(l_pat_reln_with_gl_holder.arr,25,l_pat_reln_with_gl_holder1.arr,&r_ctr);
		if(l_pat_reln_with_gl_holder.len > 25)
		split_text(l_pat_reln_with_gl_holder.arr,25,l_pat_reln_with_gl_holder2.arr,&r_ctr);
	  }
		
    //printing admission date & discharge date

	
		if(dc_admn_date.arr[0]!='\0')
		{
			init_date_temp_var();
			strcpy(date_convert.arr,dc_admn_date.arr);
			fun_change_loc_date1();
			strcpy(dc_admn_date.arr,date_convert.arr);
		}

	    
		//if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)) 
		//{
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[20],dc_admn_date.arr);
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[240],l_pat_reln_with_gl_holder1.arr);
	    lsr_line_cnt();
		//}
		
		
		if(d_dis_date.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d_dis_date.arr);
		  fun_change_loc_date1();
		  strcpy(d_dis_date.arr,date_convert.arr);
		}

	    
		//if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0))
		//{
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[40],d_dis_date.arr);
		fprintf(fp,"%-18.18s  %-25.25s\n","",l_pat_reln_with_gl_holder2.arr);
		lsr_line_cnt();
		//}
		//else
		//fprintf(fp,"\n");
		//lsr_line_cnt();
		//fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[40],dc_admn_date.arr);
		//else
		
	 //printing patient id


	 	if(d_date_of_birth.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d_date_of_birth.arr);
		  fun_change_loc_date();
		  strcpy(d_date_of_birth.arr,nd_loc_date1.arr);
		 }

	
		fprintf(fp,"%-17.17s: %-25.25s \n",loc_legend[50],d_patient_id.arr);   
	    fprintf(fp,"%-6.6s/%-10.10s: %-11.11s /%-10.10s",loc_legend[1200],loc_legend[1411],d_date_of_birth.arr,d_gender_desc.arr);
		get_location();
		if(d_location.arr[0]!='\0')
		fprintf(fp,"   %-18.18s: %-25.25s\n",loc_legend[1407],d_location.arr);
	    else
        fprintf(fp,"\n");
		lsr_line_cnt();

	   //printing episode id

		fprintf(fp,"%-17.17s: %1s",loc_legend[90],d_episode_type.arr); 
		if (strcmp(d_episode_type.arr,"R")!=0)
       	fprintf(fp,"/%-8.8s",d_episode_id.arr); 
		if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)) 
		fprintf(fp,"/%-4.4s",d_visit_id.arr);
		else
		fprintf(fp,"%-5.5s"," ");
		
	 /**** Treating Adm.Doct ****/
     	get_attd_admit_pract();
		pract_name_1.arr[0]='\0';
		pract_name_1.len=0;
		nd_pract_id.arr[0]='\0';
		nd_pract_id.len=0;

	    if(d_attend_practitioner_id.arr[0]!='\0' && d_admit_practitioner_id.arr[0]!='\0') 
	    {
	 		if(strcmp(d_attend_practitioner_id.arr,d_admit_practitioner_id.arr)==0)
			{
			  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name();
			  fprintf(fp,"%-10.10s %-18.18s: %-30.30s"," ",loc_legend[1408],pract_name.arr);
			} 
			else
			if(strcmp(d_attend_practitioner_id.arr,d_admit_practitioner_id.arr)!=0)
			{
			  
			  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name();
			  strcpy(pract_name_1.arr,pract_name.arr);
			  strcat(pract_name_1.arr,"/");
			  nd_pract_id.arr[0]='\0';
			  strcpy(nd_pract_id.arr,d_admit_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_admit_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name(d_admit_practitioner_id.arr);
			  strcat(pract_name_1.arr,pract_name.arr);

			  fprintf(fp,"%-10.10s %-18.18s: %-30.30s"," ",loc_legend[1408],pract_name_1.arr);
			} 
		}
		else
		if(d_attend_practitioner_id.arr[0]!='\0' && d_admit_practitioner_id.arr[0]=='\0') 
		{
		 
		  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
		  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		  nd_pract_id.arr[nd_pract_id.len]='\0';
		  get_pract_name();
		  fprintf(fp,"%-10.10s %-18.18s: %-15.15s"," ",loc_legend[1408],pract_name.arr);
		} 
        
		if(d_attend_practitioner_id.arr[0]=='\0' && d_admit_practitioner_id.arr[0]!='\0') 
		{
		  strcpy(nd_pract_id.arr,d_admit_practitioner_id.arr);
		  nd_pract_id.len=strlen(d_admit_practitioner_id.arr);
		  nd_pract_id.arr[nd_pract_id.len]='\0';
		  get_pract_name();
		  fprintf(fp,"%-10.10s %-18.18s: %-15.15s"," ",loc_legend[1408],pract_name.arr);
		} 
	    if(d_attend_practitioner_id.arr[0]!='\0' || d_admit_practitioner_id.arr[0]!='\0')
		{
		  fprintf(fp,"\n");
		  lsr_line_cnt();
		}
	   		
		if (d_org_dept.arr[0]!='\0')
		{
		 if(d_attend_practitioner_id.arr[0]!='\0' || d_admit_practitioner_id.arr[0]!='\0')
		 fprintf(fp,"   %-17.17s: %-100.100s \n",loc_legend[1210],d_org_dept.arr);
		 else
		 fprintf(fp,"\n   %-17.17s: %-100.100s \n",loc_legend[1210],d_org_dept.arr);
		}
		else
		{
		 if (d_org_dept.arr[0]=='\0' && d_attend_practitioner_id.arr[0]=='\0' && d_admit_practitioner_id.arr[0]=='\0')
		 fprintf(fp,"\n");
	    }
		lsr_line_cnt(); 
	    
	
	}
	else //added by raghava at 15/11/07 for printing header as same as laser format
	{

	    fprintf(fp,"\n%-42.42s%-80.80s\n"," ",nd_hosp_name.arr);
		lsr_line_cnt();lsr_line_cnt();
		fprintf(fp,"%-42.42s%-80.80s\n\n"," ",nd_telfax.arr);
		lsr_line_cnt();
		fprintf(fp,"%-80.80s\n\n",loc_legend[300]);
		lsr_line_cnt();lsr_line_cnt();
		fprintf(fp,"%-s: %-s ",loc_legend[70],d1_doc_type_num.arr);

		if(d1_doc_date.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d1_doc_date.arr);
		  fun_change_loc_date();
		  strcpy(d1_doc_date1.arr,nd_loc_date1.arr);
		}
		
		fprintf(fp,"%-s: %-s      ",loc_legend[80],d1_doc_date1.arr);

		if(l_no_settlement_details.arr[0]!='R' || l_no_settlement_details.arr[0]=='\0')
		{
			if (strcmp(dc_bill_print_flag.arr,"Y") == 0)
			{			
			   
				fprintf(fp,"%35.35s: %-s ",loc_legend[290],nd_curr_date1.arr);
				fprintf(fp,"\n\n\n");
				lsr_line_cnt();lsr_line_cnt();lsr_line_cnt();
			}
			
			else
			{
				fprintf(fp,"\n\n\n");
				lsr_line_cnt();lsr_line_cnt();lsr_line_cnt();
			}
		}
		
		fprintf(fp,"%-45.45s",loc_legend[560]);
	    fprintf(fp,"%-45.45s\n",loc_legend[570]);	    
	    lsr_line_cnt();

		if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		prt_line_uc();
	    if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
	    prt_line_uc_wide();

		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 1)
		prt_line_uc();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 2)
		prt_line_uc_wide();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 3)
		prt_line_uc_wide1();
		if(strcmp(d_cust_code.arr,"\0")==0 && (lcol_cnt == 6 || lcol_cnt == 5))
		prt_line_uc_wide2();
	   
	    fprintf(fp,"\n");    
	    lsr_line_cnt();
		
		dc_short_name1.arr[i] = '\0';
	    dc_short_name1.len = 0;	    

	    dc_short_name2.arr[0] = '\0';
	    dc_short_name2.len = 0;	    

	    dc_short_name3.arr[0] = '\0';
	    dc_short_name3.len = 0;	    

	    r_ctr = 0;   
	    if (dc_short_name.len >0)	
        split_text(dc_short_name.arr,25,dc_short_name1.arr,&r_ctr);	 
	    if (dc_short_name.len >25)
	    split_text(dc_short_name.arr,25,dc_short_name2.arr,&r_ctr);
	    if (dc_short_name.len >50)
	    split_text(dc_short_name.arr,25,dc_short_name3.arr,&r_ctr);	    
	    
	    
	    l_gl_holder_name1.arr[0] = '\0';
	    l_gl_holder_name1.len = 0;

	    l_gl_holder_name2.arr[0] = '\0';
	    l_gl_holder_name2.len = 0;	    


        r_ctr = 0; 
	    if(l_gl_holder_name.len > 0)
	    split_text(l_gl_holder_name.arr,25,l_gl_holder_name1.arr,&r_ctr);	    
	    if(l_gl_holder_name.len > 25)
	    split_text(l_gl_holder_name.arr,25,l_gl_holder_name2.arr,&r_ctr);	    
	    
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[100],dc_short_name1.arr);
		fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[571],l_gl_holder_name1.arr);
	    //fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[10],l_gl_holder_name1.arr);
	    lsr_line_cnt();
	    

	    if (dc_short_name2.arr[0] != '\0' || l_gl_holder_name2.arr[0] != '\0')
	    {
		  fprintf(fp,"%-17.17s  %-25.25s ","",dc_short_name2.arr);
	      fprintf(fp,"%-18.18s  %-25.25s\n","",l_gl_holder_name2.arr);
	      lsr_line_cnt();
	    }

	    if (dc_short_name3.arr[0] != '\0')
	    {
		  fprintf(fp,"%-17.17s  %-25.25s ","",dc_short_name3.arr);
	      fprintf(fp,"\n");
	      lsr_line_cnt();
	    }
	    
      //printing Patient Details 2nd line
      if(l_nric_number.arr[0]!='\0' || l_gl_ic.arr[0]!='\0')		
	   { 
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[560],l_nric_number.arr);   
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[580],l_gl_ic.arr);   
	    lsr_line_cnt();	
	   }
	 
      
	  if(l_bill_contact_name_p.arr[0]!='\0' || l_credit_doc_ref_desc.arr[0]!='\0' 
	     || l_bill_contact_name_title_p.arr[0]!='\0')
	   {
	    fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[590],l_bill_contact_name_p.arr);	    
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[600],l_credit_doc_ref_desc.arr);
	    lsr_line_cnt();
	   }
	   
	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_contact_name_title_p.arr); 
		   	    	    
	  if(l_bill_contact_name_title_c.arr[0]!='\0' || l_bill_long_desc_p.arr[0]!='\0' ||
	     l_bill_long_desc_c.arr[0]!='\0' || l_bill_add1_desc_p.arr[0]!='\0' ||
		 l_bill_add1_desc_c.arr[0]!='\0' || l_bill_add2_desc_p.arr[0]!='\0' ||
		 l_bill_add2_desc_c.arr[0]!='\0' || l_bill_add3_desc_p.arr[0]!='\0' ||
		 l_bill_add3_desc_p.arr[0]!='\0' || l_bill_add3_desc_c.arr[0]!='\0')
	   {  
	    
		fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[610],l_bill_contact_name_title_c.arr);   
	    lsr_line_cnt();
      
	   		
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_long_desc_p.arr);	        
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_long_desc_c.arr);
	    lsr_line_cnt();

	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add1_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add1_desc_c.arr);
	    lsr_line_cnt();
	   

	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add2_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add2_desc_c.arr);
	    lsr_line_cnt();
		
	   
	    fprintf(fp,"%-17.17s  %-25.25s ","",l_bill_add3_desc_p.arr);	    
	    fprintf(fp,"%-18.18s  %-25.25s\n","",l_bill_add3_desc_c.arr);	    
	    lsr_line_cnt();

	  }
	  else
	  fprintf(fp,"\n");
	    if (l_pat_reln_with_gl_holder.arr[0] != '\0')
	    {

        l_pat_reln_with_gl_holder1.arr[0] = '\0';
		l_pat_reln_with_gl_holder1.len = 0;

		r_ctr = 0; 
		if(l_pat_reln_with_gl_holder.len > 0)
		split_text(l_pat_reln_with_gl_holder.arr,25,l_pat_reln_with_gl_holder1.arr,&r_ctr);
		if(l_pat_reln_with_gl_holder.len > 25)
		split_text(l_pat_reln_with_gl_holder.arr,25,l_pat_reln_with_gl_holder2.arr,&r_ctr);
	    }
		
    //printing admission date & discharge date

	
		if(dc_admn_date.arr[0]!='\0')
		{
			init_date_temp_var();
			strcpy(date_convert.arr,dc_admn_date.arr);
			fun_change_loc_date1();
			strcpy(dc_admn_date.arr,date_convert.arr);
		}

	    
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[20],dc_admn_date.arr);
	    fprintf(fp,"%-18.18s: %-25.25s\n",loc_legend[240],l_pat_reln_with_gl_holder1.arr);
	    lsr_line_cnt();
		
		
		 if(d_dis_date.arr[0]!='\0')
		{
			init_date_temp_var();
			strcpy(date_convert.arr,d_dis_date.arr);
			fun_change_loc_date1();
			strcpy(d_dis_date.arr,date_convert.arr);
		}

	    
		fprintf(fp,"%-17.17s: %-25.25s ",loc_legend[40],d_dis_date.arr);
	    if(l_pat_reln_with_gl_holder2.arr[0]!='\0')
	 	fprintf(fp,"%-18.18s  %-25.25s\n","",l_pat_reln_with_gl_holder2.arr);
	    lsr_line_cnt();
	
	 //printing patient id

	    if(d_date_of_birth.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d_date_of_birth.arr);
		  fun_change_loc_date();
		  strcpy(d_date_of_birth.arr,nd_loc_date1.arr);
		 }

		fprintf(fp,"%-17.17s: %-25.25s \n",loc_legend[50],d_patient_id.arr);   
	    fprintf(fp,"%-6.6s/%-10.10s: %-11.11s /%-10.10s",loc_legend[1200],loc_legend[1411],d_date_of_birth.arr,d_gender_desc.arr);
		get_location();
		if(d_location.arr[0]!='\0')
		fprintf(fp,"   %-18.18s: %-25.25s",loc_legend[1407],d_location.arr);
		if (d_org_dept.arr[0]!='\0')
		fprintf(fp,"\n   %-18.18s: %-100.100s \n",loc_legend[1210],d_org_dept.arr);
		else
		fprintf(fp,"\n");
	    lsr_line_cnt();
   
	//printing episode id

		fprintf(fp,"%-17.17s: %1s",loc_legend[90],d_episode_type.arr); 

		if (strcmp(d_episode_type.arr,"R")!=0)
       	fprintf(fp,"/%-8.8s",d_episode_id.arr); 
			
		if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)) 
		fprintf(fp,"/%-4.4s\n",d_visit_id.arr);
		else
		fprintf(fp,"%-5.5s\n"," ");	
	 	
		/**** Treating Adm.Doct ****/
        get_attd_admit_pract();
		pract_name_1.arr[0]='\0';
		pract_name_1.len=0;
		nd_pract_id.arr[0]='\0';
		nd_pract_id.len=0;

	    if(d_attend_practitioner_id.arr[0]!='\0' && d_admit_practitioner_id.arr[0]!='\0') 
	    {
	 		if(strcmp(d_attend_practitioner_id.arr,d_admit_practitioner_id.arr)==0)
			{
			  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name();
			  fprintf(fp,"%-10.10s %-18.18s: %-30.30s\n"," ",loc_legend[1408],pract_name.arr);
			} 
			else
			if(strcmp(d_attend_practitioner_id.arr,d_admit_practitioner_id.arr)!=0)
			{
			  
			  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name();
			  strcpy(pract_name_1.arr,pract_name.arr);
			  strcat(pract_name_1.arr,"/");
			  nd_pract_id.arr[0]='\0';
			  strcpy(nd_pract_id.arr,d_admit_practitioner_id.arr);
			  nd_pract_id.len=strlen(d_admit_practitioner_id.arr);
		      nd_pract_id.arr[nd_pract_id.len]='\0';
			  get_pract_name(d_admit_practitioner_id.arr);
			  strcat(pract_name_1.arr,pract_name.arr);

			  fprintf(fp,"%-10.10s %-18.18s: %-30.30s\n"," ",loc_legend[1408],pract_name_1.arr);
			} 
		}
		else
		if(d_attend_practitioner_id.arr[0]!='\0' && d_admit_practitioner_id.arr[0]=='\0') 
		{
		 
		  strcpy(nd_pract_id.arr,d_attend_practitioner_id.arr);
		  nd_pract_id.len=strlen(d_attend_practitioner_id.arr);
		  nd_pract_id.arr[nd_pract_id.len]='\0';
		  get_pract_name();
		  fprintf(fp,"%-10.10s %-18.18s: %-15.15s/%-15.15s\n"," ",loc_legend[1408],pract_name.arr," ");
		} 
        
		if(d_attend_practitioner_id.arr[0]=='\0' && d_admit_practitioner_id.arr[0]!='\0') 
		{
		  strcpy(nd_pract_id.arr,d_admit_practitioner_id.arr);
		  nd_pract_id.len=strlen(d_admit_practitioner_id.arr);
		  nd_pract_id.arr[nd_pract_id.len]='\0';
		  get_pract_name();
		  fprintf(fp,"%-10.10s %-18.18s: %-15.15s/%-15.15s\n"," ",loc_legend[1408]," ",pract_name.arr);
		} 
	
	    if(d_attend_practitioner_id.arr[0]=='\0' && d_admit_practitioner_id.arr[0]=='\0') 
		fprintf(fp,"\n");
		lsr_line_cnt();
	    
	}

	  if (dc_ind.arr[0] == 'P')
		strcpy(bill_title.arr,loc_legend[320]);
	  else if (dc_ind.arr[0] == 'I')
		strcpy(bill_title.arr,loc_legend[330]);
	  else
		strcpy(bill_title.arr," ");
	
	
	if (nd_reprint_yn == 'Y')
	{
		
		/*
		if (strcmp(dc_bill_print_flag.arr,"Y") == 0)
		{    
		     //fprintf(fp,"%c(s4H",ESC);
			
		     if (l_lsr != 0 && l_dmp == 0)
		     {		        
			  
				fprintf(fp,"%52.52s        ",bill_title.arr);
				fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[290],nd_curr_date1.arr);
				fprintf(fp,"\n");
		 			
		     }
		     else
		     {
				//fprintf(fp,"%-79.79s %s\n"," ",loc_legend[190]);
				fprintf(fp,"%52.52s        ",bill_title.arr);
				fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[290],nd_curr_date1.arr);
				fprintf(fp,"\n");
				lsr_line_cnt();
		     }
		     // fprintf(fp,"%c&k2S",ESC);
		}
		
		else
		{
		     if (l_lsr != 0 && l_dmp == 0)
		     {
			//
		     }
		     else
		     {
			  fprintf(fp,"%52.52s        \n\n", bill_title.arr);
		     }
		}
		*/
	}
	else
	{
	   if (l_lsr != 0 && l_dmp == 0)
	   {
		//
	   }
	   else
	   {
		fprintf(fp,"%57.57s        \n\n",bill_title.arr);
	   }

	}

	/* LINE 3 */

	//if(d_bill_nature_code.arr[0] == 'C')
	//	fprintf(fp,"%-16.16s : %-20.20s ",loc_legend[10],dc_credit_doc_ref_desc.arr);
	//else

	if(d_bill_nature_code.arr[0] == 'A')
	{
	
	  if (l_lsr != 0 && l_dmp == 0)
	  {
	    
		
		//fprintf(fp,"%-20.20s : %-20.20s ",loc_legend[10],dc_long_name.arr);
		fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style */
	    
		//Below Code Added by Raghava on 28/10/2009 for IN13922
		
		get_detail_desc_for_cust();
	    len_desc = strlen(l_detail_desc.arr);
		while(r_ctrdesc < len_desc)
		{	
			split_text(l_detail_desc.arr,70,cl_string_desc,&r_ctrdesc);
			if(l_ctr==1)
			fprintf(fp,"%-16.16s : %-70.70s ",loc_legend[10],cl_string_desc);
			else
			fprintf(fp,"%-17.17s  %-70.70s "," ",cl_string_desc);
			strcpy(cl_string_desc,"");  
			fprintf(fp,"\n");lsr_line_cnt();
			l_ctr++;
		} 
		r_ctrdesc=0;
		l_ctr=1;
		
		//fprintf(fp,"%-16.16s : %-40.40s ",loc_legend[10],l_bill_long_desc_c.arr); Commented By raghava on 29/10/2009
		fprintf(fp,"%c(s-3B",ESC); 	/* To release Bold style */
	    fprintf(fp,"\n");
	    lsr_line_cnt();
	  }
	  else
	  {
		//fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style */
		fprintf(fp,"%-16.16s : %-40.40s ",loc_legend[10],l_bill_long_desc_c.arr);
		//fprintf(fp,"%c(s-3B",ESC); 	/* To release Bold style */
	    fprintf(fp,"\n");
	    lsr_line_cnt();
	  }

    }

	 if (l_lsr != 0 && l_dmp == 0)
     {
		//
     }

     /* FOR DMP PRINTER */
	 
	 /*
	 else
      {
		//fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[10],l_gl_holder_name.arr);
		//fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[10],l_bill_long_desc_c.arr);
		
		if(dc_admn_date.arr[0]!='\0')
		{
			init_date_temp_var();
			strcpy(date_convert.arr,dc_admn_date.arr);
			fun_change_loc_date1();
			strcpy(dc_admn_date.arr,date_convert.arr);
		}

		fprintf(fp,"%-60.60s%-17.17s: %-25.25s\n"," ",loc_legend[20],dc_admn_date.arr);	

		fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[30],l_credit_doc_ref_desc.arr);

		if(d_dis_date.arr[0]!='\0')
		{
			init_date_temp_var();
			strcpy(date_convert.arr,d_dis_date.arr);
			fun_change_loc_date1();
			strcpy(d_dis_date.arr,date_convert.arr);
		}

		fprintf(fp,"%-17.17s: %-25.25s\n",loc_legend[40],d_dis_date.arr);
	
		//fprintf(fp,"%-55.55s",l_bill_contact_name_title.arr);
	
	
		if((strlen(l_bill_contact_name.arr)>0)&&(strlen(l_bill_contact_name_title.arr)>0))
			fprintf(fp,"%-19.19s%-19.19s/%-20.20s"," ",l_bill_contact_name.arr, l_bill_contact_name_title.arr);
		else if((strlen(l_bill_contact_name.arr)>0)||(strlen(l_bill_contact_name_title.arr)==0)) 
			fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_contact_name.arr);
		else if((strlen(l_bill_contact_name.arr)==0)||(strlen(l_bill_contact_name_title.arr)>0)) 
			fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_contact_name_title.arr);
		else if((strlen(l_bill_contact_name.arr)==0)||(strlen(l_bill_contact_name_title.arr)==0))
			fprintf(fp,"%-19.19s%-19.19s %-20.20s"," "," ", " ");
		
		fprintf(fp," %-17.17s: %-20.20s\n",loc_legend[50],d_patient_id.arr);   

		//fprintf(fp,"%-55.55s",l_bill_long_desc.arr);
		fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_long_desc.arr);
		fprintf(fp," %-17.17s: %-20.20s\n",loc_legend[560],l_nric_number.arr);   

		//fprintf(fp,"%-55.55s",l_bill_add1_desc.arr);
		fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_add1_desc.arr);
		
		fprintf(fp," %-17.17s: %-s\n",loc_legend[70],d1_doc_type_num.arr); 

		//fprintf(fp,"%-55.55s",l_bill_add2_desc.arr);
		fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_add2_desc.arr);

		if(d1_doc_date.arr[0]!='\0')
		{
		  init_date_temp_var();
		  strcpy(date_convert.arr,d1_doc_date.arr);
		  fun_change_loc_date();
		  strcpy(d1_doc_date1.arr,nd_loc_date1.arr);
		 }
		fprintf(fp," %-17.17s: %-12.12s\n",loc_legend[80],d1_doc_date1.arr); 
	
	  	//fprintf(fp,"%-55.55s"," ",l_bill_add3_desc.arr);
		fprintf(fp,"%-19.19s%-40.40s"," ",l_bill_add3_desc.arr);

		fprintf(fp," %-17.17s: %1s",loc_legend[90],d_episode_type.arr); 

		if (strcmp(d_episode_type.arr,"R")!=0)
       	fprintf(fp,"/%-8s",d_episode_id.arr); 
			
		if ((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)) 
			fprintf(fp,"/%-4s\n",d_visit_id.arr);	
	    else
			fprintf(fp,"\n");
		
		lsr_line_cnt();


		// LINE 4 
	
		//After Incoropation Pat Relation legend	
		fprintf(fp,"%-17.17s: %-40.40s ",loc_legend[100],dc_short_name.arr);
		fprintf(fp,"%-17.17s: %-16.16s",loc_legend[240],l_pat_reln_with_gl_holder.arr);

		fprintf(fp,"\n");
		lsr_line_cnt();
	}*/

		//check_report_format();

		/* LINE 5 */
		//if(d_summary_yn=='Y')

	if (l_lsr != 0 && l_dmp == 0)
	{
	   if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
		prt_line_uc();
	   if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
	    prt_line_uc_wide();

		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 1)
		prt_line_uc();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 2)
		prt_line_uc_wide();
		if(strcmp(d_cust_code.arr,"\0")==0 && lcol_cnt == 3)
		prt_line_uc_wide1();
		if(strcmp(d_cust_code.arr,"\0")==0 && (lcol_cnt == 6 || lcol_cnt == 5))
		prt_line_uc_wide2();
				
				
		fprintf(fp,"\n");
		lsr_line_cnt();
		if (l_main_hdr == 0)
		{
			// no need to print Subhdr 
		}
		else
		{
			
			//fprintf(fp,"%6s %-20.20s %5s %-20.20s        %8.8s \n"," ",loc_legend[110]," "," ",currency.arr);		
			fprintf(fp,"%6s %-20.20s %5s %-20.20s (%s %s)\n  "," "," "," "," ",loc_legend[1401],currency.arr);		
			//fprintf(fp,"%-35s %21s %17s %17.17s\n",loc_legend[770],loc_legend[680],loc_legend[820],loc_legend[830]);
			lsr_line_cnt();
		    l_cnt=l_cnt+1;
			/*if(l_cnt==2)
			{ 
		    prt_line();
			fprintf(fp,"\n");
			lsr_line_cnt();
			}*/	
		}
	}	
	else
	{	
		prt_line_uc();
		fprintf(fp,"\n");lsr_line_cnt();
		//fprintf(fp,"%6s %-20.20s %5s %-20.20s        %8.8s  \n"," ",loc_legend[110]," "," ",currency.arr);
	    fprintf(fp,"%6s %-20.20s %5s %-20.20s        %8.8s  \n"," "," "," "," ",currency.arr);
		lsr_line_cnt();
		l_cnt=l_cnt+1;
		/*if(l_cnt==2)
		{ 
		prt_line();
		fprintf(fp,"\n");
		lsr_line_cnt();
		}*/	
	}

		//else			
		//fprintf(fp,"%6s %-20.20s %5s %-20.20s %12s%-20.20s\n\n"," ",loc_legend[110]," ",loc_legend[180]," ",loc_legend[120]);
	
	if (l_lsr != 0 && l_dmp == 0)
	{
		l_main_hdr = 1;
	}
	else
	{
		v_lno = 0;
	}

	 }

 }  
 else  //billformatid =2
 {
	
	fprintf(fp,"%c(s14H",ESC);
	fprintf(fp,"%c(s-3B",ESC);
	
	fetch_dtl();
	
    print_title();
	
	print_bill_title();
	
	print_addl_line();
		 
	print_body();
	
	prt_line_uc_wide();
	
	fprintf(fp,"\n");

	get_currency();

	fprintf(fp,"%6s %-20.20s %5s %-20.20s (%s %s)\n  "," "," "," "," ",loc_legend[1401],currency.arr);
	
   if (l_lsr != 0 && l_dmp == 0)
	{
		l_main_hdr = 1;
	}
	else
	{
		v_lno = 0;
	}

 }


}  //end of print_report_head procedure
/**** Added by Raghava For CRF-521 *******/
get_detail_desc_for_cust()
{
		l_detail_desc.arr[0]='\0';
		l_detail_desc.len=0;
  EXEC SQL SELECT	NVL(DETAIL_DESC,LONG_NAME)
		            INTO 
				    l_detail_desc
		FROM ar_customer_lang_vw
		WHERE cust_code = :d_cust_code
		AND LANGUAGE_ID = :nd_lang_id;  

		  if (OERROR)
		  err_mesg("SELECT failed on table ar_customer_lang_vw",0,"");

   l_detail_desc.arr[l_detail_desc.len] = '\0';
 }


print_footer1()  
{
     	
  if (strcmp(nd_bill_format_id.arr,"1")==0)	
  {
    l_bill_page_no++;
  	fprintf(fp,"%80.80s %d\n",loc_legend[210],l_bill_page_no);
  }
  else
  {
 	l_bill_page_no_frmt2++;
  	fprintf(fp,"%80.80s %d\n",loc_legend[210],l_bill_page_no_frmt2);
  }

}
get_rounded_amt(nd_payable_amt)
{
  
  get_round_flag();

	EXEC SQL EXECUTE
	BEGIN
		blcommon.proc_get_rounded_Amt(:nd_payable_amt,
									  :nd_round_flag,
									  :nd_net_pay_amt_after_rounded,
									  :nd_rounded_amt
									  );

	END;
	END-EXEC;



}
get_round_flag()
{

nd_round_flag.arr[0]='\0';
nd_round_flag.len=0;

EXEC SQL SELECT nvl(BILL_ROUNDING_IND,0) 
		 INTO :nd_round_flag
		 FROM BL_PARAMETERS	
         WHERE OPERATING_FACILITY_ID=:nd_facility_id;

nd_round_flag.arr[nd_round_flag.len]='\0';
}
/* FOR GETTING DISCHARGE DATE */

get_adm_dis_date()
{

 dc_admn_date.arr[dc_admn_date.len]='\0';
 d_dis_date.arr[d_dis_date.len]    ='\0';
 dc_admn_date.len=0;
 d_dis_date.len  =0;
 
   EXEC SQL  Select TO_CHAR(ADM_VISIT_DATE,'DD/MM/YYYY HH24:MI')ADM_VISIT_DATE,
		   TO_CHAR(DISCHARGE_DATE_TIME,'DD/MM/YYYY HH24:MI')DISCHARGE_DATE_TIME
		   INTO
		   :dc_admn_date,
		   :d_dis_date
           FROM BL_ENCOUNTER_FOR_QRY_VW
           WHERE
		   FACILITY_ID		= :nd_facility_id
		   AND nvl(LANGUAGE_ID,:nd_lang_id)  = :nd_lang_id
		   AND EPISODE_TYPE = :d_episode_type
		   AND ( :d_episode_type ='R' or (:d_episode_type not in ('R') and episode_id= :d_episode_id))
		   AND ( :d_episode_type in ('R','I','D') or (:d_episode_type in ('O','E') and VISIT_ID=:d_visit_id));

if (OERROR) 
	{	
	  disp_message (ERR_MESG,"Failed to FETCH FROM BL_ENCOUNTER_FOR_QRY_VW");

	}
     dc_admn_date.arr[dc_admn_date.len] ='\0';
	 d_dis_date.arr[d_dis_date.len]	    ='\0';
	 

}

prt_line()
{
  int i;
  {
     for (i=0;i<105;i++)
     {
	if ( l_logo_yniflaser.arr[0] == 'Y')	
		fprintf(fp,"%c",175);
	else
		fprintf(fp,"_");		     
     }
  } 	      
}


prt_line_uc_wide()
{
  int i;
  {
     for (i=0;i<105;i++)
     {
	  fprintf(fp,"_");		     
     }
  } 	      
}

prt_line_uc_wide1()
{
  int i;
  {
     for (i=0;i<120;i++)
     {
	  fprintf(fp,"_");		     
     }
  } 	      
}
prt_line_uc_wide2()
{
  int i;
  {
     for (i=0;i<125;i++)
     {
	  fprintf(fp,"_");		     
     }
  } 	      
}

prt_line_uc()
{
  int i;
  {
     for (i=0;i<105;i++)
     {
	  fprintf(fp,"_");		     
     }
  } 	      
}

lsr_line_cnt()
{
	if (l_lsr != 0 && l_dmp == 0)
	{
	  v_lno = v_lno  + 1;
  
	  if (v_lno > max_lines) 
	  print_next_page1();
	  
	}

}


delete_sy_prog()
{
  
	EXEC SQL DELETE FROM SY_PROG_PARAM
			  WHERE PGM_ID     = 'BLRCANBL'
				AND SESSION_ID = :nd_session_id
				AND PGM_DATE   = :nd_pgm_date;

EXEC SQL COMMIT WORK;

	return 1;
}




print_footer()
 {
    int i,r,j,l;
	char first_line_yn;
    int no_of_lines = 0;

   if (l_lsr != 0 && l_dmp == 0 )
			{
			   /*-----------------------22/09/2005------------------*/

	            if (loc_legend[390][0] != '\0' || loc_legend[400][0] != '\0'||
				   loc_legend[410][0] != '\0' || loc_legend[420][0] != '\0'||
				   loc_legend[430][0] != '\0' || loc_legend[440][0] != '\0'||
				   loc_legend[450][0] != '\0' || loc_legend[460][0] != '\0'||
				   loc_legend[470][0] != '\0' || loc_legend[480][0] != '\0'||
				   loc_legend[490][0] != '\0' || loc_legend[500][0] != '\0'||
				   loc_legend[510][0] != '\0' || loc_legend[520][0] != '\0'||
				   loc_legend[530][0] != '\0' || loc_legend[540][0] != '\0') 
			     {
				   remarks_cnt_chk();


				   while(v_lno <= (max_lines-l_lno-5))
				   {
					fprintf(fp,"\n");
					v_lno++;
				   }


				   // This  is a check for accommodating remarks with in a page.

				    l_main_hdr = 0;	
				    fprintf(fp,"\n"); 
				    v_lno++;
				    if (v_lno > max_lines) print_next_page1();
				    

				if (l_lsr != 0 && l_dmp == 0)
				{
				if (l_logo_yniflaser.arr[0] != 'Y')			    
				{
				      fprintf(fp,"%c9",ESC);        /* To Release the margin */				  
				      fprintf(fp,"%c(s8H",ESC); 	/* To set the font size*/
				      fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style */
				      
				      l_main_hdr = 0;
				      fprintf(fp,"\n");					      
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				}
				}

					/*if (loc_legend[390][0]	!= '\0')
					{
					fprintf(fp,"%-s\n\n",loc_legend[390]);
					l_main_hdr = 0;
					 v_lno=v_lno+2;
					 if (v_lno > max_lines) print_next_page1();
					}*/
				
				if (l_lsr != 0 && l_dmp == 0)
				{
				if (l_logo_yniflaser.arr[0] != 'Y')			    
				{
				      fprintf(fp,"%c(s12.5H",ESC); 	/* To set the font size	  */
				}
				  
				  }  				      
				      /*if (loc_legend[400][0] != '\0')	
				      {
				      fprintf(fp,"%-s\n",loc_legend[400]); 
				      l_main_hdr = 0;
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[410][0] != '\0') 
				      {
				      fprintf(fp,"%-s\n",loc_legend[410]);
				      l_main_hdr = 0;
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[420][0] != '\0') 
				      {
				      l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[420]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[430][0] != '\0') 
				      {
				      l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[430]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[440][0] != '\0') 
				      {
				      l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[440]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[450][0] != '\0') 
				      {
				      l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[450]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[460][0] != '\0') 
				      {
				      l_main_hdr = 0;
				       fprintf(fp,"%-s\n",loc_legend[460]);
				       v_lno++;
				       if (v_lno > max_lines) print_next_page1();
				       }


				      if (loc_legend[470][0] != '\0') 
				      {
					l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[470]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				      if (loc_legend[480][0] != '\0') 
				      {
				      l_main_hdr = 0;
				      fprintf(fp,"%-s\n",loc_legend[480]);
				      v_lno++;
				      if (v_lno > max_lines) print_next_page1();
				      }

				     
				     //fprintf(fp,"\n"); v_lno++;

				     if (loc_legend[490][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[490]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }

				     if (loc_legend[500][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[500]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }

				     if (loc_legend[510][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[510]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }

				     if (loc_legend[520][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[520]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }

				     if (loc_legend[530][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[530]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }

				     if (loc_legend[540][0] != '\0') 
				     {
				     l_main_hdr = 0;
				     fprintf(fp,"%-s\n",loc_legend[540]);
				     v_lno++;
				     if (v_lno > max_lines) print_next_page1();
				     }*/  //commented as per the instruction frm Kuila sir
				 }
				 else
				 {
					fprintf(fp,"\n");
					v_lno++;
				 }
				 
				 /*fprintf(fp,"%-s\n",loc_legend[550]);
				 v_lno++;*/
				
				                           
			/*	while(v_lno <= max_lines)
				{
					fprintf(fp,"\n");
					v_lno++;
				}
                             
				fprintf(fp,"\n\n");	
				v_lno=v_lno+2;
				*/					
		}
	}
			
/********************************************************/



remarks_cnt_chk()
{
      l_lno = 0;      
				    
      // fprintf(fp,"\n"); 
      l_lno++;			    

      if (l_logo_yniflaser.arr[0] != 'Y')			    
      {				      
	l_lno++;				    
      }

      if (loc_legend[390][0]	!= '\0')
      {					
	l_lno = l_lno + 2;
      }				    				      
      if (loc_legend[400][0] != '\0')	
      {      
	l_lno++;      
      }

      if (loc_legend[410][0] != '\0') 
      {				      
	l_lno++;      
      }

      if (loc_legend[420][0] != '\0') 
      {      
	l_lno++;      
      }

      if (loc_legend[430][0] != '\0') 
      {      
	l_lno++;      
      }

      if (loc_legend[440][0] != '\0') 
      {				      
	l_lno++;      
      }

      if (loc_legend[450][0] != '\0') 
      {				      
	l_lno++;      
      }

      if (loc_legend[460][0] != '\0') 
      {      
	l_lno++;       
      }

      if (loc_legend[470][0] != '\0') 
      {	
	l_lno++;      
      }

      if (loc_legend[480][0] != '\0') 
      {				      
	l_lno++;				      
      }			     

     if (loc_legend[490][0] != '\0') 
     {				     
	l_lno++;				     
     }

     if (loc_legend[500][0] != '\0') 
     {				     
	l_lno++;				     
     }

     if (loc_legend[510][0] != '\0') 
     {				     
	l_lno++;				     
     }

     if (loc_legend[520][0] != '\0') 
     {     
	l_lno++;     
     }

     if (loc_legend[530][0] != '\0') 
     {     
	l_lno++;     
     }

     if (loc_legend[540][0] != '\0') 
     {     
	l_lno++;     
     }                  
          
    //fprintf(fp,"%-s\n",loc_legend[550]); 
    
    l_lno++;   
    
    if ( (l_lno+v_lno) > max_lines) 
    {       
       print_next_page1();
    }		
}


last_line_prt()
{	
	fprintf(fp,"\n");
	last_line_check = 0;
	rec_out = 'Y';
}

fetch_legend_value()
{
	loc_legend1.arr[0]		= '\0';
	loc_legend2.arr[0]		= '\0';
	loc_legend3.arr[0]		= '\0';
	loc_legend4.arr[0]		= '\0';
	loc_legend5.arr[0]		= '\0';
	loc_legend6.arr[0]		= '\0';
	loc_legend7.arr[0]		= '\0';
	loc_legend8.arr[0]		= '\0';
	loc_legend9.arr[0]		= '\0';
	loc_legend10.arr[0]		= '\0';
	loc_legend11.arr[0]		= '\0';
	loc_legend12.arr[0]		= '\0';
	loc_legend13.arr[0]		= '\0';
	loc_legend14.arr[0]		= '\0';
	loc_legend15.arr[0]		= '\0';
	loc_legend16.arr[0]		= '\0';
	loc_legend17.arr[0]		= '\0';
	loc_legend18.arr[0]		= '\0';
	loc_legend19.arr[0]		= '\0';
	loc_legend20.arr[0]		= '\0';
	loc_legend21.arr[0]		= '\0';
	loc_legend22.arr[0]		= '\0';
	loc_legend23.arr[0]		= '\0';
	loc_legend24.arr[0]		= '\0';
	loc_legend25.arr[0]		= '\0';
	loc_legend26.arr[0]		= '\0';
	loc_legend27.arr[0]		= '\0';
	loc_legend28.arr[0]		= '\0';
	loc_legend29.arr[0]		= '\0';
	loc_legend30.arr[0]		= '\0';
	loc_legend31.arr[0]		= '\0';
	loc_legend32.arr[0]		= '\0';
	loc_legend33.arr[0]		= '\0';
	loc_legend34.arr[0]		= '\0';
	loc_legend35.arr[0]		= '\0';
	loc_legend36.arr[0]		= '\0';
	loc_legend37.arr[0]		= '\0';
	loc_legend38.arr[0]		= '\0';
	loc_legend39.arr[0]		= '\0';
	loc_legend40.arr[0]		= '\0';
	loc_legend41.arr[0]		= '\0';
	loc_legend42.arr[0]		= '\0';
	loc_legend43.arr[0]		= '\0';
	loc_legend44.arr[0]		= '\0';
	loc_legend45.arr[0]		= '\0';
	loc_legend46.arr[0]		= '\0';
	loc_legend47.arr[0]		= '\0';
	loc_legend48.arr[0]		= '\0';
	loc_legend49.arr[0]		= '\0';
	loc_legend50.arr[0]		= '\0';
	loc_legend51.arr[0]		= '\0';
	loc_legend52.arr[0]		= '\0';
	loc_legend53.arr[0]		= '\0';
	loc_legend54.arr[0]		= '\0';
	loc_legend55.arr[0]		= '\0';
	loc_legend56.arr[0]		= '\0';
	loc_legend57.arr[0]		= '\0';
	loc_legend58.arr[0]		= '\0';
	loc_legend59.arr[0]		= '\0';
	loc_legend60.arr[0]		= '\0';
	loc_legend61.arr[0]		= '\0';
	loc_legend62.arr[0]		= '\0';
	loc_legend63.arr[0]		= '\0';
		loc_legend68.arr[0]		= '\0';
		loc_legend69.arr[0]		= '\0';
		loc_legend70.arr[0]		= '\0';
		loc_legend71.arr[0]		= '\0';
		loc_legend72.arr[0]		= '\0';
		loc_legend73.arr[0]		= '\0';
		loc_legend74.arr[0]		= '\0';
		loc_legend75.arr[0]		= '\0';
		loc_legend76.arr[0]		= '\0';
		loc_legend[770][0]		= '\0';
		loc_legend78.arr[0]		= '\0';
		loc_legend79.arr[0]		= '\0';
		loc_legend80.arr[0]		= '\0';
		loc_legend81.arr[0]		= '\0';
		loc_legend82.arr[0]		= '\0';
		loc_legend83.arr[0]		= '\0';
		loc_legend84.arr[0]		= '\0';
		loc_legend85.arr[0]		= '\0';




	loc_legend1.len			= 0;
	loc_legend2.len			= 0;
	loc_legend3.len			= 0;
	loc_legend4.len			= 0;
	loc_legend5.len			= 0;
	loc_legend6.len			= 0;
	loc_legend7.len			= 0;
	loc_legend8.len			= 0;
	loc_legend9.len			= 0;
	loc_legend10.len		= 0;
	loc_legend11.len		= 0;
	loc_legend12.len		= 0;
	loc_legend13.len		= 0;
	loc_legend14.len		= 0;
	loc_legend15.len		= 0;
	loc_legend16.len		= 0;
	loc_legend17.len		= 0;
	loc_legend18.len		= 0;
	loc_legend19.len		= 0;
	loc_legend20.len		= 0;
	loc_legend21.len		= 0;
	loc_legend22.len		= 0;
	loc_legend23.len		= 0;
	loc_legend24.len		= 0;
	loc_legend25.len		= 0;
	loc_legend26.len		= 0;
	loc_legend27.len		= 0;
	loc_legend28.len		= 0;
	loc_legend29.len		= 0;
	loc_legend30.len		= 0;
	loc_legend31.len		= 0;
	loc_legend32.len		= 0;
	loc_legend33.len		= 0;
	loc_legend34.len		= 0;
	loc_legend35.len		= 0;
	loc_legend36.len		= 0;
	loc_legend37.len		= 0;
	loc_legend38.len		= 0;
	loc_legend39.len		= 0;
	loc_legend40.len		= 0;
	loc_legend41.len		= 0;
	loc_legend42.len		= 0;
	loc_legend43.len		= 0;
	loc_legend44.len		= 0;
	loc_legend45.len		= 0;
	loc_legend46.len		= 0;
	loc_legend47.len		= 0;
	loc_legend48.len		= 0;
	loc_legend49.len		= 0;
	loc_legend50.len		= 0;
	loc_legend51.len		= 0;
	loc_legend52.len		= 0;
	loc_legend53.len		= 0;
	loc_legend54.len		= 0;
	loc_legend55.len		= 0;
	loc_legend56.len		= 0;
	loc_legend57.len		= 0;
	loc_legend58.len		= 0;
	loc_legend59.len		= 0;
	loc_legend60.len		= 0;
	loc_legend61.len		= 0;
	loc_legend62.len		= 0;
	loc_legend63.len		= 0;
	loc_legend68.len		= 0;
	loc_legend69.len		= 0;
	loc_legend70.len		= 0;
	loc_legend71.len		= 0;
	loc_legend72.len		= 0;
	loc_legend73.len		= 0;
	loc_legend74.len		= 0;
	loc_legend75.len		= 0;
	loc_legend76.len		= 0;
	loc_legend77.len		= 0;
	loc_legend78.len		= 0;
	loc_legend79.len		= 0;
	loc_legend80.len		= 0;
	loc_legend81.len		= 0;
	loc_legend82.len		= 0;
	loc_legend83.len		= 0;
	loc_legend84.len		= 0;
	loc_legend85.len		= 0;



	EXEC SQL	select	rtrim(substr(COLUMN_VALUE,1,50))
				  into	:loc_legend1
				  from	SM_RECORD_TRANS_DATA a,
						sm_lang_legend b
				 where	MODULE_ID   = 'SM' 
				   and	TABLE_ID    = 'SM_LANG_LEGEND'
				   and  COLUMN_ID   = 'DFLT_LEGEND_VALUE'
				   and  PK_VALUE    = LEGEND_ID
				   and  LEGEND_ID   = 'BILL_01.LEGEND_010' 
				   and  LANGUAGE_ID = :nd_lang_id;

	if(sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value 
		           into :loc_legend1
			  	   from sm_lang_legend
				  where LEGEND_ID = 'BILL_01.LEGEND_010';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 1",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
			 into  :loc_legend2
			 from  SM_RECORD_TRANS_DATA a,sm_lang_legend b
			 where MODULE_ID = 'SM' 
			 and   TABLE_ID = 'SM_LANG_LEGEND'
			 and   COLUMN_ID = 'DFLT_LEGEND_VALUE'
			 and   PK_VALUE = LEGEND_ID
			 and   LEGEND_ID = 'BILL_01.LEGEND_020' 
			 and   LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend2
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_020';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 2",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend3
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_030' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend3
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_030';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 3",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend4
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_040' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend4
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_040';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 4",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend5
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_050' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend5
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_050';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 5",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend6
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_060' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend6
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_060';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 6",0,"");
	}


	EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/ rtrim(COLUMN_VALUE)
				into :loc_legend7
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_070' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend7
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_070';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 7",0,"");
	}


	EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/ rtrim(COLUMN_VALUE)
				into :loc_legend8
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_080' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend8
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_080';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 8",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend9
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_090' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend9
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_090';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 9",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend10
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_100' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend10
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_100';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 10",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend11
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_110' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend11
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_110';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 11",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend12
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_120' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend12
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_120';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 12",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend13
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_130' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend13
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_130';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 13",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend14
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_140' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend14
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_140';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 14",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend15
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_150' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend15
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_150';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 15",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend16
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_160' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend16
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_160';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 16",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend17
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_170' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend17
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_170';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 17",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend18
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_180' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend18
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_180';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 18",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend19
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_190' 
				and LANGUAGE_ID = :nd_lang_id;

if (sqlca.sqlcode == 1403)
{
	EXEC SQL select dflt_legend_value into :loc_legend19
				from sm_lang_legend
				where LEGEND_ID = 'BILL_01.LEGEND_190';
}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 19",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend20
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_200' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend20
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_200';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 20",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend21
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_210' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend21
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_210';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 21",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend22
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_220' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend22
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_220';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 22",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend23
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_230' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend23
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_230';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 23",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend24
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_240' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend24
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_240';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 24",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend25
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_250' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend25
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_250';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 25",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend26
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_260' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend26
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_260';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 26",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend27
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_270' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend27
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_270';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 27",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend28
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_280' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend28
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_280';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 28",0,"");
	}


	EXEC SQL select /*rtrim(substr(COLUMN_VALUE,1,50))*/ rtrim(COLUMN_VALUE)
				into :loc_legend29
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_290' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend29
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_290';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 29",0,"");
	}

     if (l_lsr != 0 && l_dmp == 0)
      {
	EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	   
				into :loc_legend30
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_300' 
				and LANGUAGE_ID = :nd_lang_id;
     }
     else
     {

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend30
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_300' 
				and LANGUAGE_ID = :nd_lang_id;
      }      

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend30
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_300';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 30",0,"");
	}


	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend31
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_310' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend31
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_310';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 31",0,"");
	}

	if (l_lsr != 0 && l_dmp == 0)
       {
		EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	   
				into :loc_legend32
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_320' 
				and LANGUAGE_ID = :nd_lang_id;
	}
	else
	{
		EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend32
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_320' 
				and LANGUAGE_ID = :nd_lang_id;
	}

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend32
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_320';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 32",0,"");
	}

	if (l_lsr != 0 && l_dmp == 0)
	{
		EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	   
				into :loc_legend33
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_330' 
				and LANGUAGE_ID = :nd_lang_id;
	}
	else
	{
		EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend33
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_330' 
				and LANGUAGE_ID = :nd_lang_id;

	}

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend33
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_330';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 33",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend34
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_340' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend34
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_340';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 34",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend35
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and	TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_350' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend35
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_350';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 35",0,"");
	}

	EXEC SQL select rtrim(substr(COLUMN_VALUE,1,50))
				into :loc_legend36
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_360' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend36
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_360';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 36",0,"");
	}



	EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	
				into :loc_legend37
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_370' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(dflt_legend_value,1,50))))/2),' ')||UPPER(rtrim(substr(dflt_legend_value,1,50)))				
				        into :loc_legend37
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_370';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 37",0,"");
	}


	EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(COLUMN_VALUE,1,50))))/2),' ')||UPPER(rtrim(substr(COLUMN_VALUE,1,50)))	
				into :loc_legend38
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_380' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select lpad(' ',round((:l_margin_len-length(rtrim(substr(dflt_legend_value,1,50))))/2),' ')||UPPER(rtrim(substr(dflt_legend_value,1,50)))				
					into :loc_legend38
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_380';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 38",0,"");
	}

	/*------------------------22/09/2005-----------------------*/

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend39
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_390' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend39
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_390';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 39",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend40
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_400' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend40
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_400';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 40",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend41
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_410' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend41
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_410';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 41",0,"");
	}



 EXEC SQL select  COLUMN_VALUE 
				into :loc_legend42
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_420' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend42
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_420';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 42",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend43
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_430' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend43
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_430';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 43",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend44
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_440' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend44
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_440';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 44",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend45
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_450' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend45
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_450';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 45",0,"");
	}


	
	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend46
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_460' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend46
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_460';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 46",0,"");
	}






	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend47
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_470' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend47
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_470';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 47",0,"");
	}




	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend48
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_480' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend48
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_480';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 48",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend49
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_490' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend49
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_490';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 49",0,"");
	}





	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend50
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_500' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend50
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_500';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 50",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend51
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_510' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend51
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_510';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 51",0,"");
	}




	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend52
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_520' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend52
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_520';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 52",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend53
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_530' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend53
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_530';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 53",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend54
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_540' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend54
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_540';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 54",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend55
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_550' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend55
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_550';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 55",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend56
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_560' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend56
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_560';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 56",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend57
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_570' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend57
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_570';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 57",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend58
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_580' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend58
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_580';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 58",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend59
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_590' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend59
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_590';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 59",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend60
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_600' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend60
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_600';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 60",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend61
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_610' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend61
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_610';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 61",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend62
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_620' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend62
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_620';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 62",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend63
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_630' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend63
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_630';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 63",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend68
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_680' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend68
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_680';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 68",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend69
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_690' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend69
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_690';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 69",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend70
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_700' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend70
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_700';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 70",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend71
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_710' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend71
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_710';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 71",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend72
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_720' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend72
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_720';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 72",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend73
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_730' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend73
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_730';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 73",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend74
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_740' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend74
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_740';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 74",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend75
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_750' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend75
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_750';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 75",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend76
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_760' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend76
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_760';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 76",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend77
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_770' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend77
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_770';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 77",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend78
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_780' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend78
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_780';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 78",0,"");
	}

	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend79
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_790' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend79
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_790';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 79",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend80
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_800' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend80
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_800';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 80",0,"");
	}


	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend81
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_810' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend81
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_810';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 81",0,"");
	}



	EXEC SQL select  COLUMN_VALUE 
				into :loc_legend82
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_820' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend82
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_820';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 82",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend83
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_830' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend83
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_830';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 83",0,"");
	}


EXEC SQL select  COLUMN_VALUE 
				into :loc_legend84
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_840' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend84
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_840';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 84",0,"");
	}

EXEC SQL select  COLUMN_VALUE 
				into :loc_legend85
				from SM_RECORD_TRANS_DATA a,sm_lang_legend b
				where MODULE_ID = 'SM' 
				and TABLE_ID = 'SM_LANG_LEGEND'
				and COLUMN_ID = 'DFLT_LEGEND_VALUE'
				and PK_VALUE = LEGEND_ID
				and LEGEND_ID = 'BILL_01.LEGEND_850' 
				and LANGUAGE_ID = :nd_lang_id;

	if (sqlca.sqlcode == 1403)
	{
		EXEC SQL select dflt_legend_value into :loc_legend85
					from sm_lang_legend
					where LEGEND_ID = 'BILL_01.LEGEND_850';
	}

	if (sqlca.sqlcode < 0)
	{   
		err_mesg("SELECT failed on LEGEND 85",0,"");
	}


	loc_legend1.arr[loc_legend1.len]		= '\0';
	loc_legend2.arr[loc_legend2.len]		= '\0';
	loc_legend3.arr[loc_legend3.len]		= '\0';
	loc_legend4.arr[loc_legend4.len]		= '\0';
	loc_legend5.arr[loc_legend5.len]		= '\0';
	loc_legend6.arr[loc_legend6.len]		= '\0';
	loc_legend7.arr[loc_legend7.len]		= '\0';
	loc_legend8.arr[loc_legend8.len]		= '\0';
	loc_legend9.arr[loc_legend9.len]		= '\0';
	loc_legend10.arr[loc_legend10.len]		= '\0';
	loc_legend11.arr[loc_legend11.len]		= '\0';
	loc_legend12.arr[loc_legend12.len]		= '\0';
	loc_legend13.arr[loc_legend13.len]		= '\0';
	loc_legend14.arr[loc_legend14.len]		= '\0';
	loc_legend15.arr[loc_legend15.len]		= '\0';
	loc_legend16.arr[loc_legend16.len]		= '\0';
	loc_legend17.arr[loc_legend17.len]		= '\0';
	loc_legend18.arr[loc_legend18.len]		= '\0';
	loc_legend19.arr[loc_legend19.len]		= '\0';
	loc_legend20.arr[loc_legend20.len]		= '\0';
	loc_legend21.arr[loc_legend21.len]		= '\0';
	loc_legend22.arr[loc_legend22.len]		= '\0';
	loc_legend23.arr[loc_legend23.len]		= '\0';
	loc_legend24.arr[loc_legend24.len]		= '\0';
	loc_legend25.arr[loc_legend25.len]		= '\0';
	loc_legend26.arr[loc_legend26.len]		= '\0';
	loc_legend27.arr[loc_legend27.len]		= '\0';
	loc_legend28.arr[loc_legend28.len]		= '\0';
	loc_legend29.arr[loc_legend29.len]		= '\0';
	loc_legend30.arr[loc_legend30.len]		= '\0';
	loc_legend31.arr[loc_legend31.len]		= '\0';
	loc_legend32.arr[loc_legend32.len]		= '\0';
	loc_legend33.arr[loc_legend33.len]		= '\0';
	loc_legend34.arr[loc_legend34.len]		= '\0';
	loc_legend35.arr[loc_legend35.len]		= '\0';
	loc_legend36.arr[loc_legend36.len]		= '\0';
	loc_legend37.arr[loc_legend37.len]		= '\0';
	loc_legend38.arr[loc_legend38.len]		= '\0';
	loc_legend39.arr[loc_legend39.len]		= '\0';
	loc_legend40.arr[loc_legend40.len]		= '\0';
	loc_legend41.arr[loc_legend41.len]		= '\0';
	loc_legend42.arr[loc_legend42.len]		= '\0';
	loc_legend43.arr[loc_legend43.len]		= '\0';
	loc_legend44.arr[loc_legend44.len]		= '\0';
	loc_legend45.arr[loc_legend45.len]		= '\0';
	loc_legend46.arr[loc_legend46.len]		= '\0';
	loc_legend47.arr[loc_legend47.len]		= '\0';
	loc_legend48.arr[loc_legend48.len]		= '\0';
	loc_legend49.arr[loc_legend49.len]		= '\0';
	loc_legend50.arr[loc_legend50.len]		= '\0';
	loc_legend51.arr[loc_legend51.len]		= '\0';
	loc_legend52.arr[loc_legend52.len]		= '\0';
	loc_legend53.arr[loc_legend53.len]		= '\0';
	loc_legend54.arr[loc_legend54.len]		= '\0';
	loc_legend55.arr[loc_legend55.len]		= '\0';
	loc_legend56.arr[loc_legend56.len]		= '\0';
	loc_legend57.arr[loc_legend57.len]		= '\0';
	loc_legend58.arr[loc_legend58.len]		= '\0';
	loc_legend59.arr[loc_legend59.len]		= '\0';	
	loc_legend60.arr[loc_legend60.len]		= '\0';	
	loc_legend61.arr[loc_legend61.len]		= '\0';	
	loc_legend62.arr[loc_legend62.len]		= '\0';	
	loc_legend63.arr[loc_legend63.len]		= '\0';	
	loc_legend68.arr[loc_legend68.len]		= '\0';	
	loc_legend69.arr[loc_legend69.len]		= '\0';	
	loc_legend70.arr[loc_legend70.len]		= '\0';	
	loc_legend71.arr[loc_legend71.len]		= '\0';	
	loc_legend72.arr[loc_legend72.len]		= '\0';	
	loc_legend73.arr[loc_legend73.len]		= '\0';	
	loc_legend74.arr[loc_legend74.len]		= '\0';	
	loc_legend75.arr[loc_legend75.len]		= '\0';	
	loc_legend76.arr[loc_legend76.len]		= '\0';	
	loc_legend77.arr[loc_legend77.len]		= '\0';	
	loc_legend78.arr[loc_legend78.len]		= '\0';	
	loc_legend79.arr[loc_legend79.len]		= '\0';	
	loc_legend80.arr[loc_legend80.len]		= '\0';
	loc_legend81.arr[loc_legend81.len]		= '\0';
	loc_legend82.arr[loc_legend82.len]		= '\0';
	loc_legend83.arr[loc_legend83.len]		= '\0';	
	loc_legend84.arr[loc_legend84.len]		= '\0';
	loc_legend85.arr[loc_legend85.len]		= '\0';				

}
print_formated_qty(loc_qty)
int loc_qty;
{
  char str_qty[30];

  sprintf(str_qty,"%d",loc_qty); 
  ltrim (str_qty);
  rtrim (str_qty);
  fprintf(fp,"%3.3s",str_qty);
}

print_formated_amt(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",str_amt);		
        fprintf(fp,"%15s CR",str_amt);
        }
    else 
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%15s",s_amt);
        fprintf(fp,"%15s ",str_amt);
     }

}  
//This for printing Additional Charge Amt for payer Bill                      
print_formated_amt1(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%9.9s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",str_amt);		
        fprintf(fp,"%9.9sCR",str_amt);
        }
    else 
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%9.9s",s_amt);
        fprintf(fp,"%9.9s  ",str_amt);
     }

} 
//This for printing Additional Charge Amt for Patient Bill 
print_formated_amt2(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

   	if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%11.11s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",str_amt);		
        fprintf(fp," %11.11sCR",str_amt);
        }
    else 
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%11.11s",s_amt);
        fprintf(fp," %11.11s  ",str_amt);
     }

}                                         
print_formated(loc_amount)
double loc_amount;
{
    char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);
		sprintf(str_amt,"%sCR",str_amt);
		return str_amt;
 
        }
    else 
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%sDR",s_amt);
	return str_amt;
     }
}                        

print_next_page1()
{
	int i;
	
	while(v_lno <= max_lines)
	{
		fprintf(fp,"\n");
		v_lno++;
	}	

	if (l_lsr != 0 && l_dmp == 0)
	{	 
		fprintf(fp,"\n\n");
	}
	else
	{
		fprintf(fp,"\n\n\n\n");
	}
	
	if ((l_lsr != 0 && l_dmp == 0))
	{
	if ( l_logo_yniflaser.arr[0] != 'Y')
	if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0) //IN13383	
    print_footer1();
	}  //IN13383

	
	if ( l_logo_yniflaser.arr[0] != 'Y')
	{

	fprintf(fp,""); /* To Eject Page */
	}
	

        fprintf(fp,"\n");

	if (l_lsr != 0 && l_dmp == 0 )
	{
		if ( l_logo_yniflaser.arr[0] == 'Y')
		{
			fprintf(fp,"\n\n");
		}
	}
	v_lno=0;

	print_report_head();

	if(l_next_page==2)
	get_payer_bill_header();
	if(l_next_page==3)
	{
	get_legend_value();
	if( lcol_cnt == 1)
	prt_line_uc();
	if(lcol_cnt == 2)
	prt_line_uc_wide();
    if(lcol_cnt == 3)
	prt_line_uc_wide1();
	if(lcol_cnt == 6 || lcol_cnt == 5)
	prt_line_uc_wide2();
	fprintf(fp,"\n");
  	}
    

}



ltrim(l_str)
char *l_str;
{
   char *ptr;
   ptr = l_str;
   while (*ptr== ' ') ptr++;
   for(;*ptr!='\0';ptr++,l_str++)
    *l_str = *ptr;
   *l_str = '\0';
}

rtrim(l_str)
char *l_str;
{
  while (*l_str != '\0') *l_str++;
  l_str--;
  while (*l_str == ' ') *l_str--;
  *(l_str+1) = '\0';
}

get_left_margin()
{

	if (l_lsr != 0 && l_dmp == 0)
	  {
		if (l_logo_yniflaser.arr[0] == 'Y')			    
			l_margin_len = 94;				
		else
			l_margin_len = 60;

	  }
}


get_bill_address()
{
	l_bill_contact_name.arr[0] = '\0';
	l_bill_contact_name.len = 0;

	l_bill_contact_name_title.arr[0] = '\0';
	l_bill_contact_name_title.len = 0;

	l_bill_long_desc.arr[0] = '\0';
	l_bill_long_desc.len = 0;

	l_bill_add1_desc.arr[0] = '\0';
	l_bill_add1_desc.len = 0;

	l_bill_add2_desc.arr[0] = '\0';
	l_bill_add2_desc.len = 0;

	l_bill_add3_desc.arr[0] = '\0';
	l_bill_add3_desc.len = 0;
	
	if(strcmp(d_bill_nature_code.arr,"A")==0)
	{
		EXEC SQL SELECT substr(contact_name,1,19),
						substr(contact_name_title,1,20),
						substr(long_name,1,40),
						substr(add1_desc,1,40),
						substr(add2_desc,1,40),
						substr(add3_desc,1,40)						
				   INTO :l_bill_contact_name,
						:l_bill_contact_name_title,
						:l_bill_long_desc,
						:l_bill_add1_desc,
						:l_bill_add2_desc,
						:l_bill_add3_desc
				   FROM ar_customer_lang_vw
				  WHERE cust_code    = :d_cust_code
				  AND   language_id  = :nd_lang_id;  

			   if (OERROR)
					err_mesg("SELECT failed on table AR_CUSTOMER_LANG_VW",0,"");

	}
	else if(strcmp(d_bill_nature_code.arr,"C")==0)
	{
		EXEC SQL SELECT substr(mail_contact_name,1,19),
						substr(mail_postal_code,1,20),
						substr(ln1_mail_add,1,40),
						substr(ln2_mail_add,1,40),
						substr(ln3_mail_add,1,40),
						substr(mail_country_code,1,40)						
				   INTO :l_bill_contact_name,
						:l_bill_contact_name_title,
						:l_bill_long_desc,
						:l_bill_add1_desc,
						:l_bill_add2_desc,
						:l_bill_add3_desc
				   FROM mp_pat_other_dtls
				  WHERE patient_id = :d_patient_id;

			   if (OERROR)
					err_mesg("SELECT failed on table MP_PAT_OTHER_DTLS",0,"");
	}

	l_bill_contact_name.arr[l_bill_contact_name.len] = '\0';
	l_bill_contact_name_title.arr[l_bill_contact_name_title.len] = '\0';
	l_bill_long_desc.arr[l_bill_long_desc.len] = '\0';
	l_bill_add1_desc.arr[l_bill_add1_desc.len] = '\0';
	l_bill_add2_desc.arr[l_bill_add2_desc.len] = '\0';
	l_bill_add3_desc.arr[l_bill_add3_desc.len] = '\0';

	if(l_bill_add3_desc.len > 0)
	{
		l_bill_add3_desc_temp.arr[0] = '\0';
		l_bill_add3_desc_temp.len = 0;		

		EXEC SQL SELECT long_name
				   INTO :l_bill_add3_desc_temp
				   FROM mp_country_LANG_VW
				  WHERE country_code = :l_bill_add3_desc
				  AND LANGUAGE_ID = :nd_lang_id;

		l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

		if((strcmp(l_bill_add3_desc_temp.arr,l_bill_add3_desc.arr)!=0) && (l_bill_add3_desc_temp.len > 0))
		{
			strcpy(l_bill_add3_desc.arr,l_bill_add3_desc_temp.arr);
			l_bill_add3_desc.len = strlen(l_bill_add3_desc.arr);
		}
	}
}


get_print_group_hd_desc3()
{
nd_prt_hd_desc.arr[0] = '\0';
nd_prt_hd_desc.len=0;

EXEC SQL  Select SHORT_DESC into :nd_prt_hd_desc 
          From BL_BLNG_PRT_GRP_HDR_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:d_prt_grp_hdr_code
		  AND  LANGUAGE_ID = :nd_lang_id;


nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");



}


get_print_group_line_desc3()
{
nd_prt_line_desc.arr[0] = '\0';
nd_prt_line_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_line_desc 
          From BL_BLNG_PRT_GRP_LINE_lang_vw
		  Where  PRT_GRP_HDR_CODE=:d_prt_grp_hdr_code
		  and PRT_GRP_LINE_CODE=:d_prt_grp_line_code
		  AND LANGUAGE_ID = :nd_lang_id;

nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

 if (OERROR)
	 err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");


}

get_print_group_hd_desc2()
{
nd_prt_hd_desc.arr[0] = '\0';
nd_prt_hd_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_hd_desc 
          From BL_BLNG_PRT_GRP_HDR_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:nd_prt_grp_hdr_code
		  AND LANGUAGE_ID =: nd_lang_id;



nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");


 //strcpy(nd_ref_prt_grp_hdr_code.arr,nd_prt_grp_hdr_code.arr);
 strcpy(nd_ref_prt_grp_line_code.arr,nd_prt_grp_line_code.arr);


}

get_print_group_line_desc2()
{
nd_prt_line_desc.arr[0] = '\0';
nd_prt_line_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_line_desc 
          From   BL_BLNG_PRT_GRP_LINE_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:nd_prt_grp_hdr_code
		  and    PRT_GRP_LINE_CODE=:nd_prt_grp_line_code
		  AND    LANGUAGE_ID =: nd_lang_id;


nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");


}

get_print_group_hd_desc()
{
nd_prt_hd_desc.arr[0] = '\0';
nd_prt_hd_desc.len=0;


EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_hd_desc 
          From BL_BLNG_PRT_GRP_HDR_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:d1_prt_grp_hdr_code
		  AND LANGUAGE_ID = :nd_lang_id;
		
nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';


 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");


}

get_print_group_hd_desc1()
{
nd_prt_hd_desc.arr[0] = '\0';
nd_prt_hd_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_hd_desc 
          From BL_BLNG_PRT_GRP_HDR_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:nd1_prt_grp_hdr_code
		  AND LANGUAGE_ID = :nd_lang_id;


nd_prt_hd_desc.arr[nd_prt_hd_desc.len] = '\0';

 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_HDR",0,"");

}

get_print_group_line_desc()
{
nd_prt_line_desc.arr[0] = '\0';
nd_prt_line_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_line_desc 
          From BL_BLNG_PRT_GRP_LINE_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:d1_prt_grp_hdr_code
		  and PRT_GRP_LINE_CODE=:d1_prt_grp_line_code
		  AND LANGUAGE_ID = :nd_lang_id;

nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

 if (OERROR)
	err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");


}


get_print_group_line_desc1()
{
nd_prt_line_desc.arr[0] = '\0';
nd_prt_line_desc.len=0;

EXEC SQL  Select substr(SHORT_DESC,1,20) into :nd_prt_line_desc 
          From BL_BLNG_PRT_GRP_LINE_LANG_VW
		  Where  PRT_GRP_HDR_CODE=:nd1_prt_grp_hdr_code
		  and PRT_GRP_LINE_CODE=:nd1_prt_grp_line_code
		  AND LANGUAGE_ID = :nd_lang_id;

nd_prt_line_desc.arr[nd_prt_line_desc.len] = '\0';

 if (OERROR)
	 err_mesg("SELECT failed on table BL_BLNG_PRT_GRP_LINE",0,"");


}


get_blng_serv_desc()
{
nd_blng_desc.arr[0] = '\0';
nd_blng_desc.len=0;
nd_mapping_code_desc.arr[0] = '\0';
nd_mapping_code_desc.len =0;

if (d_summary_dtl_ind.arr[2] == 'A') 
 {
  
  EXEC SQL  SELECT b.MAPPING_CODE,substr(a.LONG_DESC,1,80)
			  INTO :d_mapping_code,nd_mapping_code_desc	
			  FROM BL_SERV_MAPPING_CODE a, BL_ITEMS_FOR_MAPPING_CODE b
			  WHERE a.OPERATING_FACILITY_ID= b.OPERATING_FACILITY_Id
			  AND a.MAPPING_CODE_IND       = b.MAPPING_CODE_IND
			  AND a.MAPPING_CODE           = b.MAPPING_CODE
			  AND a.MAPPING_CODE_IND	   = :d_mapping_code_ind
    		  AND b.ITEM_CODE=DECODE(:d_mapping_code_ind,'S',:d_blng_serv_code,:d_serv_item_code);

		
		if (OERROR)
	    err_mesg("SELECT failed on table BL_MAPPING_CODE",0,"");
		
		if(NODATAFOUND)
		{
		 strcpy(d1_mapping_code.arr," ");
			EXEC SQL  Select substr(SHORT_DESC,1,80) into :nd_mapping_code_desc 
					  From BL_BLNG_SERV_LANG_VW
					  Where  blng_serv_code=:d_blng_serv_code
					  AND LANGUAGE_ID = :nd_lang_id;

		 
		}
	    d_mapping_code.arr[d_mapping_code.len]			   = '\0';
		nd_mapping_code_desc.arr[nd_mapping_code_desc.len] = '\0';
  
 }
else
 {
   if(strcmp(d_serv_item_desc.arr,"X")==0)
   {
		EXEC SQL  Select substr(SHORT_DESC,1,30) into :nd_blng_desc 
				  From BL_BLNG_SERV_LANG_VW
				  Where  blng_serv_code=:d_blng_serv_code
				  AND LANGUAGE_ID = :nd_lang_id;
       
	   nd_blng_desc.arr[nd_blng_desc.len] = '\0';

	   
   }
   else
   {
     strcpy(nd_blng_desc.arr,d_serv_item_desc.arr);
   }
	

	 if (OERROR)
		 err_mesg("SELECT failed on table BL_BLNG_SERV",0,"");
	}

}

get_blng_serv_desc1()
{
nd_blng_desc1.arr[0] = '\0';
nd_blng_desc1.len=0;
nd1_mapping_code_desc.arr[0] = '\0';         
nd1_mapping_code_desc.len =0;

if (d1_summary_dtl_ind.arr[2] == 'A') 
{
  
  EXEC SQL  SELECT b.MAPPING_CODE,substr(a.LONG_DESC,1,30)
			  INTO :d1_mapping_code,nd1_mapping_code_desc	
			  FROM BL_SERV_MAPPING_CODE a, BL_ITEMS_FOR_MAPPING_CODE b
			  WHERE a.OPERATING_FACILITY_ID= b.OPERATING_FACILITY_Id
			  AND a.MAPPING_CODE_IND       = b.MAPPING_CODE_IND
			  AND a.MAPPING_CODE           = b.MAPPING_CODE
			  AND a.MAPPING_CODE_IND	   = :d1_mapping_code_ind
    		  AND b.ITEM_CODE=DECODE(:d1_mapping_code_ind,'S',:d1_blng_serv_code,:d1_serv_item_code);

		
		if (OERROR)
	    err_mesg("SELECT failed on table BL_MAPPING_CODE",0,"");
		
		if(NODATAFOUND)
		{
		 strcpy(d1_mapping_code.arr," ");

		 EXEC SQL  SELECT substr(SHORT_DESC,1,30) into :nd1_mapping_code_desc 
			  FROM   BL_BLNG_SERV_LANG_VW
			  WHERE  blng_serv_code   =:d1_blng_serv_code
			  AND    LANGUAGE_ID      =:nd_lang_id;
		 
		}
	    d1_mapping_code.arr[d1_mapping_code.len]			 = '\0';
		nd1_mapping_code_desc.arr[nd1_mapping_code_desc.len] = '\0';
  
}
else
{
  if(strcmp(d1_serv_item_desc.arr,"X")==0)
   {
		EXEC SQL  Select substr(SHORT_DESC,1,30) into :nd_blng_desc1 
				  From BL_BLNG_SERV_LANG_VW
				  Where  blng_serv_code=:d1_blng_serv_code
				  AND LANGUAGE_ID = :nd_lang_id;

	    nd_blng_desc1.arr[nd_blng_desc1.len] = '\0';
	
   }
   else
   {
     strcpy(nd_blng_desc1.arr,d1_serv_item_desc.arr);
   }
	

	 if (OERROR)
		err_mesg("SELECT failed on table BL_BLNG_SERV",0,"");
}

}

get_bill_address_lsr()
{   
        int cnt1 = 0;

	l_bill_contact_name_p.arr[0] = '\0';
	l_bill_contact_name_p.len = 0;

	l_bill_contact_name_title_p.arr[0] = '\0';
	l_bill_contact_name_title_p.len = 0;

	l_bill_long_desc_p.arr[0] = '\0';
	l_bill_long_desc_p.len = 0;

	l_bill_add1_desc_p.arr[0] = '\0';
	l_bill_add1_desc_p.len = 0;

	l_bill_add2_desc_p.arr[0] = '\0';
	l_bill_add2_desc_p.len = 0;

	l_bill_add3_desc_p.arr[0] = '\0';
	l_bill_add3_desc_p.len = 0;


	l_bill_contact_name_c.arr[0] = '\0';
	l_bill_contact_name_c.len = 0;

	l_bill_contact_name_title_c.arr[0] = '\0';
	l_bill_contact_name_title_c.len = 0;

	l_bill_long_desc_c.arr[0] = '\0';
	l_bill_long_desc_c.len = 0;

	l_bill_add1_desc_c.arr[0] = '\0';
	l_bill_add1_desc_c.len = 0;

	l_bill_add2_desc_c.arr[0] = '\0';
	l_bill_add2_desc_c.len = 0;

	l_bill_add3_desc_c.arr[0] = '\0';
	l_bill_add3_desc_c.len = 0;


	l_line1.arr[0] = '\0';
	l_line2.arr[0] = '\0';
	l_line3.arr[0] = '\0';
	l_line4.arr[0] = '\0';
	l_line5.arr[0] = '\0';
	l_line6.arr[0] = '\0';

	l_line1.len = 0;
	l_line2.len = 0;
	l_line3.len = 0;
	l_line4.len = 0;
	l_line5.len = 0;
	l_line6.len = 0;
	
	if(strcmp(d_bill_nature_code.arr,"A")==0)
	{
		EXEC SQL SELECT		contact_name,
					contact_name_title,
					long_name,
					add1_desc,
					add2_desc,
					add3_desc
				   INTO 
						/*:l_bill_contact_name_c,
						:l_bill_contact_name_title_c,
						:l_bill_long_desc_c,
						:l_bill_add1_desc_c,
						:l_bill_add2_desc_c,
						:l_bill_add3_desc_c*/
					:l_line1,
					:l_line2,
					:l_line3,
					:l_line4,
					:l_line5,
					:l_line6
				   FROM ar_customer_lang_vw
				  WHERE cust_code = :d_cust_code
				  AND LANGUAGE_ID = :nd_lang_id;  


			   if (OERROR)
					err_mesg("SELECT failed on table AR_CUSTOMER",0,"");

	l_line1.arr[l_line1.len] = '\0';
	l_line2.arr[l_line2.len] = '\0';
	l_line3.arr[l_line3.len] = '\0';
	l_line4.arr[l_line4.len] = '\0';
	l_line5.arr[l_line5.len] = '\0';
	l_line6.arr[l_line6.len] = '\0';

	if(l_line6.len > 0)
		{
			l_bill_add3_desc_temp.arr[0] = '\0';
			l_bill_add3_desc_temp.len = 0;

			EXEC SQL SELECT long_name
				 INTO :l_bill_add3_desc_temp
				 FROM mp_country_lang_vw
				 WHERE country_code = :l_line6
				 AND LANGUAGE_ID = :nd_lang_id;  

			l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

			if((strcmp(l_bill_add3_desc_temp.arr,l_line6.arr)!=0)
				&& (l_bill_add3_desc_temp.len > 0))
			{
				strcpy(l_line6.arr,l_bill_add3_desc_temp.arr);
				l_line6.len = strlen(l_line6.arr);
			}
		}
	
	if (l_line1.arr[0] != '\0')
	{
		cnt1 = cnt1+1;
		strcpy(l_bill_contact_name_c.arr,l_line1.arr);
	}

	if (l_line2.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line2.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line2.arr);	
		}
	}

	if (l_line3.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line3.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line3.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line3.arr);	
		}
	}

	if (l_line4.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line4.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line4.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line4.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line4.arr);	
		}
	}

	if (l_line5.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line5.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line5.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line5.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line5.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_c.arr,l_line5.arr);	
		}
	}

	if (l_line6.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_c.arr,l_line6.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_c.arr,l_line6.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_c.arr,l_line6.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_c.arr,l_line6.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_c.arr,l_line6.arr);	
		}

		else if (cnt1 == 5)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add3_desc_c.arr,l_line6.arr);	
		}
	}
	
	l_bill_contact_name_c.len = strlen(l_bill_contact_name_c.arr);
	l_bill_contact_name_title_c.len = strlen(l_bill_contact_name_title_c.arr);
	l_bill_long_desc_c.len = strlen(l_bill_long_desc_c.arr);
	l_bill_add1_desc_c.len = strlen(l_bill_add1_desc_c.arr);
	l_bill_add2_desc_c.len = strlen(l_bill_add2_desc_c.arr);
	l_bill_add3_desc_c.len = strlen(l_bill_add3_desc_c.arr);
	
	l_bill_contact_name_c.arr[l_bill_contact_name_c.len] = '\0';
	l_bill_contact_name_title_c.arr[l_bill_contact_name_title_c.len] = '\0';
	l_bill_long_desc_c.arr[l_bill_long_desc_c.len] = '\0';
	l_bill_add1_desc_c.arr[l_bill_add1_desc_c.len] = '\0';
	l_bill_add2_desc_c.arr[l_bill_add2_desc_c.len] = '\0';
	l_bill_add3_desc_c.arr[l_bill_add3_desc_c.len] = '\0';


	}

	cnt1 = 0;

	l_line1.arr[0] = '\0';
	l_line2.arr[0] = '\0';
	l_line3.arr[0] = '\0';
	l_line4.arr[0] = '\0';
	l_line5.arr[0] = '\0';
	l_line6.arr[0] = '\0';	

	l_line1.len = 0;
	l_line2.len = 0;
	l_line3.len = 0;
	l_line4.len = 0;
	l_line5.len = 0;
	l_line6.len = 0;	

	
	EXEC SQL SELECT		mail_contact_name,								
				ln1_mail_add,
				ln2_mail_add,
				ln3_mail_add,
				mail_postal_code,
				mail_country_code
			   INTO 
				:l_line1,
				:l_line2,
				:l_line3,
				:l_line4,
				:l_line5,
				:l_line6
			   FROM mp_pat_other_dtls
			   WHERE patient_id = :d_patient_id;

			   if (OERROR)
				  err_mesg("SELECT failed on table MP_PAT_OTHER_DTLS",0,"");

	l_line1.arr[l_line1.len] = '\0';
	l_line2.arr[l_line2.len] = '\0';
	l_line3.arr[l_line3.len] = '\0';
	l_line4.arr[l_line4.len] = '\0';
	l_line5.arr[l_line5.len] = '\0';
	l_line6.arr[l_line6.len] = '\0';		

	if (l_line5.arr[0] != '\0' && loc_legend[630][0] != '\0')
	{
		strcat(loc_legend[630]," ");		
		strcat(loc_legend[630],l_line5.arr);		

		l_line5.arr[0] = '\0';
		l_line5.len = 0;
		strcpy(l_line5.arr,loc_legend[630]);
		l_line5.len = strlen(l_line5.arr);

	}

	if(l_line6.len > 0)   // country code
	{
		l_bill_add3_desc_temp.arr[0] = '\0';
		l_bill_add3_desc_temp.len = 0;

		EXEC SQL SELECT long_name
			 INTO :l_bill_add3_desc_temp
			 FROM mp_country_lang_vw
			 WHERE country_code = :l_line6
			 AND LANGUAGE_ID = :nd_lang_id;  

		l_bill_add3_desc_temp.arr[l_bill_add3_desc_temp.len] = '\0';

		if((strcmp(l_bill_add3_desc_temp.arr,l_line6.arr)!=0)
			&& (l_bill_add3_desc_temp.len > 0))
		{
			strcpy(l_line6.arr,l_bill_add3_desc_temp.arr);
			l_line6.len = strlen(l_line6.arr);
		}
	}

	if (l_line1.arr[0] != '\0')
	{
		cnt1 = cnt1+1;
		strcpy(l_bill_contact_name_p.arr,l_line1.arr);
	}

	if (l_line2.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line2.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line2.arr);	
		}
	}

	if (l_line3.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line3.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line3.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line3.arr);	
		}
	}

	if (l_line4.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line4.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line4.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line4.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line4.arr);	
		}
	}

	if (l_line5.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line5.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line5.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line5.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line5.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_p.arr,l_line5.arr);	
		}
	}

	if (l_line6.arr[0] != '\0')
	{
		if (cnt1 == 0)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_p.arr,l_line6.arr);
		}
		else if (cnt1 == 1)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_contact_name_title_p.arr,l_line6.arr);	
		}
		else if (cnt1 == 2)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_long_desc_p.arr,l_line6.arr);	
		}
		else if (cnt1 == 3)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add1_desc_p.arr,l_line6.arr);	
		}

		else if (cnt1 == 4)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add2_desc_p.arr,l_line6.arr);	
		}

		else if (cnt1 == 5)
		{
		   cnt1 = cnt1+1;
		   strcpy(l_bill_add3_desc_p.arr,l_line6.arr);	
		}
	}
	
	
	l_bill_contact_name_p.len = strlen(l_bill_contact_name_p.arr);
	l_bill_contact_name_title_p.len = strlen(l_bill_contact_name_title_p.arr);
	l_bill_long_desc_p.len = strlen(l_bill_long_desc_p.arr);
	l_bill_add1_desc_p.len = strlen(l_bill_add1_desc_p.arr);
	l_bill_add2_desc_p.len = strlen(l_bill_add2_desc_p.arr);
	l_bill_add3_desc_p.len = strlen(l_bill_add3_desc_p.arr);

	l_bill_contact_name_p.arr[l_bill_contact_name_p.len] = '\0';
	l_bill_contact_name_title_p.arr[l_bill_contact_name_title_p.len] = '\0';
	l_bill_long_desc_p.arr[l_bill_long_desc_p.len] = '\0';
	l_bill_add1_desc_p.arr[l_bill_add1_desc_p.len] = '\0';
	l_bill_add2_desc_p.arr[l_bill_add2_desc_p.len] = '\0';
	l_bill_add3_desc_p.arr[l_bill_add3_desc_p.len] = '\0';
		
}


get_gl_holder_name_nric()
{
	l_gl_holder_name.arr[0] = '\0';
	l_gl_holder_name.len = 0;

	l_pat_reln_with_gl_holder.arr[0] = '\0';
	l_pat_reln_with_gl_holder.len = 0;

	l_credit_doc_ref_desc.arr[0] = '\0';
	l_credit_doc_ref_desc.len = 0;
	
	l_gl_ic.arr[0] = '\0';
	l_gl_ic.len = 0;


	if(strcmp(d_bill_nature_code.arr,"A")==0)
	{
	   if (l_lsr != 0 && l_dmp == 0)
	   {
		EXEC SQL SELECT (substr(gl_holder_name,1,decode(instr(gl_holder_name,';'),0,9999,instr(gl_holder_name,';'))-1)),
			            pat_reln_with_gl_holder,
				        credit_doc_ref_desc,
						ltrim(substr(gl_holder_name,decode(instr(gl_holder_name,';'),0,9999,instr(gl_holder_name,';'))+1)) 
			     INTO   :l_gl_holder_name,
						:l_pat_reln_with_gl_holder,
						:l_credit_doc_ref_desc,
						:l_gl_ic
				FROM bl_bill_hdr
				WHERE operating_facility_id = :nd_facility_id
				AND doc_type_code			= :d1_doc_type
				AND doc_num                 = :d1_doc_number;
				
	   }
	   else
	   {
		EXEC SQL SELECT substr(gl_holder_name,1,40),
						pat_reln_with_gl_holder,
						substr(credit_doc_ref_desc,1,29)||' '||to_char(credit_doc_ref_date,'DD/MM/YYYY')		   
				INTO	:l_gl_holder_name,
						:l_pat_reln_with_gl_holder,
						:l_credit_doc_ref_desc
				FROM bl_bill_hdr
				WHERE operating_facility_id = :nd_facility_id
				AND doc_type_code			= :d1_doc_type
				AND doc_num                 = :d1_doc_number;
			
	   }

	  if (OERROR)
		err_mesg("SELECT failed on table BL_BILL_HDR - get_gl_holder_name_nric",0,"");
	
	
		l_gl_holder_name.arr[l_gl_holder_name.len] = '\0';
		l_pat_reln_with_gl_holder.arr[l_pat_reln_with_gl_holder.len] = '\0';
		l_gl_ic.arr[l_gl_ic.len] = '\0';
	}
	else
	{
		if (l_lsr != 0 && l_dmp == 0)
		{
			strcpy(l_gl_holder_name.arr,"");
			l_gl_holder_name.len = strlen(l_gl_holder_name.arr);
		}
		else
		{
			//strcpy(l_gl_holder_name.arr,dc_short_name.arr);
			strcpy(l_gl_holder_name.arr,"");
			l_gl_holder_name.len = strlen(l_gl_holder_name.arr);
		}
	}
	
	l_nric_number.arr[0]    = '\0';
	d_date_of_birth.arr[0]	= '\0';
	d_org_dept.arr[0]		= '\0';
	d_gender.arr[0]			= '\0';
	d_gender_desc.arr[0]='\0';
	d_gender_desc.len=0;

	EXEC SQL SELECT  national_id_num,
				     to_char(DATE_OF_BIRTH,'dd/mm/yyyy'),
				     blcommon.get_pat_EmpOrgDept (:d_patient_id,:nd_lang_id),
					 sex
	           INTO :l_nric_number,
					:d_date_of_birth,
					:d_org_dept,
					:d_gender
			   FROM mp_patient_mast
			   WHERE patient_id = :d_patient_id;


	if (OERROR)
		err_mesg("SELECT failed on table MP_PATIENT_MAST - get_gl_holder_name_nric",0,"");

	l_nric_number.arr[l_nric_number.len]				 = '\0';
	l_credit_doc_ref_desc.arr[l_credit_doc_ref_desc.len] = '\0';
	d_date_of_birth.arr[d_date_of_birth.len]			 = '\0';
	d_org_dept.arr[d_org_dept.len]						 = '\0';
	d_gender.arr[d_gender.len]							 = '\0';


	if(d_gender.arr[0]=='M')
	strcpy(d_gender_desc.arr,loc_legend[1412]);
	else
	if(d_gender.arr[0]=='F')
	strcpy(d_gender_desc.arr,loc_legend[1413]);
	else
	strcpy(d_gender_desc.arr,loc_legend[1414]);


}


get_patient_name()
{

dc_short_name.arr[0]  ='\0';
dc_short_name.len     =  0;

	EXEC SQL SELECT  decode(:nd_lang_id,'en',short_name,short_name_loc_lang)
	           INTO :dc_short_name
			   FROM  mp_patient_mast
			  WHERE  patient_id = :d_patient_id;



	if (OERROR)
		err_mesg("SELECT failed on table mp_patient_mast",0,"");

dc_short_name.arr[dc_short_name.len]  ='\0';

}
get_location()
{

d_location.arr[0]='\0';
d_location.len=0;
d_locn_code.arr[0]='\0';
d_locn_code.len=0;

EXEC SQL Select Decode(Upper(LOCN_TYPE),'CLINIC',LOCN_TYPE||': '||LOCN_DESC,
					  LOCN_TYPE||': '||LOCN_DESC||'/'||CUR_BED_NUM),LOCN_CODE
		Into  :d_location,:d_locn_code
		From BL_ENCOUNTER_FOR_QRY_VW
		Where FACILITY_ID=:nd_facility_id 
		And   PATIENT_ID=:d_patient_id
		And   UPPER(LANGUAGE_ID) = UPPER(:nd_lang_id)
		And  (:d_episode_type ='R' or (:d_episode_type <> 'R' and EPISODE_ID=:d_episode_id))
		And  (:d_episode_type in ('R','I','D') or (:d_episode_type in ('O','E') and VISIT_ID=:d_visit_id));
 
	if (OERROR)
		err_mesg("SELECT failed on table BL_ENCOUNTER_FOR_QRY_VW",0,"");

	d_location.arr[d_location.len]='\0';
	d_locn_code.arr[d_locn_code.len]='\0';
}
get_attd_admit_pract()
{
  d_attend_practitioner_id.arr[0]='\0';
  d_attend_practitioner_id.len=0;
  d_admit_practitioner_id.arr[0] ='\0';
  d_admit_practitioner_id.len=0;

EXEC SQL Select  ATTEND_PRACTITIONER_ID,ADMIT_PRACTITIONER_ID
		Into    :d_attend_practitioner_id,:d_admit_practitioner_id
		From pr_encounter 
		Where facility_id=:nd_facility_id 
		And   patient_id=:d_patient_id
		And   PATIENT_CLASS = Decode(:d_episode_type,'E','EM','O','OP','R','XT','I','IP','D','DC')
		And  (:d_episode_type ='R' or (:d_episode_type <> 'R' and EPISODE_ID=:d_episode_id))
		And  (:d_episode_type in ('R','I','D') or (:d_episode_type in ('O','E') and OP_EPISODE_VISIT_NUM=:d_visit_id));


	if (OERROR)
		err_mesg("SELECT failed on table pr_encounter",0,"");


	d_attend_practitioner_id.arr[d_attend_practitioner_id.len]='\0';
    d_admit_practitioner_id.arr[d_admit_practitioner_id.len]  ='\0';

}
get_pract_name()
{
pract_name.arr[0]='\0';
pract_name.len=0;	

EXEC SQL SELECT NAME
		 INTO :pract_name
		 FROM BL_AM_PRACT_STAFF_VW
		 WHERE FACILITY_ID = :nd_facility_id 
		 AND UPPER(LANGUAGE_ID) = UPPER(:nd_lang_id)
		 AND PRACTITIONER_ID = :nd_pract_id
		 AND PRACT_STAFF_IND = 'P';

	if (OERROR)
		err_mesg("SELECT failed on table pr_encounter",0,"");

	pract_name.arr[pract_name.len]='\0';


}
print_formated_amt_varstr(loc_amount_varstr,loc_amount)
char loc_amount_varstr[100];
double loc_amount;
{
    char s_amt[30], str_amt[30], fstr_amt[30];    

   if(loc_amount < 0)
    {
    put_val(loc_amount_varstr,-loc_amount);        
    format_amt(loc_amount_varstr);                
	ltrim (loc_amount_varstr);		
	rtrim (loc_amount_varstr);		
	strcpy(fstr_amt,"(-)");
	strcat(fstr_amt,loc_amount_varstr);		
	ltrim (fstr_amt);		
	rtrim (fstr_amt);
	sprintf(loc_amount_varstr,"%s",fstr_amt);		  
     }
    else 
	{
    put_val(loc_amount_varstr,loc_amount);         	
	format_amt(loc_amount_varstr);		
	ltrim (loc_amount_varstr);		
	rtrim (loc_amount_varstr);		
     }


}                        

print_formated_amt_total(loc_amount)
double loc_amount;
{
	char s_amt[30], str_amt[30], fstr_amt[30];

    if(loc_amount < 0)
	{
        put_val(s_amt,-loc_amount);        
        format_amt(s_amt);        
        sprintf(str_amt,"%14s",s_amt);				
		ltrim (str_amt);		
		rtrim (str_amt);		
		//strcpy(fstr_amt,"CR ");
		//strcat(fstr_amt,str_amt);		
		//ltrim (fstr_amt);		
		//rtrim (fstr_amt);
		//sprintf(str_amt,"%15s",fstr_amt);	
        fprintf(fp,"%15s CR",str_amt);
    }
    else if(loc_amount > 0)
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%15s",s_amt);
        fprintf(fp,"%15s DR",str_amt);
    }
	else if(loc_amount==0)
	{
        put_val(s_amt,loc_amount);         
        format_amt(s_amt);
        sprintf(str_amt,"%15s",s_amt);
        fprintf(fp,"%15s",str_amt);
	 }
}

print_cust_header()
{
	if (ccnt==1)
				{
			
				fetch_cust_cur();
				if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
				 {get_discount_count();
					if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
					{
					fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680],loc_legend[840]);
					lsr_line_cnt();
					}
				 }

				 if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
				 {
					fprintf(fp," \n%-25.25s %-20s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680]);
					lsr_line_cnt();
				 }


               if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")==0)
			    {
				get_discount_count();
				if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				{
				fprintf(fp," \n%-25.25s %-20s %18s %18s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680],loc_legend[840],loc_legend[690]);  
				lsr_line_cnt();
				}
				}

               if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0)
			    {
				fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680],loc_legend[690]);
				lsr_line_cnt();
				}

				fprintf(fp,"\n");
				lsr_line_cnt();
				if(strcmp(d_cust_code.arr,"\0")!=0 && lcol_cnt == 1)
				prt_line_uc();
				if(strcmp(d_cust_code.arr,"\0")!=0  && lcol_cnt == 2)
				prt_line_uc_wide();

				
				}
}

get_column_count_cust()
{
  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
  {
	if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0))
	lcol_cnt =1;

	if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && (strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(p_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =1;

	if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
	   (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0))
	lcol_cnt =2;

	if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
	   (strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(p_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =1;
  }
  else
  lcol_cnt =1;
}

get_column_count_pat()
{

if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
{

	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  
	    ( strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =1;
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) &&  
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
	lcol_cnt =2;
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0) && 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))  
	lcol_cnt =1;
  	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0) && 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))  
	lcol_cnt =1;
 	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0) && 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
	lcol_cnt =2;
  	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0) && 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =1;
  	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0 ) && 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
	lcol_cnt =3;
   	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0 )&& 
	   ( strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =2;
 	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")==0
		&& (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0) && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && 
		strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
	lcol_cnt =5;
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0)
		 && (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) && 
		 strcmp(c_addl_charge_amt_ind.arr,"C")==0)
	lcol_cnt =6;
   /*
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 
		     && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")!=0)
	 {
		if(strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0) //vvvvvvvvvvvvvvv
	    lcol_cnt =6;
	 }	
	*/
	
 }
 else
 {
   lcol_cnt =1;
 }	
}

get_legend_value()
{
    //fetch_single_bill_format_bg();

	
	/*
	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		fprintf(fp,"%-34s      %17s  %17s\n",loc_legend[770],loc_legend[820],loc_legend[830]);
	else
	if (strcmp(c_gross_net_amt_ind.arr,"X")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"N")==0) 
		fprintf(fp,"%-34s      %17s  \n",loc_legend[770],loc_legend[820]);
	else
	if (strcmp(c_gross_net_amt_ind.arr,"X")!=0 && strcmp(c_reim_amt_ind.arr,"N")==0 && strcmp(c_non_reim_amt_ind.arr,"N")==0) 
		fprintf(fp,"%-34s      %17s\n",loc_legend[770],loc_legend[680]);
    else
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_reim_amt_ind.arr,"Y")==0 && strcmp(c_non_reim_amt_ind.arr,"Y")!=0) 
		fprintf(fp,"%-34s      %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[820]);
	else
	if (strcmp(c_gross_net_amt_ind.arr,"N")==0 && strcmp(c_reim_amt_ind.arr,"Y")!=0 && strcmp(c_non_reim_amt_ind.arr,"Y")==0) 
		fprintf(fp,"%-34s      %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[830]);
	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0  &&  strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	fprintf(fp,"%-35s %21s %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[820],loc_legend[830]);

	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	{get_discount_count();
	if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659   
	fprintf(fp,"%-35s %21s %17s %17s %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[840],loc_legend[870],loc_legend[820],loc_legend[830]);
	}
	else
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0)
	fprintf(fp,"%-35s %21s %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[820],loc_legend[830]);
			
	if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"C")==0)
	{get_discount_count();
	if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
	fprintf(fp,"%-35s %21s %17s %17s %17s  %17s\n",loc_legend[770],loc_legend[680],loc_legend[840],loc_legend[870],loc_legend[820],loc_legend[830]);
	}
	*/

	/* legend has been changed i.e loc_legend[770] to loc_legend[110] as per Siriraj Hospital Bill format */

  /***** Added for CRF-440 (Discount Document Report *****/

  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
  {
     	
		
	 if(c_disc_amt_in_dtl_yn.arr[0]=='N' && c_servdate_in_dtlformat_yn.arr[0]=='N')
	 fprintf(fp,"%-55.55s %17.17s\n",loc_legend[110],loc_legend[840]);
	 if(c_disc_amt_in_dtl_yn.arr[0]=='N' && c_servdate_in_dtlformat_yn.arr[0]=='Y')
	 {
	 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
	 fprintf(fp,"%-24.24s %-15.15s %3.3s%15.15s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[840]);
	 else
	 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[840]);
	 }
	 if(c_disc_amt_in_dtl_yn.arr[0]=='Y')
	 fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s\n",loc_legend[110],loc_legend[1420],loc_legend[1421],loc_legend[1422]);
  
  }
  /***** UPTO Added for CRF-440 (Discount Document Report) *****/
  else
  {
 	
	
		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0)   
		    && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
			{
				get_subsidized_amt();
			 if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-34.34s %21.21s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[750]);
				else
				fprintf(fp,"%-34.34s %21.21s \n",loc_legend[110],loc_legend[680]);
			}

		 if(strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"B")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"C")==0) 
		   &&  (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
		  {
			
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			{
			get_discount_count();
			if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[750]);
				else
				fprintf(fp,"%-33.33s %21.21s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[840]);
			}
			}
			else
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-33.33s %21.21s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[750]);
				else
				fprintf(fp,"%-33.33s %21.21s \n",loc_legend[110],loc_legend[680]);
			}
		  }
		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 && ( strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0)
		  && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))  
			{
			if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			 fprintf(fp,"%-24.24s %-15.15s %3.3s%15.15s %17.17s\n ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680]);   //34 to 24 
			 //fprintf(fp,"%-34.34s %-12.12s%19.19s \n",loc_legend[110],loc_legend[1402],loc_legend[680]); for discount doc
			 else
			 {
			 
			 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s\n ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680]);   //34 to 24 
			 }
		    }
			else
			fprintf(fp,"%-33.33s %21.21s\n ",loc_legend[110],loc_legend[680]);
			}
		if (strcmp(c_bill_net_payable_ind.arr,"R")==0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0) 
		   && (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))  
		 {
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			{	get_discount_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
				{
				 if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				 {
				 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
 				 fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840]);
				 else
				 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840]);
				 }
				 else
				 fprintf(fp,"%-33.33s %21.21s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840]);
				}
				else
				fprintf(fp,"%-33.33s %21.21s\n ",loc_legend[110],loc_legend[680]);
			}
				
		 }
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0)
		   && (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
		{		
		
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			{
				if (strcmp(c_addl_charge_amt_ind.arr,"C")==0)
				{
				get_discount_count();
				get_addlcharge_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
				{
				 if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
				 {
				 fprintf(fp,"%-37.37s %11.11s%17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[840],loc_legend[690]);
				 l_no_of_clumns =5;
				 }
				 else
				 {
				  fprintf(fp,"%-37.37s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
				 l_no_of_clumns =4;	
				 }

				 }
				}
				else
				if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				get_discount_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
				{
				 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				 fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690]);  //34 to 24
				 else
				 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690]);  //34 to 24
				 //fprintf(fp,"%-34.34s %-12.12s%19.19s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[680],loc_legend[840],loc_legend[690]); for discount doc
				 l_no_of_clumns =4;
				 }
				}
				else
				{
				get_discount_count();
				 if(l_discount_count!=0  || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				 fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
				 else
				 fprintf(fp,"%-35.35s %18.18s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690]);
				}
			}
			else
			{
				if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0) //vani
				{
				 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				 fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);   //34 to 24
				 else
				 {
				 
				 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);   //34 to 24
				 }
				}
				else
				fprintf(fp,"%-35.35s %18.18s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690]);
			
			}
		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0)
		     && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0)
			 && strcmp(c_addl_charge_amt_ind.arr,"C")!=0)
			 {
			 
				if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0) 
				{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);  //34 to 24
					else
					{
			  
					 fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);  //34 to 24
					}
			  
					//fprintf(fp,"%-35.35s%-12.12s %18.18s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[680],loc_legend[690]); for discount doc
					//l_no_of_clumns =4;
				}
				else
				fprintf(fp,"%-35.35s  %18.18s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690]);
		    
			}

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0)
			 && (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0) 
			 && strcmp(c_addl_charge_amt_ind.arr,"C")==0)
		{	
			
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			{
				 get_discount_count();
				 get_addlcharge_count();
				if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
				{ 
					if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
					{
						
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s %17.17s \n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[840],loc_legend[690]);
					}
					else
					{
						
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s \n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
					}
			    }
				else
				{
					if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0 )  //for crf 659
					{	get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-33.33s    %17.17s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %17.17s %17.17s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
					}
					else
					{
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )	
						fprintf(fp,"%-33.33s    %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %17.17s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[690]);
					}

				 }
			}
			else
			{
				get_addlcharge_count();
				if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
				{
					
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )	
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %15.15s%17.17s %17.17s \n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
						l_no_of_clumns =6;
				}
				else
				{
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-33.33s    %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s    %17.17s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[690]);
						l_no_of_clumns =5;
				}
			}
		
		    
		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 &&  (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0 )&& strcmp(c_addl_charge_amt_ind.arr,"C")!=0 
			&& (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
		{	
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)
			{
					get_discount_count();
				if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				{

					if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
					{
					 if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					 {
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);  //34 to 24
						else
						fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690]);  //34 to 24
					 }
					 else
					 {
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);  //34 to 24
						else
						fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690]);  //34 to 24
					 }
					 l_no_of_clumns =5;
					}
					else
					{
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);

					}

				}
				else
				{
				if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				{
					get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690],loc_legend[750]);
					else
					fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);

				}
				else
				{
					get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690],loc_legend[750]);
					else
					fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);

				}
				}
				}
          		//l_no_of_clumns =5;
			}
			else
			{
			if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%-24.24s %-15.15s %3.3s%11.11s %17.17s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
			}
			else
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%-24.24s %-15.15s   %3.3s %13.13s %17.17s \n",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);
			}
			}
			}
			//fprintf(fp,"%-33.33s %-12.12s %19.19s %17.17s %17.17s\n",loc_legend[110],loc_legend[1402],loc_legend[680],loc_legend[690],loc_legend[750]); for discount doc

		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")==0
		    && (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0) && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
		{
	
		 get_addlcharge_count();
		if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
		{
				
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-33.33s    %12.12s%17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%-33.33s    %12.12s%17.17s %17.17s \n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
				l_no_of_clumns =5;
		}
		else
		{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%-33.33s    %17.17s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%-33.33s    %17.17s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[690]);
		 l_no_of_clumns =4;
		 }
		
		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")==0
		    && (strcmp(c_bill_subsidized_amt_ind.arr,"R")==0 || strcmp(c_bill_subsidized_amt_ind.arr,"N")==0)&& (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
		{
			
			get_addlcharge_count();
			if(l_addlcharge_count!=0 || strcmp(c_print_zero_adcharg_column_yn.arr,"Y")==0 )
			{
			fprintf(fp,"%-33.33s    %12.12s%17.17s %17.17s\n",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
			l_no_of_clumns =5;
			}
			else
			{
			fprintf(fp,"%-33.33s    %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690]);
			l_no_of_clumns =4;
			}
		}
		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")!=0 &&
		 (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0 && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0) && (strcmp(c_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(c_serv_disc_on_gross_ind.arr,"B")!=0))
		 {
				/*****changed on 28/10/2009********** added by vani*****/
				if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
					if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
					{
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp," %-2.2s %-20.20s %-16.16s %3.3s%11.11s %17.17s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp," %-2.2s %-20.20s %-16.16s %3.3s%11.11s %17.17s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
					}
					else
					{
						get_subsidized_amt();
						if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
						fprintf(fp," %-2.2s %-20.20s %-16.16s %3.3s %17.17s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690],loc_legend[750]);
						else
						fprintf(fp," %-2.2s %-20.20s %-16.16s %3.3s %17.17s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);

					}
				}	
				else
				{
					get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s\n",loc_legend[110],loc_legend[680],loc_legend[690],loc_legend[750]);
					else
					fprintf(fp,"%-33.33s %21.21s %17.17s \n",loc_legend[110],loc_legend[680],loc_legend[690]);
				}
				
			/*****uptp here**********/
				

		}

		if (strcmp(c_bill_net_payable_ind.arr,"R")!=0 && strcmp(c_addl_charge_amt_ind.arr,"C")!=0 &&
		 (strcmp(c_bill_subsidized_amt_ind.arr,"R")!=0  && strcmp(c_bill_subsidized_amt_ind.arr,"N")!=0) && (strcmp(c_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(c_serv_disc_on_gross_ind.arr,"B")==0))
		 {
		 		get_discount_count();
		   if(l_discount_count!=0 || strcmp(c_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
		  {

		   if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
				if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
				{	
					get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %10.10s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
					else
					fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %10.10s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690]);
				}
				else
				{	get_subsidized_amt();
					if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
					fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %10.10s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
					else
					fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %10.10s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690]);
				}
			}
			else
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%5.5s %-27.27s %18.18s %10.10s %18.18s  %15.15s\n"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%5.5s %-27.27s %18.18s %10.10s %18.18s  \n"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
			}
		 }
		 else
		  {
			if (strcmp(c_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(c_rate_in_dtlformat_yn.arr,"Y")==0)
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
			}
			else
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %18.18s %15.15s\n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %18.18s \n"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);
			}
			}
			else
			{
				get_subsidized_amt();
				if(l_subsidized_amt!=0 || strcmp(c_print_zero_subsid_column_yn.arr,"Y")==0 )
				fprintf(fp,"%5.5s %-27.27s %18.18s %18.18s  %15.15s\n"," ",loc_legend[110],loc_legend[680],loc_legend[690],loc_legend[750]);
				else
				fprintf(fp,"%5.5s %-27.27s %18.18s %18.18s  \n"," ",loc_legend[110],loc_legend[680],loc_legend[690]);

			}
		   }



		}
      
   }

}


get_payer_bill_header()
{

		//fetch_cust_cur();

  /***** Added for CRF-440 (Discount Document Report *****/

  if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
  {
     	
		
	 if(p_disc_amt_in_dtl_yn.arr[0]=='N' && p_servdate_in_dtlformat_yn.arr[0]=='N')
	 fprintf(fp," %-12.12s %-34.34s %18.18s"," ",loc_legend[110],loc_legend[840]);
	 if(p_disc_amt_in_dtl_yn.arr[0]=='N' && p_servdate_in_dtlformat_yn.arr[0]=='Y')
	 {
	 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
	 fprintf(fp,"%-24.24s %-15.15s %3.3s%15.15s %17.17s",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[840]);
	 else
	  fprintf(fp,"%-24.24s %-15.15s %3.3s %17.17s",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[840]);
	 }
	 if(p_disc_amt_in_dtl_yn.arr[0]=='Y')
	 fprintf(fp,"%-33.33s %21.21s %17.17s %17.17s",loc_legend[110],loc_legend[1420],loc_legend[1421],loc_legend[1422]);
  
  }
  /***** Added for CRF-440 (Discount Document Report *****/

 if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")!=0)
 {		
 
		get_discount_count();							
	
		if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && (strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0))
		 {	
		
			//fprintf(fp," \n%-25.25s %-20s %18s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680],loc_legend[840]);
			if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
			{
			if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{ 
				get_discount_count();
			 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
			 {
			  if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s %3.3s%11.11s %17.17s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840]);
			  else
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s   %3.3s %13.13s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840]);
			 }
			 else
			 {
			   if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s %3.3s%15.15s %17.17s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680]);
			  else
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s   %3.3s %13.13s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680]);
			  }
			}
			else
			{
			get_discount_count();
			if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
			 fprintf(fp," \n%-12.12s %-36.36s %18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[840]);
			 else
			  fprintf(fp," \n%-12.12s %-36.36s %18.18s"," ",loc_legend[110],loc_legend[680]);
			}
			}
			else
			{
			 if(strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			 {if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s %3.3s%11.11s %17.17s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680]);
			  else
			  fprintf(fp," \n%-2.2s %-23.23s %-15.15s   %3.3s %13.13s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680]);
			  }
			 else
			  fprintf(fp," \n%-12.12s %-36.36s %18.18s"," ",loc_legend[110],loc_legend[680]);
			}
			lsr_line_cnt();
		 }
		
		if (strcmp(p_bill_net_payable_ind.arr,"R")==0 && (strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(p_serv_disc_on_gross_ind.arr,"B")!=0))
		{
		
			//fprintf(fp," \n%-25.25s %-20s %18s",d2_short_name.arr,loc_legend[700],loc_legend[680]);
			if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," \n%-2.2s %-23.23s %-15.15s %3.3s%11.11s %17.17s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680]);
			else
			fprintf(fp," \n%-2.2s %-23.23s %-15.15s   %3.3s %13.13s "," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680]);
		     }
			else
			fprintf(fp," \n%-12.12s %-36.36s %18.18s"," ",loc_legend[110],loc_legend[680]);
			lsr_line_cnt();
		}
		
       if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
	      ( strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0)  && 
		   strcmp(p_addl_charge_amt_ind.arr,"C")==0)
		{
		   	
			get_addlcharge_count();
			if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )	
			{	
				if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
				{
				
				get_discount_count();
				 if(l_discount_count!=0  || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				 //fprintf(fp," \n%-12.12s %-33.33s %18.18s%18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
				 fprintf(fp," \n%-12.12s %-28.28s %11.11s%15.15s%18.18s%18.18s"," ",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[840],loc_legend[690]);
				 else
				 fprintf(fp," \n%-12.12s %-33.33s %11.11s%18.18s %18.18s"," ",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
				}
				else
				fprintf(fp," \n%-12.12s %-33.33s %11.11s%18.18s %18.18s"," ",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);
				lsr_line_cnt();
			}
			else
			{
				if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
				{
				get_discount_count();
				 if(l_discount_count!=0  || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				 //fprintf(fp," \n%-12.12s %-33.33s %18.18s%18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
				 fprintf(fp," \n%-12.12s %-28.28s %15.15s%18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
				 else
				 fprintf(fp," \n%-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);
				}
				else
				fprintf(fp," \n%-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);
				lsr_line_cnt();
			}

		
		}
		
		if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
		   ( strcmp(p_serv_disc_on_gross_ind.arr,"C")==0 || strcmp(p_serv_disc_on_gross_ind.arr,"B")==0) && 
		   strcmp(p_addl_charge_amt_ind.arr,"C")!=0)
		{
		  	
		   if(strcmp(nd_calling_pgm_id.arr,"BLROPPV3")!=0)//added on 25/3/2008 Discount should not print for Reprint Vist Bills-No Discount function
			//fprintf(fp," \n%-12.12s %-33.33s %18.18s%18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[840],loc_legend[690]);
		   {
				if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
				{
					get_discount_count();
				 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				 {
				 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				 fprintf(fp,"  %-20.20s %-15.15s %3.3s%11.11s %17.17s%18.18s%18.18s",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[840],loc_legend[690]);
				 else
				 fprintf(fp,"  %-20.20s %-15.15s   %3.3s %13.13s%18.18s%18.18s",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[840],loc_legend[690]);
				 
				 }
				 else
				 {
				 if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
				 fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
				 else
				 fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);
				 }
				}
				else
			    {  
					get_discount_count();
				 if(l_discount_count!=0 || strcmp(p_print_zero_disc_column_yn.arr,"Y")==0)  //for crf 659
				 fprintf(fp," %-12.12s %-25.25s %-11.11s%15.15s%18.18s%18.18s"," ",loc_legend[110]," ",loc_legend[680],loc_legend[840],loc_legend[690]);
				 else
				 fprintf(fp," %-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);
				}
		   }
		  else
		  {
		    if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0)
			{
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," %-2.2s %-20.20s %-15.15s %3.3s%11.11s %17.17s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
			else
			fprintf(fp," %-2.2s %-20.20s %-15.15s   %3.3s %13.13s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);
			}
			else
			fprintf(fp," %-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);
		  }
		   lsr_line_cnt();
					
		}
		
		
		if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
		   ( strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(p_serv_disc_on_gross_ind.arr,"B")!=0) && 
		    strcmp(p_addl_charge_amt_ind.arr,"C")==0)
		{
			
			get_addlcharge_count();
			//fprintf(fp," \n%-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);// as per kuila sir instruction "d2_short_name.arr" removed
			if(l_addlcharge_count!=0 || strcmp(p_print_zero_adcharg_column_yn.arr,"Y")==0 )
			fprintf(fp," \n%-12.12s %-28.28s %11.11s%15.15s%18.18s"," ",loc_legend[110],loc_legend[1230],loc_legend[680],loc_legend[690]);// as per kuila sir instruction "d2_short_name.arr" removed
			else
			fprintf(fp," \n%-12.12s %-28.28s %15.15s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);// as per kuila sir instruction "d2_short_name.arr" removed
			lsr_line_cnt();
		}
	   else
       if ((strcmp(p_bill_net_payable_ind.arr,"C")==0 || strcmp(p_bill_net_payable_ind.arr,"B")==0) && 
	      ( strcmp(p_serv_disc_on_gross_ind.arr,"C")!=0 && strcmp(p_serv_disc_on_gross_ind.arr,"B")!=0))
	    {
			
			//fprintf(fp," \n%-12.12s %-33.33s %18.18s %18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);// as per kuila sir instruction "d2_short_name.arr" removed
			if (strcmp(p_servdate_in_dtlformat_yn.arr,"Y")==0) 
			{
			if(strcmp(p_rate_in_dtlformat_yn.arr,"Y")==0)
			fprintf(fp," \n%-2.2s %-23.23s %-15.15s %3.3s%11.11s %17.17s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[1406],loc_legend[680],loc_legend[690]);
			//fprintf(fp," \n%-2.2s %-24.24s%-12.12s %18.18s%18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[680],loc_legend[690]);
			else
			fprintf(fp," \n%-2.2s %-23.23s %-15.15s   %3.3s %13.13s %18.18s"," ",loc_legend[110],loc_legend[1402],loc_legend[1405],loc_legend[680],loc_legend[690]);
			}
			else
			fprintf(fp," \n%-12.12s %-36.36s %18.18s%18.18s"," ",loc_legend[110],loc_legend[680],loc_legend[690]);

			lsr_line_cnt();
		}

  }
		fprintf(fp,"\n");
		lsr_line_cnt();
		prt_line_uc();
		fprintf(fp,"\n"); //lsr_line_cnt();
	

}
fetch_legend_value1()
{
		
	for(i=1;i<=1500;i++)
	{
		
		if(i<1000)
		{
		  	
			l_pk_value.arr[0] = '\0';
     
			EXEC SQL SELECT LTRIM(RTRIM('BILL_01.LEGEND_'||LTRIM(RTRIM(TO_CHAR(:i,'009')))))
					   INTO :l_pk_value
					   FROM dual;

			l_pk_value.arr[l_pk_value.len]	= '\0';
			l_translated_value.arr[0]		= '\0';

			EXEC SQL EXECUTE
			BEGIN
				blcommon.get_local_lang_desc(:nd_facility,
											'SM',
											'SM_LANG_LEGEND',
											'DFLT_LEGEND_VALUE',
											:l_pk_value,
											:l_translated_value,
											:nd_lang_id);

      

			END;
			END-EXEC;
       
			l_translated_value.arr[l_translated_value.len] = '\0';
			strcpy(loc_legend[i],l_translated_value.arr);

				
		}
		else
		{
			l_pk_value.arr[0] = '\0';
     
			EXEC SQL SELECT LTRIM(RTRIM('BILL_01.LEGEND_'||LTRIM(RTRIM(TO_CHAR(:i,'0009')))))
					   INTO :l_pk_value
					   FROM dual;

			l_pk_value.arr[l_pk_value.len]	= '\0';
			l_translated_value.arr[0]		= '\0';

			EXEC SQL EXECUTE
			BEGIN
				blcommon.get_local_lang_desc(:nd_facility,
											'SM',
											'SM_LANG_LEGEND',
											'DFLT_LEGEND_VALUE',
											:l_pk_value,
											:l_translated_value,
											:nd_lang_id);

      

			END;
			END-EXEC;
       
			l_translated_value.arr[l_translated_value.len] = '\0';
			strcpy(loc_legend[i],l_translated_value.arr);
		}

	}

	
}



check_report_format()
{
	//Modified by Harish 
	//Date - 06/11/2003 Point # 1 - modification document.
	//----------------------------------------------------------

    d_summary_yn = '\0';

	l_dflt_bill_print_in_summ_yn.arr[0] = '\0';

	EXEC SQL SELECT NVL(DFLT_BILL_PRINT_IN_SUMM_YN,'N')
			   INTO l_dflt_bill_print_in_summ_yn 
	           FROM bl_parameters
			  WHERE operating_facility_id = :nd_facility_id;

	l_dflt_bill_print_in_summ_yn.arr[l_dflt_bill_print_in_summ_yn.len] = '\0';

	//First preference given to front end Summary parameter.	
	if(strcmp(l_dflt_bill_print_in_summ_yn.arr,"Y")==0)
	{
		d_summary_yn='Y';
	}
	else
	{
		EXEC SQL SELECT NVL(SUMMARY_YN,'N')
				   INTO :d_summary_yn
				   FROM BL_SUM_DET_PRINT
				  WHERE BLNG_GRP_ID       = :dc_blng_grp_id
    				AND PRT_GRP_HDR_CODE  = :d1_prt_grp_hdr_code
					AND operating_facility_id = :nd_facility_id;       	

			if (sqlca.sqlcode == 1403 )
			{
				     EXEC SQL SELECT NVL(summary_yn,'N')
							    INTO :d_summary_yn
							    FROM bl_sum_det_print
							   WHERE blng_grp_id           = '**'
    						 	 AND prt_grp_hdr_code      = :d1_prt_grp_hdr_code
								 AND operating_facility_id = :nd_facility_id;

					 if (sqlca.sqlcode == 1403 )
							d_summary_yn='Y';
			}
	}

	//If condition will be considered only in reprint options.
	if(strcmp(l_detail_report_flag.arr,"Y")==0)
	{
			EXEC SQL SELECT NVL(SUMMARY_YN,'N')
					   INTO :d_summary_yn
					   FROM BL_SUM_DET_PRINT
					  WHERE BLNG_GRP_ID       = :dc_blng_grp_id
    					AND PRT_GRP_HDR_CODE  = :d1_prt_grp_hdr_code
						AND operating_facility_id = :nd_facility_id;       	

			if (sqlca.sqlcode == 1403 )
			{
				     EXEC SQL SELECT NVL(summary_yn,'N')
							    INTO :d_summary_yn
							    FROM bl_sum_det_print
							   WHERE blng_grp_id           = '**'
    						 	 AND prt_grp_hdr_code      = :d1_prt_grp_hdr_code
								 AND operating_facility_id = :nd_facility_id;

					 if (sqlca.sqlcode == 1403 )
							d_summary_yn='Y';
			}
	}
}


/* Added by Raghava.S for Thai date conversion 06/07/2007 */

get_local_date()
{
	
	EXEC SQL EXECUTE

	DECLARE

	t_date  date;
	
	BEGIN
		get_locale_date.convert_to_locale_date(to_date(:nd_temp_date1,'DD/MM/YY'),:nd_lang_id,t_date);

		 :nd_loc_date1:= to_char(t_date,'DD/MM/YYYY');


	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed",0,"");


}

get_local_date1()
{
	
	EXEC SQL EXECUTE

	DECLARE

	t_date  date;
	
	BEGIN
		 get_locale_date.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY HH24:MI'),:nd_lang_id,t_date);

		 :nd_loc_date := to_char(t_date,'DD/MM/YYYY HH24:MI');


	END;

	END-EXEC;
		
		if (OERROR)
        err_mesg("SELECTING Date failed",0,"");


}


/*---06/07/2007----*/

init_date_temp_var()
{
nd_temp_date.arr[0] =  '\0';
nd_loc_date.arr[0]  =  '\0';
nd_temp_date1.arr[0]=  '\0';
nd_loc_date1.arr[0] =  '\0';
date_convert.arr[0] =  '\0';
d1_doc_date1.arr[0] =  '\0';


nd_temp_date.len = 0;
nd_loc_date.len  = 0;
nd_temp_date1.len= 0;
nd_loc_date1.len = 0;
date_convert.len = 0;
d1_doc_date1.len = 0;

}

/*---06/07/2007----*/

fun_change_loc_date()
{

strcpy(nd_temp_date1.arr,date_convert.arr);
nd_temp_date1.len = strlen(nd_temp_date1.arr);

get_local_date();

}

/*---06/07/2007----*/

fun_change_loc_date1()
{

strcpy(nd_temp_date.arr,date_convert.arr);
nd_temp_date.len = strlen(nd_temp_date.arr);

get_local_date1();

strcpy(date_convert.arr,nd_loc_date.arr); 
}


fun_centre(v_text,v_size)
{
int l_length,i;

l_length=strlen(v_text);

for (i=0;i<(v_size-l_length)/2;i++)
{

	fprintf(fp," ");
}
 
}


get_policy_desc()
{

int l_len;
l_Policy_type_desc.arr[0] =  '\0';

	EXEC SQL SELECT substr(long_desc,1,46)
		INTO :l_Policy_type_desc
		FROM bl_ins_policy_types_lang_vw
		WHERE policy_type_code       =:d_Policy_type_code
		AND operating_facility_id =    :nd_facility_id
		and upper(language_id)=upper(:nd_lang_id);    

	l_Policy_type_desc.arr[l_Policy_type_desc.len]	= '\0';


}
/*** Added by raghava on 21/7/2009 at Bangkok For CRF-659 ***/
get_bill_num(int ind)
{

    l_bill_num.arr[0]='\0';
	l_bill_num.len=0;


   if(ind==1)
   { 

	  EXEC SQL SELECT :d1_bill_doc_type_code||'/'||:d1_bill_doc_num
		       INTO   :l_bill_num
               FROM    DUAL;

   }
   else
   {
	  EXEC SQL SELECT :d_bill_doc_type_code||'/'||:d_bill_doc_num
		       INTO   :l_bill_num
               FROM    DUAL;
   }
    l_bill_num.arr[l_bill_num.len]='\0';
}
get_pat_bill_num()
{
 l_pat_bill_num.arr[0]='\0';
 l_pat_bill_num.len=0;
 
 EXEC SQL SELECT :d_bill_doc_type_code||'/'||:d_bill_doc_num
		  INTO   :l_pat_bill_num
          FROM    DUAL;

 l_pat_bill_num.arr[l_pat_bill_num.len]='\0';
}
get_discount_count()  //added for IN9051
{

l_discount_count=0;

EXEC SQL SELECT  count(*) into  l_discount_count
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						A.bill_doc_type_code =:d1_doc_type			//added by vani

                        AND A.BILL_DOC_NUM =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						A.bill_doc_type_code =:d1_doc_type		

                        AND A.BILL_DOC_NUM =  :d1_doc_number )	

        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and NVL(A.UPD_DISC_AMT,0)>0
	and BILL_DOC_TYPE_CODE=:d1_doc_type
	and BILL_DOC_NUM=:d1_doc_number;


		
}

get_addlcharge_count()  //added for IN9051
{

l_addlcharge_count=0;

EXEC SQL SELECT  count(*) into  l_addlcharge_count
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						A.bill_doc_type_code =:d1_doc_type			//added by vani

                        AND A.BILL_DOC_NUM =  :d1_doc_number))		//added by vani

                         or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						A.bill_doc_type_code =:d1_doc_type	

                        AND A.BILL_DOC_NUM =  :d1_doc_number )

                     
        ))  
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and NVL(A.ADDL_CHARGE_AMT_IN_CHARGE,0)>0
	and BILL_DOC_TYPE_CODE=:d1_doc_type
	and BILL_DOC_NUM=:d1_doc_number;


	
}


get_aviled_outside_pkg()  //added for IN9051
{

l_aviled_outside_pkg=0;

EXEC SQL SELECT BLNG_GRP_ID INTO :l_blng_grp
		FROM BL_BILL_HDR
		WHERE DOC_TYPE_CODE=:d1_doc_type
		AND	DOC_NUM=:d1_doc_number
		AND PATIENT_ID=:d_patient_id
		AND EPISODE_TYPE=:d_episode_type
		and operating_facility_id=:nd_facility_id;

EXEC SQL SELECT NVL(PACKAGE_YN,'N') INTO :l_pakage_yn
		FROM BL_BLNG_GRP
		WHERE BLNG_GRP_ID=:l_blng_grp;

if (strcmp(l_pakage_yn.arr,"Y")=='\0')
{

EXEC SQL SELECT  count(*) into  l_aviled_outside_pkg
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						A.bill_doc_type_code =:d1_doc_type			//added by vani

                        AND A.BILL_DOC_NUM =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						A.bill_doc_type_code =:d1_doc_type		

                        AND A.BILL_DOC_NUM =  :d1_doc_number )	

                      
        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and NVL(PACKAGE_TRX_YN,'N')='N'
	and	PACKAGE_SEQ_NO is null
	and BILL_DOC_TYPE_CODE=:d1_doc_type
	and BILL_DOC_NUM=:d1_doc_number;

}
	

	
}


get_bill_format()
{
	EXEC SQL select BILL_FORMAT_IND
				 into :nd_bill_format_id
				from bl_parameters
				where operating_facility_id=:nd_facility_id;
}

fetch_dtl()
{
original_text.arr[0]	='\0';
copy_text.arr[0]		= '\0';	
bill_title_line1.arr[0]		= '\0';
bill_title_line2.arr[0]		= '\0';		
bill_title_line3.arr[0]		= '\0';		
bill_title_line4.arr[0]		= '\0';		
op_cash_bill_title_w_rcpt.arr[0]		= '\0';	
op_cash_bill_title_w_rfnd.arr[0]		= '\0';			
ip_cash_bill_title_w_rfnd.arr[0]		= '\0';		
op_cash_bill_title_wo_rcpt.arr[0]		= '\0';	
op_credit_bill_title.arr[0]		= '\0';		
ip_cash_bill_title_w_rcpt.arr[0]		= '\0';	
ip_cash_bill_title_wo_rcpt.arr[0]		= '\0';	
ip_credit_bill_title.arr[0]		= '\0';		
cash_bill_title_addl_line.arr[0]		= '\0';	
credit_bill_title_addl_line.arr[0]		= '\0';	
bl_header_line_01.arr[0]		= '\0';			
bl_header_line_02.arr[0]		= '\0';			
bl_header_line_03.arr[0]		= '\0';			
bl_header_line_04.arr[0]		= '\0';			
bl_header_line_05.arr[0]		= '\0';			
bl_header_line_06.arr[0]		= '\0';			
bl_header_line_07.arr[0]		= '\0';			
bl_header_line_08.arr[0]		= '\0';			
bl_header_line_09.arr[0]		= '\0';			
bl_header_line_10.arr[0]		= '\0';			
bl_header_line_11.arr[0]		= '\0';			
bl_header_line_12.arr[0]		= '\0';			
bl_header_line_13.arr[0]		= '\0';			
bl_header_line_14.arr[0]		= '\0';			
bl_footer_line_01.arr[0]		= '\0';			
bl_footer_line_02.arr[0]		= '\0';			
bl_footer_line_03.arr[0]		= '\0';			
bl_footer_line_04.arr[0]		= '\0';			
bill_credit_footer_line1.arr[0]		= '\0';		
bill_credit_footer_line2.arr[0]		= '\0';		
bill_credit_footer_line3.arr[0]		= '\0';		
bill_credit_footer_line4.arr[0]		= '\0';	
bill_ins_footer_line1.arr[0]		= '\0';
bill_ins_footer_line2.arr[0]		= '\0';
bill_ins_footer_line3.arr[0]		= '\0';
bill_ins_footer_line4.arr[0]		= '\0';
cr_addl_id_in_ftr_yn.arr[0]			= '\0';
print_ins_addl_id_in_ftr_yn.arr[0]	= '\0';
ip_cr_addl_id_in_ftr_yn.arr[0]		= '\0';
ip_ins_addl_id_in_ftr_yn.arr[0]		= '\0';

original_text.len=0;
copy_text.len= 0;	
bill_title_line1.len= 0;
bill_title_line2.len= 0;		
bill_title_line3.len= 0;		
bill_title_line4.len= 0;		
op_cash_bill_title_w_rcpt.len= 0;
op_cash_bill_title_w_rfnd.len= 0;
ip_cash_bill_title_w_rfnd.len= 0;		
op_cash_bill_title_wo_rcpt.len= 0;	
op_credit_bill_title.len= 0;		
ip_cash_bill_title_w_rcpt.len= 0;	
ip_cash_bill_title_wo_rcpt.len= 0;	
ip_credit_bill_title.len= 0;		
cash_bill_title_addl_line.len= 0;	
credit_bill_title_addl_line.len= 0;	
bl_header_line_01.len= 0;			
bl_header_line_02.len= 0;			
bl_header_line_03.len= 0;			
bl_header_line_04.len= 0;			
bl_header_line_05.len= 0;			
bl_header_line_06.len= 0;			
bl_header_line_07.len= 0;			
bl_header_line_08.len= 0;			
bl_header_line_09.len= 0;			
bl_header_line_10.len= 0;			
bl_header_line_11.len= 0;			
bl_header_line_12.len= 0;			
bl_header_line_13.len= 0;			
bl_header_line_14.len= 0;			
bl_footer_line_01.len= 0;			
bl_footer_line_02.len= 0;			
bl_footer_line_03.len= 0;			
bl_footer_line_04.len= 0;			
bill_credit_footer_line1.len= 0;		
bill_credit_footer_line2.len= 0;		
bill_credit_footer_line3.len= 0;		
bill_credit_footer_line4.len= 0;
bill_ins_footer_line1.len	= 0;
bill_ins_footer_line2.len	= 0;
bill_ins_footer_line3.len	= 0;
bill_ins_footer_line4.len	= 0;
cr_addl_id_in_ftr_yn.len	= 0;
print_ins_addl_id_in_ftr_yn.len	= 0;
ip_cr_addl_id_in_ftr_yn.len	= 0;
ip_ins_addl_id_in_ftr_yn.len= 0;

		
		EXEC SQL SELECT REGION_CODE,RES_AREA_CODE,RES_TOWN_CODE
				into :nd_REGION_CODE,:nd_RES_AREA_CODE,:nd_RES_TOWN_CODE
				from sm_facility_param
				where FACILITY_ID=:nd_facility_id;
     	
		/*	EXEC SQL SELECT REGION_CODE,RES_AREA_CODE,RES_TOWN_CODE
				into :nd_REGION_CODE1,:nd_RES_AREA_CODE1,:nd_RES_TOWN_CODE1
				from mp_patient
				where patient_id=:d_patient_id;*/

		

       if((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
	   {
	   
       EXEC SQL SELECT ORIGINAL_TEXT,			
						COPY_TEXT,			
						BILL_TITLE_LINE1,		
						BILL_TITLE_LINE2,		
						BILL_TITLE_LINE3,		
						BILL_TITLE_LINE4,		
						OP_CASH_BILL_TITLE_W_RCPT,	
						OP_CASH_BILL_TITLE_WO_RCPT,	
						OP_CREDIT_BILL_TITLE,		
						IP_CASH_BILL_TITLE_W_RCPT,	
						IP_CASH_BILL_TITLE_WO_RCPT,	
						IP_CREDIT_BILL_TITLE,		
						CASH_BILL_TITLE_ADDL_LINE,	
						CREDIT_BILL_TITLE_ADDL_LINE,	
						BILL_HEADER_LINE1,		
						BILL_HEADER_LINE2,		
						BILL_HEADER_LINE3,		
						BILL_HEADER_LINE4,		
						BILL_HEADER_LINE5,		
						BILL_HEADER_LINE6,		
						BILL_HEADER_LINE7,		
						BILL_HEADER_LINE8,		
						BILL_HEADER_LINE9,		
						BILL_HEADER_LINE10,		
						BILL_HEADER_LINE11,		
						BILL_HEADER_LINE12,		
						BILL_HEADER_LINE13,		
						BILL_HEADER_LINE14,		
						BILL_FOOTER_LINE1,		
						BILL_FOOTER_LINE2,		
						BILL_FOOTER_LINE3,		
						BILL_FOOTER_LINE4,		
						BILL_CREDIT_FOOTER_LINE1,	
						BILL_CREDIT_FOOTER_LINE2,	
						BILL_CREDIT_FOOTER_LINE3,	
						BILL_CREDIT_FOOTER_LINE4,
						bill_ins_footer_line1,
						bill_ins_footer_line2,
						bill_ins_footer_line3,
						bill_ins_footer_line4,
						CR_ADDL_ID_IN_FTR_YN,
						PRINT_INS_ADDL_ID_IN_FTR_YN,
						op_cash_bill_title_w_rfnd		//added for 16217
	         into	:original_text,
						:copy_text,			
						:bill_title_line1,		
						:bill_title_line2,		
						:bill_title_line3,		
						:bill_title_line4,		
						:op_cash_bill_title_w_rcpt,	
						:op_cash_bill_title_wo_rcpt,	
						:op_credit_bill_title,		
						:ip_cash_bill_title_w_rcpt,	
						:ip_cash_bill_title_wo_rcpt,	
						:ip_credit_bill_title,		
						:cash_bill_title_addl_line,	
						:credit_bill_title_addl_line,
						 :bl_header_line_01,
						 :bl_header_line_02,
						 :bl_header_line_03,
						 :bl_header_line_04,
						 :bl_header_line_05,
						 :bl_header_line_06,
						 :bl_header_line_07,
						 :bl_header_line_08,
						 :bl_header_line_09,
						 :bl_header_line_10,
						 :bl_header_line_11,
						 :bl_header_line_12,
						 :bl_header_line_13,
						 :bl_header_line_14,
						 :bl_footer_line_01,
						 :bl_footer_line_02,
						 :bl_footer_line_03,
						 :bl_footer_line_04,
						 :bill_credit_footer_line1,	
						 :bill_credit_footer_line2,
						 :bill_credit_footer_line3,
						 :bill_credit_footer_line4,
						 :bill_ins_footer_line1,
						 :bill_ins_footer_line2,
						 :bill_ins_footer_line3,
						 :bill_ins_footer_line4,
						 :cr_addl_id_in_ftr_yn,
						 :print_ins_addl_id_in_ftr_yn,
						 :op_cash_bill_title_w_rfnd		//added for 16217
			    FROM BL_BILL_HDR_FTR_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id;
			}
		  else
		   {
			EXEC SQL SELECT IP_ORIGINAL_TEXT,			
						IP_COPY_TEXT,			
						IP_BILL_TITLE_LINE1,		
						IP_BILL_TITLE_LINE2,		
						IP_BILL_TITLE_LINE3,		
						IP_BILL_TITLE_LINE4,		
						OP_CASH_BILL_TITLE_W_RCPT,	
						OP_CASH_BILL_TITLE_WO_RCPT,	
						OP_CREDIT_BILL_TITLE,		
						IP_CASH_BILL_TITLE_W_RCPT,	
						IP_CASH_BILL_TITLE_WO_RCPT,	
						IP_CREDIT_BILL_TITLE,		
						IP_CASH_BILL_TITLE_ADDL_LINE,	
						IP_CREDIT_BILL_TITLE_ADDL_LINE,	
						IP_BILL_HEADER_LINE1,		
						IP_BILL_HEADER_LINE2,		
						IP_BILL_HEADER_LINE3,		
						IP_BILL_HEADER_LINE4,		
						IP_BILL_HEADER_LINE5,		
						IP_BILL_HEADER_LINE6,		
						IP_BILL_HEADER_LINE7,		
						IP_BILL_HEADER_LINE8,		
						IP_BILL_HEADER_LINE9,		
						IP_BILL_HEADER_LINE10,		
						IP_BILL_HEADER_LINE11,		
						IP_BILL_HEADER_LINE12,		
						IP_BILL_HEADER_LINE13,		
						IP_BILL_HEADER_LINE14,		
						IP_BILL_FOOTER_LINE1,		
						IP_BILL_FOOTER_LINE2,		
						IP_BILL_FOOTER_LINE3,		
						IP_BILL_FOOTER_LINE4,		
						IP_BILL_CREDIT_FOOTER_LINE1,	
						IP_BILL_CREDIT_FOOTER_LINE2,	
						IP_BILL_CREDIT_FOOTER_LINE3,	
						IP_BILL_CREDIT_FOOTER_LINE4,
						ip_bill_ins_footer_line1,
						ip_bill_ins_footer_line2,
						ip_bill_ins_footer_line3,
						ip_bill_ins_footer_line4,
						IP_CR_ADDL_ID_IN_FTR_YN,
						IP_INS_ADDL_ID_IN_FTR_YN ,
						ip_cash_bill_title_w_rfnd  //added for 16217
	            into	:original_text,
						:copy_text,			
						:bill_title_line1,		
						:bill_title_line2,		
						:bill_title_line3,		
						:bill_title_line4,		
						:op_cash_bill_title_w_rcpt,	
						:op_cash_bill_title_wo_rcpt,	
						:op_credit_bill_title,		
						:ip_cash_bill_title_w_rcpt,	
						:ip_cash_bill_title_wo_rcpt,	
						:ip_credit_bill_title,		
						:cash_bill_title_addl_line,	
						:credit_bill_title_addl_line,
						 :bl_header_line_01,
						 :bl_header_line_02,
						 :bl_header_line_03,
						 :bl_header_line_04,
						 :bl_header_line_05,
						 :bl_header_line_06,
						 :bl_header_line_07,
						 :bl_header_line_08,
						 :bl_header_line_09,
						 :bl_header_line_10,
						 :bl_header_line_11,
						 :bl_header_line_12,
						 :bl_header_line_13,
						 :bl_header_line_14,
						 :bl_footer_line_01,
						 :bl_footer_line_02,
						 :bl_footer_line_03,
						 :bl_footer_line_04,
						 :bill_credit_footer_line1,	
						 :bill_credit_footer_line2,
						 :bill_credit_footer_line3,
						 :bill_credit_footer_line4,
						 :bill_ins_footer_line1,
						 :bill_ins_footer_line2,
						 :bill_ins_footer_line3,
						 :bill_ins_footer_line4,
						 :ip_cr_addl_id_in_ftr_yn,
						 :ip_ins_addl_id_in_ftr_yn,
						 :ip_cash_bill_title_w_rfnd  //added for IN16217
                FROM BL_BILL_HDR_FTR_FORMAT
		        WHERE Operating_Facility_Id = :nd_facility_id;

		    }
     if(NODATAFOUND)
	     err_mesg("No Format Setup is Found, Please Check the Setup",0,"");	 

original_text.arr[original_text.len]='\0';			
copy_text.arr[copy_text.len]		= '\0';	
bill_title_line1.arr[bill_title_line1.len]		= '\0';
bill_title_line2.arr[bill_title_line2.len]		= '\0';		
bill_title_line3.arr[bill_title_line3.len]		= '\0';		
bill_title_line4.arr[bill_title_line4.len]		= '\0';		
op_cash_bill_title_w_rcpt.arr[op_cash_bill_title_w_rcpt.len]		= '\0';	
op_cash_bill_title_w_rfnd.arr[op_cash_bill_title_w_rfnd.len]		= '\0';
ip_cash_bill_title_w_rfnd.arr[ip_cash_bill_title_w_rfnd.len]		= '\0';
op_cash_bill_title_wo_rcpt.arr[op_cash_bill_title_wo_rcpt.len]		= '\0';	
op_credit_bill_title.arr[op_credit_bill_title.len]		= '\0';		
ip_cash_bill_title_w_rcpt.arr[ip_cash_bill_title_w_rcpt.len]		= '\0';	
ip_cash_bill_title_wo_rcpt.arr[ip_cash_bill_title_wo_rcpt.len]		= '\0';	
ip_credit_bill_title.arr[ip_credit_bill_title.len]		= '\0';		
cash_bill_title_addl_line.arr[cash_bill_title_addl_line.len]		= '\0';	
credit_bill_title_addl_line.arr[credit_bill_title_addl_line.len]		= '\0';	
bl_header_line_01.arr[bl_header_line_01.len]		= '\0';			
bl_header_line_02.arr[bl_header_line_02.len]		= '\0';			
bl_header_line_03.arr[bl_header_line_03.len]		= '\0';			
bl_header_line_04.arr[bl_header_line_04.len]		= '\0';			
bl_header_line_05.arr[bl_header_line_05.len]		= '\0';			
bl_header_line_06.arr[bl_header_line_06.len]		= '\0';			
bl_header_line_07.arr[bl_header_line_07.len]		= '\0';			
bl_header_line_08.arr[bl_header_line_08.len]		= '\0';			
bl_header_line_09.arr[bl_header_line_09.len]		= '\0';			
bl_header_line_10.arr[bl_header_line_10.len]		= '\0';			
bl_header_line_11.arr[bl_header_line_11.len]		= '\0';			
bl_header_line_12.arr[bl_header_line_12.len]		= '\0';			
bl_header_line_13.arr[bl_header_line_13.len]		= '\0';			
bl_header_line_14.arr[bl_header_line_14.len]		= '\0';			
bl_footer_line_01.arr[bl_footer_line_01.len]		= '\0';			
bl_footer_line_02.arr[bl_footer_line_02.len]		= '\0';			
bl_footer_line_03.arr[bl_footer_line_03.len]		= '\0';			
bl_footer_line_04.arr[bl_footer_line_04.len]		= '\0';			
bill_credit_footer_line1.arr[bill_credit_footer_line1.len]		= '\0';		
bill_credit_footer_line2.arr[bill_credit_footer_line2.len]		= '\0';		
bill_credit_footer_line3.arr[bill_credit_footer_line3.len]		= '\0';		
bill_credit_footer_line4.arr[bill_credit_footer_line4.len]		= '\0';
cr_addl_id_in_ftr_yn.arr[cr_addl_id_in_ftr_yn.len]				= '\0';
print_ins_addl_id_in_ftr_yn.arr[print_ins_addl_id_in_ftr_yn.len] = '\0';
ip_cr_addl_id_in_ftr_yn.arr[ip_cr_addl_id_in_ftr_yn.len]		 = '\0';
ip_ins_addl_id_in_ftr_yn.arr[ip_cr_addl_id_in_ftr_yn.len]		 = '\0'; 		
}

print_title()
{
	
	if(strcmp(dc_bill_print_flag.arr,"N") == 0)    
	{
	  if (original_text.arr[0] != '\0')
      {
		print_line(original_text.arr);
		fprintf(fp,"\n");
		line_ctr++;
       }
	}
	else
	{

		if (copy_text.arr[0] != '\0')
		  {
			print_line(copy_text.arr);
			fprintf(fp,"\n");
			line_ctr++;
		   }
	  }


	if (bill_title_line1.arr[0] != '\0')
      {
		print_line(bill_title_line1.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bill_title_line2.arr[0] != '\0')
      {
		print_line(bill_title_line2.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bill_title_line3.arr[0] != '\0')
      {
		/*
		disp_message(ERR_MESG,"bill_title_line3");
		disp_message(ERR_MESG,bill_title_line3.arr);
		*/
		print_line(bill_title_line3.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	if (bill_title_line4.arr[0] != '\0')
      {
		print_line(bill_title_line4.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
       }
	
}


print_line(line_var) varchar line_var[101];  //print_line definition

{
	dup_var.arr[0] = '\0';
	dup_var.len = 0;

    pos_var  = 0;
	pos_var1 = 0;
	pos_var2 = 0;
	print_upto = 0;
	lv_var  = 1;
	i = 0;
	
	strcpy(dup_var.arr,line_var);
	dup_var.len = strlen(dup_var.arr);
	var_length = strlen(dup_var.arr);
	pos_var = char_position(dup_var.arr,"+",1);
    sprintf(st_var,"%d",var_length);
	

	while(i < var_length)
	{ 
	if (pos_var == 0)
	{
    pos_length = var_length - i + 2;
	sprintf(st_var,"%d",pos_length);
	
	put_string(dup_var.arr,i,pos_length);
	strcpy(str_var1.arr,ls_str.arr);
	
	

	str_var1.len= strlen(str_var1.arr);
	
	check_splch(str_var1.arr);
	pos_var1 = 0;
	pos_var2 = 0;
	i = var_length;
	}

	if (pos_var != 0 && pos_var1 == 0)
	{	    
	pos_var1 = pos_var;

	pos_length = pos_var1-print_upto-1;	

    put_string(dup_var.arr,print_upto+1,pos_length);
    strcpy(str_var1.arr,ls_str.arr);
	str_var1.len = strlen(str_var1.arr);
	check_splch(str_var1.arr);

    print_upto = pos_var1 - 1;
	i = pos_var1+1;
    

	pos_var2 = char_position(dup_var.arr,"+",i);

     if (pos_var2 == 0)
	 {
	  pos_length = var_length - pos_var1 + 1;
      put_string(dup_var.arr,pos_var1,pos_length);
      strcpy(str_var1.arr,ls_str.arr);
	  str_var1.len = strlen(str_var1.arr);

	  check_splch(str_var1.arr);
	  print_upto = var_length+1;
	  i = var_length+1;
     }

    }

    if (pos_var2 != 0)
	{
    nd_column_val.arr[0] = '\0';
	nd_column_val.len = 0;
	column_var.arr[0] = '\0';
	column_var.len = 0;
	tab_name.arr[0] = '\0';
	tab_name.len = 0;

sql_stmt1.arr[0] = '\0';
sql_stmt1.len = 0;
sql_stmt2.arr[0] = '\0';
sql_stmt2.len = 0;


	pos_length = pos_var2 - pos_var1 - 1;

    column_var.arr[0] = '\0';
	column_var.len = 0;
	
	 put_string(dup_var.arr,pos_var1+1,pos_length);
     strcpy(column_var.arr,ls_str.arr);
	 column_var.len = strlen(column_var.arr);
	 date_yn = chk_date_yn(column_var.arr);
	 

                                   
		 
	  EXEC SQL SELECT  decode(:date_yn,0,'select to_char(ltrim('|| LET_MAPPED_COL_NAME || ')) from '|| LET_MAPPED_TABLE_NAME ||' WHERE ',
										 'select to_char('|| LET_MAPPED_COL_NAME || ',''DD/MM/YYYY'') from '|| LET_MAPPED_TABLE_NAME ||' WHERE '),LET_MAPPED_TABLE_NAME
					into  :sql_stmt1,tab_name
                    FROM BL_RECEIPT_MAPPING_COL
                    WHERE LET_COLUMN_ID = :column_var
					AND APPL_TRX_IND = 'B';

			
	

	len = strlen(sql_stmt1.arr);
		sql_stmt1.arr[sql_stmt1.len]  ='\0';


    tab_name.arr[tab_name.len] = '\0';
	
//	disp_message(ERR_MESG,tab_name.arr);

	if(strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDR") == 0 || strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDRDTL_VW") == 0) 
	{
    
	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_doc_type_code1.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUMBER) =");
	strcat(sql_stmt2.arr,d_doc_number1.arr);

	if(strcmp(column_var.arr,"CASHIER_NAME")==0)
	{
		strcat(sql_stmt2.arr," AND ROWNUM=1");
	}
      
	}

	
	if(strcmp(tab_name.arr,"BL_BILL_HDR") == 0 ) 
	{
    
	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);

	}
	
	if(strcmp(tab_name.arr,"AR_CUSTOMER") == 0 ) 
	{

		if(strcmp(d_cust_code.arr,"\0")!=0)
		strcpy(d_copy_cust_code.arr,d_cust_code.arr);
		else
		strcpy(d_copy_cust_code.arr,"$$$$$");
	

    strcpy(sql_stmt2.arr, "cust_code = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_copy_cust_code.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"BL_CASH_COUNTER") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"operating_facility_id = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    strcat(sql_stmt2.arr, " and CASH_COUNTER_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_cash_counter.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"BL_EPISODE_FIN_DTLS") == 0 ) 
	{
    strcpy(sql_stmt2.arr, "EPISODE_TYPE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and EPISODE_ID= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	

	if(strcmp(tab_name.arr,"BL_ENCOUNTER_FOR_QRY_VW") == 0 ) 
	{
	
    strcpy(sql_stmt2.arr,"episode_type = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_type.arr);
	strcat(sql_stmt2.arr,"'");

    if (strcmp(d_episode_type.arr,"R")!=0)
	{
		strcat(sql_stmt2.arr," and episode_id= ");
		strcat(sql_stmt2.arr,"'");
		strcat(sql_stmt2.arr,d_episode_id.arr);
		strcat(sql_stmt2.arr,"'");
    }

   if (strcmp(d_episode_type.arr,"R")!=0 && strcmp(d_episode_type.arr,"I")!=0 && strcmp(d_episode_type.arr,"D")!=0)
   {
	strcat(sql_stmt2.arr," and visit_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_visit_id.arr);
	strcat(sql_stmt2.arr,"'");
   }

	strcat(sql_stmt2.arr," and NVL(LANGUAGE_ID,'en')= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_lang_id.arr);
	strcat(sql_stmt2.arr,"'");

	strcat(sql_stmt2.arr," and patient_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and facility_id = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	
	}

	if(strcmp(tab_name.arr,"PR_ENCOUNTER") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    strcat(sql_stmt2.arr," and patient_id = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and episode_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_id.arr);
	strcat(sql_stmt2.arr,"'");
	}


	if(strcmp(tab_name.arr,"MP_PATIENT_MAST") == 0)
	{ 
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); ;
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	
	if(strcmp(tab_name.arr,"MP_PATIENT") == 0)
	{ 
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); ;
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

	if(strcmp(tab_name.arr,"MP_REGION") == 0) 
	{
	strcpy(sql_stmt2.arr, "REGION_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_REGION_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	
	if(strcmp(tab_name.arr,"SY_ACC_ENTITY") == 0) 
	{
	strcpy(sql_stmt2.arr, "ACC_ENTITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	

	if(strcmp(tab_name.arr,"MP_PAT_OTHER_DTLS") == 0) 
	{
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}


    if(strcmp(tab_name.arr,"MP_RES_AREA") == 0) 
	{
	strcpy(sql_stmt2.arr, "RES_AREA_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_AREA_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

//disp_message(ERR_MESG,nd_RES_TOWN_CODE.arr);

	if(strcmp(tab_name.arr,"MP_RES_TOWN") == 0) 
	{
	strcpy(sql_stmt2.arr, "RES_TOWN_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_TOWN_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

	if(strcmp(tab_name.arr,"SM_FACILITY_PARAM") == 0) 
	{
    strcpy(sql_stmt2.arr, "FACILITY_ID = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"SY_ACC_ENTITY") == 0) 
	{
    strcpy(sql_stmt2.arr, "acc_entity_id = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	/********SCRUM CHANGES FOR CRF-23 STARTS HERE*********/

	if(strcmp(tab_name.arr,"BL_BILL_REF_PATCATG_VW") == 0 ) 
	{
   	strcpy(sql_stmt2.arr," OPERATING_FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr, " and DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);
 	}


  	if(strcmp(tab_name.arr,"BL_BILL_REF_SPLTY_VW") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"OPERATING_FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr, "and DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);
 	} 

	/*******CRF-23 UPTO HERE*******/




	strcpy(sql_stmt,sql_stmt1.arr);
	
	/*disp_message(ERR_MESG,"MAIN QUERY 1");
    disp_message(ERR_MESG,sql_stmt1.arr);
	*/


	strcat(sql_stmt,sql_stmt2.arr); 
	
	/*
	disp_message(ERR_MESG,"MAIN QUERY 2");
disp_message(ERR_MESG,sql_stmt2.arr);
*/

  //disp_message(ERR_MESG,sql_stmt);

EXEC SQL EXECUTE
	BEGIN
	 EXECUTE IMMEDIATE :sql_stmt INTO :nd_column_val;
	END;
END-EXEC;

/*
disp_message(ERR_MESG,"MAIN QUERY 3");
disp_message(ERR_MESG,nd_column_val.arr);
*/

nd_column_val.arr[nd_column_val.len]  ='\0';

//disp_message(ERR_MESG,column_var.arr);
sprintf(st_var,"%d",sqlca.sqlcode);
//disp_message(ERR_MESG,st_var);

 	if (OERROR)
	 {
	  column_var.arr[0] = '\0';
	  column_var.len = 0;
      pos_length = pos_var2 - pos_var1 + 1;
	  put_string(dup_var.arr,pos_var1,pos_length);
      strcpy(column_var.arr,ls_str.arr);
	  column_var.len = strlen(column_var.arr);

		
		
	   if (strcmp(column_var.arr,"+REPRINT_DATE+")==0)
		 {
		
			EXEC SQL SELECT TO_CHAR(SYSDATE,'dd/mm/yyyy') 
				 INTO :nd_curr_date
				FROM dual;
				nd_curr_date.arr[nd_curr_date.len] = '\0';

				if(nd_curr_date.arr[0]!='\0')
				{
				  init_date_temp_var();
				  strcpy(date_convert.arr,nd_curr_date.arr);
				  fun_change_loc_date();
				  strcpy(nd_curr_date.arr,nd_loc_date1.arr);
				  fprintf(fp,"%s",nd_curr_date.arr);
				 }
		  }
		  
			
		  if (strcmp(column_var.arr,"+REPRINT_DATE_TIME+")==0)
		 {
		
			EXEC SQL SELECT TO_CHAR(SYSDATE,'dd/mm/yyyy hh24:mi') 
				 INTO :nd_curr_date
				FROM dual;
				nd_curr_date.arr[nd_curr_date.len] = '\0';

				  fprintf(fp,"%s",nd_curr_date.arr);
				 
		  }
		
		/***added on 28/10/2009*** added by vani****/
		if (strcmp(column_var.arr,"+ADM_DOCTOR+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			nd_adm_doctor.arr[0] = '\0';
			nd_adm_doctor.len=0;
			
		 }
		 /***upto here***/
				
		 if (strcmp(column_var.arr,"+TREATING_DOCTOR+")==0 && strcmp(st_var,"-1405")==0)
		 { 
		 	if(strcmp(nd_adm_doctor.arr,"\0")==0)
			fprintf(fp,"%-31.31s"," ");
			else
			fprintf(fp,"%-31.31s",nd_adm_doctor.arr);
			
		 }
		
		 
		 if (strcmp(column_var.arr,"+PATIENT_MAIL_ADD1+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			fprintf(fp,"%-42.42s"," ");
			
		 }
		 
		 if (strcmp(column_var.arr,"+PATIENT_MAIL_ADD2+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			fprintf(fp,"%-42.42s"," ");
			
		 }

		 if (strcmp(column_var.arr,"+PATIENT_MAIL_ADD3+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			fprintf(fp,"%-42.42s"," ");
			
		 }

		 if (strcmp(column_var.arr,"+PATIENT_MAIL_ADD4+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			fprintf(fp,"%-42.42s"," ");
			
		 }
		
		if (strcmp(column_var.arr,"+PAT_CONTACT_NUM+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			fprintf(fp,"%-42.42s"," ");
			
		 }

		 
		 /*if (strcmp(column_var.arr,"+VISIT_ID+")==0 && strcmp(st_var,"-1405")==0)
		 { 
			strcpy(nd_column_val.arr,"1");
			fprintf(fp,"%-s",nd_column_val.arr);
			
		 }*/
		 
		 	
		  if((strcmp(st_var,"-1405")!=0) && (strcmp(column_var.arr,"+REPRINT_DATE+")!=0) && (strcmp(column_var.arr,"+REPRINT_DATE_TIME+")!=0))
			fprintf(fp,"%s",column_var.arr);

	  }
    else
	{
			 nd_column_val.arr[nd_column_val.len] = '\0';
			
						 
		 if (strcmp(column_var.arr,"PAYER_NAME")==0 && strcmp(nd_column_val.arr,"\0")==0)
		 { 
			EXEC SQL select substr(ltrim(SHORT_NAME),1,30) into :nd_column_val 
					from MP_PATIENT_MAST WHERE PATIENT_ID=:d_patient_id;
			
		 }
					

		if (strcmp(column_var.arr,"PATIENT_MAIL_ADD1")==0)
		 { 
				
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-42.42s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-10.10s%-32.32s"," ",nd_column_val.arr);
			 }
			 
		 }
		
		if (strcmp(column_var.arr,"PATIENT_MAIL_ADD2")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-42.42s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-10.10s%-32.32s"," ",nd_column_val.arr);
			}
			
		 }
		 if (strcmp(column_var.arr,"PATIENT_MAIL_ADD3")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-42.42s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%10.10s%-32.32s"," ",nd_column_val.arr);
			}
			
		 }
		 if (strcmp(column_var.arr,"PATIENT_MAIL_ADD4")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-42.42s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%10.10s%-32.32s"," ",nd_column_val.arr);
			}
			
		 }
		 
		 if (strcmp(column_var.arr,"PAT_CONTACT_NUM")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-42.42s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%10.10s%-32.32s"," ",nd_column_val.arr);
			}
			
		 }
		
		 if (strcmp(column_var.arr,"PAYER_ADDR_LINE1")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-32.32s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-32.32s",nd_column_val.arr);
			}
			
		 }
		
		if (strcmp(column_var.arr,"PAYER_ADDR_LINE2")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-32.32s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-32.32s",nd_column_val.arr);
			}
			
		 }
		
		if (strcmp(column_var.arr,"PAYER_ADDR_LINE3")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-32.32s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-32.32s",nd_column_val.arr);
			}
			
		 }
		
		if (strcmp(column_var.arr,"PAYER_ADDR_LINE4")==0 )
		 { 
			if (strcmp(nd_column_val.arr,"\0")==0)
			   fprintf(fp,"%-32.32s"," ");
			else
			{
			EXEC SQL select substr(ltrim(:nd_column_val),1,42) into :nd_column_val 
					from dual;
					nd_column_val.arr[nd_column_val.len] = '\0';
					fprintf(fp,"%-32.32s",nd_column_val.arr);
			}
			
		 }
		

		if (strcmp(column_var.arr,"EPISODE_ID")==0 && strcmp(st_var,"-1405")!=0)
		{
		  nd_episode.arr[0]='\0';
		  nd_episode.len=0;
		  fprintf(fp,"/");
		  strcpy(nd_episode.arr,nd_column_val.arr);

		 }
		if (strcmp(column_var.arr,"VISIT_ID")==0 && strcmp(st_var,"-1405")!=0)
		 { 
			if (strcmp(nd_episode.arr,"\0")!=0 )
			fprintf(fp,"/");	
					
		 }
		
	  if (strcmp(column_var.arr,"PAT_AGE")==0)
		{
		 get_pat_details();
		 sprintf(nd_column_val.arr,"%d",ln_age_year);
		 }

		if (strcmp(column_var.arr,"PAT_SEX")==0)
		{
		EXEC SQL select decode(:nd_column_val,'M','Male','F','Female','U','Unknown')
					into  :nd_column_val from dual;
		nd_column_val.arr[nd_column_val.len] = '\0';
		
		 }

		 if (strcmp(column_var.arr,"POLICY_TYPE_CODE")==0)
		{
		EXEC SQL select substr(long_desc,1,30) 
					into  :nd_column_val 
					from BL_INS_POLICY_TYPES_lang_vw
					where  POLICY_TYPE_CODE=:nd_column_val
					and language_id=:nd_lang_id;
		nd_column_val.arr[nd_column_val.len] = '\0';
		
		 }
		
		if (strcmp(column_var.arr,"BLNG_GRP_DESC")==0)
		{
		EXEC SQL select substr(long_desc,1,30) 
					into  :nd_column_val 
					from BL_BLNG_GRP_LANG_VW
					where  blng_grp_id=:nd_column_val
					and language_id=:nd_lang_id;
		nd_column_val.arr[nd_column_val.len] = '\0';
		
		 }

		if (strcmp(column_var.arr,"PATIENT_ID")==0)
		{
		EXEC SQL select substr(:nd_column_val,1,20) into :nd_column_val from dual;
		nd_column_val.arr[nd_column_val.len] = '\0';
			fprintf(fp,"%-20.20s",nd_column_val.arr);
		}

		 if (strcmp(column_var.arr,"PATIENT_NAME")==0)
		{
		EXEC SQL select substr(:nd_column_val,1,40) into :nd_column_val from dual;
		nd_column_val.arr[nd_column_val.len] = '\0';
			
		 if(strcmp(d_cust_code.arr,"\0")==0 && (strcmp(d_bill_nature_code.arr,"C")==0))
		   if (l_lsr != 0 && l_dmp == 0)
			fprintf(fp,"%c(s3B",ESC);
			fprintf(fp,"%-40.40s",nd_column_val.arr);
		 }
		
		if (strcmp(column_var.arr,"ADM_DOCTOR")==0)
		{ 
			nd_adm_doctor.arr[0]='\0';
			  nd_adm_doctor.len=0;
			
			/*nd_adm_doctor1.arr[0]='\0';
			  nd_adm_doctor1.len=0; */

			  EXEC SQL select substr(FULL_NAME,1,30) into :nd_column_val
				 from sy_physician_mast_lang_vw
				where PHYSICIAN_ID=:nd_column_val
				and facility_id=:nd_facility_id
				and language_id=:nd_lang_id;

			 /* EXEC SQL select substr(FULL_NAME,1,15) into :nd_adm_doctor1
				 from sy_physician_mast_lang_vw
				where PHYSICIAN_ID=:nd_column_val
				and facility_id=:nd_facility_id
				and language_id=:nd_lang_id;*/

			nd_column_val.arr[nd_column_val.len] = '\0';

			strcpy(nd_adm_doctor.arr,nd_column_val.arr);

			//nd_adm_doctor.len=strlen(nd_adm_doctor.arr);
				
			//nd_adm_doctor.arr[nd_adm_doctor.len] = '\0';

			//disp_message(ERR_MESG,nd_adm_doctor.arr);

			//fprintf(fp,"%-15.15s",nd_column_val.arr);  //commented for IN14942
						

		}
		
		if (strcmp(column_var.arr,"TREATING_DOCTOR")==0)
		{
			EXEC SQL select substr(FULL_NAME,1,30) into :nd_column_val
			 from sy_physician_mast_lang_vw
			where PHYSICIAN_ID=:nd_column_val
			and facility_id=:nd_facility_id
			and language_id=:nd_lang_id; 

			nd_column_val.arr[nd_column_val.len] = '\0';
			
			
			if (strcmp(nd_adm_doctor.arr,"\0")==0)
			fprintf(fp,"%-31.31s",nd_column_val.arr);
			
			if (strcmp(nd_adm_doctor.arr,"\0")!=0 && strcmp(nd_adm_doctor.arr,nd_column_val.arr)==0)
				fprintf(fp,"%-31.31s",nd_adm_doctor.arr);
					
			if(strcmp(nd_adm_doctor.arr,nd_column_val.arr)!=0 && strcmp(nd_adm_doctor.arr,"\0")!=0)
			{
				/*if (strcmp(nd_column_val.arr,"\0")!=0)
				{
				strcat(nd_adm_doctor1.arr,"/");
				strcat(nd_adm_doctor1.arr,nd_column_val.arr);
				fprintf(fp,"%-31.31s",nd_adm_doctor1.arr);
				}
				else
				fprintf(fp,"%-31.31s",nd_adm_doctor.arr);*/

				fprintf(fp,"%-31.31s",nd_adm_doctor.arr);
				if (strcmp(nd_column_val.arr,"\0")!=0)
				fprintf(fp,"\n%-14.14s %-31.31s"," ",nd_column_val.arr);
			
			}
			
			
		}


		if (strcmp(column_var.arr,"COUNTER_NUM")==0)
		{
		EXEC SQL select substr(:nd_column_val,1,4) into :nd_column_val from dual;
		nd_column_val.arr[nd_column_val.len] = '\0';
		fprintf(fp,"%-4.4s",nd_column_val.arr);
		}
		
		if (strcmp(column_var.arr,"COUNTER_BLDG")==0)
		{
		nd_counter_bldg.arr[0]='\0';
		nd_counter_bldg.len=0;
		strcpy(nd_counter_bldg.arr,nd_column_val.arr);
		
		}

		
		if (strcmp(column_var.arr,"COUNTER_FLOOR")==0)
		{
		 if (strcmp(nd_counter_bldg.arr,"\0")!=0 )
			fprintf(fp,"/");
		}

		if (strcmp(column_var.arr,"PREPARED_BY")==0)
		 {
				EXEC SQL SELECT DISTINCT APPL_USER_NAME
				 INTO  :nd_column_val
				 FROM   SM_APPL_USER_LANG 
				 WHERE  APPL_USER_ID=:nd_column_val
				AND	 LANGUAGE_ID  =:nd_lang_id;

				nd_column_val.arr[nd_column_val.len] = '\0';

		  }
		


		if (strcmp(column_var.arr,"PAYER_NAME")==0 && strcmp(nd_column_val.arr,"\0")!=0)
		{
			EXEC SQL select substr(:nd_column_val,1,39) into :nd_column_val from dual;
			nd_column_val.arr[nd_column_val.len] = '\0';
			if(strcmp(d_cust_code.arr,"\0")!=0 && (strcmp(d_bill_nature_code.arr,"A")==0))
		   if (l_lsr != 0 && l_dmp == 0)
			fprintf(fp,"%c(s3B",ESC);
		 }
	
		
     
	if (strcmp(column_var.arr,"PATIENT_NAME")!=0 && strcmp(column_var.arr,"PATIENT_ID")!=0 && strcmp(column_var.arr,"ADM_DOCTOR")!=0 && strcmp(column_var.arr,"TREATING_DOCTOR")!=0 
				&& strcmp(column_var.arr,"COUNTER_NUM")!=0 && strcmp(column_var.arr,"PATIENT_MAIL_ADD1")!=0 && strcmp(column_var.arr,"PATIENT_MAIL_ADD2")!=0 
				&& strcmp(column_var.arr,"PATIENT_MAIL_ADD3")!=0 && strcmp(column_var.arr,"PATIENT_MAIL_ADD4")!=0
				&& strcmp(column_var.arr,"PAT_CONTACT_NUM")!=0
				&& strcmp(column_var.arr,"PAYER_ADDR_LINE1")!=0
				&& strcmp(column_var.arr,"PAYER_ADDR_LINE2")!=0
				&& strcmp(column_var.arr,"PAYER_ADDR_LINE3")!=0
				&& strcmp(column_var.arr,"PAYER_ADDR_LINE4")!=0 ) 
	fprintf(fp,"%-s",nd_column_val.arr); //Final values are printing here only


	if ((strcmp(column_var.arr,"PAYER_NAME")==0 && strcmp(nd_column_val.arr,"\0")!=0 )|| (strcmp(column_var.arr,"PATIENT_NAME")==0))
	fprintf(fp,"%c(s-3B",ESC);

    }

	print_upto = pos_var2;
	i = pos_var2+1;  
	
    pos_var1 = 0;
	pos_var2 = 0;

	pos_var = char_position(dup_var.arr,"+",i);
    }
   } 
} 

check_splch(str_var1)
char str_var1[101];
{
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 lc_str_val.arr[0]	='\0';
 lc_str_val.len		= 0;
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 
 ctr = 1;
 print_upto_c = 0;
 strcpy(lc_str_val.arr,str_var1);
 lc_str_val.len = strlen(lc_str_val.arr);
 len_lc_str_val = strlen(lc_str_val.arr);

 while(ctr <= len_lc_str_val)
 {
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 
 
 spchar_pos = chk_esc_pos(lc_str_val.arr,ctr);
 
 spchar_pos1 = chk_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0  && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 1;
   }

 spchar_pos1 = chk_cp_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 2;
   }

 
 spchar_pos1 = chk_tab_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 3;
   }

 spchar_pos1 = chk_bold_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 4;
   }

 spchar_pos1 = chk_font_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 5;
   }

spchar_pos1 = chk_line_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 6;
   }

spchar_pos1 = chk_uline_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 7;
   }


 if (spchar_pos == 0)   
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 prt_len = len_lc_str_val - print_upto_c ;

 put_string(lc_str_val.arr,print_upto_c + 1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);

 lc_str_var.len=strlen(lc_str_var.arr);

 fprintf(fp,"%s",lc_str_var.arr);

 ctr = len_lc_str_val+1;
 print_upto_c = len_lc_str_val;
 }
 else
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;

 prt_len = spchar_pos - print_upto_c -1;
 
 put_string(lc_str_val.arr,print_upto_c+1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);
 lc_str_var.len = strlen(lc_str_var.arr);

  fprintf(fp,"%s",lc_str_var.arr);
  
  if (spchar_type == 1)
  {
  fprintf(fp,"\n");
  line_ctr++;
  }

  if (spchar_type == 2)
  {
  fprintf(fp,"\n");
  line_ctr++;
  }

  if (spchar_type == 3)
  fprintf(fp,"        ");

  if (spchar_type == 4)
  {
	if (bold_st)
	{
	fprintf(fp,"%c(s-3B",ESC); /* release bold style */
	bold_st = 0;
	}
    else
	{
	fprintf(fp,"%c(s3B",ESC); 	/* To set Bold style 			*/
	bold_st = 1;
	}
  }

  if (spchar_type == 5)
  {
	if (font_st)
	{
	fprintf(fp,"%c(s14H",ESC); 	/* To set the font 			*/
	font_st = 0;
	}
    else
	{
	fprintf(fp,"%c(s10H",ESC); 	/* To set the font 			*/
	font_st = 1;
	}
  }
if (spchar_type == 6)
  {
	prt_line_uc_wide();
  }

  if (spchar_type == 7)
  {
	if (uline_st)
	{
	
	fprintf (fp,"%c&d0D",ESC); 	/* To set the underline 			*/
	uline_st = 0;
	}
    else
	{
	fprintf (fp,"%c&d@",ESC); 	/* To set the underline 			*/
	uline_st = 1;
	}
  }

  ctr = spchar_pos+2;
  print_upto_c = spchar_pos+1;
  }  
 }
}

int chk_tab_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\t',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_nwln_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;

splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\n',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_cp_nwln_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;

splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\N',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_bold_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\b',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_font_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\f',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_line_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\l',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_uline_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\u',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}
int chk_esc_pos(str_var2,st_pos)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'\',:st_pos)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

int chk_date_yn(str_var2)
char str_var2[101];
{
lc_splch_var.arr[0] = '\0';
lc_splch_var.len = 0;
splch_pos = 0;

 strcpy(lc_splch_var.arr,str_var2);
 lc_splch_var.len = strlen(lc_splch_var.arr);
 
 EXEC SQL select instr(:lc_splch_var,'DATE',1)
   into :splch_pos
   from dual;
 
 return(splch_pos);
}

check_page_end(l_lead_lines, l_print_flag)
int l_lead_lines;
int	l_print_flag;
{
	if(l_print_flag==1)
		l_lead_lines=l_lead_lines+10;

	if((line_ctr+l_lead_lines)> 55) 
	{
		fprintf(fp,"%-70s %s %d\n"," ","Contd...",++pctr);
		fprintf(fp,"\f");
		fprintf(fp,"%-45s Page : %d\n\n"," ",pctr);
		line_ctr = 2;
		print_title();
	}
}

int char_position(ls_var,lc_var,ld_var)
char ls_var[101];
char lc_var[3];
int ld_var;
{
 ls_str_var.arr[0] = '\0';
 ls_str_var.len = 0;

 ls_char_var.arr[0] = '\0';
 ls_char_var.len = 0;

 strcpy(ls_str_var.arr,ls_var);
 strcpy(ls_char_var.arr,lc_var);

 ls_str_var.len = strlen(ls_str_var.arr);
 ls_char_var.len = strlen(ls_char_var.arr);

  
 EXEC SQL select instr(:ls_str_var,:ls_char_var,:ld_var)
	         into :char_pos
			 from dual;
 
 if (OERROR)
        err_mesg("SELECT failed on table DUAL",0,"");

 
 ld_var = 0;
 return(char_pos);
}

print_bill_footer()
{

if (bl_footer_line_01.arr[0] != '\0')
      {
		print_line(bl_footer_line_01.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_02.arr[0] != '\0')
      {
		print_line(bl_footer_line_02.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_03.arr[0] != '\0')
      {
		print_line(bl_footer_line_03.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bl_footer_line_04.arr[0] != '\0')
      {
		print_line(bl_footer_line_04.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }

}

fun_change_loc_date2()
{

strcpy(nd_temp_date.arr,date_convert.arr);
nd_temp_date.len = strlen(nd_temp_date.arr);

get_local_date2();
nd_loc_date.arr[nd_loc_date.len]='\0';

}

get_local_date2()
{
	
	EXEC SQL EXECUTE

	DECLARE

	t_date  date;
	
	BEGIN
		get_locale_date.convert_to_locale_date(to_date(:nd_temp_date,'DD/MM/YY'),:nd_lang_id,t_date);

		 :nd_loc_date:= to_char(t_date,'DD/MM/YYYY');


	END;

	END-EXEC;
     		
		if (OERROR)
        err_mesg("SELECTING Date failed",0,"");


}


fun_amt_in_words1()
{
 	amt_in_words.arr[0]='\0';
	amt_in_words.len=0;
	
	amt_in_words_Sep.arr[0]='\0';
	amt_in_words_Sep.len=0;
						 //abs(nvl(:nd_tot_pat_net_charge_amt,0)),
	EXEC SQL EXECUTE
	BEGIN		
	:no_of_lines1:=bl_spell_number.print_in_words
						(:nd_facility_id,
						  abs(nvl(:amount,0)),
						  70,
						 :currency,
						 :sub_cur,
						 :nd_decimal,
						 :amt_in_words,
						 :amt_in_words_Sep1);
  	END;
	END-EXEC;
	amt_in_words.arr[amt_in_words.len]='\0';
	amt_in_words_Sep1.arr[amt_in_words_Sep1.len]='\0';

EXEC SQL SELECT REPLACE(:amt_in_words_Sep1,'~',CHR(10)||'                              ') 
		 INTO :amt_in_words_Sep
		 FROM DUAL;
	amt_in_words_Sep.arr[amt_in_words_Sep.len]='\0';

}


print_bill_title()
{ 
	if(strcmp(nd_calling_pgm_id.arr,"BLRDISCN")==0)
	{ 
	   fun_centre(loc_legend[1415],80);
	   fprintf(fp,"%s",loc_legend[1415]);
	   	fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
	 }
	else
	 {
	   
			if ( strcmp(d_bill_nature_code.arr,"C")!=0)
			{
				   if((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
				   {
					print_line(op_credit_bill_title.arr);
						fprintf(fp,"\n");
						line_ctr++;
						check_page_end(1,0);
					}
					if((strcmp(d_episode_type.arr,"I")==0)||(strcmp(d_episode_type.arr,"D")==0))
					{
						print_line(ip_credit_bill_title.arr);
						fprintf(fp,"\n");
						line_ctr++;
						check_page_end(1,0);
					}

			}
			else
			{		
			  
			  if(l_no_settlement_details.arr[0]=='R' || 
					( strcmp(nd_calling_pgm_id.arr,"BLROPPV5")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS4")==0 || strcmp(nd_calling_pgm_id.arr,"BLRIPDS3")==0||strcmp(nd_calling_pgm_id.arr,"BLRUCDS3")==0 || strcmp(nd_calling_pgm_id.arr,"BLRUCDS4")==0))
			   {
						get_receipt_refund_ind();
							
					 
					if( strcmp(d_receipt_refund_ind.arr,"R")==0 || strcmp(d_receipt_refund_ind.arr,"F")==0) 
					 {	
					
						if((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
						{
							
							if(strcmp(d_receipt_refund_ind.arr,"R")==0) 
							{
								
								if (op_cash_bill_title_w_rcpt.arr[0] != '\0')
								  {
									print_line(op_cash_bill_title_w_rcpt.arr);
									
									fprintf(fp,"\n");
									line_ctr++;
									check_page_end(1,0);
								   }
							 }
						 
							 if(strcmp(d_receipt_refund_ind.arr,"F")==0) 
							 {
								
								
								if (op_cash_bill_title_w_rfnd.arr[0] != '\0')
								  {
									print_line(op_cash_bill_title_w_rfnd.arr);
									
									fprintf(fp,"\n");
									line_ctr++;
									check_page_end(1,0);
								   }
							 }
						}


						if((strcmp(d_episode_type.arr,"I")==0)||(strcmp(d_episode_type.arr,"D")==0))
						{
							if(strcmp(d_receipt_refund_ind.arr,"R")==0)
							{
								if (ip_cash_bill_title_w_rcpt.arr[0] != '\0')
								{
								print_line(ip_cash_bill_title_w_rcpt.arr);
						
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
								}
							 }
							
							if(strcmp(d_receipt_refund_ind.arr,"F")==0) 
							{
								if (ip_cash_bill_title_w_rfnd.arr[0] != '\0')
								{
								print_line(ip_cash_bill_title_w_rfnd.arr);
						
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
								}
							 }
						  }
				
				     }
	   					
			
				  if(strcmp(d_receipt_refund_ind.arr,"R")!=0 && strcmp(d_receipt_refund_ind.arr,"F")!=0) 
				  {
					if((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
						{
							 if (op_cash_bill_title_wo_rcpt.arr[0] != '\0')
							  {
								print_line(op_cash_bill_title_wo_rcpt.arr);
								
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
							   }
						  }
					   if((strcmp(d_episode_type.arr,"I")==0)||(strcmp(d_episode_type.arr,"D")==0))
						{
							 if (ip_cash_bill_title_wo_rcpt.arr[0] != '\0')
							  {
								print_line(ip_cash_bill_title_wo_rcpt.arr);
								
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
							   }
						  }
			
					}
				
			  }
			  else
			  {
				if((strcmp(d_episode_type.arr,"O")==0)||(strcmp(d_episode_type.arr,"E")==0)||(strcmp(d_episode_type.arr,"R")==0))
						{
							 if (op_cash_bill_title_wo_rcpt.arr[0] != '\0')
							  {
								print_line(op_cash_bill_title_wo_rcpt.arr);
								
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
							   }
						  }
					   if((strcmp(d_episode_type.arr,"I")==0)||(strcmp(d_episode_type.arr,"D")==0))
						{
							 if (ip_cash_bill_title_wo_rcpt.arr[0] != '\0')
							  {
								print_line(ip_cash_bill_title_wo_rcpt.arr);
								
								fprintf(fp,"\n");
								line_ctr++;
								check_page_end(1,0);
							   }
						  }
				 }

		    }
			
		}

}

print_addl_line()
{
		if ( strcmp(d_bill_nature_code.arr,"C")==0)
		{
		if (cash_bill_title_addl_line.arr[0]!= '\0')
		 {
		 print_line(cash_bill_title_addl_line.arr);
		 fprintf(fp,"\n");
		 line_ctr++;
		 check_page_end(1,0);
		 }
		}
		else
		{
		 if (credit_bill_title_addl_line.arr[0]!= '\0')
		 {
		 print_line(credit_bill_title_addl_line.arr);
		 fprintf(fp,"\n");
		 line_ctr++;
		 check_page_end(1,0);
		 }
		}
}

print_body()
{
	if (bl_header_line_01.arr[0] != '\0')
      { 
	    str_has_to_print.arr[0]='\0';
	    str_has_to_print.len=0;
		print_line_1(bl_header_line_01.arr);
		str_has_to_print.arr[str_has_to_print.len]='\0';
		if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_01.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }

	if (bl_header_line_02.arr[0] != '\0')
      {	
	    
		print_line(bl_header_line_02.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		
       }
	if (bl_header_line_03.arr[0] != '\0')
      {
	   str_has_to_print.arr[0]='\0';
	   str_has_to_print.len=0;
	   print_line_1(bl_header_line_03.arr);
	   str_has_to_print.arr[str_has_to_print.len]='\0';
	   if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
	    print_line(bl_header_line_03.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_04.arr[0] != '\0')
	   {
	   str_has_to_print.arr[0]='\0';
	   str_has_to_print.len=0;
	   print_line_1(bl_header_line_04.arr);
	   str_has_to_print.arr[str_has_to_print.len]='\0';
	   if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_04.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_05.arr[0] != '\0')
      {
	  str_has_to_print.arr[0]='\0';
	  str_has_to_print.len=0;
	  print_line_1(bl_header_line_05.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	    if (strcmp(str_has_to_print.arr,"\0")!=0)
	    {
	   print_line(bl_header_line_05.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
	    }
       }

	   
	if (bl_header_line_06.arr[0] != '\0')
	{ 
	  str_has_to_print.arr[0]='\0';
	  str_has_to_print.len=0;
      print_line_1(bl_header_line_06.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	   if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_06.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_07.arr[0] != '\0')
	  {	
	     str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
		print_line_1(bl_header_line_07.arr);
		str_has_to_print.arr[str_has_to_print.len]='\0';
		if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_07.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_08.arr[0] != '\0')
      {
	   str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_08.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	  if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_08.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_09.arr[0] != '\0')
      {
	  str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_09.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	   if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_09.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_10.arr[0] != '\0')
      { 
	  str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_10.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	    if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_10.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_11.arr[0] != '\0')
      {
	  str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_11.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	  if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_11.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_12.arr[0] != '\0')
      {
	  str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_12.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	  if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
	    print_line(bl_header_line_12.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
	if (bl_header_line_13.arr[0] != '\0')
      {
	  str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	  print_line_1(bl_header_line_13.arr);
	  str_has_to_print.arr[str_has_to_print.len]='\0';
	   if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_13.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
		
	
	if (bl_header_line_14.arr[0] != '\0')
      {
	   str_has_to_print.arr[0]='\0';
	     str_has_to_print.len=0;
	   print_line_1(bl_header_line_14.arr);
	   str_has_to_print.arr[str_has_to_print.len]='\0';
	    if (strcmp(str_has_to_print.arr,"\0")!=0)
		{
		print_line(bl_header_line_14.arr);
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
		}
       }
}

print_credit_bill_footer()
{

	if (bill_credit_footer_line1.arr[0] != '\0')
      {
		print_line(bill_credit_footer_line1.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_credit_footer_line2.arr[0] != '\0')
      {
		print_line(bill_credit_footer_line2.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_credit_footer_line3.arr[0] != '\0')
      {
		print_line(bill_credit_footer_line3.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_credit_footer_line4.arr[0] != '\0')
      {
		print_line(bill_credit_footer_line4.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
 
 
 
       }
}

print_ins_bill_footer()
{

	if (bill_ins_footer_line1.arr[0] != '\0')
      {
		print_line(bill_ins_footer_line1.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_ins_footer_line2.arr[0] != '\0')
      {
		print_line(bill_ins_footer_line2.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_ins_footer_line3.arr[0] != '\0')
      {
		print_line(bill_ins_footer_line3.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
       }
	if (bill_ins_footer_line4.arr[0] != '\0')
      {
		print_line(bill_ins_footer_line4.arr);
		
		fprintf(fp,"\n");
		line_ctr++;
		check_page_end(1,0);
 
 
 
       }
}

get_pat_details()
{
 


  EXEC SQL EXECUTE

  DECLARE
    lv_deceased_yn	varchar2(2);
	lv_deceased_date date;
	x_today     date;
	lv_dob		date;
	X_MONTH number;
	X_year  number;

  BEGIN
  
   select DECEASED_YN,DECEASED_DATE,DATE_OF_BIRTH 
		into lv_deceased_yn,lv_deceased_date,lv_dob
		from mp_patient where patient_id=:d_patient_id;

  
  IF lv_deceased_yn='Y' then
  		x_today := lv_deceased_date;
  ELSE
	 X_TODAY := SYSDATE;
  END IF;
				X_MONTH := ABS(MONTHS_BETWEEN(X_TODAY, lv_dob));
				IF trunc(X_month) > 0 THEN
				 X_year := trunc(X_month/12);
				ELSE
				 X_year := 0;
				END IF;

				:ln_age_year := trunc(X_year);


END;
END-EXEC;
		
		if (OERROR)
        err_mesg("get_patient_details failed",0,"");

}


print_line_1(line_var) varchar line_var[101];  //print_line definition

{
	dup_var.arr[0] = '\0';
	dup_var.len = 0;

    pos_var  = 0;
	pos_var1 = 0;
	pos_var2 = 0;
	print_upto = 0;
	lv_var  = 1;
	i = 0;
	
	strcpy(dup_var.arr,line_var);
	dup_var.len = strlen(dup_var.arr);
	var_length = strlen(dup_var.arr);
	pos_var = char_position(dup_var.arr,"+",1);
    sprintf(st_var,"%d",var_length);
	

	while(i < var_length)
	{ 
	if (pos_var == 0)
	{
    pos_length = var_length - i + 2;
	sprintf(st_var,"%d",pos_length);
	
	put_string(dup_var.arr,i,pos_length);
	strcpy(str_var1.arr,ls_str.arr);
	
	

	str_var1.len= strlen(str_var1.arr);
	
	check_splch_1(str_var1.arr);
	pos_var1 = 0;
	pos_var2 = 0;
	i = var_length;
	}

	if (pos_var != 0 && pos_var1 == 0)
	{	    
	pos_var1 = pos_var;

	pos_length = pos_var1-print_upto-1;	

    put_string(dup_var.arr,print_upto+1,pos_length);
    strcpy(str_var1.arr,ls_str.arr);
	str_var1.len = strlen(str_var1.arr);
	check_splch_1(str_var1.arr);

    print_upto = pos_var1 - 1;
	i = pos_var1+1;
    

	pos_var2 = char_position(dup_var.arr,"+",i);

     if (pos_var2 == 0)
	 {
	  pos_length = var_length - pos_var1 + 1;
      put_string(dup_var.arr,pos_var1,pos_length);
      strcpy(str_var1.arr,ls_str.arr);
	  str_var1.len = strlen(str_var1.arr);

	  check_splch_1(str_var1.arr);
	  print_upto = var_length+1;
	  i = var_length+1;
     }

    }

    if (pos_var2 != 0)
	{
    nd_column_val.arr[0] = '\0';
	nd_column_val.len = 0;
	column_var.arr[0] = '\0';
	column_var.len = 0;
	tab_name.arr[0] = '\0';
	tab_name.len = 0;

sql_stmt1.arr[0] = '\0';
sql_stmt1.len = 0;
sql_stmt2.arr[0] = '\0';
sql_stmt2.len = 0;


	pos_length = pos_var2 - pos_var1 - 1;

    column_var.arr[0] = '\0';
	column_var.len = 0;
	
	 put_string(dup_var.arr,pos_var1+1,pos_length);
     strcpy(column_var.arr,ls_str.arr);
	 column_var.len = strlen(column_var.arr);
	 date_yn = chk_date_yn(column_var.arr);
	 


		 
	  EXEC SQL SELECT  decode(:date_yn,0,'select to_char(ltrim('|| LET_MAPPED_COL_NAME || ')) from '|| LET_MAPPED_TABLE_NAME ||' WHERE ',
										 'select to_char('|| LET_MAPPED_COL_NAME || ',''DD/MM/YYYY'') from '|| LET_MAPPED_TABLE_NAME ||' WHERE '),LET_MAPPED_TABLE_NAME
					into  :sql_stmt1,tab_name
                    FROM BL_RECEIPT_MAPPING_COL
                    WHERE LET_COLUMN_ID = :column_var
					AND APPL_TRX_IND = 'B';



	len = strlen(sql_stmt1.arr);
		sql_stmt1.arr[sql_stmt1.len]  ='\0';


    tab_name.arr[tab_name.len] = '\0';
	
//	disp_message(ERR_MESG,tab_name.arr);

	if(strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDR") == 0 || strcmp(tab_name.arr,"BL_RECEIPT_REFUND_HDRDTL_VW") == 0) 
	{
    
	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_doc_type_code1.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUMBER) =");
	strcat(sql_stmt2.arr,d_doc_number1.arr);

	if(strcmp(column_var.arr,"CASHIER_NAME")==0)
	{
		strcat(sql_stmt2.arr," AND ROWNUM=1");
	}
      
	}

	
	if(strcmp(tab_name.arr,"BL_BILL_HDR") == 0 ) 
	{
    
	strcpy(sql_stmt2.arr, "DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);

	}
	
	if(strcmp(tab_name.arr,"AR_CUSTOMER") == 0 ) 
	{

		if(strcmp(d_cust_code.arr,"\0")!=0)
		strcpy(d_copy_cust_code.arr,d_cust_code.arr);
		else
		strcpy(d_copy_cust_code.arr,"$$$$$");
	

    strcpy(sql_stmt2.arr, "cust_code = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_copy_cust_code.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"BL_CASH_COUNTER") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"operating_facility_id = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    strcat(sql_stmt2.arr, " and CASH_COUNTER_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_cash_counter.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"BL_EPISODE_FIN_DTLS") == 0 ) 
	{
	
    strcpy(sql_stmt2.arr, "EPISODE_TYPE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and EPISODE_ID= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	

	if(strcmp(tab_name.arr,"BL_ENCOUNTER_FOR_QRY_VW") == 0 ) 
	{
	
    strcpy(sql_stmt2.arr,"episode_type = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_type.arr);
	strcat(sql_stmt2.arr,"'");

    if (strcmp(d_episode_type.arr,"R")!=0)
	{
		strcat(sql_stmt2.arr," and episode_id= ");
		strcat(sql_stmt2.arr,"'");
		strcat(sql_stmt2.arr,d_episode_id.arr);
		strcat(sql_stmt2.arr,"'");
    }

   if (strcmp(d_episode_type.arr,"R")!=0 && strcmp(d_episode_type.arr,"I")!=0 && strcmp(d_episode_type.arr,"D")!=0)
   {
	strcat(sql_stmt2.arr," and visit_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_visit_id.arr);
	strcat(sql_stmt2.arr,"'");
   }

	strcat(sql_stmt2.arr," and NVL(LANGUAGE_ID,'en')= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_lang_id.arr);
	strcat(sql_stmt2.arr,"'");

	strcat(sql_stmt2.arr," and patient_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and facility_id = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	
	}

	if(strcmp(tab_name.arr,"PR_ENCOUNTER") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    strcat(sql_stmt2.arr," and patient_id = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and episode_id= ");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_episode_id.arr);
	strcat(sql_stmt2.arr,"'");
	}


	if(strcmp(tab_name.arr,"MP_PATIENT_MAST") == 0)
	{ 
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); ;
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	
	if(strcmp(tab_name.arr,"MP_PATIENT") == 0)
	{ 
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); ;
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

	if(strcmp(tab_name.arr,"MP_REGION") == 0) 
	{
	strcpy(sql_stmt2.arr, "REGION_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_REGION_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	
	if(strcmp(tab_name.arr,"SY_ACC_ENTITY") == 0) 
	{
	strcpy(sql_stmt2.arr, "ACC_ENTITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}
	

	if(strcmp(tab_name.arr,"MP_PAT_OTHER_DTLS") == 0) 
	{
	strcpy(sql_stmt2.arr, "PATIENT_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d_patient_id.arr);
	strcat(sql_stmt2.arr,"'");
    
	}


    if(strcmp(tab_name.arr,"MP_RES_AREA") == 0) 
	{
	strcpy(sql_stmt2.arr, "RES_AREA_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_AREA_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

	if(strcmp(tab_name.arr,"MP_RES_TOWN") == 0) 
	{
	strcpy(sql_stmt2.arr, "RES_TOWN_CODE = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_RES_TOWN_CODE.arr);
	strcat(sql_stmt2.arr,"'");
    
	}

	if(strcmp(tab_name.arr,"SM_FACILITY_PARAM") == 0) 
	{
    strcpy(sql_stmt2.arr, "FACILITY_ID = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	if(strcmp(tab_name.arr,"SY_ACC_ENTITY") == 0) 
	{
    strcpy(sql_stmt2.arr, "acc_entity_id = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	}
	
	/**************SCRUM -CRF-23 CHANGES***************/
	if(strcmp(tab_name.arr,"BL_BILL_REF_PATCATG_VW") == 0 ) 
	{
   	strcpy(sql_stmt2.arr," OPERATING_FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr, " and DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);
 	}


  	if(strcmp(tab_name.arr,"BL_BILL_REF_SPLTY_VW") == 0 ) 
	{
	strcpy(sql_stmt2.arr,"OPERATING_FACILITY_ID = "); 
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,nd_facility_id.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr, "and DOC_TYPE_CODE = "); //:nd_facility");
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr,d1_doc_type.arr);
	strcat(sql_stmt2.arr,"'");
	strcat(sql_stmt2.arr," and to_char(DOC_NUM) =");
	strcat(sql_stmt2.arr,d1_doc_number.arr);
 	} 
	/***********CRF-23 CHANGES UPTO HERE *******/

	strcpy(sql_stmt,sql_stmt1.arr);

	strcat(sql_stmt,sql_stmt2.arr); 
  

EXEC SQL EXECUTE
	BEGIN
	 EXECUTE IMMEDIATE :sql_stmt INTO :nd_column_val;
	END;
END-EXEC;

nd_column_val.arr[nd_column_val.len]  ='\0';

if (OERROR)
{
	nd_column_val.arr[0]='\0';
}


if(nd_column_val.arr[0]!='\0')
{
 strcat(str_has_to_print.arr,nd_column_val.arr);
 str_has_to_print.len=str_has_to_print.arr;
   
}	print_upto = pos_var2;
	i = pos_var2+1;  
	
    pos_var1 = 0;
	pos_var2 = 0;

	pos_var = char_position(dup_var.arr,"+",i);
    }
   } 
} 


check_splch_1(str_var1)
char str_var1[101];
{
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 lc_str_val.arr[0]	='\0';
 lc_str_val.len		= 0;
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 
 ctr = 1;
 print_upto_c = 0;
 strcpy(lc_str_val.arr,str_var1);
 lc_str_val.len = strlen(lc_str_val.arr);
 len_lc_str_val = strlen(lc_str_val.arr);

 while(ctr <= len_lc_str_val)
 {
 prt_len = 0;
 spchar_pos = 0;
 spchar_pos1 = 0;
 
 
 spchar_pos = chk_esc_pos(lc_str_val.arr,ctr);
 
 spchar_pos1 = chk_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0  && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 1;
   }

 spchar_pos1 = chk_cp_nwln_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 2;
   }

 
 spchar_pos1 = chk_tab_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 3;
   }

 spchar_pos1 = chk_bold_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 4;
   }

 spchar_pos1 = chk_font_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 5;
   }

spchar_pos1 = chk_line_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 6;
   }

spchar_pos1 = chk_uline_pos(lc_str_val.arr,ctr);
 if (spchar_pos1 > 0 && spchar_pos1 <= spchar_pos)
   {
   spchar_pos = spchar_pos1;
   spchar_type = 7;
   }


 if (spchar_pos == 0)   
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;
 prt_len = len_lc_str_val - print_upto_c ;

 put_string(lc_str_val.arr,print_upto_c + 1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);

 lc_str_var.len=strlen(lc_str_var.arr);

 //fprintf(fp,"%s",lc_str_var.arr);

 strcat(str_has_to_print.arr,lc_str_var.arr);
 

 ctr = len_lc_str_val+1;
 print_upto_c = len_lc_str_val;
 }
 else
 {
 lc_str_var.arr[0]	='\0';
 lc_str_var.len		= 0;

 prt_len = spchar_pos - print_upto_c -1;
 
 put_string(lc_str_val.arr,print_upto_c+1,prt_len);
 strcpy(lc_str_var.arr,ls_str.arr);
 lc_str_var.len = strlen(lc_str_var.arr);

  //fprintf(fp,"%s",lc_str_var.arr);

   strcat(str_has_to_print.arr,lc_str_var.arr);
 
  

  ctr = spchar_pos+2;
  print_upto_c = spchar_pos+1;

  }
  
 }
}



get_currency()
{

	currency.arr[0] = '\0';
	sub_cur.arr[0]  = '\0';
	currency.len = 0;
	sub_cur.len = 0;
	nd_acc_name.arr[0] = '\0';
	nd_acc_name.len = 0;
	nd_decimal = 0;

	EXEC SQL SELECT base_currency,
			base_currency_dec,
			acc_entity_name||', ',
			accounting_name,
			no_of_decimal 
	INTO    :currency,
			:sub_cur,
			:nd_facility_name ,
			:nd_acc_name,
			:nd_decimal
	FROM SY_ACC_ENTITY_LANG_VW
	WHERE acc_entity_id = :d_cashfacility_id
	AND LANGUAGE_ID=:nd_lang_id;

	if (OERROR) 
	{ 
		disp_message (ERR_MESG,"SELECT FACILITY STATEMENT FAILED");
		proc_exit();
	}

	currency.arr[currency.len] = '\0';
	sub_cur.arr[sub_cur.len] = '\0';
	nd_facility_name.arr[nd_facility_name.len] = '\0';
	nd_acc_name.arr[nd_acc_name.len] = '\0';

}

get_subsidized_amt()  //added for IN9051
{

l_gross_disc_amt=0;
l_pat_net_amt=0;
l_subsidized_amt=0;


EXEC SQL SELECT  (SUM( nvl(UPD_GROSS_CHARGE_AMT,0))-SUM( nvl(UPD_DISC_AMT,0)))
		 into  l_gross_disc_amt
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	

        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number);

	
	
EXEC SQL SELECT  sum(nvl(UPD_NET_CHARGE_AMT,0))  into  l_pat_net_amt
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani
                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	
     
        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and cust_code is null;

	l_subsidized_amt = l_gross_disc_amt-l_pat_net_amt;

	
}

get_ph_batch_details()
{
d_trade_name.arr[0] = '\0';
d_batch_name.arr[0] = '\0';
d_exp_dt.arr[0] = '\0';
d_loc_code.arr[0] = '\0';

d_trade_name.len = 0;
d_batch_name.len = 0;
d_exp_dt.len = 0;
d_loc_code.len = 0;

EXEC SQL EXECUTE
BEGIN
BLCORE.GET_SUB_STR_AND_POSI
			(:d_folio_batch_id,
			 :d_trade_posi , :d_trade_name ,
			 :d_batch_posi , :d_batch_name ,
			 :d_exp_dt_posi, :d_exp_dt	,
			 :d_loc_posi   , :d_loc_code	,
			 :d_qty_posi   , :d_qty  );

END;
END-EXEC;

d_trade_name.arr[strlen(d_trade_name.arr)]	= '\0';
d_batch_name.arr[strlen(d_batch_name.arr)]	= '\0';
d_exp_dt.arr[strlen(d_exp_dt.arr)]			= '\0';
d_loc_code.arr[strlen(d_loc_code.arr)]		= '\0';

fprintf(fp,"%-12.12s%-8.8s %-11.11s %-13.13s %-12.12s%"," ",loc_legend[1427],d_batch_name.arr,loc_legend[1428],d_exp_dt.arr);
fprintf(fp,"\n");
}


get_payer_batch_details()
{
d_trade_name.arr[0] = '\0';
d_batch_name.arr[0] = '\0';
d_exp_dt.arr[0] = '\0';
d_loc_code.arr[0] = '\0';

d_trade_name.len = 0;
d_batch_name.len = 0;
d_exp_dt.len = 0;
d_loc_code.len = 0;

EXEC SQL EXECUTE
BEGIN
BLCORE.GET_SUB_STR_AND_POSI
			(:d1_folio_batch_id,
			 :d_trade_posi , :d_trade_name ,
			 :d_batch_posi , :d_batch_name ,
			 :d_exp_dt_posi, :d_exp_dt	,
			 :d_loc_posi   , :d_loc_code	,
			 :d_qty_posi   , :d_qty  );

END;
END-EXEC;

d_trade_name.arr[strlen(d_trade_name.arr)]	= '\0';
d_batch_name.arr[strlen(d_batch_name.arr)]	= '\0';
d_exp_dt.arr[strlen(d_exp_dt.arr)]			= '\0';
d_loc_code.arr[strlen(d_loc_code.arr)]		= '\0';

fprintf(fp,"%-12.12s%-8.8s %-11.11s %-13.13s %-12.12s%"," ",loc_legend[1427],d_batch_name.arr,loc_legend[1428],d_exp_dt.arr);
fprintf(fp,"\n");
}

get_grp_pkg_outside_cnt(d_grp_code)  //,d_serv_code
{
l_grp_pkg_inside_cnt=0;


EXEC SQL SELECT  count(*) into  l_grp_pkg_inside_cnt
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	

                      
        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and NVL(PACKAGE_TRX_YN,'N')='N'
	and	PACKAGE_SEQ_NO is null
	and BILL_DOC_TYPE_CODE=:d1_doc_type
	and BILL_DOC_NUM=:d1_doc_number
	and A.PRT_GRP_HDR_CODE=:d_grp_code
	//and A.BLNG_SERV_CODE=:d_serv_code
	and cust_code is null;


}


get_grp_pkg_outside_cnt1(d_grp_code)  //,d_serv_code
{
l_grp_pkg_inside_cnt=0;


EXEC SQL SELECT  count(*) into  l_grp_pkg_inside_cnt
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	

                      
        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number)
	and NVL(PACKAGE_TRX_YN,'N')='N'
	and	PACKAGE_SEQ_NO is null
	and BILL_DOC_TYPE_CODE=:d1_doc_type
	and BILL_DOC_NUM=:d1_doc_number
	and A.PRT_GRP_HDR_CODE=:d_grp_code
	and cust_code is not null;


}


get_pat_inside_pkg_disc()
{

l_pat_inside_pkg_disc =0;

EXEC SQL SELECT SUM(nvl(UPD_DISC_AMT,0)) 
		into l_pat_inside_pkg_disc
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	

        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number
	AND NVL(PACKAGE_TRX_YN,'N')='Y'
	AND PACKAGE_SEQ_NO IS NOT NULL
	AND CUST_CODE IS NULL);


}

get_pay_inside_pkg_disc()
{

l_pay_inside_pkg_disc =0;

EXEC SQL SELECT SUM(nvl(UPD_DISC_AMT,0)) 
		into l_pay_inside_pkg_disc
	FROM BL_PATIENT_CHARGES_FOLIO A, BL_BLNG_SERV C
	WHERE OPERATING_FACILITY_ID = :nd_facility_id
	AND A.BLNG_SERV_CODE = C.BLNG_SERV_CODE
	AND EPISODE_TYPE = :d_episode_type
	AND (
	(:d_episode_type != 'R' AND EPISODE_ID = :d_episode_id) 
	OR 
	(:d_episode_type = 'R')
	)
	AND  (
	(:d_episode_type IN ('O','E') AND VISIT_ID = :d_visit_id) 
	OR
	(:d_episode_type IN ('I','D','R'))
	)
	AND PATIENT_ID = :d_patient_id
	and (trx_status is null 

                or (trx_status ='C' and  NVL(REV_ADJ_TRX_IND,'R')='R' and (SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM) not in 

                        (Select TRX_DOC_REF,TRX_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id         and 

						bill_doc_type_code =:d1_doc_type			//added by vani

                        and bill_doc_num =  :d1_doc_number))		//added by vani

                        or (REV_ADJ_TRX_IND ='B' and (TRX_DOC_REF,TRX_DOC_REF_LINE_NUM) 

                        not in (Select SOURCE_DOC_REF,SOURCE_DOC_REF_LINE_NUM from 

                        bl_patient_charges_folio where OPERATING_FACILITY_ID = :nd_facility_id and

                        patient_id=:d_patient_id           and 

						bill_doc_type_code =:d1_doc_type		

                        and bill_doc_num =  :d1_doc_number )	

        ))   
	AND EXISTS (SELECT B.TRX_DOC_REF FROM BL_PATIENT_CHARGES_FOLIO B
	WHERE B.OPERATING_FACILITY_ID = :nd_facility_id
	AND B.OPERATING_FACILITY_ID = A.OPERATING_FACILITY_ID
	AND B.TRX_DOC_REF = A.TRX_DOC_REF
	AND B.TRX_DOC_REF_LINE_NUM = A.TRX_DOC_REF_LINE_NUM
	AND B.BILL_DOC_TYPE_CODE = :d1_doc_type
	AND B.BILL_DOC_NUM =:d1_doc_number
	AND NVL(PACKAGE_TRX_YN,'N')='Y'
	AND PACKAGE_SEQ_NO IS NOT NULL
	AND CUST_CODE IS NOT NULL);


}

get_receipt_refund_ind()
{
	 d_receipt_refund_ind.arr[0]		='\0';
	 d_receipt_refund_ind.len		= 0;
	
	EXEC SQL select RECPT_REFUND_IND 
		 into :d_receipt_refund_ind
		 from BL_RECEIPT_REFUND_HDR 
		 where Bill_doc_type_code=:d1_doc_type
		 and bill_doc_number=:d1_doc_number;

	d_receipt_refund_ind.arr[d_receipt_refund_ind.len]  = '\0';
}
